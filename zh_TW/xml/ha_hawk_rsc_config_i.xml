<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="ha_hawk_rsc_config_i.xml" id="sec.ha.config.hawk.rsc">
 <title>設定叢集資源</title>

 <para>
  做為叢集管理員，您需要為您叢集中的伺服器上執行的所有資源或應用程式建立叢集資源。叢集資源可以是網站、郵件伺服器、資料庫、檔案系統、虛擬機器，以及您希望使用者隨時都可以存取的其他伺服器型應用程式或服務。
 </para>

 <para>
  有關您可以建立之資源類型的綜覽，請參閱<xref linkend="sec.ha.config.basics.resources.types"/>。除了資源的基本規格 (ID、類別、提供者和類型) 外，您還可以在建立資源期間或之後新增或修改以下參數︰
 </para>

 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    <literal>例項屬性 (參數)</literal> 決定資源控制的服務例項。若需更多資訊，請參閱<xref linkend="sec.ha.config.basics.inst.attr"/>。
   </para>
   <para>
    建立資源時，Hawk 會自動顯示所有需要的參數。請編輯這些參數以獲得有效的資源組態。
   </para>
  </listitem>
  <listitem>
   <para>
    <literal>中繼屬性</literal>告訴 CRM 如何處理特定資源。如需詳細資訊，請參閱<xref linkend="sec.ha.config.basics.meta.attr"/>。
   </para>
   <para>
    建立資源時，Hawk 會自動列出該資源的重要中繼屬性 (例如，用於定義資源初始狀態的 <literal>target-role</literal> 屬性，預設設為 <literal>Stopped</literal>，這樣資源便不會立即啟動)。
   </para>
  </listitem>
  <listitem>
   <para>
    <literal>操作</literal>︰監控資源時需要用到。如需詳細資訊，請參閱<xref linkend="sec.ha.config.basics.operations"/>。
   </para>
   <para>
    建立資源時，Hawk 會顯示最重要的資源操作 (<literal>monitor</literal>、<literal>start</literal> 和 <literal>stop</literal>)。
   </para>
  </listitem>
 </itemizedlist>

<?dbfo-need height="20em"?>



 <sect2 id="sec.ha.config.hawk.wizard">
  <title>使用設定精靈設定資源</title>
  <para>
   High Availability Extension 隨附了一組預先定義的樣板，用於一些常用的叢集個案，例如，設定高可用性 NFS 伺服器。<systemitem class="resource">hawk-templates</systemitem> 套件中包含這些預先定義的樣板。您也可以定義自己的精靈樣板。如需詳細資訊，請參閱 <ulink url="https://github.com/ClusterLabs/hawk/blob/master/doc/wizard.txt"/>。
  </para>
  <procedure id="pro.ha.config.hawk.wizard">
   <title>使用設定精靈</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中選取<guimenu>設定精靈</guimenu>。<guimenu>叢集設定精靈</guimenu>會列出可用的資源樣板。如果您按一下某個項目，Hawk 會顯示該樣板的簡要說明文字。
    </para>
   </step>
   <step performance="required">
    <para>
     選取您要設定的資源集，然後按<guimenu>下一步</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     按照螢幕上的指示執行操作。如需關於某個選項的資訊，按一下該選項即可在 Hawk 中顯示簡要說明文字。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk — 設定精靈</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-wizard.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-wizard.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect2>

 <sect2 id="sec.ha.config.hawk.primitives">
  <title>建立簡單叢集資源</title>
  <para>
   若要建立最基本的資源類型，請執行下列步驟：
  </para>
  <procedure id="pro.ha.config.hawk.primitives">
   <title>新增基本資源</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中，選取<guimenu>資源</guimenu>。<guimenu>資源</guimenu>螢幕會顯示所有資源類型的類別，並會列出所有已定義的資源。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<guimenu>基本資源</guimenu>類別並按一下加號圖示。
    </para>
   </step>
   <step performance="required">
    <para>
     指定資源︰
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       輸入唯一的<guimenu>資源 ID</guimenu>。
      </para>
     </step>
     <step id="step.ha.config.hawk.primitives.start" performance="required">
      <para>
       在<guimenu>類別</guimenu>清單中，選取您要針對該資源使用的資源代辦類別：<guimenu>lsb</guimenu>、<guimenu>ocf</guimenu>、<guimenu>服務</guimenu> 或 <guimenu>stonith</guimenu>。如需詳細資訊，請參閱<xref linkend="sec.ha.config.basics.raclasses"/>。
      </para>
     </step>
     <step performance="required">
      <para>
       如果選取了<guimenu>ocf</guimenu>類別，請指定 OCF 資源代辦的<guimenu>提供者</guimenu>。OCF 規格允許多個廠商提供相同的資源代辦。
      </para>
     </step>
     <step performance="required">
      <para>
       在<guimenu>類型</guimenu>清單中，選取要使用的資源代辦 (例如<guimenu>IPaddr</guimenu>或<guimenu>Filesystem</guimenu>)。此資源代辦的簡要描述即會顯示。
      </para>
      <para>
       <guimenu>類型</guimenu>清單中顯示的選項取決於您所選的<guimenu>類別</guimenu>(對於 OCF 資源，還取決於<guimenu>提供者</guimenu>)。
      </para>
     </step>
    </substeps>
   </step>
   <step id="step.ha.config.hawk.parameters" performance="required">
    <para>
     Hawk 會自動顯示資源所需的所有參數，以及一個空白下拉式清單供您指定其他參數。
    </para>
    <para>
     若要定義資源的<guimenu>參數</guimenu>(例項屬性)︰
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       輸入各所需參數的值。按一下參數旁邊的文字方塊，一段簡要說明文字便會顯示。
      </para>
     </step>
     <step performance="required">
      <para>
       若要完全移除某個參數，請按一下該參數旁邊的減號圖示。
      </para>
     </step>
     <step performance="required">
      <para>
       若要新增其他參數，請按一下空白下拉式清單，然後選取參數並輸入其值。
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Hawk 會自動顯示最重要的資源<guimenu>操作</guimenu>並提供建議的預設值。如果此時不修改任何設定，Hawk 將會在您確認變更後新增其建議的操作及其預設值。
    </para>
    <para>
     如需關於如何修改、新增或移除操作的詳細資料，請參閱<xref linkend="pro.ha.config.hawk.operations"/>。
    </para>
   </step>
   <step id="step.ha.config.hawk.meta-attr" performance="required">
    <para>
     Hawk 會自動列出資源最重要的中繼屬性，例如 <literal>target-role</literal>。
    </para>
    <para>
     若要修改或新增<guimenu>中繼屬性</guimenu>︰
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       若要為屬性設定一個 (不同的) 值，請從屬性旁邊的下拉式方塊中選取值，或編輯輸入欄位中的值。
      </para>
     </step>
     <step performance="required">
      <para>
       若要完全移除某個中繼屬性，請按一下該屬性旁邊的減號圖示。
      </para>
     </step>
     <step performance="required">
      <para>
       若要新增其他中繼屬性，請按一下空白下拉式方塊並選取一個屬性。該屬性的預設值即會顯示。如有需要，請依上文所述變更該值。
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>建立資源</guimenu>完成組態。螢幕頂部的訊息會顯示該資源是否已成功建立。
    </para>
   </step>
  </procedure>
  <figure>
   <title>Hawk — 基本資源</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-primitive-basic.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-primitive-basic.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

 </sect2>

 <sect2 id="sec.ha.config.hawk.stonith">
  <title>建立 STONITH 資源</title>
  <important>
   <title>沒有 STONITH 則不提供支援</title>
   <para>
    系統不支援沒有 STONITH 的叢集。
   </para>
  </important>
  <para>
   依預設，全域叢集選項 <literal>stonith-enabled</literal> 設定為 <literal>true</literal>：如果未定義 STONITH 資源，叢集將拒絕啟動任何資源。設定一或多個 STONITH 資源以完成 STONITH 設定。儘管 STONITH 的設定與其他資源相似，但它們的行為在某些方面有所不同。如需詳細資料，請參閱<xref linkend="sec.ha.fencing.config"/>。
  </para>
  <procedure id="pro.ha.config.hawk.stonith">
   <title>新增 STONITH 資源</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中，選取<guimenu>資源</guimenu>。<guimenu>資源</guimenu>螢幕會顯示所有資源類型的類別，並列出所有定義的資源。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<guimenu>基本資源</guimenu>類別並按一下加號圖示。
    </para>
   </step>
   <step performance="required">
    <para>
     指定資源︰
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       輸入唯一的<guimenu>資源 ID</guimenu>。
      </para>
     </step>
     <step performance="required">
      <para>
       在<guimenu>類別</guimenu>清單中，選取資源代辦類別<guimenu>stonith</guimenu>。
      </para>
     </step>
     <step performance="required">
      <para>
       從<guimenu>類型</guimenu>清單中，選取用於控制 STONITH 裝置的 STONITH 外掛程式。此外掛程式的簡要描述即會顯示。
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Hawk 會自動顯示資源的必要<guimenu>參數</guimenu>。請輸入每個參數的值。
    </para>
   </step>
   <step performance="required">
    <para>
     Hawk 會顯示最重要的資源<guimenu>操作</guimenu>並提供建議的預設值。如果此時不修改任何設定，Hawk 將會在您確認後新增其建議的操作及其預設值。
    </para>
   </step>
   <step performance="required">
    <para>
     如無特定原因，請採用預設的<guimenu>中繼屬性</guimenu>設定。
    </para>
   </step>
   <step performance="required">
    <para>
     確認變更以建立 STONITH 資源。
    </para>
   </step>
  </procedure>
  <para>
   若要完成圍籬區隔組態，請新增條件約束或使用複製品，或同時使用這兩種方式。如需詳細資訊，請參閱<xref linkend="cha.ha.fencing"/>。
  </para>
 </sect2>

 <sect2 id="sec.ha.config.hawk.templates">
  <title>使用資源樣板</title>
  <para>
   如果您要建立大量具有相似組態的資源，定義資源樣板是最輕鬆的方法。定義資源樣板後，您可以在基本資源或某些類型的條件約束中參考該樣板。如需有關資源樣板功能和用法的詳細資訊，請參閱<xref linkend="sec.ha.config.basics.constraints.templates"/>。
  </para>
  <procedure id="pro.ha.config.hawk.templates.create">
   <title>建立資源樣板</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中，選取<guimenu>資源</guimenu>。<guimenu>資源</guimenu>螢幕會顯示所有資源類型的類別，以及<guimenu>樣板</guimenu>類別。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<guimenu>樣板</guimenu>類別並按一下加號圖示。
    </para>
   </step>
   <step performance="required">
    <para>
     輸入<guimenu>樣板 ID</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     像指定基本資源一樣指定資源樣板。請依照<xref linkend="pro.ha.config.hawk.primitives" xrefstyle="select:label title nopage"/> 中的說明從<xref linkend="step.ha.config.hawk.primitives.start" xrefstyle="select:label"/> 開始。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>建立資源</guimenu>完成組態。螢幕頂部的訊息會顯示該資源樣板是否已成功建立。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk — 資源樣板</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-rsc-template.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-rsc-template.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <procedure id="pro.ha.config.hawk.templates.use">
   <title>參考資源樣板</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     若要在基本資源中參考新建的資源樣板，請執行以下步驟：
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       在左側導覽列中，選取<guimenu>資源</guimenu>。<guimenu>資源</guimenu>螢幕會顯示所有資源類型的類別，並會列出所有定義的資源。
      </para>
     </step>
     <step performance="required">
      <para>
       選取<guimenu>基本資源</guimenu>類別並按一下加號圖示。
      </para>
     </step>
     <step performance="required">
      <para>
       輸入唯一的<guimenu>資源 ID</guimenu>。
      </para>
     </step>
     <step performance="required">
      <para>
       啟用<guimenu>使用樣板</guimenu>，然後從下拉式選單中選取要參考的樣板。
      </para>
     </step>
     <step performance="required">
      <para>
       如果需要，請依照<xref linkend="pro.ha.config.hawk.primitives"/> 所述指定更多<guimenu>參數</guimenu>、<guimenu>操作</guimenu>或<guimenu>中繼屬性</guimenu>。
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     若要在並存或順序條件約束中參考新建的資源樣板，請執行<xref linkend="pro.ha.config.hawk.constraints.collocation.order"/> 所述的步驟。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 id="sec.ha.config.hawk.constraints">
  <title>設定資源條件約束</title>
  <para>
   設定所有資源後，需要指定叢集應如何正確處理這些資源。資源條件約束可讓您指定資源可在哪些叢集節點上執行，載入資源的順序以及特定資源所依賴的其他資源。
  </para>
  <para>
   如需可用條件約束類型的綜覽，請參閱<xref linkend="sec.ha.config.basics.constraints.types"/>。定義條件約束時，還需要指定分數。如需叢集中分數及其含義的詳細資訊，請參閱<xref linkend="sec.ha.config.basics.constraints.scores"/>。
  </para>
  <para>
   下列程序將介紹如何建立不同類型的條件約束。
  </para>

<?dbfo-need height="20em"?>


  <procedure id="pro.ha.config.hawk.constraints.location">
   <title>新增或修改位置條件約束</title>
   <para>
    對於位置條件約束，需要指定條件約束 ID、資源、分數和節點：
   </para>

   <step id="step.ha.config.hawk.constraints.start" performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中選取<guimenu>條件約束</guimenu>。<guimenu>條件約束</guimenu>螢幕會顯示所有條件約束類型的類別，並會列出所有定義的條件約束。
    </para>
   </step>
   <step performance="required">
    <para>
     若要新增新的<guimenu>位置</guimenu>條件約束，請按一下相應類別中的加號圖示。
    </para>
    <para>
     若要修改某個現有條件約束，請按一下該條件約束旁邊的扳手圖示，然後選取<guimenu>編輯條件約束</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     輸入唯一的<guimenu>條件約束 ID</guimenu>。若您目前在修改現有條件約束，那麼其 ID 已經定義。
    </para>
   </step>
   <step id="step.ha.config.hawk.constraints.stop" performance="required">
    <para>
     選取要對其定義條件約束的<guimenu>資源</guimenu>。清單會顯示已為叢集設定之所有資源的 ID。
    </para>
   </step>
   <step performance="required">
    <para>
     為條件約束設定<guimenu>分數</guimenu>。正值表示資源可以在您下一步中指定的<guimenu>節點</guimenu>上執行。負值表示資源不應在該節點上執行。將分數設定為 <literal>INFINITY</literal> 會強制資源在該節點上執行。分數設定為 <literal>-INFINITY</literal> 表示資源不得在該節點上執行。
    </para>
   </step>
   <step performance="required">
    <para>
     為條件約束選取<guimenu>節點</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>建立條件約束</guimenu>完成組態。螢幕頂部的訊息會顯示該條件約束是否已成功建立。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk — 位置條件約束</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-loc-constraint.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-loc-constraint.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <procedure id="pro.ha.config.hawk.constraints.collocation.order">
   <title>新增或修改並存或順序條件約束</title>
   <para>
    對這兩種類型的條件約束需要指定條件約束 ID 和分數，然後將資源新增至相依性鏈結：
   </para>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中選取<guimenu>條件約束</guimenu>。<guimenu>條件約束</guimenu>螢幕會顯示所有條件約束類型的類別，並列出所有定義的條件約束。
    </para>
   </step>
   <step performance="required">
    <para>
     若要新增新的<guimenu>並存</guimenu>或<guimenu>順序</guimenu>條件約束，請按一下相應類別中的加號圖示。
    </para>
    <para>
     若要修改某個現有條件約束，請按一下該條件約束旁邊的扳手圖示，然後選取<guimenu>編輯條件約束</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     輸入唯一的<guimenu>條件約束 ID</guimenu>。若您目前在修改現有條件約束，那麼其 ID 已經定義。
    </para>
   </step>
   <step performance="required">
    <para>
     定義<guimenu>分數</guimenu>。
    </para>
    <para>
     對於並存條件約束，分數可以確定資源之間的位置關係。正值表示資源應該在同一個節點上執行。負值表示資源不應該在同一個節點上執行。將分數設定為 <literal>INFINITY</literal> 會強制資源在同一節點上執行。分數設定為 <literal>-INFINITY</literal> 表示資源不得在同一節點上執行。該分數會結合其他因素來決定將資源配置於何處。
    </para>
    <para>
     對於順序條件約束，如果分數大於零，則必須滿足條件約束，否則，條件約束只是一項建議。預設值為 <literal>INFINITY</literal>。
    </para>
   </step>
   <step performance="required">
    <para>
     對於順序條件約束通常可以啟用<guimenu>對稱</guimenu>選項。這會指定資源停止時使用相反順序。
    </para>
   </step>
   <step performance="required">
    <para>
     若要為條件約束定義資源，請執行以下步驟：
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       從<guimenu>向條件約束新增資源</guimenu>清單中選取一個資源。清單會顯示為叢集設定之所有資源和資源樣板的 ID。
      </para>
     </step>
     <step performance="required">
      <para>
       若要新增選定的資源，請按一下清單旁邊的加號圖示。下方即會出現一個新清單。從該清單中選取下一個資源。由於並存和順序條件約束都是定義資源之間的相依性，因此您至少需要兩個資源。
      </para>
     </step>
     <step performance="required">
      <para>
       從<guimenu>向條件約束新增資源</guimenu>清單中選取另一個資源。按一下加號圖示以新增該資源。
      </para>
      <para>
       現在，相依性鏈結中已經有了兩個資源。
      </para>
      <para>
       如果定義了順序條件約束，則最頂端的資源會先啟動，接著是第二個資源，依此類推。通常，資源停止時會使用相反順序。
      </para>
      <para>
       但是，如果您定義的是並存條件約束，則資源之間的箭頭圖示反映的是它們之間的相依性，而<emphasis>不是</emphasis>其啟動順序。由於最頂端的資源依賴於下一個資源 (下面的資源依此類推)，叢集首先會決定向哪個位置放置最後一個資源，然後根據該決定放置依賴資源。若無法符合條件約束要求，叢集可能會決定不允許執行相依資源。
      </para>
     </step>
     <step performance="required">
      <para>
       為並存或順序條件約束新增所需數量的資源。
      </para>
     </step>
     <step performance="required">
      <para>
       如果您要交換兩個資源的順序，按一下資源右側的雙箭頭即可在相依性鏈結中交換資源順序。
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     如果需要，請為每個資源指定更多參數，例如角色 (「<literal>主要</literal>」、「<literal>從屬</literal>」、「<literal>已啟動</literal>」或「<literal>已停止</literal>」)。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>建立條件約束</guimenu>完成組態。螢幕頂部的訊息會顯示該條件約束是否已成功建立。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk — 並存條件約束</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-colloc-constraint.png" width="90%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-colloc-constraint.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   您可以使用另一種格式來定義並存或順序條件約束︰資源集。資源集的順序語意與群組相同。
  </para>
  <procedure id="pro.ha.config.hawk.constraints.sets">
   <title>在並存或順序條件約束中使用資源集</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     依照<xref linkend="pro.ha.config.hawk.constraints.collocation.order"/> 所述定義並存或順序條件約束。
    </para>
   </step>
   <step performance="required">
    <para>
     將資源新增至相依性鏈結後，按一下右側的鏈結圖示即可將這些資源放入資源集。屬於資源集的資源四周以框架圍起，以此標示資源集。
    </para>
   </step>
   <step performance="required">
    <para>
     您也可以將多個資源新增至某個資源集，或建立多個資源集。
    </para>
   </step>
   <step performance="required">
    <para>
     若要從資源集中去除某個資源，請按一下相應資源上方的剪刀圖示。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk-constraint-set.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk-constraint-set.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     該資源即會從集中移除，並放回到它在相依性鏈結中的原始位置。
    </para>
   </step>
   <step performance="required">
    <para>
     確認變更以完成條件約束組態。
    </para>
   </step>
  </procedure>
  <para>
   如需設定條件約束的詳細資訊，以及關於順序與並存基本概念的詳細背景資訊，請參閱 <ulink url="http://www.clusterlabs.org/doc/"/> 上提供的文件：
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
      《<citetitle>Pacemaker Explained</citetitle>》(Pacemaker 說明) 的「<citetitle>Resource Constraints</citetitle>」(資源條件約束) 一章
    </para>
   </listitem>
   <listitem>
    <para>
     《<citetitle>Colocation Explained</citetitle>》(並存說明)
    </para>
   </listitem>
   <listitem>
    <para>
     《<citetitle>Ordering Explained</citetitle>》(順序說明)
    </para>
   </listitem>
  </itemizedlist>
  <procedure id="pro.ha.config.hawk.constraints.remove">
   <title>移除條件約束</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中選取<guimenu>條件約束</guimenu>。<guimenu>條件約束</guimenu>螢幕會顯示所有條件約束類型的類別，並列出所有定義的條件約束。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下條件約束旁邊的扳手圖示，然後選取<guimenu>移除條件約束</guimenu>。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 id="sec.ha.config.hawk.failover">
  <title>指定資源容錯移轉節點</title>
  <para>
   若資源失敗，系統會自動將其重新啟動。若在目前節點上無法將其重新啟動，或資源已在目前節點上失敗 N 次，則資源會嘗試容錯移轉至其他節點。您可以定義一個數值，讓資源在失敗該次數 (<literal>migration-threshold</literal>) 之後移轉至新節點。如果叢集中有兩個以上的節點，則某個資源應容錯移轉至哪個節點由 High Availability 軟體來選擇。
  </para>
  <para>
   您可以執行以下步驟指定資源容錯移轉至某個特定節點：
  </para>
  <procedure id="pro.ha.config.hawk.failover">
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     依<xref linkend="pro.ha.config.hawk.constraints.location"/> 所述為該資源設定位置條件約束。
    </para>
   </step>
   <step performance="required">
    <para>
     依<xref linkend="pro.ha.config.hawk.primitives" xrefstyle="select:label title nopage"/> 中的<xref linkend="step.ha.config.hawk.meta-attr" xrefstyle="select:label"/> 所述將 <literal>migration-threshold</literal> 中繼屬性新增至該資源，並為該 migration-threshold 輸入一個<guimenu>值</guimenu>。該值應該為小於 INFINITY 的正數。
    </para>

   </step>
   <step performance="required">
    <para>
     若要讓資源的 failcount 自動過期，請依<xref linkend="pro.ha.config.hawk.primitives" xrefstyle="select:label title nopage"/> 中的<xref linkend="step.ha.config.hawk.meta-attr" xrefstyle="select:label"/> 所述將 <literal>failure-timeout</literal> 中繼屬性新增至該資源，並為該 failure-timeout 輸入一個<guimenu>值</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     若要指定具有資源優先設定的其他容錯移轉節點，請建立其他位置條件約束。
    </para>
   </step>
  </procedure>
  <para>
   <xref linkend="ex.ha.config.basics.failover"/> 中演示了關於 migration-threshold 和 failcount 的程序流程。
  </para>
  <para>
   您也可以隨時手動清理資源的 failcount，而不是等待資源的 failcount 自動過期。如需詳細資訊，請參閱<xref linkend="sec.ha.config.hawk.cleanup"/>。
  </para>
 </sect2>

 <sect2 id="sec.ha.config.hawk.failback">
  <title>指定資源錯誤回復節點 (資源粘性)</title>
  <para>
   當原始節點重新回到線上和叢集中時，資源可能會回復至該節點。若要防止此狀況，或要為資源指定不同的錯誤回復節點，請變更資源的粘性值。您可以在建立資源時指定資源粘性，也可以在以後指定。
  </para>
  <para>
   有關不同資源粘性值的含義，請閱<xref linkend="sec.ha.config.basics.failback"/>。
  </para>
<?dbfo-need height="20em"?>


  <procedure id="pro.ha.config.hawk.stickiness">
   <title>指定資源粘性</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     依<xref linkend="pro.ha.config.hawk.primitives" xrefstyle="select:label title nopage"/> 中的<xref linkend="step.ha.config.hawk.meta-attr" xrefstyle="select:label"/> 所述將 <literal>resource-stickiness</literal> 中繼屬性新增至資源。
    </para>

   </step>
   <step performance="required">
    <para>
     為 resource-stickiness 指定介於 <literal>-INFINITY</literal> 和 <literal>INFINITY</literal> 之間的值。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 id="sec.ha.config.hawk.utilization">
  <title>根據負載影響設定資源的配置</title>
  <para>
   並非所有資源都相同。有些資源 (例如 Xen 客體作業系統) 要求代管它們的節點滿足其容量要求。如果投放資源後，所需的容量總和超出了提供的容量，則資源效能將會下降，或者資源將會失敗。
  </para>
  <para>
   鑒於此，High Availability Extension 允許您指定以下參數：
  </para>
  <orderedlist spacing="normal">
   <listitem>
    <para>
     特定節點<emphasis>提供</emphasis>的容量。
    </para>
   </listitem>
   <listitem>
    <para>
     特定資源<emphasis>要求</emphasis>的容量。
    </para>
   </listitem>
   <listitem>
    <para>
     配置資源的整體策略。
    </para>
   </listitem>
  </orderedlist>
  <para>
   使用率屬性用於設定資源的要求以及節點提供的容量。High Availability Extension 現在還提供了用於自動偵測和設定節點容量及資源要求的方法。如需詳細資料及組態範例，請參閱<xref linkend="sec.ha.config.basics.utilization"/>。
  </para>
  <para>
   若要顯示節點的容量值 (透過使用率屬性定義) 以及節點上執行之資源目前使用的容量，請在 Hawk 中切換至<guimenu>叢集狀態</guimenu>螢幕。選取要查看的節點，按一下該節點旁邊的扳手圖示，然後選取<guimenu>顯示詳細資料</guimenu>。
  </para>
  <figure>
   <title>Hawk — 檢視節點的容量值</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-node-utilization.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-node-utilization.png" width="45%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   設定好節點提供的容量和資源需要的容量後，需在全域叢集選項中設定放置策略，否則容量組態將不會生效。可以使用幾個策略來排程負載：例如，您可將負載集中於最少的節點上，或在所有可用的節點上平均分攤。若需更多資訊，請參閱<xref linkend="sec.ha.config.basics.utilization"/>。
  </para>
  <procedure id="pro.ha.config.hawk.placement">
   <title>設定配置策略</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中，選取<guimenu>叢集內容</guimenu>以檢視全域叢集選項及目前值。
    </para>
   </step>
   <step performance="required">
    <para>
     從<guimenu>新增新的內容</guimenu>下拉式清單中，選擇 <literal>placement-strategy</literal>。
    </para>
   </step>
   <step performance="required">
    <para>
     根據要求將<guimenu>配置策略</guimenu>設定為適當的值。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下加號圖示以新增新的叢集內容 (包括其值)。
    </para>
   </step>
   <step performance="required">
    <para>
     確認您的變更。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 id="sec.ha.config.hawk.monitor">
  <title>設定資源監控</title>
  <para>
   High Availability Extension 不僅能夠偵測節點故障，還能偵測到節點上個別資源發生的故障。若要確定某個資源是否正在執行，請對其設定資源監控。設定資源監控需指定逾時和/或啟動延遲值以及間隔。該間隔會告知 CRM 應檢查資源狀態的頻率。您還可以設定特定參數，例如為 <literal>start</literal> 或 <literal>stop</literal> 操作設定 <literal>Timeout</literal>。
  </para>
  <procedure id="pro.ha.config.hawk.operations">
   <title>新增或修改監控操作</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中，選取<guimenu>資源</guimenu>。<guimenu>資源</guimenu>螢幕會顯示所有資源類型的類別，並列出所有定義的資源。
    </para>
   </step>
   <step performance="required">
    <para>
     選取要修改的資源，按一下該資源旁邊的扳手圖示，然後選取<guimenu>編輯資源</guimenu>。資源定義即會顯示。Hawk 會自動顯示最重要的資源操作 (<literal>monitor</literal>、<literal>start</literal>、<literal>stop</literal>) 並提供建議的預設值。
    </para>
   </step>
   <step performance="required">
    <para>
     若要變更某個操作的值：
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       按一下該操作旁邊的筆型圖示。
      </para>
     </step>
     <step performance="required">
      <para>
       在開啟的對話方塊中指定以下值：
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         輸入一個<literal>逾時</literal>值 (以秒計)。操作在經過指定的逾時期間之後會被視為 <literal>failed</literal>。PE 將會決定需要採取的措施，或執行您在監控操作的<guimenu>失敗時</guimenu>欄位中指定的動作。
        </para>
       </listitem>
       <listitem>
        <para>
         對監控操作定義監控<literal>間隔</literal> (以秒計)。
        </para>
       </listitem>
      </itemizedlist>
      <para>
       如果需要，請使用<guimenu>監控</guimenu>對話方塊底部的空白下拉式方塊新增更多參數，例如<guimenu>失敗時</guimenu> (如果此動作失敗應採取什麼措施？)或<guimenu>必要</guimenu>(需要符合哪些條件才執行此動作？)。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="hawk-monitor-op.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="hawk-monitor-op.png" width="60%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step performance="required">
      <para>
       確認變更以關閉此對話方塊，並返回<guimenu>編輯資源</guimenu>螢幕。
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     若要完全移除某個操作，請按一下該操作旁邊的減號圖示。
    </para>
   </step>
   <step performance="required">
    <para>
     若要新增其他操作，請按一下空白下拉式方塊並選取一個操作。該操作的預設值即會顯示。必要時可按一下鋼筆圖示來變更預設值。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>套用變更</guimenu>完成組態。螢幕頂部的訊息會顯示該資源是否已成功更新。
    </para>
   </step>
  </procedure>
  <para>
   有關資源監控偵測到失敗時應執行的程序，請參閱<xref linkend="sec.ha.config.basics.monitoring"/>。
  </para>
  <para>
   若要檢視發生的資源故障，請在 Hawk 中切換至<guimenu>叢集狀態</guimenu>螢幕，然後選取要查看的資源。按一下該資源旁邊的扳手圖示，然後選取<guimenu>顯示詳細資料</guimenu>。
  </para>
 </sect2>

 <sect2 id="sec.ha.config.hawk.group">
  <title>設定叢集資源群組</title>
  <para>
   某些叢集資源依賴於其他元件或資源，且要求每個元件或資源以特定順序啟動並在同一個伺服器上執行。若要簡化此組態，您可以使用群組。
  </para>
  <para>
   如需資源群組的範例和群組及其內容的詳細資訊，請參閱<xref linkend="sec.ha.config.basics.resources.advanced.groups"/>。
  </para>
  <note>
   <title>空群組</title>
   <para>
    群組至少須包含一個資源，否則組態視為無效。在 Hawk 中，建立群組時無法建立或修改基本資源。請在新增群組之前建立基本資源並視需要對其進行設定。如需詳細資訊，請參閱<xref linkend="pro.ha.config.hawk.primitives"/>。
   </para>
  </note>

  <procedure id="pro.ha.config.hawk.group">
   <title>新增資源群組</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中，選取<guimenu>資源</guimenu>。<guimenu>資源</guimenu>螢幕會顯示所有資源類型的類別，並列出所有定義的資源。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<guimenu>群組</guimenu>類別並按一下加號圖示。
    </para>
   </step>
   <step performance="required">
    <para>
     輸入唯一的<guimenu>群組 ID</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     若要定義群組成員，請在<guimenu>可用的基本資源</guimenu>清單中選取一或多個項目，然後按一下 &lt; 圖示將其新增至<guimenu>群組子項</guimenu>清單中。所有新的群組成員都會新增至清單底部。若要定義群組成員的順序，目前您需要依所需順序逐個新增和移除這些群組成員。
    </para>
   </step>
   <step performance="required">
    <para>
     如果需要，請依照<xref linkend="pro.ha.config.hawk.primitives" xrefstyle="select: lable title nopage"/>中的<xref linkend="step.ha.config.hawk.meta-attr" xrefstyle="select:label"/> 所述修改或新增<guimenu>中繼屬性</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>建立群組</guimenu>完成組態。螢幕頂部的訊息會顯示該群組是否已成功建立。
    </para>
   </step>
  </procedure>
  <figure>
   <title>Hawk — 資源群組</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-rsc-group.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-rsc-group.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect2>

 <sect2 id="sec.ha.confighawk.clone">
  <title>設定複製品資源</title>
  <para>
   如果希望某些資源同時在叢集中的多個節點上執行，請將這些資源設定為複製品。例如，您可以對 STONITH 這樣的資源以及 OCFS2 這樣的叢集檔案系統使用複製功能。您可以複製所提供的任何資源。資源的資源代辦支援複製。根據複製品資源執行時所在的節點，您可以對這些資源進行不同的設定。
  </para>
  <para>
   如需可用資源複製品類型的綜覽，請參閱<xref linkend="sec.ha.config.basics.resources.advanced.clones"/>。
  </para>
  <note>
   <title>複製品的子資源</title>
   <para>
    複製品可以將基本資源或群組做為子資源。在 Hawk 中，建立複製品時無法建立或修改子資源。請在新增複製品之前建立子資源並視需要對其進行設定。如需詳細資訊，請參閱<xref linkend="pro.ha.config.hawk.primitives"/> 或<xref linkend="pro.ha.config.hawk.group"/>。
   </para>
  </note>
  <procedure id="pro.ha.config.hawk.clone">
   <title>新增或修改複製品</title>
   <step performance="required">
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側導覽列中，選取<guimenu>資源</guimenu>。<guimenu>資源</guimenu>螢幕會顯示所有資源類型的類別，並列出所有定義的資源。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<guimenu>複製品</guimenu>類別並按一下加號圖示。
    </para>
   </step>
   <step performance="required">
    <para>
     輸入唯一的<guimenu>複製品 ID</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     從<guimenu>子資源</guimenu>清單中，選取要做為複製品子資源的基本資源或群組。
    </para>
   </step>
   <step performance="required">
    <para>
     如果需要，請依照<xref linkend="pro.ha.config.hawk.primitives" xrefstyle="select:label title nopage"/>中的<xref linkend="step.ha.config.hawk.meta-attr" xrefstyle="select:label"/> 所述修改或新增<guimenu>中繼屬性</guimenu>。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>建立複製品</guimenu>完成組態。螢幕頂部的訊息會顯示該複製品是否已成功建立。
    </para>
   </step>
  </procedure>
  <figure>
   <title>Hawk — 複製品資源</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-clone.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-clone.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect2>
</sect1>
