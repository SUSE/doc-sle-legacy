<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="ha_config_gui.xml" id="cha.ha.configuration.gui">
 <title>設定和管理叢集資源 (GUI)</title>
 <abstract>
  <para>
   本章對 Pacemaker GUI 做了介紹，說明設定和管理叢集資源時所需執行的基本任務：修改全域叢集選項，建立基本與進階類型的資源 (群組和複製品)，設定條件約束，指定容錯移轉節點與錯誤回復節點，設定資源監控，啟動、清理或移除資源，以及手動移轉資源。
  </para>
 </abstract>
 <para>
  GUI 支援由兩個套件提供：<systemitem class="resource">pacemaker-mgmt</systemitem> 套件包含 GUI 的後端 (<systemitem class="daemon">mgmtd</systemitem> 精靈)。該套件必須安裝在您要使用 GUI 連接的所有叢集節點上。在要執行 GUI 的每一台機器上安裝 <systemitem class="resource">pacemaker-mgmt-client</systemitem> 套件。
 </para>
 <note>
  <title>使用者認證</title>
  <para>
   若要從 Pacemaker GUI 登入叢集，相應使用者必須是群組 <systemitem class="groupname">haclient</systemitem> 的成員。安裝程式會建立名為 <systemitem class="username">hacluster</systemitem> 的 Linux 使用者，並將該使用者新增至 <systemitem class="groupname">haclient</systemitem> 群組。
  </para>
  <para>
   在使用 Pacemaker GUI 之前，先為 <systemitem>hacluster</systemitem> 使用者設定密碼，或建立一個屬於群組 <systemitem class="groupname">haclient</systemitem> 的新使用者。
  </para>
  <para>
   在您要使用 Pacemaker GUI 與之連接的所有節點上執行此操作。
  </para>
 </note>
<?dbfo-need height="20em"?>


 <sect1 id="sec.ha.configuration.gui.intro">
  <title>Pacemaker GUI — 綜覽</title>

  <para>
   若要啟動 Pacemaker GUI，請在指令行中輸入 <command>crm_gui</command>。若要存取組態與管理選項，須登入叢集。
  </para>

  <sect2 id="sec.ha.configuration.gui.intro.connect">
   <title>登入叢集</title>
   <para>
    若要連接至叢集，請選取<menuchoice><guimenu>連接</guimenu><guimenu>登入</guimenu></menuchoice>。依預設，<guimenu>伺服器</guimenu>欄位會顯示 localhost 的 IP 位址，以及做為<guimenu>使用者名稱</guimenu>的 <systemitem>hacluster</systemitem>。輸入使用者密碼以繼續。
   </para>
   <figure pgwide="0">
    <title>連接至叢集</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="crmgui-login.png" width="45%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="crmgui-login.png" width="45%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    若要從遠端執行 Pacemaker GUI，請輸入做為<guimenu>伺服器</guimenu>之叢集節點的 IP 位址。對於<guimenu>使用者名稱</guimenu>，您也可以使用屬於 <systemitem>haclient</systemitem> 群組的任何其他使用者來連接叢集。
   </para>
  </sect2>

<?dbfo-need height="20em"?>



  <sect2 id="sec.ha.configuration.gui.intro.main">
   <title>主視窗</title>
   <para>
    連接之後，主視窗即會開啟：
   </para>
   <figure pgwide="0">
    <title>Pacemaker GUI - 主視窗</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="crmgui-main.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="crmgui-main.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <note>
    <title>Pacemaker GUI 的可用功能</title>
    <para>
     依預設，以 <systemitem class="username">root</systemitem> 或 <systemitem class="username">hacluster</systemitem> 身分登入的使用者對於所有叢集組態任務都擁有完整的讀-寫存取權限。不過，您可以使用<xref linkend="cha.ha.acl" xrefstyle="select:title"/> 來定義精細的存取權限。
    </para>
    <para>
     如果 CRM 中啟用了 ACL，則 Pacemaker GUI 的可用功能取決於指定給您的使用者角色和存取權限。
    </para>
   </note>
   <para>
    若要檢視或修改 CRM、資源、節點或條件約束等叢集元件，請選取左側窗格中<guimenu>組態</guimenu>類別的相應子項目，然後使用右側窗格中可用的選項。此外，Pacemaker GUI 還可讓您針對下列子項目輕鬆檢視、編輯、輸入和輸出 CIB 的 XML 片段：<guimenu>資源預設值</guimenu>、<guimenu>操作預設值</guimenu>、<guimenu>節點</guimenu>、<guimenu>資源</guimenu>和<guimenu>條件約束</guimenu>。在視窗右上角選取任一<guimenu>組態</guimenu>子項目，然後選取<menuchoice><guimenu>顯示</guimenu><guimenu>XML 模式</guimenu></menuchoice>。
   </para>
   <para>
    如果您已經設定了資源，按一下左側窗格中的<guimenu>管理</guimenu>類別可顯示叢集及其資源的狀態。此檢視窗還可讓您將節點設定為<literal>待命</literal>，以及修改節點的管理狀態 (目前是否由叢集管理)。若要存取資源的主要功能 (啟動、停止、清理或移轉資源)，請在右側窗格中選取資源，然後使用工具列中的圖示。您也可以在該資源上按一下滑鼠右鍵，然後從快顯功能表中選取相應的功能表項目。
   </para>
   <para>
    Pacemaker GUI 還可讓您在不同檢視模式之間切換，以變更軟體的行為，隱藏或顯示某些元件：
   </para>
   <variablelist>
    <varlistentry>
     <term>簡單模式</term>
     <listitem>
      <para>
       可讓您在類似精靈的模式下新增資源。建立和修改資源時，會顯示子物件的常用索引標籤，您可以直接透過索引標籤新增該類型的物件。
      </para>
      <para>
       可讓您在左側窗格中選取<guimenu>CRM 組態</guimenu>項目來檢視及變更所有可用的全域叢集選項。右側窗格隨後便會顯示目前設定的值。如果未對選項設定任何特定的值，便會顯示預設值。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>進階模式</term>
     <listitem>
      <para>
       可讓您以類似精靈的模式或透過對話視窗新增資源。建立和修改資源時，如果 CIB 中已存在特定類型的子物件，則只會顯示相應的索引標籤。新增新的子物件時，系統將會提示您選取物件類型，這樣您便可新增所有受支援類型的子物件。
      </para>
      <para>
       在左側窗格中選取<guimenu>CRM 組態</guimenu>項目後，螢幕上只會顯示已實際設定之全域叢集選項的值，將自動使用預設值的所有叢集選項均會隱藏起來 (因為尚未設定任何值)。在此模式下，全域叢集選項只能使用個別的組態對話方塊來修改。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Hack 模式</term>
     <listitem>
      <para>
       其功能與進階模式相同。允許您新增包含特定規則的其他屬性集，以使組態更為動態。例如，您可以根據資源所在的節點讓資源擁有不同的例項屬性。此外，您還可以為中繼屬性集新增以時間為基準的規則，以決定屬性生效的時間。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    視窗的狀態列還會顯示目前處於使用中的模式。
   </para>
   <para>
    以下幾節將引導您完成設定叢集選項與資源時需要執行的主要任務，並介紹如何使用 Pacemaker GUI 管理資源。除非另有說明，逐步指示反映的是在簡單模式下執行的程序。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.ha.config.gui.global">
  <title>設定全域叢集選項</title>

  <para>
   全域叢集選項控制叢集在遇到特定情況時的運作方式。這些選項已分組，您可以透過 Pacemaker GUI 及 <command>crm</command> 外圍程序這些叢集管理工具對其進行檢視與修改。多數情況下，可以使用預先定義的值。但是，為了讓叢集的關鍵功能正常運作，還需要在執行基本叢集設定後調整以下參數：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.quorum" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.stonith" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <procedure id="pro.ha.config.gui.global">
   <title>修改全域叢集選項</title>
   <step performance="required">
    <para>
     啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<menuchoice><guimenu>檢視</guimenu><guimenu>簡單模式</guimenu></menuchoice>。
    </para>
   </step>
   <step performance="required">
    <para>
     在左側窗格中，選取<guimenu>CRM 組態</guimenu>以檢視全域叢集選項及其目前值。
    </para>
   </step>
   <step performance="required">
    <para>
     根據叢集要求，將<guimenu>無最低節點數規則</guimenu>設定為適當值。
    </para>
   </step>
   <step performance="required">
    <para>
     如果您出於某些原因需要停用圍籬區隔，請取消選取<guimenu>stonith-enabled</guimenu>。
    </para>
    <important>
     <title>沒有 STONITH 則不提供支援</title>
     <para>
      系統不支援未啟用 STONITH 的叢集。
     </para>
    </important>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>套用</guimenu>確認您的變更。
    </para>
   </step>
  </procedure>

  <para>
   您可以隨時切換回所有選項的預設值，只需在左側窗格中選取<guimenu>CRM 組態</guimenu>，然後按一下<guimenu>預設值</guimenu>。
  </para>
 </sect1>
<?dbfo-need height="20em"?>


 <sect1 id="sec.ha.config.gui.resources">
  <title>設定叢集資源</title>

  <para>
   做為叢集管理員，您需要為您叢集中的伺服器上執行的所有資源或應用程式建立叢集資源。叢集資源可包括網站、電子郵件伺服器、資料庫、檔案系統、虛擬機器，以及其他您希望使用者隨時都可以存取的伺服器型應用程式或服務。
  </para>

  <para>
   有關您可以建立之資源類型的綜覽，請參閱<xref linkend="sec.ha.config.basics.resources.types"/>。
  </para>

  <sect2 id="sec.ha.configuration.create">
   <title>建立簡單叢集資源</title>
   <para>
    若要建立最基本的資源類型，請執行下列步驟：
   </para>
   <procedure id="pro.ha.config.gui.primitives">
    <title>新增基本資源</title>
    <step id="st.ha.configuration.create.start" performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>資源</guimenu>並按一下<menuchoice><guimenu>新增</guimenu><guimenu>基本資源</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      在下一個對話方塊中，設定資源的以下參數：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        輸入資源的唯一 <guimenu>ID</guimenu>。
       </para>
      </step>
      <step id="step.ha.config.gui.primitives.start" performance="required">
       <para>
        在<guimenu>類別</guimenu>清單中，選取您要針對該資源使用的資源代辦類別：<guimenu>lsb</guimenu>、<guimenu>ocf</guimenu>、<guimenu>服務</guimenu> 或 <guimenu>stonith</guimenu>。如需詳細資訊，請參閱<xref linkend="sec.ha.config.basics.raclasses"/>。
       </para>
      </step>
      <step performance="required">
       <para>
        如果選取了<guimenu>ocf</guimenu>類別，還需要指定 OCF 資源代辦的<guimenu>提供者</guimenu>。OCF 規格允許多個廠商提供相同的資源代辦。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>類型</guimenu>清單中，選取要使用的資源代辦 (例如<guimenu>IPaddr</guimenu>或<guimenu>Filesystem</guimenu>)。此資源代辦的簡要描述會顯示在下方。
       </para>
       <para>
        <guimenu>類型</guimenu>清單中顯示的選項取決於您所選的<guimenu>類別</guimenu>(對於 OCF 資源，還取決於<guimenu>提供者</guimenu>)。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>選項</guimenu>下方，設定<guimenu>資源的初始狀態</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        若要讓叢集監控資源是否正常，請啟用<guimenu>新增監控操作</guimenu>。
       </para>
       <informalfigure>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="crmgui-primitive-basic.png" width="70%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="crmgui-primitive-basic.png" width="70%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      按<guimenu>下一步</guimenu>。下一個視窗會顯示您已為該資源定義的參數摘要。其中會列出該資源所需的所有<guimenu>例項屬性</guimenu>。您需要對它們進行編輯，以將其設定為適當的值。依您的部署與設定而定，您可能還需要新增其他屬性。如需如何執行此操作的詳細資料，請參閱<xref linkend="pro.ha.config.gui.parameters"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>套用</guimenu>以完成該資源的組態設定。組態對話方塊會關閉，同時主視窗會顯示新增的資源。
     </para>
    </step>
   </procedure>
   <para>
    建立資源期間或建立之後，可以為資源新增或修改以下參數：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <literal>例項屬性</literal> — 決定資源所控制的服務例項。若需更多資訊，請參閱<xref linkend="sec.ha.config.basics.inst.attr"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      <literal>中繼屬性</literal> — 告訴 CRM 如何處理特定資源。若需更多資訊，請參閱<xref linkend="sec.ha.config.basics.meta.attr"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      <literal>操作</literal> — 監控資源時需要用到。若需更多資訊，請參閱 <xref linkend="sec.ha.config.basics.operations"/>。
     </para>
    </listitem>
   </itemizedlist>
   <procedure id="pro.ha.config.gui.parameters">
    <title>新增或修改中繼屬性與例項屬性</title>
    <step performance="required">
     <para>
      在 Pacemaker GUI 主視窗中，按一下左側窗格中的<guimenu>資源</guimenu>，以檢視已為叢集設定的資源。
     </para>
    </step>
    <step performance="required">
     <para>
      在右側窗格中，選取要修改的資源，然後按一下<guimenu>編輯</guimenu>(或在該資源上連按兩下)。下一個視窗會顯示基本的資源參數，以及已為該資源定義的<guimenu>中繼屬性</guimenu>、<guimenu>例項屬性</guimenu>或<guimenu>操作</guimenu>。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="crmgui-primitive-attributes.png" width="50%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="crmgui-primitive-attributes.png" width="40%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step performance="required">
     <para>
      若要新增新的中繼屬性或例項屬性，請選取相應的索引標籤並按一下<guimenu>新增</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      選取要新增之屬性的<guimenu>名稱</guimenu>。一個簡要<guimenu>描述</guimenu>即會顯示。
     </para>
    </step>
    <step performance="required">
     <para>
      視需要指定屬性<guimenu>值</guimenu>。若不指定，系統將使用該屬性的預設值。
     </para>
    </step>
    <step performance="required">
     <para>
      按一下<guimenu>確定</guimenu>以確認所做的變更。索引標籤上隨即會顯示新增的或修改的屬性。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>確定</guimenu>以完成該資源的組態設定。組態對話方塊會關閉，同時主視窗會顯示修改的資源。
     </para>
    </step>
   </procedure>
   <tip>
    <title>資源的 XML 原始程式碼</title>
    <para>
     Pacemaker GUI 可讓您檢視透過定義的參數產生的 XML 片段。如果是個別資源，請在資源組態對話方塊的右上角選取<menuchoice><guimenu>顯示</guimenu><guimenu>XML 模式</guimenu></menuchoice>。
    </para>
    <para>
     若要存取所有已設定之資源的 XML 程式碼，請按一下左側窗格中的<guimenu>資源</guimenu>，然後在主視窗的右上角選取<menuchoice><guimenu>顯示</guimenu><guimenu>XML 模式</guimenu></menuchoice>。
    </para>
    <para>
     顯示 XML 程式碼的編輯器可讓您<guimenu>輸入</guimenu>或<guimenu>輸出</guimenu>XML 元素，或手動編輯 XML 程式碼。
    </para>
   </tip>
  </sect2>

  <sect2 id="sec.ha.configuration.stonith">
   <title>建立 STONITH 資源</title>
   <important>
    <title>沒有 STONITH 則不提供支援</title>
    <para>
     系統不支援未執行 STONITH 的叢集。
    </para>
   </important>
   <para>
    依預設，全域叢集選項 <literal>stonith-enabled</literal> 設定為 <literal>true</literal>：如果未定義 STONITH 資源，叢集將拒絕啟動任何資源。若要完成 STONITH 設定，您需要設定一或多個 STONITH 資源。儘管 STONITH 的設定與其他資源相似，但它們的行為在某些方面有所不同。如需詳細資料，請參閱<xref linkend="sec.ha.fencing.config"/>。
   </para>
   <procedure id="pro.ha.config.gui.stonith">
    <title>新增 STONITH 資源</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>資源</guimenu>並按一下<menuchoice><guimenu>新增</guimenu><guimenu>基本資源</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      在下一個對話方塊中，設定資源的以下參數：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        輸入資源的唯一 <guimenu>ID</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>類別</guimenu>清單中，選取資源代辦類別<guimenu>stonith</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        從<guimenu>類型</guimenu>清單中，選取用於控制 STONITH 裝置的 STONITH 外掛程式。此外掛程式的簡要描述會顯示在下方。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>選項</guimenu>下方，設定<guimenu>資源的初始狀態</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        若要讓叢集監控圍籬區隔裝置，請啟用<guimenu>新增監控操作</guimenu>。若需更多資訊，請參閱<xref linkend="sec.ha.fencing.monitor"/>。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      按<guimenu>下一步</guimenu>。下一個視窗會顯示您已為該資源定義的參數摘要。其中會列出選定 STONITH 外掛程式所需的所有<guimenu>例項屬性</guimenu>。您需要對它們進行編輯，以將其設定為適當的值。依您的部署與設定而定，您可能還需要新增其他屬性或監控操作。如需如何執行此操作的詳細資料，請參閱<xref linkend="pro.ha.config.gui.parameters"/> 與<xref linkend="sec.ha.configuration.monitor"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>套用</guimenu>以完成該資源的組態設定。組態對話方塊會關閉，同時主視窗會顯示新增的資源。
     </para>
    </step>
   </procedure>
   <para>
    若要完成圍籬區隔組態，請新增條件約束或使用複製品，或同時使用這兩種方式。如需詳細資訊，請參閱<xref linkend="cha.ha.fencing"/>。
   </para>
  </sect2>

  <sect2 id="sec.ha.config.gui.templates">
   <title>使用資源樣板</title>
   <para>
    如果您要建立多個具有相似組態的資源，定義資源樣板是最輕鬆的方法。定義資源樣板後，您可以在基本資源或某些類型的條件約束中參考該樣板：如需有關資源樣板功能和用法的詳細資訊，請參閱<xref linkend="sec.ha.config.basics.constraints.templates"/>。
   </para>
   <procedure id="pro.ha.config.gui.templates.create">
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>資源</guimenu>並按一下<menuchoice><guimenu>新增</guimenu><guimenu>樣板</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      為樣板輸入唯一的<guimenu>ID</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      像指定基本資源一樣指定資源樣板。請依照<xref linkend="pro.ha.config.gui.primitives" xrefstyle="select:label title nopage"/> 中的說明從<xref linkend="step.ha.config.gui.primitives.start" xrefstyle="select:label"/> 開始。
     </para>
    </step>
    <step performance="required">
     <para>
      根據需要設定了所有參數後，請按一下<guimenu>套用</guimenu>完成該資源樣板的組態設定。組態對話方塊會關閉，同時主視窗會顯示新增的資源樣板。
     </para>
    </step>
   </procedure>
   <procedure id="pro.ha.config.gui.templates.use">
    <title>參考資源樣板</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      若要在基本資源中參考新建的資源樣板，請執行以下步驟：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        在左側窗格中，選取<guimenu>資源</guimenu>並按一下<menuchoice><guimenu>新增</guimenu><guimenu>基本資源</guimenu></menuchoice>。
       </para>
      </step>
      <step performance="required">
       <para>
        輸入唯一的<guimenu>ID</guimenu>，並指定<guimenu>類別</guimenu>、<guimenu>提供者</guimenu>和<guimenu>類型</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        選取要參考的<guimenu>樣板</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        如果要設定從樣板衍生的特定例項屬性、操作或中繼屬性，請繼續依照<xref linkend="pro.ha.config.gui.primitives"/> 所述設定資源。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      若要在並存條件約束或順序條件約束中參考新建的資源樣板：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        分別依照<xref linkend="pro.ha.config.gui.constraints.collocation"/> 或<xref linkend="pro.ha.config.gui.constraints.order"/> 所述設定條件約束。
       </para>
      </step>
      <step performance="required">
       <para>
        對於並存條件約束，<guimenu>資源</guimenu>下拉式選單中會顯示已設定之所有資源及資源樣板的 ID。請從該清單中選取要參考的樣板。
       </para>
      </step>
      <step performance="required">
       <para>
        同樣，對於順序條件約束，<guimenu>首先</guimenu>和<guimenu>其次</guimenu>下拉式選單中會顯示資源和資源樣板。請從該清單中選取要參考的樣板。
       </para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.ha.configuration.constraints">
   <title>設定資源條件約束</title>
   <para>
    設定所有資源只是工作的一部分。即使叢集瞭解所有必需的資源，可能仍然無法正確地對其進行處理。資源條件約束可讓您指定資源可在哪些叢集節點上執行，載入資源的順序以及特定資源所依賴的其他資源。
   </para>
   <para>
    如需可用條件約束類型的綜覽，請參閱<xref linkend="sec.ha.config.basics.constraints.types"/>。定義條件約束時，還需要指定分數。如需叢集中分數及其含義的詳細資訊，請參閱<xref linkend="sec.ha.config.basics.constraints.scores"/>。
   </para>
   <para>
    下列程序將介紹如何建立不同類型的條件約束。
   </para>
<?dbfo-need height="20em"?>


   <procedure id="pro.ha.config.gui.constraints.location">
    <title>新增或修改位置條件約束</title>
    <step id="step.ha.configuration.constraints.start" performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在 Pacemaker GUI 主視窗中，按一下左側窗格中的<guimenu>條件約束</guimenu>，以檢視已為叢集設定的條件約束。
     </para>
    </step>
    <step id="step.ha.configuration.constraints.stop" performance="required">
     <para>
      在左側窗格中，選取<guimenu>條件約束</guimenu>，然後按一下<guimenu>新增</guimenu>。
     </para>

    </step>
    <step performance="required">
     <para>
      選取<guimenu>資源位置</guimenu>，然後按一下<guimenu>確定</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      輸入條件約束的唯一<guimenu>ID</guimenu>。在您修改現有的條件約束時，其 ID 已定義好，會顯示在組態對話方塊中。
     </para>
    </step>
    <step performance="required">
     <para>
      選取要對其定義條件約束的<guimenu>資源</guimenu>。清單會顯示已為叢集設定之所有資源的 ID。
     </para>
    </step>
    <step performance="required">
     <para>
      為條件約束設定<guimenu>分數</guimenu>。正值表示資源可以在您於下方指定的<guimenu>節點</guimenu>上執行。負值表示資源不應在該節點上執行。將分數設定為 <literal>INFINITY</literal> 會強制資源在該節點上執行。分數設定為 <literal>-INFINITY</literal> 表示資源不得在該節點上執行。
     </para>
    </step>
    <step performance="required">
     <para>
      為條件約束選取<guimenu>節點</guimenu>。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="crmgui-constraint-location.png" width="45%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="crmgui-constraint-location.png" width="45%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step performance="required">
     <para>
      
      若將<guimenu>節點</guimenu>與<guimenu>分數</guimenu>欄位留為空白，您也可以透過按一下<menuchoice><guimenu>新增</guimenu><guimenu>規則</guimenu></menuchoice>來新增規則。若要新增生命期間，只需按一下<menuchoice><guimenu>新增</guimenu><guimenu>生命期間</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>確定</guimenu>以完成該條件約束的組態設定。組態對話方塊會關閉，同時主視窗會顯示新增的或修改的條件約束。
     </para>
    </step>
   </procedure>
   <procedure id="pro.ha.config.gui.constraints.collocation">
    <title>新增或修改並存條件約束</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在 Pacemaker GUI 主視窗中，按一下左側窗格中的<guimenu>條件約束</guimenu>，以檢視已為叢集設定的條件約束。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>條件約束</guimenu>，然後按一下<guimenu>新增</guimenu>。
     </para>

    </step>
    <step performance="required">
     <para>
      選取<guimenu>資源並存</guimenu>，然後按一下<guimenu>確定</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      輸入條件約束的唯一<guimenu>ID</guimenu>。在您修改現有的條件約束時，其 ID 已定義好，會顯示在組態對話方塊中。
     </para>
    </step>
    <step performance="required">
     <para>
      選取做為並存來源的<guimenu>資源</guimenu>。清單會顯示已為叢集設定之所有資源和資源樣板的 ID。
     </para>
     <para>
      若無法符合條件約束的要求，叢集可能會決定不允許執行該資源。
     </para>
    </step>
    <step performance="required">
     <para>
      
      若將<guimenu>資源</guimenu>及<guimenu>與資源</guimenu>欄位留為空白，您也可以透過按一下<menuchoice><guimenu>新增</guimenu><guimenu>資源集</guimenu></menuchoice>來新增資源集。若要新增生命期間，只需按一下<menuchoice><guimenu>新增</guimenu><guimenu>生命期間</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      在<guimenu>與資源</guimenu>中，定義並存目標。叢集會先決定放置此資源的位置，然後決定放置<guimenu>資源</guimenu>欄位中之資源的位置。
     </para>
    </step>
    <step performance="required">
     <para>
      定義<guimenu>分數</guimenu>以決定兩個資源間的位置關係。正值表示資源應該在同一個節點上執行。負值表示資源不應該在同一個節點上執行。將分數設定為 <literal>INFINITY</literal> 會強制資源在同一節點上執行。分數設定為 <literal>-INFINITY</literal> 表示資源不得在同一節點上執行。該分數會結合其他因素來決定將資源配置於何處。
     </para>
    </step>
    <step performance="required">
     <para>
      如有需要，請指定其他參數，例如<guimenu>資源角色</guimenu>。
     </para>
     <para>
      根據所選的參數與選項，系統會顯示一條簡要<guimenu>描述</guimenu>，說明您目前所設定之並存條件約束的效果。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>確定</guimenu>以完成該條件約束的組態設定。組態對話方塊會關閉，同時主視窗會顯示新增的或修改的條件約束。
     </para>
    </step>
   </procedure>
   <procedure id="pro.ha.config.gui.constraints.order">
    <title>新增或修改順序條件約束</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在 Pacemaker GUI 主視窗中，按一下左側窗格中的<guimenu>條件約束</guimenu>，以檢視已為叢集設定的條件約束。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>條件約束</guimenu>，然後按一下<guimenu>新增</guimenu>。
     </para>

    </step>
    <step performance="required">
     <para>
      選取<guimenu>資源順序</guimenu>，然後按一下<guimenu>確定</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      輸入條件約束的唯一<guimenu>ID</guimenu>。在您修改現有的條件約束時，其 ID 已定義好，會顯示在組態對話方塊中。
     </para>
    </step>
    <step performance="required">
     <para>
      使用<guimenu>首先</guimenu>，定義<guimenu>接著</guimenu>所指定之資源允許啟動之前必須先啟動的資源。
     </para>
    </step>
    <step performance="required">
     <para>
      使用<guimenu>接著</guimenu>，定義在<guimenu>首先</guimenu>資源啟動之後將要啟動的資源。
     </para>
     <para>
      根據所選的參數與選項，系統會顯示一條簡要<guimenu>描述</guimenu>，說明要設定之順序條件約束的效果。
     </para>
    </step>
    <step performance="required">
     <para>
      視需要定義其他參數，例如：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        指定<guimenu>分數</guimenu>。若大於零，則條件約束為強制性；否則僅做為建議。預設值為 <literal>INFINITY</literal>。
       </para>
      </step>
      <step performance="required">
       <para>
        指定<guimenu>對稱式</guimenu>的值。若為 <literal>true</literal>，則停止資源時使用相反順序。預設值為 <literal>true</literal>。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>確定</guimenu>以完成該條件約束的組態設定。組態對話方塊會關閉，同時主視窗會顯示新增的或修改的條件約束。
     </para>
    </step>
   </procedure>
   <para>
    您可在 Pacemaker GUI 的<guimenu>條件約束</guimenu>檢視窗中存取和修改已設定的所有條件約束。
   </para>
   <figure>
    <title>Pacemaker GUI - 條件約束</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="crmgui-main-constraints.png" width="68%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="crmgui-main-constraints.png" width="68%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec.ha.configuration.failover">
   <title>指定資源容錯移轉節點</title>
   <para>
    若資源失敗，系統會自動將其重新啟動。若在目前節點上無法將其重新啟動，或資源已在目前節點上失敗 N 次，則資源會嘗試容錯移轉至其他節點。您可以定義一個數值，讓資源在失敗該次數 (<literal>migration-threshold</literal>) 之後移轉至新節點。若叢集中有兩個以上的節點，則特定資源容錯移轉所至的節點由 High Availability 軟體來選擇。
   </para>
   <para>
    不過，您可以執行以下步驟來指定資源將容錯移轉所至的節點：
   </para>
   <procedure id="pro.ha.config.gui.failover">
    <step performance="required">
     <para>
      依<xref linkend="pro.ha.config.gui.constraints.location"/> 中所述為該資源設定位置條件約束。
     </para>
    </step>
    <step performance="required">
     <para>
      依<xref linkend="pro.ha.config.gui.parameters"/> 中所述將 <literal>migration-threshold</literal> 中繼屬性新增至該資源，並為該 migration-threshold 輸入<guimenu>值</guimenu>。該值應該為小於 INFINITY 的正數。
     </para>

    </step>
    <step performance="required">
     <para>
      若要讓資源的 failcount 自動過期，請依<xref linkend="pro.ha.config.gui.parameters"/> 中所述將 <literal>failure-timeout</literal> 中繼屬性新增至該資源，並為該 failure-timeout 輸入<guimenu>值</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      若要指定具有資源優先設定的其他容錯移轉節點，請建立其他位置條件約束。
     </para>
    </step>
   </procedure>
   <para>
    <xref linkend="ex.ha.config.basics.failover"/> 中提供了一個範例，介紹叢集中有關移轉限定值和 failcount 的程序流。
   </para>
   <para>
    您也可以隨時手動清理資源的 failcount，而不是等待資源的 failcount 自動過期。如需詳細資料，請參閱<xref linkend="sec.ha.configuration.cleanup"/>。
   </para>
  </sect2>

  <sect2 id="sec.ha.configuration.failback">
   <title>指定資源錯誤回復節點 (資源粘性)</title>
   <para>
    當原始節點恢復連接且位於叢集中時，資源可以錯誤回復至該節點。若不想讓資源錯誤回復至其在容錯移轉之前所處的節點，或要為資源指定另一個要錯誤回復至的節點，您必須變更其資源粘性的值。您可以在建立資源時或建立之後指定資源粘性。
   </para>
   <para>
    有關不同資源粘性值的含義，請閱<xref linkend="sec.ha.config.basics.failback"/>。
   </para>
<?dbfo-need height="20em"?>


   <procedure id="pro.ha.config.gui.stickiness">
    <title>指定資源粘性</title>
    <step performance="required">
     <para>
      依<xref linkend="pro.ha.config.gui.parameters"/> 中所述將 <literal>resource-stickiness</literal> 中繼屬性新增至資源。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="crmgui-primitive-stickiness.png" width="55%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="crmgui-primitive-stickiness.png" width="55%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step performance="required">
     <para>
      對於 resource-stickiness 的<guimenu>值</guimenu>，請指定介於 <literal>-INFINITY</literal> 與 <literal>INFINITY</literal> 之間的值。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.ha.configuration.utilization">
   <title>根據負載影響設定資源的配置</title>
   <para>
    並非所有資源都相同。有些資源 (例如 Xen 客體作業系統) 要求代管它們的節點滿足其容量要求。如果放置資源後其所需的容量之和超過了提供的容量，資源效能便會下降 (甚至無法執行)。
   </para>
   <para>
    鑒於此，High Availability Extension 允許您指定以下參數：
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      特定節點<emphasis>提供</emphasis>的容量。
     </para>
    </listitem>
    <listitem>
     <para>
      特定資源<emphasis>要求</emphasis>的容量。
     </para>
    </listitem>
    <listitem>
     <para>
      配置資源的整體策略。
     </para>
    </listitem>
   </orderedlist>
   <para>
    使用率屬性用於設定資源的要求以及節點提供的容量。High Availability Extension 現在還提供了用於自動偵測和設定節點容量及資源要求的方法。如需詳細資料及組態範例，請參閱<xref linkend="sec.ha.config.basics.utilization"/>。
   </para>
   <para>
    若要手動設定資源的要求和節點提供的容量，請依<xref linkend="pro.ha.config.gui.capacity"/> 所述繼續。您可以依據自己的偏好命名使用率屬性，依據組態需要定義任意數量的名稱/值對。
   </para>
   <procedure id="pro.ha.config.gui.capacity">
    <title>新增或修改使用率屬性</title>
    <para>
     在以下範例中，假設您已擁有叢集節點和資源的基本組態，現在還想要設定特定節點提供的容量和特定資源需要的容量。新增各使用率屬性的程序基本相同，只有在執行<xref linkend="step.ha.config.gui.capacity.node"/> 和<xref linkend="step.ha.config.gui.capacity.resource"/> 時有些不同。
    </para>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step id="step.ha.config.gui.capacity.node" performance="required">
     <para>
      若要指定節點<emphasis>提供</emphasis>的容量：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        在左側窗格中，按一下<guimenu>節點</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        在右側窗格中，選取要設定其容量的節點，然後按一下<guimenu>編輯</guimenu>。
       </para>
      </step>
     </substeps>
    </step>
    <step id="step.ha.config.gui.capacity.resource" performance="required">
     <para>
      若要指定資源<emphasis>需要</emphasis>的容量：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        在左側窗格中，按一下<guimenu>資源</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        在右側窗格中，選取要設定其容量的資源，然後按一下<guimenu>編輯</guimenu>。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      選取<guimenu>使用率</guimenu>索引標籤，然後按一下<guimenu>新增</guimenu>以新增使用率屬性。
     </para>
    </step>
    <step id="step.ha.config.gui.capacity.attr.name" performance="required">
     <para>
      輸入新屬性的<guimenu>名稱</guimenu>。您可以根據自己的偏好命名使用率屬性。
     </para>
    </step>
    <step id="step.ha.config.gui.capacity.attr.value" performance="required">
     <para>
      輸入屬性的<guimenu>值</guimenu>，然後按一下<guimenu>確定</guimenu>。屬性值必須為整數。
     </para>
    </step>
    <step performance="required">
     <para>
      如果需要更多使用率屬性，請重複<xref linkend="step.ha.config.gui.capacity.attr.name"/> 至<xref linkend="step.ha.config.gui.capacity.attr.value"/>。
     </para>
     <para>
      <guimenu>使用率</guimenu>索引標籤顯示您已為該節點或資源定義的使用率屬性摘要。
     </para>
    </step>
    <step performance="required">
     <para>
      如果按需要設定了所有參數，請按一下<guimenu>確定</guimenu>關閉組態對話方塊。
     </para>
    </step>
   </procedure>
   <para>
    <xref linkend="fig.ha.config.gui.capacit.node"/> 顯示了一個節點的組態，該節點為其上執行的資源提供 8 個 CPU 和 16 GB 記憶體：
   </para>
   <figure id="fig.ha.config.gui.capacit.node">
    <title>節點容量的範例組態</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="crmgui-node-utilization.png" width="45%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="crmgui-node-utilization.png" width="45%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    其上一個資源需要 4096 KB 記憶體和 4 個 CPU 的節點的範例組態如下所示：
   </para>
   <figure id="fig.ha.config.gui.capacit.resource">
    <title>資源容量的範例組態</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="crmgui-resource-utilization.png" width="85%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="crmgui-resource-utilization.png" width="55%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    (手動或自動) 設定完節點提供的容量和資源需要的容量後，須在全域叢集選項中設定配置策略，否則容量組態不會生效。可以使用幾個策略來排程負載：例如，您可將負載集中於最少的節點上，或在所有可用的節點上平均分攤。若需更多資訊，請參閱<xref linkend="sec.ha.config.basics.utilization"/>。
   </para>
   <procedure id="pro.ha.config.gui.placement">
    <title>設定配置策略</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      選取<menuchoice><guimenu>檢視</guimenu><guimenu>簡單模式</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>CRM 組態</guimenu>以檢視全域叢集選項及其目前值。
     </para>
    </step>
    <step performance="required">
     <para>
      根據要求將<guimenu>配置策略</guimenu>設定為適當的值。
     </para>
    </step>
    <step performance="required">
     <para>
      如果因某些原因需要停用圍籬區隔，請取消選取「<literal>已啟用 STONITH</literal>」。
     </para>
    </step>
    <step performance="required">
     <para>
      按一下<guimenu>套用</guimenu>確認您的變更。
     </para>
    </step>
   </procedure>
  </sect2>

<?dbfo-need height="20em"?>



  <sect2 id="sec.ha.configuration.monitor">
   <title>設定資源監控</title>
   <para>
    High Availability Extension 不僅可以偵測節點故障，還可以偵測節點上個別資源發生故障的時間。若要確定資源是否正在執行，必須設定針對該資源的資源監控。資源監控包括指定逾時與/或啟動延遲值以及間隔。該間隔會告知 CRM 應檢查資源狀態的頻率。您還可以設定特定參數，例如為 <literal>start</literal> 或 <literal>stop</literal> 操作設定 <literal>Timeout</literal>。
   </para>
   <procedure id="pro.ha.config.gui.operations">
    <title>新增或修改監控操作</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在 Pacemaker GUI 主視窗中，按一下左側窗格中的<guimenu>資源</guimenu>，以檢視已為叢集設定的資源。
     </para>
    </step>
    <step performance="required">
     <para>
      在右側窗格中，選取要修改的資源，然後按一下<guimenu>編輯</guimenu>。下一個視窗會顯示基本的資源參數，以及已為該資源定義的中繼屬性、例項屬性及操作。
     </para>
    </step>
    <step performance="required">
     <para>
      若要新增新的監控操作，請選取相應的索引標籤，然後按一下<guimenu>新增</guimenu>。
     </para>
     <para>
      若要修改現有操作，請選取相應的項目，然後按一下<guimenu>編輯</guimenu>。
     </para>
    </step>


    <step performance="required">
     <para>
      在<guimenu>名稱</guimenu>中，選取要執行的動作，例如「<literal>監控</literal>」、「<literal>啟動</literal>」，或<guimenu>停止</guimenu>。
     </para>
     <para>
      下面顯示的參數視此處所作的選擇而定。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="crmgui-primitive-monitor.png" width="35%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="crmgui-primitive-monitor.png" width="35%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step performance="required">
     <para>
      在<guimenu>逾時</guimenu>欄位中輸入值 (以秒計)。操作在經過指定的逾時期間之後會被視為 <literal>failed</literal>。PE 將會決定需要採取的措施，或執行您在監控操作的<guimenu>失敗時</guimenu>欄位中指定的動作。
     </para>
    </step>
    <step performance="required">
     <para>
      視需要展開<guimenu>選擇性</guimenu>區段，然後新增參數，例如<guimenu>失敗時</guimenu>(此動作失敗時應採取何措施？) 或<guimenu>必要</guimenu>(執行此動作之前需要符合哪些條件？)。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>確定</guimenu>以完成該資源的組態設定。組態對話方塊會關閉，同時主視窗會顯示修改的資源。
     </para>
    </step>
   </procedure>
   <para>
    有關資源監控偵測到失敗時應執行的程序，請參閱<xref linkend="sec.ha.config.basics.monitoring"/>。
   </para>
   <para>
    若要在 Pacemaker GUI 中檢視資源故障，請在左側窗格中按一下<guimenu>管理</guimenu>，然後在右側窗格中選取要檢視其詳細資料的資源。對於失敗的資源，右側窗格的中間 (位於<guimenu>移轉限定值</guimenu>項目下方) 會顯示資源<guimenu>失敗計數</guimenu>和上次失敗時間。
   </para>
   <figure>
    <title>檢視資源的 failcount</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="crmgui-mgmt-failcount.png" width="80%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="crmgui-mgmt-failcount.png" width="55%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec.ha.configuration.group">
   <title>設定叢集資源群組</title>
   <para>
    某些叢集資源依賴於其他元件或資源，要求每個元件或資源以特定順序啟動，並在同一個伺服器上執行。若要簡化此組態，您可以使用群組。
   </para>
   <para>
    如需資源群組的範例和群組及其內容的詳細資訊，請參閱<xref linkend="sec.ha.config.basics.resources.advanced.groups"/>。
   </para>
   <note>
    <title>空群組</title>
    <para>
     群組至少須包含一個資源，否則組態視為無效。
    </para>
   </note>
   <procedure id="pro.ha.config.gui.group">
    <title>新增資源群組</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>資源</guimenu>並按一下<menuchoice><guimenu>新增</guimenu><guimenu>群組</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      輸入群組的唯一<guimenu>ID</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在<guimenu>選項</guimenu>下方，設定<guimenu>資源的初始狀態</guimenu>，然後按<guimenu>下一步</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在下一步中，您可以將基本資源新增為群組的子資源。建立這些資源的方式與<xref linkend="pro.ha.config.gui.primitives"/> 中所述方式類似。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>套用</guimenu>以完成該基本資源的組態設定。
     </para>
    </step>
    <step performance="required">
     <para>
      在下一個視窗中，您可以再次選擇<guimenu>基本資源</guimenu>並按一下<guimenu>確定</guimenu>，繼續為群組新增子資源。
     </para>
     <para>
      如果不想為群組新增更多基本資源，請按一下<guimenu>取消</guimenu>。下一個視窗會顯示已為該群組定義的參數摘要。其中會列出群組的<guimenu>中繼屬性</guimenu>與<guimenu>基本資源</guimenu>。<guimenu>基本資源</guimenu>索引標籤中資源的位置表示該資源在叢集中的啟動順序。
     </para>
    </step>
    <step performance="required">
     <para>
      由於群組中資源的順序很重要，因此請使用<guimenu>向上</guimenu>與<guimenu>向下</guimenu>按鈕，對群組中的<guimenu>基本資源</guimenu>進行排序。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要設定了所有參數後，請按一下<guimenu>確定</guimenu>以完成該群組的組態設定。組態對話方塊會關閉，同時主視窗會顯示新建的或修改的群組。
     </para>
    </step>
   </procedure>
   <figure>
    <title>Pacemaker GUI - 群組</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="crmgui-main-groups.png" width="80%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="crmgui-main-groups.png" width="65%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    假設您已依照<xref linkend="pro.ha.config.gui.group"/> 中的說明建立資源群組。以下程序描述如何修改群組以符合<xref linkend="ex.ha.config.resource.group"/>。
   </para>
<?dbfo-need height="20em"?>


   <procedure id="pro.ha.config.gui.group.modify">
    <title>將資源新增至現存群組</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，切換至<guimenu>資源</guimenu>檢視窗，然後在右側窗格中選取要修改的群組，並按一下<guimenu>編輯</guimenu>。下一個視窗會顯示基本的群組參數，以及已為該資源定義的中繼屬性與基本資源。
     </para>
    </step>
    <step performance="required">
     <para>
      按一下<guimenu>基本資源</guimenu>索引標籤，然後按一下<guimenu>新增</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在下一個對話方塊中，設定以下參數以將 IP 位址新增為群組的子資源：
     </para>
     <substeps performance="required">
      <step id="step.ha.config.gui.group.prim.start" performance="required">
       <para>
        輸入唯一的<guimenu>ID</guimenu>，例如 <literal>my_ipaddress</literal>。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>類別</guimenu>清單中，選取<guimenu>ocf</guimenu>做為資源代辦類別。
       </para>
      </step>
      <step performance="required">
       <para>
        對於 OCF 資源代辦的<guimenu>提供者</guimenu>，選取<guimenu>heartbeat</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>類型</guimenu>清單中，選取<guimenu>IPaddr</guimenu>做為資源代辦。
       </para>
      </step>
      <step performance="required">
       <para>
        按<guimenu>下一步</guimenu>。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>例項屬性</guimenu>索引標籤中，選取<guimenu>IP</guimenu>項目並按一下<guimenu>編輯</guimenu>(或在<guimenu>IP</guimenu>項目上連按兩下)。
       </para>
      </step>
      <step performance="required">
       <para>
        在<guimenu>值</guimenu>中輸入所需的 IP 位址，例如 <literal>192.168.1.180</literal>。
       </para>
      </step>
      <step id="step.ha.config.gui.group.prim.stop" performance="required">
       <para>
        按一下<guimenu>確定</guimenu>與<guimenu>套用</guimenu>。群組組態對話方塊會顯示新增的基本資源。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      再按一下<guimenu>新增</guimenu>以新增下一個子資源 (檔案系統與 Web 伺服器)。
     </para>
    </step>
    <step performance="required">
     <para>
      為每個子資源設定相應的參數 (類似於步驟<xref linkend="step.ha.config.gui.group.prim.start"/> 至<xref linkend="step.ha.config.gui.group.prim.stop"/>)，直到您已設定此群組的所有子資源。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="crmgui-resource-group.png" width="50%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="crmgui-resource-group.png" width="45%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <para>
      由於我們是依照子資源在叢集中的啟動順序對其進行設定，因此<guimenu>基本資源</guimenu>索引標籤中的順序已經是正確的。
     </para>
    </step>
    <step performance="required">
     <para>
      若需要變更群組的資源順序，請使用<guimenu>向上</guimenu>與<guimenu>向下</guimenu>按鈕對<guimenu>基本資源</guimenu>索引標籤中的資源進行排序。
     </para>
    </step>
    <step performance="required">
     <para>
      若要從群組中移除某個資源，請在<guimenu>基本資源</guimenu>索引標籤中選取該資源，然後按一下<guimenu>移除</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      按一下<guimenu>確定</guimenu>以完成該群組的組態設定。組態對話方塊會關閉，同時主視窗會顯示修改的群組。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.ha.configuration.clone">
   <title>設定複製品資源</title>
   <para>
    您可能要讓某些資源同時在叢集的多個節點上執行。若要實現此目的，您必須將資源設定為複製品。STONITH 及叢集檔案系統 (如 OCFS2) 這些資源便可以設定為複製品。您可以複製所提供的任何資源。相關資源的資源代辦會為此操作提供支援。您甚至可以對複製品資源進行不同的設定，具體視代管它們的節點而定。
   </para>
   <para>
    如需可用複製品的綜覽，請參閱<xref linkend="sec.ha.config.basics.resources.advanced.clones"/>。
   </para>
   <procedure id="pro.ha.config.gui.clone">
    <title>新增或修改複製品</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，選取<guimenu>資源</guimenu>並按一下<menuchoice><guimenu>新增</guimenu><guimenu>複製</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      輸入複製品的唯一<guimenu>ID</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在<guimenu>選項</guimenu>下方，設定<guimenu>資源的初始狀態</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      啟用要為複製設定的相應選項，然後按<guimenu>下一步</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在下一步中，您可以新增<guimenu>基本資源</guimenu>或<guimenu>群組</guimenu>做為複製品的子資源。建立這些資源的方式與<xref linkend="pro.ha.config.gui.primitives"/> 或<xref linkend="pro.ha.config.gui.group"/> 中所述方式類似。
     </para>
    </step>
    <step performance="required">
     <para>
      按需要在複製品組態對話方塊中設定了所有參數後，請按一下<guimenu>套用</guimenu>以完成該複製品的組態設定。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sec.ha.config.gui.manage">
  <title>管理叢集資源</title>

  <para>
   除了能夠設定叢集資源外，Pacemaker GUI 還可讓您管理現存資源。若要切換至管理檢視窗並存取可用選項，請在左側窗格中按一下<guimenu>管理</guimenu>。
  </para>

  <figure>
   <title>Pacemaker GUI - 管理</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="crmgui-main-manage.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="crmgui-main-manage.png" width="65%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 id="sec.ha.configuration.start">
   <title>啟動資源</title>
   <para>
    啟動叢集資源之前，請先確定該資源已正確設定。例如，如果想要使用 Apache 伺服器做為叢集資源，請先設定 Apache 伺服器並完成 Apache 組態設定，然後在叢集中啟動各個資源。
   </para>
   <note>
    <title>不要對叢集管理的服務執行任何操作</title>
    <para>
     當您正透過 High Availability Extension 管理某個資源時，就不能再啟動或停止該資源 (例如，不能在叢集之外手動啟動或停止，或者在開機或重新開機時啟動或停止)。High Availability Extension 軟體負責所有服務的啟動或停止動作。
    </para>
    <para>
     不過，如果您要檢查服務是否正確設定，請手動將其啟動，但務必在 High Availability 接管之前將它再次停止。
    </para>
    <para>
     若要對目前由叢集管理的資源進行管理，請先依<xref linkend="sec.ha.configuration.mgmt.mode"/> 中所述將資源設定為<literal>不受管理模式</literal>。
    </para>
   </note>
   <para>
    在使用 Pacemaker GUI 建立資源的過程中，您可以使用 <literal>target-role</literal> 中繼屬性設定資源的初始狀態。若將其值設定為 <literal>stopped</literal>，則資源建立後不會自動啟動。
   </para>
   <procedure id="pro.ha.config.gui.start">
    <title>啟動新資源</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，按一下<guimenu>管理</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在右側窗格中的資源上按一下滑鼠右鍵，然後從快顯功能表中選取<guimenu>啟動</guimenu>(或使用工具列中的<guimenu>啟動資源</guimenu>圖示)。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.ha.configuration.cleanup">
   <title>清理資源</title>
   <para>
    若資源失敗，系統會自動將其重新啟動，但每次失敗都會增加資源的 failcount。您可以使用 Pacemaker GUI 檢視某個資源的失敗計數，只需在左側窗格中按一下<guimenu>管理</guimenu>，然後在右側窗格中選取該資源。如果資源失敗，右側窗格的中間 (位於<guimenu>移轉限定值</guimenu>項目下方) 會顯示其<guimenu>失敗計數</guimenu>。
   </para>
   <para>
    如果已對該資源設定 <literal>migration-threshold</literal>，則一旦失敗次數達到該移轉限定值，就不再允許該節點執行該資源。
   </para>
   <para>
    資源的 failcount 可自動重設 (若為資源設定 <literal>failure-timeout</literal> 選項)，也可按如下方式手動重設。
   </para>
   <procedure id="pro.ha.config.gui.clean">
    <title>清理資源</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，按一下<guimenu>管理</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在右側窗格中的相應資源上按一下滑鼠右鍵，然後從快顯功能表中選取<guimenu>清理資源</guimenu>(或使用工具列中的<guimenu>清理資源</guimenu>圖示)。
     </para>
     <para>
      如此會對指定節點上的指定資源執行指令 <command>crm_resource <option>-C</option></command> 與 <command>crm_failcount <option>-D</option></command>。
     </para>
    </step>
   </procedure>
   <para>
    如需詳細資訊，請參閱 <command>crm_resource</command> 與 <command>crm_failcount</command> 的 man 頁面。
   </para>
  </sect2>

  <sect2 id="sec.ha.configuration.remove">
   <title>移除叢集資源</title>
   <para>
    如果需要從叢集移除資源，請按照下面的程序操作，以免出現組態錯誤：
   </para>

   <note>
    <title>移除參考資源</title>
    <para>
     若有條件約束正在參考叢集資源的 ID，則不能移除叢集資源。若無法刪除某個資源，請檢查參考該資源 ID 的位置，先從條件約束中移除該資源。
    </para>
   </note>
   <procedure id="pro.ha.config.gui.rm">
    <title>移除叢集資源</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，按一下<guimenu>管理</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      選取右側窗格中的相應資源。
     </para>
    </step>
    <step performance="required">
     <para>
      依照<xref linkend="pro.ha.config.gui.clean"/> 中的說明在所有節點上清理該資源。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>停止</guimenu>資源。
     </para>
    </step>
    <step performance="required">
     <para>
      移除與該資源相關的所有條件約束，否則將無法移除資源。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.ha.configuration.migrate">
   <title>移轉叢集資源</title>
   <para>
    如<xref linkend="sec.ha.configuration.failover"/> 所述，當軟體或硬體發生故障時，叢集會自動對資源進行容錯移轉 (移轉)，具體情況視您可以定義的特定參數 (例如移轉限定值或資源粘性) 而定。除此之外，您也可以手動將資源移轉至叢集中的其他節點。
   </para>
   <procedure id="pro.ha.config.gui.migrate">
    <title>手動移轉資源</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，按一下<guimenu>管理</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在右側窗格中的相應資源上按一下滑鼠右鍵，然後選取<guimenu>移轉資源</guimenu>。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="crmgui-main-migrate.png" width="70%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="crmgui-main-migrate.png" width="70%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step performance="required">
     <para>
      在新視窗中，在<guimenu>至節點</guimenu>中選取要將資源移至的節點。如此會建立一個位置條件約束，其目的節點的分數為 <literal>INFINITY</literal>。
     </para>
    </step>
    <step performance="required">
     <para>
      若只想暫時移轉資源，請啟用<guimenu>持續時間</guimenu>，並輸入資源移轉至新節點後應保留的時間。經過這段持續時間之後，資源<emphasis>可以</emphasis>移回其原始位置，也可以保留在目前的位置 (具體取決於資源粘性)。
     </para>
    </step>
    <step performance="required">
     <para>
      如果資源無法移轉 (若資源粘性及條件約束的總分大於目前節點上的 <literal>INFINITY</literal>)，請啟用<guimenu>強制</guimenu>選項。如此會為目前位置建立規則以及一個 <literal>-INFINITY</literal> 分數，以強制資源移動。
     </para>
     <note>
      <para>
       這樣會禁止資源在此節點上執行，直到使用<guimenu>清除移轉條件約束</guimenu>移除條件約束或持續時間過期為止。
      </para>
     </note>
    </step>
    <step performance="required">
     <para>
      按一下<guimenu>確定</guimenu>以確認移轉。
     </para>
    </step>
   </procedure>
   <para>
    若要讓資源回到原來的狀態，請執行下列步驟：
   </para>
   <procedure id="pro.ha.config.gui.migrate.back">
    <title>清除移轉條件約束</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，按一下<guimenu>管理</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在右側窗格中的相應資源上按一下滑鼠右鍵，然後選取<guimenu>清除移轉條件約束</guimenu>。
     </para>
     <para>
      此過程會使用 <command>crm_resource <option>-U</option></command> 指令。資源<emphasis>可以</emphasis>移回其原始位置，也可以保留在目前的位置 (具體取決於資源粘性)。
     </para>
    </step>
   </procedure>
   <para>
    如需詳細資訊，請參閱 <command>crm_resource</command> 的 man 頁面或 <ulink url="http://www.clusterlabs.org/doc/"/> 上的《<citetitle>Pacemaker Explained</citetitle>》(Pacemaker 說明)。可參閱其中的「Resource Migration」(資源移轉) 一節。<citetitle/>
   </para>
  </sect2>

  <sect2 id="sec.ha.configuration.mgmt.mode">
   <title>變更資源的管理模式</title>
   <para>
    資源由叢集管理時，不能對其進行變更 (在叢集外部)。若要維護個別資源，可將相應資源設定成 <literal>不受管理模式</literal>，這樣您便可在叢集外部修改資源。
   </para>
   <procedure>
    <title>變更資源的管理模式</title>
    <step performance="required">
     <para>
      啟動 Pacemaker GUI，並依照<xref linkend="sec.ha.configuration.gui.intro.connect"/> 所述登入叢集。
     </para>
    </step>
    <step performance="required">
     <para>
      在左側窗格中，按一下<guimenu>管理</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      在右側窗格中的相應資源上按一下滑鼠右鍵，然後從快顯功能表中選取<guimenu>不管理資源</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      完成該資源的維護任務之後，在右側窗格中的相應資源上再按一下滑鼠右鍵，然後選取<guimenu>管理資源</guimenu>。
     </para>
     <para>
      從此時起，資源將重新由 High Availability Extension 軟體管理。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
</chapter>
