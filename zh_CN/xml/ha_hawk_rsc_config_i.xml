<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect1>
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="ha_hawk_rsc_config_i.xml" xml:id="sec-ha-config-hawk-rsc">
 <title>配置群集资源</title>

 <para>
  作为群集管理员，您需要在群集中为服务器上运行的每个资源或应用程序创建群集资源。群集资源可包括网站、邮件服务器、数据库、文件系统、虚拟机和任何其他基于服务器的应用程序或对用户随时都可用的服务。
 </para>

 <para>
  有关可创建的资源类型的概述，请参见<xref linkend="sec-ha-config-basics-resources-types"/>。除了指定资源的基本属性（ID、类、提供程序和类型）外，还可以在创建资源过程中或之后添加或修改以下参数：
 </para>

 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    <literal>Instance attributes (parameters)</literal> 确定资源控制的服务实例。有关更多信息，请参见<xref linkend="sec-ha-config-basics-inst-attr"/>。
   </para>
   <para>
    创建资源时，Hawk 会自动显示所有必要的参数。对这些参数进行编辑，以便拥有有效的资源配置。
   </para>
  </listitem>
  <listitem>
   <para>
    <literal>Meta attributes</literal> 告知 CRM 如何处理特定资源。有关更多信息，请参见<xref linkend="sec-ha-config-basics-meta-attr"/>。
   </para>
   <para>
    创建资源时，Hawk 会自动列出该资源的重要元属性，例如，定义资源初始状态的 <literal>target-role</literal> 属性。默认情况下，该属性设置为 <literal>Stopped</literal>，因此资源不会立即启动。
   </para>
  </listitem>
  <listitem>
   <para>
    <literal>Operations</literal> 是资源监视所需的。有关更多信息，请参见<xref linkend="sec-ha-config-basics-operations"/>。
   </para>
   <para>
    创建资源时，Hawk 会显示最重要的资源操作（<literal>monitor</literal>、<literal>start</literal> 和 <literal>stop</literal>）。
   </para>
  </listitem>
 </itemizedlist>





 <section xml:id="sec-ha-config-hawk-wizard">
  <title>使用设置向导配置资源</title>
  <para>
   High Availability Extension 针对一些常用的群集方案（例如，设置高度可用的 NFS 服务器）随附了一组预定义的模板。可在 <systemitem class="resource">hawk-templates</systemitem> 包中找到这些预定义的模板。您也可以自行定义向导模板。有关详细信息，请参见 <link xlink:href="https://github.com/ClusterLabs/hawk/blob/master/doc/wizard.txt"/>。
  </para>
  <procedure xml:id="pro-ha-config-hawk-wizard">
   <title>使用设置向导</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>设置向导</guimenu>。<guimenu>群集设置向导</guimenu>将列出可用的资源模板。如果单击其中一项，Hawk 将显示有关该模板的简短帮助文本。
    </para>
   </step>
   <step>
    <para>
     选择要配置的资源集并单击<guimenu>下一步</guimenu>。
    </para>
   </step>
   <step>
    <para>
     按照屏幕指导执行操作。如果需要有关某个选项的信息，在 Hawk 中单击它即可显示简短帮助文本。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk - 设置向导</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-wizard.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-wizard.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </section>

 <section xml:id="sec-ha-config-hawk-primitives">
  <title>创建简单群集资源</title>
  <para>
   要创建最基本类型的资源，请执行以下操作：
  </para>
  <procedure xml:id="pro-ha-config-hawk-primitives">
   <title>添加原始资源</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>资源</guimenu>。 <guimenu>资源</guimenu>屏幕显示所有类型的资源的类别。它列出已定义的所有资源。
    </para>
   </step>
   <step>
    <para>
     选择<guimenu>原始</guimenu>类别，单击加号图标。
    </para>
   </step>
   <step>
    <para>
     指定资源：
    </para>
    <substeps performance="required">
     <step>
      <para>
       输入唯一的<guimenu>资源 ID</guimenu>。
      </para>
     </step>
     <step xml:id="step-ha-config-hawk-primitives-start">
      <para>
       从<guimenu>类</guimenu>列表，选择要用于该资源的资源代理类：<guimenu>lsb</guimenu>、<guimenu>ocf</guimenu>、<guimenu>service</guimenu> 或 <guimenu>stonith</guimenu>。有关详细信息，请参见<xref linkend="sec-ha-config-basics-raclasses"/>。
      </para>
     </step>
     <step>
      <para>
       如果选择了 <guimenu>ocf</guimenu> 作为类，则指定 OCF 资源代理的<guimenu>提供程序</guimenu>。OCF 规范允许多个供应商供应相同的资源代理。
      </para>
     </step>
     <step>
      <para>
       从 <guimenu>Type</guimenu>（类型）列表中，选择要使用的资源代理（例如 <guimenu>IPaddr</guimenu> 或 <guimenu>Filesystem</guimenu>）。将显示该资源代理的简短描述。
      </para>
      <para>
       <guimenu>类型</guimenu>列表中提供的选项取决于您选择的<guimenu>类</guimenu>（对于 OCF 资源还取决于<guimenu>提供程序</guimenu>中选择的内容）。
      </para>
     </step>
    </substeps>
   </step>
   <step xml:id="step-ha-config-hawk-parameters">
    <para>
     Hawk 会自动显示资源的所有必需参数，以及您可以用于指定其他参数的空下拉列表。
    </para>
    <para>
     定义资源的<guimenu>参数</guimenu>（实例属性）：
    </para>
    <substeps performance="required">
     <step>
      <para>
       请为每个必需参数输入值。单击参数旁边的文本框，会显示简短帮助文本。
      </para>
     </step>
     <step>
      <para>
       要完全删除参数，请单击参数旁边的减号图标。
      </para>
     </step>
     <step>
      <para>
       要添加另一个参数，请单击空下拉列表，选择一个参数，并输入参数值。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Hawk 会自动显示最重要的资源<guimenu>操作</guimenu>并建议默认值。如果在此处不修改任何设置，Hawk 会在您确认更改后立即添加建议的操作及其默认值。
    </para>
    <para>
     有关如何修改、添加或删除操作的细节，请参见<xref linkend="pro-ha-config-hawk-operations"/>。
    </para>
   </step>
   <step xml:id="step-ha-config-hawk-meta-attr">
    <para>
     Hawk 会自动列出资源的最重要元属性，例如 <literal>target-role</literal>。
    </para>
    <para>
     修改或添加<guimenu>元属性</guimenu>：
    </para>
    <substeps performance="required">
     <step>
      <para>
       要为属性设置（其他）值，请从属性旁边的下拉框中选择一个值，或编辑输入字段中的值。
      </para>
     </step>
     <step>
      <para>
       要完全删除元属性，请单击属性旁边的减号图标。
      </para>
     </step>
     <step>
      <para>
       要添加另一个元属性，请单击空下拉框，并选择属性。将显示属性的默认值。如果需要，可以按上述步骤更改默认值。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     单击<guimenu>创建资源</guimenu>以完成配置。屏幕顶部将会显示一条消息，告知资源是否创建成功。
    </para>
   </step>
  </procedure>
  <figure>
   <title>Hawk - 基元资源</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-primitive-basic.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-primitive-basic.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

 </section>

 <section xml:id="sec-ha-config-hawk-stonith">
  <title>创建 STONITH 资源</title>
  <important>
   <title>无 STONITH 资源不受支持</title>
   <para>
    不支持无 STONITH 资源的群集。
   </para>
  </important>
  <para>
   默认情况下，全局群集选项 <literal>stonith-enabled</literal> 设置为 <literal>true</literal>：如果未定义任何 STONITH 资源，群集将拒绝启动任何资源。配置一个或多个 STONITH 资源以完成 STONITH 设置。虽然 STONITH 资源的配置过程与其他资源类似，但它们的行为在某些方面有所不同。有关细节，请参见<xref linkend="sec-ha-fencing-config"/>。
  </para>
  <procedure xml:id="pro-ha-config-hawk-stonith">
   <title>添加 STONITH 资源</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>资源</guimenu>。 <guimenu>资源</guimenu>屏幕显示所有类型的资源的类别并列出所有定义的资源。
    </para>
   </step>
   <step>
    <para>
     选择<guimenu>原始</guimenu>类别，单击加号图标。
    </para>
   </step>
   <step>
    <para>
     指定资源：
    </para>
    <substeps performance="required">
     <step>
      <para>
       输入唯一的<guimenu>资源 ID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       从 <guimenu>Class</guimenu>（类）列表，选择资源代理类 <guimenu>stonith</guimenu>。
      </para>
     </step>
     <step>
      <para>
       从<guimenu>类型</guimenu>列表中，选择 用于控制 STONITH 设备的 STONITH 插件。将显示该插件的简短描述。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Hawk 会自动显示该资源必需的<guimenu>参数</guimenu>。为每个参数输入值。
    </para>
   </step>
   <step>
    <para>
     Hawk 会显示最重要的资源<guimenu>操作</guimenu>并建议默认值。如果在此处不修改任何设置，Hawk 会在您确认后立即添加建议的操作及其默认值。
    </para>
   </step>
   <step>
    <para>
     如果没有任何理由来更改<guimenu>元属性</guimenu>设置，则接受默认值。
    </para>
   </step>
   <step>
    <para>
     确认更改以创建 STONITH 资源。
    </para>
   </step>
  </procedure>
  <para>
   要完成屏蔽配置，请添加约束和/或使用克隆。有关详细信息，请参见<xref linkend="cha-ha-fencing"/>。
  </para>
 </section>

 <section xml:id="sec-ha-config-hawk-templates">
  <title>使用资源模板</title>
  <para>
   如果希望创建具有类似配置的多个资源，则定义资源模板是最简单的方式。定义后，便可在基元或特定类型的约束中引用它。有关功能及使用资源模板的详细信息，请参见<xref linkend="sec-ha-config-basics-constraints-templates"/>。
  </para>
  <procedure xml:id="pro-ha-config-hawk-templates-create">
   <title>创建资源模板</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>资源</guimenu>。 <guimenu>资源</guimenu>屏幕显示所有类型的资源的类别及<guimenu>模板</guimenu>类别。
    </para>
   </step>
   <step>
    <para>
     选择<guimenu>模板</guimenu>类别，然后单击加号图标。
    </para>
   </step>
   <step>
    <para>
     输入<guimenu>模板 ID</guimenu>。
    </para>
   </step>
   <step>
    <para>
     像指定原始资源一样指定资源模板。遵循<xref linkend="pro-ha-config-hawk-primitives" xrefstyle="select:label title nopage"/>操作，从<xref linkend="step-ha-config-hawk-primitives-start" xrefstyle="select:label"/> 开始。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>创建资源</guimenu>以完成配置。屏幕顶端将显示一条消息，告知资源模板是否创建成功。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk - 资源模板</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-rsc-template.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-rsc-template.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <procedure xml:id="pro-ha-config-hawk-templates-use">
   <title>引用资源模板</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     要在原始资源中引用新创建的资源模板，请遵循以下步骤：
    </para>
    <substeps performance="required">
     <step>
      <para>
       在左侧导航栏中，选择<guimenu>资源</guimenu>。 <guimenu>资源</guimenu>屏幕显示所有类型的资源的类别。它列出所有定义的资源。
      </para>
     </step>
     <step>
      <para>
       选择<guimenu>原始</guimenu>类别，单击加号图标。
      </para>
     </step>
     <step>
      <para>
       输入唯一的<guimenu>资源 ID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       激活<guimenu>使用模板</guimenu>，然后从下拉列表中选择要引用的模板。
      </para>
     </step>
     <step>
      <para>
       如果需要，则按<xref linkend="pro-ha-config-hawk-primitives"/>中所述指定更多<guimenu>参数</guimenu>、<guimenu>操作</guimenu>或<guimenu>元属性</guimenu>。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     要在共置或顺序约束中引用新创建的资源模板，请按<xref linkend="pro-ha-config-hawk-constraints-collocation-order"/>中所述继续操作。
    </para>
   </step>
  </procedure>
 </section>

 <section xml:id="sec-ha-config-hawk-constraints">
  <title>配置资源约束</title>
  <para>
   配置所有资源后，指定群集应如何正确地处理它们。使用资源约束可指定资源可在哪些群集节点上运行、以何种顺序装载资源，以及特定资源依赖于哪些其他资源。
  </para>
  <para>
   有关约束的可用类型的概述，请参见<xref linkend="sec-ha-config-basics-constraints-types"/>。定义约束时，还需要指定分数。有关分数及其在群集中的含义的更多信息，请参见<xref linkend="sec-ha-config-basics-constraints-scores"/>。
  </para>
  <para>
   通过以下过程了解如何创建不同类型的约束。
  </para>




  <procedure xml:id="pro-ha-config-hawk-constraints-location">
   <title>添加或修改位置约束</title>
   <para>
    对于位置约束，请指定约束 ID、资源、分数和节点：
   </para>

   <step xml:id="step-ha-config-hawk-constraints-start">
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>约束</guimenu>。<guimenu>约束</guimenu>屏幕显示所有类型的约束的类别。它列出所有定义的约束。
    </para>
   </step>
   <step>
    <para>
     要添加新<guimenu>位置</guimenu>约束，请单击相应类别中的加号图标。
    </para>
    <para>
     要修改现有约束，请单击约束旁边的扳手图标，然后选择<guimenu>编辑约束</guimenu>。
    </para>
   </step>
   <step>
    <para>
     输入唯一的<guimenu>约束 ID</guimenu>。修改现有约束时，ID 已定义。
    </para>
   </step>
   <step xml:id="step-ha-config-hawk-constraints-stop">
    <para>
     选择要定义约束的<guimenu>资源</guimenu>。列表中显示群集已配置的所有资源的 ID。
    </para>
   </step>
   <step>
    <para>
     设置约束的<guimenu>分数</guimenu>。正值表示资源可以在下一步中指定的<guimenu>节点</guimenu>上运行。负值表示它不应在该节点上运行。将分数设置为 <literal>INFINITY</literal> 将强制资源在该节点上运行。将其设置为 <literal>-INFINITY</literal> 则表示资源不得在该节点上运行。
    </para>
   </step>
   <step>
    <para>
     选择约束的<guimenu>节点</guimenu>。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>创建约束</guimenu>以完成配置。屏幕顶端将显示一条消息，告知约束是否创建成功。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk - 位置约束</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-loc-constraint.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-loc-constraint.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <procedure xml:id="pro-ha-config-hawk-constraints-collocation-order">
   <title>添加或修改共置或顺序约束</title>
   <para>
    对于这两种类型的约束，请指定约束 ID 和分数，然后将资源添加到依赖性链中：
   </para>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>约束</guimenu>。<guimenu>约束</guimenu>屏幕显示所有类型的约束的类别并列出所有定义的约束。
    </para>
   </step>
   <step>
    <para>
     要添加新<guimenu>共置</guimenu>或<guimenu>顺序</guimenu>约束，请单击相应类别中的加号图标。
    </para>
    <para>
     要修改现有约束，请单击约束旁边的扳手图标，然后选择<guimenu>编辑约束</guimenu>。
    </para>
   </step>
   <step>
    <para>
     输入唯一的<guimenu>约束 ID</guimenu>。修改现有约束时，ID 已定义。
    </para>
   </step>
   <step>
    <para>
     定义<guimenu>分数</guimenu>。
    </para>
    <para>
     对于共置约束，分数确定了资源之间的位置关系。正值表示两个资源应在相同的节点上运行。负值表示两个资源不应在相同的节点上运行。将分数设置为 <literal>INFINITY</literal> 将强制资源在同一个节点上运行。将其设置为 <literal>-INFINITY</literal> 则表示资源不得在同一个节点上运行。分数将与其他因数结合使用，以确定放置资源的位置。
    </para>
    <para>
     对于顺序约束，如果分数大于零则约束是必需的，否则只是建议。默认值为 <literal>INFINITY</literal>。
    </para>
   </step>
   <step>
    <para>
     对于顺序约束，通常可将选项<guimenu>对称</guimenu>保持为启用状态。这指定了资源以相反顺序停止。
    </para>
   </step>
   <step>
    <para>
     要定义约束的资源，请遵循以下步骤：
    </para>
    <substeps performance="required">
     <step>
      <para>
       从列表<guimenu>向约束添加资源</guimenu>中选择一个资源。此列表显示已为群集配置的所有资源和资源模板的 ID。
      </para>
     </step>
     <step>
      <para>
       要添加选定资源，请单击列表旁边的加号图标。下方将显示一个新列表。从列表中选择下一个资源。由于共置和顺序约束都定义了资源之间的依赖性，因此需要至少两个资源。
      </para>
     </step>
     <step>
      <para>
       从列表<guimenu>向约束添加资源</guimenu>的其余资源中选择一个。单击加号图标添加资源。
      </para>
      <para>
       现在依赖性链中有两个资源。
      </para>
      <para>
       如果定义了顺序约束，则最上面的资源将最先启动，然后是第二个，依此类推。通常资源将以相反顺序停止。
      </para>
      <para>
       但是，如果定义了共置约束，则资源之间的箭头图标反映其依赖性，而<emphasis>不是</emphasis>其启动顺序。由于最上面的资源依赖于下一个资源，依此类推，因此群集将首先决定最后一个资源的放置位置，然后再根据该决定放置依赖的资源。如果无法满足约束，群集可以决定不允许运行依赖资源。
      </para>
     </step>
     <step>
      <para>
       添加共置或顺序约束所需数量的资源。
      </para>
     </step>
     <step>
      <para>
       如果要交换两个资源的顺序，则单击资源右侧的双箭头以在依赖性链中交换资源。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     如果需要，可为每个资源指定更多参数，如角色（<literal>Master</literal>、<literal>Slave</literal>、<literal>Started</literal> 或 <literal>Stopped</literal>）。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>创建约束</guimenu>以完成配置。屏幕顶端将显示一条消息，告知约束是否创建成功。
    </para>
   </step>
  </procedure>
  <figure pgwide="0">
   <title>Hawk - 共置约束</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-colloc-constraint.png" width="90%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-colloc-constraint.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   可使用资源集作为定义共置或顺序约束的备用格式。它们有与组相同的排序语义。
  </para>
  <procedure xml:id="pro-ha-config-hawk-constraints-sets">
   <title>对共置或顺序约束使用资源集</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     按<xref linkend="pro-ha-config-hawk-constraints-collocation-order"/>中所述，定义共置或顺序约束。
    </para>
   </step>
   <step>
    <para>
     已将资源添加到依赖性链后，可通过单击右侧的链图标将这些资源放入资源集中。资源集通过属于集合的资源周围的框架显现。
    </para>
   </step>
   <step>
    <para>
     还可向资源集添加多个资源或创建多个资源集。
    </para>
   </step>
   <step>
    <para>
     要从资源集提取资源，请单击相应资源上方的剪刀图标。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk-constraint-set.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk-constraint-set.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     该资源将从集合中删除，并回到依赖性链中的原始位置。
    </para>
   </step>
   <step>
    <para>
     确认更改以完成约束配置。
    </para>
   </step>
  </procedure>
  <para>
   有关配置约束的更多信息以及顺序和共置基本概念的详细背景信息，请参见 <link xlink:href="http://www.clusterlabs.org/doc/"/> 上提供的文档：
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
      <citetitle>Pacemaker Explained</citetitle>（Pacemaker 配置说明），<citetitle>Resource Constraints</citetitle>（资源约束）一章
    </para>
   </listitem>
   <listitem>
    <para>
     <citetitle>共置说明</citetitle>
    </para>
   </listitem>
   <listitem>
    <para>
     <citetitle>顺序说明</citetitle>
    </para>
   </listitem>
  </itemizedlist>
  <procedure xml:id="pro-ha-config-hawk-constraints-remove">
   <title>删除约束</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>约束</guimenu>。<guimenu>约束</guimenu>屏幕显示所有类型的约束的类别并列出所有定义的约束。
    </para>
   </step>
   <step>
    <para>
     单击约束旁边的扳手图标，然后选择<guimenu>删除约束</guimenu>。
    </para>
   </step>
  </procedure>
 </section>

 <section xml:id="sec-ha-config-hawk-failover">
  <title>指定资源故障转移节点</title>
  <para>
   资源在出现故障时会自动重启动。如果在当前节点上无法实现重启动，或如果在当前节点上发生 N 次故障，则资源会试图故障转移到其他节点。您可以多次定义资源的故障次数（<literal>migration-threshold</literal>），在该值之后资源会迁移到新节点。如果群集中存在两个以上的节点，则由 High Availability 软件选择特定资源故障转移的节点。
  </para>
  <para>
   可按照以下步骤指定资源将故障转移到的特定节点：
  </para>
  <procedure xml:id="pro-ha-config-hawk-failover">
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     按<xref linkend="pro-ha-config-hawk-constraints-location"/>中所述，为资源配置位置约束。
    </para>
   </step>
   <step>
    <para>
     按<xref linkend="pro-ha-config-hawk-primitives" xrefstyle="select:label title nopage"/><xref linkend="step-ha-config-hawk-meta-attr" xrefstyle="select:label"/> 中所述，为资源添加 <literal>migration-threshold</literal> 元属性，并输入 migration-threshold 的<guimenu>值</guimenu>。值应是小于 INFINITY 的正数。
    </para>

   </step>
   <step>
    <para>
     如果希望资源的失败计数自动失效，请按<xref linkend="pro-ha-config-hawk-primitives" xrefstyle="select:label title nopage"/><xref linkend="step-ha-config-hawk-meta-attr" xrefstyle="select:label"/> 中所述为该资源添加 <literal>failure-timeout</literal> 元属性，并输入 failure-timeout 的<guimenu>值</guimenu>。
    </para>
   </step>
   <step>
    <para>
     如果希望为资源指定更多的首选故障转移节点，请创建更多的位置约束。
    </para>
   </step>
  </procedure>
  <para>
   <xref linkend="ex-ha-config-basics-failover"/>中演示了有关迁移阈值和失败计数的流程。
  </para>
  <para>
   您可以随时手动清理资源的失败计数，而不是让资源的失败计数自动失效。有关详细信息，请参见<xref linkend="sec-ha-config-hawk-cleanup"/>。
  </para>
 </section>

 <section xml:id="sec-ha-config-hawk-failback">
  <title>指定资源故障回复节点（资源黏性）</title>
  <para>
   当原始节点恢复联机并位于群集中时，资源可能会故障回复到该节点。要防止这种情况发生或指定其他节点供资源故障回复，请更改资源的粘性值。也可以在创建资源之际或之后指定资源粘性。
  </para>
  <para>
   有关不同资源粘性值的含义，请参见<xref linkend="sec-ha-config-basics-failback"/>。
  </para>



  <procedure xml:id="pro-ha-config-hawk-stickiness">
   <title>指定资源黏性</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     按<xref linkend="pro-ha-config-hawk-primitives" xrefstyle="select:label title nopage"/><xref linkend="step-ha-config-hawk-meta-attr" xrefstyle="select:label"/> 中所述，为资源添加 <literal>resource-stickiness</literal> 元属性。
    </para>

   </step>
   <step>
    <para>
     为 resource-stickiness 指定介于 <literal>-INFINITY</literal> 和 <literal>INFINITY</literal> 之间的值。
    </para>
   </step>
  </procedure>
 </section>

 <section xml:id="sec-ha-config-hawk-utilization">
  <title>根据负载影响配置资源放置</title>
  <para>
   并非所有资源都相等。某些资源（如 Xen guest）需要托管它们的节点满足其容量要求。如果资源的放置导致其组合需求超过了提供的容量，则资源的性能会降低，或者失败。
  </para>
  <para>
   要考虑此情况，可使用 High Availability Extension 指定以下参数：
  </para>
  <orderedlist spacing="normal">
   <listitem>
    <para>
     特定节点<emphasis>提供</emphasis>的容量。
    </para>
   </listitem>
   <listitem>
    <para>
     特定资源<emphasis>需要</emphasis>的容量。
    </para>
   </listitem>
   <listitem>
    <para>
     资源放置整体策略。
    </para>
   </listitem>
  </orderedlist>
  <para>
   利用率属性用于配置资源的要求及节点提供的容量。High Availability Extension 现在还提供了一些方法，用于自动检测和配置节点容量和资源要求。有关更多细节和配置示例，请参见<xref linkend="sec-ha-config-basics-utilization"/>。
  </para>
  <para>
   要显示节点的容量值（通过利用率属性定义）以及节点上运行的资源当前占用的容量，请在 Hawk 中切换到<guimenu>群集状态</guimenu>屏幕。选择所需的节点，单击该节点旁边的扳手图标，然后选择<guimenu>显示细节</guimenu>。
  </para>
  <figure>
   <title>Hawk - 查看节点的容量值</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-node-utilization.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-node-utilization.png" width="45%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   配置了节点提供的容量和资源需要的容量后，需要设置全局群集选项中的放置策略，否则容量配置将不会生效。可使用多个策略来调度负载：例如，可以将负载集中到尽可能少的节点上，或使其均匀分布在所有可用节点上。有关更多信息，请参见<xref linkend="sec-ha-config-basics-utilization"/>。
  </para>
  <procedure xml:id="pro-ha-config-hawk-placement">
   <title>设置放置策略</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>群集属性</guimenu>可查看全局群集选项及其当前值。
    </para>
   </step>
   <step>
    <para>
     从<guimenu>添加新属性</guimenu>下拉列表中，选择 <literal>placement-strategy</literal>。
    </para>
   </step>
   <step>
    <para>
     根据要求，将<guimenu>放置策略</guimenu>设置为适当值。
    </para>
   </step>
   <step>
    <para>
     单击加号图标添加新的群集属性（包括其值）。
    </para>
   </step>
   <step>
    <para>
     确认更改。
    </para>
   </step>
  </procedure>
 </section>

 <section xml:id="sec-ha-config-hawk-monitor">
  <title>配置资源监视</title>
  <para>
   High Availability Extension 不仅能检测到节点故障，还能检测到节点上的单个资源失败。如果要确保资源正在运行，则为其配置资源监视。要进行资源监视，请指定超时和/或启动延迟值及间隔。间隔告诉 CRM 检查资源状态的频率。您还可以设置特定参数，如为 <literal>start</literal> 或 <literal>stop</literal> 操作设置 <literal>timeout</literal>。
  </para>
  <procedure xml:id="pro-ha-config-hawk-operations">
   <title>添加或修改监视操作</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>资源</guimenu>。 <guimenu>资源</guimenu>屏幕显示所有类型的资源的类别并列出所有定义的资源。
    </para>
   </step>
   <step>
    <para>
     选择要修改的资源，单击资源旁边的扳手图标，然后选择<guimenu>编辑资源</guimenu>。将显示资源定义。Hawk 会自动显示最重要的资源操作（<literal>monitor</literal>、<literal>start</literal>、<literal>stop</literal>）并建议默认值。
    </para>
   </step>
   <step>
    <para>
     更改操作的值：
    </para>
    <substeps performance="required">
     <step>
      <para>
       单击操作旁边的钢笔图标。
      </para>
     </step>
     <step>
      <para>
       在打开的对话框中，指定以下值：
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         输入以秒为单位的 <literal>timeout</literal> 值。在指定的超时期间后，操作会被视为 <literal>failed</literal>。PE 会决定如何做或执行您在监视操作的 <guimenu>On Fail</guimenu>（失败时）字段中指定的操作。
        </para>
       </listitem>
       <listitem>
        <para>
         对于监视操作，请定义以秒为单位的监视 <literal>interval</literal>。
        </para>
       </listitem>
      </itemizedlist>
      <para>
       如果需要，请使用<guimenu>监视</guimenu>对话框底端的空下拉框来添加更多参数，如<guimenu>失败时</guimenu>（如果此操作失败该怎么办？）或<guimenu>需要</guimenu>（发生此操作前需要满足哪些条件？）。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="hawk-monitor-op.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="hawk-monitor-op.png" width="60%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step>
      <para>
       确认更改以关闭对话框并返回到<guimenu>编辑资源</guimenu>屏幕。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     要完全删除操作，请单击操作旁边的减号图标。
    </para>
   </step>
   <step>
    <para>
     要添加另一个操作，请单击空下拉框，并选择操作。将显示操作的默认值。如果需要，可以通过单击笔形图标更改默认值。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>应用更改</guimenu>以完成配置。屏幕顶端将显示一条消息，告知资源是否更新成功。
    </para>
   </step>
  </procedure>
  <para>
   有关在资源监视程序检测到故障时将发生的操作，请参见<xref linkend="sec-ha-config-basics-monitoring"/>。
  </para>
  <para>
   要查看资源失败，请切换到 Hawk 中的<guimenu>群集状态</guimenu>屏幕，然后选择您感兴趣的资源。单击资源旁边的扳手图标，然后选择<guimenu>显示细节</guimenu>。
  </para>
 </section>

 <section xml:id="sec-ha-config-hawk-group">
  <title>配置群集资源组</title>
  <para>
   某些群集资源依赖于其他组件或资源，并且要求每个组件或资源都按特定顺序启动并在同一服务器上运行。为了简化此配置，我们支持组的概念。
  </para>
  <para>
   有关资源组的示例以及组及其属性的更多信息，请参见<xref linkend="sec-ha-config-basics-resources-advanced-groups"/>。
  </para>
  <note>
   <title>空组</title>
   <para>
    组必须包含至少一个资源，否则配置无效。在 Hawk 中，在创建组时不能创建或修改基元。添加组之前，创建原始资源并根据需要配置它们。有关详细信息，请参见<xref linkend="pro-ha-config-hawk-primitives"/>。
   </para>
  </note>

  <procedure xml:id="pro-ha-config-hawk-group">
   <title>添加资源组</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>资源</guimenu>。 <guimenu>资源</guimenu>屏幕显示所有类型的资源的类别并列出所有定义的资源。
    </para>
   </step>
   <step>
    <para>
     选择<guimenu>组</guimenu>类别，然后单击加号图标。
    </para>
   </step>
   <step>
    <para>
     输入唯一的<guimenu>组 ID</guimenu>。
    </para>
   </step>
   <step>
    <para>
     要定义组成员，请在<guimenu>可用原始资源</guimenu>列表中选择一个或多个条目，然后单击 &lt; 图标将其添加到<guimenu>组子项</guimenu>列表中。所有新的组成员都会添加到列表的底部。要定义组成员的顺序，当前需要按所需顺序添加和删除组成员。
    </para>
   </step>
   <step>
    <para>
     如果需要，请按<xref linkend="pro-ha-config-hawk-primitives" xrefstyle="select: lable title nopage"/><xref linkend="step-ha-config-hawk-meta-attr" xrefstyle="select:label"/>中所述修改或添加<guimenu>元属性</guimenu>。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>创建组</guimenu>以完成配置。屏幕顶端将显示一条消息，告知组是否创建成功。
    </para>
   </step>
  </procedure>
  <figure>
   <title>Hawk - 资源组</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-rsc-group.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-rsc-group.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </section>

 <section xml:id="sec-ha-confighawk-clone">
  <title>配置克隆资源</title>
  <para>
   如果希望特定资源同时在群集中的多个节点上运行，请将这些资源配置为克隆资源。例如，克隆适用于 STONITH 之类的资源和 OCFS2 之类的群集文件系统。可以克隆提供的任何资源。资源的资源代理支持克隆。根据运行克隆资源的节点，其配置可能也有所不同。
  </para>
  <para>
   有关可用类型的资源克隆的概述，请参见<xref linkend="sec-ha-config-basics-resources-advanced-clones"/>。
  </para>
  <note>
   <title>克隆资源的子资源</title>
   <para>
    克隆资源可以包含原始资源或组作为子资源。在 Hawk 中，在创建克隆时不能创建或修改子资源。添加克隆资源之前，创建子资源并根据需要配置它们。有关细节，请参见<xref linkend="pro-ha-config-hawk-primitives"/>或<xref linkend="pro-ha-config-hawk-group"/>。
   </para>
  </note>
  <procedure xml:id="pro-ha-config-hawk-clone">
   <title>添加或修改克隆</title>
   <step>
    <para>
     按<xref linkend="sec-ha-config-hawk-intro-connect"/>中所述，启动 Web 浏览器并登录到群集。
    </para>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>资源</guimenu>。 <guimenu>资源</guimenu>屏幕显示所有类型的资源的类别并列出所有定义的资源。
    </para>
   </step>
   <step>
    <para>
     选择<guimenu>克隆</guimenu>类别，然后单击加号图标。
    </para>
   </step>
   <step>
    <para>
     输入唯一的<guimenu>克隆 ID</guimenu>。
    </para>
   </step>
   <step>
    <para>
     从<guimenu>子资源</guimenu>列表中，选择原始资源或组作为克隆资源的子资源。
    </para>
   </step>
   <step>
    <para>
     如果需要，请按<xref linkend="pro-ha-config-hawk-primitives" xrefstyle="select:label title nopage"/><xref linkend="step-ha-config-hawk-meta-attr" xrefstyle="select:label"/>中所述修改或添加<guimenu>元属性</guimenu>。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>创建克隆</guimenu>以完成配置。屏幕顶端将显示一条消息，告知克隆资源是否创建成功。
    </para>
   </step>
  </procedure>
  <figure>
   <title>Hawk - 克隆资源</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-clone.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-clone.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </section>
</section>
