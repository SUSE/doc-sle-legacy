<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE chapter>
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="ha_requirements.xml" xml:id="cha-ha-requirements"><title>システム要件と推奨事項</title><info><abstract>
  <para>
   次のセクションでは、<phrase role="productnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase>のシステム要件と前提条件について説明します。また、クラスタセットアップの推奨事項についても説明します。
  </para>
 </abstract></info>
 
 
 <section xml:id="sec-ha-requirements-hw">
  <title>ハードウェア要件</title>

  <para>
   次のリストは、<phrase role="productnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase>に基づくクラスタのハードウェア要件を指定しています。これらの要件は、最低のハードウェア設定を表しています。クラスタの使用方法によっては、ハードウェアを追加しなければならないこともあります。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <xref linkend="sec-ha-requirements-sw"/>に指定されたソフトウェアを搭載した1～32台のLinuxサーバ。各サーバが同一のハードウェア構成(メモリ、ディスクスペースなど)になっている必要はありませんが、アーキテクチャは同じである必要があります。クロスプラットフォームのクラスタはサポートされていません。
    </para>
   </listitem>
   <listitem>
    <para> クラスタノードあたり、少なくとも2つのTCP/IP通信メディア。クラスタノードは、ネットワーク設備が使用したい通信手段をサポートするため、通信にマルチキャストまたはユニキャストを使用します。通信メディアは100Mbit/s以上のデータレートをサポートする必要があります。可能であれば、<xref linkend="cha-ha-netbonding"/>の説明に従ってEthernetの各チャネルを結合します。別の方法として、Corosyncで冗長な通信チャネルとして2つ目のインタフェースを使用することもできます。<xref linkend="pro-ha-installation-setup-channel2"/>も参照してください。
     
    </para>
   </listitem>
   <listitem>
    <para>
     オプション:クラスタ内の、アクセスが必要なすべてのサーバに接続された、共有ディスクサブシステム。詳細については、<xref linkend="sec-ha-requirements-disk"/>を参照してください。
    </para>
   </listitem>
   <listitem>
    <para> <xref linkend="glo-stonith" xrefstyle="select:title nopage"/>メカニズム。STONITHデバイスとは、クライアントが停止または誤動作しているとみなしたノードをリセットするために使用する電源スイッチです。これは、ハングして停止したようにしか見えないノードによるデータ破損を防ぐ、唯一の信頼できる方法です。 </para>
    
   </listitem>
  </itemizedlist>
 </section>



 <section xml:id="sec-ha-requirements-sw">
  <title>ソフトウェアの必要条件</title>

  <para>
   次のソフトウェア要件を満たしていることを確認してください。
  </para>



  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     SUSE® Linux Enterprise Server <phrase role="productnumber"><phrase os="sles">11 SP4</phrase></phrase> (利用可能なすべてのオンラインアップデートを適用済み)が、クラスタを構成するすべてのノードにインストールされていること。
    </para>
   </listitem>
   <listitem>
    <para>
     <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">11 SP4</phrase></phrase> (利用可能なすべてのオンラインアップデートを適用済み)が、クラスを構成するすべてのノードにインストールされていること。
    </para>
   </listitem>
   <listitem>
    <para>Geoクラスタを使用する場合は、Geo Clustering for SUSE Linux Enterprise High Availability Extension<phrase role="productnumber"><phrase os="sles">11 SP4</phrase></phrase> (利用可能なすべてのオンラインアップデートを適用済み)が、クラスタを構成するすべてのノードにインストールされていること。 </para>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="sec-ha-requirements-disk">
  <title>ストレージ要件</title>

  <para> クラスタでデータの可用性を高めたい場合は、共有ディスクシステム(SAN: Storage Area Network)の利用をお勧めします。共有ディスクシステムを使用する場合は、次の要件を満たしていることを確認してください。 </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     メーカーの指示のに従い、共有ディスクシステムが適切に設定され、正しく動作していることを確認します。
    </para>
   </listitem>
   <listitem>
    <para>
     共有ディスクシステム中のディスクを、ミラーリングまたはRAIDを使用して耐障害性が高められるように設定してください。ハードウェアベースのRAIDをお勧めします。ホストベースのソフトウェアRAIDはどの設定でもサポートされていません。
    </para>
   </listitem>
   <listitem>
    <para>
     共有ディスクシステムのアクセスにiSCSIを使用している場合、iSCSIイニシエータとターゲットを正しく設定していることを確認します。
    </para>
   </listitem>
   <listitem>
    <para>
     2台のマシンにデータを配分するミラーリングRAIDシステムを実装するためにDRBD*を使用する際、DRBDに提供されるデバイスにのみアクセスし、決してバッキングデバイスにはアクセスしないようにします。クラスタの残りが提供される冗長性を利用する、同じ(ボンドされた)NICを使用します。
    </para>
   </listitem>
   
  </itemizedlist>
 </section>
 <section xml:id="sec-ha-requirements-other">
  <title>その他の要件と推奨事項</title>
  <para>サポートされていて、役に立つHigh Availabilityセットアップについては、次の推奨事項を検討してください。</para>
  <variablelist>
   <varlistentry xml:id="vle-ha-req-nodes">
    <term>クラスタノード数</term>
    <listitem>
     <para>
      
      各クラスタは2つ以上のクラスタノードで構成される必要があります。</para>
     <important>
      <title>奇数のクラスタノード</title>
      <para>3ノードの「最小値」で「奇数」のクラスタノードを使用することを強くお勧めします。<emphasis/><emphasis/> </para>
      <para>クラスタではサービスの実行を維持するために、<xref linkend="gloss-quorum" xrefstyle="select:label nopage"/>が必要です。したがって、3ノードのクラスタは一度に1ノードの障害しか許容できませんが、5ノードのクラスタは、2ノードの障害を許容できます。</para>
     </important>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-stonith">
    <term>STONITH</term>
    <listitem>
     <important>
      <title>STONITHがない場合はサポートなし</title>
      <para> STONITHがないクラスタはサポートされません。 </para>
     </important>
     <para>サポートされるHigh Availabilityセットアップについては、次の点を確認してください。</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>High Availabilityクラスタの各ノードには、少なくとも1つのSTONITHデバイス(通常はハードウェア)が必要です。SBDを使用しない場合は、1ノードあたり複数のSTONITHデバイスを使用することを強くお勧めします。SBDは、外部電源スイッチなしでクラスタ内のSTONITHとフェンシングを有効にしますが、共有ストレージは必要とします。</para>
      </listitem>
      <listitem>
       <para>グローバルクラスタオプション<systemitem>stonith-enabled</systemitem>および<systemitem>startup-fencing</systemitem>を<literal>true</literal>に設定する必要があります。これらのオプションを変更すると、ただちにサポートが失われます。</para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-communication">
    <term>冗長通信パス</term>
    <listitem>
     <para>High Availabilityセットアップがサポートされるには、2つ以上の冗長パスでクラスタ通信を設定する必要があります。これは次のように実行できます。 </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <xref linkend="cha-ha-netbonding" xrefstyle="select:title"/>。 </para>
      </listitem>
      <listitem>
       <para> Corosync内の2つ目の通信チャネル。詳細については、<xref linkend="pro-ha-installation-setup-channel2"/>を参照してください。 </para>
      </listitem>
     </itemizedlist>
     <para> 可能であれば、ネットワークデバイスのボンディングを選択します。 </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>時刻同期</term>
    <listitem>
     <para> クラスタノードはクラスタ外のNTPサーバに同期する必要があります。詳細については、『SUSE Linux Enterprise Server 11 SP4 管理ガイド<citetitle/><phrase role="productnumber"><phrase os="sles"/></phrase>』(<link xlink:href="http://www.suse.com/doc/"/>から入手可能)を参照してください。特に、「<citetitle>Time Synchronization with NTP</citetitle>」の章を参照してください。 </para>
     <para> ノードが同期されていない場合、ログファイルまたはクラスタレポートは分析が難しくなります。 </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NIC名</term>
    <listitem>
     <para> すべてのノード上で同一である必要があります。 </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>ホスト名およびIPアドレス</term>
    <listitem>
     <para> クラスタ内の<emphasis/>各サーバの<filename>/etc/hosts</filename>ファイルを編集することにより、ホスト名の解決を設定します。クラスタ通信の速度が落ちていない、またはDNSによって改ざんされていないことを確認するには、次を実行します。 </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para> 静的IPアドレスを使用します。 </para>
      </listitem>
      <listitem>
       <para> このファイルにあるすべてのクラスタノードを、完全修飾ホスト名およびショートホスト名で一覧表示します。クラスタのメンバーが名前で互いを見つけられることが重要です。名前を使用できない場合、内部クラスタ通信は失敗します。 </para>
      </listitem>
     </itemizedlist>
     <para> 詳細については、『SUSE Linux Enterprise Server 11 SP4 管理ガイド<citetitle/><phrase role="productnumber"><phrase os="sles"/></phrase>』(<link xlink:href="http://www.suse.com/doc"/>から入手可能)を参照してください。「<citetitle/>ネットワークの基礎」の章、「<citetitle/>YaSTによるネットワーク接続の設定」の「<citetitle/>ホスト名とDNSの設定」セクションを参照してください。 </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-storage">
    <term>ストレージ要件</term>
    <listitem>
     
     <para>一部のサービスでは、共有ストレージが必要な場合があります。詳細については、<xref linkend="sec-ha-requirements-disk"/>を参照してください。外部NFS共有またはDRBDを使用することもできます。外部NFS共有を使用する場合は、冗長通信パスを介してすべてのクラスタノードから確実にアクセスできる必要があります。詳細については、<xref linkend="vle-ha-req-communication"/>を参照してください。 </para>
     <para>SBDをSTONITHデバイスとして使用する場合は、共有ストレージに対して追加の要件が適用されます。詳細については、<link xlink:href="http://linux-ha.org/wiki/SBD_Fencing"/>、「<citetitle/>Requirements」セクションを参照してください。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-ssh">
    <term>SSH</term>
    <listitem>
     <para> すべてのクラスタノードはSSHによって互いにアクセスできる必要があります。<command>hb_report</command>または<command>crm_report</command> (トラブルシューティング用)などのツールおよびHawkの<guimenu>履歴エクスプローラ</guimenu>は、ノード間にパスワード不要のSSHアクセスを必要とします。それがない場合、現在のノードからしかデータを収集できません。非標準のSSHポートを使用する場合は、<option>-X</option>オプションを使用します(マニュアルページを参照)。たとえば、SSHポートが<literal>3479</literal>の場合、次のコマンドを使用して、<literal>hb_report</literal>を起動します。</para>
     
     <screen><prompt role="root">root # </prompt>hb_report -X "-p 3479" [...]</screen>
     <note>
      <title>規定要件</title>
      <para>
       パスワード不要のSSHアクセスが規定要件に適合しない場合は、次のとおり、<command>hb_report</command>で次善策を使用できます。
      </para>
      <para>
       パスワードなしでログインできるユーザを作成します(例、公開鍵認証の使用)。このユーザに<command>sudo</command>を設定し、<systemitem class="username">root</systemitem>パスワードが必要ないようにします。<command>hb_report</command>をコマンドラインから<option>-u</option>オプションで開始し、ユーザ名を指定します。詳細については、 <command>hb_report</command>のマニュアルページを参照してください。
      </para>
      <para>
       履歴エクスプローラについては、現在のところ、パスワード不要のログインに代わる方法はありません。
      </para>
     </note>
    </listitem>
   </varlistentry>

  </variablelist>
 </section>
</chapter>
