<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl"
 type="text/xml" 
 title="Profiling step"?>
<!DOCTYPE book PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
 "novdocx.dtd"
[
 <!ENTITY % NOVDOC.DEACTIVATE.IDREF "IGNORE">
 <!ENTITY % entities SYSTEM "entity-decl.ent">
 %entities;
]>
<?provo dirname="security/"?>
<book lang="en" id="book.hardening">
 <bookinfo>
  <title>Security and Hardening Guide</title><productname>&productname;</productname>
  <productnumber>&productnumber;</productnumber><date>
<?dbtimestamp format="B d, Y"?></date>
  <titleabbrev>Security and Hardening</titleabbrev>
  <xi:include os="sles;sled" href="common_copyright_sle.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include os="osuse" href="common_copyright_opensuse.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
 </bookinfo>
 <preface id="pre.hardening.about">
  <title>About This Guide</title>
  <para>
   The &productname; Security and Hardening Guide deals with the particulars
   of installation and set up of a secure &productname; server and
   additional post-install processes required to further secure and harden
   that installation. Security and hardening elements and procedures are
   best applied to a server both during installation and post-installation
   to <quote>fix</quote> services that may be installed on that server. To
   be clear, security and hardening is applied in layers. A
   <quote>hardened</quote> or <quote>secure</quote> system will require a
   server to be set up differently in many cases. While it can be argued
   that all systems should be set up to be as secure as possible, some
   levels of security and hardening may very well be overkill in some cases.
   Each customer has their own security requirements derived from business
   drivers or regulatory compliance mandates (e.g. SOX, HIPAA, PCIDSS, etc.)
   and an effective business requirements analysis should be performed in
   order to determine the right level of security and hardening to be
   applied to a server or defined as part of a baseline server build.
  </para>
  <sect1 id="pre.hardening.about.assumptions">
   <title>Assumptions</title>

   <note>
    <para>
     As we go through this guide – we derive base assumptions from those
     provided from the EAL configuration. However, very few real-world
     environments provide for such a risk-less design constraint set. As
     such it can be considered that the EAL environment includes a generally
     'cooperative' usership with medium attack expertise and potential for
     individual users, and that the system runs physically protected in an
     untrusted network that can be considered hostile.
    </para>
   </note>

   <para>
    While in most cases in this document reference will be made to a single
    server target or host, the scope can generally be applied to more than
    one machine. Generally assume the security target can cover one or more
    systems running &productname;, networked in a non-hostile network, with
    a well-managed and non-hostile user community. It is not intended to
    address the needs of an Internet-connected server, or the case where
    services are to be provided to potentially hostile users. Further
    network security design and requirements would be required in such an
    instance and cover multi-layered firewalls / DMZ setups / etc.
   </para>

   <para>
    It is also assumed that all network cabling <emphasis>must</emphasis> be
    secured and protected from tapping and any other modifications. A secure
    network is assumed for this configuration because detailed examination
    of cryptographic protocols is beyond the scope of this document.
   </para>

   <note>
    <para>
     Note: Again – these assumptions are a bit <quote>idilic</quote>.
     Evaluation of the threat environment would define the need for
     crypto-supported services. Also a tap-safe network infrastructure might
     be a requirement based on the type of threats defined.
    </para>
   </note>

   <para>
    Physical security of the server is another assumption made here, where
    the server is protected from theft and manipulation by unauthorized
    persons. A common sobering thought amongst security professionals is the
    <quote>ten-second Denial of Service</quote> simply unplug the wires and
    reboot the server. Physical security must be insured and physical access
    must be controlled. Also, all components in the network such as routers,
    switches and hubs that are used for communication are assumed to pass
    the user data reliably and without modification. Translations on
    protocol elements (e.g. NAT) are allowed just as long as those
    modifications don't lead to situations where data or information is
    routed to something other than the intended recipient system. Also, be
    aware that data passed to another system leaves the control of the
    sending system; therefore the protection of that data against
    unauthorized access needs to be enforced by the receiving system.
   </para>

   <para>
    If you wants to implement a consistent security policy covering multiple
    hosts on a network then organizational procedures
    <emphasis>must</emphasis> ensure that all those hosts can be trusted and
    are configured with compatible security configurations enforcing an
    organization wide security policy.
   </para>

   <important>
    <para>
     If any connection is established with a system that is outsideof the
     customer's control, enforcement of security policies for information
     passed to that system is not possible. Systems outside of the customer
     realm of control should also be considered beyond the scope of this
     document – or at least the configuration prescribed.
    </para>
   </important>

   <para>
    For a review of industry best practices on security, the development of
    sound security processes, controls development, reviews and audit
    practices and incident management, you can review a public RFC (request
    for comments). RFC2196 is the ongoing work of the world-wide community
    and individual security and process experts. You can review it online
    here: <ulink url="http://www.faqs.org/rfcs/rfc2196.html"/>. As with any
    RFC it is an open and living document that invites "comments" and
    review. If you wish to enhance or improve upon it, that is welcomed and
    you will find instructions on where to send those suggestions within the
    document itself.
   </para>

   <para>
    Each and every person/user that has the ability to perform
    administrative actions by switching to &rootuser; (su) has full control
    over the system and could either by accident or deliberately undermines
    the security of the system and brings it into an insecure state. Many
    companies now market tools to mitigate this risk. Novell now offers a
    Privileged User Management product to secure just this type of risk.
    More information is available here:
   </para>

   <itemizedlist>
    <listitem>
     <para>
      <ulink
       url="http://www.novell.com/products/privilegedusermanager/index.html"/>
     </para>
    </listitem>
   </itemizedlist>

   <para>
    This guide provides initial guidance on how to set up and secure a
    &productname; installation but it is not intended to be the only
    information required for a system administrator to learn how to operate
    Linux securely. Assumptions are made within this guide that the
    customer's administrators have knowledge and understanding of operating
    security principles in general, and of Linux administrative commands and
    configuration options in particular. It is strongly advised that a
    customer organization that wants to operate their systems in the
    resultant secure configurations have their administrators trained in
    operating system security principles, &sle; security functions,
    properties and configuration. Novell has developed ATT (Advanced
    Technical Training) courses for &productname; security and advanced
    administration. Courses range from introductory to advanced and are the
    basis for two of the leading Novell and industry Linux certifications,
    the Certified Linux Professional and the Certified Linux Engineer.
   </para>

   <itemizedlist>
    <listitem>
     <para>
      <ulink
       url="http://www.novell.com/training/certinfo/clp/roadmap_10.html"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <ulink
       url="http://www.novell.com/training/certinfo/cle/roadmap_10.html"/>
     </para>
    </listitem>
   </itemizedlist>

   <para>
    A common security axiom is <quote>Trust ... No One!</quote> or
    <quote>trust only those who have something considerable to
    lose...</quote>. While it is important that every organization can trust
    their system administrators not to deliberately undermine the security
    of the system, we will cover system configuration, including audit
    functions, which can be used to make users accountable for their
    actions. However, it is necessary to point out that an administrator may
    be able to stop the audit subsystem and reconfigure it such that his
    actions no longer get audited. Well trained and trustworthy
    administrators are therefore a key element for the secure operation of
    the system.
   </para>

   <para>
    Much of the configuration information outlined in this guide is provided
    in compliance with the requirements defined for &suse; to acquire the
    EAL Common Criteria certifications and is information a system
    administrator should use when installing, configuring, and operating the
    system to meet certified levels of security. To get an understanding of
    the differing levels you can visit the Common Criteria website or for
    more succinct reference – wikipedia.
   </para>

   <itemizedlist>
    <listitem>
     <para>
      <ulink url="http://www.commoncriteriaportal.org/"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <ulink url="http://www.commoncriteriaportal.org/"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <ulink url="http://en.wikipedia.org/wiki/Common_Criteria"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <ulink url="http://www.commoncriteriaportal.org/"/>
     </para>
    </listitem>
   </itemizedlist>

   <para>
    As a major portion of the hardened setup guidance has been placed here,
    and some has been modified, access to the original <quote>Common
    Criteria EAL4+ Evaluated Configuration Guide for &sls; on IBM
    Hardware</quote>” by Klaus Weidner can be found on the &productname;
    shipping DVD. You can find the package that contains the unedited
    version on the DVD in the /suse/noarch/ directory. The package name
    (which needs to be installed as part of the EAL criteria hardening) is
    <systemitem
     class="resource">certification-sles-ibm-eal4.rpm</systemitem>.
    Once installed, a pdf and other forms of the configuration guide can be
    found on the system in
    <filename>/usr/share/doc/packages/certification-sles-ibm-eal4/</filename>.
   </para>

   <para>
    You can also find a copy of this documentation in a variety of formats
    on the SUSE ftp site. You can also find different CAPP certification
    efforts (with different sponsors HP and IBM) from various &productname;
    versions 8, 9 and 10:
   </para>

   <para>
    <ulink
     url="ftp://anonymous@ftp.suse.com/pub/projects/security/CommonCriteria/"/>
   </para>

   <para>
    A final note of merit, the EAL 4+ (augmented) certification explicitly
    defines the hardware platform used to achieve the certification, and as
    such it could be argued that any variation on the hardware platform
    could ostensibly invalidate the certification itself. While this could
    be argued to the <quote>letter-of-the-law</quote>, the practical and
    pragmatic reality is that a CC EAL certification is referenced in the
    industry to provide a level of intrinsic <quote>trust</quote> for
    companies wishing to implement an operating system or technology. Minor
    modifications to the hardware reference platform should not be
    considered a risk.
   </para>

   <note>
    <para>
     Note: The specific hardware configuration constraint is merely due to
     the way the EAL certification process is run – sponsored by a 3rd
     party, as is the hardware.
    </para>
   </note>

   <para>
    As the EAL levels go up so do the intrinsic costs associated with
    garnering a particular level of certification for the vendor who makes
    the product. Upper level EAL certifications have real monetary costs in
    addition to considerable labor and research/design efforts. While it may
    be considered that an EAL 6 or 7 certification on an operating system
    would garner more revenue due to its demonstrated security capabilities,
    it isn't guaranteed nor even something most consumers would require.
    Most commercially available operating systems are rated at EAL 4 today,
    and very specialized OSes garner an EAL 5 or higher typically by
    extensive planning (from the start) and utilize security kernels
    designed for a specific purpose. Another commonly heard description of a
    <quote>secure system</quote> is one that is disconnected, powered-off,
    buried 10 feet underground and covered with cement... and of course, if
    followed, that system would be of very little value to anyone. System
    security and the <quote>usefulness</quote> of a particular system is a
    constant balancing act. Using sound and pragmatic logic to determine the
    value of the system and/or the data it protects or serves can help
    determine the level of system protections one should or even should
    <emphasis>not</emphasis> apply to it.
   </para>

   <para>
    The guide contains <quote>Parts</quote>, <quote>Chapters</quote>,
    <quote>Sections</quote> and many examples. The <quote>Parts</quote> are
    a complete set of guidance and recommendations that can be used as a
    stand-alone reference within a specific context. For example, Part 1 is
    a reference installation for a complete EAL4+ compliant system with some
    caveats that will be explained (e.g. hardware variety, etc). Part 2
    contains more general system security and service protection schemes.
   </para>

   <para>
    The <quote>Chapters</quote> will divide the books into logical parent
    topics within the <quote>parts</quote> and likewise the
    <quote>sections</quote> sub-divide even further.
   </para>

   <para>
    Examples will exist throughout the whole guide, and many more can be
    found in referenced man pages or documentation.
   </para>

   <note>
    <para>
     Please keep in mind that we use the EAL/CC evaluation guide as a means
     to describe a variety of services that can be hardened, processes that
     can or should be followed, operational functionality of &productname;,
     components, pieces and parts. Together, the eal script that can be run
     should never be considered the be-all-end-all method to harden or
     secure a &productname; system... it is merely a tool used here to
     facilitate discussion and learning. A beginning, perhaps – but not an
     end.
    </para>
   </note>
  </sect1>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="common_intro_available_doc_i.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="common_intro_feedback_i.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="common_intro_typografie_i.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" os="osuse" href="common_intro_making_i.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" os="osuse" href="common_intro_source_code_i.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" os="osuse"
  href="common_intro_acknowl_i.xml"/>
 </preface>
 <part id="part.setup_for_eal">
  <title>Installation and Setup for EAL 4+</title>
  <chapter id="cha.setup_for_eal.intro">
   <title>Introduction (Part 1)</title>
   <abstract>
    <para>
     The purpose of this part is to provide security configuration and
     hardening recommendations for the &sle; operating system. The guidance
     provided here should be applicable to all versions of the product from
     9 on, however many of the components are available (generally) in
     version 10 and later. Much of the content in this guide has been
     presented elsewhere as part of the base configuration details used to
     achieve the Common Criteria EAL 4+ certification. Where it will differ
     is in describing the addition of services and applications outside of
     the EAL 4+ scope. These descriptions will still focus on the security
     and hardening of these additions. However, due to the strict nature of
     the Common Criteria certification some services, and certainly 3rd
     party applications, could not be included.
    </para>

    <para>
     Attempts will be made to point out any differences applicable between
     &productname; version variants. Recommended settings for the basic
     operating system are provided, as well as for many commonly used
     services that the system can host in a network environment. Also, as
     there are security measures that can only be applied (easily) during a
     fresh installation, this document will begin with guidance as if the
     system is a new install of &productname; 10 SP2 version. As of
     publication, &productname; 11 has just shipped. As Linux itself
     continues to grow, change, improve exponentially as a secure operating
     system, this guide attempts to cover many different versions of
     &productname;. You may note some differences depending on the version
     you are using. If known, any thing presented here that is subject to
     change based on &productname; versioning will be noted. Any
     enhancements (pertaining to security) with the newest &productname; 11
     releases will also be called out.
    </para>

    <para>
     Audience: The guide is intended for partners, consultants and technical
     specialists with some decent Linux background and basic system
     administration experience. Readers are assumed to possess basic system
     administration skills for Unix-like systems, as well as some
     familiarity with Novell/SUSE documentation and administration
     conventions.
    </para>

    <para>
     Some instructions within this guide may be complex. Directions should
     be followed completely and with understanding of their effects in order
     to avoid serious adverse implications to the system and its security.
    </para>

    <para>
     Additional discussion, information and examples will be included at
     various points to help further the understanding of a given topic. For
     example, due to the complex nature of the Pluggable Authentication
     Modules and architecture, extra attention will be placed on its
     discussion so that the native flexibility can be understood. For a more
     exhaustive understanding of all of the security components it is highly
     recommended to read the individual man pages (even the <quote>see
     also</quote> page references at the bottom of an individual man page)
     and to seek other on-line resources or documentation. The next section
     describes guiding principles and assumptions used in the document. It
     will also describe some of the base services for an EAL 4+ build.
    </para>

    <para>
     Later sections will augment the security and hardening processes for
     other services and more generalized procedures, but these will be
     separated from the EAL 4+ content as they may not be qualified as part
     of the certified configuration. This does NOT mean that they are not
     <quote>secure</quote>, only that they were not part of the defined
     target of evaluation that garnered the Common Criteria certification.
    </para>
   </abstract>
   <sect1 id="sec.setup_for_eal.intro.principals">
    <title>Guiding Principles</title>

    <para>
     The following guiding principles motivate much of the advice in this
     guide, and security processes in general, and should also influence any
     configuration decisions that are not explicitly covered.
    </para>

    <variablelist>
     <varlistentry>
      <term>Use Data Encryption Whenever Possible</term>
      <listitem>
       <para>
        Data transmissions over wired or wireless networks are susceptible
        to passive monitoring. If it is possible to encrypt these
        transmissions, and practical, it should be done. Even if the realm
        of control is exclusively on a local network, encryption should
        still be considered and implemented, especially authentication data
        like ID and passwords. Networks of SUSE Linux Enterprise Server
        (&productname;) machines can and should be configured so that no
        unencrypted authentication data is ever transmitted between
        machines.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Minimal Package Installation</term>
      <listitem>
       <para>
        The easiest way to avoid vulnerabilities in software is NOT to
        install it! &productname; allows for careful management of the set
        of software packages installed on a system via the &yast; Software
        Management interface and the RPM package manager. Installed software
        can contribute to system vulnerability in several ways:
       </para>
       <orderedlist>
        <listitem>
         <para>
          Packages that include setuid programs may provide local attackers
          a potential path to privilege escalation. Question: What is a
          setuid program? Answer: Setuid programs are programs which when
          run by a normal user, change their user id to 0 (root) and then
          perform tasks at that level.
         </para>
        </listitem>
        <listitem>
         <para>
          Packages that include network services may give this opportunity
          to network-based attackers.
         </para>
        </listitem>
        <listitem>
         <para>
          Packages that include programs which are predictably executed by
          local users (e.g. after graphical login) may provide opportunities
          for Trojan horses or other attack code to be run undetected.
         </para>
        </listitem>
        <listitem>
         <para>
          The number of software packages installed on a system can almost
          always be significantly pruned to include only the software for
          which there is an environmental or operational need.
         </para>
        </listitem>
       </orderedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Service Isolation - Run Different Services on Separate
      Systems</term>
      <listitem>
       <para>
        Whenever possible, a server should be dedicated to serving exactly
        one service or application. This limits the number of other services
        that could be compromised in the event an attacker is able to
        successfully exploit a software flaw in one service (assuming that
        flaw allows access to others).
       </para>
       <para>
        This point can lead to healthy and robust <quote>dialog</quote> on
        system sizing and even further to consolidation or virtualization.
        The intent with this guidance is to reduce the fault domain and risk
        where possible.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Configure System Security Tools to Improve System
      Strength</term>
      <listitem>
       <para>
        Several tools exist which can be effectively used to improve a
        system's resistance to and detection of unknown attacks. These
        tools can improve robustness against attack at the cost of
        relatively little configuration effort.
       </para>
       <para>
        In particular, this guide recommends and discusses the use of
        iptables for host-based firewalling (although, in general, usage of
        the &susefirewall; and configuring it with &yast; is easier and
        actually uses iptables), &aa; or SELinux (preview in &productname;
        11) for protection against vulnerable services, and a logging and
        auditing (<systemitem class="daemon">syslog-ng</systemitem> and
        <systemitem
         class="daemon">auditd</systemitem>)
        infrastructure for detection of problems. Also included in
        &productname; are some security specific tools that improve the
        general security, monitoring and reporting capabilities. Tools such
        as <systemitem class="resource">seccheck</systemitem>,
        <systemitem class="resource">AIDE</systemitem> and
        <systemitem class="resource">nessus</systemitem>.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect1>
   <sect1 id="sec.setup_for_eal.intro.usage">
    <title>Guide Usage</title>

    <para>
     In using this guide you should keep the following points in mind:
    </para>

    <variablelist>
     <varlistentry>
      <term>Sectioning Order and Section Cohesion</term>
      <listitem>
       <para>
        Just a general caution, each section might build on information and
        recommendations discussed in prior sections. It is wise to read each
        section to gain complete understanding (if possible) as the
        instructions/recommendations should never be applied to a system
        blindly. Relevant examples and descriptions may occur after the
        instructions for a particular action.
       </para>
       <para>
        There are two distinct sections for the system set up, system-level
        installation/configuration and service-level
        installation/configuration. The system-level recommendations should
        be applied to all hosts; however service-level guidance may or may
        not be applicable. In the case of services, you will apply the
        guidance if the machine is either a server or a client for that
        service, and ensure that the service is disabled (or as previously
        mentioned, the package removed from the system) according to the
        instructions provided if the machine is neither a server nor a
        client.
       </para>
       <para>
        Also, as mentioned previously, the first sections describe an EAL 4+
        installation and setup. As additional services are added, they may
        be outside of the EAL 4+ base installation and configuration
        (<quote>certified target of evaluation</quote>) yet should not be
        considered 'non-secure'. Additional content depth, recommendations
        and examples will be included to provide for increased flexibility
        in securing and hardening system implementations.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Testing and Fingerprinting</term>
      <listitem>
       <para>
        Each component and recommendation should be tested. In the Delivery
        Guide, guidance was described for a prototype and lab environment.
        This is where testing should occur. Overall, any recommendations
        made here should always be tested in a non-production environment
        before deployment. This test environment should simulate the setup
        in which the system will be deployed as closely as possible.
       </para>
       <para>
        Fingerprinting is the process of storing a 'picture' of a system so
        it can be referenced and compared later to prove its integrity has
        not been compromised. Details will be given in this guide for the
        use of <systemitem class="resource">AIDE</systemitem> (the Advanced
        Intrusion Detection Environment). It is used as an example, but the
        fingerprinting guidance is sound. There are several 3rd party
        providers of system integrity and audit solutions. However,
        <systemitem class="resource">AIDE</systemitem> is included with
        &productname;, is OpenSource, and fairly easy to implement. In the
        event of a system breach, having a system fingerprint can prove
        invaluable when it comes to forensic analysis.
       </para>
       <note>
        <para>
         NOTE: Earlier versions of &productname;
         included<systemitem class="resource"> TripWire</systemitem>.
        </para>
       </note>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Root Shell Environment Assumed</term>
      <listitem>
       <para>
        Most of the actions listed in this document are written with the
        assumption that they will be executed by the &rootuser; user running
        the /bin/bash shell. Any commands preceded with a hash mark (#)
        assume that the administrator will execute the commands as
        &rootuser;, in other words, they will be applied via the usage of
        sudo whenever possible (or use su to gain root privileges if sudo
        cannot be used).
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Reboots / Restarts</term>
      <listitem>
       <para>
        A system restart or reboot might be required after some actions in
        order to complete the reconfiguration of the system. Attempts will
        be made to mention when a reboot is explicitly required. However, in
        some cases, changes will not take effect until a reboot is
        performed. In order to ensure that changes are applied properly and
        to test functionality, it is always a good practice to reboot the
        system after applying a set of recommendations from this guide if a
        reboot is specified. There are many cases where a reboot is not
        necessary, and by no means should a <quote>just-in-case</quote>
        reboot be a matter of practice. The amount of system changes that
        require a reboot are <quote>less than a handful</quote>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Hardware Preparation</term>
      <listitem>
       <para>
        If possible, BIOS passwords should be enabled. They are no
        guarantee, but are decent protection from low-level hardware
        configuration changes. Physical access must be controlled to ensure
        that the BIOS 'clear' hardware-jumpers could not be manipulated on
        the motherboard to bypass this protection.
       </para>
       <note>
        <para>
         The caveat to this is that a BIOS passwords can also be problematic
         or detrimental. If physical access/safety can be assured – you
         may opt to refrain from their usage. Booting from a forensics or
         rescue image may not be possible – in the event of a system
         failure or break in – if a BIOS password preempts a boot.
        </para>
       </note>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>System User Requirements</term>
      <listitem>
       <para>
        The assumption is made that the hardened host will reside in a
        <quote>friendly</quote> environment, one with cooperative and
        security-minded users. Users who will use the system responsibly to
        fulfill their tasks.
       </para>
       <para>
        Note that system availability is not addressed in this guide, and a
        malicious user could disable a server through resource exhaustion,
        denial-of-service attacks or like methods. High availability is
        addressed in other playbooks and can be at the server or service
        level. Of particular interest to many &productname; customers is the
        fact that high-availability tools are included and supported with
        the &productname; distributions (&productname; 10 and higher) either
        in the base distro or included as add-ons.
       </para>
       <para>
        A set of baseline user account requirements are prescribed here in
        accordance with the EAL 4+ evaluation. These requirements are not
        exhaustive, yet provide a minimum level of trusted security for a
        user environment. Other requirements may be necessary depending on
        other policy constraints like SOX, auditing, etc.
       </para>
       <para>
        The requirements for users specifically include:
       </para>
       <variablelist>
        <varlistentry>
         <term>Prescribed Usage / Access Control</term>
         <listitem>
          <para>
           User accounts <emphasis>must</emphasis> be assigned only to those
           users with a <quote>need</quote> to access the data protected by
           the system. These users <emphasis>must</emphasis> be sufficiently
           trustworthy not to abuse those privileges. Again, the concept of
           <quote>domain</quote> control needs to be considered. Once data
           leaves a system the system has no control and cannot prevent that
           data from being intentionally redistributed to unauthorized third
           parties by an authorized user.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term>Granted Trust</term>
         <listitem>
          <para>
           All users of the system <emphasis>must</emphasis> be sufficiently
           skilled to understand the security implications of their actions,
           and <emphasis>must</emphasis> understand and follow a base set of
           security guidelines. There is a baseline set of these
           requirements in a later section. Appropriate training
           <emphasis>must</emphasis> be available to ensure this. Further,
           best practices suggest some sort of User/Acceptable Use policy be
           maintained and logged. As part of many auditing standards, these
           types of policies are required to be signed and stored before
           access is granted to systems including host access, remote
           access, internet access, etc.
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
       <para>
        Normally it is part the responsibility of system administrators to
        verify that these requirements are met, and to be available to users
        if they need help in maintaining the security of their data.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect1>
   <sect1 id="sec.setup_for_eal.intro.host_security">
    <title>Host Security Functions</title>

    <para>
     This section summarizes the security functions that were covered by the
     EAL 4+ certified evaluation. Refer to the appropriate sections for
     information on configuring, using, and managing any of these functions.
     Further examples and details may be provided in later sections if that
     detail is granular and out-of-scope of the base evaluation. All section
     numbers referenced in this guide will correspond directly with those in
     the native <quote>Common Criteria EAL4+ Evaluated Configuration Guide
     for SUSE LINUX Enterprise Server on IBM Hardware</quote> for clarity,
     however this synchronization will not begin until section 2.2 (EAL 4+
     Installation). Also note that more detail (for clarity-sake) will be
     provided in this guide. When in doubt, refer to man pages, the internet
     or check other references. There is a wealth of information available
     in the topic of *nix system security or computer
     <quote>security</quote> in general. A list of sources will be included
     in an appendix of this guide.
    </para>

    <sect2 id="sec.setup_for_eal.intro.host_security.auth">
     <title>Identification and Authentication</title>
     <variablelist>
      <varlistentry>
       <term>Pluggable Authentication Module (PAM)</term>
       <listitem>
        <para>
         FIXME Section 2.3.10 “Introduction to Pluggable Authentication Module
         (PAM)” and FIXME section 2.3.11 “Required Pluggable Authentication
         Module (PAM) configuration” will describe PAM and its usage. Extra
         details will be provided on PAM 'stacks' and how to extend PAM to
         meet your usage requirements. PAM documentation is located on the
         system in <filename>/usr/share/doc/packages/pam/</filename> and you
         can check the pam man page with <command>man 8 pam</command>.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>loginRequired</term>
       <listitem>
        <para>
         The setup and configuration of system logins will be covered in
         FIXME section 2.3.20 <quote>Setting up login controls</quote>. Also
         refer to the <literal>login</literal> and
         <literal>login.defs</literal> man pages for additional information.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>OpenSSH</term>
       <listitem>
        <para>
         OpenSSH is used by default in &productname; and its usage and setup
         are described in FIXME section 3.7 <quote>Setting up SSH</quote> and
         the <systemitem class="daemon">sshd</systemitem>,
         <command>ssh</command>, <literal>sshd_config</literal> man pages.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><systemitem class="daemon">vsftpd</systemitem>
       </term>
       <listitem>
        <para>
         The Very Secure FTP daemon is discussed in FIXME section 2.3.8
         <quote>Setting up FTP</quote> and the vsftpd and vsftpd.conf man
         pages. Usage of FTP may not be a service that is required in all
         host configurations, but it was part of the EAL 4+ configuration
         test.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><command>su</command>
       </term>
       <listitem>
        <para>
         The usage of the <command>su</command> command is prescribed in
         FIXME section 2.4.3 <quote>Gaining superuser access</quote>.
         Further details can be found in the <command>su</command> man page.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </sect2>

    <sect2 id="sec.setup_for_eal.intro.host_security.audit">
     <title>Audit</title>
     <para>
      The audit subsystem has changed considerably from version to version
      of &productname; with updates being made at both the kernel and
      user-space. In recent updates to &productname; 10 SP2, more features
      and functionality has been introduced furthering the capabilities and
      configuration possibilities. The audit subsystem has distinct
      components for event detection and configuration, proxy handling, and
      reporting. Details will be covered in FIXME part 5 of book 2 (section
      2.5.3 <quote>Configuring the audit subsystem</quote>). You should also
      refer to the <systemitem class="daemon">auditd</systemitem> man page,
      whose <quote>SEE ALSO</quote> section points to the remaining audit
      subsystem man pages (e.g. <literal>auditd.conf</literal>,
      <systemitem class="daemon">audispd</systemitem>,
      <command>ausearch</command>, <command>aureport</command> and
      <command>auditctl</command>).
     </para>
     <para>
      Additional information will be covered in later chapters. The audit
      subsystem is very powerful and flexible. Many customers choose to
      purchase 3rd party products for audit event tracking and reporting
      when a detailed knowledge of the Linux Auditing System might have
      satisfied their needs with no additional costs.
     </para>
    </sect2>

    <sect2 id="sec.setup_for_eal.intro.host_security.access">
     <title>Discretionary Access Control</title>
     <para>
      Discretionary access control will be covered in FIXME sections 2.6.4
      <quote>Access control for files and directories</quote>. Further,
      System V interprocesses communication objects (e.g. message queues,
      semaphore sets and shared memory segments) and security permissions
      and processes will be covered in FIXME section 2.4.8 <quote>SYSV
      shared memory and IPC objects</quote>.
     </para>
    </sect2>

    <sect2 id="sec.setup_for_eal.intro.host_security.object_reuse">
     <title>Object Reuse</title>
     <para>
      According to the &productname; High Level Design document, the kernel
      automatically ensures that new objects (disk files, memory, IPC) do
      not contain any traces of previous contents. The design has even been
      enhanced in the latest editions of &productname; to include further
      security enhancements in the kernel and user-space.
     </para>
     <para>
      Some examples include:
     </para>
     <variablelist>v
        <varlistentry>
       <term>Randomization:</term>
       <listitem>
        <para>
         Better address space randomization is available for binaries
         compiled with PIE support (-fPIE). Randomizations include the
         address where the binary is mapped and the head start address.
         Stack and mmap areas are already randomized for all other binaries.
         Randomization is typically an anti-worm measure, not typically an
         anti-overflow solution.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Fstack-protection</term>
       <listitem>
        <para>
         fstack-protector runtime stack overrun heuristics are now enabled
         for all packages in the SLE11 code base.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </sect2>

    <sect2 id="sec.setup_for_eal.intro.host_security.manage">
     <title>Security Management and System Protection</title>
     <para>
      FIXME These topics will be covered as complete chapters. General
      operation and system management will be covered is part 4 or section
      2.4 <quote>System Operation Procedures for Secure Systems</quote> and
      system monitoring, logging and audit will be handled in part 5 or
      section 2.5 “Monitoring, Logging &amp; Audit”.
     </para>
    </sect2>

    <sect2 id="sec.setup_for_eal.intro.host_security.communication">
     <title>Secure Communication</title>
     <variablelist>
      <varlistentry>
       <term>stunnel</term>
       <listitem>
        <para>
         Encryption methods and secure communications are expansive topics.
         The EAL 4+ evaluation guide, the usage of stunnel was described to
         provide a universal SSL tunnel for applications or services. FIXME
         In section 2.4.9 <quote>Configuring secure network connections with
         stunnel</quote> the specifics will be covered. See also the
         <literal>stunnel</literal> man page.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>SSH System Operation Procedures for Secure Systems</term>
       <listitem>
        <para>
         FIXME Section 2.3.7 <quote>Setting up SSH</quote> will cover the
         configuration and usage of SSH with further details available
         within the <systemitem class="daemon">sshd</systemitem>,
         <command>ssh</command>, <literal>sshd_config</literal> man pages.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </sect2>
   </sect1>
   <sect1 id="sec.setup_for_eal.intro.events">
    <title>Overview of Security Relevant Events</title>

    <para>
     The audit subsystem is intended to be the central interface for
     collecting and viewing the record of security relevant events. Formerly
     called the Linux Audit Subsystem (LauS). It was developed by &suse; for
     &productname; 9 (Open Sourced and released under GPL) to attain a CC
     EAL 4 certificate. Since then it has been reworked, renamed simply
     audit, and adopted upstream into the kernel and is now common to the
     2.6 kernel.
    </para>

    <para>
     The events being monitored by default in the evaluated configuration
     include:
    </para>

    <itemizedlist>
     <listitem>
      <para>
       All authentication done through the PAM library, including the
       identity and location (where available) of the user and the success
       or failure result.
      </para>
     </listitem>
     <listitem>
      <para>
       Any use of <command>su</command> to change identity. All actions done
       as part of a su session are marked in the audit record along with the
       original user's login user ID.
      </para>
     </listitem>
     <listitem>
      <para>
       The addition, change or deletion of any users or groups.
      </para>
     </listitem>
     <listitem>
      <para>
       Any changes and/or change attempts to the contents of any security
       critical files.
      </para>
     </listitem>
     <listitem>
      <para>
       Any changes to the access permissions or ownership of any files or
       IPC (interprocess communication) objects.
      </para>
     </listitem>
     <listitem>
      <para>
       Changes to or new binding network ports and accepting connections.
      </para>
     </listitem>
    </itemizedlist>

    <para>
     Details will be covered in FIXME part 5 or section 2.5 “Monitoring,
     Logging &amp; Audit”.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.intro.events.sle11">
    <title>&productname; 11 Enhancements</title>

    <para>
     As previously mentioned in the section above, there have been some
     variations in capabilities as the &productname; operating system has
     matured from version to version, service pack to service pack in some
     instances. Even the included binaries themselves in &productname; 11
     have included security enhancements during compilation as improvements
     have been developed. Here are some examples:
    </para>

    <orderedlist>
     <listitem>
      <para>
       Randomization and Enhanced fstack-protection&mdash;see
       <xref
        linkend="sec.setup_for_eal.intro.host_security.object_reuse"/>.
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>D_FORTIFY_SOURCE</literal> flag enabled at compilation time
       – provides compile-time and runtime based overflow protection and
       format string checking. This was included in SLE 10 as well.
      </para>
     </listitem>
     <listitem>
      <para>
       A new &yast; module for Audit. This will ease the setup and
       configuration of the audit modules as part of the Linux Audit
       Framework (CAPP/EAL capable in SLE10SP2 and certified as of
       SLE10SP1).
      </para>
     </listitem>
     <listitem>
      <para>
       Several &aa; enhancements.
      </para>
     </listitem>
     <listitem>
      <para>
       PolicyKit – this allows for more fine-grained access controls for
       administration access. Enables limited/reduced root access for some
       configuration tasks.
      </para>
     </listitem>
     <listitem>
      <para>
       Additional code and design reviews/improvements by the &suse;
       Security Team – securing new features.
      </para>
     </listitem>
    </orderedlist>
   </sect1>
  </chapter>
  <chapter id="cha.setup_for_eal.installation">
   <title>The EAL 4+ Installation (Part 2)</title>
   <note>
    <para>
     The Common Criteria spec should not generically be considered
     <quote>hardening</quote>. Hardening a system is an exhaustive and
     cyclical effort. This part of the guide covers the EAL setup as a set
     of topical discussion points. The follow-on sections cover even more
     topics and their uses in regards to hardening and Linux security.
    </para>
   </note>
   <para>
    This part of the playbook describes a fresh installation of
    &productname;. Keep in mind that while running &productname; as
    prescribed here (with identical configurations and setups) on similar
    hardware might result in an equivalent security level (if evaluated),
    specific <quote>certification</quote> is only valid if the hardware is
    exactly as described in the CAPP EAL certification process. Here is the
    hardware that was certified during that process:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      System x: x3550 (rack mount), HS20 and HS21 (blades)
     </para>
    </listitem>
    <listitem>
     <para>
      Opteron (AMD): x3455 (rack mount), LS21 (blade)
     </para>
    </listitem>
    <listitem>
     <para>
      IBM &ipseries;: any POWER5 or POWER5+ system
     </para>
    </listitem>
    <listitem>
     <para>
      IBM &zseries;: any z/Architecture compliant system or software
     </para>
    </listitem>
   </itemizedlist>
   <para>
    More detailed configuration information for these IBM systems can be
    found on the IBM website.
   </para>
   <para>
    Additional constraints follow and should be noted with any base hardware
    used during the use of this guide. These constraints include
    (non)acceptable peripherals, ports, consoles, interfaces, etc. and
    should be followed for the most accurate secure results.
   </para>
   <note>
    <para>
     If a system supports virtualization (VM) or secure logical partitioning
     (LPAR), other operating systems <emphasis>may</emphasis> be installed
     and active at the same time as the evaluated configuration. This is if
     (and only if) the VM or LPAR configuration ensures that the other
     operating systems cannot access data belonging to the evaluated
     configuration or otherwise interfere with its operation. Setting up
     this type of configuration is considered to be part of the operating
     environment and is not addressed in this guide.
    </para>
   </note>
   <para>
    On the other platforms, the evaluated configuration
    <emphasis>must</emphasis> be the only operating system installed on the
    server.
   </para>
   <sect1 id="sec.setup_for_eal.installation.hardware_constraints">
    <title>Hardware constraints</title>

    <para>
     You <emphasis>may</emphasis> attach the following peripherals without
     invalidating the evaluation results. Other hardware <emphasis>must
     not</emphasis> be installed in or attached to the system.
    </para>

    <itemizedlist>
     <listitem>
      <para>
       Any storage devices and backup devices supported by the operating
       system (this includes hard disks, CD/DVD-ROM drives and tape drives).
      </para>
     </listitem>
     <listitem>
      <para>
       All Ethernet and Token Ring network adapters supported by the
       operating system. Modems, ISDN and other WAN adapters are not part of
       the evaluated environment.
      </para>
     </listitem>
     <listitem>
      <para>
       PCL 4 or PostScript level 1 compatible printers attached to the
       system using a parallel port or USB connection. You
       <emphasis>may</emphasis> also use a network printer.
      </para>
     </listitem>
     <listitem>
      <para>
       Operator console consisting of a keyboard, video monitor, and
       optionally the mouse. Additionally, you <emphasis>may</emphasis>
       directly attach supported serial terminals (FIXME see section 2.4.7
       <quote>Using serial terminals</quote>), but not modems, ISDN cards,
       or other remote access terminals.
      </para>
     </listitem>
    </itemizedlist>

    <para>
     USB keyboards and mice <emphasis>may</emphasis> be attached, as some of
     the supported hardware platforms would otherwise not have supported
     console input devices. If a USB keyboard or mouse is used, it
     <emphasis>must</emphasis> be connected before booting the operating
     system, and <emphasis>not</emphasis> added later to a running system.
     Other hot-pluggable hardware that depends on the dynamic loading of
     kernel modules <emphasis>must not</emphasis> be attached. Examples of
     such unsupported hardware are USB and IEEE1394/FireWire peripherals
     other than mice and keyboards.
    </para>

    <para>
     To see a list of loaded modules run <command>lsmod</command> from a
     terminal.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.installation.install">
    <title>Selection of Install Options and Packages</title>

    <para>
     This section describes the detailed steps to be performed when
     installing the &productname; operating system on the target server.
    </para>

    <para>
     All settings listed here are <emphasis>required</emphasis> unless
     specifically declared otherwise.
    </para>

    <procedure>
     <step>
      <para>
       It is <emphasis>recommended</emphasis> that you disconnect all
       network connections until the post-install system configuration is
       finished. You <emphasis>may</emphasis> use a network if required for
       the installation (for example when using a NFS file server instead of
       CD/DVD-ROMs). If you do use a network, you <emphasis>must</emphasis>
       ensure that this network is secure, for example by directly
       connecting the new system to a standalone NFS server with no other
       network connections.
      </para>
     </step>
     <step>
      <para>
       On another machine, verify that the installation CD or DVD is an
       authentic &suse; distribution CD/DVD for &productname; 10 (SP1/SP2,
       &productname; 11, etc.). The original media are shipped in a sealed
       sleeve.
      </para>
      <para>
       If using downloaded ISO images, you <emphasis>must</emphasis> verify
       that the MD5 checksums of the image files are correct.
      </para>
      <para>
       The checksums are shown on the SUSE/Novell download web page and
       signed with the SUSE package signing GPG key. You
       <emphasis>must</emphasis> obtain the SUSE package signing key and
       ensure that the key is authentic, for example by getting the key from
       older SUSE distribution media that were previously authenticated, or
       from a trusted key server or other distribution method.
      </para>
      <note>
       <para>
        NOTE: The Novell download website has many different versions of
        &productname; available for installation and evaluation. The
        specific TOE (Target of Evaluation) that was sponsored for the EAL4+
        certification is &productname; 10 SP1 and later updated for SP2,
        which is what the following links point to. If you wish to install a
        different version there may be a few differences in appearance
        and/or package versions (at least!) during install... <quote>your
        mileage may vary</quote>.
       </para>
      </note>
      <para>
       The ISO images and signed MD5sums are available at the following URLs
       (based on architecture) for &productname; 10 SP2:
      </para>
      <variablelist>
       <varlistentry>
        <term>For System x/Opteron (x86, AMD64, Intel64, Itanium and
         &ipseries;:</term>
        <listitem>
         <para>
          <ulink url="http://download.novell.com/Download?buildid=xWohTS2zkSs~"/>
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>&zseries;</term>
        <listitem>
         <para>
          <ulink url="http://download.novell.com/Download?buildid=A-zpMLVoXGg~"/>
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       Again, use another machine to verify and import the SUSE package
       signing key. You can find a current version of the SUSE signing key
       at download.novell.com. Here is a version that will work (a noarch
       rpm package) for many
       products:<ulink
        url="http://download.novell.com/Download?buildid=H-QFkkhlQ-A~"/>
      </para>
      <para>
       Install the rpm with the following command:
      </para>
      <screen>rpm -Uvh suse-build-key-1.0-685.11.noarch.rpm</screen>
      <para>
       Once installed, use the following command to check if the signature
       is authentic:
      </para>
      <screen>gpg --verify /usr/lib/rpm/gnupg/suse-build-key.gpg</screen>
      <para>
       Run <command>md5sum *.iso</command> to view the checksums for the
       downloaded image files, and compare them with those shown on the web
       page.
      </para>
      <para>
       You <emphasis>must</emphasis> use &sls; 10 SP1 (and now SP2) for this
       certified evaluation example. Using versions post SP1 the
       certification results should not be any different. However since the
       criteria for evaluation is <quote>explicit</quote> it is important to
       note that different results <quote>may</quote> occur. Please insure
       that you are using the appropriate version/architecture for your
       platform, refer to the aforementioned hardware details above for the
       list of supported hardware types and the corresponding SLE versions
       needed. Using mismatched versions may work (e.g. 32-bit x86 on 64-bit
       hardware) however you may sacrifice considerable performance.
      </para>
     </step>
     <step>
      <para>
       Launch the installer program contained on the CD/DVD-ROM. The details
       of how to do this depend on the hardware platform. Please refer to
       the installation guide that is part of the printed manual
       accompanying the CD/DVD.
      </para>
      <para>
       For example:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         x86, x86_64, Itanium, POWER (System x, System p, Opteron-based
         eServer): Insert the first CD/DVD and boot from the CD/DVD-ROM
         device. In some cases this may require the attachment of a
         CD/DVD-ROM device and/or enabling the server to actually boot to
         this device by making changes in the system BIOS.
        </para>
       </listitem>
       <listitem>
        <para>
         &zseries;: The details will depend on the operation mode (VM, LPAR
         or native) of the system. The process generally involves copying
         the installer onto the server and launching the installer using the
         host's management interface (MAINT).
        </para>
       </listitem>
      </itemizedlist>
     </step>
     <step>
      <para>
       You <emphasis>may</emphasis> choose text-mode installation instead of
       the default graphical installation by pressing the
       <keycap>F2</keycap> key at the boot prompt, or add the option
       <option>console=tty1</option>. You would type this in the boot
       options line at the bottom of the presented boot interface.
      </para>
      <para>
       You <emphasis>may</emphasis> also use a serial console to do a
       text-mode installation. To do this, you would connect a serial
       terminal device or a computer with terminal emulator software, e.g.
       PuTTY, etc. (this computer has to be appropriately secure) to the
       servers serial port, and then boot from the &productname; CD/DVD.
       When the boot prompt appears add the option
       <option>console=ttyS0</option> (using the appropriate name of the
       serial device if not <systemitem class="resource">ttyS0</systemitem>)
       and then press <keycap
        function="enter"/> to start the
       installation.
      </para>
     </step>
     <step>
      <para>
       Select the appropriate language: choose English (US) to ensure that
       the messages shown during the installation match those described in
       this evaluation.
      </para>
     </step>
     <step>
      <para>
       Accept the License agreement.
      </para>
     </step>
     <step>
      <para>
       If prompted (due to having Linux installed already), choose New
       installation.
      </para>
     </step>
     <step>
      <para>
       Configure Clock and Time Zone:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>Recommended</emphasis>: keep hardware clock time as UTC.
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>Recommended</emphasis>: set the time zone as appropriate
         for the server location.
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>Required</emphasis>: verify that the time displayed is
         accurate.
        </para>
       </listitem>
      </itemizedlist>
     </step>
     <step>
      <para>
       Next is the Installation settings dialog. Change the settings shown
       by clicking on the blue headings, or alternatively by choosing the
       corresponding items from the following:
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>Keyboard Layout</guimenu>
        </term>
        <listitem>
         <para>
          <emphasis>Recommended</emphasis>: set to match the attached
          keyboard
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Mouse</term>
        <listitem>
         <para>
          <emphasis>Optional</emphasis>: set to match the attached mouse (a
          mouse is not needed for the evaluated configuration).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>Partitioning</guimenu>
        </term>
        <listitem>
         <para>
          You <emphasis>must</emphasis> use specific settings for the
          evaluated configuration, using ext3 file systems with ACL support
          and including a separate <filename>/var/log/</filename> partition
          (for CAPP-compliant auditing). Select either Base partition setup
          on this proposal or Create custom partition setup.
         </para>
         <itemizedlist>
          <listitem>
           <para>
            Configuring a swap partition at least as large as the installed
            RAM is <emphasis>recommended</emphasis>.
           </para>
          </listitem>
          <listitem>
           <para>
            Set up the <emphasis>required</emphasis> <filename>/</filename>
            (root) and <filename>/var/log</filename> partitions, and as many
            additional mounted partitions as appropriate.
            <filename>/var/log</filename> <emphasis>requires</emphasis> at
            least 100 MB of space in order to be able to install and launch
            the audit system, but this does not include the additional space
            needed for saved audit logs. Please refer to FIXME section 2.5.3
            <quote>Configuring the audit subsystem</quote> of this guide for
            more information.
           </para>
          </listitem>
          <listitem>
           <para>
            It is <emphasis>recommended</emphasis> to also use separate
            partitions for <filename>/var</filename>,
            <filename>/home</filename> and <filename>/tmp</filename>.
           </para>
          </listitem>
          <listitem>
           <para>
            Some configurations need a separate <filename>/boot</filename>
            partition. This is usually recognized automatically by the
            installation program. For &ipseries; machines, you
            <emphasis>must</emphasis> create a partition of type 41 and at
            least 2MB in size for boot information, and you do
            <emphasis>not</emphasis> need a separate /boot partition.
           </para>
          </listitem>
          <listitem>
           <para>
            Set the file system type of all partitions to ext3, then choose
            <guimenu>Fstab Options</guimenu> and turn on the <guimenu>Access
            Control Lists</guimenu> check mark. You <emphasis>may</emphasis>
            activate the additional options <guimenu>Extended User
            Attributes</guimenu>, <guimenu>No access time</guimenu>, and
            <guimenu>Mount read-only</guimenu> as required.
           </para>
          </listitem>
         </itemizedlist>
         <para>
          The following listing shows a <emphasis>recommended</emphasis>
          partitioning scheme together with minimum sizes for the
          partitions. Using more space is <emphasis>recommended</emphasis>:
         </para>
         <variablelist>
<?dbfo list-presentation="list"?>
<?dbhtml list-presentation="table"?>
          <title>Recommended Partitioning Scheme</title>
          <varlistentry>
           <term><filename>/</filename>
           </term>
           <listitem>
            <para>
             1200 MB
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term><filename>/boot</filename>
           </term>
           <listitem>
            <para>
             75 MB
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term><filename>/home</filename>
           </term>
           <listitem>
            <para>
             100 MB
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term><filename>/tmp</filename>
           </term>
           <listitem>
            <para>
             200 MB
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term><filename>/var</filename>
           </term>
           <listitem>
            <para>
             384 MB
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term><filename>/var/log</filename>
           </term>
           <listitem>
            <para>
             100 MB needed for install, more than 1000 MB for use
            </para>
           </listitem>
          </varlistentry>
         </variablelist>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>Software</guimenu>
        </term>
        <listitem>
         <para>
          The following patterns are <emphasis>required</emphasis> and
          <emphasis>must</emphasis> be marked with a check mark:
         </para>
         <itemizedlist>
          <listitem>
           <para>
            Server Base System
           </para>
          </listitem>
         </itemizedlist>
         <para>
          The following patterns are <emphasis>optional</emphasis>:
         </para>
         <itemizedlist>
          <listitem>
           <para>
            &naa;
           </para>
          </listitem>
          <listitem>
           <para>
            C/C++ Compiler and Tools
           </para>
          </listitem>
          <listitem>
           <para>
            Print Server
           </para>
          </listitem>
         </itemizedlist>
         <para>
          Other patterns <emphasis>must not</emphasis> be checked.
         </para>
         <para>
          On &ipseries;, you <emphasis>must</emphasis> select the 64bit
          Runtime Environment, under <guimenu>System Selection and System
          Tasks / Base Technologies</guimenu>.
         </para>
         <para>
          In addition, you <emphasis>must</emphasis> select additional
          packages. Switch to the <guimenu>Details...</guimenu> view, and
          set <guimenu>Filter to Search</guimenu>.
         </para>
         <para>
          You can enter (part of) the package names in the search field and
          add a check mark to the package in the search result. For example,
          search for audit to quickly find all matching packages.
         </para>
         <para>
          The packages marked as <guimenu>optional</guimenu> are services
          that are part of the evaluated configuration, but
          <guimenu>may</guimenu> be omitted if you do not need them for your
          system. Packages containing documentation files or viewers that
          this document refers to are marked as
          <emphasis>recommended</emphasis>, but you <emphasis>may</emphasis>
          omit them.
         </para>
         <para>
          The installer will automatically choose an appropriate kernel
          (single processor or SMP) based on the detected hardware.
         </para>
         <para>
          On System p, after selecting the packages, Select <menuchoice>
          <guimenu>[I]nformation</guimenu> <guimenu>[V]ersions</guimenu>
          </menuchoice> to show the selected package versions. Use
          <guimenu>[S]earch</guimenu> to find the
          <systemitem
           class="resource">openssh</systemitem> and
          <systemitem
           class="resource">pwdutils</systemitem>
          package. Make sure you have the <quote>ppc</quote> variants of
          these two packages selected, instead of the <quote>ppc64</quote>
          ones.
         </para>
         <para>
          <emphasis>Required</emphasis> packages
         </para>
         <variablelist>
<?dbfo list-presentation="list"?>
<?dbhtml list-presentation="table"?>
          <varlistentry>
           <term>amtu</term>
           <listitem>
            <para>
             Abstract Machine Test Utility (<emphasis>not</emphasis>
             included with &productname; 11)
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term>audit</term>
           <listitem>
            <para>
             User space tools for 2.6 kernelb auditing
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term>audit-libs</term>
           <listitem>
            <para>
             Dynamic library for audit
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term>pwdutils-plugin-audit</term>
           <listitem>
            <para>
             Plugin for the Linux Audit-Subsystem
            </para>
           </listitem>
          </varlistentry>
         </variablelist>
         <para>
          <emphasis>Optional</emphasis> packages
         </para>
         <variablelist>
<?dbfo list-presentation="list"?>
<?dbhtml list-presentation="table"?>
          <varlistentry>
           <term>audit-devel</term>
           <listitem>
            <para>
             Development files for libaudit
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term>vsftpd</term>
           <listitem>
            <para>
             FTP daemon (needs xinetd)
            </para>
           </listitem>
          </varlistentry>
          <varlistentry>
           <term>stunnel</term>
           <listitem>
            <para>
             set up encrypted SSL tunnels
            </para>
           </listitem>
          </varlistentry>
         </variablelist>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>Language</guimenu>
        </term>
        <listitem>
         <para>
          Choose English (US) to ensure that the messages shown during the
          installation match those described in this guide.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>Booting</guimenu> (<guimenu>Expert</guimenu> tab)</term>
        <listitem>
         <para>
          <emphasis>Must</emphasis> keep default (kernel - no other OS is
          permitted on the server).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>Default Runlevel</guimenu> (<guimenu>Expert</guimenu> tab)</term>
        <listitem>
         <para>
          <emphasis>Must</emphasis> be set to 3 (which is multi-user,
          networking and <emphasis>no</emphasis> graphical environment (e.g.
          X window).
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </step>
     <step>
      <para>
       To start the installation press the <guimenu>Accept</guimenu> and
       <guimenu>Install</guimenu> buttons.
      </para>
     </step>
     <step>
      <para>
       Installation will proceed. Insert the CD/DVDs as prompted by the
       installer.
      </para>
     </step>
     <step>
      <para>
       The installer will reboot to continue running on the installed
       system.
      </para>
      <para>
       It is <emphasis>recommended</emphasis> that you now reconfigure the
       system to boot from the newly installed system only (typically the
       first hard disk) and disable all other boot methods such as
       CD/DVD-ROM, network boot (PXE) or floppy disk. If you choose not to
       do that, you <emphasis>must</emphasis> remove the installation
       CD/DVD-ROM from the drive before rebooting.
      </para>
     </step>
     <step>
      <para>
       The installer will continue in text mode, confirm the explanatory
       text about this.
      </para>
     </step>
     <step>
      <para>
       Enter the password for &rootuser;, the administrator
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Choose according to the password policy (FIXME 2.6.3)
        </para>
       </listitem>
       <listitem>
        <para>
         In <guimenu>Expert Options</guimenu>, you <guimenu>must</guimenu>
         set <guimenu>Password Encryption</guimenu> to
         <literal>MD5</literal>
        </para>
       </listitem>
      </itemizedlist>
     </step>
     <step>
      <para>
       Configure an appropriate Hostname and Domain Name. You <emphasis>must
       not</emphasis> use the <guimenu>Change Hostname via DHCP</guimenu>
       option.
      </para>
     </step>
     <step>
      <para>
       Network Configuration: Configure all installed network cards (zero or
       more) as appropriate for the platform.
      </para>
      <note>
       <para>
        NOTE: In the case of virtual network cards on System z, these
        options are not available.
       </para>
      </note>
      <para>
       It is <emphasis>recommended</emphasis> that you disconnect all
       network connections until the post-install system configuration is
       finished. You <emphasis>may</emphasis> use a network if required for
       the installation (for example when using a NFS file server instead of
       CD/DVD-ROMs). If you do use a network, you <emphasis>must</emphasis>
       ensure that this network is secure, for example by directly
       connecting the new system to a standalone NFS server with no other
       network connections.
      </para>
      <itemizedlist>
       <listitem>
        <para>
         You <emphasis>must not</emphasis> install, connect or configure
         DSL, modems, or ISDN adapters.
        </para>
       </listitem>
       <listitem>
        <para>
         You <emphasis>must not</emphasis> allow remote administration via
         VNC.
        </para>
       </listitem>
       <listitem>
        <para>
         You <emphasis>may</emphasis> enable proxy settings if necessary.
        </para>
       </listitem>
      </itemizedlist>
      <para>
       Use the <guimenu> Change</guimenu> menu to configure the Network
       interfaces.
      </para>
      <itemizedlist>
       <listitem>
        <para>
         You <emphasis>must</emphasis> use the Traditional Method.
         <emphasis>Do not</emphasis> enable the NetworkManager applet.
        </para>
       </listitem>
       <listitem>
        <para>
         You <emphasis>may</emphasis> choose to enable or disable the
         firewall.
        </para>
       </listitem>
       <listitem>
        <para>
         It is <emphasis>recommended</emphasis> to permit the SSH port.
        </para>
       </listitem>
       <listitem>
        <para>
         You <emphasis>may</emphasis> enable IPv6.
        </para>
       </listitem>
      </itemizedlist>
      <para>
       For each network card, select <guimenu>Change...</guimenu>, then
       <guimenu>Edit</guimenu> the network settings. The following options
       <emphasis>must</emphasis> be used for non-virtual network cards:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Use Static address setup for each card, and configure an
         appropriate IP Address and Subnet mask. You <emphasis>must
         not</emphasis> use DHCP.
        </para>
       </listitem>
       <listitem>
        <para>
         Select the Host name and name server dialog, and make the following
         changes:
        </para>
        <itemizedlist>
         <listitem>
          <para>
           Disable the Change host name via DHCP check box.
          </para>
         </listitem>
         <listitem>
          <para>
           Disable the Update name servers via DHCP check box.
          </para>
         </listitem>
         <listitem>
          <para>
           <emphasis>recommended</emphasis>: set the system's Host name.
          </para>
         </listitem>
         <listitem>
          <para>
           <emphasis>Optional</emphasis>: configure Name server and Domain
           search entries as required.
          </para>
         </listitem>
        </itemizedlist>
       </listitem>
       <listitem>
        <para>
         In the Routing dialog, configure the <guimenu>Default gateway
         and/or static routes</guimenu> in the routing table as required.
        </para>
       </listitem>
       <listitem>
        <para>
         You <emphasis>may</emphasis> enable IP forwarding.
        </para>
       </listitem>
      </itemizedlist>
      <note>
       <para>
        It is important to note that the enabling of IP forwarding does not
        invalidate or leave the system in a non-secure state. In fact, the
        use of iptables to help secure an environment in some cases requires
        the enabling of IP forwarding (e.g. port or address redirection).
       </para>
      </note>
     </step>
     <step>
      <para>
       In the Test Internet Connection dialog, select No, Skip This Test.
      </para>
     </step>
     <step>
      <para>
       In the Installation Settings dialog, you <emphasis>may</emphasis>
       change the CA Management settings if needed. The OpenLDAP Server
       <emphasis>must</emphasis> be disabled.
      </para>
     </step>
     <step>
      <para>
       In the User Authentication Method dialog, select the Local
       authentication method.
      </para>
     </step>
     <step>
      <para>
       In the New Local User dialog, create an account for one of the
       administrators (<emphasis>recommended</emphasis>: use the real name
       of the person doing the installation).
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Fill out the <guimenu>First name</guimenu>, <guimenu>Last
         name</guimenu>, <guimenu>User login</guimenu> and
         <guimenu>Password</guimenu> fields. The password
         <emphasis>must</emphasis> be chosen as described in FIXME section
         2.6.3 <quote>Password policy</quote> of this guide.
        </para>
       </listitem>
       <listitem>
        <para>
         It is <emphasis>recommended</emphasis> to activate <guimenu>Receive
         System Mail</guimenu> for administrators.
        </para>
       </listitem>
       <listitem>
        <para>
         You <emphasis>must not</emphasis> activate <guimenu>Auto
         Login</guimenu>.
        </para>
       </listitem>
       <listitem>
        <para>
         Open the <guimenu>User Management</guimenu> dialog, and choose
         <guimenu>Edit</guimenu> to activate the Existing Local User dialog.
         Edit the Password Settings for the user you have just created
         according to the parameters described in FIXME section 2.3.20
         <quote>Setting up login controls</quote> of this guide:
        </para>
        <itemizedlist>
         <listitem>
          <para>
           <guimenu>Days before Password Expiration to Issue
           Warning</guimenu>: <literal>5</literal>
          </para>
         </listitem>
         <listitem>
          <para>
           <guimenu>Days after Password Expires with Usable Login</guimenu>:
           <literal>-1</literal>
          </para>
         </listitem>
         <listitem>
          <para>
           <guimenu>Maximum number of days for the same password</guimenu>:
           <literal>60</literal>
          </para>
         </listitem>
         <listitem>
          <para>
           <guimenu>Minimum number of days for the same password</guimenu>:
           <literal>1</literal>
          </para>
         </listitem>
         <listitem>
          <para>
           <guimenu>Expiration date</guimenu>: <emphasis>may</emphasis> be
           left blank
          </para>
         </listitem>
        </itemizedlist>
       </listitem>
       <listitem>
        <para>
         While still in the <guimenu>Existing Local User</guimenu> dialog,
         choose <guimenu>Details</guimenu>, select the <guimenu>Additional
         Groups</guimenu> pane and add membership in the group
         <guimenu>trusted</guimenu> for this administrator.
        </para>
        <warning>
         <para>
          If you forget this step, the user will not be permitted to use the
          su tool.
         </para>
        </warning>
        <para>
         You <emphasis>may</emphasis> use the <guimenu>User
         Management</guimenu> tool to create additional administrator
         accounts at this time, but it is <emphasis>recommended</emphasis>
         to do this later, after setup of the evaluated configuration has
         been completed.
        </para>
       </listitem>
      </itemizedlist>
     </step>
     <step>
      <para>
       If prompted to install additional packages, do so by choosing
       <guimenu>Continue</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Confirm the Release Notes dialog by selecting
       <guimenu>Next</guimenu>.
      </para>
     </step>
     <step>
      <para>
       In the Hardware Configuration dialog, you <emphasis>must
       not</emphasis> enable 3D Acceleration.
      </para>
     </step>
     <step>
      <para>
       Confirm the <guimenu>Installation Completed</guimenu> dialog to start
       the system.
      </para>
     </step>
     <step>
      <para>
       Wait for the freshly installed system to start, and verify that the
       issue message printed above the login prompt matches the installed
       system type and version. Then log in as &rootuser; and proceed with
       the next section.
      </para>
     </step>
    </procedure>
   </sect1>
  </chapter>
  <chapter id="cha.setup_for_eal.securing">
   <title>Securing the Initial System Configuration (Part 3)</title>
   <para>
    After the initial installation, the operating system is not yet in the
    EAL 4+ evaluated configuration. The instructions in this section will
    explain how to achieve that configuration.
   </para>
   <para>
    After software upgrades or installation of additional packages, these
    steps <emphasis>must</emphasis> be re-done or at least re-checked to
    ensure that the configuration remains secure.
   </para>
   <para>
    Note that the system does not define audit rules as there is no
    universally applicable default for this. Please refer to FIXME section
    2.5.3 <quote>Configuring the audit subsystem</quote> of this guide for
    more information.
   </para>
   <para>
    Log in as user &rootuser; on the system console for the following steps.
   </para>
   <para>
    After all the changes described in this chapter have been done, you
    <emphasis>must</emphasis> reboot the system to ensure that all unwanted
    tasks are stopped, and that the running kernel, modules and applications
    all correspond to the evaluated configuration.
   </para>
   <para>
    Please make sure that the boot loader is configured correctly for your
    platform. Remember to remove any CD/DVD-ROM from the drive and/or
    configure the system to boot from hard disk only.
   </para>
   <para>
    The system will then match the evaluated configuration. The server
    <emphasis>may</emphasis> then be connected to a secure network.
   </para>
   <sect1 id="cha.setup_for_eal.securing.prerequisites">
    <title>Prerequisites</title>

    <para>
     The following sub-sections detail the system component prerequisites.
     Automated configuration steps will follow.
    </para>

    <sect2 id="cha.setup_for_eal.securing.prerequisites.filesystem">
     <title>Filesystem Configuration</title>
     <para>
      You <emphasis>must</emphasis> remove the <quote>debugfs</quote> line
      from the <filename>/etc/fstab</filename> file. This filesystem is not
      supported in the evaluated configuration.
     </para>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.prerequisites.pwdutils">
     <title>Replace the <systemitem class="resource">pwdutils</systemitem> Package for ppc64 Systems (IBM &ipseries; only)</title>
     <para>
      This section applies only to System p.
     </para>
     <para>
      If the currently installed version of the
      <systemitem
       class="resource">pwdutils</systemitem> package is
      the 64bit <literal>ppc64</literal> version, you
      <emphasis>must</emphasis> replace it with the 32bit version. The
      automated configuration described in the next section will check for
      this and will refuse to continue if it detects the wrong version.
     </para>
     <para>
      Use the following command to check which version you have installed:
     </para>
     <screen>rpm -q --queryformat='%{ARCH}\n' pwdutils</screen>
     <para>
      Locate the replacement file <filename>pwdutils-*.ppc.rpm</filename> on
      the installation media, and use the <command>rpm</command> command to
      replace the current package, for example:
     </para>
     <screen>rpm -Uvh --replacepkgs pwdutils-3.0.7.1-17.24.ppc.rpm</screen>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.prerequisites.pam_tally">
     <title>Ensure <command>pam_tally</command> and Trusted Program Binaries Match (IBM &ipseries; only)</title>
     <para>
      This section applies only to &ipseries;.
     </para>
     <para>
      The binaries for <systemitem class="daemon">sshd</systemitem> and the
      <command>pam_tally</command> program <emphasis>must</emphasis> be
      installed with the same word size. The following command
      <emphasis>must</emphasis> indicate <quote>32-bit</quote> for both
      files:
     </para>
     <para>
      file /usr/sbin/sshd /sbin/pam_tally
     </para>
     <para>
      (The <command>sles-eal4</command> script will perform this check
      automatically.)
     </para>
     <para>
      If the word sizes do not match, you <emphasis>must</emphasis>
      reinstall the <quote>ppc</quote> version of <quote>openssh</quote>
      and/or <quote>pam</quote> to ensure that both are 32bit.
     </para>
    </sect2>
   </sect1>
   <sect1 id="cha.setup_for_eal.securing.autoconfig">
    <title>Automated Configuration of the System</title>

    <para>
     The
     <systemitem class="resource">certification-sles-ibm-eal4</systemitem>
     package <emphasis>must</emphasis> be installed and used to achieve the
     evaluated configuration. This RPM package contains EAL4 specific
     configuration files, updates to the online documentation, and scripts
     that set up the evaluated configuration.
    </para>

    <para>
     Install the RPM as follows:
    </para>

    <screen>rpm -Uvh /root/rpm/certification-sles-ibm-eal4*.noarch.rpm</screen>

    <para>
     Please check the file
     /usr/share/doc/packages/certification-sles-ibm-eal4/README-eal4.txt<filename></filename>
     from the
     <systemitem class="resource">certification-sles-ibm-eal4.rpm</systemitem>
     for the latest errata information.
    </para>

    <para>
     The automated installation depends on having the correct versions
     available for those packages that <emphasis>must</emphasis> be updated
     or added to the evaluated configuration.
    </para>

    <para>
     The
     <systemitem class="resource">certification-sles-ibm-eal4.rpm</systemitem>
     package contains a setup script that implements the evaluated
     configuration when run. You <emphasis>may</emphasis> add the
     <option>-a</option> switch to run the script automatically, but be
     aware that this will change the configuration with no prompting. Use
     the default interactive mode to run it with no arguments (with prompts
     for confirmation before making changes):
    </para>

    <screen>/usr/lib/eal4/bin/sles-eal4</screen>

    <para>
     When running the script in interactive mode, you
     <emphasis>must</emphasis> permit it to make each change unless the step
     is clearly documented to be <emphasis>optional</emphasis>.
    </para>

    <para>
     If the script fails with an error message, verify that all the steps
     listed in <xref linkend="cha.setup_for_eal.securing.prerequisites"/>
     have been followed.
    </para>

    <warning>
     <para>
      The sles-eal4 script will reboot the system as the final step in the
      process, as described in the manual instructions in section 2.3.26
      <quote>Reboot and initial network connection</quote>. Remember to
      remove any CD/DVD-ROM from the drive and/or configure the system to
      boot from hard disk only.
     </para>
    </warning>

    <para>
     After software upgrades or installation of additional packages, you
     <emphasis>must</emphasis> ensure that the configuration remains secure.
    </para>

    <para>
     Please refer to the FIXME part 1 topic of <quote>Guide Usage</quote>
     and section 2.4.4 <quote>Installation of additional software</quote> of
     this guide for additional information. You <emphasis>may</emphasis>
     re-run the <command>sles-eal4</command> script, but this does not
     guarantee that you will be in the evaluated configuration if you have
     added, deleted, modified, or replaced system components.
    </para>

    <para>
     If the script has completed successfully, the remaining steps in this
     chapter were done automatically. You <emphasis>may</emphasis> skip
     ahead to FIXME part 4 or FIXME section 2.4 <quote>System Operation
     Procedures for Secure Systems</quote> of this guide.
    </para>
   </sect1>
   <sect1 id="cha.setup_for_eal.securing.background">
    <title>Background Information</title>

    <para>
     The information in the remainder of this section provides background
     information about how this configuration was achieved, and mentions
     some changes you <emphasis>may</emphasis> make to the installed system
     while still remaining within the evaluated configuration. It is not
     intended to be a complete listing of the changes made to the system yet
     should provide education, if not edification, of several security and
     hardening topics or techniques leveraged in this evaluation.
    </para>

    <warning>
     <para>
      Following the instructions detailed in
      <xref
      linkend="cha.setup_for_eal.installation"/> and then
      applying the automated reconfiguration as described in
      <xref
       linkend="cha.setup_for_eal.securing.autoconfig"/> is the
      only supported method to set up the certified evaluated configuration. 
     </para>
     <para>
      To reiterate – the following sections were included for clarity sake –
      to describe those tasks normally handled by running the
      <command>sles-eal4</command> script described in <xref
       linkend="cha.setup_for_eal.securing.autoconfig"/>.
     </para>
    </warning>

    <sect2 id="cha.setup_for_eal.securing.background.pack_mgmt">
     <title>Add and Remove Packages</title>
     <para>
      Some packages are listed as <emphasis>recommended</emphasis> or
      <emphasis>optional</emphasis> in <xref
       linkend="sec.setup_for_eal.installation.install"/>. If you did not
      select all of those, some of the following packages will not be present
      on your system.
     </para>
     <para>
      In addition to these packages, certain additional software from the
      &productname; CD/DVDs <emphasis>may</emphasis> be installed without
      invalidating the evaluated configuration. The rules described in the
      section FIXME 2.4.4 <quote>Installation of additional software</quote>
      <emphasis>must</emphasis> be followed to ensure that the security
      requirements are not violated.
     </para>
     <para>
      The following packages are examples of tolerated packages that
      <emphasis>may</emphasis> be added to the system according to these
      rules.
     </para>
     <para>
      Note that the software contained in these packages is not intended to
      be used with &rootuser; privileges, but the presence of the packages does
      not invalidate the evaluated configuration. The sles-eal4 script does
      not remove these packages if they are installed on the system:
     </para>
     <table>
      <title>Tolerated Packages</title>
      <tgroup cols="3">
       <tbody>
        <row>
         <entry>
          <para>
           Mesa-32bit
          </para>
         </entry>
         <entry>
          <para>
           krb5-32bit
          </para>
         </entry>
         <entry>
          <para>
           parted-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           atk-32bit
          </para>
         </entry>
         <entry>
          <para>
           krb5-64bit
          </para>
         </entry>
         <entry>
          <para>
           patch
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           audit-devel
          </para>
         </entry>
         <entry>
          <para>
           perl-Digest-HMAC
          </para>
         </entry>
         <entry>
          <para>
           audit-libs-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libaio-64bit
          </para>
         </entry>
         <entry>
          <para>
           perl-Digest-SHA1
          </para>
         </entry>
         <entry>
          <para>
           audit-libs-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libaio-devel
          </para>
         </entry>
         <entry>
          <para>
           perl-HTML-Parser
          </para>
         </entry>
         <entry>
          <para>
           autoconf
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libaio-devel-32bit
          </para>
         </entry>
         <entry>
          <para>
           perl-HTML-Tagset
          </para>
         </entry>
         <entry>
          <para>
           automake
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libapparmor-32bit
          </para>
         </entry>
         <entry>
          <para>
           perl-Net_SSLeay
          </para>
         </entry>
         <entry>
          <para>
           bind-libs-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libapparmor-64bit
          </para>
         </entry>
         <entry>
          <para>
           perl-TimeDate
          </para>
         </entry>
         <entry>
          <para>
           bind-libs-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libart_lgpl-32bit
          </para>
         </entry>
         <entry>
          <para>
           perl-URI
          </para>
         </entry>
         <entry>
          <para>
           binutils
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libattr-devel
          </para>
         </entry>
         <entry>
          <para>
           perl-gettext
          </para>
         </entry>
         <entry>
          <para>
           binutils-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libcap-32bit
          </para>
         </entry>
         <entry>
          <para>
           perl-libwww-perl
          </para>
         </entry>
         <entry>
          <para>
           binutils-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libcap-64bit
          </para>
         </entry>
         <entry>
          <para>
           powerpc-utils
          </para>
         </entry>
         <entry>
          <para>
           bison
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libcom_err-32bit
          </para>
         </entry>
         <entry>
          <para>
           powerpc32
          </para>
         </entry>
         <entry>
          <para>
           bison-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libcom_err-64bit
          </para>
         </entry>
         <entry>
          <para>
           powersave-libs-32bit
          </para>
         </entry>
         <entry>
          <para>
           blocxx-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libdrm-32bit
          </para>
         </entry>
         <entry>
          <para>
           powersave-libs-64bit
          </para>
         </entry>
         <entry>
          <para>
           cairo-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libelf-32bit
          </para>
         </entry>
         <entry>
          <para>
           recode-64bit
          </para>
         </entry>
         <entry>
          <para>
           compat-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libgcj-32bit
          </para>
         </entry>
         <entry>
          <para>
           s390-32
          </para>
         </entry>
         <entry>
          <para>
           compat-libstdc++-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libgcrypt-32bit
          </para>
         </entry>
         <entry>
          <para>
           samba-32bit
          </para>
         </entry>
         <entry>
          <para>
           compat-openssl097g-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libgcrypt-64bit
          </para>
         </entry>
         <entry>
          <para>
           samba-64bit
          </para>
         </entry>
         <entry>
          <para>
           compat-openssl097g-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libgpg-error-32bit
          </para>
         </entry>
         <entry>
          <para>
           sles-preparation-power_en
          </para>
         </entry>
         <entry>
          <para>
           cpp
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libgpg-error-64bit
          </para>
         </entry>
         <entry>
          <para>
           sles-preparation-zseries_en
          </para>
         </entry>
         <entry>
          <para>
           cpufrequtils-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           libgssapi-32bit sqlite-32bit
          </para>
         </entry>
         <entry>
          <para>
           cpufrequtils-64bit
          </para>
         </entry>
         <entry>
          <para>
           libgssapi-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           sqlite-64bit
          </para>
         </entry>
         <entry>
          <para>
           cups-libs-32bit
          </para>
         </entry>
         <entry>
          <para>
           libidn-32bit strace
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           cups-libs-64bit
          </para>
         </entry>
         <entry>
          <para>
           libidn-64bit
          </para>
         </entry>
         <entry>
          <para>
           strace-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           curl-32bit
          </para>
         </entry>
         <entry>
          <para>
           libjpeg-32bit
          </para>
         </entry>
         <entry>
          <para>
           strace-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           curl-64bit
          </para>
         </entry>
         <entry>
          <para>
           libjpeg-64bit
          </para>
         </entry>
         <entry>
          <para>
           sysfsutils-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           cvs
          </para>
         </entry>
         <entry>
          <para>
           liblcms-32bit
          </para>
         </entry>
         <entry>
          <para>
           sysfsutils-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           db-devel
          </para>
         </entry>
         <entry>
          <para>
           liblcms-64bit
          </para>
         </entry>
         <entry>
          <para>
           sysvinit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           dbus-1-32bit
          </para>
         </entry>
         <entry>
          <para>
           libmng-32bit
          </para>
         </entry>
         <entry>
          <para>
           tar
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           dbus-1-64bit
          </para>
         </entry>
         <entry>
          <para>
           libmng-64bit
          </para>
         </entry>
         <entry>
          <para>
           tcl
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           dbus-1-glib-32bit
          </para>
         </entry>
         <entry>
          <para>
           libnscd-32bit
          </para>
         </entry>
         <entry>
          <para>
           tcl-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           dbus-1-glib-64bit
          </para>
         </entry>
         <entry>
          <para>
           libnscd-64bit
          </para>
         </entry>
         <entry>
          <para>
           tcl-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           device-mapper-32bit
          </para>
         </entry>
         <entry>
          <para>
           libpcap-32bit
          </para>
         </entry>
         <entry>
          <para>
           tcpd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           device-mapper-64bit
          </para>
         </entry>
         <entry>
          <para>
           libpcap-64bit
          </para>
         </entry>
         <entry>
          <para>
           tcpd-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           expat-32bit
          </para>
         </entry>
         <entry>
          <para>
           libpng-32bit
          </para>
         </entry>
         <entry>
          <para>
           tcpd-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           expat-64bit
          </para>
         </entry>
         <entry>
          <para>
           libpng-64bit
          </para>
         </entry>
         <entry>
          <para>
           tcsh
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           expect
          </para>
         </entry>
         <entry>
          <para>
           librtas
          </para>
         </entry>
         <entry>
          <para>
           telnet
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           flex
          </para>
         </entry>
         <entry>
          <para>
           libstdc++-devel
          </para>
         </entry>
         <entry>
          <para>
           terminfo
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           flex-32bit
          </para>
         </entry>
         <entry>
          <para>
           libtiff-32bit
          </para>
         </entry>
         <entry>
          <para>
           texinfo
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           flex-64bit
          </para>
         </entry>
         <entry>
          <para>
           libtiff-64bit
          </para>
         </entry>
         <entry>
          <para>
           timezone
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           fontconfig-32bit
          </para>
         </entry>
         <entry>
          <para>
           libtool-32bit
          </para>
         </entry>
         <entry>
          <para>
           tk
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           freetype2-32bit
          </para>
         </entry>
         <entry>
          <para>
           libtool-64bit
          </para>
         </entry>
         <entry>
          <para>
           udev
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           freetype2-64bit
          </para>
         </entry>
         <entry>
          <para>
           libusb-32bit
          </para>
         </entry>
         <entry>
          <para>
           update-desktop-files
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gcc
          </para>
         </entry>
         <entry>
          <para>
           libusb-64bit
          </para>
         </entry>
         <entry>
          <para>
           usbutils
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gcc-c++
          </para>
         </entry>
         <entry>
          <para>
           libxslt-32bit
          </para>
         </entry>
         <entry>
          <para>
           utempter
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gdb-32bit
          </para>
         </entry>
         <entry>
          <para>
           libxslt-64bit
          </para>
         </entry>
         <entry>
          <para>
           utempter-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gdb-64bit
          </para>
         </entry>
         <entry>
          <para>
           libzio-64bit
          </para>
         </entry>
         <entry>
          <para>
           utempter-64bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gdbm-devel
          </para>
         </entry>
         <entry>
          <para>
           limal-nfs-server-perl
          </para>
         </entry>
         <entry>
          <para>
           util-linux
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gdbm-devel-32bit
          </para>
         </entry>
         <entry>
          <para>
           ltrace-32bit
          </para>
         </entry>
         <entry>
          <para>
           vim
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gettext-32bit
          </para>
         </entry>
         <entry>
          <para>
           make
          </para>
         </entry>
         <entry>
          <para>
           vsftpd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gettext-64bit
          </para>
         </entry>
         <entry>
          <para>
           mono-core-32bit
          </para>
         </entry>
         <entry>
          <para>
           w3m
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gettext-devel
          </para>
         </entry>
         <entry>
          <para>
           mpt-firmware
          </para>
         </entry>
         <entry>
          <para>
           wget
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           glib
          </para>
         </entry>
         <entry>
          <para>
           ncurses-devel
          </para>
         </entry>
         <entry>
          <para>
           xinetd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           glib2-32bit
          </para>
         </entry>
         <entry>
          <para>
           ncurses-devel-32bit
          </para>
         </entry>
         <entry>
          <para>
           xorg-x11-libs-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           glib2-64bit
          </para>
         </entry>
         <entry>
          <para>
           ncurses-devel-64bit
          </para>
         </entry>
         <entry>
          <para>
           yast2
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           glibc-devel
          </para>
         </entry>
         <entry>
          <para>
           numactl
          </para>
         </entry>
         <entry>
          <para>
           yast2-bootloader
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           glibc-devel-32bit
          </para>
         </entry>
         <entry>
          <para>
           numactl-64bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-core
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           glibc-devel-64bit
          </para>
         </entry>
         <entry>
          <para>
           openct-32bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-country
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           glitz-32bit
          </para>
         </entry>
         <entry>
          <para>
           openct-64bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-inetd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gmp-32bit
          </para>
         </entry>
         <entry>
          <para>
           openmotif-libs-32bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-installation
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gmp-devel
          </para>
         </entry>
         <entry>
          <para>
           opensc-32bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-ldap
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gpg-pubkey
          </para>
         </entry>
         <entry>
          <para>
           opensc-64bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-ldap-client
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gpm-32bit
          </para>
         </entry>
         <entry>
          <para>
           openslp-32bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-mail-aliases
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gpm-64bit
          </para>
         </entry>
         <entry>
          <para>
           openslp-64bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-mouse
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           gtk2-32bit
          </para>
         </entry>
         <entry>
          <para>
           pam
          </para>
         </entry>
         <entry>
          <para>
           yast2-ncurses
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           hal-32bit
          </para>
         </entry>
         <entry>
          <para>
           pam-32bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-network
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           hal-64bit
          </para>
         </entry>
         <entry>
          <para>
           pam-64bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-online-update
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           howtoenh
          </para>
         </entry>
         <entry>
          <para>
           pam-modules-32bit
          </para>
         </entry>
         <entry>
          <para>
           yast2-s390
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           hplip17-hpijs
          </para>
         </entry>
         <entry>
          <para>
           pam-modules-64bit
          </para>
         </entry>
         <entry>
          <para>
           zlib-devel
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           kernel-ppc64
          </para>
         </entry>
         <entry>
          <para>
           pango-32bit
          </para>
         </entry>
         <entry>
          <para>
           zlib-devel-32bit
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           kernel-source
          </para>
         </entry>
         <entry>
          <para>
           parted-32bit
          </para>
         </entry>
         <entry></entry>
        </row>
       </tbody>
      </tgroup>
     </table>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.background.ssh">
     <title>Setting up SSH (&productname; 10 SP2 and earlier)</title>
     <para>
      SSH protocol version 1 <emphasis>must</emphasis> be disabled. It has
      known security deficiencies. Also, the ssh client <emphasis>must
      not</emphasis> be set up setuid root (the setuid bit was removed in
      the post-install configuration via the script). This prevents the use
      of some authentication methods normally supported by OpenSSH, but does
      not affect the evaluated configuration which uses password
      authentication exclusively.
     </para>
     <para>
      The SSH Server <emphasis>must</emphasis> be configured to reject
      attempts to log in as root.
     </para>
     <para>
      The permitted authentication mechanisms are per-user (with nonempty)
      passwords and per-user DSS public key authentication. All other
      authentication methods <emphasis>must</emphasis> be disabled.
     </para>
     <para>
      The setting PAMAuthenticationViaKbdInt <emphasis>must</emphasis> be
      disabled (if present in the &productname; version), since this would
      otherwise circumvent the disabled &rootuser; logins over the network.
     </para>
     <para>
      This results in the following option set for the SSH daemon that
      <emphasis>must</emphasis> be set in
      <filename>/etc/ssh/sshd_config</filename> file:
     </para>
     <screen>Protocol 2
Ciphers 3des-cbc
PermitRootLogin no
RSAAuthentication no
PubkeyAuthentication yes
IgnoreRhosts yes
RhostsRSAAuthentication no
HostbasedAuthentication no
PasswordAuthentication yes
PermitEmptyPasswords no
ChallengeResponseAuthentication no
KerberosAuthentication no
GSSAPIAuthentication no
PAMAuthenticationViaKbdInt no
X11Forwarding no
Subsystem sftp /usr/lib/ssh/sftp-server</screen>
     <para>
      All other options <emphasis>must not</emphasis> be changed from the
      defaults or from those settings specified here. Specifically, you
      <emphasis>must not</emphasis> add other authentication methods (AFS,
      Kerberos, host-based) to those permitted here.
     </para>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.background.services">
     <title>Disable Services</title>
     <note>
      <para>
       The system runlevel as specified in the <literal>initdefault</literal>
       entry in <filename>/etc/inittab</filename> <emphasis>must</emphasis>
       remain at the default setting of <literal>3</literal> for these steps
       to be valid.
      </para>
     </note>
     <para>
      The following services are <emphasis>required</emphasis> for runlevel 3:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <systemitem class="daemon">auditd</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">cron</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">network</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">random</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">syslog</systemitem>
       </para>
      </listitem>
     </itemizedlist>
     <para>
      The following services are <emphasis>optional</emphasis> for runlevel 3:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <systemitem class="service">boot.apparmor</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">cups</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">dbus</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="daemon">haldaemon</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="daemon">kbd</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">microcode</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="service">postfix</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="daemon">sshd</systemitem>
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem class="daemon">xinetd</systemitem>
       </para>
      </listitem>
     </itemizedlist>
     <para>
      You <emphasis>must</emphasis> ensure that all
      <emphasis>required</emphasis> services are active. You
      <emphasis>may</emphasis> enable or disable services from the
      <emphasis>optional</emphasis> list as suitable for your configuration.
      All other services <emphasis>must</emphasis> be deactivated.
     </para>
     <para>
      Use <command>insserv <replaceable>ServiceName</replaceable></command> to
      activate a service, and <command>insserv <option>-r</option>
       <replaceable>ServiceName</replaceable></command> to deactivate it.
     </para>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.background.ftp">
     <title>Setting up FTP</title>
     <para>
      The evaluated configuration <emphasis>optionally</emphasis> includes FTP
      services. Note that FTP does not provide support for encryption in this
      setup, so this is only <emphasis>recommended</emphasis> for anonymous
      access to non-confidential files. If you do not specifically need FTP,
      it is <emphasis>recommended</emphasis> that you disable the <systemitem
       class="daemon">vsftpd</systemitem>
      service.
     </para>
     <para>
      The FTP server is started via <systemitem
       class="daemon">xinetd</systemitem>, see <command>man 8
       xinetd</command> for more information. The following is the
      configuration entry in <filename>/etc/xinetd.d/vsftpd</filename>:
     </para>
     <screen>service ftp
{
socket_type = stream
protocol = tcp
wait = no
user = root
server = /usr/sbin/vsftpd
}</screen>
     <para>
      The vsftpd service uses several additional configuration files. In
      <filename>/etc/vsftpd.conf</filename> the configuration of the ftp
      daemon is specified. In addition, the file
      <filename>/etc/ftpusers</filename> is used for access control. Users
      listed in that file <emphasis>can not</emphasis> log in via FTP.
     </para>
     <para>
      This file initially contains all system IDs and the root user. It can
      be augmented with other IDs according to the local needs, but the root
      entry <emphasis>must not</emphasis> be removed. The ftpusers file is
      not checked by the ftp daemon itself but by a PAM module. Please see
      section FIXME 2.3.11 “Required Pluggable Authentication Module (PAM)
      configuration” of this guide for details.
     </para>
     <para>
      The setup of <filename>/etc/vsftpd.conf</filename> depends on the
      customers local needs. Please refer to the
      <literal>vsftpd.conf</literal> man page for more details.
     </para>
     <para>
      The default configuration permits only anonymous FTP. This setting is
      therefore only suitable for distribution of public files for which no
      read access control is needed.
     </para>
     <screen>anonymous_enable=YES
local_enable=NO</screen>
     <para>
      It is <emphasis>recommended</emphasis> disabling anonymous FTP if you do
      not need this functionality with the following
      <filename>/etc/vsftpd.conf</filename> setting:
     </para>
     <screen>anonymous_enable=NO</screen>
     <para>
      You <emphasis>may</emphasis> enable FTP
      authentication for local user accounts. The corresponding setting in
      /etc/vsftpd.conf<filename></filename> is:
     </para>
     <screen>local_enable=YES</screen>
     <para>
      It is <emphasis>recommended</emphasis> to use the more secure
      alternatives sftp or scp to copy files among users, and to use FTP
      only for legacy applications that do not support this alternative.
     </para>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.background.postfix">
     <title>Setting up Postfix</title>
     <para>
      The default settings of the postfix MTA are in accordance with the EAL4
      requirements. It is <emphasis>recommended</emphasis> that you set up an
      alias for root in the <filename>/etc/aliases</filename> file. Specify
      one or more user names of administrators to whom mail addressed to root
      will be forwarded.
     </para>
     <para>
      For example, run the following commands (assuming you are starting
      from the default Postfix configuration) to forward root mail to user
      <systemitem class="username">jdoe</systemitem>:
     </para>
     <screen>echo "root: jdoe" &gt;&gt;/etc/aliases
newaliases
postfix reload</screen>
     <para>
      Please see the <command>postfix</command>, <literal>master</literal>,
      <literal>aliases</literal>, and <command>newaliases</command> man pages
      and/or the documentation in
      <filename>/usr/share/doc/packages/postfix/html/</filename> for more
      details.
     </para>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.background.pam">
     <title>
      Pluggable Authentication Module (PAM) Configuration
     </title>
     <para>
      The PAM subsystem is responsible for maintaining passwords and other
      authentication data. Because this is a security-critical system,
      understanding how it works is very important. In addition to the pam
      manual page, full documentation is available in
      <filename>/usr/share/doc/packages/pam</filename>. It includes
      <citetitle>The Linux-PAM System Administrators Guide</citetitle>
      (<filename>Linux-PAM_SAG.txt</filename>) as well as information for
      writing PAM applications (<citetitle>The Linux-PAM Application
       Developers Guide</citetitle>, <filename>Linux-PAM_ADG.txt</filename>)
      and modules (<citetitle>The Linux-PAM Module Writers Guide</citetitle>,
      <filename>Linux-PAM_MWG.txt</filename>). You can also find pdf and html
      versions of these documents in the <filename>pdf</filename> and
      <filename>html</filename> subdirectorydies. Detailed information about
      modules is available in <filename>modules/README.pam_*</filename>, as
      well as the man pages for individual modules, such as
      <literal>pam_pwcheck</literal>.
     </para>
     <sect3 id="cha.setup_for_eal.securing.background.pam.basics">
      <title>PAM Configuration Basics</title>
      <para>
       Each <quote>service</quote> (application) that uses PAM for
       authentication uses a service-name to determine its configuration, these
       are stored in the
       <filename>/etc/pam.d/<replaceable>service_name</replaceable></filename>
       files. The special service-name <filename>other</filename> (case
       insensitive) is used for default settings if there are no specific
       settings.
      </para>
      <note>
       <para>
        On &productname;, the PAM configuration is stored in the
        <filename>/etc/pam.d/</filename> directory. Note that the documentation
        refers to a file <filename>/etc/pam.conf</filename> that is not used by
        &productname; (PAM was compiled to ignore this file if the
        <filename>/etc/pam.d/</filename> directory exists).
       </para>
      </note>
      <para>
       The configuration file for the service contains one entry for each
       module, in the format:
      </para>
      <screen><replaceable>module-type</replaceable> <replaceable>control-flag</replaceable> <replaceable>module-path</replaceable> <replaceable>args</replaceable></screen>
      <para>
       Comments <emphasis>may</emphasis> be used extending from
       <quote>#</quote> to the end of the line, and entries
       <emphasis>may</emphasis> be split over multiple lines using a backslash
       <quote>\</quote> at the end of a line as a continuation character.
      </para>
      <para>
       The module-type defines the type of action being done. This can be one
       of four types:
      </para>
      <para>
       auth
      </para>
      <para>
       Authenticates users (determines that they are who they claim to be).
       It can also assign credentials, for example additional group
       memberships beyond those specified through /etc/passwd and
       /etc/groups. This additional functionality <emphasis>must
        not</emphasis> be used.
      </para>
      <variablelist>
       <?dbfo list-presentation="list"?>
       <?dbhtml list-presentation="table"?>
       <varlistentry>
        <term>account</term>
        <listitem>
         <para>
          Account management not related to authentication, it can also
          restrict access based on time of day, available system resources or
          the location of the user (network address or system console).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>session</term>
        <listitem>
         <para>
          Manages resources associated with a service by running specified code
          at the start and end of the session. Typical usage includes logging
          and accounting, and initialization such as auto mounting a home
          directory.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>password</term>
        <listitem>
         <para>
          Used for updating the password (or other authentication token), for
          example when using the passwd utility to change it.
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       The control-flag specifies the action that will be taken based on the
       success or failure of an individual module. The modules are stacked
       (executed in sequence), and the control-flags determine which final
       result (success or failure) will be returned, thereby specifying the
       relative importance of the modules.
      </para>
      <note>
       <para>
        Stacked modules are executed in the order specified in the
        configuration file. Hence you may have heard many references to a
        <quote>PAM stack</quote>. This is important, in building a valid PAM
        stack you should be able to flow-chart the execution order and logic
        in order to prove expected behavior and likewise troubleshoot any
        unexpected behaviors in the <quote>stack</quote>.
       </para>
      </note>
      <para>
       The control-flag can be specified as either a single keyword, or
       alternatively with a more elaborate syntax that allows greater
       control. &productname; uses only the single keyword syntax by default.
      </para>
      <para>
       The following keywords control how a module affects the result of the
       authentication attempt:
      </para>
      <variablelist>
       <?dbfo list-presentation="list"?>
       <?dbhtml list-presentation="table"?>
       <varlistentry>
        <term>required</term>
        <listitem>
         <para>
          If this module returns a failure code, the entire stack will return
          failure. The failure will be reported to the application or user only
          after all other modules in the stack have been run, to prevent
          leakage of information (for example, ask for a password even if the
          entered username is not valid).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>requisite</term>
        <listitem>
         <para>
          Same as required, but return failure immediately not executing the
          other modules in the stack. Can be used to prevent a user from
          entering a password over an insecure connection.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>sufficient</term>
        <listitem>
         <para>
          Return success immediately if no previous required modules in the
          stack have returned failure. Do not execute succeeding modules.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>optional</term>
        <listitem>
         <para>
          The return code of this module is ignored, except if all other modules
          in the stack return an indeterminate result (PAM IGNORE).
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       The module-path specifies the filename of the module to be run (relative
       to the directory <filename>/lib/security/</filename>), and the optional
       args are passed to the module. Refer to the module's documentation for
       supported options.
      </para>
     </sect3>
     <sect3 id="cha.setup_for_eal.securing.background.pam.required">
      <title>Required PAM Configuration</title>
      <para>
       You <emphasis>must</emphasis> restrict authentication to services that
       are explicitly specified. The <quote>other</quote> fallback
       <emphasis>must</emphasis> be disabled by specifying the
       <literal>pam_deny.so</literal> module for each module-type in the
       <quote>other</quote> configuration. This ensures that access decisions
       within the PAM system are handled only by the service specific PAM
       configuration.
      </para>
      <para>
       You <emphasis>must</emphasis> add the <literal>pam_wheel.so</literal>
       module to the <quote>auth</quote> module type configuration for the
       <command>su</command> service to restrict use of <command>su</command>
       to members of the <systemitem class="groupname">trusted</systemitem>
       group.
      </para>
      <para>
       You <emphasis>must</emphasis> add the <literal>pam_tally.so</literal>
       module to the auth and account module type configurations of
       <literal>login</literal>, <literal>sshd</literal>, and
       <literal>vsftpd</literal>. This ensures that accounts are disabled
       after several failed login attempts. The
       <literal>pam_tally.so</literal> module is used in the auth stack to
       increment a counter in the file <filename>/var/log/lastlog</filename>,
       and in the account stack to either deny login after too many failed
       attempts, or to reset the counter to zero after successful
       authentication. The evaluated configuration uses a lockout after five
       failed attempts, corresponding to the setting deny=5, you
       <emphasis>may</emphasis> decrease the number for stricter enforcement.
      </para>
      <note>
       <para>
        Be aware that this can be used in denial-of-service attacks to lock
        out legitimate users.
       </para>
      </note>
      <para>
       Please refer to FIXME section 2.4.7 <quote>Managing user accounts</quote> of
       this guide for more information.
      </para>
      <para>
       You <emphasis>must</emphasis> use the
       <literal>pam_passwdqc.so</literal> password quality checking module to
       ensure that users will not use easily-guessable passwords.
      </para>
      <para>
       You <emphasis>must not</emphasis> modify other settings, specifically
       you <emphasis>must</emphasis> use the <literal>md5</literal> and use
       <literal>cracklib</literal> options for the
       <literal>pam_pwcheck.so</literal> module in the
       <filename>/etc/security/pam_pwdcheck.conf</filename> file.
      </para>
      <para>
       The <literal>remember=<replaceable>XX</replaceable></literal> option
       <emphasis>must</emphasis> be added to the
       <filename>/etc/security/pam_pwcheck.conf</filename> file to force users
       to create new passwords and not re-use ones that they had previously,
       (e.g. to prevent users from simply alternating between two passwords
       when asked to change it due to expiration.)
       <replaceable>XX</replaceable> is any number between 7 and 400.
      </para>
      <para>
       The system supports many other PAM modules apart from the ones shown
       here. In general, you <emphasis>may</emphasis> add PAM modules that
       add additional restrictions. You <emphasis>must not</emphasis> weaken
       the restrictions through configuration changes of the modules shown
       here or via additional modules. Also, you <emphasis>must
        not</emphasis> add PAM modules that provide additional privileges to
       users (such as the <literal>pam_console.so</literal> module).
      </para>
      <para>
       Here is a list of the PAM modules included in the new &productname; 11
       distribution (may contain minor differences from earlier releases):
      </para>
      <table>
       <title>Included PAM Modules</title>
       <tgroup cols="4">
        <tbody>
         <row>
          <entry>
           <para>
            pam_access.so
           </para>
          </entry>
          <entry>
           <para>
            pam_homecheck.so
           </para>
          </entry>
          <entry>
           <para>
            pam_nologin.so
           </para>
          </entry>
          <entry>
           <para>
            pam_ssh.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_apparmor.so
           </para>
          </entry>
          <entry>
           <para>
            pam_issue.so
           </para>
          </entry>
          <entry>
           <para>
            pam_p11_opensc.so
           </para>
          </entry>
          <entry>
           <para>
            pam_stress.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_ck_connector.so
           </para>
          </entry>
          <entry>
           <para>
            pam_keyinit.so
           </para>
          </entry>
          <entry>
           <para>
            pam_p11_openssh.so
           </para>
          </entry>
          <entry>
           <para>
            pam_succeed_if.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_cracklib.so
           </para>
          </entry>
          <entry>
           <para>
            pam_krb5afs.so
           </para>
          </entry>
          <entry>
           <para>
            pam_permit.so
           </para>
          </entry>
          <entry>
           <para>
            pam_tally2.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_cryptpass.so
           </para>
          </entry>
          <entry>
           <para>
            pam_krb5.so
           </para>
          </entry>
          <entry>
           <para>
            pam_pkcs11.so
           </para>
          </entry>
          <entry>
           <para>
            pam_tally.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_csync.so
           </para>
          </entry>
          <entry>
           <para>
            pam_lastlog.so
           </para>
          </entry>
          <entry>
           <para>
            pam_pwcheck.so
           </para>
          </entry>
          <entry>
           <para>
            pam_time.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_debug.so
           </para>
          </entry>
          <entry>
           <para>
            pam_ldap.so
           </para>
          </entry>
          <entry>
           <para>
            pam_pwhistory.so
           </para>
          </entry>
          <entry>
           <para>
            pam_tty_audit.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_deny.so
           </para>
          </entry>
          <entry>
           <para>
            pam_limits.so
           </para>
          </entry>
          <entry>
           <para>
            pam_radius_auth.so
           </para>
          </entry>
          <entry>
           <para>
            pam_umask.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_echo.so
           </para>
          </entry>
          <entry>
           <para>
            pam_listfile.so
           </para>
          </entry>
          <entry>
           <para>
            pam_rhosts.so
           </para>
          </entry>
          <entry>
           <para>
            pam_unix2.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_env.so
           </para>
          </entry>
          <entry>
           <para>
            pam_localuser.so
           </para>
          </entry>
          <entry>
           <para>
            pam_rootok.so
           </para>
          </entry>
          <entry>
           <para>
            pam_unix_acct.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_exec.so
           </para>
          </entry>
          <entry>
           <para>
            pam_loginuid.so
           </para>
          </entry>
          <entry>
           <para>
            pam_rpasswd.so
           </para>
          </entry>
          <entry>
           <para>
            pam_unix_auth.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_faildelay.so
           </para>
          </entry>
          <entry>
           <para>
            pam_mail.so
           </para>
          </entry>
          <entry>
           <para>
            pam_securetty.so
           </para>
          </entry>
          <entry>
           <para>
            pam_unix_passwd.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_filter.so
           </para>
          </entry>
          <entry>
           <para>
            pam_make.so
           </para>
          </entry>
          <entry>
           <para>
            pam_selinux.so
           </para>
          </entry>
          <entry>
           <para>
            pam_unix_session.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_fp.so
           </para>
          </entry>
          <entry>
           <para>
            pam_mkhomedir.so
           </para>
          </entry>
          <entry>
           <para>
            pam_sepermit.so
           </para>
          </entry>
          <entry>
           <para>
            pam_unix.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_ftp.so
           </para>
          </entry>
          <entry>
           <para>
            pam_motd.so
           </para>
          </entry>
          <entry>
           <para>
            pam_shells.so
           </para>
          </entry>
          <entry>
           <para>
            pam_userdb.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_gnome_keyring.so
           </para>
          </entry>
          <entry>
           <para>
            pam_mount.so
           </para>
          </entry>
          <entry>
           <para>
            pam_smb_auth.so
           </para>
          </entry>
          <entry>
           <para>
            pam_warn.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_group.so
           </para>
          </entry>
          <entry>
           <para>
            pam_namespace.so
           </para>
          </entry>
          <entry>
           <para>
            pam_smbpass.so
           </para>
          </entry>
          <entry>
           <para>
            pam_wheel.so
           </para>
          </entry>
         </row>
         <row>
          <entry>
           <para>
            pam_xauth.so
           </para>
          </entry>
          <entry></entry>
          <entry></entry>
          <entry></entry>
         </row>
        </tbody>
       </tgroup>
      </table>
      <para>
       Not all of these modules are used in the EAL 4+ evaluation, however
       as previously stated, each of these modules has its own README.
       Please refer to the System Administrators Guide for PAM and the
       READMEs for more information and reference.
      </para>
      <para>
       Following are the pam configuration files:
      </para>
     <sect4
      id="cha.setup_for_eal.securing.background.pam.required.common-password">
       <title>Configuration of <filename>/etc/pam.d/common-password</filename></title>
      <screen>#
# /etc/pam.d/common-password - password-related modules common to all services
# CAPP configuration
#
# This file is included from other service-specific PAM config files,
# and should contain a list of modules that define the services to be
# used to change user passwords. The default is pam_unix2 in combination
# with pam_pwcheck.
# The "nullok" option allows users to change an empty password, else
# empty passwords are treated as locked accounts.
#
# To enable Blowfish or MD5 passwords, you should edit
# /etc/default/passwd.
#
# Alternate strength checking for passwords should be configured
# in /etc/security/pam_pwcheck.conf.
#
# pam_make can be used to rebuild NIS maps after password change.
#
password requisite pam_passwdqc.so ask_oldauthtok=update check_oldauthtok
password requisite pam_pwcheck.so use_first_pass use_authtok
password required pam_unix2.so use_first_pass use_authtok</screen>
     </sect4>

      <sect4 id="cha.setup_for_eal.securing.background.pam.required.login">
       <title>Configuration of <filename>/etc/pam.d/login</filename></title>
       <para>
        This file configures the behavior of the login program. It allows root
        login only for terminals configured in
        <filename>/etc/securetty</filename>. If the file
        <filename>/etc/nologin</filename> is present, then only root can log
        in. The optional <literal>pam_env</literal> module
        <emphasis>may</emphasis> be used to set environment variables from
        <filename>/etc/security/pam_env.conf</filename>. The optional
        <literal>pam_mail</literal> module <emphasis>may</emphasis> be used to
        notify the user that there is new mail. The
        <literal>pam_tally</literal> module <emphasis>must</emphasis> be used
        to block the user after 5 failed login attempts. The optional
        <literal>pam_limits</literal> module <emphasis>may</emphasis> be used
        to enforce resource limits via
        <filename>/etc/security/limits.conf</filename>.
       </para>
       <para>
        The <literal>pam_loginuid.so</literal> module is by default configured
        to be <literal>optional</literal> instead of
        <literal>required</literal>, which assumes that all terminals
        available for login are in physically secure locations and accessible
        only for authorized administrators. This permits administrators to log
        in on the console even if the audit subsystem is not available. If any
        serial terminals are attached and available for arbitrary users, you
        <emphasis>must</emphasis> specify the
        <literal>pam_loginuid.so</literal> module to be required to ensure the
        CAPP-compliant fail-secure operating mode that disables login if audit
        is not working. Please refer to FIXME section 2.4.7 <quote>Using
         serial terminals</quote> of this guide for more information.
       </para>
       <screen>#%PAM-1.0
auth required pam_securetty.so
auth required pam_tally.so deny=5 onerr=fail
auth include common-auth
auth required pam_nologin.so
account include common-account
account required pam_tally.so
password include common-password
session include common-session
session required pam_lastlog.so nowtmp
session required pam_resmgr.so
session optional pam_mail.so standard
session optional pam_loginuid.so # no lockout on failure</screen>
      </sect4>

      <sect4 id="cha.setup_for_eal.securing.background.pam.required.sshd">
       <title>Configuration of <filename>/etc/pam.d/sshd</filename></title>
       <para>
        This file configures the PAM usage for SSH.
       </para>
       <screen>#%PAM-1.0
auth required pam_securetty.so # deny root login in evaluated config
auth required pam_tally.so deny=5 onerr=fail
auth include common-auth
auth required pam_nologin.so
account include common-account
account required pam_tally.so
password include common-password
session include common-session
session required pam_loginuid.so require_auditd</screen>
     </sect4>

     <sect4 id="cha.setup_for_eal.securing.background.pam.required.su">
       <title>Configuration of <filename>/etc/pam.d/su</filename></title>
      <para>
        This file configures the behavior of the <command>su</command>
        command. Only users in the <systemitem
         class="groupname">trusted</systemitem> group can use it to become
        &rootuser;, as configured with the <literal>pam_wheel</literal>
        module.
      </para>
      <screen>#%PAM-1.0
auth sufficient pam_rootok.so
auth required pam_wheel.so use_uid group=trusted
auth include common-auth
account include common-account
password required pam_deny.so
session include common-session
session optional pam_xauth.so</screen>
      <para>
        Forcing the &rootuser; user to change the root password is not desired
        here, therefore the <literal>pam_unix2.so</literal> module is absent
        in the password branch and <literal>pam_deny.so</literal> is used
        instead.
      </para>
     </sect4>

     <sect4 id="cha.setup_for_eal.securing.background.pam.required.vsftpd">
       <title>Configuration of <filename>/etc/pam.d/vsftpd</filename></title>
      <para>
        This file configures the authentication for the FTP daemon. With the
        listfile module, users listed in <filename>/etc/ftpusers</filename>
        are denied FTP access to the system.
      </para>
      <screen>#%PAM-1.0
auth required pam_listfile.so item=user sense=deny \
file=/etc/ftpusers onerr=succeed
auth required pam_tally.so deny=5 onerr=fail
auth include common-auth
account include common-account
account required pam_tally.so
account required pam_loginuid.so require_auditd
password required pam_deny.so
session include common-session</screen>
      <para>
        Note that the FTP protocol has no provisions for changing passwords,
        therefore the <literal>pam_unix2.so</literal> module is absent in the
        password branch and <literal>pam_deny.so</literal> is used instead.
      </para>
     </sect4>

     <sect4 id="cha.setup_for_eal.securing.background.pam.required.cron">
       <title>Configuration of <filename>/etc/pam.d/crond</filename></title>
      <para>
       This file configures the cron service to ensure that tasks run on a
       user's behalf have the correct associated audit uid.
      </para>
      <screen>#
# The PAM configuration file for the cron daemon
#
#
auth sufficient pam_rootok.so
auth include common-auth
account include common-account
password include common-password
session include common-session
session required pam_loginuid.so require_auditd</screen>
     </sect4>

     <sect4 id="cha.setup_for_eal.securing.background.pam.required.pw_check">
       <title>Configuration of <filename>/etc/security/pam_pwcheck.conf</filename></title>
      <para>
        This file contains the default options for the
        <literal>pam_pwcheck</literal> module. This makes it easier to set a
        global policy. The <literal>md5</literal> option enables long
        passwords (up to 127 characters, see also the limit in
        <filename>/etc/login.defs</filename>), and the use of the
        <literal>cracklib</literal> option activates password quality checks
        against standard dictionary and permutation attacks. The remember
        option ensures that the user does not reuse passwords by keeping track
        of the specified number of previously used passwords in the file
        <filename>/etc/security/opasswd</filename>.
      </para>
      <screen>password: md5 cracklib remember=7</screen>
     </sect4>

     <sect4 id="cha.setup_for_eal.securing.background.pam.required.unix2">
      <title>Configuration of <filename>/etc/security/pam_unix2.conf</filename></title>
      <para>
       This file contains the default options for the
       <literal>pam_unix2</literal> module. This makes it easier to set a
       global policy. The <literal>md5</literal> option enables long passwords
       (up to 127 characters, see also the limit in
       <filename>/etc/login.defs</filename>). The <literal>trace</literal>
       option activates session tracing (start/stop) via syslog.
      </para>
      <screen>Auth:
account:
password: md5
session: trace</screen>
     </sect4>
     </sect3>
    </sect2>
    <sect2 id="cha.setup_for_eal.securing.background.login_defs">
     <title>Set up of Login Controls</title>
     <para>
      The system supports various options to control log ins in
      <filename>/etc/login.defs</filename>. Comments in the file explain the
      options and values that <emphasis>must</emphasis> be set for this EAL4
      evaluated configuration.
     </para>
     <para>
      The <literal>UMASK</literal> entry sets the default permissions for new
      home directories to the most restrictive setting. Users
      <emphasis>may</emphasis> assign different permissions as described in
      section FIXME 2.6.4 <quote>Access control for files and
       directories</quote> of this guide. Note that the default umask for
      logged-in users is set in the <filename>/etc/profile</filename> file,
      not here.
     </para>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.background.cracklib">
     <title>Maintaining cracklib Dictionaries</title>
     <para>
      The dictionary files used by cracklib are stored in
      <filename>/usr/lib/</filename>:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <filename>/usr/lib/cracklib_dict.hwm</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        /usr/lib/cracklib_dict.pwd
       </para>
      </listitem>
      <listitem>
       <para>
        /usr/lib/cracklib_dict.pwi
       </para>
      </listitem>
     </itemizedlist>
     <para>
      To create custom dictionary files instead of the supplied ones, the
      command <filename>/usr/sbin/create-cracklib-dict</filename>
      <emphasis>may</emphasis> be used as follows:
     </para>
     <screen>/usr/sbin/create-cracklib-dict <replaceable>wordlist1</replaceable> <replaceable>wordlist2</replaceable> <replaceable>...</replaceable></screen>
     <para>
      This will generate a new set of dictionary files from the supplied word
      lists. Suggested words lists are included in the source RPM package of
      cracklib. We <emphasis>recommend</emphasis> adding dictionaries for your
      local language and other languages likely to be known by your user
      community.
     </para>
    </sect2>

    <sect2 id="cha.setup_for_eal.securing.background.boot">
     <title>Configuring the Boot Loader</title>
     <para>
      You <emphasis>must</emphasis> set up the server in a secure location
      where it is protected from unauthorized access. Even though that is
      sufficient to protect the boot process, it is
      <emphasis>recommended</emphasis> to configure the following additional
      protection mechanisms:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Ensure that the installed system boots exclusively from the disk
        partition containing &productname;, and not from floppy disks, USB
        drives, CD/DVD-ROMs, network adapters, or other devices. Again, this
        may require a change to the BIOS to modify/specify bootable devices.
       </para>
      </listitem>
      <listitem>
       <para>
        Ensure that this setting cannot be modified, for example by using a
        BootProm/BIOS password to protect access to the configuration.
       </para>
      </listitem>
     </itemizedlist>
     <sect3 id="cha.setup_for_eal.securing.background.boot.grub">
      <title>&grub; Boot Loader Configuration</title>
      <para>
       The &grub; boot loader is used on the x86 and Opteron platforms. It is
       highly configurable, and permits flexible modifications at boot time
       through a special-purpose command line interface. Please refer to the
       <literal>grub</literal> man page or run <command>info grub</command>
       for more information.
      </para>
      <orderedlist>
       <listitem>
        <para>
         Use the password option in <filename>/boot/grub/menu.lst</filename>
         to prevent unauthorized use of the boot loader interface.
        </para>
       </listitem>
      </orderedlist>
      <para>
       Using md5 encoded passwords is <emphasis>recommended</emphasis>, run
       the command <command>grub-md5-crypt</command> to generate the encoded
       version of a password (you can copy it into the example below).
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Protect all menu entries other than the default &productname; boot
         with the lock option, so that the boot loader will prompt for a
         password when the user attempts to boot from other media (such as a
         floppy) or sets other non-default options for the boot process. To
         implement this, add a line containing just the keyword lock after
         the title entry in the <filename>/boot/grub/menu.lst</filename> file.
        </para>
       </listitem>
       <listitem>
        <para>
         Remove group and world read permissions from the grub configuration
         file if it contains a password by running the following command:
        </para>
        <screen>chmod 600 /boot/grub/menu.lst</screen>
       </listitem>
      </itemizedlist>
      <para>
       The following example of the <filename>/boot/grub/menu.lst</filename> configuration file
      shows <emphasis>recommended</emphasis> settings:
      </para>
      <note>
       <para>
        The password hash is just an example, you will have a different hash,
        hopefully.
       </para>
      </note>
     <screen>color white/blue black/light-gray
default 0
timeout 8
password --md5 $1$O471l/$H/JW2MYeugX6Y1h3v.1Iz0
title linux
kernel (hd0,1)/boot/vmlinuz root=/dev/sda2
initrd (hd0,1)/boot/initrd
title failsafe
lock
kernel (hd0,1)/boot/vmlinuz.shipped root=/dev/sda2 ide=nodma apm=off \
acpi=off vga=normal nosmp disableapic maxcpus=0 3
initrd (hd0,1)/boot/initrd.shipped</screen>
     <para>
      Again, note that the configuration shown here might not be exactly the
      configuration used on the installed system, depending on the kernel
      options needed for the hardware, password, etc.
     </para>
    </sect3>

    <sect3 id="cha.setup_for_eal.securing.background.boot.yaboot">
     <title>&ipseries; Yaboot Boot Loader Configuration</title>
     <para>
       Yaboot is used on &ipseries;; it is an OpenFirmware-based boot loader,
       which can be reconfigured at boot time from a specialized command line.
     </para>
     <para>
      Yaboot and &grub; are very similar, and both of them support
      MD5-encrypted passwords specified in their configuration files.
     </para>
     <para>
       The configuration is contained in the
       <filename>/etc/lilo.conf</filename> file. Running the lilo tool creates
       the <filename>yaboot.conf</filename> file based on the information in
       the <filename>/etc/lilo.conf</filename> file.
     </para>
     <para>
      You need to re-run the lilo tool when you have modified the
      configuration file; this is however not necessary if you replace a
      kernel and keep all path names unchanged.
     </para>
     <para>
       Please refer to <!-- FIXME <xref linkend="cha.ppc"/> -->, the
       <filename>yaboot.conf</filename> and <command>lilo</command> manual
       pages, and the yaboot HOWTO (<ulink
        url="http://penguinppc.org/projects/yaboot/doc/yaboot-howto.shtml"/>)
       for more information.
     </para>
    </sect3>

    <sect3 id="cha.setup_for_eal.securing.background.boot.zipl">
     <title>ZIPL Boot Loader Configuration</title>
     <para>
      The ZIPL boot loader is used on the &zseries; mainframe when the system
      is set up using the VM virtualization layer.
     </para>
     <para>
      In this context, <quote>booting</quote> refers to the initial program
      load (IPL) done from the CP command prompt, which affects only a
      single specific Linux instance (a.k.a. <quote>partition</quote>, which
      refers to the running system and not the disk partition in this
      context).
     </para>
     <para>
       Configuration of the VM system is beyond the scope of this document.
       You <emphasis>must</emphasis> ensure that the configuration settings
       and virtual devices used are only accessible to the authorized
       administrators. Do <emphasis>not</emphasis> use unencrypted 3270
       sessions for console access on insecure networks.
     </para>
     <para>
       ZIPL writes a boot record on the virtual disk (DASD) used by this Linux
       instance, this boot record then proceeds to load and run the Linux
       kernel itself. The <command>zipl</command> command
       <emphasis>must</emphasis> be re-run after any kernel or boot argument
       modifications.
     </para>
     <para>
       Please refer to the <command>zipl</command> man page for more
       information.
     </para>
     <para>
       The following example shows a typical
       <filename>/etc/zipl.conf</filename> file:
     </para>
     <screen># Generated by &yast;2
[defaultboot]
default=ipl
[ipl]
target=/boot/zipl
image=/boot/kernel/image
ramdisk=/boot/initrd
parameters="dasd=0200 root=/dev/dasda1"</screen>
     </sect3>
    </sect2>
   </sect1>
  </chapter>

  <chapter id="cha.setup_for_eal.operating">
   <title>System Operation Procedures for Secure Systems (Part 4)</title>
   <para>
    To ensure that the system remains in a secure state, special care
    <emphasis>must</emphasis> be taken during system operation.
   </para>
   
   <note>
    <title></title>
    <para>
     This concludes the tasks that are actually performed by the
     automated configuration script described in <xref
      linkend="cha.setup_for_eal.securing.autoconfig"/>.
    </para>
   </note>
   
   <sect1 id="sec.setup_for_eal.operating.start_stop">
    <title>System Startup, Shutdown and Crash Recovery Procedures</title>
    <para>
     Use the <command>shutdown</command>, <command>halt</command> or
     <command>reboot</command> programs as needed to <quote>shut down</quote>
     or <quote>reboot</quote> the system.
    </para>
    <para>
     When powered on (or on initial program load (IPL) of the logical
     partition (LPAR) on a host system), the system will boot into the
     &productname; operating system. If necessary (for example after a
     crash), a filesystem check may be performed automatically.
    </para>
    <para>
     In rare cases, manual intervention for filesystem checks may be
     necessary. Please refer to the <command>e2fsck</command> (in the case of
     an ext2 filesystem) and <literal>debugfs</literal> documentation for
     details in this case.
    </para>
    <para>
     In case a nonstandard boot process is needed (such as booting from
     floppy disk or CD/DVD-ROM or network, perhaps to replace a defective
     hard drive), interaction with the boot loader and/or the host's
     management system can be used to modify the boot procedure for
     recovery. This obviously might require physical access to the host or
     some sort of remote management device.
    </para>
    <para>
     For example, on systems using the grub boot loader you can use the
     following commands to launch a shell directly from the kernel,
     bypassing the normal init/login mechanism:
    </para>
    <screen># view the current grub configuration
grub> cat (hd0,1)/boot/grub/menu.lst

# manually enter the modified settings
grub> kernel (hd0,1)/boot/vmlinuz root=/dev/sda1 init=/bin/sh
grub> initrd (hd0,1)/boot/initrd
grub> boot</screen>
    <para>
     Please refer to the relevant documentation of the boot loader, as well as
     the <!-- FIXME <xref linkend="book.sle.admin"/> --> &productname;
     administrator guide, for more information.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.backup">
    <title>Backup and Restore</title>
    <para>
     Whenever you make changes to security-critical files, you
     <emphasis>may</emphasis> need to be able to track the changes made and
     revert to previous versions, but this is not required for compliance
     with the evaluated configuration.
    </para>
    <para>
     The star archiver is <emphasis>recommended</emphasis> for backups of
     complete directory contents, please refer to FIXME section 2.6.5 “Data
     import / export” of this guide. Regular backups of the following
     files and directories (on removable media such as tapes or DVD-R/CD-R,
     or on a separate host) are <emphasis>recommended</emphasis>:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <filename>/etc/</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       /var/spool/cron/
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Depending on your site's audit requirements, also include the contents of
     <filename>/var/log/</filename> in the backup plan. In that case, the
     automatic daily log file rotation needs to be disabled or synchronized
     with the backup mechanism, refer to FIXME sections 2.5.2 <quote>System
      logging and accounting</quote> and FIXME 2.5.3 <quote>Configuring the
      audit subsystem</quote> of this guide for more information.
    </para>
    <para>
     You <emphasis>must</emphasis> protect the backup media from unauthorized
     access, because the copied data does not have the access control
     mechanisms of the original file system. Among other critical data, it
     contains the secret keys used by the SSH and stunnel servers, as well as
     the <filename>/etc/shadow</filename> password database. Store the backup
     media at least as securely as the server itself.
    </para>
    <para>
     A <emphasis>recommended</emphasis> method to track changes is to use a
     version control system or some tool that can streamline changes at a file
     level. Xdelta (in &productname; 11) is a robust tool that can be
     leveraged to compute changes between files and even generate patches or
     deltas that can be applied. The main <quote>diff</quote>erence between
     Xdelta and the diff utility is that the files that Xdelta generates are
     not human readable (very secure) it can work with text or binary files
     (versatile) and it uses a fast linear algorithm (for speed). Xdelta by
     default also does MD5 integrity checking (another security benefit) and
     can work with <command>gzip</command> (compressed) files. Other
     versioning tools like Subversion, CVS or even RCS exist. While Subversion
     is included with versions of &productname;, you should check for CVS or
     RCS if you choose to use them. A major benefit to using RCS is the ease
     of set up. It does not require setting up a central repository (like
     Subversion or CVS) for the changes. Also you can use shell scripting to
     automate the change tracking. The EAL configuration did not include RCS
     in the installed packages but you can view <filename>rcsintro</filename>
     from the rcs RPM package for more information and decide whether to
     install it. Otherwise, you can manually create backup copies of the
     files, use diff or Xdelta for versioning (if desired) and/or copy them to
     other servers using <command>scp</command> (secure copy).
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.root">
    <title>Gaining Superuser Access</title>
    <para>
     System administration tasks require superuser privileges. Since
     directly logging on over the network as user &rootuser; is disabled, you
     <emphasis>must</emphasis> first authenticate using an unprivileged user
     ID, and then use the <command>su</command> command to switch identities.
    </para>
    <para>
     Note that you <emphasis>must not</emphasis> use the &rootuser; rights for
     anything other than those administrative tasks that require these
     privileges, all other tasks <emphasis>must</emphasis> be done using
     your normal (non-root) user ID.
    </para>
    <para>
     You <emphasis>must</emphasis> use exactly the following
     <command>su</command> command line to gain superuser access:
    </para>
    <screen>/bin/su -</screen>
    
    <important>
     <title><command>su</command> syntax</title>
     <para>
      The syntax is important – note the trailing <quote>-</quote> on the su
      command – <emphasis>and</emphasis> the preceding explicit path
      <filename>/bin/su</filename> to the binary. This explicit usage ensures
      that the correct binary is executed irrespective of <envar>PATH</envar>
      settings or shell aliases, and that the root shell starts with a clean
      environment not contaminated with the starting user's settings. This is
      necessary because the <filename>.profile</filename> shell configuration
      and other similar files are writable for the unprivileged ID, which
      would allow an attacker to easily elevate privileges to root if able to
      subvert these settings. This should be considered a <quote>best
       practice</quote> for all root usage.
     </para>
    </important>
    <important>
     <para>
      Keep the &rootuser; user environment clean and secure!
     </para>
     <para>
      Administrators <emphasis>must not</emphasis> add any directory to the
      root user's <envar>PATH</envar> that are writable for anyone other than
      &rootuser;, and similarly <emphasis>must not</emphasis> use or execute
      any scripts, binaries or configuration files that are writable for
      anyone other than &rootuser;, or where any containing directory is
      writable for a user other than &rootuser;.
     </para>
    </important>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.install_software">
    <title>Installation of Additional Software</title>
    <para>
     Additional software packages <emphasis>may</emphasis> be installed as
     needed, provided that they do not conflict with the security
     requirements.
    </para>
    <para>
     Any additional software added is not intended to be used with superuser
     privileges. The administrator <emphasis>must</emphasis> use only those
     programs that are part of the original evaluated configuration for
     administration tasks, except if the administrator has independently
     ensured that use of the additional software is not a security risk.
    </para>
    <para>
     Administrators <emphasis>may</emphasis> add scripts to automate tasks
     as long as those only depend on and run programs that are part of the
     evaluated configuration.
    </para>
    <para>
     The security requirements for additional software are:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Kernel modules other than those provided as part of the evaluated
       configuration <emphasis>must not</emphasis> be installed or loaded. You
       <emphasis>must not</emphasis> load the tux kernel module (the in-kernel
       web server is not supported). You <emphasis>must not</emphasis> add
       support for non-ELF binary formats or foreign binary format emulation
       that circumvents system call auditing. You <emphasis>must
        not</emphasis> activate <systemitem class="daemon">knfsd</systemitem>
       or export NFS file systems.
      </para>
     </listitem>
     <listitem>
      <para>
       Device special nodes <emphasis>must not</emphasis> be added to the
       system.
      </para>
     </listitem>
     <listitem>
      <para>
       SUID root or SGID root programs <emphasis>must not</emphasis> be
       added to the system. Programs which use the SUID or SGID bits to run
       with identities other than &rootuser; <emphasis>may</emphasis> be added.
      </para>
     </listitem>
     <listitem>
      <para>
       The content, permissions, and ownership of all existing filesystem
       objects (including directories and device nodes) that are part of the
       evaluated configuration <emphasis>must not</emphasis> be modified.
       Files and directories <emphasis>may</emphasis> be added to existing
       directories provided that this does not violate any other
       requirement.
      </para>
     </listitem>
     <listitem>
      <para>
       Programs automatically launched with &rootuser; privileges <emphasis>must
        not</emphasis> be added to the system.
      </para>
      <para>
       Exception: processes that immediately and permanently switch to a non
       privileged identity on launch are permitted, for example by using
      </para>
      <screen>su <replaceable>USERID</replaceable> -c <replaceable>LAUNCH COMMAND</replaceable> </screen>
      <para>
       in the startup file, or alternatively by using the setgroups, setgid and
       setuid system calls in a binary. The use of equivalency set commands from
       libc or glibc (e.g. <literal>seteuid</literal>,
       <literal>setegid</literal>, <literal>setreuid</literal> etc.) are
       <emphasis>not</emphasis> sufficient.
      </para>
      <para>
       Automatic launch mechanisms are:
      </para>
      <simplelist>
       <member>
        Entries in <filename>/etc/inittab</filename>
       </member>
       <member>
        Executable files or links in <filename>/etc/init.d/</filename> and its
        subdirectories
       </member>
       <member>
        Entries in <filename>/etc/xinetd.conf</filename>
       </member>
       <member>
        Scheduled jobs using cron (including entries in
        <filename>/etc/cron*</filename> files) or at
       </member>
      </simplelist>
     </listitem>
    </itemizedlist>
    <para>
     Examples of programs that usually do not conflict with these
     requirements and <emphasis>may</emphasis> be installed are compilers,
     interpreters, network services running with non-root rights, and
     similar programs. The requirements listed above
     <emphasis>must</emphasis> be verified in each specific case.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.cron">
    <title>Scheduling Pocesses Using Cron</title>
    <para>
     The cron program schedules programs for execution at regular intervals.
     Entries can be modified using the crontab program. The file format is
     documented in the crontab man page.
    </para>
    <para>
     You <emphasis>must</emphasis> follow the rules specified for
     installation of additional programs for all entries that will be
     executed by the &rootuser; user. Use non-root crontab entries in all cases
     where &rootuser; privileges are not absolutely necessary.
    </para>
    <para>
     Errors in the non interactive jobs executed by cron are reported in the
     system log files in <filename>/var/log/</filename>, and additionally via
     e-mail to the user who scheduled it.
    </para>
    <para>
     Permission for users to schedule jobs with cron is controlled through
     the following allow and deny files:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <filename>/etc/cron.allow</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       <filename>/etc/cron.deny</filename>
      </para>
     </listitem>
    </itemizedlist>
    <para>
     The allow file has precedence if it exists, then only those users whose
     usernames are listed in it are permitted to use the service. If it does
     not exist, the deny file is used instead and all users who are not
     listed in that file can use the service.
    </para>
    <para>
     Note that the contents of these files are only relevant when the
     scheduling commands are executed, and changes have no effect on already
     scheduled commands.
    </para>
    <para>
     In the &productname; distribution, the allow file does not exist, and
     the deny file is used to prevent system-internal IDs and/or guest users
     from using the service. By default, the evaluated configuration permits
     all non-system users to use cron.
    </para>
    <para>
     It is <emphasis>recommended</emphasis> to restrict the use of cron to
     human users and disallow system accounts from using these mechanisms.
     For example, the following commands add all system accounts other than
     root to the deny files:
    </para>
    <screen>awk -F: '{if ($3&gt;0 &amp;&amp; $3&lt;100) print $1}' \
/etc/passwd &gt;&gt;/etc/cron.deny
chmod 600 /etc/cron.deny</screen>
    <para>
     Administrators <emphasis>may</emphasis> schedule jobs that will be run
     with the privileges of a specified user by editing the file
     <filename>/etc/crontab</filename> with an appropriate username in the
     sixth field. Note the sixth field (username) pertains only in the system
     crontab NOT other cron entries which have the sixth field as the command
     to execute. The fields correspond to minute, hour, day of the month,
     month, day of the week, username (in the system crontab) OR command.
    </para>
    <note>
     <para>
      Entries in /etc/crontab are not restricted by the contents of the allow
      and deny files.
     </para>
    </note>
    <para>
     You <emphasis>may</emphasis> create a
     <filename>/etc/cron.allow</filename> file to explicitly list users who
     are permitted to use this service. If you do create the file, it
     <emphasis>must</emphasis> be owned by the user &rootuser; and have file
     permissions 0600 (no access for group or others).
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.mount">
    <title>Mounting Filesystems</title>
    <para>
     If any filesystems need to be mounted in addition to those set up at
     installation time, appropriate mount options <emphasis>must</emphasis>
     be used to ensure that mounting the filesystem does not introduce
     capabilities that could violate the security policy.
    </para>
    <para>
     The special-purpose <literal>proc</literal>, <literal>sysfs</literal>,
     and <literal>tmpfs</literal> filesystems are part of the evaluated
     configuration. These are virtual filesystems with no underlying physical
     storage, and represent data structures in kernel memory. Access to
     contents in these special filesystems is protected by the normal
     discretionary access control policy and additional permission checks.
    </para>
    <para>
     Note that changing ownership or permissions of virtual files and
     directories is generally NOT supported for the <literal>proc</literal>
     and <literal>sysfs</literal> filesystems (corresponding to directories
     <filename>/proc/</filename> and <filename>/sys/</filename>), and attempts
     to do so will be ignored or result in error messages.
    </para>
    <para>
     Note that use of the <literal>usbfs</literal> filesystem type is
     <emphasis>not</emphasis> permitted (and not needed) in the evaluated
     configuration.
    </para>
    <para>
     A new file system can be integrated as part of the evaluated
     configuration, for example by installing an additional hard disk, under
     the following conditions:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       The disk must be protected against theft or manipulation in the same
       way as the server itself (i.e. the server is in a locked cabinet, in
       a secure room, etc), for example by being installed inside the server
       or in a drive bay of that protected server.
      </para>
     </listitem>
     <listitem>
      <para>
       One or more new, empty, file systems in EXT3 format are created.
      </para>
     </listitem>
     <listitem>
      <para>
       The file systems are mounted using the acl option, for example with
       the following setting in the /etc/fstab file:
      </para>
      <screen>/dev/sdc1 	/home2 	ext3 	acl 	1 2</screen>
      <para>
       Existing files and directories <emphasis>may</emphasis> then be moved
       onto the new file systems.
      </para>
     </listitem>
    </itemizedlist>
    </orderedlist>
    <note>
     <title>Removing a Device Containing a Filesystem</title>
     <para>
      If a device containing a file system is ever removed from the system,
      the device <emphasis>must</emphasis> be stored within the secure server
      facility, or alternatively <emphasis>must</emphasis> be destroyed in a
      way that the data on it is reliably erased. Many companies (or
      government agencies) dictate data <quote>shredding</quote> policies that
      require the use of 3rd Party tools, or at least methods for wiping data
      from media. These can include successive writes in a variety of patterns
      to a hard-disk, alternating 1s and 0s, butterfly patterns, all Fs...
      etc. Even the use of powerful electromagnet <quote>erasers</quote> are
      sometimes prescribed for cleaning old magnetic tapes (from backups).
     </para>
    </note>
    <para>
     Alternatively, media <emphasis>may</emphasis> be accessed without
     integrating them into the evaluated configuration (for example CD-ROMs
     or DVDs) with the following conditions:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       CD/DVD devices <emphasis>must</emphasis> be accessed using the iso9660
       filesystem type. Using the <literal>subfs</literal> automounter is
       <emphasis>not</emphasis> permitted in the evaluated configuration. See
       also FIXME section 2.3.2 <quote>Filesystem configuration</quote> of this
       guide.
      </para>
     </listitem>
    </itemizedlist>
    <para>
     The following mount options <emphasis>must</emphasis> be used if the
     filesystems contain data that is not part of the evaluated
     configuration:
    </para>
    <screen>ro,nodev,nosuid</screen>
    <para>
     Adding the <literal>noexec</literal> mount option to avoid accidental
     execution of files or scripts on additional mounted filesystems is
     <emphasis>recommended</emphasis>.
    </para>
    <para>
     Note that these settings do not completely protect against malicious
     code and data, you <emphasis>must</emphasis> also verify that the data
     originates from a trustworthy source and does not compromise the
     server's security. Specifically, be aware of the following issues:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Even unprivileged programs and scripts can contain malicious code
       that uses the calling user's rights in unintended ways, such as
       corrupting the user's data, introducing Trojan horses in the
       system, attacking other machines on the network, revealing
       confidential documents, or sending unsolicited commercial e-mail
       (<quote>spam</quote>).
      </para>
     </listitem>
     <listitem>
      <para>
       Data on the additional filesystem <emphasis>must</emphasis> have
       appropriate access rights to prevent disclosure to or modification by
       unauthorized users. Be aware that imported data may have been created
       using user names and permissions that do not match your system's
       security policies.
      </para>
     </listitem>
     <listitem>
      <para>
       You <emphasis>must not</emphasis> write data on removable file
       systems such as floppy disks, since it cannot be adequately protected
       by the system's access control mechanisms after being removed from
       the system. Please refer to FIXME section 2.4.2 <quote>Backup and
       restore</quote> of this guide for more information regarding
       non-filesystem-based backup.
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Each new file system <emphasis>must</emphasis> be mounted on an empty
     directory that is not used for any other purpose. It is
     <emphasis>recommended</emphasis> using subdirectories of
     <filename>/media</filename> for temporary disk and removable storage media
     mounts, for example:
    </para>
    <screen>mount /dev/cdrom /media/cdrom -t iso9660 -o ro,nodev,nosuid,noexec</screen>
    <para>
     You <emphasis>may</emphasis> also add an equivalent configuration to
     <filename>/etc/fstab</filename>, for example:
    </para>
    <screen>/dev/cdrom /media/cdrom iso9660 ro,noauto,nodev,nosuid,noexec 0 0</screen>
    <para>
     You <emphasis>must not</emphasis> include the user flag. Ordinary users
     are not permitted to mount filesystems. This is also enforced by the
     deletion of the SUID bit on the mount command.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.user">
    <title>Managing User Accounts</title>
    <para>
     Use the <command>useradd</command> command to create new user accounts,
     then use the <command>passwd</command> command to assign an initial
     password for the user. Alternatively, if the user is present when the
     account is created, permit them to choose their own password. Refer to
     the manual pages for <command>useradd</command> and
     <command>passwd</command> for more information.
    </para>
    <para>
     If you assign an initial password for a new user, you
     <emphasis>must</emphasis> transfer this initial password in a secure way
     to the user, ensuring that no third party gets the information. For
     example, you can tell the password to a user personally known to you. If
     this is not possible, you <emphasis>may</emphasis> send the password in
     written form in a sealed letter. This applies also when you set a new
     password for a user in case the user has forgotten the password or it has
     expired. You <emphasis>must</emphasis> advise the user that he
     <emphasis>must</emphasis> change this initial password when he first logs
     into the system and select his own password in accordance with the rules
     defined in FIXME section 2.6.3 <quote>Password policy</quote> of this
     guide.
    </para>
    <para>
     You <emphasis>must not</emphasis> use the <option>-p</option> option to
     <command>useradd</command>, specifying a password in that way would
     bypass the password quality checking mechanism.
    </para>
    <para>
     The temporary password set by the administrator <emphasis>must</emphasis>
     be changed by the user as soon as possible. Use the
     <command>chage</command> command with the <option>-d</option> option to
     set the last password change date to a value where the user will be
     reminded to change the password. The <emphasis>recommended</emphasis>
     value is based on the settings in <filename>/etc/login.defs</filename>
     and is equivalent to today's date plus <literal>PASS WARN AGE</literal>
     minus <literal>PASS MAX DAYS</literal>.
    </para>
    <example>
     <title>Adding a User Account</title>
     <screen>useradd -m -c "John Doe" jdoe
passwd jdoe
chage -d $(date +%F -d "53 days ago") jdoe</screen>
    </example>
    <para>
     The <option>-m</option> option to useradd creates a home directory for
     the user based on a copy of the contents of the
     <filename>/etc/skel/</filename> directory. Note that you
     <emphasis>may</emphasis> modify some default configuration settings for
     users, such as the default umask setting or time zone, by editing the
     corresponding global configuration files:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <filename>/etc/profile</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       <filename>/etc/bash.bashrc</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       <filename>/etc/csh.cshrc</filename>
      </para>
     </listitem>
    </itemizedlist>
    <para>
     If necessary, you <emphasis>may</emphasis> reset the user's password to a
     known value using <command>passwd
      <replaceable>USER</replaceable></command>, and entering the new
     password. You cannot recover the previously used password, since the hash
     function used is not reversible.
    </para>
    <para>
     You <emphasis>may</emphasis> use the <command>usermod</command> command
     to change a user's properties. For example, if you want to add the user
     <systemitem class="username">jdoe</systemitem> to the <systemitem
      class="groupname">trusted</systemitem> group, you could use the following:
    </para>
    <screen># List the groups the user is currently a member of:
groups jdoe

# Add the additional group
usermod -G $(su jdoe -c groups | sed 's/ /,/g'),trusted jdoe</screen>
    <para>
     Users <emphasis>may</emphasis> be locked out (disabled) using
     <command>passwd <option>-l
       <replaceable>USER</replaceable></option></command>, and re-enabled
     using <command>passwd <option>-u
       <replaceable>USER</replaceable></option></command>.
    </para>
    <para>
     The <literal>pam_tally.so</literal> PAM module enforces automatic lockout
     after excessive failed authentication attempts, as described in FIXME
     section 2.3.11 “Required Pluggable Authentication Module (PAM)
     configuration” of this guide. Use the program
     <command>pam_tally</command> to view and reset the counter if necessary,
     as documented in the file
     <filename>/usr/share/doc/pam-*/txts/README.pam_tally</filename>. Note
     that the <command>pam_tally</command> mechanism does not prevent password
     guessing attacks, it only prevents use of the account after such an
     attack has been detected. Therefore, you <emphasis>must</emphasis> assign
     a new password for the user before reactivating an account. For example:
    </para>
    <screen># view the current counter value
pam_tally --user jdoe

# set new password, and reset the counter
passwd jdoe
pam_tally --user jdoe --reset</screen>
    </para>
    <para>
     The <command>chage</command> utility <emphasis>may</emphasis> be used to
     view and modify the expiry settings for user accounts. Unprivileged users
     are able to view but not modify their own expiry settings.
    </para>
    <para>
     The <command>userdel</command> utility removes the user account from the
     system, but does not remove files outside the home directory (and the
     mail spool file), or kill processes belonging to this user. Use kill (or
     reboot the system) and find to do so manually if necessary, for example:
    </para>
    <screen># Which user to delete?
U=jdoe

# Lock user account, but don't remove it yet
passwd -l $U

# Kill all user processes, repeat if needed (or reboot)
kill -9 `ps -la --User $U|awk '{print $4}'`

# Recursively remove all files and directories belonging to user
# (Careful - this may delete files belonging to others if they are
#  stored in a directory owned by this user.)
find / -depth \( ! -fstype ext3 -prune -false \) \-o -user $U -exec rm -rf {} \;

# Remove cron jobs
crontab -u $U -r

# Now delete the account
userdel $U</screen>

    <para>
     If you need to create additional groups or modify existing groups, use
     the <command>groupadd</command>, <command>groupmod</command> and
     <command>groupdel</command> commands.
    </para>
    <para>
     Group passwords are <emphasis>not</emphasis> supported in the evaluated
     configuration, and have been disabled by removing the SUID bit from the
     <command>newgrp</command> program. You <emphasis>must not</emphasis>
     re-enable this feature and <emphasis>must not</emphasis> use
     <command>passwd</command> with the <option>-g</option> switch or the
     gpasswd command to set group passwords.
    </para>
   </sect1>

   <sect1 id="sec.setup_for_eal.operating.tty">
    <title>Using Serial Terminals (TTY)</title>
    <para>
     You <emphasis>may</emphasis> attach serial terminals to the system. They
     are activated by adding an entry in the file
     <filename>/etc/inittab</filename> for each serial terminal that causes
     init to launch an agetty process to monitor the serial line. agetty runs
     login to handle user authentication and set up the user's session.
    </para>
    <para>
     If you use serial terminals and require the CAPP-compliant fail-safe
     audit mode, you <emphasis>must</emphasis> ensure that the file
     <filename>/etc/pam.d/login</filename> is configured to require the
     <literal>pam_loginuid.so</literal> module in the session stack. Please
     refer to FIXME section 2.3.13 “/etc/pam.d/login” of this guide for more
     information about the needed PAM configuration.
    </para>
    <para>
     For example, adding the following line to
     <filename>/etc/inittab</filename> activates a VT102-compatible serial
     terminal on serial port <filename>/dev/ttyS1</filename>, communicating at
     19200 bits/s:
    </para>
    <screen>S1:3:respawn:/sbin/agetty 19200 ttyS1 vt102</screen>
    <para>
     The first field <emphasis>must</emphasis> be a unique identifier for the
     entry (typically the last characters of the device name). Please refer to
     the <command>agetty</command> and <literal>inittab</literal> man pages
     for further information about the format of entries.
    </para>
    <para>
     You <emphasis>must</emphasis> reinitialize the init daemon after any
     changes to <filename>/etc/inittab</filename> by running the following
     command:
    </para>
    <screen>init q</screen>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.sysv_memory">
    <title>SYSV Shared Memory and IPC Objects</title>
    <para>
     The system supports SYSV-compatible shared memory, interprocess
     communication (IPC) objects, and message queues. If programs fail to
     release resources they have used (for example, due to a crash), the
     administrator <emphasis>may</emphasis> use the <command>ipcs</command>
     utility to list information about them, and <command>ipcrm</command> to
     force deletion of unneeded objects. Note that these resources are also
     released when the system is rebooted.
    </para>
    <para>
     For additional information, please refer to the
     <literal>msgctl</literal>, <literal>msgget</literal>,
     <literal>msgrcv</literal>, <literal>msgsnd</literal>,
     <literal>semctl</literal>, <literal>semget</literal>,
     <literal>semop</literal>, <literal>shmat</literal>,
     <literal>shmctl</literal>, <literal>shmdt</literal>,
     <literal>shmget</literal> and <literal>ftok</literal> man pages.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.stunnel">
    <title>Configuring Secure Network Connections with Stunnel</title>
    <para>
     The stunnel program is a flexible and secure solution for setting up
     encrypted network connections, enabling the use of strong encryption even
     for applications that are not able to use encryption natively. stunnel
     uses the OpenSSL library for its encryption functions, and the
     corresponding <command>openssl</command>(1) command line tool for key
     management.
    </para>
     <para>
      stunnel has three main operating modes:
     </para>
    <itemizedlist>
      <listitem>
       <para>
        Accept incoming SSL-encrypted TCP connections, and run a specific
        program to handle the request.
       </para>
      <note>
       <para>
        This is similar to how <systemitem class="daemon">xinetd</systemitem>
        launches programs, and any program compatible with <systemitem
         class="daemon">xinetd</systemitem> can also be used for this purpose.
        It must read and write the communication data on the
        <literal>stdin</literal> and <literal>stdout</literal> file
        descriptors and stay in the foreground. Stunnel also supports
        switching user and group IDs before launching the program.
       </para>
      </note>
     </listitem>
     <listitem>
      <para>
       Open a SSL connection to a remote SSL-capable TCP server, and copy data
       to and from <literal>stdin</literal> and <literal>stdout</literal>.
      </para>
     </listitem>
     <listitem>
      <para>
       Bind a TCP port to accept incoming unencrypted connections, and
       forward data using SSL to a pre-specified remote server.
      </para>
     </listitem>
    </orderedlist>
    <para>
     The following diagram shows a sample usage scenario:
    </para>
    <figure>
     <title>Stunnel Functional Description</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="stunnel.svg" width="75%" format="SVG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="stunnel.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     In this scenario, neither the client nor the server have
     administrator privileges, they are running as normal user processes.
     Also, the client and server do not support encryption directly.
    </para>
    <para>
     Stunnel makes a secure communication channel available for the client
     and server. On the client, stunnel is accepting connections on TCP
     port 82. The client connects to this port on the local machine using
     normal unencrypted TCP, stunnel accepts the connection, and opens a
     new TCP connection to the stunnel server running on the remote
     machine.
    </para>
    <para>
     The stunnel instances use cryptographic certificates to ensure that
     the data stream has not been intercepted or tampered with, and then
     the remote stunnel opens a third TCP connection to the server, which
     is again a local unencrypted connection.
    </para>
    <para>
     Any data sent by either the client or server is accepted by the
     corresponding stunnel instance, encrypted, sent to the other stunnel,
     decrypted and finally forwarded to the receiving program. This way,
     no modifications are required to the client and server.
    </para>
    <para>
     To set up a secure connection compliant with the evaluated
     configuration, you <emphasis>must</emphasis> start the stunnel
     server(s) with administrator rights, and you
     <emphasis>must</emphasis> use a TCP port in the
     administrator-reserved range 1-1023 to accept incoming connections. A
     corresponding client which connects to the server
     <emphasis>may</emphasis> be started by any user, not just
     administrators.
    </para>
    <note>
     <para>
       stunnel <emphasis>may</emphasis> also be used by
       non-administrative users to receive encrypted connections on ports in
       the range 1024-65536. This is permitted, but it is outside of the
       scope of the evaluated configuration and not considered to be a
       trusted connection.
     </para>
    </note>
    <para>
     Any network servers and clients other than the trusted programs described
     in this guide (<command>stunnel</command>, <systemitem
      class="daemon">sshd</systemitem>, <systemitem
      class="daemon">vsftpd</systemitem>, <command>postfix</command> and
     <systemitem class="daemon">cupsd</systemitem>) <emphasis>must</emphasis>
     be run using non-administrator normal user identities. Programs run from
     stunnel <emphasis>must</emphasis> be switched to a non-root user ID by
     using the setuid and setgid parameters in the
     <filename>/etc/stunnel/*.conf</filename> configuration files.
    </para>
    <para>
     It is <emphasis>recommended</emphasis> configuring any such servers
     to accept connections only from machine-local clients, either by
     binding only the localhost IP address 127.0.0.1, or by software
     filtering inside the application. This ensures that the only
     encrypted connections are possible over the network. Details on how
     to do this depend on the software being used and are beyond the scope
     of this guide.
    </para>
    <para>
     Please refer to the <command>stunnel</command> and
     <command>openssl</command> man pages for more information.
    </para>
    <sect2 id="sec.setup_for_eal.operating.stunnel.cert_ext">
     <title>Creating an externally signed certificate</title>
     <para>
      It is strongly <emphasis>recommended</emphasis> that you have your
      server's certificate signed by an established Certificate Authority
      (CA), which acts as a trusted third party to vouch for the certificate's
      authenticity for clients. Please refer to the <command>openssl</command>
      and <command>req</command> man pages for instructions on how to generate
      and use a certificate signing request.
     </para>
     <para>
      Create the server's private key and a certificate signing request
      (CSR) with the following commands:
     </para>
     <screen>touch /etc/stunnel/stunnel.pemchmod 400
/etc/stunnel/stunnel.pemopenssl req -newkey rsa:1024 -nodes \
-keyout /etc/stunnel/stunnel.pem -out /etc/stunnel/stunnel.csr
     </screen>
     <para>
      You will be prompted for the information that will be contained in the
      certificate. Most important is the <quote>Common Name</quote>, because
      the connecting clients will check if the hostname in the certificate
      matches the server they were trying to connect to. If they do not
      match, the connection will be refused, to prevent a
      <quote>man-in-the-middle</quote> attack.
     </para>
     <para>
      Here is a sample interaction:
     </para>
     <screen>Generating a 1024 bit RSA private key
..........++++++
.......++++++
writing new private key to '/etc/stunnel/stunnel.pem'
-----
You are about to be asked to enter information that will be incorporated into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [PL]:US
State or Province Name (full name) [Some-State]:TX
Locality Name (eg, city) []:Austin
Organization Name (eg, company) [Stunnel Developers Ltd]:Example Inc.
Organizational Unit Name (eg, section) []:
Common Name (FQDN of your server) []:www.example.com
Common Name (default) []:localhost</screen>
     <para>
      The file <filename>/etc/stunnel/stunnel.pem</filename> will contain both
      the certificate (public key) and also the secret key needed by the
      server. The secret key will be used by non-interactive server processes,
      and cannot be protected with a passphrase. You <emphasis>must</emphasis>
      protect the secret key from being read by unauthorized users, to ensure
      that you are protected against someone impersonating your server.
     </para>
     <para>
      Next, send the generated CSR file
      <filename>/etc/stunnel/stunnel.csr</filename> (not the private key) to
      the CA along with whatever authenticating information they require to
      verify your identity and your server's identity. The CA will then
      generate a signed certificate from the CSR, using a process analogous to
      <command>openssl <option>req -x509</option> <option>-in
        stunnel.csr</option> <option>-key CA-key.pem</option> <option>-out
        stunnel.cert</option></command>.
     </para>
     <para>
      When you receive the signed certificate back from the CA, append it to
      the file <filename>/etc/stunnel/stunnel.pem</filename> containing the
      private key using the following command:
     </para>
     <screen>echo &gt;&gt; /etc/stunnel/stunnel.pem
cat stunnel.cert &gt;&gt; /etc/stunnel/stunnel.pem</screen>
     <para>
      Make sure that the resulting file contains no extra whitespace or
      other text in addition to the key and certificate, with one blank line
      separating the private key and certificate:
     </para>
     <screen>-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQCzF3ezbZFLjgv1YHNXnBnI8jmeQ5MmkvdNw9XkLnA2ONKQmvPQ
[…]
4tjzwTFxPKYvAW3DnXxRAkAvaf1mbc+GTMoAiepXPVfqSpW2Qy5r/wa04d9phD5T
oUNbDU+ezu0Pana7mmmvg3Mi+BuqwlQ/iU+G/qrG6VGj
-----END RSA PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIC1jCCAj+gAwIBAgIBADANBgkqhkiG9w0BAQQFADBXMQswCQYDVQQGEwJQTDET
[…]
bIbYKL6Q1kE/vhGmRXcXQrZzkfu8sgJv7JsDpoTpAdUnmvssUY0bchqFo4Hhzkvs
U/whL2/8RFv5jw==
-----END CERTIFICATE-----</screen>
     <para>
      You <emphasis>may</emphasis> distribute the original signed certificate
      (<filename>stunnel.cert</filename> in this example) to clients, it does
      not contain any confidential information. Never distribute the file
      containing the private key, which is for use by the stunnel server only.
     </para>
     <para>
      When using externally signed certificates, you <emphasis>must</emphasis>
      use the option CApath in stunnel client configuration files along with
      the setting <option>verify=2</option> or <option>verify=3</option> to
      enable the clients to verify the certificate.
     </para>
    </sect2>
    <sect2 id="sec.setup_for_eal.operating.stunnel.cert_self">
     <title>Creation of self-signed certificates</title>
     <para>
      Alternatively, you <emphasis>may</emphasis> use a self-signed
      certificate instead of one signed by an external CA. This saves some
      time and effort when first setting up the server, but each connecting
      client <emphasis>must</emphasis> manually verify the certificate's
      validity.
     </para>
     <para>
      Experience shows that most users will not do the required checking and
      simply click <quote>OK</quote> for whatever warning dialogs that are
      shown, resulting in significantly reduced security. Self-signed
      certificates can be appropriate for controlled environments with a
      small number of users, but are not recommended for general production
      use.
     </para>
     <para>
      Create a self-signed host certificate with the following commands:
     </para>
     <screen># To create a secret key and self-signed certificate
openssl req -newkey rsa:1024 -nodes -keyout /etc/stunnel/stunnel.pem \
-new -x509 -sha1 -days 365 -out /etc/stunnel/stunnel.cert
# To set appropriate file permissions
chmod 400 /etc/stunnel/*.pem
chmod 444 /etc/stunnel/*.cert
# To append copy of certificate to private key
echo &gt;&gt; /etc/stunnel/stunnel.pem
cat /etc/stunnel/stunnel.cert &gt;&gt; /etc/stunnel/stunnel.pem</screen>
     <para>
      The secret key contained in the
      <filename>/etc/stunnel/stunnel.pem</filename> file
      <emphasis>must</emphasis> be kept secret. The key files contain
      human-readable headers and footers along with the ASCII-encoded key, and
      the secret key is marked with the header <quote>BEGIN RSA PRIVATE
       KEY</quote>.
     </para>
     <para>
      You <emphasis>may</emphasis> distribute the public certificate stored in
      the <filename>/etc/stunnel/stunnel.cert</filename> file to clients, and
      is marked with the header <quote>BEGIN CERTIFICATE</quote>. Make sure
      you do not accidentally distribute the secret key instead.
     </para>
     <para>
      The client has no independent way to verify the validity of a
      self-signed certificate, each client <emphasis>must</emphasis>
      manually verify and confirm the validity of the certificate.
     </para>
     <para>
      One method is to give a copy of the self-signed certificate to the
      client (using a secure transport mechanism, not e-mail), and import it
      into the client directly. The stunnel client uses the CAfile option
      for this purpose.
     </para>
     <para>
      Alternatively, many client programs (not stunnel) can interactively
      import the certificate when connecting to the server. The client will
      display information about the server's certificate including an MD5
      key fingerprint. You <emphasis>must</emphasis> compare this
      fingerprint with the original fingerprint of the server's
      certificate.
     </para>
     <para>
      Run the following command on the server to display the original
      certificate's fingerprint:
     </para>
     <screen>openssl x509 -fingerprint -in /etc/stunnel/stunnel.cert</screen>
     <para>
      Most clients will store the certificate for future reference, and will
      not need to do this verification step on further invocations.
     </para>
    </sect2>
    <sect2 id="sec.setup_for_eal.operating.stunnel.activate">
     <title>Activating the tunnel</title>
     <para>
      In the evaluated configuration, you <emphasis>must</emphasis> use one
      of the following cipher suites as defined in the SSL v3 protocol:
     </para>
     <screen>
# Cipher      Proto  Key    Authen-   Encryption     Message
#                    exchg  tication                 auth code
#
RC4-SHA       SSLv3  Kx=RSA  Au=RSA   Enc=RC4(128)   Mac=SHA1
DES-CBC3-SHA  SSLv3  Kx=RSA  Au=RSA   Enc=3DES(168)  Mac=SHA1
AES128-SHA    SSLv3  Kx=RSA  Au=RSA   Enc=AES(128)   Mac=SHA1
AES256-SHA    SSLv3  Kx=RSA  Au=RSA   Enc=AES(256)   Mac=SHA1</screen>
     <para>
      All other cipher suites and the other protocols supported by the
      OpenSSL library (TLSv1 and SSLv2) <emphasis>must</emphasis> be
      disabled.
     </para>
     <para>
      You <emphasis>must</emphasis> specify the cipher list and protocol in
      all stunnel client and server configuration files:
     </para>
     <screen>ciphers = RC4-SHA:DES-CBC3-SHA:AES128-SHA:AES256-SHA
options = NO_TLSv1
options = NO_SSLv2</screen>
     <para>
      For a service or tunnel that will only be used temporarily, simply
      launch the stunnel program from the command line and specify an
      appropriate configuration file. The tunnel will be available for
      multiple clients, but will not be started automatically after a
      reboot. To shut down the tunnel, search for the command line in the ps
      ax process listing, and use the kill command with the PID shown for
      the stunnel process.
     </para>
     <para>
      The <emphasis>recommended</emphasis> method is to use two separate
      configuration files, one for server definitions (incoming connections
      use SSL), and one for client definitions (outgoing connections use
      SSL). More complex configurations will require additional
      configuration files containing individual service-specific settings.
      You <emphasis>must</emphasis> use the REQUIRED settings in all stunnel
      configuration files.
     </para>
     <para>
      Use the following content for the file
      <filename>/etc/stunnel/stunnel-server.conf</filename> :
     </para>
     <screen>### /etc/stunnel/stunnel-server.conf
#
# The following settings are REQUIRED for CAPP compliance when used
# as a server, see ECG.  File names MAY be changed as needed.
cert = /etc/stunnel/stunnel.pem
ciphers = RC4-SHA:DES-CBC3-SHA:AES128-SHA:AES256-SHA
options = NO_TLSv1
options = NO_SSLv2
#
# User and group ID MUST NOT be "root", but MAY be changed as needed.
setuid = nobody
setgid = nobody
#
# The following settings are RECOMMENDED
debug = 6
output = /var/log/stunnel-server.log
pid =
foreground = yes
#
# Individual service definitions follow</screen>
     <para>
      Use the following content for the file
      <filename>/etc/stunnel/stunnel-client.conf</filename> :
     </para>
     <screen>### /etc/stunnel/stunnel-client.conf
#
# The following settings are REQUIRED for CAPP compliance when used
# as a client, see ECG.  File names MAY be changed as needed.  You
# MAY use CApath instead of CAfile for externally signed certificates.
CAfile = /etc/stunnel/stunnel.cert
ciphers = RC4-SHA:DES-CBC3-SHA:AES128-SHA:AES256-SHA
options = NO_TLSv1
options = NO_SSLv2
client = yes
verify = 2
#
# User and group ID MUST NOT be "root", but MAY be changed as needed.
setuid = nobody
setgid = nobody
#
# The following settings are RECOMMENDED
debug = 6
output = /var/log/stunnel-client.log
pid =
foreground = yes
#
# Individual service definitions follow</screen>
     <para>
      The <emphasis>recommended</emphasis> launch method for stunnel is via
      the init process. This requires adding new entries to
      <filename>/etc/inittab</filename>, the tunnels will be re-launched
      automatically whenever they are terminated, as well as after a reboot.
      The following are the <emphasis>recommended</emphasis>
      <filename>/etc/inittab</filename> entries:
     </para>
     <screen>ts:3:respawn:/usr/sbin/stunnel /stunnel/stunnel-server.conf
tc:3:respawn:/usr/sbin/stunnel /etc/stunnel/stunnel-client.conf</screen>
     <para>
      Make sure you use the option <option>foreground = yes</option> in the
      configuration file when running from init (otherwise init will
      misinterpret the background server as having died and will try to
      restart it immediately, causing a loop), and use the output option to
      redirect the output to a log file.
     </para>
    </sect2>

    <sect2 id="sec.setup_for_eal.operating.stunnel.usage">
     <title>Using the tunnel</title>
     <para>
      If the client program supports SSL encryption, it will be able to
      communicate with the stunnel service directly. You
      <emphasis>must</emphasis> verify and accept the server's certificate
      if the client cannot recognize it as valid according to its known
      certification authorities.
     </para>
     <para>
      If the client program does not support SSL directly, you can use
      stunnel as a client, or indirectly by setting up a proxy that allows
      the client to connect to an unencrypted local TCP port.
     </para>
     <warning>
      <title>Accepting the Certificate</title>
      <para>
       The stunnel client does not verify the server's certificate by default.
       You <emphasis>must</emphasis> specify either <option>verify =
        2</option> or <option>verify = 3</option> in the client configuration
       file to switch on certificate verification.
      </para>
     </warning>
     <para>
      You <emphasis>may</emphasis> also activate client certificate
      verification in the server's configuration file, so that the server
      can verify the client's identity as well.
     </para>
     <para>
      As described in the previous section, you <emphasis>must</emphasis>
      specify
     </para>
     <screen>ciphers = RC4-SHA:DES-CBC3-SHA:AES128-SHA:AES256-SHA
options = NO_TLSv1
options = NO_SSLv2</screen>
     <para>
      in the configuration file to ensure that the cipher selection
      supported in the evaluated configuration will be used.
     </para>
     
     <example id="ex.setup_for_eal.stunnel.usage.smtp">
      <title>Secure SMTP (Simple Mail Transport Protocol) delivery</title>
      <para>
       Normal SMTP e-mail delivery is not encrypted, but most mail clients
       support the enhanced SMTPS protocol that uses SSL encryption. The
       protocol itself is unchanged other than being encrypted.
      </para>
      <para>
       Stunnel can easily be used as a proxy to receive SMTPS connections on
       the standard port expected by clients (465/tcp), and then forward the
       data to the mail server listening on the SMTP port (25/tcp). The mail
       server configuration does not need to be modified to support
       encryption of incoming mail.
      </para>
      <para>
       To implement SSL support for incoming mail, add the following service
       definition to the <filename>/etc/stunnel/stunnel-server.conf</filename>
       configuration:
      </para>
      <screen>[inbound_mail]
accept = 465
connect = 127.0.0.1:25</screen>
     </example>
     
     <example id="ex.setup_for_eal.stunnel.usage.http">
      <title>Simple web server (HTTP)</title>
      <para>
       The following shell script acts as a simple web server, reading
       requests from standard input and writing HTTP/HTML to standard output:
      </para>
      <screen>cat > /usr/local/sbin/webserver_test <<-__EOF__
#!/bin/sh
# Simple web server, can be run via stunnel or xinetd
#
# read and discard client data
dd bs=65536 count=1 >/dev/null 2>&1
#
# Send HTTP header
echo -e "HTTP/1.0 200\r"
echo -e "Content-type: text/html\r"
echo -e "\r"
#
# Send HTML output
echo "<html>"
echo "<h1>Test Page</h1>"
date
echo "<h2>Memory usage</h2>"
echo "<pre>"
free
echo "</pre>"
echo "</html>"
__EOF__</screen>
     <para>
       Once the file has been written (either as previously entered, directly
       from the command line, or copy/pasted into the
       <filename>/usr/local/sbin/webserver_test</filename> file), you would
       make it executable by:
     </para>
     <screen>chmod +x /usr/local/sbin/webserver_test</screen>
     <para>
       As the section heading states, this is for the un-encrypted HTTP
       protocol you can add the following entry to the
       <filename>/etc/stunnel/stunnel-server.conf</filename> configuration to
       make this service available using the encrypted HTTPS protocol:
     </para>
     <screen>[webserver_test]
accept = 443
exec = /usr/local/sbin/webserver_test
TIMEOUTclose = 0</screen>
     <para>
      Then, using an SSL-capable web browser (elinks, for this example) to
      connect to port 443:
     </para>
      <screen>elinks https://localhost/</screen>
    </example>
     
     <example id="ex.setup_for_eal.stunnel.usage.native">
      <title>Securing non-SSL (native) Applications</title>
      <para>
       This example shows how to combine stunnel client and server definitions
       to implement an encrypted tunnel for applications that do not
       themselves support encryption. This example shows the use of the binary
       <command>free</command>. <command>free</command> displays the memory
       usage of a host.
      </para>
      <para>
       First, on the server machine, set up a stunnel server definition that
       accepts SSL connections on TCP port 444 (example). Once a client
       connects (on this port) it will report memory usage statistics for the
       server to that connected client. Add the following service definition
       to the /etc/stunnel/stunnel-server.conf configuration:
      </para>
      <screen>[free]
accept = 444
exec = /usr/bin/free
execargs = free</screen>
      <para>
       Then, on the client machine, add the following entry to the
       /etc/stunnel/stunnel-client.conf<filename></filename> configuration, using the server's
       IP address instead of <replaceable>###.###.###.###</replaceable>:
     </para>
     <screen>[free]
accept = 81
connect = <replaceable>###.###.###.###</replaceable>:444</screen>
     <para>
      On the client machine, connect to the local stunnel proxy by running
      the following command as a normal user:
     </para>
     <screen>telnet localhost 81</screen>
     <para>
      This will open an unencrypted TCP connection to the client's local
      port 81, then stunnel builds an encrypted tunnel to the server's
      port 444 and transfers the decrypted data (in this case, the
      <command>free</command> output) back to the client. All unencrypted
      connections are machine local, and the data transferred over the
      network is encrypted.
     </para>
    </example>
    </sect2>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.amtu">
    <title>The Abstract Machine Testing Utility (AMTU) (not included in &productname; 11)</title>
    <para>
     The security of the operating system depends on correctly functioning
     hardware. For example, the memory subsystem uses hardware support to
     ensure that the memory spaces used by different processes are protected
     from each other.
    </para>
    <para>
     The Abstract Machine Testing Utility (AMTU) is distributed as an RPM,
     and was installed previously as described in section FIXME 2.3.6 <quote>Add
     and remove packages</quote> of this guide.
    </para>
    <para>
     To run all supported tests, simply execute the <command>amtu</command> program:
    </para>
    <screen>amtu</screen>
    <para>
     A successful run is indicated by the following output:
    </para>
    <screen>Executing Memory Test...
Memory Test SUCCESS!
Executing Memory Separation Test...
Memory Separation Test SUCCESS!
Executing Network I/O Tests...
Network I/O Controller Test SUCCESS!
Executing I/O Controller - Disk Test...
I/O Controller - Disk Test SUCCESS!
Executing Supervisor Mode Instructions Test...
Privileged Instruction Test SUCCESS!</screen>
    <para>
     The program will return a non-zero exit code on failure, which
     <emphasis>may</emphasis> be used to automatically detect failures of
     the tested systems and take appropriate action.
    </para>
    <para>
     Please refer to the <command>amtu</command> man page for more details.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.time">
    <title>Setting the System Time and Date</title>
    <para>
     You <emphasis>must</emphasis> verify periodically that the system clock
     is sufficiently accurate, otherwise log and audit files will contain
     misleading information. When starting the system, the time and date are
     copied from the computer's hardware clock to the kernel's software
     clock, and written back to the hardware clock on system shutdown.
    </para>
    <para>
     All internal dates and times used by the kernel, such as file
     modification stamps, use universal time (UTC), and do not depend on the
     current time zone settings. Userspace utilities usually adjust these
     values to the currently active time zone for display. Note that text
     log files will contain ASCII time and date representations in local
     time, often without explicitly specifying the time zone.
    </para>
    <para>
     The date command displays the current time and date, and can be used by
     administrators to set the software clock, using the argument
     <replaceable>mmddHHMMyyyy</replaceable> to specify the numeric month,
     day, hour, minute and year respectively. For example, the following
     command sets the clock to April 1st 2011, 1pm in the local time zone:
    </para>
    <screen>date 040113002011</screen>
    <para>
     The hwclock utility can query and modify the hardware clock on
     supported platforms, but is not available in virtual environments such
     as z/VM. The typical use is to copy the current value of the software
     clock to the hardware clock.
    </para>
    <para>
     Note that the hardware clock <emphasis>may</emphasis> be running in
     either local time or universal time, as indicated by the UTC setting in
     the <filename>/etc/sysconfig/clock</filename> file. The following command
     sets the hardware clock to the current time using UTC:
    </para>
    <screen>hwclock -u -w</screen>
    <para>
     Use the command <command>tzselect</command> to change the default time
     zone for the entire system. Note that users <emphasis>may</emphasis>
     individually configure a different time zone by setting the
     <envar>TZ</envar> environment variable appropriately in their shell
     profile, such as the <filename>$HOME/.bashrc</filename> file.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.operating.aa">
    <title>&aa; Configuration</title>
    <para>
     The evaluated configuration keeps the &aa; system enabled in a
     static configuration, but does not depend on &aa; for any security
     features. You <emphasis>may</emphasis> modify the &aa;
     configuration, for example to add additional restrictions, but this is
     beyond the scope of the CAPP evaluation.
    </para>
    <para>
     There are extra details in the Appendix for setting up AppArmor. Also
     in the appendix are web-links that give further examples for AppArmor.
    </para>
   </sect1>
  </chapter>
  <chapter id="cha.setup_for_eal.monitoring">
   <title>Monitoring, Logging &amp; Audit (Part 5)</title>
   <para/>
   <sect1 id="sec.setup_for_eal.monitoring.review_config">
    <title>Reviewing the System Configuration</title>
    <para>
     It is <emphasis>recommended</emphasis> that you review the system's
     configuration at regular intervals to verify if it still agrees with
     the evaluated configuration. This primarily concerns those processes
     that may run with &rootuser; privileges.
    </para>
    <itemizedlist>
     <listitem>
      <para>
       The permissions of the device files <filename>/dev/*</filename>
       <emphasis>must not</emphasis> be modified.
      </para>
     </listitem>
     <listitem>
      <para>
       In particular, review settings in the following files and directories
       to ensure that the contents and permissions have not been modified:
      </para>
      <screen>/etc/audit/*
/etc/cron.allow
/etc/cron.deny
/etc/cron.d/*
/etc/cron.daily/*
/etc/cron.hourly/*
/etc/cron.monthly/*
/etc/cron.weekly/*
/etc/crontab
/etc/ftpusers
/etc/group
/etc/gshadow
/etc/hosts
/etc/init.d/*
/etc/inittab
/etc/ld.so.conf
/etc/login.defs
/etc/modules.conf
/etc/pam.d/*
/etc/passwd
/etc/securetty
/etc/security/opasswd
/etc/security/pam_pwcheck.conf
/etc/security/pam_unix2.conf
/etc/shadow
/etc/ssh/ssh_config
/etc/ssh/sshd_config
/etc/stunnel/*
/etc/sysconfig/*
/etc/vsftpd.conf
/etc/xinetd.conf
/usr/lib/cracklib_dict.*
/var/log/audit.d/*
/var/log/faillog
/var/log/lastlog</screen>
     </listitem>
     <listitem>
      <para>
       Use the command <command>lastlog</command> to detect unusual patterns
       of logins.
      </para>
     </listitem>
     <listitem>
      <para>
       Also verify the output of the following commands (run as &rootuser;):
      </para>
      <screen>crontab -l
find / \( -perm -4000 -o -perm -2000 \) -ls
find / \( -type f -o -type d -o -type b \) -perm -0002 -ls
find /bin /boot /etc /lib /sbin /usr ! -type l \( ! -uid 0 -o -perm +022 \)</screen>
     </listitem>
    </itemizedlist>
   </sect1>
   <sect1 id="sec.setup_for_eal.monitoring.logging">
    <title>System Logging and Accounting</title>
    <para>
     System log messages are stored in the <filename>/var/log/</filename>
     directory tree in plain text format, most are logged through the
     <systemitem class="daemon">syslogd</systemitem> and <systemitem
      class="daemon">klogd</systemitem> programs, which
     <emphasis>may</emphasis> be configured via the
     <filename>/etc/syslog.conf</filename> file.
    </para>
    <para>
     The <command>logrotate</command> utility, launched from
     <filename>/etc/cron.daily/logrotate</filename>, starts a fresh log file
     every week or when they reach a maximum size and automatically removes or
     archives old log files. You <emphasis>may</emphasis> change the
     configuration files <filename>/etc/logrotate.conf</filename> and
     <filename>/etc/logrotate.d/*</filename> as required.
    </para>
    <para>
     In addition to the syslog messages, various other log files and status
     files are generated in <filename>/var/log</filename> by other programs:
    </para>
    <variablelist>
     <?dbfo list-presentation="list"?>
     <?dbhtml list-presentation="table"?>
     <varlistentry>
      <term><filename>&yast;2</filename></term>
      <listitem>
       <para>
        Directory for &yast; log files
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>audit</filename></term>
      <listitem>
       <para>
        Directory for audit logs
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>boot.msg</filename></term>
      <listitem>
       <para>
        Messages from system startup
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>lastlog</filename></term>
      <listitem>
       <para>
        Last successful log in (see <command>lastlog</command>)
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>vsftpd.log</filename></term>
      <listitem>
       <para>
        Transaction log of the VSFTP daemon
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>mail</filename></term>
      <listitem>
       <para>
        Written by syslog, contains messages from the MTA (postfix)
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>messages</filename></term>
      <listitem>
       <para>
        Written by <systemitem class="daemon">syslogd</systemitem>, contains
        messages from su and ssh
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>news/</filename></term>
      <listitem>
       <para>
        syslog news entries (not used in the evaluated configuration)
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>warn</filename></term>
      <listitem>
       <para>
        Written by <systemitem class="daemon">syslogd</systemitem>
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>wtmp</filename></term>
      <listitem>
       <para>
        Written by the PAM susbystem, see <command>who</command>
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><filename>xinetd.log</filename></term>
      <listitem>
       <para>
        Written by <systemitem class="daemon">xinetd</systemitem>, logging all
        connections
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     Please see <literal>syslog</literal>, <filename>syslog.conf</filename>
     and <systemitem class="daemon">syslogd</systemitem> man pages for details
     on syslog configuration.
    </para>
    <para>
     The <command>ps</command> command can be used to monitor the currently
     running processes. Using <command>ps <option>-faux</option></command>
     will show all currently running processes and threads.
    </para>
   </sect1>
   <sect1 id="sec.setup_for_eal.monitoring.audit">
    <title>Configuring the Audit Subsystem</title>
    <para>
     The audit subsystem implements a central monitoring solution to keep
     track of security relevant events, such as changes and change attempts
     to security critical files.
    </para>
    <para>
     This is accomplished through two separate mechanisms. All system calls
     are intercepted, and the kernel writes the parameters and return value
     to the audit log for those calls that are marked as security relevant
     in the filter configuration.
    </para>
    <para>
     In addition, some trusted programs contain audit-specific code to write
     audit trails of the actions they are requested to perform.
    </para>
    <para>
     Please refer to the <systemitem class="daemon">auditd</systemitem>,
     <filename>auditd.conf</filename>, and <command>auditctl</command> man
     pages for more information.
    </para>
    <sect2 id="sec.setup_for_eal.monitoring.audit.usage">
     <title>Intended Usage of the Audit Subsystem</title>
     <para>
      The Controlled Access Protection Profile (CAPP) specifies the auditing
      capabilities that a compliant system must support. The evaluated
      configuration described here is based on these requirements.
     </para>
     <warning>
      <para>
       Some of the CAPP requirements may conflict with your specific
       requirements for the system. For example, a CAPP-compliant system
       <emphasis>must</emphasis> disable logins if the audit subsystem is not
       working. Please ensure that you are aware of the consequences if you
       enable auditing.
      </para>
     </warning>
     <para>
      CAPP is designed for a multiuser system, with multiple unique users
      who maintain both shared and private resources.
     </para>
     <para>
      The auditing features are intended to support this mode of operation
      with a reliable trail of security-relevant operations. It is less
      useful for a pure application server with no interactive users.
     </para>
     <para>
      Please be aware that the auditing subsystem will, when activated,
      cause some slowdown for applications on the server. The impact depends
      on what the application is doing and how the audit subsystem is
      configured. As a rule of thumb, applications that open a large number
      of separate files are most affected, and CPU-bound programs should not
      be measurably affected. You will need to balance the performance
      requirements against your security needs when deciding if and how you
      want to use auditing.
     </para>
    </sect2>
    <sect2 id="sec.setup_for_eal.monitoring.audit.events">
     <title>Selecting the Events to be Audited</title>
     <para>
      You <emphasis>may</emphasis> make changes to the set of system calls
      and events that are to be audited. CAPP requires that the system has
      the capability to audit security relevant events, but it is up to you
      to choose how you want to use these capabilities.
     </para>
     <para>
      It is acceptable to turn off system call auditing completely even in
      an evaluated configuration, for example on a pure application server
      with no interactive users on the system.
     </para>
     <para>
      The audit package provides a suggested audit configuration in the
      <filename>/usr/share/doc/packages/audit/sample.rules</filename> file. It
      contains a suggested setup for a typical multiuser system, all access to
      security relevant files is audited, along with other security relevant
      events such as system reconfiguration. You <emphasis>may</emphasis> copy
      the sample rules files to <filename>/etc/audit.rules</filename> and
      modify the configuration according to your local requirements, including
      the option of using an empty audit rules file to disable auditing if not
      required.
     </para>
     <para>
      You <emphasis>may</emphasis> selectively disable and enable auditing for
      specific events or users as required by modifying the
      <filename>audit.rules</filename> file. For example, you can include and
      exclude specific users from auditing by adding filters based on the
      loginuid, such as the following entry:
     </para>
     <screen>-a exit,always -F auid!=trusteduser -S chown</screen>
     <para>
      The audit system also supports filtering on success or failure of
      system call operations:
     </para>
     <screen>-F success=1 # for successful syscalls
-F success!=1 # for unsuccessful syscalls</screen>
     <para>
      You <emphasis>may</emphasis> configure filesystem watches using the
      <option>-w</option> option. Note that filesystem watches are order
      sensitive if you create multiple watches for the same inode, for example
      if creating separate watches for multiple hard links to a single file.
      You can filter filesystem watches, for example to exclude a user ID from
      being audited:
     </para>
     <screen>-w /etc/shadow -k Secret
-a watch,never -F auid=trusteduser
-a exit,possible -S open</screen>
     <para>
      It is <emphasis>recommended</emphasis> that you always reconfigure the
      audit system by modifying the <command>/etc/audit.rules</command> file
      and then running the following command to reload the audit rules:
     </para>
     <screen># as role "auditadm_r"
auditctl -R /etc/audit.rules</screen>
     <para>
      This procedure ensures that the state of the audit system always matches
      the content of the <filename>/etc/audit.rules</filename> file. You
      <emphasis>should not</emphasis> manually add and remove audit rules and
      watches on the command line as those changes are not persistent.
     </para>
     <para>
      Note that reloading audit rules involves initially deleting all audit
      rules, and for a short time the system will be operating with no or
      only a partial set of audit rules. It is
      <emphasis>recommended</emphasis> to make changes to the audit rules
      when no users are logged in on the system or while the system is
      disconnected from the network, for example by using single user mode
      or a reboot to activate the changes.
     </para>
     <para>
      Please refer to the <command>auditctl</command> man page for more
      details.
     </para>
    </sect2>
    <sect2 id="sec.setup_for_eal.monitoring.audit.records">
     <title>Reading and Searching the Audit Records</title>
     <para>
      Use the <command>ausearch</command> tool to retrieve information from
      the audit logs. The information available for retrieval depends on the
      active filter configuration. If you modify the filter configuration, it
      is <emphasis>recommended</emphasis> keeping a datestamped copy of the
      applicable configuration with the log files for future reference.
     </para>
     <para>
      For example:
     </para>
     <screen># search for events with a specific login UID
ausearch -ul jdoe
# search for events by process ID
ausearch -p 4690</screen>
     </para>
     <para>
      Please refer to the <command>ausearch</command> man page for more
      details.
     </para>
     <para>
      Audit messages from the <systemitem
       class="resource">pwdutils</systemitem> user management tools, including
      <command>useradd</command> and <command>gpasswd</command>, have the
      following format:
     </para>
     <screen>type=USER_CHAUTHTOK msg=audit(11.059:63): user pid=33 uid=501 auid=501
msg='op=permission denied - account=bin, id=1, by=1000 id=2 exe=gpasswd 
	(hostname=?, addr=?, terminal=pts/1 res=success)'</screen>
     <para>
      For these specific messages, you <emphasis>must</emphasis> refer to the
      text contained in the <quote>op=</quote> field to determine the success
      or failure of the operation. The <quote>res=success</quote>
      parenthetical value is always the same and <emphasis>must</emphasis> be
      ignored.
     </para>
     <para>
      For some system calls on some platforms, the system call arguments in
      the audit record can be slightly different than you may expect from the
      program source code due to modifications to the arguments in the C
      library or in kernel wrapper functions. For example, the mq open glibc
      library function strips the leading '/' character from the path argument
      before passing it to the mq open system call, leading to a one character
      difference in the audit record data. Similarly, some system calls such
      as <literal>semctl</literal>, <literal>getxattr</literal>, and
      <literal>mknodat</literal> can have additional internal flags
      automatically added to the flag argument. These minor modifications do
      not change the security relevant information in the audit record.
     </para>
     <para>
      Of course, you can use other tools such as plain <command>grep</command>
      or scripting languages such as awk, python or perl to further analyze
      the text audit log file or output generated by the low-level ausearch
      tool.
     </para>
    </sect2>
    <sect2 id="sec.setup_for_eal.monitoring.audit.startstop">
     <title>Starting and Stopping the Audit Subsystem</title>
     <para>
      If the audit daemon is terminated, no audit events are saved until it
      is restarted. To avoid lost audit records when you have modified the
      filter configuration, you <emphasis>must</emphasis> use the command
      <command>/etc/init.d/auditd reload</command> to re-load the filters.
     </para>
     <para>
      You <emphasis>must not</emphasis> use the KILL signal
      (<option>-9</option>) to stop the audit daemon, doing so would prevent
      it from cleanly shutting down.
     </para>
     <para>
      It is <emphasis>recommended</emphasis> that you add the kernel parameter
      <option>audit=1</option> to your boot loader configuration file to
      ensure that all processes, including those launched before the
      <systemitem class="daemon">auditd</systemitem>
      service, are properly attached to the audit subsystem.
     </para>
     <para>
      Please refer to the documentation of your boot loader and FIXME section
      2.3.22 <quote>Configuring the boot loader</quote> of this document for
      more details.
     </para>
    </sect2>
    <sect2 id="sec.setup_for_eal.monitoring.audit.store_records">
     <title>Storage of Audit Records</title>
     <para>
      The default audit configuration stores audit records in the
      <filename>/var/log/audit/audit.log</filename> file. This is configured
      in the <filename>/etc/audit/auditd.conf</filename> file. You
      <emphasis>may</emphasis> change the <filename>auditd.conf</filename>
      file to suit your local requirements.
     </para>
     <para>
      It is <emphasis>recommended</emphasis> that you configure the audit
      daemon settings appropriately for your local requirements, for example
      by changing the log file retention policy to never delete old audit logs
      with the following setting in the
      <filename>/etc/audit/auditd.conf</filename> file:
     </para>
     <screen>max_log_file_action = KEEP_LOGS</screen>
     <para>
      The most important settings concern handling situations where the
      audit system is at risk of losing audit information, such as due to
      lack of disk space or other error conditions. You
      <emphasis>may</emphasis> choose actions appropriate for your
      environment, such as switching to single user mode (action single) or
      shutting down the system (action halt) to prevent auditable actions
      when the audit records cannot be stored.
     </para>
     <para>
      Halting the system is <emphasis>recommended</emphasis> and most certain
      way to ensure all user processes are stopped. The following settings are
      <emphasis>recommended</emphasis> in the
      <filename>/etc/auditd.conf</filename> file if a fail-secure audit system
      is required:
     </para>
     <screen>admin_space_left_action = SINGLE
disk_full_action = HALT
disk_error_action = HALT</screen>
     <para>
      It is <emphasis>recommended</emphasis> that you configure appropriate
      disk space thresholds and notification methods to receive an advance
      warning when the space for audit records is running low.
     </para>
     <para>
      It is <emphasis>recommended</emphasis> that you use a dedicated
      partition for the <filename>/var/log/audit/</filename> directory to
      ensure that <systemitem class="daemon">auditd</systemitem> has
      full control over the disk space usage with no other processes
      interfering.
     </para>
     <para>
      Please refer to the auditd.conf man page for more information about
      the storage and handling of audit records.
     </para>
    </sect2>
    <sect2 id="sec.setup_for_eal.monitoring.audit.reliability">
     <title>Reliability of Audit Data</title>
     <para>
      You <emphasis>may</emphasis> choose an appropriate balance between
      availability of the system and secure failure mode in case of audit
      system malfunctions based on your local requirements.
     </para>
     <para>
      You <emphasis>may</emphasis> configure the system to cease all
      processing immediately in case of critical errors in the audit system.
      When such an error is detected, the system will then immediately enter
      <quote>panic</quote> mode and will need to be manually rebooted.
     </para>
     <para>
      To use this mode, add the following line to the
      <filename>/etc/audit/audit.rules</filename> file:
     </para>
     <screen>-f 2</screen>
     <para>
      Please refer to the <command>auditctl</command> man page for more
      information about the failure handling modes.
     </para>
     <para>
      You <emphasis>may</emphasis> edit the
      <filename>/etc/libaudit.conf</filename> file to configure the desired
      action for applications that cannot communicate with the audit system.
      Please refer to the get auditfail action(3) man page for more
      information.
     </para>
     <para>
      <systemitem class="daemon">auditd</systemitem> writes audit records
      using the normal Linux filesystem buffering, which means that
      information can be lost in a crash because it has not been written to
      the physical disk yet. Configuration options control how auditd handles
      disk writes and allow the administrator to choose an appropriate balance
      between performance and reliability.
     </para>
     <para>
      Any applications that read the records while the system is running
      will always get the most current data out of the buffer cache, even if
      it has not yet been committed to disk, so the buffering settings do
      not affect normal operation.
     </para>
     <para>
      The default setting is <option>flush = DATA</option>, ensuring that
      record data is written to disk, but metadata such as the last file time
      might be inconsistent.
     </para>
     <para>
      The highest performance mode is <option>flush = none</option>, but be
      aware that this can cause loss of audit records in the event of a system
      crash.
     </para>
     <para>
      If you want to ensure that auditd always forces a disk write for each
      record, you <emphasis>may</emphasis> set the <option>flush =
       SYNC</option> option in <filename>/etc/audit/auditd.conf</filename>,
      but be aware that this will result in significantly reduced performance
      and high strain on the disk.
     </para>
     <para>
      A compromise between crash reliability and performance is to ensure a
      disk sync after writing a specific number of records to provide an upper
      limit for the number of records lost in a crash. For this, use a
      combination of <option>flush = INCREMENTAL</option> and a numeric
      setting for the freq parameter, for example:
     </para>
     <screen>flush = INCREMENTAL
freq = 100</screen>
     <important>
      <para>
       The audit record files are not protected against a
       malicious administrator, and are not intended for an environment where
       the administrators are not trustworthy.
      </para>
     </important>
    </sect2>
   </sect1>
   <sect1 id="sec.setup_for_eal.monitoring.sysconfig">
    <title>System Configuration Variables in
     <filename>/etc/sysconfig</filename></title>
    <para>
     The system uses various files in <filename>/etc/sysconfig</filename> to
     configure the system. Most files in this directory tree contain variable
     definitions in the form of shell variables that are either read by the rc
     scripts at system boot time or are evaluated by other commands at
     runtime. Note that changes will not take effect until the affected
     service is restarted or the system is rebooted.
    </para>
   </sect1>
  </chapter>
  <chapter id="cha.setup_for_eal.user">
   <title>Security Guidelines for Users (Part 6)</title>
   <para/>
   <sect1 id="sec.setup_for_eal.user.documentation">
    <title>Online Documentation</title>
    <para>
     The system provides a large amount of online documentation, usually in
     text format. Use the <command>man</command> program to read entries in
     the online manual, for example:
    </para>
    <screen>man ls
man man</screen>
    <para>
     to read information about the <command>ls</command> and
     <command>man</command> commands respectively. You can search for keywords
     in the online manual with the <command>apropos</command> utility, for example:
    </para>
    <screen>apropos password</screen>
    <para>
     When this guide refers to manual pages, it uses the syntax
     <replaceable>ENTRY</replaceable>(<replaceable>SECTION</replaceable>), for
     example the ls man page, <literal>ls(1)</literal>, where 1 defines the
     manual section. Usually you do not need to provide the section number,
     but if there are several entries in different sections, you can use the
     optional <option>-S</option> switch and pick a specific one.
    </para>
    <para>
     Some programs provide additional information GNU texinfo format, use
     the <command>info</command> program to read it, for example:
    </para>
    <screen>info diff</screen>
    <para>
     Additional information, sorted by software package, can be found in the
     <filename>/usr/share/doc/*/</filename> directories. Use the
     <command>less</command> or <command>more</command> pager to read it, for
     example:
    </para>
    <screen>less /usr/share/doc/packages/bash/FAQ</screen>
    <para>
     Many programs also support a <option>--help</option>, <option>-?</option>
     or <option>-h</option> switch you can use to get a usage summary of
     supported command-line parameters.
    </para>
    <para>
     A collection of How-To documents in HTML format can be found under
     <filename>/usr/share/doc/howto/en/html</filename> if the optional
     <systemitem class="resource">howtoenh</systemitem> package is installed.
    </para>
    <para>
     Please see
     <filename>/usr/share/doc/howto/en/html/Security-HOWTO</filename> for
     security information. The HTML files can be read with the
     <command>w3m</command> browser.
    </para>
    <para>
     The &productname; documentation is also installed in electronic form.
     <filename>/usr/share/doc/packages/sles-inst-*/</filename> contains the
     installation guide in PDF format, and
     <filename>/usr/share/doc/packages/sles-admin-*/</filename> the
     administration manual.
    </para>
    <note>
     <para>
      This Configuration Guide has precedence over other documents
      in case of conflicting recommendations.
     </para>
    </note>
   </sect1>
   <sect1 id="sec.setup_for_eal.user.auth">
    <title>Authentication</title>
    <para>
     You <emphasis>must</emphasis> authenticate (prove your identity) before
     being permitted to use the system. When the administrator created your
     user account, he or she will have assigned a user name and default
     password, and provided that information for you along with instructions
     how to access the system.
    </para>
    <para>
     Logging in to the system will usually be done using the Secure Shell
     (SSH) protocol, alternatively a serial terminal may be available. Use the
     <command>ssh</command> command to connect to the system unless instructed
     otherwise by the administrator, for example:
    </para>
    <screen>ssh jdoe@172.16.0.1</screen>
    <para>
     The <command>ssh</command> manual page provides more information on
     available options. If you need to transfer files between systems, use the
     <command>scp</command> (secure copy) or <command>sftp</command> (secure
     ftp) tools.
    </para>
    <para>
     If this is the first time you are connecting to the target system, you
     will be prompted if you want to accept the host key. If the
     administrator has provided a key fingerprint for comparison, verify
     that they match, otherwise type <guimenu>yes</guimenu> to continue. You
     <emphasis>must</emphasis> immediately change your initially assigned
     password with the <command>passwd</command> utility.
    </para>
    <para>
     You <emphasis>must not</emphasis> under any circumstances attempt to
     log in from an insecure device, such as a public terminal or a computer
     belonging to a friend. Even if the person owning the computer is
     trustworthy, the computer may not be due to having been infected with
     malicious code. Always remember that the device you are typing your
     password into has the ability to save and re-use your authentication
     information, so you are in effect giving the computer you are using the
     right to do any and all actions in your name. Insecure handling of
     authentication information is the leading cause for exploits of
     otherwise secure systems, and SSH can only protect the information
     during transit, and offers no protection at all against an insecure end
     point.
    </para>
    <para>
     When you log out from the system and leave the device you have used for
     access (such as a terminal or a workstation with terminal emulation),
     you <emphasis>must</emphasis> ensure that you have not left information
     on the screen or within an internal buffer that should not be
     accessible to another user. You should be aware that some terminals
     also store information not displayed on the terminal (such as
     passwords, or the contents of a scrollback buffer). Nevertheless, this
     information may be extractable by the next user unless the terminal
     buffer has been cleared. Safe options include completely shutting down
     the client software used for access, powering down a hardware terminal,
     or clearing the scrollback buffer by switching among virtual terminals
     in addition to clearing the visible screen area.
    </para>
    <para>
     If you forget your password, contact your administrator who will be
     able to assign a new password.
    </para>
    <para>
     You <emphasis>may</emphasis> use the <command>chsh</command> and
     <command>chfn</command> programs to update your login shell and personal
     information if necessary. Not all settings can be changed this way,
     contact your administrator if you need to change settings that require
     additional privileges.
    </para>
   </sect1>
   
   <sect1 id="sec.setup_for_eal.user.password_policy">
    <title>Password Policy</title>
    <para>
     All users, including the administrators, <emphasis>must</emphasis>
     ensure that their authentication passwords are strong (very hard to
     guess) and handled with appropriate security precautions. The password
     policy described here is designed to satisfy the requirements of the
     evaluated configuration. If your organization already has a password
     policy defined, your administrator <emphasis>may</emphasis> refer you
     to that policy if it is equivalently strong.
    </para>
    <para>
     You <emphasis>must</emphasis> change the initial password set by the
     administrator when you first log into the system. You
     <emphasis>must</emphasis> select your own password in accordance with
     the rules defined here. You <emphasis>must</emphasis> also change the
     password if the administrator has set a new password, for example if
     you have forgotten your password and requested the administrator to
     reset the password.
    </para>
    <para>
     Use the <command>passwd</command> program to change passwords. It will
     first prompt you for your old password to confirm your identity, then for
     the new password. You will be prompted to enter the new password twice,
     to catch mistyped passwords.
    </para>
    <para>
     The <command>passwd</command> program will automatically perform some
     checks on your new password to help ensure that it is not easily
     guessable, but you <emphasis>must</emphasis> nevertheless follow the
     requirements in this chapter.
    </para>
    <para>
     Note that the administrators <emphasis>must</emphasis> also ensure that
     their own passwords comply with this password policy, even in cases
     where the automatic checking is not being done, such as when first
     installing the system.
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Your password <emphasis>must</emphasis> be a minimum of 8 characters
       in length. More than 8 characters <emphasis>may</emphasis> be used
       (it is <emphasis>recommended</emphasis> to use more than 8, best is
       to use passphrases), and all characters are significant.
      </para>
     </listitem>
     <listitem>
      <para>
       Use at least one character each from the following sets for
       passwords:
      </para>
      <simplelist>
       <member>Lowercase letters: abcdefghijklmnopqrstuvwxyz</member>
       <member>Uppercase letters: ABCDEFGHIJKLMNOPQRSTUVWXYZ</member>
       <member>Digits: 0123456789</member>
       <member>Punctuation: !"#$%&amp;'()*+,-./:;&lt;=&gt;?[\]ˆ_‘{|}˜</member>
      </simplelist>
     </listitem>
     <listitem>
      <para>
       You <emphasis>must not</emphasis> base the password on a dictionary
       word, your real name, login name, or other personal details (such as
       dates, names of relatives or pets), or names of real people or
       fictional characters.
      </para>
     </listitem>
     <listitem>
      <para>
       Instead of a password, you <emphasis>may</emphasis> use a passphrase
       consisting of multiple unrelated words (at least three) joined with
       random punctuation characters. Such a passphrase
       <emphasis>must</emphasis> have a length of at least 16 characters.
      </para>
     </listitem>
     <listitem>
      <para>
       You <emphasis>must not</emphasis> use a simple alphabetic string,
       palindrome or combinations of adjacent keyboard keys.
      </para>
     </listitem>
     <listitem>
      <para>
       When you choose a new password, it <emphasis>must not</emphasis> be a
       simple variation or permutation of a previously used one.
      </para>
     </listitem>
     <listitem>
      <para>
       You <emphasis>must not</emphasis> write the password on paper or
       store it on electronic devices in unprotected form. Storage in a
       secure location (such as an envelope in a safety deposit box, or
       encrypted storage on an electronic device) <emphasis>may</emphasis>
       be acceptable. Contact your administrator first to ensure that the
       protection is strong enough to make password recovery infeasible for
       the types of attackers the system is intended to protect against.
      </para>
     </listitem>
     <listitem>
      <para>
       The password is for you and you only. A password is like a
       toothbrush&mdash;you do not want to share it with anybody, even your
       best friend. You <emphasis>must not</emphasis> disclose your password
       to anybody else, or permit anybody else to use the system using your
       identity.
      </para>
      <note>
       <para>
        Note that administrators will never ask you for your password, since
        they do not need it even if they are required to modify settings
        affecting your user account.
       </para>
      </note>
     </listitem>
     <listitem>
      <para>
       You <emphasis>must not</emphasis> use the same password for access to
       any systems under external administration, including Internet sites.
       You <emphasis>may</emphasis> however use the same password for
       accounts on multiple machines within one administrative unit, as long
       as they are all of an equivalent security level and under the control
       of the same administrators.
      </para>
     </listitem>
     <listitem>
      <para>
       You <emphasis>must</emphasis> inform the administrator and select a
       new password if you have reason to believe that your password was
       accidentally disclosed to a third party.
      </para>
     </listitem>
     <listitem>
      <para>
       If the system notifies you that your password will expire soon or has
       expired, choose a new one as instructed.
      </para>
     </listitem>
    </orderedlist>
    <para>
     Contact your administrator in case of difficulty.
    </para>
    <para>
     A <emphasis>recommended</emphasis> method of generating passwords that
     fits these criteria while still being easy to memorize is to base it on
     letters of words in a sentence (<emphasis>not</emphasis> a famous
     quotation), including capitalization and punctuation and one or two
     variations. Example:
    </para>
    <screen>"Ask not for whom the bell tolls." =&gt; An4wtbt.
     "Password 'P'9tw;citd' too weak; contained in this document" =&gt; P'9tw;citd</screen>
   </sect1>

   <sect1 id="sec.setup_for_eal.user.acl">
    <title>Access Control for Files and Directories</title>
    <para>
     Linux is a multiuser operating system. You can control which other
     users will be able to read or modify your files by setting the Unix
     permission bits and user/group IDs, or (if more precise control is
     needed) by using POSIX-style access control lists (ACLs).
    </para>
    <para>
     Note that the administrators (&rootuser;) are able to override these
     permissions and access all files on the system. Use of encryption is
     <emphasis>recommended</emphasis> for additional protection of sensitive
     data.
    </para>
    <para>
     The <literal>umask</literal> setting controls the permissions of newly
     created files and directories and specifies the access bits that will be
     removed from new objects. Ensure that the setting is appropriate and
     never grant write access to others by default. The umask
     <emphasis>must</emphasis> include at least the 002 bit (no write access
     for others), and the <emphasis>recommended</emphasis> setting is 027
     (read-only and execute access for the group, no access at all for
     others).
    </para>
    <para>
     Do not set up world-writable areas in the filesystem if you want to
     share files in a controlled manner with a fixed group of other users
     (such as a project group), please contact your administrator and
     request the creation of a user group for that purpose.
    </para>
    <para>
     Always remember that you are responsible for the security of the data
     you create and use. Choose permissions that match the protection goals
     appropriate for the content, and that correspond to your
     organization's security policy.
    </para>
    <para>
     Access to confidential data <emphasis>must</emphasis> be on a
     need-to-know basis, do not make data world-readable unless the
     information is intended to be public.
    </para>
    <para>
     Whenever you start a program or script, it will execute with your access
     rights. This implies that a malicious program would be able to read and
     modify all files that you have access to. Never execute any code that you
     have received from untrustworthy sources, and do not run commands that
     you do not understand. Be aware that manipulations to the environment a
     program is run in can also cause security flaws, such as leaking
     sensitive information. Do not use the shell variables
     <envar>LD_LIBRARY_PATH</envar> or <envar>LD_PRELOAD</envar> that modify
     the shared library configuration used by dynamically linked programs.
    </para>
    <para>
     Programs can be configured to run with the access rights of the program
     file's owner and/or group instead of the rights of the calling user. This
     is the SUID/SGID mechanism, which utilities such as passwd use to be able
     to access security-critical files. You could also create your own
     SUID/SGID programs via chmod, but <emphasis>do not</emphasis> do that
     unless you fully understand the security implications - you would be
     giving away your access privileges to whoever launches the SUID program.
     Please refer to the <citetitle>Secure Programming HOWTO</citetitle> in the
     unlikely case that you need to create such a program, there you will find
     explanations of the many aspects that must be considered, such as the
     risk of unintended shell escapes, buffer overflows, resource exhaustion
     attacks and many other factors. Note that SUID root programs
     <emphasis>must not</emphasis> be added to the evaluated configuration,
     the only permitted use of the SUID bit is for setting non-root user IDs.
    </para>
    <para>
     Please refer to the <command>chmod</command>(1),
     <command>umask</command>(2), <command>chown</command>(1),
     <command>chgrp</command>(1), <command>acl</command>(5),
     <command>getfacl</command>(1), and <command>setfacl</command>(1) manual
     pages for information, or any of the many available books covering Linux
     security FIXME (cf. Appendix 'Literature'), or ask your system
     administrator for advice.
    </para>
   </sect1>
   
   <sect1 id="sec.setup_for_eal.user.import_export">
    <title>Data Import / Export</title>
    <para>
     The system comes with various tools to archive data
     (<command>tar</command>, <command>star</command>,
     <command>cpio</command>). If ACLs are used, then only
     <command>star</command> <emphasis>must</emphasis> be used to handle the
     files and directories as the other commands do not support ACLs. The
     options <option>-H=exustar</option> <option>-acl</option> must be used
     with <command>star</command>.
    </para>
    <para>
     You can refer to the <command>star</command> man(ual) page for more
     information.
    </para>
    <para/>
   </sect1>
  </chapter>
 </part>
 <part id="part.sec_prot">
  <title>General System Security and Service Protection Methods</title>

  <para>
   In <xref linkend="part.setup_for_eal"/> we covered the Common Criteria EAL
   4+ certified installation and setup that was sponsored by IBM for a select
   subset of hardware. This <quote>certified</quote> build is a great
   first-stop for customers wishing to build a secure and hardened base
   system, yet might not address all of the services and software specifics
   that many customers would be interested in.
  </para>

  <para>
   This next part will present more of a <quote>generalist</quote> view and
   give general recommendations and guidance for &productname; system
   security. Some topics may seem repeated here (from the previous part) yet
   the context is very different. More detail will be provided in some
   sections and certainly some more general examples for a greater number of
   services.
  </para>

  <chapter id="cha.sec_prot.general">
   <title>Linux Security in <quote>General</quote></title>
   <para>
    In this portion of the guide, instead of taking a
    <emphasis>must</emphasis>, <emphasis>recommended</emphasis> or
    <emphasis>may</emphasis> approach to the setup of a secured host, we
    will address security topics in a more <quote>general</quote> fashion.
    This is where you will get a rule-of-thumb or best-practice even a basic
    recommendation. The procedures and examples here should give you the
    ability to apply security enhancement techniques to a wider variety of
    server-based services and programs.
   </para>
   <para>
    Even if some of these topics might have been covered in
    <quote>explicit</quote> terms earlier with no leniency towards
    implementation variation (in accordance with the EAL target evaluation)
    you may find the examples that follow to contain more detail or
    explanation. Some of the general topics will include:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Physical Security – Protection of the server from environmental
      threats (people, places, things).
     </para>
    </listitem>
    <listitem>
     <para>
      Security Policies and Procedures – Server lifecycle management,
      disk/media reclamation, backup and archive security.
     </para>
    </listitem>
    <listitem>
     <para>
      Systems Monitoring – Procedures around event
      notification/management.
     </para>
    </listitem>
    <listitem>
     <para>
      Systems Automation – Mechanisms and/or procedures for automatic
      security measures. Heuristics, account control, security reporting and
      remediation, automated shutdown, etc.
     </para>
    </listitem>
    <listitem>
     <para>
      Systems Management – Methods to obtaining packages, verification and
      signing keys, patching procedures and recommendations.
     </para>
    </listitem>
    <listitem>
     <para>
      Securing Network – Addition programs, ports and service wrappers –
      iptables, tcpwrappers, services.
     </para>
    </listitem>
    <listitem>
     <para>
      Remote Access – extra SSH information and key federation. CA
      integration.
     </para>
    </listitem>
    <listitem>
     <para>
      Common Services – mail, nfs and automount.
     </para>
    </listitem>
    <listitem>
     <para>
      Securing the Kernel and Init Process – parameters, inittab,
      runlevels and boot scripts.
     </para>
    </listitem>
    <listitem>
     <para>
      Access Control – user/groups/permissions.
     </para>
    </listitem>
    <listitem>
     <para>
      Password Security and Warnings – Proper setup of passwords, banners
      and <systemitem class="daemon">xinetd</systemitem>.
     </para>
    </listitem>
    <listitem>
     <para>
      Miscellaneous Security – Assorted security settings and
      miscellaneous stuff.
     </para>
    </listitem>
    <listitem>
     <para>
      Resources – Web links, documentation and example references, HOWTOs
      and general information, product links.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    The sections will again be organized by a topical hierarchy for
    continuity-sake. Refer to the main table of contents for easy reference.
   </para>
   <sect1 id="sec.sec_prot.general.physical">
    <title>Physical Security</title>
    <para>
     Physical security should be one of the utmost concerns if not the one of
     the primary ones. Linux production servers should be in locked
     datacenters where only people with passed security checks have access.
     Depending on the environment and circumstances, you also may want to
     consider boot loader passwords. Some questions to consider: Who has
     direct physical access to the host? Of those that do, should they? Can
     the host be protected from tampering? Should it be? Etc.
    </para>
    <para>
     The amount of physical security needed on a particular system depends on
     the situation, and can also vary widely by available funds.
    </para>
    <sect2 id="sec.sec_prot.general.physical.locks">
     <title>
      System locks
     </title>
     <para>
      Most data center server racks include a <quote>locking</quote> feature.
      Usually this will be a hasp/cylinder lock on the front of the rack that
      allows you to turn an included key to a locked or unlocked position –
      granting or denying entry. Cage locks can help prevent someone from
      tampering or stealing devices/media from the servers, or opening up the
      cases and directly manipulating/sabotaging the hardware. Preventing
      system reboots or the booting from alternate devices is also important
      (e.g. floppys, CD/DVDs/USB drives/etc.).
     </para>
     <para>
      Some servers also have case locks. These locks can do different things
      according to the designs of the system vendor and construction. Many
      systems are designed to self-disable if attempts are made to open the
      system without unlocking. Others have device covers that will not let
      you plug in or unplug new keyboards or mice. While locks are sometimes a
      useful feature, they are usually lower quality and easily defeated by
      attackers with ill intent.
     </para>
    </sect2>
   </sect1>
   <sect1 id="sec.sec_prot.general.bios">
    <title>
     Locking down the BIOS
    </title>
    <para>
     The BIOS (Basic Input/Output System) is the lowest level of
     software/firmware that dictates system configuration and low-level
     hardware. &grub;, &lilo; and other Linux boot loaders access the BIOS to
     determine how to boot the host. Other hardware types
     (&ipseries;/&zseries;) that run Linux also have low-level
     software/firmware. Typically the BIOS can be configured to help prevent
     attackers from being able to reboot the host and manipulate the system.
    </para>
    <para>
     Most BIOS varieties allow the setting of a boot password. While this
     does not provide a high level of security (a BIOS can be reset, removed
     or modified – assuming case access), but it can be another deterrent.
    </para>
    <para>
     Many BIOS capabilities have other various security settings – checking
     with the system vendor, the system documentation or examine the BIOS
     during a system boot.
    </para>
    <important>
     <title>Booting when a BIOS Password is Set</title>
     <para>
      If a system host has been set up with a boot password,
      the host will not boot up unattended (e.g. a system reboot, power
      failure, etc.). This is the trade-off/risk.
     </para>
    </important>
   </sect1>
   <sect1 id="sec.sec_prot.general.bootloader">
    <title>
     Security via the Boot Loaders
    </title>
    <para>
     Linux boot loaders, like &grub; (used by default in &productname;) and
     &lilo; (optional), can also have a boot passwords set. &lilo; has the
     password and restricted settings. The password setting requires a
     password at boot time, and the restricted setting requires a boot-time
     password only if you specify different boot options (such as single ) at
     the &lilo; prompt.
   </para>
   <para>
     &grub; also provides a <quote>password</quote> feature, so that only
     administrators can start the interactive operations (i.e. editing menu
     entries and entering the command-line interface). If a password is
     specified, GRUB will disallow any interactive control until you press the
     key <keycap>P</keycap> or <keycap>E</keycap> and enter a correct password.
    </para>
    <para>
     You can refer to the &grub: and &lilo; man pages for examples.
    </para>
    <para>
     It is very important to keep in mind that when setting these passwords
     they will obviously need to be remembered! Also, enabling these
     passwords might merely slow an intrusion, not necessarily prevent it.
     Again, someone could boot from a floppy, and mount your root partition.
     If you are using BIOS-level security as well as a boot loader, it is a
     good practice to disable the ability to boot from floppy or other
     devices in your computer's BIOS, and then also password-protecting the
     BIOS itself.
    </para>
    <para>
     Also keep in mind that the boot loader config files will need to be
     protected by changing their mode to <literal>600</literal> (read/write
     for &rootuser; only), or others will be able to read your passwords or
     hashes!
    </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.seccheck">
    <title>Verifying Security Action with seccheck</title>
    <para>
     Verifying Security Action ItemsIt is highly recommended to have scripts
     in place which can verify that security actions or procedures have been
     run. Even the best systems administrators can make errors or forget
     something. If you have a small or large Linux installation or
     environment, you should consider the use of the seccheck scripts.
    </para>
    <para>
     Seccheck is the SUSE Security Checker. It is a set of several
     shellscripts designed to check the local security of the system on a
     regular basis. There are three main scripts that are executed at
     different time intervals. They are <literal>security-daily,</literal>
     <literal>security-weekly</literal> and
     <literal>security-monthly</literal>. At installation these scripts all
     have schedule entries that get placed in cron that determine when they
     run. Although cron scheduling is the default behavior, this can be
     controlled via configuration settings (see next section). The daily
     script runs at midnight, and if changes are detected since the last run
     (the night before), an email noting the differences will be sent. The
     weekly script runs every Monday at 1:00am, and only if changes to the
     last run (the week before) are found, a mail with the differences will be
     sent. The monthly script runs every on every 1st of the month and sends
     the full last daily and weekly report via email.
    </para>
    <sect2 id="sec.sec_prot.general.seccheck.config">
     <title>
      Seccheck Configuration
     </title>
     <para>
      Please note that you can change the receiver of the seccheck mails from
      root to anyone else if you add an entry like this one to
      <filename>/etc/sysconfig/seccheck</filename>:
     </para>
     <screen>SECCHK_USER="firewall" # exchange firewall is an admin user's account name</screen>
   <para>
      Please also note that the <envar>START_SECCHK</envar> variable from
      <filename>/etc/sysconfig/seccheck</filename> controls whether the
      security check will be run from cron. (It's ignored, if you call
      <command>security-control</command> manually.)
   </para>
   <para>
    The following daily checks are done:
   </para>
     <informaltable>
      <tgroup cols="2">
       <colspec colname="c1"/>
       <colspec colname="c2"/>
     <tbody>
      <row>
       <entry>
        <para>
           <filename>/etc/passwd</filename> check
        </para>
       </entry>
       <entry>
        <para>
         length/number/contents of fields, accounts with same uid accounts
         with uid/gid of 0 or 1 beside root and bin
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
           <filename>/etc/shadow</filename> check
        </para>
       </entry>
       <entry>
        <para>
         length/number/contents of fields, accounts with no password
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
           <filename>/etc/group</filename> check
        </para>
       </entry>
       <entry>
        <para>
         length/number/contents of fields
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         user root checks
        </para>
       </entry>
       <entry>
        <para>
           secure umask and <envar>PATH</envar>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
           <filename>/etc/ftpusers</filename>
        </para>
       </entry>
       <entry>
        <para>
         checks if important system users are put there
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
           <filename>/etc/aliases</filename>
        </para>
       </entry>
       <entry>
        <para>
         checks for mail aliases which execute programs
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
           <filename>.rhosts</filename> check
        </para>
       </entry>
       <entry>
        <para>
           checks if users' <filename>.rhosts</filename> file contain + signs
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         homedirectory
        </para>
       </entry>
       <entry>
        <para>
         checks if homedirectories are writable or owned by someone else
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         dot-files check
        </para>
       </entry>
       <entry>
        <para>
         checks many dot-files in the homedirectories if they are writable
         or owned by someone else
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         mailbox check
        </para>
       </entry>
       <entry>
        <para>
         checks if user mailboxes are owned by user and unreadable
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS export check
        </para>
       </entry>
       <entry>
        <para>
         exports should not be exported globaly
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS import check
        </para>
       </entry>
       <entry>
        <para>
           NFS mounts should have the <option>nosuid</option> option set
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         promisc check
        </para>
       </entry>
       <entry>
        <para>
         checks if network cards are in promiscious mode
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         list modules
        </para>
       </entry>
       <entry>
        <para>
         just lists loaded modules
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         list sockets
        </para>
       </entry>
       <entry>
        <para>
         just lists open ports
        </para>
       </entry>
      </row>
      <row>
       <entry namest="c1" nameend="c2">
        <para>
         Weekly Checks are as follows:
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         password check
        </para>
       </entry>
       <entry>
        <para>
         runs john to crack the password file, user will get an email notice
         to change his password asap
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         rpm md5 check
        </para>
       </entry>
       <entry>
        <para>
         checks for changed files via rpm's md5 checksum feature
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         suid/sgid check
        </para>
       </entry>
       <entry>
        <para>
         lists all suid and sgid files
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         exec group write
        </para>
       </entry>
       <entry>
        <para>
         lists all executables which are group/world writeable
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         writable check
        </para>
       </entry>
       <entry>
        <para>
         lists all files which are world writable (incl. Above)
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         device check
        </para>
       </entry>
       <entry>
        <para>
         lists all devices
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
     <important>
      <para>
    For the weekly seccheck password check to work the
    <quote>john the ripper</quote> package needs to be installed yet could
    be considered a security risk in itself. It's important to understand
    the operation of john. Normally it will be used only to send notice of
    weak passwords to users as an email as part of the weekly seccheck cron
    job. Since <quote>john</quote> would need to be installed separately, it
    is recommended to weigh the benefits and risks before doing so.
   </para>
     </important>
     <para>
      Additional monthly checks are also run, however the key difference is
      mainly that the monthly file is not a <quote>diff</quote> like the
      daily/weekly ones but the full reports in one file.
   </para>
    </sect2>
   </sect1>
   
   <sect1 id="sec.sec_prot.general.retiring">
   <title>
     Retiring Linux Servers with Sensitive Data
    </title>
    <para>
     As mentioned in <xref linkend="sec.setup_for_eal.operating.mount"/>
     security policies usually contain some procedures for the treatment of
     storage media that is going to be retired or disposed of. Disk and media
     <quote>wipe</quote> procedures are frequently prescribed as is complete
     destruction of the media. You can find several free tools on the
     internet. A search of <quote>dod disk wipe utility</quote> - will yield
     several variants. To retire servers with sensitive data, it is important
     to ensure that data cannot be recovered from the hard disks. To ensure
     that all traces of data are removed, a wipe utility can be used. Some of
     these tools can even be operated from a floppy disk (bootable) and remove
     data according to the U.S. Department of Defense (DoD) standards. Note
     that many government agencies specify their own standards for data
     security. Some standards are stronger than others, yet may require more
     time to implement. <quote>DiskSanitizer</quote> is just one of many that
     you can find. This utility is shareware and available to download at
     <ulink url="http://freshmeat.net/projects/disksanitizer"/>.
    </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.backups">
    <title>
     Backups
    </title>
    <para>
     If your system gets compromised, your backups become invaluable. But also
     in cases like bugs, accidents etc. backups can be used to compare you
     current system against your backed-up system. For production systems it
     is very important to take some Backups offsite for cases like disasters
     (e.g. offsite storage of tapes/recordable media, or offsite
     initiated).
    </para>
    <para>
     For legal reasons, some firms and organizations must be
     careful about backing up too much information and holding it too long. If
     your environment has a policy regarding the destruction of old paper
     files, you might have to extend this policy to Linux backup tapes as
     well.
     </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.partitions">
    <title>Disk Partitions</title>
    <para>
     Servers should have separate partitions for at least
     <filename>/</filename>, <filename>/boot</filename>,
     <filename>/usr</filename>, <filename>/var</filename>,
     <filename>/tmp</filename>, and <filename>/home</filename>. You don't want
     that e.g. logging and temporary space under <filename>/var</filename> and
     <filename>/tmp</filename> fill up the root partition. Third party
     applications should be on separate filesystems as well, e.g. under
     <filename>/opt</filename>.
    </para>
    <para>
     Review <xref linkend="part.setup_for_eal"/>. To repeat: It is important
     to understand the need to separate the partitions that could impact a
     running system (for example, log files filling up
     <filename>/var/log</filename> are a good reason to separate
     <filename>/var</filename> from the <filename>/</filename> partition).
     Another thing to keep in mind is that you will likely need to leverage
     LVM or another volume manager or at the very least the
     <quote>extended</quote> partition type to allow for the primary partition
     limitations (4 partitions).
   </para>
   <para>
    Another capability in &productname; is encrypting a partition or even a
     single folder or file as a container. Please refer to <xref
      linkend="cha.security.cryptofs"/> for details.
    </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.firewall">
    <title>Firewall (iptables)</title>
    <para>
    We won't cover iptables in explicit detail in this guide. Most
    companies use hardware based firewalls to protect their servers in a
    production network, which is strongly recommended for secure
    environments. However, &productname; includes the SUSE-Firewall which is
    a wrapper for iptables and is enabled by default as a simple and layered
    protection.
    </para>
    <para>
     If you are also interested in Linux stateful firewalls using
    iptables, there are several HOWTOs on the internet. See the Appendix for
    resources. For lots of iptables tutorials and examples, see
    <ulink url="http://www.linuxguruz.com/iptables/"/>. An overview is also
     available at <xref linkend="sec.fire.iptables"/>.
    </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.kernel">
    <title>Security Features in the Kernel</title>
    <para>
     The following list shows tunable kernel parameters you can use to secure
     your Linux server against attacks. Some of them are defaults already
     within the SLE distributions. To check the current status of any of these
     settings, you can query the kernel (<filename>/proc/sys/...</filename>
     contents). For example, the Source Routing setting is located in the
     <filename>/proc/sys/net/ipv4/conf/all/accept_source_route</filename>
     file. Simply cat the contents of a file to see how the current running
     kernel is setup.
    </para>
    <para>
     For each tunable kernel parameter shown, the change to the entry that
     needs to be affected can be modified or added to the
     <filename>/etc/sysctl.conf</filename> configuration file to make the
     change persistent after a reboots.
   </para>
   <para>
    You can get a list of current kernel settings by using the command:
   </para>
   <screen>sysctl -a</screen>
   <para>
    It is even a very good idea to store the output of the kernel settings
    (for comparison or reference) by redirecting the output of the sysctl
    command to a file, e.g.
    </para>
    <screen>sysctl -A &gt; /root/sysctl.settings.store</screen>
   <para>
     Because &productname; includes, by default, security-focused kernel
     tuning parameters, you will find the existing
     <filename>/etc/sysctl.conf</filename> file to be sparsely populated. You
     may choose to use the above mentioned <quote>catalog</quote> method of
     storing the complete gamut of kernel settings and then pick-and-choose
     those parameters you want to be reset at reboot. You can place these in
     the <filename>/etc/sysctl.conf</filename> file or they can be inserted
     immediately (into the running kernel) by running the command
     <command>sysctl <option>-p</option></command> or they will be picked up
     upon a reboot.
   </para>
   <para>
    Many third party applications like Oracle, SAP, DB2, Websphere, etc.
    recommend changing kernel parameters to ensure high performance for I/O
    or CPU processing. Having a full list of current settings can be helpful
    for reference.
    </para>

    <sect2 id="sec.sec_prot.general.kernel_syn_cookie">
     <title>Enable TCP SYN Cookie Protection (default in
      &productname;11)</title>
     <para>
      A <quote>SYN Attack</quote> is a denial of service attack that consumes
      all the resources on a machine. Any server that is connected to a
      network is potentially subject to this attack. To enable TCP SYN Cookie
      Protection, edit the <filename>/etc/sysctl.conf</filename> file and
      ensure the following line and value exists:
     </para>
     <screen>net.ipv4.tcp_syncookies = 1</screen>
    </sect2>
    <sect2 id="sec.sec_prot.general.route">
     <title>
     Disable IP Source Routing (default in &productname;11)
     </title>
     <para>
      Source Routing is used to specify a path or route through the network
      from source to destination. This feature can be used by network people
      for diagnosing problems. However, if an intruder was able to send a
      source routed packet into the network, then he could intercept the
      replies and your server might not know that it's not communicating with
      a trusted server.
     </para>
     <screen>net.ipv4.conf.all.accept_source_route = 0</screen>
    </sect2>
    <sect2 id="sec.sec_prot.general.icpm_redirect">
     <title>Disable ICMP Redirect Acceptance</title>
     <para>
      ICMP redirects are used by routers to tell the server that there is a
      better path to other networks than the one chosen by the server.
      However, an intruder could potentially use ICMP redirect packets to
      alter the hosts's routing table by causing traffic to use a path you
      didn't intend. To disable ICMP Redirect Acceptance, edit the
      <filename>/etc/sysctl.conf</filename> file and add the following line:
   </para>
     <screen>net.ipv4.conf.all.accept_redirects = 0</screen>
    </sect2>
    <sect2 id="sec.sec_prot.general.ip_spoofing">
     <title>Enable IP Spoofing Protection (default in &productname;11)</title>
     <para>
      IP spoofing is a technique where an intruder sends out packets which
      claim to be from another host by manipulating the source address. IP
      spoofing is very often used for denial of service attacks. For more
      information on IP Spoofing, I recommend the article <citetitle>IP
       Spoofing: Understanding the basics</citetitle>.
     </para>
     <screen>net.ipv4.conf.all.rp_filter = 1</screen>
    </sect2>
    <sect2 id="sec.sec_prot.general.icpm_ignore">
     <title>
      Enable Ignoring to ICMP Requests</title>
     <para>
      If you want or need Linux to ignore <command>ping</command> requests,
      edit the <filename>/etc/sysctl.conf</filename> file and add the
      following line:
     </para>
     <screen>net.ipv4.icmp_echo_ignore_all = 1</screen>
     <para>
      This cannot be done in many environments, as even some monitoring
      systems use a rudimentary ICMP (ping) to determine the health of the
      device on the network (or at least its ability to respond).
     </para>
    </sect2>
    <sect2 id="sec.sec_prot.general.broadcast">
     <title>Enable
    Ignoring Broadcasts Request (default in &productname;11)</title>
     <para>
      If you want or need Linux to ignore broadcast requests...
   </para>
   <screen>net.ipv4.icmp_echo_ignore_broadcasts = 1</screen>
    </sect2>
    <sect2 id="sec.sec_prot.general.errormsg">
     <title>
      Enable Bad Error Message Protection (default in &productname;11)
     </title>
     <para>
      To alert you about bad error messages in the network...
   </para>
   <screen>net.ipv4.icmp_ignore_bogus_error_responses = 1</screen>
    </sect2>
    <sect2 id="sec.sec_prot.general.logging">
     <title>
      Enable Logging of Spoofed Packets, Source Routed Packets, Redirect
      Packets
      </title>
     <para>
      To turn on logging for Spoofed Packets, Source Routed Packets, and
      Redirect Packets, edit the <filename>/etc/sysctl.conf</filename> file
      and add the following line:
     </para>
     <screen>net.ipv4.conf.all.log_martians = 1</screen>
     <note>
      <para>
       ue to the way &productname; is setup (with syslog) for network event
       tracking, keep in mind that this may cause a large amount of messages
       to be logged.
      </para>
     </note>
    </sect2>
    <sect2 id="sec.sec_prot.general.add_random">
     <title>Virtual Address Space Randomization</title>
     <para>
      Starting with
    the 2.6.x kernel releases Linux now uses address-space randomization
    technique to mitigate buffer overflows. For more information, see
      </para>
     <itemizedlist>
      <listitem>
       <para>
        <ulink
      url="http://searchopensource.techtarget.com/tip/1,289483,sid39_gci1144658,00.html"/>
       </para>
      </listitem>
      <listitem>
       <para>
        <ulink url="http://lwn.net/Articles/121845/"/>
       </para>
      </listitem>
     </itemizedlist>
    </sect2>
   </sect1>
   <sect1 id="sec.sec_prot.general.aa">
    <title>&aa;</title>
    <para>
     Included with &productname;, &aa; is an application security tool
     designed to provide an easy-to-use security framework for your
     applications. &aa; proactively protects the operating system and
     applications from external or internal threats, even zero-day attacks, by
     enforcing good behavior and preventing even unknown application flaws
     from being exploited. &aa; security policies, called "profiles",
     completely define what system resources individual applications can
     access, and with what privileges. A number of default profiles are
     included with &aa;, and using a combination of advanced static analysis
     and learning-based tools, &aa; profiles for even very complex
     applications can be deployed successfully in a matter of hours.
   </para>
   <para>
    &aa; consists of:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      a kernel module, shipped with the SUSE Linux kernel, which enforces
      the security profiles.
     </para>
    </listitem>
     <listitem>
      <para>
       a collection of RPMs, also shipped with SUSE Linux, that provide: 
      </para>
      <itemizedlist>
       <listitem>
        <para>
         a set of &aa; profiles for numerous programs that ship with
         &productname;
        </para>
       </listitem>
       <listitem>
        <para>
         tools to create and manage new and existing &aa; profiles
        </para>
       </listitem>
       <listitem>
        <para>
         a &yast; user interface to manage reports and notification of security
         events
        </para>
       </listitem>
       <listitem>
        <para>
         documentation about the &aa tools
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
   </itemizedlist>
   <para>
    It is best to reboot a system after completing installation, so that
    &aa; can confine all system daemons.
   </para>
   <para>
    The &aa; quick-start and administrative guides are available online
    here:
   </para>
   <para>
    <ulink url="http://www.novell.com/documentation/apparmor/"/>
   </para>
   <para>
    For additional details and step-by-step instructions on the usage and
     configuration of &aa; you can also refer to <xref linkend="part.aaa"/>.
   </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.selinux">   
    <title>SELinux</title>
    <para>
     SELinux is an advanced technology for securing Linux systems. Included
     with <quote>basic enablement</quote> in &productname; 11, and included
     with some other distributions by default. Hardening Linux using SELinux
     technology, on its own, warrants its own security HOWTO and is out of
     scope for this guide. The <citetitle>SELinux: NSA's Open Source Security
      Enhanced Linux</citetitle> is very good in regards to SELinux setup and
     usage. As part of the <quote>basic enablement</quote>, SELinux will not
     be officially supported, but packages have now been added to
     &productname; 11 to enable its usage with minimal effort. While &aa; is
     much easier to use and has a similar feature set, knowing both will most
     certainly be beneficial.
   </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.remote">   
    <title>
     FTP, <command>telnet</command>, and <command>rlogin</command> (rsh)
    </title>
    <para>
     The programs/protocols of FTP, <command>telnet</command>, and
     <command>rlogin</command> (rsh) are normally vulnerable to eavesdropping,
     which is one of the main reasons why secure alternatives such as
     <command>ssh</command>, <command>scp</command> or <command>sftp</command>
     should be used instead. It is highly recommended not to run the insecure
     services. Due to the high risk, this guide does not cover these services
     (other than vsftp). It would also be a good idea (and part of our
     guidance, see next section) not to have FTP and Telnet server RPMs
     installed on the system. Note that the EAL 4+ evaluation had vsftp
     installed. The <quote>vs</quote> stands for <quote>very secure</quote> -
     which is a differentiator here when compared to normal ftp.
   </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.remove_packs">   
   <title>
    Removing Unnecessary Software Packages (RPMs)
   </title>
   <para>
    A very important step in securing a Linux system is to determine the
    primary function(s) or role(s) of the Linux server. Strive for a
    deterministic and specific view of what is installed and running on the
    system. Otherwise it can be difficult to understand what needs to be
    secured and hence securing these Linux systems proactively might prove
    ineffective. Therefore, it is very critical to look at the default list
    of software packages and potentially remove any unneeded package(s) or
    packages that don't comply with your defined security policies.
   </para>
   <para>
    Doing this will result in a smaller number of packages that may require
    updates and will certainly simplify maintenance efforts if/when security
    alerts and/or patches are released. Refer to the note below regarding
    Novell's efforts around JeOS (Just Enough OS). An example could be,
    Apache or Samba installed on your system - if you don't use them, remove
    them. Also, it is generally recommended and a best practice not to have
    development packages, desktop software packages (e.g. X Server) etc.
    installed on production servers.
    </para>

    <important>
     <para>
      Many 3rd Party vendors like Oracle and IBM have a requirement for both
      the desktop environment and the development libraries to run some of
      their installers. Many organizations will create a silent installation
      (response file) in a dev lab, so this isn't an impact to production
      security.
     </para>
    </important>
    <para>
     Also, other packages like FTP and Telnet daemons should not be installed
     as well unless there is a justified business reason for it (again,
     <command>ssh</command>, <command>scp</command> or <command>sftp</command>
     should be used as replacements).
     </para>
    <para>
     One of the first action items should be to create a Linux image that
     <emphasis>only</emphasis> contains RPMs needed by the system and
     applications, and those needed for maintenance and/or troubleshooting
     purposes. A good approach is to start with a minimum list of RPMs and
     then add packages as needed. It may be time-consuming but worth the
     efforts.
   </para>
    <note>
     <title>Just Enough Operating System (JeOS)</title>
     <para>
      To this end, shortly after the release of &productname; 10 SP2,
      Novell/SUSE developed a program called the SUSE Appliance Program.
      Included with this program is component called <quote>JeOS</quote>
      (pronounced <quote>juice</quote>) which stands for <quote>Just Enough
       Operating System</quote>. JeOS has a very small footprint and can be
      built to fit the very specific needs of a system developer. Main uses of
      JeOS will be for hardware/software appliance or virtual machine
      development. Key benefits of JeOS are efficiency, higher performance,
      increased security and simplified management.
     </para>
    </note>
    <para>
     To generate a list of all installed RPMs - use the following
     command:
    </para>
   <screen>rpm -qa</screen>
   <para>
    To retrieve details about a particular RPM (from the RPM itself), run:
   </para>
    <screen>rpm -qi <replaceable>package_name</replaceable></screen>
   <para>
    To check for and report potential conflicts and dependencies when
    deleting an RPM, run:
   </para>
    <screen>rpm -e --test <replaceable>package_name</replaceable></screen>
   <para>
    This can be very useful, as running the removal command without a
    <quote>test</quote> can often yield a mass of complaints and require
    manual recursive dependency hunting.
   </para>
    
    <remark condition="clarity">
     2011-07-12 - fs: The following seems to be a bit out of context...
    </remark>
    
   <para>
     For information on performing &ay; installations and how to build an
     image, see the &ay; documentation at <ulink
      url="http://www.suse.de/~ug/"/> for more information. Uwe Gansert keeps
     the &ay; documentation up to date and lists enhancements and differences
     between shipping versions of &ay; on his page.
   </para>
   </sect1>
   <sect1 id="sec.sec_prot.general.patching">   
    <title>
    Patching Linux Systems
   </title>
   <para>
    Building an infrastructure for the purpose of patch management is
    another very important part of a proactive and secure production Linux
    environment.
   </para>
   <para>
    It is recommended to have a written security policy and procedure to
    handle Linux security updates and issues. For example, a security policy
    should detail the time frame for assessment, testing, and roll out of
    patches. Network related security vulnerabilities should get the highest
    priority and should be addressed immediately within a short time frame.
    The assessment phase should occur within a testing lab, and initial roll
    out should occur on development systems first
   </para>
   <para>
    A separate security log should detail what Linux security notices have
    been received, when patches have been researched and assessed, when
    patches have been applied etc.
   </para>
   <para>
     At this time &suse; releases their patches in three categories, security,
     recommended and optional. There are a few options that can be used to
     keep systems patched, up to date and secure. Each individual system can
     register and then retrieve updates via the Novell Update website using
     the included &yast; tool – &you;. Novell has also created the
     &smtool; (&smt;) an efficient way to maintain a local
     repository of available/released patches/updates/fixes that systems can
     then pull from (reducing internet traffic). Novell also offers ZENworks
     Linux Management (ZLM), part of Novell's systems management family of
     products, specifically for the maintenance, patching, reporting and
     centralized management of Linux systems, not just &suse;, but other
     distributions as well.
    </para>
    <sect2 id="sec.sec_prot.general.patching.you">
   <title>
    &you;
   </title>
   <para>
      On a per-server basis, installation of important updates and
      improvements is possible using the &you; tool. Current updates for the
      &sle; family are available from the product specific update catalogs
      containing patches. Installation of updates and improvements is
      accomplished using &yast; and selecting <guimenu>Online Update</guimenu>
      in the <guimenu>Software</guimenu> Group. All new patches (except the
      optional ones) that are currently available for your system will already
      be marked for installation. Clicking <guimenu>Accept</guimenu> will then
      automatically install these patches.
   </para>
   <para>
      After installation is complete, click the <guimenu>Finish</guimenu> button. The system will
    be patched, current and up-to-date.
   </para>
    </sect2>
    <sect2 id="sec.sec_prot.general.patching.auto">
   <title>
    Automatic Online Update
   </title>
   <para>
    &yast; also offers the possibility to set up an automatic update. Select
      <menuchoice>
       <guimenu>Software</guimenu>
       <guimenu> Automatic Online Update</guimenu></menuchoice>. Configure a
      Daily or a Weekly
    update. Some patches, such as kernel updates, require user interaction,
    which would cause the automatic update procedure to stop. Check Skip
    Interactive Patches for the update procedure to proceed automatically.
   </para>
   <para>
    In this case, run a manual Online Update from time to install patches
    that require interaction.
   </para>
   <para>
      When <guimenu>Only Download Patches</guimenu> is checked, the patches
      are downloaded at the specified time but not installed. They must be
      installed manually. The patches are downloaded to the rug cache
      directory, <filename>/var/cache/zmd/web</filename>, by default. Use the
      command <command>rug get-prefs cache-directory</command> to get the
      current rug cache directory
   </para>
    <sect2 id="sec.sec_prot.general.patching.zlm">
   <title>
    ZENworks Linux Management (ZLM)
   </title>
   <para>
    ZENworks Linux Management lets you install, remove, and roll back
    software on your Linux devices. This is done through the use of bundles,
    which are collections of one or more software (RPM) packages. ZENworks
    automatically resolves dependencies for any software packages it is
    installing.
   </para>
   <para>
    When you assign a bundle to a device, it is automatically installed on
    the device. If you want to give the device's user the choice of
    whether or not to install a software package, you can use catalogs. A
    catalog is simply a group of bundles that appears in the ZENworks Linux
    Management Software Updater client on the device; the user must initiate
    installation of any of the bundles in the catalog.
   </para>
     <variablelist>
      <varlistentry>
   <term>
    ZLM - Policy-Based Device Management
   </term>
       <listitem>
   <para>
    ZENworks Linux Management provides a number of policies to help you
    manage the Novell Linux Desktop, Evolution™ e-mail client, Epiphany
    Web browser, and several other software applications. Policies enable
    you to provide consistent operating system and application configuration
    settings for your devices. You can lock the configuration settings so
    that users cannot change them.
   </para>
       </listitem>
      </varlistentry>
      <varlistentry>
   <term>
    ZLM - Automated Install and Imaging
   </term>
       <listitem>
   <para>
    ZENworks Linux Management includes a service called Preboot Services
    that enables you to perform tasks on devices before their operating
    systems boot up. Using Preboot Services, you can automatically or
    manually do the following to a Linux device when it boots up:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Run scripted installations on the device, such as Auto&yast; and
      kickstart.
     </para>
    </listitem>
    <listitem>
     <para>
      Run ZENworks imaging scripts on the device.
     </para>
    </listitem>
    <listitem>
     <para>
      Make an image of the device's hard drives and other storage devices.
     </para>
    </listitem>
         <listitem>
      <para>
       Restore an image to the device.
      </para>
     </listitem>
     <listitem>
      <para>
       Apply an existing image to multiple devices.
      </para>
     </listitem>
     <listitem>
      <para>
       Update the device's BIOS.
      </para>
     </listitem>
        </itemizedlist>


    <para>
     To accomplish these tasks automatically, there simply needs to be a PXE
     (Preboot Execution Environment) enabled on device targets, and to have
     prebootable tasks configured and assigned to the devices . Then, the
     devices can automatically implement these tasks when they boot. Or, to
     manually implement the tasks, devices can be configured to require user
     intervention during bootup.
    </para>
       </listitem>
      </varlistentry>
      <varlistentry>
    <term>
     ZLM - Remote Management
    </term>
       <listitem>
    <para>
     ZENworks Linux Management provides the ability to use ZENworks Control
     Center (ZCC) to remotely manage devices by using a graphical Web
     interface.
    </para>
       </listitem>
      </varlistentry>
      <varlistentry>
    <term>
     ZLM - Inventory Collection
    </term>
       <listitem>
    <para>
     ZENworks Linux Management can gather extensive software and hardware
     inventory for all managed devices, and it also enables you to create
     and export custom reports.
    </para>
       </listitem>
      </varlistentry>
      <varlistentry>
    <term>
     ZLM - Features Specific to Dell PowerEdge Servers
    </term>
       <listitem>
    <para>
     By combining ZENworks Linux Management capabilities with the Dell
     OpenManage toolkit capabilities, it is possible to manage Dell
     PowerEdge servers right out of the box through the entire server life
     cycle.
    </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </sect2>
        <sect2 id="sec.sec_prot.general.patching.smt">
    <title>
     &smtool; - &smt;
    </title>

    <para>
     The &smtool;for &sle; goes one
     step further than the Online Update process by establishing a proxy
     system with repository and registration targets. This helps customers
     centrally manage software updates within the firewall on a per-system
     basis, while maintaining their corporate security policies and
     regulatory compliance.
    </para>

    <para>
      The downloadable &smt; (<ulink
       url="http://download.novell.com/index.jsp?product_id=&amp;search=Search&amp;families=&amp;date_range=&amp;keywords=subscription+management+tool&amp;sort_by=&amp;results_per_page=&amp;x=20&amp;y=10"/>) 
      &smt; is integrated with &ncc; (<ulink
       url="http://www.novell.com/customercenter/"/>) and provides a
      repository and registration target that is synchronized with it. This
      can be very helpful in tracking entitlements in large deployments. The
      &smt; maintains all the capabilities of &ncc;, while allowing a more
      secure centralized deployment. It is included with every &sle;
      subscription and is therefore fully supported.
    </para>

    <para>
     The &smt; provides an alternative to the default configuration, which
     requires opening the firewall to outbound connections for each device
     to receive updates. That requirement often violates corporate security
     policies and can be seen as a threat to regulatory compliance by some
     organizations. Through its integration with &ncc;, the
     &smt; ensures that each device can receive its appropriate updates
     without the need to open the firewall, and without any redundant
     bandwidth requirements.
    </para>

    <para>
     The &smt; also enables customers to locally track their &sle;
     devices (i.e., servers, desktops, or Point of Service
     terminals) throughout their enterprise. Now they can easily determine
     how many entitlements are in need of renewal at the end of a billing
     cycle without having to physically walk through the data center to
     manually update spreadsheets.
    </para>

    <para>
     The &smt; informs the &sle; devices of any available
     software updates. Each device then obtains the required software
     updates from the &smt;. The introduction of the &smt; improves the
     interaction among &sle; devices within the network and
     simplifies how they receive their system updates. The &smt; enables an
     infrastructure for several hundred &sle; devices per
     instance of each installation (depending on the specific utilization
     profile). This offers more accurate and efficient server tracking.
    </para>

    <para>
     In a nutshell, the &smtools; for &sle; provides customers with:
    </para>

    <itemizedlist>
     <listitem>
      <para>
       Assurance of firewall and regulatory compliance
      </para>
     </listitem>
     <listitem>
      <para>
       Reduced bandwidth usage during software updates
      </para>
     </listitem>
     <listitem>
      <para>
       Full support under active subscription from Novell
      </para>
     </listitem>
     <listitem>
      <para>
       Maintenance of existing customer interface with &ncc;
      </para>
     </listitem>
     <listitem>
      <para>
       Accurate server entitlement tracking and effective measurement of
       subscription usage
      </para>
     </listitem>
     <listitem>
      <para>
       Automated process to easily tally entitlement totals (no more
       spreadsheets!)
      </para>
     </listitem>
     <listitem>
      <para>
       Simple installation process that automatically synchronizes server
       entitlement with &ncc;
      </para>
     </listitem>
    </itemizedlist>
    </sect2>
   </sect1>

    <para>
     Securing the Network - Open Network Ports Detection
    </para>

    <para>
     Securing a server requires that you know what it is serving; what
     services are running. Default server installations may have services
     running that aren't self apparent and open network ports that they are
     using. So, one of the most important tasks is to detect and close
     network ports that are not needed. To get a list of listening network
     ports (TCP and UDP sockets), you can use the netstat service run the
     following command:
    </para>

    <para>
     netstat -tulp
    </para>

    <para>
     Be aware that netstat output can be wider than a default terminal
     screen. If the screen is too narrow, the options described above will
     likely cause the output to wrap and be less legible.
    </para>

    <para>
       Below is an example of output from the above command:
    </para>
   </sect1>
   <informaltable frame="all">
    <tgroup cols="7">
     <thead>
      <row>
       <entry>
        <para>
         Proto
        </para>
       </entry>
       <entry>
        <para>
         Recv-Q
        </para>
       </entry>
       <entry>
        <para>
         Send-Q
        </para>
       </entry>
       <entry>
        <para>
         Local Address
        </para>
       </entry>
       <entry>
        <para>
         Foreign Address
        </para>
       </entry>
       <entry>
        <para>
         State
        </para>
       </entry>
       <entry>
        <para>
         PID/Program name
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         tcp
        </para>
       </entry>
       <entry>
        <para>
         0
        </para>
       </entry>
       <entry>
        <para>
         0
        </para>
       </entry>
       <entry>
        <para>
         *:auth
        </para>
       </entry>
       <entry>
        <para>
         *:*
        </para>
       </entry>
       <entry>
        <para>
          LISTEN
        </para>
       </entry>
       <entry>
        <para>
         2328/xinetd
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         tcp
        </para>
       </entry>
       <entry>
        <para>
         0
        </para>
       </entry>
       <entry>
        <para>
         0
        </para>
       </entry>
       <entry>
        <para>
         localhost.localdomain:smtp
        </para>
       </entry>
       <entry>
        <para>
         *:*
        </para>
       </entry>
       <entry>
        <para>
          LISTEN
        </para>
       </entry>
       <entry>
        <para>
         2360/sendmail: acce
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         tcp
        </para>
       </entry>
       <entry>
        <para>
         0
        </para>
       </entry>
       <entry>
        <para>
         0
        </para>
       </entry>
       <entry>
        <para>
         *:ssh
        </para>
       </entry>
       <entry>
        <para>
         *:*
        </para>
       </entry>
       <entry>
        <para>
          LISTEN
        </para>
       </entry>
       <entry>
        <para>
         2317/sshd
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <sect3>
    <title/>
    <sect4>
     <title>Table 4: netstat active listeners example</title>
     <para>
      From the output above you can see that three tcp-based services are
      running and listening: xinetd, sendmail, and sshd. Sendmail should not
      be configured to listen for incoming network connections unless the
      server running it is a designated as a mail or relay server. Running a
      port scan from another server will be able to confirm that, but make
      sure to obtain proper permissions to scan/probe a machine on a
      production network.
     </para>
     <para>
      Important: Some organizations consider port scans without permission a
      security offense.
     </para>
     <para>
      Using the nmap tool, just such a probe/scan can be run:
     </para>
     <para>
        nmap -sTU &lt;remote_host&gt;
     </para>
     <para>
      Starting nmap 3.70 ( http://www.insecure.org/nmap/ ) at 2004-12-10
      22:51 CST
     </para>
     <para>
      Interesting ports on jupitor (172.16.0.1):
     </para>
     <para>
      (The 3131 ports scanned but not shown below are in state: closed)
     </para>
     <informaltable frame="all">
      <tgroup cols="3">
       <tbody>
        <row>
         <entry>
          <para>
           PORT
          </para>
         </entry>
         <entry>
          <para>
           STATE
          </para>
         </entry>
         <entry>
          <para>
           SERVICE
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           22/tcp
          </para>
         </entry>
         <entry>
          <para>
           open
          </para>
         </entry>
         <entry>
          <para>
           ssh
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           113/tcp
          </para>
         </entry>
         <entry>
          <para>
           open
          </para>
         </entry>
         <entry>
          <para>
           auth
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </sect4>
   </sect3>
   <sect3>
    <title/>
    <sect4>
     <title>Table 5: nmap port scan example</title>
     <para>
      Nmap run completed -- 1 IP address (1 host up) scanned in 221.669
      seconds
     </para>
     <para>
      Note that running the nmap command can take quite a while (in this
      example almost 4 minutes) depending on the options used. If you remove
      the UDP port scan (leave out the "-U" option), then nmap will finish
      the port scan nearly immediately. Running it on a local machine will
      also make it complete quickly. The results of nmap can vary widely and
      might not show all listening network sockets depending on the status
      of the SUSE firewall (or other) and if it has been setup to block any
      ports. From the sample run above, you see that the xinetd daemon is
      listening on port auth (port 113) for IDENT (for more information on
      this service, see below). You can also see that sendmail is not
      listening for remote incoming network connections.Another method
      (safer) to list all of the TCP and UDP sockets to which programs are
      listening (on a host) is to use the lsof command – which lists open
      files :
     </para>
     <para>
      # lsof -i -n | egrep 'COMMAND|LISTEN|UDP'COMMAND  PID  USER  FD 
      TYPE   DEVICE SIZE/OFF NODE NAMEsshd  2317  root  3u  IPv6  6579
      0t0   TCP *:ssh (LISTEN)xinetd  2328  root  5u  IPv4  6698 0t0 
      TCP *:auth (LISTEN)sendmail  2360  root  3u  IPv4  6729 0t0  TCP
      127.0.0.1:smtp (LISTEN)
     </para>
    </sect4>
   </sect3>
   <sect3>
    <title/>
    <sect4>
     <title>Table 6: lsof utility - Sample Output</title>
     <para>
      Disabling Runlevel Services
     </para>
     <para>
      One of the most important tasks is the removal of any network services
      from a systems startup (init) process that are not needed. On SUSE
      systems you can list all services which are started at boot time using
      the following command:
     </para>
     <para>
      chkconfig -l |grep on
     </para>
     <para>
      This command will list any service that has been enabled to start at
      any of the 7 init levels. 0 through 6 and also S (single user). Notice
      there may be quite a few services enabled on a given host, but many
      runlevel services (Stand-Alone Services) might not be for network
      related services. There are some services that are only run during the
      boot process. Make sure NOT to disable any runlevel services that are
      needed by the system to run smoothly. For example, many of these type
      of services will begin with a prefix of <quote>boot.</quote>Some
      examples of Runlevel System Services which you may or may not want to
      enable (check &yast; “System Services (Runlevels)” module for a
      complete list):
     </para>
     <informaltable frame="all">
      <tgroup cols="2">
       <thead>
        <row>
         <entry>
          <para>
           Service Name
          </para>
         </entry>
         <entry>
          <para>
           Description of Service
          </para>
         </entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <para>
           syslog
          </para>
         </entry>
         <entry>
          <para>
           important for syslog services
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           netfs
          </para>
         </entry>
         <entry>
          <para>
           needed only if there are NFS shares that should be mounted at
           boot time
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           network
          </para>
         </entry>
         <entry>
          <para>
           important for starting network interfaces (e.g. eth0, eth1,
           bonding,...)
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           random
          </para>
         </entry>
         <entry>
          <para>
           used for the system entropy pool
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           atd
          </para>
         </entry>
         <entry>
          <para>
           needed if the at(1) service is used instead of cron
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           apmd
          </para>
         </entry>
         <entry>
          <para>
           Advanced Power Management (APM) daemon is used for laptops and
           some desktops
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           isdn
          </para>
         </entry>
         <entry>
          <para>
           needed if ISDN is being used
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           iptables
          </para>
         </entry>
         <entry>
          <para>
           needed if Netfilter (iptables) Firewall is being used
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           ip6tables
          </para>
         </entry>
         <entry>
          <para>
           needed if ip6tables Firewall is being used
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           pcmcia
          </para>
         </entry>
         <entry>
          <para>
           not needed on servers - needed for laptops
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           irqbalance
          </para>
         </entry>
         <entry>
          <orderedlist>
           <listitem>
            <para>
              important for distributing interrupts across all CPUs
            </para>
           </listitem>
          </orderedlist>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           sendmail
          </para>
         </entry>
         <entry>
          <para>
           needed if Sendmail is used - Procmail should be used which is
           more secure
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           autofs
          </para>
         </entry>
         <entry>
          <para>
           needed if automounter is used - production applications should
           not be dependent on automounter
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           sshd
          </para>
         </entry>
         <entry>
          <para>
           important for logins via SSH
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           portmap
          </para>
         </entry>
         <entry>
          <para>
           needed if e.g. NFS is being used
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           nfslock
          </para>
         </entry>
         <entry>
          <para>
           needed if NFS shares are mounted
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           nfs
          </para>
         </entry>
         <entry>
          <orderedlist>
           <listitem>
            <para>
             needed if server runs the NFS server
            </para>
           </listitem>
          </orderedlist>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           mdmonitor
          </para>
         </entry>
         <entry>
          <para>
           needed only if software RAID is being used
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           crond
          </para>
         </entry>
         <entry>
          <para>
           important for running cron jobs
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           xinetd
          </para>
         </entry>
         <entry>
          <para>
           needed if xinetd services are being used, see /etc/xinetd.d/ for
           list of services
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           cups
          </para>
         </entry>
         <entry>
          <para>
           needed if CUPS is used for the printing system
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           rhnsd
          </para>
         </entry>
         <entry>
          <para>
           needed if server should connect to RHN to check for software
           updates etc.
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           sysstat
          </para>
         </entry>
         <entry>
          <para>
           needed to reset system statistics logs
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           audit
          </para>
         </entry>
         <entry>
          <para>
           needed only if Linux Audit Subsystem (LAuS) should run for
           collecting system call audit records
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           psacct
          </para>
         </entry>
         <entry>
          <para>
           needed only if kernel process accounting information is needed
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           smartd
          </para>
         </entry>
         <entry>
          <para>
           important for monitoring disk problems if hard disks support
           SMART technology
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           netdump
          </para>
         </entry>
         <entry>
          <orderedlist>
           <listitem>
            <para>
             important if kernel oops data and memory dumps should be sent
             to a Netdump server for server crashes
            </para>
           </listitem>
          </orderedlist>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </sect4>
   </sect3>
   <sect3>
    <title/>
    <sect4>
     <title>Table 7: init services and their descriptions - Examples</title>
     <para>
      The init (start/stop) scripts of all the runlevel services are found
      in the /etc/init.d directory. For example, if you don't know what the
      atd service does, go to /etc/init.d and open the file atd. And in the
      script look for lines that start programs. In the atd script the
      "startproc $ATD_BIN $ATD_ARGS" line starts the 'process' atd. Now
      having the name of the program that is started by this service, you
      can check the online pages of atd by running man atd. This will help
      you to find out more about a system service.
     </para>
     <para>
      To permanently disable e.g. the runlevel service nfs, run:
     </para>
     <para>
      chkconfig nfs off
     </para>
     <para>
      To immediately disable the runlevel service nfs, execute:
     </para>
     <para>
      /etc/init.d/nfs stop
     </para>
     <para>
      or just: rcnfs stop
     </para>
     <para>
      Xinetd Services - Disabling
     </para>
     <para>
      The xinetd daemon is a replacement for inetd, the internet services
      daemon. It monitors the ports for all network services configured in
      /etc/xinetd.d, and starts the services in response to incoming
      connections. To check if xinetd is enabled and running, execute:
     </para>
     <para>
      chkconfig --list xinetd
     </para>
     <para>
      xinetd 0:off 1:off 2:off 3:on 4:on 5:on 6:off
     </para>
     <para>
      To check the current status of the xinetd service, execute:
     </para>
     <para>
      /etc/init.d/xinetd status
     </para>
     <para>
      or just:  rcxinetd status
     </para>
     <para>
      Checking for service xinetd: xinetd (pid 2619) is running...
     </para>
     <para>
      If xinetd is active, it is very important to see which services are
      active and being controlled by xinetd. The following command will list
      all services configured in /etc/xinetd.d and whether xinetd monitors
      the ports for these services:
     </para>
     <para>
      chkconfig --list | awk '/xinetd based services/,/""/'
     </para>
     <para>
      xinetd based services:
     </para>
     <para>
        chargen:   off chargen-udp: off cups-lpd: off cvs:   off daytime:
        off daytime-udp: off discard:   off discard-udp: off echo: off
      echo-udp: off netstat:   off rsync:   off sane-port:   off servers:
        off services: off svnserve: off swat: off systat: off tftp: on
      time: off time-udp: off vnc:   off
     </para>
     <para>
      To get a list of only active services for which xinetd monitors the
      ports, you could run (where the <quote>-v</quote> option of grep does
      an inverse-match) :
     </para>
     <para>
      chkconfig --list | awk '/xinetd based services/,/""/' | grep -v off
     </para>
     <para>
      xinetd based services:
     </para>
     <para>
        tftp: on
     </para>
     <para>
      In the above example you can see that the telnet-server RPM is not
      installed on the system. If the Telnet Server package telnet-server
      would be installed, it would show up on the list whether it's active
      or not. Here is an example how to disable a service. Assuming the tftp
      service is active, run the following commands to disable it and to see
      how the telnet service entries are being updated:
     </para>
     <para>
      chkconfig -l tftp
     </para>
     <para>
      xinetd based services:
     </para>
     <para>
        tftp: on
     </para>
     <para>
      cat /etc/xinetd.d/tftp | grep disable
     </para>
     <para>
      disable = no
     </para>
     <para>
      chkconfig tftp off
     </para>
     <para>
      chkconfig --list tftp
     </para>
     <para>
      xinetd based services:
     </para>
     <para>
        tftp: off
     </para>
     <para>
      cat /etc/xinetd.d/tftp | grep disable
     </para>
     <para>
      disable = yes
     </para>
     <para>
      For the tftp service it would be better to remove the package from the
      system since removal is always safer than just disabling (when
      possible):
     </para>
     <para>
      rpm -e tftp
     </para>
     <para>
      Inventory xinetd services:
     </para>
     <para>
      It is important to investigate all active xinetd services and to
      disable them (or remove their packages) if they are not needed. To
      find out what a service does, here is a viable approach. Using the
      <quote>tftp</quote> service as an example and assuming its function is
      unknown and it is listed as an active service. Execute the following
      commands:
     </para>
     <para>
      grep " server" /etc/xinetd.d/tftp
     </para>
     <para>
        server = /usr/sbin/in.tftpd
     </para>
     <para>
        server_args = -s /tftpboot
     </para>
     <para>
      To read the manual:
     </para>
     <para>
        man in.tftpd
     </para>
     <para>
      Sample of 'man' page output:
     </para>
     <para>
      TFTPD(8) System Manager's Manual TFTPD(8)
     </para>
     <para>
      NAME tftpd - IPv4 Trivial File Transfer Protocol server
     </para>
     <para>
      SYNOPSIS in.tftpd [options...] directory...
     </para>
     <para>
      DESCRIPTION tftpd is a server for the Trivial File Transfer Protocol.
      The TFTP protocol is extensively used to support remote booting of
      diskless devices. The server is normally started by inetd, but can
      also run standalone. OPTIONS --ipv4, -4 Connect with IPv4 only, even
      if IPv6 support was compiled in. --ipv6, -6 Connect with IPv6 only, if
      compiled in.
     </para>
     <para>
      {etc}
     </para>
     <para>
      To determine what package supplies the in.tftpd binary:
     </para>
     <para>
      rpm -qf /usr/sbin/in.tftpd
     </para>
     <para>
      tftp-0.48-101.16
     </para>
     <para>
      To get a description of tftp and its usage, etc:
     </para>
     <para>
      rpm -qi tftp-0.48-101.16| awk '/Description/,/""/'
     </para>
     <para>
      Description :
     </para>
     <para>
      The Trivial File Transfer Protocol (TFTP) is normally used only for
      booting diskless workstations and for getting or saving network
      component configuration files.
     </para>
     <para>
      To get a list of what files are installed via the tftp package (RPM),
      execute the rpm command with the following options:
     </para>
     <para>
      rpm -ql tftp-0.48-101.16
     </para>
     <para>
      /etc/xinetd.d/tftp
     </para>
     <para>
      /usr/bin/tftp
     </para>
     <para>
      /usr/sbin/in.tftpd
     </para>
     <para>
      /usr/share/doc/packages/tftp
     </para>
     <para>
      /usr/share/doc/packages/tftp/README
     </para>
     <para>
      /usr/share/doc/packages/tftp/README.security
     </para>
     <para>
      /usr/share/doc/packages/tftp/sample.rules
     </para>
     <para>
      /usr/share/man/man1/tftp.1.gz
     </para>
     <para>
      /usr/share/man/man8/in.tftpd.8.gz
     </para>
     <para>
      /usr/share/man/man8/tftpd.8.gz
     </para>
     <para>
      This example described what could be done to find out information
      about services (specifically ones started by xinetd) even if an online
      manual didn't exist for the binary in.ftpd. This example yielded a man
      page – but you may not always find one. The RPM commands in the
      example are very commonly used for a variety of reasons. It is also
      possible to use the &yast; software management interface to retrieve all
      of the resultant information – however having a knowledge of RPM
      command syntax can save quite a bit of time.Again to disable the tftp
      service, execute the following command:
     </para>
     <para>
        chkconfig tftp offThe xinetd daemon is quite flexible and has many
      features. Here are just a few functionalities of Xinetd:
     </para>
     <orderedlist>
      <listitem>
       <para>
        Access control for TCP, UDP, and RPC services.
       </para>
      </listitem>
      <listitem>
       <para>
        Access limitations based on time.
       </para>
      </listitem>
      <listitem>
       <para>
        Provides mechanisms to prevent DoS attacks.
       </para>
      </listitem>
     </orderedlist>
     <para>
      For more specific information on Xinetd, review the documentation and
      usage examples at the xinetd website:
      <ulink
      url="http://www.xinetd.org/"/> and also for some xinetd
      usage tutorials:
      <ulink url="http://www.macsecurity.org/resources/xinetd/tutorial.shtml"/>
     </para>
     <para>
      Reviewing Inittab and Boot Scripts
     </para>
     <para>
      The inittab file located in /etc/inittab contains a running 'tab'
      (table) or list of which processes are to be started at bootup during
      normal system operation. Some 3rd party vendors will install an entry
      there to ensure the initialization and startup of dependent services.
      E.g. Oracle places cluster services startup entries here to ensure
      they start at boot time. It is important to review this file and
      verify all entries (in the /etc/inittab) are appropriate in your
      environment. It is highly recommended to trap the CTRL-ALT-DELETE key
      sequence in order to prevent accidental reboots. The following command
      uses the sed string processor to find the “ca::ctrlaltdel” string
      and add a # symbol to the front of it. This will comment-out the whole
      line – thereby disabling the entry:
     </para>
     <para>
      sed -i 's/ca::ctrlaltdel:/#ca::ctrlaltdel:/g' /etc/inittab
     </para>
     <para>
      It is generally recommended to make the default runlevel of a
      production system set to <quote>3</quote> - which means, multi-user
      WITH networking but WITHOUT graphics. In other words – the Xwindows
      subsystem should not be running. It uses server compute cycles and is
      generally not needed. In this case, it should be removed – if not
      used. Setting the default runlevel is normally done via &yast; at time
      of installation – or by using the “System Services (Runlevel)”
      tool in &yast;. This tool will set the inittab for you, or you can make
      the modification manually (ensuring “id:3:initdefault” is in the
      inittab):
     </para>
     <para>
      grep ':initdefault' /etc/inittab
     </para>
     <para>
      id:3:initdefault:
     </para>
     <para>
      To have changes in /etc/inittab become effective immediately, you can
      'tell' init to re-examine the inititab like this:
     </para>
     <para>
      telinit q
     </para>
     <para>
      Reviewing the System Services tool in &yast; is a great way to determine
      what will be started on a system. The System Services (Runlevel) tool
      has a normal and <quote>Expert</quote> mode. Switch to
      <quote>Expert</quote> to see some of the boot services. These can be
      important for things like multipath, etc.
     </para>
     <para>
      Restricting System Access from Servers and Networks
     </para>
     <para>
      Normally a firewall is used to protect a server from other servers and
      networks – or to protect an environment from the server itself.
      However, you can also protect a server or more accurately, an
      individual service using a TCP wrapper (which is a function of Xinetd
      – already discussed above). The Xinetd super server that comes with
      &productname; provides a built-in TCP wrapper functionality. This can
      be utilized to specifically define network services to accept or deny
      incoming connections from specified hosts and networks. The TCP
      wrappers implements access control through the use of two files,
      /etc/hosts.allow and /etc/hosts.deny. Note that the hosts.allow file
      takes precedence over the hosts.deny file. And you may want to change
      the permissions on the two configuration files since they are both
      world readable. An important difference between the security provided
      by a TCP wrapper vs. the use of netfilter (iptables) – is that
      netfilter works at the network layer (layer 2) and can provide
      security before the traffic goes up the stack to the application
      layers. The trade-off however is that a TCP wrapper allows for the use
      of a <quote>banner</quote> - or a welcome message (per service) and
      some other things. It is best to know what an organization requires
      – so the best recommendation can be made.Generally, a best-practice
      strategy is to block all incoming requests by default, and allow only
      specific hosts or networks to connect. Commonly called -
      <quote>deny-all, permit-few</quote> this is the strategy that is
      proposed here. First, edit the /etc/hosts.deny file and add the
      following line:
     </para>
     <para>
        ALL: ALL
     </para>
     <para>
      Then, in order to accept incoming SSH connections from specific hosts
      (e.g. nodes sles-ha1, sles-ha2 and sles-ha3, modify the
      /etc/hosts.allow file and add the following line:
     </para>
     <para>
      sshd: sles-ha1 sles-ha2 sles-ha3
     </para>
     <para>
      To accept incoming SSH connections from all servers from a specific
      network, add the name of the subnet to /etc/hosts.allow. Adjust the
      entry like this:
     </para>
     <para>
      sshd: sles-ha1 sles-ha2 sles-ha3 .network.xyz.com
     </para>
     <para>
      Remember, each service can be defined separately. In order to accept
      incoming portmap connections from the host at IP address 192.168.0.1
      and from the subnet 192.168.5, the following modification can be made
      to /etc/hosts.allow:
     </para>
     <para>
      portmap: 192.168.0.1 192.168.5.
     </para>
     <para>
      To accept connections from all servers on the subnet named
      .network.xyz.com but not from host badhost.network.xyz.com, add the
      following line to the /etc/hosts.allow file:
     </para>
     <para>
         ALL: .network.xyz.com EXCEPT badhost.network.xyz.com
     </para>
     <para>
      Here are other examples that show some features of TCP wrapper: If you
      just want to restrict ssh connections without configuring or using
      /etc/hosts.deny, you can add the following entries to
      /etc/hosts.allow:
     </para>
     <para>
      sshd: rac1cluster rac2cluster rac3cluster
     </para>
     <para>
      sshd: ALL: DENY
     </para>
     <para>
      The version of TCP wrapper that comes with &productname; also supports
      the extended options documented in the hosts_options man page. Here is
      an example how an additional program can be spawned in e.g. the
      /etc/hosts.allow file:
     </para>
     <para>
      sshd: ALL : spawn echo "Login from %c to %s" | mail -s "Login Info for
      %s" log@loghost
     </para>
     <para>
      For information on the % expansions, see "man hosts_access". The TCP
      wrapper is quite flexible. And xinetd provides its own set of
      host-based and time-based access control functions. You can even tell
      xinetd to limit the rate of incoming connections. Various
      documentations about the Xinetd super daemon on the Internet and
      should be considered recommended reading. Just remember the trade-offs
      between a TCP wrapper and the SUSE-firewall (netfilter/iptables).
     </para>
     <para>
      Securing SSH
     </para>
     <para>
      Many network services like telnet, rlogin, and rsh are vulnerable to
      eavesdropping which is one of several reasons why SSH should be used
      instead. The &productname; default configuration for SSH meets the
      security requirements for many environments. However, there are a few
      parameters in /etc/ssh/sshd_config that you may want to change. The
      section on Restricting System Access from Servers and Networks shows
      how direct logins can be disabled for shared and system accounts
      including root. But it's prudent to disable direct root logins at the
      SSH level as well.
     </para>
     <para>
      PermitRootLogin no
     </para>
     <para>
      Also ensure to have privilege separation enabled where the daemon is
      split into two parts. With privilege separation a small part of the
      code runs as root and the rest of the code runs in a chroot jail
      environment.
     </para>
     <para>
      UsePrivilegeSeparation yes
     </para>
     <para>
      Since SSH protocol version 1 is not as secure you may want to limit
      the protocol to version 2 only:
     </para>
     <para>
      Protocol 2
     </para>
     <para>
      You may also want to prevent SSH from setting up TCP port and X11
      forwarding if you don't need it:
     </para>
     <para>
      AllowTcpForwarding no
     </para>
     <para>
      X11Forwarding no
     </para>
     <para>
      Ensure the StrictModes directive is enabled which checks file
      permissions and ownerships of some important files in the user's home
      directory like ~/.ssh, ~/.ssh/authorized_keys etc. If any checks fail,
      the user won't be able to login.
     </para>
     <para>
      StrictModes yes
     </para>
     <para>
      Ensure that all host-based authentications are disabled. These methods
      should be avoided as primary authentication.
     </para>
     <para>
      IgnoreRhosts yes
     </para>
     <para>
      HostbasedAuthentication no
     </para>
     <para>
      RhostsRSAAuthentication no
     </para>
     <para>
      Disable sftp if it's not needed (by commenting it out with the #:
     </para>
     <para>
      #Subsystem sftp /usr/lib/misc/sftp-server
     </para>
     <para>
      After changing any directives make sure to restart the sshd daemon:
     </para>
     <para>
      /etc/init.d/sshd restart
     </para>
     <para>
      Securing Postfix
     </para>
     <para>
      Postfix is a replacement for Sendmail and has several security
      advantages over Sendmail. Postfix is the default mail system in
      &productname; and consists of several small programs that each
      performs their own small task – most of these programs run in a
      chroot jail. This is another reason why Postfix is recommended over
      Sendmail. Linux servers that are not dedicated mail or relay servers
      should not accept external emails. However, it is important for
      production servers to send local emails to a relay server – some
      security setups (e.g. the seccheck scripts) can be configured to send
      emails to someone other than root, even off the local system. Verify
      the following parameters in /etc/postfix/main.cf are set to ensure
      that Postfix accepts only local emails for delivery (look towards the
      bottom of the file as the top portion is mostly commented-out example
      entries and explanations):
     </para>
     <para>
        mydestination = $myhostname, localhost.$mydomain, localhost
     </para>
     <para>
        inet_interfaces = localhost
     </para>
     <para>
      The mydestination parameter lists all domains to receive emails
      for.The inet_interfaces parameter specifies the network to listen on.
      After reconfiguring Postfix, a restart of the mail system is
      necessary:
     </para>
     <para>
      rcpostfix restart
     </para>
     <para>
      Verify that Postfix is still listening for network requests (incoming)
      by running one of these commands from another host:
     </para>
     <para>
      nmap -sT -p 25 &lt;remote_host&gt;
     </para>
     <para>
      telnet &lt;remote_host&gt; 25
     </para>
     <para>
      Note: running these commands on the local host will provide inaccurate
      results since Postfix is supposed to accept connections from the local
      node – use an external host for correct results. Filesystems:
      Securing NFS
     </para>
     <para>
      GeneralNFS (Network File System) allows servers to share files over a
      network. But like all network services using NFS involves risks.
     </para>
     <para>
      Here are some basic rules:  - NFS should not be enabled if not
      needed.  - If NFS is truly needed, use a TCP wrapper to restrict
      remote access.  - Ensure to export only to those hosts that really
      need access.  - Use a fully qualified domain name to diminish any
      spoofing attempts.  - Export only the directories needed.  - Export
      only as read-only whenever possible.  - Use NFS only over TCP.
     </para>
     <para>
      If you don't have shared directories to export, then ensure that the
      NFS service is NOT enabled nor running on the system:
     </para>
     <para>
      Check the nfs service status:
     </para>
     <para>
        /etc/init.d/nfsserver status
     </para>
     <para>
      Checking for kernel based NFS server: idmapd runningmountd unused
      statd unused nfsd unused
     </para>
     <para>
      Check the current runlevels:
     </para>
     <para>
      chkconfig -l nfsserver
     </para>
     <para>
      nfsserver 0:off 1:off 2:off 3:off 4:off 5:off 6:off
     </para>
     <para>
      Enabling and Starting NFS ServerIf NFS must be used, it can be
      activated using the following commands on &productname; or more simply
      and securely with the &yast; plugin (ncurses). Access it directly from
      command line with yast nfs-server or yast nfs-client – or manually:
     </para>
     <para>
      chkconfig nfs on
     </para>
     <para>
      rcnfs start
     </para>
     <para>
      Portmapper information:
     </para>
     <para>
      rpcinfo -p &lt;server&gt;
     </para>
     <informaltable frame="all">
      <tgroup cols="5">
       <tbody>
        <row>
         <entry>
          <para>
           Program
          </para>
         </entry>
         <entry>
          <para>
           Version
          </para>
         </entry>
         <entry>
          <para>
           Proto
          </para>
         </entry>
         <entry>
          <para>
           Port
          </para>
         </entry>
         <entry>
          <para>
           Service
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100000
          </para>
         </entry>
         <entry>
          <para>
           2
          </para>
         </entry>
         <entry>
          <para>
           tcp
          </para>
         </entry>
         <entry>
          <para>
           111
          </para>
         </entry>
         <entry>
          <para>
           portmapper
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100000
          </para>
         </entry>
         <entry>
          <para>
           2
          </para>
         </entry>
         <entry>
          <para>
           udp
          </para>
         </entry>
         <entry>
          <para>
           111
          </para>
         </entry>
         <entry>
          <para>
           portmapper
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100003
          </para>
         </entry>
         <entry>
          <para>
           2
          </para>
         </entry>
         <entry>
          <para>
           udp
          </para>
         </entry>
         <entry>
          <para>
           2049
          </para>
         </entry>
         <entry>
          <para>
           nfs
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100003
          </para>
         </entry>
         <entry>
          <para>
           3
          </para>
         </entry>
         <entry>
          <para>
           udp
          </para>
         </entry>
         <entry>
          <para>
           2049
          </para>
         </entry>
         <entry>
          <para>
           nfs
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100003
          </para>
         </entry>
         <entry>
          <para>
           2
          </para>
         </entry>
         <entry>
          <para>
           tcp
          </para>
         </entry>
         <entry>
          <para>
           2049
          </para>
         </entry>
         <entry>
          <para>
           nfs
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100003
          </para>
         </entry>
         <entry>
          <para>
           3
          </para>
         </entry>
         <entry>
          <para>
           tcp
          </para>
         </entry>
         <entry>
          <para>
           2049
          </para>
         </entry>
         <entry>
          <para>
           nfs
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100005
          </para>
         </entry>
         <entry>
          <para>
           1
          </para>
         </entry>
         <entry>
          <para>
           udp
          </para>
         </entry>
         <entry>
          <para>
           623
          </para>
         </entry>
         <entry>
          <para>
           mountd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100005
          </para>
         </entry>
         <entry>
          <para>
           1
          </para>
         </entry>
         <entry>
          <para>
           tcp
          </para>
         </entry>
         <entry>
          <para>
           626
          </para>
         </entry>
         <entry>
          <para>
           mountd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100005
          </para>
         </entry>
         <entry>
          <para>
           2
          </para>
         </entry>
         <entry>
          <para>
           udp
          </para>
         </entry>
         <entry>
          <para>
           623
          </para>
         </entry>
         <entry>
          <para>
           mountd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100005
          </para>
         </entry>
         <entry>
          <para>
           2
          </para>
         </entry>
         <entry>
          <para>
           tcp
          </para>
         </entry>
         <entry>
          <para>
           626
          </para>
         </entry>
         <entry>
          <para>
           mountd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100005
          </para>
         </entry>
         <entry>
          <para>
           3
          </para>
         </entry>
         <entry>
          <para>
           udp
          </para>
         </entry>
         <entry>
          <para>
           623
          </para>
         </entry>
         <entry>
          <para>
           mountd
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           100005
          </para>
         </entry>
         <entry>
          <para>
           3
          </para>
         </entry>
         <entry>
          <para>
           tcp
          </para>
         </entry>
         <entry>
          <para>
           626
          </para>
         </entry>
         <entry>
          <para>
           moontd
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </sect4>
   </sect3>
   <sect3>
    <title/>
    <sect4>
     <title>Table 8: Portmapper List</title>
     <para>
      If you run it from an "untrusted" server or network, you should get
      the following output:
     </para>
     <para>
      rpcinfo -p &lt;server&gt;
     </para>
     <para>
      No remote programs registered.
     </para>
     <para>
      <anchor id="ExportingNFSFileSystems"/>
      Exporting NFS File SystemsTo allow a client access to a filesystem or
      directory, the /etc/exports serves as the access control list. To give
      the network "network.xyz.com" read-only access to /pub, the entries in
      /etc/exports would look like as follows:
     </para>
     <para>
      /pub *.network.xyz.com(ro,sync)
     </para>
     <para>
      It is very important NOT to give write access to NFS clients if not
      absolutely needed! Entries in /etc/exports are exported read-only
      ("ro" option) by default. To allow servers sles-ha1, sles-ha2 and
      sles-ha3 read-write access to the /data/MYSQL directory, the entries
      in /etc/exports would look like as follows:
     </para>
     <para>
      /data/MYSQL sles-ha1.xyz.com(rw,sync) sles-ha2.xyz.com(rw,sync)
      sles-ha3.xyz.com(rw,sync)
     </para>
     <para>
      Note that the options <emphasis>must not</emphasis> be separated from
      the host names or networks with whitespace(s).Also, fully qualified
      domain names should ALWAYS be used to diminish spoofing attempts. All
      entries in /etc/exports are exported with the root_squash option
      ('root squashing') by default. This means that a root user on a client
      machine does not have root privileges (root access) to root-owned
      files on exported NFS filesystems/directories. It is not recommended
      to turn 'root squashing" off using the no_root_squash option! After
      you've made all your entries in /etc/exports, you can export all
      filesystems/directories using the following command:
     </para>
     <para>
      exportfs -a
     </para>
     <para>
      To unexport all shared filesystems/directories, run:
     </para>
     <para>
      exportfs -ua
     </para>
     <para>
      To see all shared filesystems/directories, run:
     </para>
     <para>
      showmount -e localhost
     </para>
     <para>
      Export list for localhost:
     </para>
     <para>
      /pub *.network.xyz.com/data/MYSQL 
      sles-ha1.xyz.com,sles-ha2.xyz.com,sles-ha3.xyz.com
     </para>
     <para>
      Using NFS over TCPIf you need NFS, it is recommended to use NFS only
      over TCP since NFS over UDP is not secure. All 2.4 and later kernels
      support NFS over TCP on the client side. Server support for TCP
      appears in later 2.4 kernels and beyond.In order to mount a shared
      directory using NFS over TCP, it is necessary to use the "proto=tcp"
      mount option:
     </para>
     <para>
      mount -o proto=tcp &lt;nfs_server_name&gt;:/pub /usr/local/pub
     </para>
     <para>
      Verify that the target directory, in this case /usr/local/pub, exists
      on the client:
     </para>
     <para>
      mount…nfsserver:/pub on /usr/local/pub type nfs
      (rw,proto=tcp,addr=172.16.10.8)
     </para>
     <para>
      To have the shared directory mounted on the client at boot time, use
      the /etc/fstab file.For the above example, the /etc/fstab entry could
      look like this:
     </para>
     <para>
      nfsserver:/pub /usr/local/pub nfs
      rsize=8192,wsize=8192,timeo=14,intr,tcp 0 0
     </para>
     <para>
      <anchor id="CopyingFilesUsingSshWithoutProvidingLoginPrompts"/>
      Copying Files Using SSH Without Providing Login Prompts
     </para>
     <para>
      This example is needed in some cases in order to enable files to be
      copied over the network using ssh without providing an interactive
      login prompt. This allows trusted hosts to be set up – an example of
      federation.SSH can allow a forced command using the "command" option.
      Using this option it is possible to disable scp (secure copy) and
      enforce every passed ssh command to be ignored. On the server side
      where you want to retrieve the file from, add the following entry to
      the beginning of the SSH key in the ~/.ssh/authorized_keys2 file (the
      ~ represents a particular users 'home' directory – root's home
      directory is /root – other users typically reside in /home/{name of
      user}):
     </para>
     <para>
      command="/bin/cat ~/&lt;file_name&gt;" ssh-dss
      XXXYYYzzZ1122AAbbCC...{etc}
     </para>
     <para>
      To copy now the file from the remote server, run the following
      command:
     </para>
     <para>
      ssh &lt;user&gt;@&lt;server&gt; &gt; &lt;local_file&gt;
     </para>
     <para>
      Since /bin/cat is run on the server side, its output has to be
      redirected to the local file. Another approach is to replace the
      /bin/cat (referenced above) with your own script that checks the
      passed SSH commands by reading the environment variable
      $SSH_ORIGINAL_COMMAND. For example:
     </para>
     <para>
        #!/bin/ksh if [[ $SSH_ORIGINAL_COMMAND = "File1" ||
      $SSH_ORIGINAL_COMMAND = "File2" ]] then /bin/cat $SSH_ORIGINAL_COMMAND
      else echo "Invalid file name!" exit 1 fi
     </para>
     <para>
      So you replace the “/bin/cat” portion with the script name in
      ~/.ssh/authorized_keys2, and run the following command to copy "Foo1":
     </para>
     <para>
      ssh &lt;user&gt;@&lt;server&gt; Foo1 &gt; &lt;local_file&gt;
     </para>
     <para>
      To copy "Foo 2", run:
     </para>
     <para>
      ssh &lt;user&gt;@&lt;server&gt; Foo2 &gt; &lt;local_file&gt;
     </para>
     <para>
      With the modifications above, every other variety of passed parameters
      will return errors.
     </para>
     <para>
      Checking File Permissions and Ownership
     </para>
     <para>
      The following sections deal with some of the ways in which the default
      permissions and file settings can be modified to enhance the security
      of a host. It is important to note that the use of the default
      &productname; utilities like <quote>seccheck</quote> - can be run to
      lock down and improve the general file security and user environment.
      However, it is beneficial to understand how to modify these things.
     </para>
     <para>
      Note: the following examples will show the '$' symbol to denote a
      'normal' user (without root privileges) and also the “#” will
      denote commands run as the 'root' user.
     </para>
     <para>
      SUSE by default does not show the '$' symbol as a prompt for normal
      users unless modified to do so but is used here to differentiate.
     </para>
     <para>
      &productname; hosts include 3 defaults settings for file permissions:
      permissions.easy, permissions.secure, and permissions.paranoid, all
      located in the /etc directory. The purpose of these files is to define
      special permissions, such as world-writable directories or, for files,
      the setuser ID bit (programs with the setuser ID bit set do not run
      with the permissions of the user that has launched it, but with the
      permissions of the file owner, in most cases root).
     </para>
     <para>
      Administrators can use the file /etc/permissions.local to add their
      own settings. The easiest way to implement one of the default
      permission rule-sets above is to use the <quote>Local Security</quote>
      module in &yast;.
     </para>
     <para>
      Each of the following topics will be modified by a selected rule-set,
      but the information is important to understand on its own.
     </para>
     <para>
      <anchor id="DefaultUmask"/>
      Default umaskThe umask (user file-creation mode mask) command is a
      shell built-in command which determines the default file permissions
      for newly created files. This can be overwritten by system calls but
      many programs and utilities make use of umask.By default, SUSE sets
      umask to 022. You can modify this by changing the value in
      /etc/profile.
     </para>
     <para>
      The id command will print out the current user identity information.
      Example from a non-root prompt:
     </para>
     <para>
      $ id
     </para>
     <para>
      uid=1000(ne0) gid=100(users) groups=16(dialout),33(video),100(users)
     </para>
     <para>
      And to determine the active umask – use the umask command:
     </para>
     <para>
      $ umask
     </para>
     <para>
      0022
     </para>
     <para>
      Now for comparison sake – the same commands from the root user:
     </para>
     <para>
      # id
     </para>
     <para>
      uid=0(root) gid=0(root) groups=0(root)
     </para>
     <para>
      # umask
     </para>
     <para>
      0022
     </para>
     <para>
      <anchor id="SUIDSGIDFiles"/>
      SUID/SGID FilesWhen the SUID (set user ID) or SGID (set group ID) bits
      are set on an executable, it executes with the UID or GID of the owner
      of the executable rather than that of the person executing it. This
      means that, for example, all executables that have the SUID bit set
      and are owned by root are executed with the UID of root. A good
      example is the passwd command that allows ordinary users to update the
      password field in the /etc/shadow file which is owned by root. But
      SUID/SGID bits can be misused when the SUID/SGID executable has a
      security hole. Therefore, you might want to search the entire system
      for SUID/SGID executables and document it. For example, ensure that
      code developers don't set SUID/SGID bits on their programs if it's not
      an absolute requirement. Very often you can use workarounds like
      removing just the executable bit for world/others. However, a better
      approach is to change the design of the software if possible. To
      search the entire system for SUID or SGID files, you can run the
      following command:
     </para>
     <para>
      find / -path /proc -prune -o -type f -perm +6000 -ls
     </para>
     <para>
      The -prune option in this example is used to skip the /proc
      filesystem.
      <anchor id="WorldWritableFiles"/>
      World-Writable FilesWorld-writable files are a security risk since it
      allows anyone to modify them. Additionally, world-writable directories
      allow anyone to add or delete files.To locate world-writable files and
      directories, you can use the following command:
     </para>
     <para>
      find / -path /proc -prune -o -perm -2 ! -type l -ls
     </para>
     <para>
      The "! -type l" parameter skips all symbolic links since symbolic
      links are always world-writable. However, this is not a problem as
      long as the target of the link is not world-writable, which is checked
      by the above find command. World-Writable directories with sticky bit
      such as the /tmp directory do not allow anyone except the owner of a
      file to delete or modify it in this directory. The sticky bit makes
      files stick to the user who created it and it prevents other users
      from deleting and renaming the files. Therefore, depending on the
      purpose of the directory world-writable directories with sticky are
      usually not an issue. An example is the /tmp directory:
     </para>
     <para>
      $ ls -ld /tmp
     </para>
     <para>
      drwxrwxrwt 18 root root 16384 Dec 23 22:20 /tmp
     </para>
     <para>
      The "t" mode, which denotes the sticky bit, allows files to be deleted
      and renamed only if the user is the owner of this file or the owner of
      the directory.
      <anchor id="UnownedFiles"/>
      Orphaned or Unowned FilesFiles not owned by any user or group might
      not necessarily be a security problem in itself. However, unowned
      files could pose a security problem in the future. For example, if a
      new user is created and the new users happens to get the same UID as
      the unowned files have, then this new user will automatically become
      the owner of these files.
     </para>
     <para>
      To locate files not owned by any user or group, use the following
      command:
     </para>
     <para>
      find / -path /proc -prune -o -nouser -o -nogroup
     </para>
     <para>
      Various Account Checks
     </para>
     <para>
      Unlocked Accounts
     </para>
     <para>
      It is important that all system and vendor accounts that are not used
      for logins are locked.To get a list of unlocked accounts on your
      system, you can check for accounts that do NOT have an encrypted
      password string starting with "!" or "*" in the /etc/shadow file. If
      you lock an account using passwd -l, it will put a '!!' in front of
      the encrypted password, effectively disabling the password. If you
      lock an account using usermod -L, it will put a '!' in front of the
      encrypted password. Many system and shared accounts are usually locked
      by default by having a '*' or '!!' in the password field which renders
      the encrypted password into an invalid string. Hence, to get a list of
      all unlocked (encryptable) accounts, run (egrep is used to allow use
      of regular-expressions):
     </para>
     <para>
      egrep -v '.*:\*|:\!' /etc/shadow | awk -F: '{print $1}'
     </para>
     <para>
      Also make sure all accounts have a 'x' in the password field in
      /etc/passwd. The following command lists all accounts that do not have
      a 'x' in the password field:
     </para>
     <para>
      grep -v ':x:' /etc/passwd
     </para>
     <para>
      A 'x' in the password fields means that the password has been
      shadowed, i.e. the encrypted password has to be looked up in the
      /etc/shadow file. If the password field in /etc/passwd is empty, then
      the system will not lookup the shadow file and it will not prompt the
      user for a password at the login prompt. Unused AccountsAll system or
      vendor accounts that are not being used by users, applications, by the
      system or by daemons should be removed from the system. You can use
      the following command to find out if there are any files owned by a
      specific account:
     </para>
     <para>
      find / -path /proc -prune -o -user &lt;account&gt; -ls
     </para>
     <para>
      The -prune option in this example is used to skip the /proc
      filesystem. If you are sure that an account can be deleted, you can
      remove the account using the following command:
     </para>
     <para>
      userdel -r &lt;account&gt;
     </para>
     <para>
      Without the "-r" option userdel will not delete the user's home
      directory and mail spool (/var/spool/mail/&lt;user&gt;). Note that
      many system accounts have no home directory.
     </para>
     <para>
      <anchor id="SingleUserModePasswordForRoot"/>
      Single User Mode Password for root
     </para>
     <para>
      SUSE includes the following entry in the /etc/inittab file to ensure
      that a root password is required for Single User Mode logons:
     </para>
     <para>
        ~~:S:respawn:/sbin/sulogin
     </para>
     <para>
      Note: This works well and will even restart the sulogin if terminated,
      but it can be easily circumvented!
     </para>
     <para>
      The GRUB prompt can be accept parameters allow the execution of an
      alternate program – like the bash shell (e.g. "init=/bin/bash").
      This will place you at a root shell prompt without a password. This
      further enhances the need to password protect the GRUB boot loader (as
      discussed previously).
     </para>
     <para>
      <anchor id="EnablingPasswordAging"/>
      Enabling Password Aging
     </para>
     <para>
      Password expirations are a general best practice – but might need to
      be excluded for some system and shared accounts (e.g. Oracle, etc).
      Expiring password on those accounts could lead to system outages if
      the application account expires.
     </para>
     <para>
      Typically a corporate policy should be developed that dictates
      rules/procedures regarding password changes for system and shared
      accounts. However, normal user account passwords should expire
      automatically. The following example shows how password expiration can
      be setup for individual user accounts. The following files and
      parameters in the table can be used when a new account is created with
      the useradd command. Settings such as these are stored for each user
      account in the /etc/shadow file. If using the &yast; tool (<quote>User
      and Group Management</quote>) to add users – the settings are
      available on a per-user basis. Here are the various settings – some
      of which can also be system-wide (e.g. modification of /etc/login.defs
      and /etc/default/useradd):
     </para>
     <informaltable frame="all">
      <tgroup cols="3">
       <tbody>
        <row>
         <entry>
          <para>
           /etc/login.defs
          </para>
         </entry>
         <entry>
          <para>
           PASS_MAX_DAYS
          </para>
         </entry>
         <entry>
          <para>
           Maximum number of days a password is valid.
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           /etc/login.defs
          </para>
         </entry>
         <entry>
          <para>
           PASS_MIN_DAYS
          </para>
         </entry>
         <entry>
          <para>
           Minimum number of days before a user can change the password
           since the last change.
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           /etc/login.defs
          </para>
         </entry>
         <entry>
          <para>
           PASS_WARN_AGE
          </para>
         </entry>
         <entry>
          <para>
           Number of days when the password change reminder starts.
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           /etc/default/useradd
          </para>
         </entry>
         <entry>
          <para>
           INACTIVE
          </para>
         </entry>
         <entry>
          <para>
           Number of days after password expiration that account is
           disabled.
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           /etc/default/useradd
          </para>
         </entry>
         <entry>
          <para>
           EXPIRE
          </para>
         </entry>
         <entry>
          <para>
           Account expiration date in the format YYYY-MM-DD.
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
     <para>
        Note that users created prior to these modifications will not be
      affected.
     </para>
     <para>
      Ensure that the above parameters are changed in the /etc/login.defs
      and /etc/default/useradd files. Review of the /etc/shadow file will
      show how these settings get stored after adding a user.
     </para>
     <para>
      To create a new user account, execute the following command:
     </para>
     <para>
      useradd -c "Test User" -g users test
     </para>
     <para>
      The -g option specifies the primary group for this account:
     </para>
     <para>
      id test
     </para>
     <para>
      uid=509(test) gid=100(users) groups=100(users)
     </para>
     <para>
      The settings in /etc/login.defs and /etc/default/useradd are recorded
      for the test user in the /etc/shadow file as follows:
     </para>
     <para>
      grep test /etc/shadow
     </para>
     <para>
      test:!!:12742:7:60:7:14::
     </para>
     <para>
      Password aging can be modified at any time by use of the chage
      command. To disable password aging for system and shared accounts, you
      can run the following chage command:
     </para>
     <para>
      chage -M 99999 &lt;system_account_name&gt;
     </para>
     <para>
      To get password expiration information:
     </para>
     <para>
      chage -l &lt;system_account_name&gt;
     </para>
     <para>
      For example:
     </para>
     <para>
      chage -l test
     </para>
     <para>
      Minimum: 7Maximum: 60Warning: 7Inactive: 14Last Change: Jan 11,
      2010Password Expires: Mar 12, 2010Password Inactive: Mar 26,
      2010Account Expires: Never
     </para>
     <para>
      <anchor id="EnforcingStrongerPasswords"/>
      Stronger Password Enforcement
     </para>
     <para>
      On an audited system it is important to restrict people from using
      simple passwords that can be cracked too easily. However, if the
      passwords being enforced are too strong, people will write them down.
      Strong passwords that are written down are not much safer than weak
      passwords. Some will argue that strong passwords protect you against
      dictionary attacks and those type of attacks can be defeated by
      locking accounts after a few failed attempts. However, this is not
      always an option. If set up like this, locking system accounts could
      bring down your applications and systems which would be nothing short
      of a denial of service attack – another issue. At any rate, it is
      important to practice effective password management safety. Most
      companies require that passwords have at the very least a number,
      another alpha character, and one upper case letter. Policies vary –
      but maintaining a balance between password strength/complexity and
      management is sometimes difficult. Leveraging an Effective
      pam-stackLinux-PAM (Pluggable Authentication Modules for Linux) is a
      suite of shared libraries that enable the local system administrator
      to choose how applications authenticate users.
     </para>
     <para>
      It is strongly recommended to familiarize oneself with the
      capabilities of PAM – and how this architecture can be leveraged to
      provide the 'best' authentication setup for an environment. This
      configuration can be done once – and implemented across all systems
      (a standard) or can be enhanced for individual hosts (enhanced
      security – by host / service / application). The key is to realize
      how flexible the architecture is – and how incredibly flexible it
      is.
     </para>
     <para>
      To learn more about the PAM architecture – you can find PAM
      documentation on a &productname; system in the
      /usr/share/doc/packages/pam directory (in a variety of formats).
     </para>
     <para>
      The following discussions are examples of how to modify the default
      pam stacks – specifically around password policies – e.g. password
      strength, password re-use and account locking. While these are only a
      few of the possibilities, they serve as a good start and demonstrate
      PAM's flexibility.
     </para>
     <para>
      Password Strength
     </para>
     <para>
      &productname; can leverage the pam_cracklib library to test for weak
      passwords – and to suggest using a stronger one if it determines
      obvious weakness. The following parameters represent an example or
      policy that could be part of a corporate password policy or something
      required due to audit constraints.
     </para>
     <para>
      The pam libraries follow a defined 'flow' – and in most cases, the
      best way to design the perfect stack is to consider all of the
      requirements and policies – and draw out a flow chart.Sample
      rules/constraints for password enforcement:
     </para>
     <para>
      - Minimum length of password must be 8- Minimum number of lower case
      letters must be 1- Minimum number of upper case letters must be 1-
      Minimum number of digits must be 1- Minimum number of other characters
      must be 1
     </para>
     <informaltable frame="all">
      <tgroup cols="3">
       <tbody>
        <row>
         <entry>
          <para>
           pam_cracklib.so
          </para>
         </entry>
         <entry>
          <para>
           minlen=8
          </para>
         </entry>
         <entry>
          <para>
           Minimum length of password is 8
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           pam_cracklib.so
          </para>
         </entry>
         <entry>
          <para>
           lcredit=-1
          </para>
         </entry>
         <entry>
          <para>
           Minimum number of lower case letters is 1
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           pam_cracklib.so
          </para>
         </entry>
         <entry>
          <para>
           ucredit=-1
          </para>
         </entry>
         <entry>
          <para>
           Minimum number of upper case letters is 1
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           pam_cracklib.so
          </para>
         </entry>
         <entry>
          <para>
           dcredit=-1
          </para>
         </entry>
         <entry>
          <para>
           Minimum number of digits is 1
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           pam_cracklib.so
          </para>
         </entry>
         <entry>
          <para>
           ocredit=-1
          </para>
         </entry>
         <entry>
          <para>
           Minimum number of other characters is 1
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
     <para>
      To setup these password restrictions, use the pam-config tool and
      specify the parameters you want to configure. For example, the minimum
      length parameter could be modified like this:
     </para>
     <para>
      pam-config --cracklib-minlen=8
     </para>
     <para>
      The other parameters are : --cracklib-lcredit=-1 ,
      --cracklib-ucredit=-1 , --cracklib-dcredit=-1 , etc.
     </para>
     <para>
      Now verify that the new password restrictions work for new passwords.
      Simply login to a non-root account and change the password using the
      passwd command. Note that the above requirements are not enforced if
      you run the passwd command under root.
     </para>
     <para>
      <anchor id="RestrictingUseOfPreviousPasswords"/>
      Restricting Use of Previous Passwords
     </para>
     <para>
      The pam_unix2 module parameter remember can be used to configure the
      number of previous passwords that cannot be reused. And the
      pam_cracklib module parameter difok can be used to specify the number
      of characters that must be different between the old and the new
      password. The following example describes how to implement password
      restrictions on a system so that a password cannot be reused for at
      least 6 months and that at least 3 characters must be different
      between the old and new password. Recall that in the section
      <quote>Enabling Password Aging</quote> (above) we set PASS_MIN_DAYS to
      7, which specifies the minimum number of days allowed between password
      changes. Therefore, if pam_unix2 is configured to remember 26
      passwords, then the previously used passwords cannot be reused for at
      least 6 months (26*7 days). Here is an example of an enhanced pam
      stack. It is possible to edit the /etc/pam.d/common-auth file to
      add/change modules used and how they react. Consider the following
      pam_cracklib and pam_unix2 arguments – keeping in mind how the pam
      rules are processed:
     </para>
     <para>
      auth required pam_env.soauth sufficient pam_unix2.so likeauth
      nullokauth required pam_deny.soaccount required pam_unix2.soaccount
      sufficient pam_succeed_if.so uid &lt; 100 quietaccount required
      pam_permit.sopassword requisite pam_cracklib.so retry=3 minlen=8
      lcredit=-1 ucredit=-1 dcredit=-1 ocredit=-1 difok=3password sufficient
      pam_unix2.so nullok use_authtok md5 shadow remember=26password
      required pam_deny.sosession required pam_limits.sosession required
      pam_unix2.so
     </para>
     <para>
      NOTE: If the /etc/security/opasswd doesn't exist, create the file.
     </para>
     <para>
        ls -l /etc/security/opasswd
     </para>
     <para>
        -rw------- 1 root root 0 Dec 8 06:54 /etc/security/opasswd
     </para>
     <para>
      <anchor id="LockingUserAccountsAfterTooManyLoginFailures"/>
      Locking User Accounts After Too Many Login Failures
     </para>
     <para>
      It is not generally recommend that a host automatically locks system
      and shared accounts after too many failed login or su attempts. This
      could lead to outages if the application's account gets locked due to
      too many login failures like in this example for an oracle shared
      account:
     </para>
     <para>
      su oracle -c id
     </para>
     <para>
      su: incorrect password
     </para>
     <para>
      This could be an easy target for a denial of service attack. In the
      following example I will show how to lock only individual user
      accounts after too many failed su or login attempts. Add the following
      two lines (bolded) to the /etc/pam.d/common-auth file as shown below:
     </para>
     <para>
      auth required pam_env.soauth required pam_tally.so onerr=fail
      no_magic_rootauth sufficient pam_unix2.so likeauth nullokauth required
      pam_deny.soaccount required pam_unix2.soaccount required pam_tally.so
      per_user deny=5 no_magic_root resetaccount sufficient
      pam_succeed_if.so uid &lt; 100 quietaccount required
      pam_permit.sopassword requisite pam_cracklib.so retry=3password
      sufficient pam_unix2.so nullok use_authtok md5 shadowpassword required
      pam_deny.sosession required pam_limits.sosession required pam_unix2.so
     </para>
     <para>
      The first added line counts failed login and failed su attempts for
      each user. The default location for attempted accesses is recorded in
      /var/log/faillog. The second added line specifies to lock accounts
      automatically after 5 failed login or su attempts (deny=5). The
      counter will be reset to 0 (reset) on successful entry if deny=n was
      not exceeded. But you don't want system or shared accounts to be
      locked after too many login failures (denial of service attack).
     </para>
     <para>
      It is also possible to add the lock_time=n parameter, and then
      optionally the unlock_time=n parameter. For example, setting the
      lock_time=60 would deny access for 60 seconds after a failed attempt.
      The unlock_time=n option would then allow access after n seconds after
      an account has been locked. If this option is used the user will be
      locked out for the specified amount of time after he exceeded his
      maximum allowed attempts. Otherwise the account is locked until the
      lock is removed by a manual intervention of the system administrator.
      See the pam_tally man page for more information.
     </para>
     <para>
      To exempt system and shared accounts from the deny=n parameter, the
      per_user parameter was added to the module. The per_user parameter
      instructs the module NOT to use the deny=n limit for accounts where
      the maximum number of login failures is set explicitly. For example:
     </para>
     <para>
      faillog -u oracle -m -1faillog -u oracle
     </para>
     <para>
        Username Failures Maximum Latest oracle 0 -1 Fri Dec 10 23:57:55
      -0600 2005 on unknown
     </para>
     <para>
      The faillog command with the option "-m -1" has the effect of not
      placing a limit on the number of failed logins – effectively
      disabling the option. To instruct the module to activate the deny=n
      limit for this account again, run:
     </para>
     <para>
      faillog -u oracle -m 0
     </para>
     <para>
      By default, the maximum number of login failures for each account is
      set to zero (0) which instructs pam_tally to leverage the deny=n
      parameter. To see failed login attempts, run:
     </para>
     <para>
      faillog
     </para>
     <para>
      To unlock a locked account (after too many login failures), utilize
      the -r option:
     </para>
     <para>
      faillog -u &lt;user&gt; -r
     </para>
     <para>
      Make sure to test these changes (and ANY changes – for that matter)
      thoroughly on your system using ssh and su, and make sure the root id
      does not get locked! To lock/unlock accounts manually, you can run one
      of the following commands:
     </para>
     <para>
        Locking:
     </para>
     <para>
      passwd -l &lt;user&gt;usermod -L &lt;user&gt;
     </para>
     <para>
        Unlocking:
     </para>
     <para>
      passwd -u &lt;user&gt;usermod -U &lt;user&gt;
     </para>
     <para>
      <anchor id="PreventingAccidentalDenialOfService"/>
      Preventing Accidental Denial of Service
     </para>
     <para>
      <anchor id="PreventingAccidentalDenialOfServiceGeneral"/>
      GeneralLinux allows you to set limits on the amount of system
      resources that users and groups can consume. This is also very handy
      if bugs in programs cause them to use up too much resources (e.g.
      memory leaks), slow down the machine, or even render the system
      unusable. Incorrect settings can allow programs to use too many
      resources which may make the server unresponsive to new connections or
      even local logins (e.g. If a program uses up all available file
      handles on the host). This can also be a security concern if someone
      is allowed to consume all system resources and therefore cause a
      denial of service attack – either unplanned or worse, planned.
      Setting resource limits for users and groups may be an effective way
      to protect systems, depending on the environment.
      <anchor
      id="ExampleForRestrictingSystemResources"/>
      Example for Restricting System ResourcesThe following example
      demonstrates the practical usage of setting or restricting system
      resource consumption for an Oracle user account. For a list of system
      resource settings, see /etc/security/limits.conf or man limits.conf.
     </para>
     <para>
      Most shells like Bash provide control over various resources (e.g. the
      maximum allowable number of open file descriptors or the maximum
      number of processes) that are available on a per/user basis. To
      examine all current limits in the shell – execute:
     </para>
     <para>
      ulimit -a
     </para>
     <para>
      For more information on ulimit for the Bash shell, examine the bash
      man pages. Important Note: Setting "hard" and "soft" limits might not
      behave as expected when using an SSH session. To see valid behavior it
      may be necessary to login as root and then su to the id with limits
      (e.g. oracle in these examples). Resource limits should also work
      assuming the application has been started automatically during the
      boot process. It may be necessary to set UsePrivilegeSeparation in
      /etc/ssh/sshd_config to "no" and restart the SSH daemon (rcsshd
      restart) if it seems that the changes to resource limits are not
      working (via SSH). However this is not generally recommended – as it
      weakens a systems security.
     </para>
     <para>
      Setting Limits
     </para>
     <para>
      In this example, a change to the number of file handles or open files
      that the Oracle user can use is made by editing
      /etc/security/limits.conf as root making the following changes:
     </para>
     <para>
      oracle soft nofile 4096oracle hard nofile 63536
     </para>
     <para>
      The "soft” limit in the first line defines the number of file
      handles (open files) that the <quote>oracle</quote> user will have
      after login. If the user sees error messages about running out of file
      handles, then the user can increase the number of file handles like in
      this example up to the "hard” limit (in this example 63536) by
      executing:
     </para>
     <para>
      ulimit -n 63536
     </para>
     <para>
      You can set the "soft" and "hard" limits higher if necessary. Note: It
      is important to be judicious with the usage of ulimits – allowing a
      "hard" limit for <quote>nofile</quote> for a user that equals the
      kernel limit (/proc/sys/fs/file-max) is very bad! If the user consumes
      all the available file handles – the system will not be able to
      initiate new logins as accessing (opening) PAM modules which are
      required for performing a login will not be possible. You also need to
      ensure that pam_limits is configured in /etc/pam.d/common-auth, or in
      an individual service (like SSH, su, login, telnet, etc.) config:
     </para>
     <para>
      /etc/pam.d/sshd (for SSH)/etc/pam.d/su (for su)/etc/pam.d/login (local
      logins and telnet)
     </para>
     <para>
       If you don't want to enable it for all logins, there is a specific
      PAM module that will read the /etc/security/limits.conf file. Entries
      in pam configuration directives will have entries like:
     </para>
     <para>
      session required /lib/security/pam_limits.so
     </para>
     <para>
      Here are the two "session" entries I have in my /etc/pam.d/system-auth
      file:
     </para>
     <para>
      session required /lib/security/pam_limits.sosession required
      /lib/security/pam_unix.so
     </para>
     <para>
      It is important to note that changes are not immediate and require a
      new login session:
     </para>
     <para>
      su – oracleulimit -n
     </para>
     <para>
      4096
     </para>
     <para>
      Note that these examples are specific to the Bash shell - ulimit
      options are different for other shells. The default limit for the
      oracle account is now 4096 and that the oracle user can increase the
      number of file handles up to 63536 (based on the settings enacted):
     </para>
     <para>
      su - oracle
     </para>
     <para>
      ulimit -n
     </para>
     <para>
      4096
     </para>
     <para>
      ulimit -n 63536
     </para>
     <para>
      ulimit -n
     </para>
     <para>
      63536
     </para>
     <para>
      Making this permanent requires the addition of the setting, "ulimit -n
      63536", (again, for Bash) to the users profile (~/.bashrc or
      ~/.profile file) which is the user startup file for the Bash shell on
      SUSE Linux (to verify your shell run: echo $SHELL). To do this you
      could simply type (or copy/paste – if you are reading this on the
      system) the following commands for the oracle user's Bash shell:
     </para>
     <para>
      su - oracle
     </para>
     <para>
      cat &gt;&gt; ~oracle/.bash_profile &lt;&lt; EOF
     </para>
     <para>
      ulimit -n 63536
     </para>
     <para>
      EOF
     </para>
     <para>
      <anchor id="DisplayingLoginBanners"/>
      Displaying Login Banners
     </para>
     <para>
      In many cases (and after per corporate policy) it is necessary to
      place a banner on login screens on all servers for legal or audit
      policy reasons (and to potentially deter intruders) among other
      things. Consult a customer's security team or their legal department
      for the content requirements of the banner.If you want to print a
      legal banner after a user logs in using ssh, local console etc., you
      can leverage the /etc/motd (motd = message of the day) file. The file
      exists on SUSE – however it is empty. Simply add content to the file
      that is applicable/required by the organization.
     </para>
     <para>
      cat /etc/motd 
     </para>
     <para>
      Note: Try to keep the content to a single page (or less) – as it
      will scroll the screen if it doesn't fit.
     </para>
     <para>
      This system is classified...Use of this system constitutes consent to
      official monitoring......
     </para>
     <para>
      For SSH you can edit the <quote>Banner</quote> parameter in the
      /etc/ssh/sshd_config file which will then appropriately display the
      banner text before the login prompt. For local console logins you can
      edit the /etc/issue file which will display the banner before the
      login prompt.For GDM you could make the following changes to require a
      user to acknowledge the legal banner by selecting 'Yes' or 'No'. Edit
      the /etc/gdm/PreSession/Default file and add the following lines at
      the beginning of the script:
     </para>
     <para>
      if ! gdialog --yesno '\nThis system is classified...\n' 10 10; then
     </para>
     <para>
        sleep 10
     </para>
     <para>
        exit 1;
     </para>
     <para>
      fi
     </para>
     <para>
      Obviously the <quote>This system is classified...</quote> test should
      be replaced with the valid text – and it is important to note that
      this dialog will not prevent a login to progress. The existence of a
      <quote>Cancel</quote> button is merely incidental.
     </para>
     <para>
      <anchor id="Miscellaneous"/>
      Miscellaneous
     </para>
     <para>
      <anchor id="HostBasedLinuxMonitoringAndIntrusionDetection"/>
      Host-Based Linux Monitoring and Intrusion DetectionBefore you place a
      host into production or even on a network, consider the use of an
      system integrity checker – like seccheck (already discussed) – so
      in the event of unauthorized changes, notifications can happen. Also
      consider the use of an intrusion detection environment, like AIDE –
      the Advanced Intrusion Detection Environment.
     </para>
     <para>
      AIDE is a GPL licensed and open source intrusion detection system. It
      could be considered a system <quote>fingerprinting</quote> mechanism.
      AIDE works by creating a database containing information about the
      files on your system. The database is created from rules laid out in
      the configuration file aide.conf. When AIDE is run, this database is
      referenced to check for changes (or created for the first time).
      Assuming a comparison check is being run, any changes not permitted by
      the configuration file are reported.
     </para>
     <para>
      By leveraging AIDE – storing a copy of the host's database in a
      secure location – and comparing it (on a scheduled basis – or as
      part of a forensic effort), system integrity/insurance can be a matter
      of heuristics and procedure. If an intruder compromises your system
      you the comparison effort will enable an administrator or security
      officer to know what has changed on the host. The initial database
      should be created as a final step – BEFORE a system gets deployed
      into production.It is outside the scope of this article to cover Linux
      Monitoring and detailed Intrusion Detection systems (IDS) or solutions
      – however there is a plethora of information of configuring AIDE or
      other solutions and many informative articles on the web. Also include
      with the &productname; distribution is a powerful open source
      network-intrusion prevention and detection system called Snort.
      <anchor
      id="ConnectAccountingUtilities"/>
      Connect Accounting UtilitiesHere is a list of commands you can use to
      get data about user logins:
     </para>
     <para>
      who  Shows a listing of currently logged-in users. w  Shows who is
      logged on and what they are doing. last  Shows a list of last
      logged-in users, including login time, logout time, login IP address,
      etc. lastb  Same as last, except that by default it shows a log of
      the file /var/log/btmp,  which contains all the bad login attempts.
      lastlog  This command reports data maintained in /var/log/lastlog,
      which is a record of  the last time a user logged in. ac  Prints out
      the connect time in hours on a per-user basis or daily basis etc. 
      This command reads /var/log/wtmp. dump-utmp  Converts raw data from
      /var/run/utmp or /var/log/wtmp into ASCII-parsable  format.
     </para>
     <para>
      Also check the /var/log/messages file.
     </para>
     <para>
      <anchor id="Other"/>
      OtherFinally, the following couple items might not be (specifically)
      security related, but misconfiguration can cause many problems – and
      should be reviewed:
     </para>
     <orderedlist>
      <listitem>
       <para>
        Resolver (/etc/hosts, /etc/resolv.conf, /etc/nsswitch.conf).
       </para>
      </listitem>
      <listitem>
       <para>
        NTP configuration (/etc/ntp.conf).
       </para>
       <title/>
      </listitem>
     </orderedlist>
    </sect4>
   </sect3>
  </chapter>
 </part>
 <sect1>
  <title/>
 </sect1>
</book>
