<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl"
  type="text/xml" 
  title="Profiling step"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
                      "novdocx.dtd"
[
<!ENTITY % NOVDOC.DEACTIVATE.IDREF "IGNORE">
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<sect1 id="sec_ha_quick_iscsi_security">
  <title>Security Considerations</title>

  <para>
   Access to iSCSI targets may be restricted in one of several fashions:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     By initiator address. Access to iSCSI targets may be restricted to
     specific initiators, identified by their IP addresses or iSCSI
     Qualified Name (IQN).
    </para>
   </listitem>
   <listitem>
    <para>
     By initiator credentials. iSCSI Targets may be protected with a
     username and password. Initiators are then forced to login with those
     credentials using the Challenge-Response Authentication Protocol
     (CHAP). This protocol does not transmit passwords in the clear, instead
     it uses password hashes in a challenge-reponse exchange.
    </para>
   </listitem>
   <listitem>
    <para>
     Combined approach. The two above approaches may be combined, such that
     targets can be connected to only from specific initiator IP addresses,
     where the initiators have to additionally pass CHAP authentication.
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="_restricting_target_access_by_initiator_address">
   <title>Restricting target access by initiator address</title>
   <para>
    To restrict access to a target to one or more initiator addresses, use
    the <literal>initiators</literal> parameter supported by the iSCSI
    Target Pacemaker resource agent:
   </para>
<screen>crm(live)configure# edit res_target_iscsivg01</screen>
   <para>
    This will bring up a text editor containing the current configuration
    parameters for this resource. Edit the resource to include the
    allowed_initiators parameter, containing a space- separated list of
    initiator IP addresses allowed to connect to this target. In the example
    below, access is granted to initiator IP addresses
    <literal>10.9.9.60</literal> and <literal>10.9.9.170</literal>.
   </para>
   <note>
    <para>
     This approach is valid when using iSCSI Enterprise Target (IET) or SCSI
     Target Framework (tgt) as the underlying iSCSI target implementation.
    </para>
   </note>
<screen>primitive res_target_iscsivg01 \
  ocf:heartbeat:iSCSITarget \
    params iqn="iqn.2001-04.com.example:storage.example.iscsivg01" \
      allowed_initiators="10.9.9.60 10.9.9.170" \
    op monitor interval="10s"</screen>
   <para>
    When you close the editor, the configuration changes are inserted into
    the CIB configuration. To commit these changes, as usual, enter the
    following command:
   </para>
<screen>crm(live)configure# commit</screen>
   <para>
    After you commit the changes, the target will immediately reconfigure
    and enable the access restrictions.
   </para>
   <warning>
    <para>
     If initiators are connected to the target at the time of
     re-configuration, and one of the connected initiators is not included
     in the <literal>initiators</literal> list for this resource, then those
     initiators will lose access to the target, possibly resulting in
     disruption on the initiator node. Use with care.
    </para>
   </warning>
  </sect2>

  <sect2 id="_restricting_target_access_by_using_chap_credentials">
   <title>Restricting target access by using CHAP credentials</title>
   <para>
    To create a username and password which initiators must use to log in to
    an iSCSI target, use the <literal>username</literal> and
    <literal>password</literal> parameters supported by the iSCSITarget
    Pacemaker resource agent:
   </para>
<screen>crm(live)configure# edit res_target_iscsivg01</screen>
   <para>
    This will bring up a text editor containing the current configuration
    parameters for this resource. Edit the resource to include the
    <literal>username</literal> and <literal>password</literal> parameters,
    containing the username and password to access the target. In the
    example below, access is granted to initiators using a username of
    <literal>iscsi</literal> and password of
    <literal>zi1caighaiTo</literal>.
   </para>
<screen>primitive res_target_iscsivg01 \
  ocf:heartbeat:iSCSITarget \
    params iqn="iqn.2001-04.com.example:storage.example.iscsivg01" \
      incoming_username="iscsi" \
      incoming_password="zi1caighaiTo" \
    op monitor interval="10s"</screen>
   <note>
    <para>
     Some iSCSI initiator implementations require that the CHAP password is
     at least 12 bytes long.
    </para>
   </note>
   <para>
    When you close the editor, the configuration changes are inserted into
    the CIB configuration. To commit these changes, as usual, enter the
    following command:
   </para>
<screen>crm(live)configure# commit</screen>
   <para>
    After you commit the changes, the target will immediately reconfigure
    and enable the access restrictions.
   </para>
   <warning>
    <para>
     If initiators are connected to the target at the time of target
     re-configuration, they will invariably lose target access until
     re-configured with matching credentials themselves. As this is likely
     to cause disruption on the initiator node, you should change usernames
     and/or passwords only on targets with no initiator activity.
    </para>
   </warning>
  </sect2>
 </sect1>
