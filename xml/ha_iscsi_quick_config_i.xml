<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl"
  type="text/xml" 
  title="Profiling step"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
                      "novdocx.dtd"
[
<!ENTITY % NOVDOC.DEACTIVATE.IDREF "IGNORE">
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<sect1 id="sec_ha_quick_iscsi_config">
  <title>Setting configuration parameters</title>

  <para>
   This section outlines some of the configuration parameters one may want
   to set in a highly available iSCSI Target configuration.
  </para>

  <sect2 id="_per_target_configuration_parameters">
   <title>Per-target configuration parameters</title>
   <para>
    You may set configuration parameters at the iSCSI target level by using
    the <literal>additional_parameters</literal> instance attribute defined
    for the iSCSITarget resource agent.
   </para>
   <para>
    To set, for example, the <literal>DefaultTime2Retain</literal> and
    <literal>DefaultTime2Wait</literal> session parameters to 60 and 5
    seconds, respectively, modify your target resource as follows:
   </para>
<screen>crm(live)configure# edit res_target_iscsivg01</screen>
<screen>primitive res_target_iscsivg01 \
  ocf:heartbeat:iSCSITarget \
    params iqn="iqn.2001-04.com.example:storage.example.iscsivg01" \
      additional_parameters="DefaultTime2Retain=60 DefaultTime2Wait=5"
    op monitor interval="10s"</screen>
<screen>crm(live)configure# commit</screen>
  </sect2>

  <sect2 id="_per_lu_configuration_parameters">
   <title>Per-LU configuration parameters</title>
   <para></para>
   <sect3 id="_scsi_id_and_serial_number">
    <title>SCSI ID and serial number</title>
    <para>
     For some applications, smooth uninterrupted failover requires that the
     SCSI ID associated with a Logical Unit is identical regardless of which
     node currently exports the LU. The same applies to the SCSI Serial
     Number. Examples of such applications are the device-mapper multipath
     target (<literal>dm-multipath</literal>) on Linux, and the Microsoft
     iSCSI initiator on Windows.
    </para>
    <para>
     The <literal>iSCSILogicalUnit</literal> resource agent attempts to
     select sensible, consistent values for these fields as appropriate for
     the underlying iSCSI implementation. Still, you may prefer to set the
     SCSI ID and/or serial number explicitly as part of the LU
     configuration.
    </para>
    <para>
     To set a SCSI ID or serial number for an exported LU, edit the
     <literal>iSCSILogicalUnit</literal> resource to include the
     <literal>scsi_id</literal> or <literal>scsi_sn</literal> parameter (or
     both):
    </para>
<screen>crm(live)configure# edit res_lu_lun1</screen>
<screen>primitive res_lu_lun1 \
  ocf:heartbeat:iSCSILogicalUnit \
    params
    target_iqn="iqn.2001-04.com.example:storage.example.iscsivg01"
      lun="1" path="/dev/iscsivg01/lun1" \
      scsi_id="iscsivg01.lun1" scsi_sn="4711" \
    op monitor interval="10s"</screen>
<screen>crm(live)configure# commit</screen>
   </sect3>
   <sect3 id="_vendor_id_and_product_id">
    <title>Vendor ID and Product ID</title>
    <para>
     Two other SCSI Vital Product Data (VPD) fields that you may wish to set
     explicitly are the SCSI Vendor ID and Product ID fields. To do so, add
     the resource parameters <literal>vendor_id</literal> and/or
     <literal>product_id</literal> to your LU configuration:
    </para>
<screen>crm(live)configure# edit res_lu_lun1</screen>
<screen>primitive res_lu_lun1 \
  ocf:heartbeat:iSCSILogicalUnit \
    params target_iqn="iqn.2001-04.com.example:storage.example.iscsivg01" \
      lun="1" path="/dev/iscsivg01/lun1" \
      vendor_id="STGT" scsi_id="iscsivg01.lun1" scsi_sn="4711" \
    op monitor interval="10s"</screen>
<screen>crm(live)configure# commit</screen>
    <note>
     <para>
      Interestingly, STGT uses a default vendor ID of IET. If you are using
      the tgt target implementation, you may want to set the vendor ID to a
      non-default value as shown in the example, to avoid confusion.
     </para>
    </note>
   </sect3>
  </sect2>
 </sect1>
