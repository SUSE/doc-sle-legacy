<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<refentry id="man.crmfailcount">
 <refmeta>
  <refentrytitle>crm_failcount</refentrytitle>
  <manvolnum>8</manvolnum>
 </refmeta>
 <refnamediv>
  <refname>crm_failcount</refname><refpurpose>Manage the counter recording each resource's failures</refpurpose>
 </refnamediv>
 <refsect1>
  <title>Synopsis</title>
<screen><command>crm_failcount</command> <option>[-?|-V]</option> <option>-D</option> <option>-u|-U <replaceable>node</replaceable></option> <option>-r <replaceable>resource</replaceable></option></screen>
<screen><command>crm_failcount</command> <option>[-?|-V]</option> <option>-G</option> <option>-u|-U <replaceable>node</replaceable></option> <option>-r <replaceable>resource</replaceable></option></screen>
<screen><command>crm_failcount</command> <option>[-?|-V]</option> <option>-v <replaceable>string</replaceable></option> <option>-u|-U <replaceable>node</replaceable></option> <option>-r <replaceable>resource</replaceable></option></screen>
 </refsect1>
 <refsect1>
  <title>Description</title>
  <para>
   &hb; implements a sophisticated method to compute and force failover of a
   resource to another node in case that resource tends to fail on the
   current node. A resource carries a <literal>resource-stickiness</literal>
   attribute to determine how much it prefers to run on a certain node. It
   also carries a <literal>migration-threshold</literal> that determines the
   threshold at which the resource should failover to another node.
  </para>
  <para>
   The <literal>failcount</literal> attribute is added to the resource and
   increased on resource monitoring failure. The value of
   <literal>failcount</literal> multiplied by the value of
   <literal>migration-threshold</literal> determines the <emphasis>failover
   score</emphasis> of this resource. If this number exceeds the preference
   set for this resource, the resource is moved to another node and not run
   again on the original node until the failure count is reset.
  </para>
  <para>
   The <command>crm_failcount</command> command queries the number of
   failures per resource on a given node. This tool can also be used to
   reset the failcount, allowing the resource to run again on nodes where it
   had previously failed too many times.
  </para>
 </refsect1>
 <refsect1>
  <title>Options</title>
  <variablelist>
   <varlistentry>
    <term><option>--help</option>, <option>-?</option>
    </term>
    <listitem>
     <para>
      Print a help message.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--verbose</option>, <option>-V</option>
    </term>
    <listitem>
     <para>
      Turn on debug information.
     </para>
     <note>
      <para>
       Increase the level of verbosity by providing additional instances.
      </para>
     </note>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--quiet</option>, <option>-Q</option>
    </term>
    <listitem>
     <para>
      When doing an attribute query using <option>-G</option>, print just
      the value to stdout. Use this option with <option>-G</option>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--get-value</option>, <option>-G</option>
    </term>
    <listitem>
     <para>
      Retrieve rather than set the preference.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--delete-attr</option>, <option>-D</option>
    </term>
    <listitem>
     <para>
      Specify the attribute to delete.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--attr-id <replaceable>string</replaceable></option>,
        <option>-i <replaceable>string</replaceable></option>
    </term>
    <listitem>
     <para>
      For advanced users only. Identifies the id attribute.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--attr-value <replaceable>string</replaceable></option>,
     <option>-v <replaceable>string</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the value to use. This option is ignored when used with
      <option>-G</option>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--node <replaceable>node_uname</replaceable></option>,
     <option>-U <replaceable>node_uname</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the uname of the node to change.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--resource-id <replaceable>resource
       name</replaceable></option>, <option>-r <replaceable>resource name</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the name of the resource on which to operate.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 <refsect1>
  <title>Examples</title>
  <variablelist>
   <varlistentry>
    <term>Reset the failcount for the resource <option>myrsc</option> on the
     node <option>node1</option>:</term>
    <listitem>
<screen><command>crm_failcount</command> <option>-D</option> <option>-U</option> <replaceable>node1</replaceable> <option>-r</option> <replaceable>my_rsc</replaceable></screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Query the current failcount for the resource <option>myrsc</option>
     on the node <option>node1</option>:</term>
    <listitem>
<screen><command>crm_failcount</command> <option>-G</option> <option>-U</option> <replaceable>node1</replaceable> <option>-r</option> <replaceable>my_rsc</replaceable></screen>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 <refsect1>
  <title>Files</title>
  <para>
   <filename>/var/lib/heartbeat/crm/cib.xml</filename>&mdash;the CIB (minus
   status section) on disk. Editing this file directly is strongly
   discouraged.
  </para>
 </refsect1>
 <refsect1>
  <title>See Also</title>
  <para>
   <xref linkend="man.crmattribute"/> and <xref linkend="man.cibadmin"/>
  </para>
 </refsect1>
<!-- 
 <refsect1>
  <title>Author</title>
  <para>
   <option>crm_failcount</option> was written by Andrew Beekhof.
  </para>
 </refsect1>
 -->
</refentry>
