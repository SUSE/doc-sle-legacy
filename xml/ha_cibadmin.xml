<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<refentry id="man.cibadmin">
<!-- slightly modified original by abeekhof -->
 <refmeta>
  <refentrytitle>cibadmin</refentrytitle>
  <manvolnum>8</manvolnum>
 </refmeta>
 <refnamediv>
  <refname>cibadmin</refname><refpurpose>Provides direct access to the cluster configuration</refpurpose>
 </refnamediv>
 <refsect1>
  <title>Synopsis</title>
  <para>
   Allows the configuration, or sections of it, to be queried, modified,
   replaced and/or deleted.
  </para>
<screen><command>cibadmin</command> (--query|-Q) -[Vrwlsmfbp] [-i xml-object-id|-o
  xml-object-type] [-t t-flag-whatever] [-h hostname]</screen>
<screen><command>cibadmin</command> (--create|-C) -[Vrwlsmfbp] [-X xml-string]
  [-x xml- filename] [-t t-flag-whatever] [-h hostname]</screen>
<screen><command>cibadmin</command> (--replace-R)  -[Vrwlsmfbp]  [-i xml-object-id|
  -o xml-object-type]  [-X  xml-string] [-x xml-filename] [-t
  t-flag- whatever] [-h hostname]</screen>
<screen><command>cibadmin</command> (--update|-U) -[Vrwlsmfbp]  [-i xml-object-id|
  -o xml-object-type]  [-X  xml-string] [-x xml-filename] [-t
  t-flag- whatever] [-h hostname]</screen>
<screen><command>cibadmin</command> (--modify|-M) -[Vrwlsmfbp]  [-i xml-object-id|
           -o xml-object-type]  [-X  xml-string] [-x xml-filename] [-t
           t-flag- whatever] [-h hostname]</screen>
<screen><command>cibadmin</command> (--delete|-D) -[Vrwlsmfbp]  [-i xml-object-id|
           -o xml-object-type] [-t t-flag-whatever] [-h hostname]</screen>
<screen><command>cibadmin</command> (--delete_alt|-d) -[Vrwlsmfbp] -o
           xml-object-type [-X xml-string|-x xml-filename]
           [-t t-flag-whatever]  [-h hostname]</screen>
<screen><command>cibadmin</command> --erase (-E)</screen>
<screen><command>cibadmin</command> --bump (-B)</screen>
<screen><command>cibadmin</command> --ismaster (-m)</screen>
<screen><command>cibadmin</command> --master (-w)</screen>
<screen><command>cibadmin</command> --slave (-r)</screen>
<screen><command>cibadmin</command> --sync (-S)</screen>
<screen><command>cibadmin</command> --help (-?)</screen>
 </refsect1>
 <refsect1>
  <title>Description</title>
  <para>
   The <command>cibadmin</command> command is the low-level administrative
   command for manipulating the &hb; CIB. Use it to dump all or part of the
   CIB, update all or part of it, modify all or part of it, delete the
   entire CIB, or perform miscellaneous CIB administrative operations.
  </para>
  <para>
   <command>cibadmin</command> operates on the XML trees of the CIB, largely
   without knowledge of the purpose of the updates or queries performed.
   This means that shortcuts that seem natural to users who understand the
   meaning of the elements in the XML tree are impossible to use with
   <command>cibadmin</command>. It requires a complete lack of ambiguity and
   can only deal with valid XML subtrees (tags and elements) for both input
   and output.
  </para>
  <note>
   <para>
    <command>cibadmin</command> should always be used in preference to
    editing the <filename>cib.xml</filename> file by hand&mdash;especially
    if the cluster is active. The cluster goes to great lengths to detect
    and discourage this practice so that your data is not lost or corrupted.
   </para>
  </note>
 </refsect1>
 <refsect1>
  <title>Options</title>
  <variablelist>
   <varlistentry>
    <term><option>--obj_type <replaceable>object-type</replaceable></option>, 
     <option>-o <replaceable>object-type</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the type of object on which to operate. Valid values are
      <literal>nodes</literal>, <literal>resources</literal>,
      <literal>constraints</literal>, <literal>crm_status</literal>, and
      <literal>status</literal>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--verbose</option>, <option>-V</option>
    </term>
    <listitem>
     <para>
      Turn on debug mode. Additional <option>-V</option> options increase
      the detail and frequency of the output.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--help</option>, <option>-?</option>
    </term>
    <listitem>
     <para>
      Obtain a help message from <command>cibadmin</command>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--xpath <replaceable>PATHSPEC</replaceable></option>, 
    <option>-A <replaceable>PATHSPEC</replaceable></option>
    </term>
    <listitem>
     <para>
      Supply a valid XPath to use instead of an obj_type.
     </para>
    </listitem>
   </varlistentry>
<!-- ********* -->
<!--<varlistentry>
    <term><option>&#x2d;&#x2d;update</option>, <option>-U</option>
    </term>
    <listitem>
     <para>
      Recursively update an object in the CIB. Updating an object replaces
      like members in the XML, but does not delete attributes not mentioned.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>&#x2d;&#x2d;delete_alt</option>, <option>-d</option>
    </term>
    <listitem>
     <para>
      Delete the object at the specified fully qualified location, for
      example, <literal>&lt;resource id="rsc1"&gt;&lt;operations&gt;&lt;op
      id="rsc1_op1"/></literal>. Requires <option>-o</option>
      <emphasis>type</emphasis> option.
     </para>
    </listitem>
   </varlistentry>-->
  </variablelist>
 </refsect1>
 <refsect1>
  <title>Commands</title>
  <variablelist>
   <varlistentry>
    <term><option>--bump</option>, <option>-B</option>
    </term>
    <listitem>
     <para>
      Increase the <option>epoch</option> version counter in the CIB.
      Normally this value is increased automatically by the cluster when a
      new leader is elected. Manually increasing it can be useful if you
      want to make an older configuration obsolete (such as one stored on
      inactive cluster nodes).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--create</option>, <option>-C</option>
    </term>
    <listitem>
     <para>
      Create a new CIB from the XML content of the argument.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--delete</option>, <option>-D</option>
    </term>
    <listitem>
     <para>
      Delete the first object matching the supplied criteria, for example,
      <literal>&lt;op id="rsc1_op1" name="monitor"/></literal>. The tag name
      and all attributes must match in order for the element to be deleted
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--erase</option>, <option>-E</option>
    </term>
    <listitem>
     <para>
      Erase the contents of the entire CIB.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--ismaster</option>, <option>-m</option>
    </term>
    <listitem>
     <para>
      Print a message indicating whether or not the local instance of the
      CIB software is the master instance or not. Exits with return code 0
      if it is the master instance or 35 if not.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--modify</option>, <option>-M</option>
    </term>
    <listitem>
     <para>
      Find the object somewhere in the CIB's XML tree and update it.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--query</option>, <option>-Q</option>
    </term>
    <listitem>
     <para>
      Query a portion of the CIB.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--replace</option>, <option>-R</option>
    </term>
    <listitem>
     <para>
      Recursively replace an XML object in the CIB.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--sync</option>, <option>-S</option>
    </term>
    <listitem>
     <para>
      Force a resync of all nodes with the CIB on the specified host (if
      <option>-h</option> is used) or with the DC (if no <option>-h</option>
      option is used).
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 <refsect1>
  <title>XML Data</title>
  <variablelist>
   <varlistentry>
    <term><option>--xml-text <replaceable>string</replaceable></option>, 
     <option>-X <replaceable>string</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify an XML tag or fragment on which crmadmin should operate. It
      must be a complete tag or XML fragment.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--xml-file <replaceable>filename</replaceable></option>,
     <option>-x <replaceable>filename</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the XML from a file on which cibadmin should operate. It must
      be a complete tag or an XML fragment.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--xml_pipe</option>, <option>-p</option>
    </term>
    <listitem>
     <para>
      Specify that the XML on which <command>cibadmin</command> should
      operate comes from standard input. It must be a complete tag or an XML
      fragment.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 <refsect1>
  <title>Advanced Options</title>
  <variablelist>
   <varlistentry>
    <term><option>--host <replaceable>hostname</replaceable></option>,
     <option>-h <replaceable>hostname</replaceable></option>
    </term>
    <listitem>
     <para>
      Send command to specified host. Applies to <command>query</command>
      and <command>sync</command> commands only.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--local</option>, <option>-l</option>
    </term>
    <listitem>
     <para>
      Let a command take effect locally (rarely used, advanced option).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--no-bcast</option>, <option>-b</option>
    </term>
    <listitem>
     <para>
      Command will not be broadcast even if it altered the CIB.
     </para>
     <important>
      <para>
       Use this option with care to avoid ending up with a divergent
       cluster.
      </para>
     </important>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--sync-call</option>, <option>-s</option>
    </term>
    <listitem>
     <para>
      Wait for call to complete before returning.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 <refsect1>
  <title>Examples</title>
  <para>
   To get a copy of the entire active CIB (including status section, etc.)
   delivered to stdout, issue this command:
  </para>
<screen><command>cibadmin</command> <option>-Q</option></screen>
  <para>
   To add an IPaddr2 resource to the <emphasis>resources</emphasis> section,
   first create a file <filename>foo</filename> with the following contents:
  </para>
<screen>
   &lt;primitive id="R_10.10.10.101" class="ocf" type="IPaddr2"
    provider="heartbeat">
    &lt;instance_attributes id="RA_R_10.10.10.101">
     &lt;attributes>
      &lt;nvpair id="R_ip_P_ip" name="ip" value="10.10.10.101"/>
      &lt;nvpair id="R_ip_P_nic" name="nic" value="eth0"/>
     &lt;/attributes>
    &lt;/instance_attributes>
   &lt;/primitive>
</screen>
  <para>
   Then issue the following command:
  </para>
<screen><command>cibadmin</command> <option>--obj_type</option> resources <option>-U</option> -x foo</screen>
  <para>
   To change the IP address of the IPaddr2 resource previously added, issue
   the command below:
  </para>
<screen><command>cibadmin</command> <option>-M</option> <option>-X</option> '&lt;nvpair id="R_ip_P_ip" name="ip" value="10.10.10.102"/>'
</screen>
  <note>
   <para>
    This does not change the resource name to match the new IP address. To
    do that, delete then re-add the resource with a new ID tag.
   </para>
  </note>
  <para>
   To stop (disable) the IP address resource added previously, and without
   removing it, create a file called <filename>bar</filename> with the
   following content in it:
  </para>
<screen>
&lt;primitive id="R_10.10.10.101">
 &lt;instance_attributes id="RA_R_10.10.10.101">
  &lt;attributes>
   &lt;nvpair id="stop_R_10.10.10.101" name="target-role" value="Stopped"/>
  &lt;/attributes>
 &lt;/instance_attributes>
&lt;/primitive>
</screen>
  <para>
   Then issue the following command:
  </para>
<screen><command>cibadmin</command> <option>--obj_type</option> resources <option>-U</option> <option>-x</option> bar</screen>
  <para>
   To restart the IP address resource stopped by the previous step, issue:
  </para>
<screen><command>cibadmin</command> <option>-D</option> <option>-X</option> '&lt;nvpair id="stop_R_10.10.10.101">'</screen>
  <para>
   To completely remove the IP address resource from the CIB, issue this
   command:
  </para>
<screen><command>cibadmin</command> <option>-D</option> <option>-X</option> '&lt;primitive id="R_10.10.10.101"/>'</screen>
  <para>
   To replace the CIB with a new manually-edited version of the CIB, use the
   following command:
  </para>
<screen><command>cibadmin</command> <option>-R</option> <option>-x</option> $HOME/cib.xml</screen>
 </refsect1>
 <refsect1>
  <title>Files</title>
  <para>
   <filename>/var/lib/heartbeat/crm/cib.xml</filename>&mdash;the CIB (minus
   status section) on disk.
  </para>
 </refsect1>
 <refsect1>
  <title>See Also</title>
  <remark role="clarity">
   2007-03-20 - jjaeger: have to fake the link look even for things that aren't
   a link. Nothing to be done about it.
   </remark>
  <para>
   <xref linkend="man.crmresource"/>, <xref linkend="man.crmadmin"/>,
   lrmadmin(8), heartbeat(8)
  </para>
 </refsect1>
<!--  
 <refsect1>
  <title>Author</title>
  <para>
   <command>cibadmin</command> was written by Andrew Beekhof.
  </para>
  <para>
   This manual page was originally written by Alan Robertson.
  </para>
 </refsect1>
 -->
 <refsect1>
  <title>Caveats</title>
  <para>
   Avoid working on the automatically maintained copy of the CIB on the
   local disk. Whenever anything in the cluster changes, the CIB is updated.
   Therefore using an outdated backup copy of the CIB to propagate your
   configuration changes might result in an inconsistent cluster.
  </para>
 </refsect1>
</refentry>
