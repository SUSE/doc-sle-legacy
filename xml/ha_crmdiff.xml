<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<refentry id="man.crmdiff">
 <refmeta>
  <refentrytitle>crm_diff</refentrytitle>
  <manvolnum>8</manvolnum>
 </refmeta>
 <refnamediv>
  <refname>crm_diff</refname><refpurpose>identify changes to the cluster configuration and apply patches
   to the configuration files</refpurpose>
 </refnamediv>
 <refsect1>
  <title>Synopsis</title>
<screen><command>crm_diff</command> <option>[-?|-V]</option> <option>[-o <replaceable>filename</replaceable>]</option> <option>[-O <replaceable>string</replaceable>]</option> <option>[-p <replaceable>filename</replaceable>]</option> <option>[-n <replaceable>filename</replaceable>]</option> <option>[-N <replaceable>string</replaceable>]</option></screen>
 </refsect1>
 <refsect1>
  <title>Description</title>
  <para>
   The <command>crm_diff</command> command assists in creating and applying
   XML patches. This can be useful for visualizing the changes between two
   versions of the cluster configuration or saving changes so they can be
   applied at a later time using <command>cibadmin</command>.
  </para>
 </refsect1>
 <refsect1>
  <title>Options</title>
  <variablelist>
   <varlistentry>
    <term><option>--help</option>, <option>-?</option>
    </term>
    <listitem>
     <para>
      Print a help message.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--original <replaceable>filename</replaceable></option>,
     <option>-o <replaceable>filename</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the original file against which to diff or apply patches.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--new <replaceable>filename</replaceable></option>,
     <option>-n <replaceable>filename</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the name of the new file.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--original-string <replaceable>string</replaceable></option>,
     <option>-O <replaceable>string</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the original string against which to diff or apply patches.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--new-string <replaceable>string</replaceable></option>,
     <option>-N <replaceable>string</replaceable></option>
    </term>
    <listitem>
     <para>
      Specify the new string.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--patch <replaceable>filename</replaceable></option>,
     <option>-p <replaceable>filename</replaceable></option>
    </term>
    <listitem>
     <para>
      Apply a patch to the original XML. Always use with
      <option>-o</option>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--cib</option>, <option>-c</option>
    </term>
    <listitem>
     <para>
      Compare or patch the inputs as a CIB. Always specify the base version
      with <option>-o</option> and provide either the patch file or the
      second version with <option>-p</option> or <option>-n</option>,
      respectively.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--stdin</option>, <option>-s</option>
    </term>
    <listitem>
     <para>
      Read the inputs from stdin.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 <refsect1>
  <title>Examples</title>
  <para>
   Use crm_diff to determine the differences between various CIB
   configuration files and to create patches. By means of patches, easily
   reuse configuration parts without having to use the cibadmin command on
   every single one of them.
  </para>
  <procedure>
   <step>
    <para>
     Obtain the two different configuration files by running cibadmin on the
     two cluster setups to compare:
    </para>
<screen><command>cibadmin <option>-Q</option> > <replaceable>cib1</replaceable>.xml</command>
<command>cibadmin <option>-Q</option> > <replaceable>cib2</replaceable>.xml</command></screen>
   </step>
   <step>
    <para>
     Determine whether to diff the entire files against each other or
     compare just a subset of the configurations.
    </para>
   </step>
   <step>
    <para>
     To print the difference between the files to stdout, use the following
     command:
    </para>
<screen><command>crm_diff</command> <option>-o</option> <replaceable>cib1</replaceable>.xml <option>-n</option> <replaceable>cib2</replaceable>.xml</screen>
   </step>
   <step>
    <para>
     To print the difference between the files to a file and create a patch,
     use the following command:
    </para>
<screen><command>crm_diff</command> <option>-o</option> <replaceable>cib1</replaceable>.xml <option>-n</option> <replaceable>cib2</replaceable>.xml > <replaceable>patch</replaceable>.xml</screen>
   </step>
   <step>
    <para>
     Apply the patch to the original file:
    </para>
<screen><command>crm_diff</command> <option>-o</option> <replaceable>cib1</replaceable>.xml <option>-p</option> <replaceable>patch</replaceable>.xml</screen>
   </step>
  </procedure>
 </refsect1>
 <refsect1>
  <title>Files</title>
  <para>
   <filename>/var/lib/heartbeat/crm/cib.xml</filename>&mdash;the CIB (minus
   status section) on disk. Editing this file directly is strongly
   discouraged.
  </para>
 </refsect1>
 <refsect1>
  <title>See Also</title>
  <para>
   <xref linkend="man.cibadmin"/>
  </para>
 </refsect1>
<!-- 
 <refsect1>
  <title>Author</title>
  <para>
   <command>crm_diff</command> was written by Andrew Beekhof.
  </para>
 </refsect1>
 -->
</refentry>
