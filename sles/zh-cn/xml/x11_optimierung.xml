<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="x11_optimierung.xml" id="sec-x11-optimieren">
 <title>手动配置 X Window 系统</title><indexterm id="idx-X-optimizing" class="startofrange"> <primary>X</primary> <secondary>配置</secondary></indexterm><indexterm> <primary>配置文件</primary> <secondary>xorg.conf</secondary></indexterm><indexterm> <primary>X.Org</primary></indexterm>

 <para>
  默认情况下，X Window 系统用 SaX2 界面配置，如<xref linkend="cha-y2-hw-graph"/>中所述。或者可以通过编辑其配置文件手动配置它。
 </para>

 <warning>
  <title>错误的 X 配置可能会损坏您的硬件。</title>
  <para>
   配置 X Window 系统时要小心。在完成配置前，切勿启动 X Window 系统。错误配置的系统可能会对您的硬件造成无法修复的损坏（此情况尤其针对于固定频率的监视器）。该书和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的创建者不对导致的任何损坏负责。这里提供的信息已经仔细斟酌，但并不能保证所提供的所有方法均正确且不会对您的硬件造成任何损坏。
  </para>
 </warning>

 <para>
  命令 <command>sax2</command> 会创建 <filename>/etc/X11/xorg.conf</filename> 文件。这是 <phrase role="productname">X Window 系统</phrase>的主配置文件。请在此查找与图形卡、鼠标和监视器有关的所有设置。<indexterm> <primary>X</primary><secondary>SaX2</secondary> </indexterm> <indexterm> <primary>X</primary><secondary>xorg.conf</secondary> </indexterm>
 </para>

 <important>
  <title>使用 X -configure</title>
  <para>
   如果之前尝试 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的 SaX2 失败，请使用 <command>X -configure</command> 配置您的 X 安装。如果您的安装涉及专有的仅二进制驱动程序，则 <command>X -configure</command> 不起作用。
  </para>
 </important>

 <para>
  下面小节介绍配置文件 <filename>/etc/X11/xorg.conf</filename> 的结构。它由多个部分组成，每个部分处理配置的某个特定方面。每个部分都以关键字 <systemitem>Section &lt;designation&gt;</systemitem> 开头，以 <systemitem>EndSection</systemitem> 结尾。以下惯例适用于所有章节：
 </para>

<screen>Section "designation"
  entry 1
  entry 2
  entry n
EndSection </screen>

 <para>
  <xref linkend="tab-x11-sections"/> 中列出了可用的部分类型。
 </para>

 <table id="tab-x11-sections">
  <title>/etc/X11/xorg.conf 中的部分</title>
  <tgroup cols="2" align="left">
   <thead>
    <row>
     <entry>
      <para>
       <emphasis role="bold">类型</emphasis>
      </para>
     </entry>
     <entry>
      <para>
       <emphasis role="bold">含义</emphasis>
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       <systemitem>Files</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       用于字体和 RGB 颜色表的路径。<indexterm> <primary>xorg.conf</primary> <secondary>文件</secondary> </indexterm>
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>ServerFlags</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       服务器行为的常规切换。<indexterm> <primary>xorg.conf</primary> <secondary>ServerFlags</secondary> </indexterm>
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>Module</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       服务器应装载的模块列表<indexterm> <primary>xorg.conf</primary> <secondary>模块</secondary> </indexterm>
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>InputDevice</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       在此部分中配置输入设备，如键盘和特殊输入设备（触摸板、游戏杆等）。此部分的重要参数有 <systemitem>Driver</systemitem> 以及定义 <systemitem>Protocol</systemitem> 和 <systemitem>Device</systemitem> 的选项。对连接到计算机的每个设备，通常都有一个 <systemitem>InputDevice</systemitem> 部分。<indexterm> <primary>xorg.conf</primary> <secondary>InputDevice</secondary> </indexterm>
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>Monitor</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       使用的显示器。此部分的重要元素是<systemitem>标识符</systemitem>（稍后在 <systemitem>Screen</systemitem> 定义中引用）、刷新率 <systemitem>VertRefresh</systemitem> 和同步频率限制（<systemitem>HorizSync</systemitem> 和 <systemitem>VertRefresh</systemitem>）。这些设置采用的单位为 MHz、kHz 和 Hz。通常，服务器拒绝不符合监视器规格的任何方式行。这样可防止意外地将过高的频率发送到监视器。<indexterm><primary>xorg.conf</primary><secondary>监视器</secondary></indexterm><indexterm><primary>xorg.conf </primary><secondary>方式行</secondary></indexterm>
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>Modes</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       特定屏幕分辨率的方式行参数。可以根据用户给出的值由 SaX2 计算出这些参数，并且通常无需更改这些参数。您可以在此时进行手动干预，例如当要连接固定频率监视器时。HOWTO 文件（位于 <filename>/usr/share/doc/howto/en/html/XFree86-Video-Timings-HOWTO</filename>）提供了各个数字值含义的细节（在 <systemitem>howtoenh</systemitem> 包中提供）。要手动计算 VESA 方式，可使用工具 <command>cvt</command>。例如，要计算 1680x1050@60Hz 监视器的模式行，请使用命令 <command>cvt 1680 1050 60</command>。<indexterm> <primary>xorg.conf</primary> <secondary>方式</secondary> </indexterm>
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>Device</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       特定的图形卡。系统通过其描述性名称来参考图形卡。本部分中的可用选项高度依赖于所用驱动程序。例如，如果使用 <literal>i810</literal> 驱动程序，请在手册页 <command>man 4 i810</command> 中查找有关各种可用选项的更多信息。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>Screen</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       将 <systemitem>Monitor</systemitem> 和 <systemitem>Device</systemitem> 合并在一起组成 X.Org 的所有必要设置。在 <systemitem>Display</systemitem> 子部分中，指定虚拟屏幕 (<systemitem>Virtual</systemitem>)、<systemitem>ViewPort</systemitem> 和与此屏幕一起使用的 <systemitem>Modes</systemitem> 的大小。
      </para>
      <para>
       请注意，某些驱动程序要求 <systemitem>Display</systemitem> 部分中某个位置内必须存在所用的全部配置。例如，如果使用便携式计算机并希望使用比内部 LCD 更大的外部监视器，可能需要在 <systemitem>Modes</systemitem> 行结尾处添加内部 LCD 支持的更大分辨率。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>ServerLayout</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       单个或多头配置的布局。此部分将输入设备 <systemitem>InputDevice</systemitem> 和显示设备 <systemitem>Screen</systemitem> 绑定在一起。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       <systemitem>DRI</systemitem>
      </para>
     </entry>
     <entry>
      <para>
       提供 Direct Rendering Infrastructure (DRI) 的信息。
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>

 <para>
  下面详细介绍 <systemitem>Monitor</systemitem>、<systemitem>Device</systemitem> 和 <systemitem>Screen</systemitem>。<filename>X.Org</filename> 和 <filename>xorg.conf</filename> 的手册页提供了有关其它部分的详细信息。
 </para>

 <para>
  <systemitem>xorg.conf</systemitem> 中可以存在多个不同的<systemitem> Monitor </systemitem>和<filename> Device </filename>部分。甚至可以存在多个 <systemitem>Screen</systemitem> 部分。<systemitem>ServerLayout</systemitem> 部分确定使用其中哪个部分。
 </para>

 <sect2 id="sec-x11-screen">
  <title>Screen 部分</title><indexterm> <primary>配置文件</primary> <secondary>xorg.conf</secondary> <tertiary>Screen</tertiary> </indexterm>
  <para>
   Screen 部分将 Monitor 部分与 Device 部分结合起来并确定要使用的分辨率和颜色深度。Screen 部分与<xref linkend="dat-x11-scrsec"/> 类似。
  </para>
  <example id="dat-x11-scrsec">
   <title>文件 /etc/X11/xorg.conf 的 Screen 部分</title>
<screen>Section "Screen"<co id="co-x11-screen"/>
  DefaultDepth  16<co id="co-x11-ddepth"/>
  SubSection "Display"<co id="co-x11-display"/>
    Depth       16<co id="co-x11-depth"/>
    Modes       "1152x864" "1024x768" "800x600"<co id="co-x11-mode"/>
    Virtual     1152x864<co id="co-x11-virt"/>
  EndSubSection
  SubSection "Display"
    Depth       24
    Modes       "1280x1024"
  EndSubSection
  SubSection "Display"
    Depth       32
    Modes "640x480"
  EndSubSection
  SubSection "Display"
    Depth        8
    Modes       "1280x1024"
  EndSubSection
  Device        "Device[0]"
  Identifier    "Screen[0]"<co id="co-x11-ident"/>
  Monitor       "Monitor[0]"
EndSection</screen>
  </example>
  <calloutlist>
   <callout arearefs="co-x11-screen">
    <para>
     <literal>Section</literal> 确定该部分的类型，在本示例中是 <literal>Screen</literal>。
    </para>
   </callout>
   <callout arearefs="co-x11-ddepth">
    <para>
     <indexterm> <primary>xorg.conf</primary> <secondary>Monitor</secondary> </indexterm> <literal>DefaultDepth</literal> 决定默认使用的颜色深度（除非明确指定其他颜色深度）。
    </para>
   </callout>
   <callout arearefs="co-x11-display">
    <para>
     <indexterm> <primary>xorg.conf</primary> <secondary>Display</secondary> </indexterm> 对每种颜色深度指定不同的 <literal>Display</literal> 子部分。
    </para>
   </callout>
   <callout arearefs="co-x11-depth">
    <para>
     <indexterm> <primary>xorg.conf</primary> <secondary>Depth</secondary> </indexterm> <indexterm> <primary>xorg.conf</primary> <secondary>颜色深度</secondary> </indexterm> <literal>Depth</literal> 决定对本组 <literal>Display</literal> 设置使用的颜色深度。可能的值有 <literal>8</literal>、<literal>15</literal>、<literal>16</literal>、<literal>24</literal> 和 <literal>32</literal>，尽管并非所有 X 服务器模块或分辨率都支持所有这些值。
    </para>
   </callout>
   <callout arearefs="co-x11-mode">
    <para>
     <systemitem>Modes</systemitem> 部分由可能的屏幕分辨率列表组成。X 服务器从左到右检查此列表。对于每个分辨率，X 服务器均会在 <systemitem>Modes</systemitem> 部分中搜索合适的 <systemitem>Modeline</systemitem>。<systemitem>Modeline </systemitem>取决于监视器和图形卡的功能。<systemitem>Monitor </systemitem>设置确定最终的 <systemitem>Modeline</systemitem>。<indexterm> <primary>xorg.conf</primary> <secondary>方式</secondary> </indexterm> <indexterm> <primary>xorg.conf</primary> <secondary>方式行</secondary> </indexterm>
    </para>
    <para>
     找到的第一个分辨率是 <systemitem>Default mode</systemitem>。使用 <keycombo><keycap>Ctrl</keycap><keycap>Alt</keycap> <keycap>+</keycap></keycombo>（在数字小键盘上）向右切换到列表中的下一个分辨率。使用 <keycombo><keycap>Ctrl</keycap><keycap>Alt</keycap> <keycap>–</keycap></keycombo>（在数字小键盘上）切换到上一个分辨率。这使您能够在 X 运行时改动分辨率。<indexterm><primary> 屏幕</primary><secondary>分辨率</secondary> </indexterm>
    </para>
   </callout>
   <callout arearefs="co-x11-virt">
    <para>
     <indexterm><primary>X</primary><secondary>虚拟屏幕</secondary></indexterm>包含 <systemitem>Depth 16</systemitem> 的<systemitem> Display</systemitem> 子部分的最后一行指出了虚拟屏幕的大小。虚拟屏幕的最大可能大小取决于图形卡中安装的内存量和所需的颜色深度，而不取决于监视器的最大分辨率。如果忽略此行，虚拟分辨率就是物理分辨率。因为目前的图形卡都具有大量视频内存，所以您可以创建非常大的虚拟桌面。但是，如果您将大部分视频内存用于虚拟桌面，则可能不能再使用 3D 功能。例如，如果图形卡有 16 MB 视频 RAM，则当采用 8 位颜色深度时，虚拟屏幕最多可以有 4096x4096 个像素。但建议不要将所有内存用于虚拟屏幕，因为图形卡的内存还要用于多种字体和图形缓存，对于加速卡而言尤其如此。
    </para>
   </callout>
   <callout arearefs="co-x11-ident">
    <para>
     行 <systemitem>Identifier</systemitem>（这里是 <systemitem>Screen[0]</systemitem>）为此部分指定一个定义的名称，在随后的 <systemitem>ServerLayout</systemitem> 部分中可以使用此名称唯一引用这个部分。行 <systemitem>Device</systemitem> 和 <systemitem>Monitor</systemitem> 指定属于此定义的图形卡和监视器。这些行仅仅是通过 <systemitem>Device</systemitem> 和 <systemitem>Monitor</systemitem> 部分的相应名称或<emphasis>标识符</emphasis>指向这些部分的链接。下面详细讨论这些部分。<indexterm> <primary>xorg.conf</primary> <secondary>设备</secondary> </indexterm>
    </para>
   </callout>
  </calloutlist>
 </sect2>

 <sect2 id="sec-x11-device-section">
  <title>Device 部分</title><indexterm> <primary>配置文件</primary> <secondary>xorg.conf</secondary> <tertiary>设备</tertiary> </indexterm>
  <para>
   Device 部分描述特定的图形卡。您可以在 <filename>xorg.conf</filename> 中包含任意多个设备项，前提是要使用关键字 <systemitem>Identifier</systemitem> 对这些项的名称进行区分。如果您安装了多个图形卡，通常按顺序对这些部分进行编号。第一个设备称为 <systemitem>Device[0]</systemitem>，第二个设备称为 <systemitem>Device[1]</systemitem>，依此类推。以下文件显示了从配备了 Matrox Millennium PCI 图形卡（由 SaX2 配置）的计算机的 <systemitem>Device</systemitem> 部分节选出的一段：
  </para>
<screen>Section "Device"
  BoardName     "MGA2064W"
  BusID         "0:19:0"<co id="co-x11-bus"/>
  Driver        "mga"<co id="co-x11-driver"/>
  Identifier    "Device[0]"
  VendorName    "Matrox"
  Option        "sw_cursor"
EndSection</screen>
  <calloutlist>
   <callout arearefs="co-x11-bus">
    <para>
     <systemitem>BusID</systemitem> 是指安装图形卡的 PCI 或 AGP 插槽。它与使用命令 <command>lspci</command> 显示的 ID 相匹配。X 服务器需要采用十进制形式的详细信息，但 <command>lspci</command> 以十六进制形式显示这些信息。SaX2 会自动检测 <systemitem>BusID</systemitem> 的值。
    </para>
   </callout>
   <callout arearefs="co-x11-driver">
    <para>
     <indexterm> <primary>X</primary> <secondary>驱动程序</secondary> </indexterm> <indexterm> <primary>卡</primary> <secondary>图形</secondary> </indexterm> <indexterm> <primary>图形</primary> <secondary>卡</secondary> <tertiary>驱动程序</tertiary> </indexterm> <systemitem>Driver</systemitem> 的值由 SaX2 自动设置，该值指定哪个驱动程序用于您的图形卡。如果此卡是 Matrox Millennium，则将驱动程序模块称为 <systemitem>mga</systemitem>。然后，X 服务器通过 <systemitem>drivers</systemitem> 子目录的 <systemitem>Files</systemitem> 部分中定义的 <filename>ModulePath</filename> 进行搜索。在标准安装中，有一个 <filename>/usr/lib/xorg/modules/drivers</filename> 目录或 <filename>/usr/lib64/xorg/modules/drivers</filename> 目录，用于 64 位操作系统目录。然后将<filename> _drv.o</filename> 添加到名称中。因此，对于 <systemitem>mga</systemitem> 驱动程序，将装载驱动程序文件 <systemitem>mga_drv.o</systemitem>。
    </para>
   </callout>
  </calloutlist>
  <para>
   还可以通过其他选项影响 X 服务器或驱动程序的行为。在 Device 部分中设置的选项 <systemitem>sw_cursor</systemitem> 就是这方面的一个示例。此选项停用硬件鼠标光标并使用软件显示鼠标光标。根据驱动程序模块，有不同的选项可用（它们位于目录 <filename>/usr/share/doc/packages/<replaceable>package_name</replaceable> </filename> 中驱动程序模块的描述文件中。通常还可以在手册页（<command>man</command> <option>xorg.conf</option>、<command>man</command> <option>4</option> <option><replaceable>&lt;driver module&gt;</replaceable></option> 和 <command>man</command> <option>4</option> <option><replaceable>chips</replaceable></option>）中找到有效的选项。
  </para>
  <para>
   如果图形卡有多个视频连接器，可以将这一个卡的不同设备配置为单一视图。请使用 SaX2 来以这种方式设置图形接口。
  </para>
 </sect2>

 <sect2 id="sec-x11-opt-monitor">
  <title>Monitor 部分和 Modes 部分</title><indexterm> <primary>配置文件</primary> <secondary>xorg.conf</secondary> <tertiary>Monitor</tertiary> </indexterm>
  <para>
   与 <systemitem>Device</systemitem> 部分类似，<systemitem>Monitor</systemitem> 和 <systemitem>Modes</systemitem> 部分分别描述一个监视器。配置文件 <filename>/etc/X11/xorg.conf</filename> 可以包含任意多个 <systemitem>Monitor</systemitem> 部分。每个 <systemitem>Monitor</systemitem> 部分使用行 <systemitem>UseModes</systemitem>（如果可用）引用一个 <systemitem>Modes</systemitem> 部分。如果没有 <systemitem>Modes</systemitem> 部分可用于 <systemitem>Monitor</systemitem> 部分，X 服务器将根据常规同步值计算相应值。服务器布局部分指定相关的 <systemitem>Monitor</systemitem> 部分。
  </para>
  <para>
   只有有经验的用户才可以设置监视器定义。modeline 是 <systemitem>Monitor</systemitem> 部分的重要部分。方式行设置相应分辨率的水平定时和垂直定时。<systemitem>Monitor </systemitem>部分储存有监视器属性（特别是所允许的频率）。可以使用实用程序 <command>cvt</command> 生成 VESA 方式。有关更多信息，请参见 cvt <command>man cvt</command> 的手册页。
  </para>
  <warning>
   <para>
    除非您对监视器和图形卡功能有深入了解，否则建议不要更改 modelien，因为这可能严重损坏监视器。
   </para>
  </warning><indexterm> <primary>帮助</primary><secondary>X</secondary></indexterm><indexterm><primary>X</primary><secondary>帮助 </secondary></indexterm>
  <para>
   如果您要创建自己的监视器描述，则应非常熟悉 <filename>/usr/share/X11/doc</filename> 中的文档。安装包 <systemitem>xorg-x11-doc</systemitem> 以查找 PDF 和 HTML 页面。
  </para>
  <para>
   现在，很少需要手动指定方式行。如果您使用的是最新的多频同步监视器，则通常由 X 服务器通过 DDC 直接从监视器中读取允许的频率和最佳分辨率，如 SaX2 配置一节所述。如果由于某种原因无法执行此操作，请使用 X 服务器中包含的 VESA 方式之一。这种方式可用于大多数图形卡和监视器的组合。
  </para><indexterm class="endofrange" startref="idx-X-optimizing"/>
 </sect2>
</sect1>
