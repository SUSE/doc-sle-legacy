<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE book PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<?novdocinfo structuredapp = "NovDocX"?>
<?profile name = "+PubBeta" arch = "Next" condition = "Manual"?>
<?profile name = "+PubTest" arch = "Future,Next" condition = "Manual"?>
<?profile name = "+Pubwww" arch = "EMPTY" condition = "Manual"?>
<?profile name = "Future" arch = "Future"?>
<?profile name = "Manual" condition = "Manual"?>
<?profile name = "Next" arch = "Next"?>
<?novdocmeta idref="stor_admin"
 element="book"
 DepthToc="3"
 DepthNumbering="3"
?>
<book xml:base="stor_admin.xml" revision="12/16/13" conformance="sles11,Novell,no,4,80" lang="zh-cn" id="stor_admin">
<bookinfo id="bookinfo" role="Suse" xml:base="00_front.xml">
 <title>储存管理指南</title> <productname>SUSE Linux Enterprise Server 11 SP3 </productname>
 <date><?dbtimestamp format="Y"?> 年 <?dbtimestamp format="B"?> 月 <?dbtimestamp format="d"?> 日</date>
 <titleabbrev>储存管理指南</titleabbrev>
 <legalnotice id="legalnotices">
  <title>法律声明</title>
  <para>版权所有 © 2006–2013 Novell, Inc. 和贡献者。保留所有权利。 </para>
  <para>根据 GNU 自由文档许可证 (GNU Free Documentation License) 版本 1.2 或（根据您的选择）版本 1.3 中的条款，在此授予您复制、分发和/或修改本文档的许可权限；本版权声明和许可证附带不可变部分。许可证版本 1.2 的副本包含在题为<quote>GNU 自由文档许可证</quote>的部分。</para>
  <para>本指南力求涵盖所有细节。但这并不确保本指南准确无误。无论是 Novell, Inc.、SUSE LINUX 产品 GmbH、作者还是翻译人员都不对任何可能的错误或因错误造成的任何后果负责。</para>
 </legalnotice>
 <legalnotice id="bw4uqnv">
  <title>商标</title>
  <simplelist>
   <member><ulink url="http://www.novell.com/company/legal/trademarks/tmlist.html">有关 Novell 商标，请参见 Novell 商标和服务标记列表</ulink>。</member><member>Linux* 是 Linus Torvalds 的注册商标。所有第三方商标均属其各自所有者的财产。</member> <member>商标符号（®、™ 等）星号 (*) 代表第三方商标。</member>
  </simplelist>
 </legalnotice>
</bookinfo>

<preface id="preface" xml:base="00_preface.xml">
 <title>关于本指南</title>
 <para>本指南提供关于如何在 SUSE Linux Enterprise Server 11 支持包 3 (SP3) 服务器上管理储存设备的信息。</para>
 <bridgehead id="audience">适用对象</bridgehead>
 <para>本指南适用于系统管理员。</para>
 <bridgehead id="usercomments">反馈</bridgehead>
 <para>我们希望听到您对本手册和本产品中包含的其他文档的意见和建议。请使用联机文档每页底部的“用户意见”功能，或访问 www.novell.com/documentation/feedback.html 并输入您的意见。</para>
 <bridgehead id="docupdates">文档更新</bridgehead>
 <para>有关最新版本的《<citetitle>SUSE Linux Enterprise Server 11 储存管理指南</citetitle>》，请访问 <ulink url="http://www.suse.com/documentation/sles11">SUSE Linux Enterprise Server 11 的 SUSE 文档网站</ulink>。</para>
 <bridgehead id="additionaldoc">其他文档</bridgehead>
 <para>有关设备分区和管理的信息，请参见<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html">《<citetitle>SUSE Linux Enterprise Server 11 部署指南</citetitle>》</ulink>中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/cha_advdisk.html"><quote>高级磁盘设置</quote></ulink>。</para>
</preface>

<chapter id="filesystems" lang="en" xml:base="01_filesystems.xml">
 <title>Linux 中的文件系统的概述</title>
 <para>SUSE Linux Enterprise Server 随附大量可供选择的不同文件系统，其中包括 Btrfs、Ext3、Ext2、ReiserFS 和 XFS。每个文件系统都有各自的优点和缺点。 </para>
 <para>专业的高性能设置可能需要高可用性的储存系统。为了满足高性能群集情形的要求，SUSE Linux Enterprise Server 在其 SLES 高可用性储存基础设施 (HASI) 版本中包含了 OCFS2 (Oracle Cluster File System 2) 和分布式复制块设备 (DRBD)。本指南中不涉及这些高级储存系统的内容。有关信息，请参见<ulink url="http://www.suse.com/documentation/sle_ha/book_sleha/data/book_sleha.html">《<citetitle>SUSE Linux Enterprise 11 SP3 高可用性扩展指南</citetitle>》</ulink>。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec_filesystems_glossary" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_filesystems_major" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_filesystems_add" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_filesystems_lfs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect_stor_limits" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkbhpd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_filesystems_info" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sec_filesystems_glossary">
  <title>术语</title>
  <variablelist>
   <varlistentry id="bgchzar">
    <term>元数据</term>
    <listitem>
     <para>文件系统内部的一种数据结构。它确保能够正确组织和访问所有磁盘上的数据。从本质上讲，它是<quote>有关数据的数据</quote>。几乎每个文件系统都有自己的元数据结构，这也是文件系统为何表现出不同性能特性的部分原因。维护元数据的完整性非常重要，因为如果不这样，则可能无法访问文件系统中的所有数据。 </para>
    </listitem>
   </varlistentry>
   <varlistentry id="bgchzas">
    <term>inode</term>
    <listitem>
     <para>文件系统上的一种数据结构，包含关于文件的各种信息，包括大小、链接数、指向实际储存文件内容的磁盘块的指针以及创建、修改和访问的日期与时间。 </para>
    </listitem>
   </varlistentry>
   <varlistentry id="bgchzat">
    <term>日记</term>
    <listitem>
     <para>在提及文件系统时，日记是包含某种日志的磁盘上结构，文件系统将要对文件系统的元数据进行的更改储存在此日志中。日记可以显著缩短文件系统的恢复时间，因为它无需在系统启动时进行检查整个文件系统这一冗长的搜索过程。而只是重放日记。 </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec_filesystems_major">
  <title>Linux 中的主要文件系统</title>
  <para>SUSE Linux Enterprise Server 提供了可供选择的各种文件系统。本节概述了这些文件系统的基本工作原理以及它们的优点。 </para>
  <para>记住一点很重要：没有任何一种文件系统适合所有种类的应用。每个文件系统都有各自的特定优点和缺点，必须将这些因素考虑在内。此外，即使是最复杂的文件系统也不能替代合理的备份策略。 </para>
  <para>本节中使用的术语<emphasis>数据完整性</emphasis>和<emphasis>数据一致性</emphasis>并不是指用户空间数据（您的应用程序写入其文件的数据）的一致性。此数据是否一致必须由应用程序本身控制。 </para>
  <important>
   <para>除非本节另行声明，否则可以使用 YaST 执行设置或更改分区和文件系统所需的所有步骤。 </para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_filesystems_major_ext2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_filesystems_major_ext3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_filesystems_major_reiser" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_filesystems_major_xfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkryet" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bwk8gda">
   <title>Btrfs</title>
   <para>Brtfs 是由 Chris Mason 开发的一种写时复制 (COW) 文件系统。它基于 Ohad Rodeh 开发的适用于 COW 的 B 树。Btrfs 是日志记录样式的文件系统。它不记录块更改，而是将块更改写入新位置，然后链接上更改。新更改在上一次写后才提交。 </para>
   <important>
    <para>由于 Btrfs 可以存储文件系统的快照，因此建议要预留比标准储存空间大两倍的磁盘空间。YaST 分区程序在根文件系统的 Btrfs 储存方案中会采用此策略进行自动分区。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15tkq5m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkq5n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5j" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5k" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5l" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5o" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5p" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15tkq5m">
    <title>主要特征</title>
    <para>Btrfs 提供容错、修复和易于管理的功能，比如：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>可写快照，允许应用更新后按需轻松回滚系统或允许备份文件。 </para>
     </listitem>
     <listitem>
      <para>多设备支持，允许增加或缩小文件系统。该功能计划将在 YaST 分区程序以后的发行版本中提供。</para>
     </listitem>
     <listitem>
      <para>压缩功能，可有效使用储存空间。 </para>
      <para>使用 Btrfs 命令设置透明压缩。Btrfs 的压缩和加密功能尚在开发中，目前在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 上不受支持。</para>
     </listitem>
     <listitem>
      <para>不同 RAID 级别，适用于元数据和用户数据。</para>
     </listitem>
     <listitem>
      <para>用于元数据和用户数据的不同校验和，可改进错误检测。</para>
     </listitem>
     <listitem>
      <para>与 Linux 逻辑卷管理器 (LVM) 储存对象集成。</para>
     </listitem>
     <listitem>
      <para>与 SUSE Linux 上的 YaST 分区程序和 AutoYaST 集成。</para>
     </listitem>
     <listitem>
      <para>从现有的 Ext2、Ext3 以及 Ext4 文件系统进行脱机迁移。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="b15tkq5n">
    <title>引导加载程序支持</title>
    <para>计划将在 SUSE Linus Enterprise 12 中开始提供对于 Btrfs 上的 <filename>/boot</filename> 的引导加载程序支持。</para>
   </sect3>
   <sect3 id="b15tkr5j">
    <title>Btrfs 子卷</title>
    <para>Btrfs 会在指派给它的空间池中创建默认子卷。它允许您在相同空间池中创建更多的子卷，作为不同的文件系统。子卷的数目仅受分配给池的空间所限。</para>
    <para>如果将 Btrfs 用于根 (<filename>/</filename>) 文件系统，则 YaST 分区程序会自动准备好与 Btrfs 子卷配合使用的 Btrfs 文件系统。可以使用任何子目录充当子卷。例如，<xref linkend="b11qhfrl" xrefstyle="TableTitleOnPage"/>中指出了我们建议您视作子卷处理的子目录，因为这些子目录包含由于以下原因而不应生成快照的文件：</para>
    <table id="b11qhfrl" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
     <title>YaST 中 Btrfs 的默认子卷处理</title>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="2381*"/>
     <colspec colnum="2" colname="2" colwidth="7620*"/>
      <thead>
       <row id="bwk8pe0">
        <entry>
         <para>路径</para>
        </entry>
        <entry>
         <para>充当子卷的原因</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="b11qhf62">
        <entry>
         <para><filename>/opt</filename></para>
        </entry>
        <entry>
         <para>包含第三方外接式附件应用程序软件包。</para>
        </entry>
       </row>
       <row id="b11qhf63">
        <entry>
         <para><filename>/srv</filename></para>
        </entry>
        <entry>
         <para>包含 <filename>http</filename> 和 <filename>ftp</filename> 文件。</para>
        </entry>
       </row>
       <row id="b11qhf64">
        <entry>
         <para><filename>/tmp</filename></para>
        </entry>
        <entry>
         <para>包含临时文件。</para>
        </entry>
       </row>
       <row id="b11qhf65">
        <entry>
         <para><filename>/var/crash</filename></para>
        </entry>
        <entry>
         <para>包含已崩溃内核的内存转储。</para>
        </entry>
       </row>
       <row id="b11qhf66">
        <entry>
         <para><filename>/var/log</filename></para>
        </entry>
        <entry>
         <para>包含绝不应回滚的系统和应用程序的日志文件。</para>
        </entry>
       </row>
       <row id="b11qhf67">
        <entry>
         <para><filename>/var/run</filename></para>
        </entry>
        <entry>
         <para>包含运行时变量数据。</para>
        </entry>
       </row>
       <row id="b11qhf68">
        <entry>
         <para><filename>/var/spool</filename></para>
        </entry>
        <entry>
         <para>包含等待程序、用户或管理员处理的数据，比如新闻、邮件和打印机队列。</para>
        </entry>
       </row>
       <row id="b11qhf69">
        <entry>
         <para><filename>/var/tmp</filename></para>
        </entry>
        <entry>
         <para>包含两次系统重启动之间保留的临时文件或目录。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para>安装之后，您可以使用 YaST 专家分区程序添加或删除 Btrfs 子卷。有关信息，请参见<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html">《<citetitle>SUSE Linux Enterprise Server 11 SP3 部署指南</citetitle>》</ulink>中的<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_yast2_i_y2_part_expert.html#yast2_btrfs_yast"><quote>使用 YaST 管理 Btrfs 子卷</quote></ulink>。</para>
   </sect3>
   <sect3 id="b15tkr5k">
    <title>根文件系统的快照</title>
    <para>Btrfs 提供采用 SUSE 快照程序结构的可写入快照，可让您在应用更新后视需要轻松回滚系统，或备份文件。您可以使用快照程序创建和删除快照，以及比较两张快照并还原它们之间的差异。如果 Btrfs 用于根 (<filename>/</filename>) 文件系统，则 YaST 会自动为根文件系统启用快照功能。 </para>
    <para>有关快照程序及其与 ZYpp (<filename>snapper-zypp-plugin</filename>) 和 YaST (<filename>yast2-snapper</filename>) 集成的信息，请参见<ulink url="http://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html">《<citetitle>SUSE Linux Enterprise Server 11 SP3 管理指南</citetitle>》</ulink>中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_admin/data/cha_snapper.html"><quote>使用快照程序生成快照/实现回滚</quote></ulink>。 </para>
    <para>为防止快照填满系统磁盘空间，您可以在 <filename>/etc/snapper/configs/root</filename> 配置文件中或针对其他安装点将快照程序清理默认值更改为更为激进的数值。快照程序提供了三种清理旧快照的算法，这些算法在日常的 cron 作业中执行。清理频率在快照程序的安装点配置中定义。请将每日、每月和每年的 TIMELINE_LIMIT 参数设置得较低，以缩短快照的保留时间并减少其数量。有关信息，请参见<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html">《SUSE Linux Enterprise Server 11 SP3 管理指南》</ulink>中的<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_snapper_config.html#sec_snapper_config_modify"><quote>调整配置文件</quote></ulink>。<citetitle/></para>
    <para>有关 SUSE 快照程序项目的信息，请参见 <ulink url="http://en.opensuse.org/Portal:Snapper">OpenSUSE.org 中的快照程序门户 Wiki</ulink>。</para>
   </sect3>
   <sect3 id="b15tkr5l">
    <title>联机检查与修复功能</title>
    <para>Btrfs 命令行工具中包括 <command>scrub</command> 检查与修复功能。它会对数据与元数据的完整性进行验证，并假设树型结构完好。您可以在安装的文件系统上定期运行 <command>scrub</command>；正常操作期间，它将在后台运行。</para>
   </sect3>
   <sect3 id="b15tkr5m">
    <title>RAID 和多路径支持</title>
    <para>您可以使用 YaST 分区程序在多个设备 (MD) 和设备映射程序 (DM) 储存配置上创建 Btrfs。</para>
   </sect3>
   <sect3 id="b15tkr5n">
    <title>从 Ext 文件系统迁移到 Btrfs</title>
    <para>您可以将数据卷从现有的 Ext 文件系统（Ext2、Ext3 或 Ext4）迁移到 Btrfs 文件系统。转换过程将在该设备的适当位置以脱机方式进行。Btrfs 文件系统需要设备上至少有 15% 的可用空间。 </para>
    <para>要将 Ext 文件系统转换为 Btrfs 文件系统，请将文件系统脱机，然后输入：</para>

<screen>
btrfs-convert &lt;<replaceable>device</replaceable>&gt;
</screen>

    <para>要将迁移回滚到原先的 Ext 文件系统，请将文件系统脱机，然后输入：</para>

<screen>
btrfs-convert -r &lt;<replaceable>device</replaceable>&gt;
</screen>

    <important>
     <para>回滚到原先的 Ext 文件系统时，将丢失所有在转换为 Btrfs 文件系统后添加的数据。也就是说，只有原先的数据将转换回 Ext 文件系统。 </para>
    </important>
   </sect3>
   <sect3 id="b15tkr5o">
    <title>Btrfs 管理</title>
    <para>Btrfs 与 YaST 分区程序和 AutoYaST 集成。您可以在安装期间使用它来为根文件系统建立解决方案。安装后，可以使用 YaST 分区程序查看和管理 Btrfs 卷。</para>
    <para><filename>btrfsprogs</filename> 包中提供了 Btrfs 管理工具。有关使用 Btrfs 命令的信息，请参见 <command>btrfs(8)</command>、<command>btrfsck(8)</command>、<command>mkfs.btrfs(8)</command> 以及 <command>btrfsctl(8)</command> 手册页。有关 Btrfs 功能的信息，请参见 <ulink url="http://btrfs.wiki.kernel.org"><citetitle>Btrfs wiki</citetitle></ulink>。</para>
    <para>SUSE Linux Enterprise 更新储存库中即将提供 <command>fsck.btrfs(8)</command> 工具。</para>
   </sect3>
   <sect3 id="b15tkr5p">
    <title>Btrfs 子卷定额支持</title>
    <para>Btrfs <systemitem>root</systemitem> 文件系统子卷 <filename>/var/log</filename>、<filename>/var/crash</filename> 和 <filename>/var/cache</filename> 在正常运作情况下可能会使用所有可用的磁盘空间，此时将导致系统故障。为了避免发生此情况，SUSE Linux Enterprise 现在提供了 Btrfs 子卷定额支持。有关详细信息，请参见 <filename>btrfs(8)</filename> 手册页。</para>
   </sect3>
  </sect2>
  <sect2 id="sec_filesystems_major_ext2">
   <title>Ext2</title>
   <para>Ext2 的原身可以追溯到 Linux 历史的早期。其前身是“扩展文件系统”，于 1992 年 4 月实施，集成在 Linux 0.96c 中。扩展文件系统经历了多次修改，后来才称为 Ext2，曾经是多年来最受欢迎的 Linux 文件系统。但随着日记文件系统的创建以及其恢复时间的缩短，Ext2 的重要性逐渐降低。 </para>
   <para>简要总结 Ext2 的优点有助于您了解为什么它以前是（在某些领域现在仍是）许多 Linux 用户最喜欢使用的 Linux 文件系统。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bi6ymkx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzb1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bi6ymkx">
    <title>可靠性和速度</title>
    <para>Ext2 确实是一个<quote>老古董</quote>，它经历了许多改进和频繁的测试。这可能是人们经常将其称之为坚如磐石的文件系统的原因。在系统中断后，如果无法彻底卸装文件系统，则 e2fsck 将开始分析文件系统数据。系统使元数据恢复一致的状态，并将挂起的文件或数据块写入指定的目录（名为 <filename>lost+found</filename>）。与日记文件系统相比，e2fsck 会分析整个文件系统，而不仅仅是最近修改的元数据位。这种操作所花的时间要远远超过检查日记文件系统的日志数据所花的时间。根据文件系统的大小，此过程可能需要半小时或更长时间。因此，对于任何要求高可用性的服务器，不要选择 Ext2。但是，因为 Ext2 不维护日记且使用的内存也少得多，所以其速度常常超过其他文件系统。</para>
   </sect3>
   <sect3 id="bgchzb1">
    <title>可方便地升级</title>
    <para>因为 Ext3 以 Ext2 代码为基础并且共享 Ext2 的磁盘上格式和元数据格式，所以从 Ext2 升级到 Ext3 非常简单。 </para>
   </sect3>
  </sect2>
  <sect2 id="sec_filesystems_major_ext3">
   <title>Ext3</title>
   <para>Ext3 由 Stephen Tweedie 设计。与所有其他下一代文件系统不同，Ext3 并没有采用全新的设计原则。它是在 Ext2 的基础上设计的。这两个文件系统密切关联。可以方便地在 Ext2 文件系统上建立 Ext3 文件系统。Ext2 和 Ext3 最重要的区别是 Ext3 支持日记。总之，Ext3 有三个主要优点： </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzb3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzb4" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="sec.filesystems.major.ext22ext3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="sec_fileystems_major_ext3inodesize" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bgchzb3">
    <title>方便并高度可靠地从 Ext2 升级</title>
    <para>Ext2 的代码是 Ext3 成为广受欢迎的下一代文件系统的坚实基础。在 Ext3 中，它的可靠性和稳定性与日记文件系统的优点完美地结合在一起。与转换到其他日记文件系统不同，转换到 Ext3 只需要花几分钟，而转换到其他日记文件系统（如 ReiserFS 或 XFS）会相当繁琐（备份整个文件系统并从头开始重创建文件系统）。升级到 Ext3 还很安全，因为从头重新创建整个文件系统可能会出现问题。考虑到等待升级到日记文件系统的现有 Ext2 系统的数量，就很容易明白为什么 Ext3 对许多系统管理员来说如此重要。从 Ext3 降级到 Ext2 与升级一样简单。只需彻底卸载 Ext3 文件系统，然后作为 Ext2 文件系统重装入即可。 </para>
   </sect3>
   <sect3 id="bgchzb4">
    <title>可靠性和性能</title>
    <para>某些其他日记文件系统采用<quote>仅元数据</quote>的日记方法。这意味着元数据始终保持一致的状态，但无法自动保证文件系统数据本身一致。Ext3 的设计既可以照顾到元数据，又可以照顾到数据。<quote>照顾</quote>的程度可以自定义。在 <option>data=journal</option> 方式中启用 Ext3 可以提供最大的安全性（数据完整性），但因为要将元数据和数据都记入日记，所以可能会降低系统的速度。一个相对较新的方法是采用 <option>data=ordered</option> 方式，这种方式确保了数据和元数据的完整性，但只对元数据使用日记。文件系统驱动程序收集与一次元数据更新对应的所有数据块。这些数据块在更新元数据之前被写入磁盘中。这样，在不牺牲性能的情况下，元数据和数据的一致性得以实现。第三个可以使用的选项是 <option>data=writeback</option>，它允许在将某些数据的元数据提交给日记后，将这些数据写入主文件系统。在性能方面，此选项常被认为是最佳选项。但它在维护内部文件系统完整性的同时，允许以前的数据在系统崩溃并恢复后再次出现在文件中。Ext3 使用 <option>data=ordered</option> 选项作为默认值。 </para>
   </sect3>
   <sect3 id="sec.filesystems.major.ext22ext3">
    <title>将 Ext2 文件系统转换为 Ext3</title>
    <para>要将 Ext2 文件系统转换为 Ext3：</para>
    <procedure id="bgchzb5">
     <step id="bgchzb6" performance="required">
      <para>作为 <systemitem>root</systemitem> 用户运行 <command>tune2fs -j</command> 来创建 Ext3 日记。 </para>
      <para>此命令将用默认参数创建 Ext3 日记。</para>
      <para>要指定日记的大小和所驻留的设备，请改为运行 <command>tune2fs <option>-J</option></command>，同时使用所需的日记选项 <option>size=</option> 和 <option>device=</option>。<command>tune2fs</command> 手册页中有关于 <command>tune2fs</command> 程序的更多信息。</para>
     </step>
     <step id="bgchzb7" performance="required">
      <para>作为 <systemitem>root</systemitem> 用户编辑文件 <filename>/etc/fstab</filename>，以将为相应分区指定的文件系统类型从 <literal>ext2</literal> 更改为 <literal>ext3</literal>，然后保存更改。</para>
      <para>这确保可以正确识别出 Ext3 文件系统。此更改将在下次重引导后生效。</para>
     </step>
     <step id="bgchzb8" performance="required">
      <para>要引导设置为 Ext3 分区的根文件系统，请将模块 <literal>ext3</literal> 和 <literal>jbd</literal> 包含在 <filename>initrd</filename> 中。</para>
      <substeps performance="required">
       <step id="bi6z1gc" performance="required">
        <para>作为 <systemitem>root</systemitem> 编辑 <filename>/etc sysconfig/kernel</filename>，将 <literal>ext3</literal> 和 <literal>jbd</literal> 添加到 <envar>INITRD_MODULES</envar> 变量中，然后保存更改。</para>
       </step>
       <step id="bi6z1rw" performance="required">
        <para>运行 <command>mkinitrd</command> 命令。 </para>
        <para>这将构建一个新的 initrd，并准备使用它。</para>
       </step>
      </substeps>
     </step>
     <step id="bi6z29v" performance="required">
      <para>重引导系统。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="sec_fileystems_major_ext3inodesize">
    <title>Ext3 文件系统 inode 大小及 inode 数量</title>
    <para>inode 用于存储文件的相关信息及其在文件系统中的块位置。为了让 inode 有空间可以容纳扩展属性以及 ACL，Ext3 的默认 inode 大小从 SLES 10 上的 128 字节增加到了 SLES 11 上的 256 字节。与 SLES 10 相比，当您在 SLES 11 上新建 Ext3 文件系统时，为相同数量的 inode 预分配的默认空间量将翻倍，而该文件系统中文件的可用空间量便会相应减少。因此，要容纳与 SLES 10 上的 Ext3 文件系统中数量相同的 inode 和文件，您必须使用更大的分区。</para>
    <para>当您新建 Ext3 文件系统时，将根据可创建的 inode 总数量预分配 inode 表的空间。每 inode 的字节数比率以及文件系统的大小决定了可以创建的 inode 数量。建立文件系统时，将根据每 inode 字节数的单位空间创建 inode：</para>

<screen role="compact2">
number of inodes = total size of the file system divided by the number of bytes per inode
</screen>

    <para>inode 的数量控制着文件系统中可容纳的文件数：一个文件对应一个 inode。为解决 inode 大小增加而使可用空间变少的问题，每 inode 的字节数比率的默认值由 SLES 10 上的 8192 字节增加到了 SLES 11 上的 16384 字节。比率翻倍意味着可以创建的文件数量将只有 SLES 10 上 Ext3 文件系统中可容纳文件数量的一半。</para>
    <important>
     <para>inode 分配完毕后，将无法更改 inode 大小的设置或每 inode 的字节数比率。除非使用不同的设置重新创建文件系统或扩展文件系统，否则将无法创建新的 inode。超过 inode 最大数量时，只有删除部分文件才能在文件系统上创建新文件。</para>
    </important>
    <para>新建 Ext3 文件系统时，您可以指定 inode 大小和每 inode 的字节数比率，以控制文件系统上可容纳 inode 空间占用量以及文件数量。如果未指定块大小、inode 大小以及每 inode 的字节数比率值，则将应用 <filename>/etc/mked2fs.conf</filename> 中的默认值。有关信息，请参见 <filename>mke2fs.conf(5)</filename> 手册页。</para>
    <para>使用以下指标：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b14jepus">
       <title>inode 大小：</title>
       <para>默认的 inode 大小为 256 字节。指定字节值，即介于 128 字节（含）到块大小（含）之间的 2 的乘方值，如 128、256、512，以此类推。只有当 Ext3 文件系统上不使用扩展属性或 ACL 时才可使用 128 字节。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b14jeput">
       <title>每 inode 的字节数比率：</title>
       <para>默认的每 inode 的字节数比率为 16384 字节。有效的每 inode 的字节数比率值必须是大于等于 1024 字节的 2 的乘方值，如 1024、2048、4096、8192、16384、32768，以此类推。该值不应小于文件系统的块大小，因为块大小是用于存储数据的最小空间大块。Ext3 文件系统默认的块大小为 4 KB。 </para>
      </formalpara>
      <para>此外，您还应考虑文件的数量以及需要存储的文件大小。例如，如果您的文件系统上将会有许多小文件，则可以指定一个较小的每 inode 的字节数比率，这样会增加 inode 的数量。如果您的文件系统上将会有很大的文件，则可以指定一个较大的每 inode 的字节数比率，这样会减少 inode 的数量。 </para>
      <para>通常情况下，最好要保证有足够多的 inode 可供使用。如果 inode 数量过少且文件很小，则可能当磁盘上的文件数量已达最大值时实际上磁盘却还很空。如果 inode 过多且文件很大，则可能虽然报告仍有可用空间，但却无法使用，这是因为您无法在为 inode 预留的空间中新建文件。</para>
     </listitem>
    </itemizedlist>
    <para>如果您在 Ext3 文件系统上不使用扩展属性或 ACL，则在创建文件系统时可通过将 inode 大小指定为 128 字节，并将每 inode 的字节数比率指定为 8192 字节，来恢复到 SLES 10 行为。使用以下任何一种方法设置 inode 大小以及每 inode 的字节数比率：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b14irnj5">
       <title>更改所有新的 Ext3 文件的默认设置：</title>
       <para>在文本编辑器中，修改 <filename>/etc/mke2fs.conf</filename> 文件的 <literal>defaults</literal> 部分，以为 <literal>inode_size</literal> 和 <literal>inode_ratio</literal> 设置所需的默认值。这些值将应用到所有新的 Ext3 文件系统。例如：</para>
      </formalpara>

<screen>
blocksize = 4096
inode_size = 128
inode_ratio = 8192
</screen>

     </listitem>
     <listitem>
      <formalpara id="b14irnj6">
       <title>在命令行处：</title>
       <para>新建 Ext3 文件系统时，将 inode 大小 (<literal>-I 128</literal>) 以及每 inode 的字节数比率 (<literal>-i 8192</literal>) 传递给 <command>mkfs.ext3(8)</command> 命令或 <command>mke2fs(8)</command> 命令。例如，使用以下任一命令：</para>
      </formalpara>

<screen>
mkfs.ext3 -b 4096 -i 8092 -I 128 /dev/sda2

mke2fs -t ext3 -b 4096 -i 8192 -I 128 /dev/sda2
</screen>

     </listitem>
     <listitem>
      <formalpara id="b12dp9td">
       <title>在使用 YaST 安装期间：</title>
       <para>在安装期间，新建 Ext3 文件系统时要传递 inode 大小和每 inode 的字节数比率值。在<guimenu>格式化选项</guimenu>下的<guimenu>编辑分区</guimenu>页面的 YaST 分区程序中，选择<guimenu>格式化分区</guimenu><guimenu>Ext3</guimenu>，然后单击<guimenu>选项</guimenu>。从<guimenu>文件系统选项</guimenu>对话框中的<guimenu>块字节大小</guimenu>、<guimenu>每 inode 的字节数</guimenu>以及 <guimenu>inode 大小</guimenu>下拉列表中，选择所需的值。</para>
      </formalpara>
      <para>例如，在<guimenu>块字节大小</guimenu>下拉列表中选择 4096、在<guimenu>每 inode 的字节数</guimenu>下拉列表中选择 8192、在 <guimenu>inode 大小</guimenu>下拉列表中选择 128，然后单击<guimenu>确定</guimenu>。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="ext3_inode_yast_a.png" width="305pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
     <listitem>
      <formalpara id="b12dpiab">
       <title>在使用 autoyast 安装期间：</title>
       <para>在 autoyast 配置文件中，您可以使用 <literal>fs_options</literal> 选项卡来设置 <literal>opt_bytes_per_inode</literal> 比率值 (-i 8192) 以及 <literal>opt_inode_density</literal> 值 (-I 128)：</para>
      </formalpara>

<screen>
&lt;partitioning config:type="list"&gt;
    &lt;drive&gt;
      &lt;device&gt;/dev/sda&lt;/device&gt;
      &lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext3&lt;/filesystem&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;fs_options&gt;
            &lt;opt_bytes_per_inode&gt;
              &lt;option_str&gt;-i&lt;/option_str&gt;
              &lt;option_value&gt;8192&lt;/option_value&gt;
            &lt;/opt_bytes_per_inode&gt;
            &lt;opt_inode_density&gt;
              &lt;option_str&gt;-I&lt;/option_str&gt;
              &lt;option_value&gt;128&lt;/option_value&gt;
            &lt;/opt_inode_density&gt;
          &lt;/fs_options&gt;
          &lt;mount&gt;/&lt;/mount&gt;
          &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
          &lt;partition_type&gt;primary&lt;/partition_type&gt;
          &lt;size&gt;25G&lt;/size&gt;
        &lt;/partition&gt;
</screen>

     </listitem>
    </itemizedlist>
    <para>有关信息，请参见<ulink url="http://www.novell.com/support/kb/doc.php?id=7009075"><citetitle> SLES11 ext3 分区仅可储存 SLES10 上可容纳文件一半数量的文件</citetitle> [技术信息文档 7009075]</ulink>。</para>
   </sect3>
  </sect2>
  <sect2 id="sec_filesystems_major_reiser">
   <title>ReiserFS</title>
   <para>作为 2.4 内核版本的正式的重要功能之一，ReiserFS 作为 2.2.x SUSE 内核的内核增补程序提供，因为版本 6.4 的 ReiserFS 是由 Hans Reiser 和 Namesys 开发团队设计的。ReiserFS 已证明它自己是 Ext2 功能强大的替代系统。其重要资产是通过数据日记实现的更高的磁盘空间利用率、更佳的磁盘访问性能、更快的崩溃恢复功能和可靠性。</para>
   <important>
    <para>在专为迁移目的设计的 SUSE Linux Enterprise Server 11 的生命周期中，完全支持 ReiserFS 文件系统。SUSE 计划从 SUSE Linux Enterprise Server 12 开始不再支持创建新的 ReiserFS 文件系统。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzav" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzaw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzax" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzay" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bgchzav">
    <title>更高的磁盘空间利用率</title>
    <para>在 ReiserFS 中，采用一种名为 B* 平衡树 (B*-balanced tree) 的结构组织所有数据。这种树结构有助于提高磁盘空间的利用率，这是因为可以将小文件直接储存在 B* 树叶节点而不是其他位置，并且只维护一个指向实际磁盘位置的指针。此外，不按照 1 KB 或 4 KB 的大块来分配储存区，而是根据所需的准确大小进行。另一个优点是 inode 的动态分配。这使得此文件系统比传统的文件系统（例如 Ext2）更灵活，而传统文件系统中的 inode 密度必须在创建文件系统时指定。 </para>
   </sect3>
   <sect3 id="bgchzaw">
    <title>更佳的磁盘访问性能</title>
    <para>对于小文件，文件数据和 <quote>stat_data</quote> (inode) 信息经常被储存在相邻的位置。这样通过一个磁盘 I/O 操作就可以访问它们，这意味着只需访问磁盘一次就可以检索到所有需要的信息。 </para>
   </sect3>
   <sect3 id="bgchzax">
    <title>更快的崩溃恢复速度</title>
    <para>使用日记来跟踪最近的元数据更改使对文件系统的检查可以很快完成，即使对大型文件系统也是如此。 </para>
   </sect3>
   <sect3 id="bgchzay">
    <title>通过数据日记确保可靠性</title>
    <para>ReiserFS 还支持与<xref linkend="sec_filesystems_major_ext3" xrefstyle="HeadingOnPage"/>中介绍过的概念类似的数据日记和有序数据模式。默认方式是 <literal>data=ordered</literal>，它确保了数据和元数据的完整性，但只对元数据使用日记。 </para>
   </sect3>
  </sect2>
  <sect2 id="sec_filesystems_major_xfs">
   <title>XFS</title>
   <para>SGI 在 20 世纪 90 年代初开始开发 XFS，最初计划将 XFS 作为 IRIX OS 的文件系统。开发 XFS 的目的是创建一个高性能的 64 位日记文件系统来满足对计算能力的极高要求。XFS 适合操纵大型文件，在高端硬件上表现优异。但即使是 XFS 也有缺点。与 ReiserFS 类似，XFS 非常注重元数据的完整性，但不太注重数据的完整性。</para>
   <para>快速回顾 XFS 的关键功能可解释为什么此文件系统经证明在高端计算方面是其他日记文件系统的强大竞争对手。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzba" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzbb" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzbc" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bgchzba">
    <title>通过使用分配组实现高伸缩性</title>
    <para>在创建 XFS 文件系统时，文件系统底层的块设备被分成 8 个或 8 个以上相同大小的线性区域。这些线性区域被称为<emphasis>分配组</emphasis>。每个分配组管理自己的 inode 和可用空间。实际上，可以将分配组看作文件系统中的文件系统。因为分配组相互独立，所以内核可同时对多个分配组进行寻址。此功能是 XFS 优异的可伸缩性关键之所在。独立分配组的概念自然适合多处理器系统的需要。 </para>
   </sect3>
   <sect3 id="bgchzbb">
    <title>通过有效管理磁盘空间获得高性能</title>
    <para>可用空间和 inode 是由分配组内的 B<superscript>+</superscript> 树处理的。使用 B<superscript>+</superscript> 树将大大增强 XFS 的性能和可伸缩性。XFS 使用<emphasis>延迟分配</emphasis>，它可以通过将进程分为两部分而处理分配。将挂起事务储存在 RAM 中并保留适当数量的空间。XFS 仍不决定应储存数据的准确位置（即不指出文件系统块）。此决定将被延迟到最后的时刻。某些生存期很短的临时数据可能永远不会被储存到磁盘上，这是因为在 XFS 决定保存它们的实际位置时，这些数据可能已经过时了。以这种方式，XFS 增强了写性能并减少了文件系统分段。因为延迟分配引起写事件的频率比其他文件系统引起写事件的频率要低，所以如果写操作期间发生系统崩溃，则数据丢失可能会更加严重。 </para>
   </sect3>
   <sect3 id="bgchzbc">
    <title>进行预分配以避免文件系统碎片</title>
    <para>在将数据写入文件系统前，XFS <emphasis>保留</emphasis>（预分配）文件所需的可用空间。这样会大大减少文件系统碎片的数目。因为文件的内容不会分散在整个文件系统中，所以性能得以提高。 </para>
   </sect3>
  </sect2>
  <sect2 id="bwkryet">
   <title>文件系统功能比较</title>
   <para>有关对 SUSE Linux Enterprise Server 中主要操作系统功能的一一对比，请参见 <ulink url="http://www.suse.com/products/server/technical-information/">SUSE Linux Enterprise Server 技术信息网站</ulink>上的<ulink url="http://www.suse.com/products/server/technical-information/#FileSystem">文件系统支持和大小</ulink>。</para>
  </sect2>
 </sect1>
 <sect1 id="sec_filesystems_add">
  <title>支持的其他文件系统</title>
  <para role="intro"><xref linkend="tab.dateisysteme" xrefstyle="TableXRef"/>对 linux 支持的其他一些文件系统进行了总结。支持这些文件系统主要是为了确保与不同类型的媒体或异操作系统实现兼容和数据交换。</para>
  <table id="tab.dateisysteme" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <title>Linux 中的文件系统类型</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="2381*"/>
   <colspec colnum="2" colname="2" colwidth="7620*"/>
    <thead>
     <row id="bi6z95b">
      <entry>
       <para>文件系统类型</para>
      </entry>
      <entry>
       <para>描述</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="bwk81ba">
      <entry>
       <para><systemitem>cramfs</systemitem></para>
      </entry>
      <entry>
       <para>压缩的 ROM 文件系统：一种经压缩的只读 ROM 文件系统。</para>
      </entry>
     </row>
     <row id="bwk81bb">
      <entry>
       <para><systemitem>hpfs</systemitem></para>
      </entry>
      <entry>
       <para>高性能文件系统：IBM OS/2 标准文件系统。只在只读模式下支持。</para>
      </entry>
     </row>
     <row id="bwk81bc">
      <entry>
       <para><systemitem>iso9660</systemitem></para>
      </entry>
      <entry>
       <para>CD-ROM 上的标准文件系统。</para>
      </entry>
     </row>
     <row id="bwk81bd">
      <entry>
       <para><systemitem>minix</systemitem></para>
      </entry>
      <entry>
       <para>此文件系统源自有关操作系统的学术项目，是在 Linux 中使用的第一个文件系统。目前，它被用作软盘的文件系统。</para>
      </entry>
     </row>
     <row id="bwk81be">
      <entry>
       <para><systemitem>msdos</systemitem></para>
      </entry>
      <entry>
       <para><filename>fat</filename>（最初由 DOS 使用的文件系统）现在已被多种操作系统采用。</para>
      </entry>
     </row>
     
     
     <row id="bwk81bg">
      <entry>
       <para><systemitem>nfs</systemitem></para>
      </entry>
      <entry>
       <para>网络文件系统：在此文件系统中，可以将数据储存在网络中的任何计算机上，并可以通过网络授予访问权限。</para>
      </entry>
     </row>
     <row id="bwk81bh">
      <entry>
       <para><systemitem>ntfs</systemitem></para>
      </entry>
      <entry>
       <para>Windows NT 文件系统；只读。</para>
      </entry>
     </row>
     <row id="bwk81bi">
      <entry>
       <para><systemitem>smbfs</systemitem></para>
      </entry>
      <entry>
       <para>Windows 等产品使用服务器消息块来支持通过网络启用文件访问。</para>
      </entry>
     </row>
     <row id="bwk81bj">
      <entry>
       <para><systemitem>sysv</systemitem></para>
      </entry>
      <entry>
       <para>在 SCO UNIX、Xenix 和 Coherent（用于个人电脑的商用 UNIX 系统）上使用。</para>
      </entry>
     </row>
     <row id="bwk81bk">
      <entry>
       <para><systemitem>ufs</systemitem></para>
      </entry>
      <entry>
       <para>供 BSD、SunOS 和 NextStep 使用。只在只读方式下支持此文件系统。</para>
      </entry>
     </row>
     <row id="bwk81bl">
      <entry>
       <para><systemitem>umsdos</systemitem></para>
      </entry>
      <entry>
       <para>MS-DOS 上的 UNIX：在标准 <filename>fat</filename> 文件系统之上应用，通过创建特殊文件获得 UNIX 功能（权限、链接和长文件名）。</para>
      </entry>
     </row>
     <row id="bwk81bm">
      <entry>
       <para><systemitem>vfat</systemitem></para>
      </entry>
      <entry>
       <para>虚拟 FAT：<literal>fat</literal> 文件系统的扩展（支持长文件名）。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </sect1>
 <sect1 id="sec_filesystems_lfs">
  <title>Linux 中对大型文件的支持</title>
  <para>最初，Linux 支持的最大文件大小为 2 GiB（2<superscript>31</superscript> 字节）。除非文件系统支持大型文件，否则 32 位系统上的最大文件大小为 2 GiB。 </para>
  <para>目前，所有标准文件系统都具有 LFS（大型文件支持）功能，理论上可支持的最大文件大小为 2<superscript>63</superscript> 字节。<xref linkend="tab.maxsize" xrefstyle="TableXRef"/>概述了 Linux 文件和文件系统的当前磁盘上格式的限制。表中的数字基于文件系统使用 4 KiB 块大小的假设得出，这是通用的标准。使用不同的块大小，结果也就不同。使用较稀疏的块时，<xref linkend="tab.maxsize" xrefstyle="TableXRef"/>中的最大文件大小可能会大于文件系统的实际大小。 </para>
  <note>
   <para>在此文档中：1024 字节 = 1 KiB；1024 KiB = 1 MiB；1024 MiB = 1 GiB；1024 GiB = 1 TiB；1024 TiB = 1 PiB；1024 PiB = 1 EiB（另请参见 <ulink url="http://physics.nist.gov/cuu/Units/binary.html"><citetitle>NIST：二进制倍数的前缀</citetitle></ulink>）。</para>
  </note>
  <table id="tab.maxsize" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
   <title>文件和文件系统的最大大小（磁盘格式，4 KiB 块大小)</title>
   <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="3334*"/>
   <colspec colnum="2" colname="2" colwidth="3334*"/>
   <colspec colnum="3" colname="3" colwidth="3334*"/>
    <thead>
     <row id="b12r1f2q">
      <entry>
       <para>文件系统（4 KiB 块大小）</para>
      </entry>
      <entry>
       <para>最大文件系统大小</para>
      </entry>
      <entry>
       <para>最大文件大小</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="b12r1f2r">
      <entry>
       <para>Btrfs</para>
      </entry>
      <entry>
       <para>16 EiB</para>
      </entry>
      <entry>
       <para>16 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2s">
      <entry>
       <para>Ext3</para>
      </entry>
      <entry>
       <para>16 TiB</para>
      </entry>
      <entry>
       <para>2 TiB</para>
      </entry>
     </row>
     <row id="b12r1f2t">
      <entry>
       <para>OCFS2（高可用性扩展中可使用的集群感知文件系统）</para>
      </entry>
      <entry>
       <para>16 TiB</para>
      </entry>
      <entry>
       <para>1 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2u">
      <entry>
       <para>ReiserFS v3.6</para>
      </entry>
      <entry>
       <para>16 TiB</para>
      </entry>
      <entry>
       <para>1 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2v">
      <entry>
       <para>XFS</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2w">
      <entry>
       <para>NFSv2（客户端）</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
      <entry>
       <para>2 GiB</para>
      </entry>
     </row>
     <row id="b12r1f2x">
      <entry>
       <para>NFSv3（客户端）</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
  <important>
   <para><xref linkend="tab.maxsize" xrefstyle="TableXRef"/>介绍了有关磁盘上格式的限制。 Linux 内核自身的大小限制同样适用于其处理的文件和文件系统大小。下面介绍了这些限制： </para>
   <variablelist>
    <varlistentry id="bgchzc6">
     <term>文件大小</term>
     <listitem>
      <para>在 32 位系统上，文件不能超过 2 TiB（2<superscript>41</superscript> 字节）。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchzc7">
     <term>文件系统大小</term>
     <listitem>
      <para>文件系统最大可以为 2<superscript>73</superscript> 个字节。但是，目前可用的硬件尚不会超出这一限制。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </important>
 </sect1>
 <sect1 id="sect_stor_limits">
  <title>Linux 内核储存的限制</title>
  <para><xref linkend="b12o27j6" xrefstyle="TableXRef"/>总结了对于 SUSE Linux Enterprise 11 SP3 关联储存的内核限制。 </para>
  <table id="b12o27j6" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
   <title>储存限制</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="5001*"/>
   <colspec colnum="2" colname="2" colwidth="5001*"/>
    <thead>
     <row id="b12o27j7">
      <entry>
       <para>储存功能</para>
      </entry>
      <entry>
       <para>限制</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="b12o27j8">
      <entry>
       <para>支持的 LUN 最大数量</para>
      </entry>
      <entry>
       <para>每个目标 16384 个 LUN。</para>
      </entry>
     </row>
     <row id="b12o27j9">
      <entry>
       <para>每一个单独 LUN 的最大路径数量</para>
      </entry>
      <entry>
       <para>本身没有限制。每个路径视作一个常规 LUN。</para>
       <para>每个目标的 LUN 数量以及每个 HBA 的目标数量决定了实际的限制（光纤通道 HBA 为 16777215）。</para>
      </entry>
     </row>
     <row id="b12o27ja">
      <entry>
       <para>HBA 的最大数量</para>
      </entry>
      <entry>
       <para>不限。实际限制取决于系统的 PCI 槽的数量。</para>
      </entry>
     </row>
     <row id="b12o27jb">
      <entry>
       <para>每个操作系统使用 device-mapper-multipath 的最大路径数量（总计）</para>
      </entry>
      <entry>
       <para>大约为 1024。实际数量取决于设备号字符串的长度。这是 multipath-tools 中的一个编译时期变量，如果该限制会导致出现问题，则可相应提高限制值。</para>
      </entry>
     </row>
     <row id="b12r1mnq">
      <entry>
       <para>每一个块设备的最大大小</para>
      </entry>
      <entry>
       <para>如果是 X86，则最大大小为 16 TiB。</para>
       <para>如果是 x86_64、ia64、s390x 和 ppc64，则最大大小是 8 EiB。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </sect1>
 <sect1 id="bwkbhpd">
  <title>用 YaST 分区程序管理设备</title>
  <para>您可以使用 YaST 分区程序创建和管理文件系统和 RAID 设备。有关信息，请参见<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html">《<citetitle>SUSE Linux Enterprise Server 11 SP3 部署指南</citetitle>》</ulink>中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/cha_advdisk.html"><quote>高级磁盘设置</quote></ulink>。</para>
 </sect1>
 <sect1 id="sec_filesystems_info">
  <title>其他信息</title>
  <para>上面介绍的每个文件系统项目都有自己的主页，可以在其中找到邮件列表信息、更多文档和常见问题：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="http://e2fsprogs.sourceforge.net/"><citetitle>E2fsprogs: Ext2/3/4 File System Utilities</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://www.ibm.com/developerworks/linux/library/l-fs7/"><citetitle>Introducing Ext3</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://oss.sgi.com/projects/xfs/"><citetitle>XFS: A High-Performance Journaling Filesytem</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://oss.oracle.com/projects/ocfs2/"><citetitle>OCFS2 Project</citetitle></ulink></para>
   </listitem>
  </itemizedlist><?dbfo-need height="20em"?>


  <para>关于 Linux 文件系统的综合多部分教程可以在 IBM developerWorks 的 <ulink url="https://www.ibm.com/developerworks/linux/library/l-fs/"><citetitle>Advanced File System Implementor’s Guide</citetitle></ulink> 中找到。 </para>
  <para>有关各种文件系统（不仅仅是 Linux 文件系统）的深入比较信息在 Wikipedia 项目的 <ulink url="http://en.wikipedia.org/wiki/Comparison_of_file_systems#Comparison"><citetitle>Comparison of File Systems</citetitle></ulink>（文件系统比较）中提供。 </para>
 </sect1>
</chapter>

<chapter id="storwhatsnew" lang="en" xml:base="01_whatsnew.xml">
 <title>SLES 11 中的储存的新功能</title>
 <para>本章中提及的功能和行为更改是针对 SUSE Linux Enterprise Server 11 进行的。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="new_sles11sp3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkb7my" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndgyod" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndgyoe" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="new_sles11sp3">
  <title>SLES 11 SP3 中的新增功能</title>
  <para>除了 bug 修复外，本部分中的功能和行为更改是针对 SUSE Linux Enterprise Server 11 SP3 版本进行的：</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b15ds08f" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08d" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08c" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08e" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b15ds08f">
   <title>Btrfs 定额</title>
   <para><command>btrfs(8)</command> 命令中已添加 <systemitem>root</systemitem> 文件系统上的 Btrfs 子卷定额支持。</para>
  </sect2>
  <sect2 id="b15ds08d">
   <title>iSCSI LIO 目标服务器</title>
   <para>YaST 支持 iSCSI LIO 目标服务器软件。有关信息，请参阅<xref linkend="cha_iscsi_lio" xrefstyle="ChapTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="b15ds08c">
   <title>Linux 软件 RAID</title>
   <para>增加了以下针对 Linux 软件 RAID 的增强功能：</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jy5sx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy5sy" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy5sz" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15jy5sx">
    <title>Intel RSTe+ 支持</title>
    <para>软件 RAID 改进了对 Intel RSTe+ (Rapid Storage Technology Enterprise) 平台的支持，以支持 RAID 级别 0、1、4、5、6 和 10。</para>
   </sect3>
   <sect3 id="b15jy5sy">
    <title>LEDMON 实用程序</title>
    <para>LEDMON 实用程序支持 MD 软件 RAID 的 PCIe-SSD 机箱 LED。有关信息，请参阅<xref linkend="cha_raids_lee" xrefstyle="ChapTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="b15jy5sz">
    <title>软件 RAID 中的设备顺序</title>
    <para>在 YaST 分区程序的<guimenu>添加 RAID</guimenu> 向导中，您可以使用<guimenu>分类</guimenu>选项指定 Linux 软件 RAID 中所选设备的使用顺序，以确保一半阵列驻留在一个磁盘子系统中，另外一半阵列驻留在另一个磁盘子系统中。例如，如果一个磁盘子系统出现故障，则系统仍可以通过第二个磁盘子系统继续运行。有关信息，请参见<xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/>中的<xref linkend="b14dtk77" xrefstyle="StepXRef"/>。</para>
   </sect3>
  </sect2>
  <sect2 id="b15ds08g">
   <title>LVM2</title>
   <para>增加了以下针对 LVM2 的增强功能：</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jy33d" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy33e" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15jy33d">
    <title>瘦池和瘦卷</title>
    <para>可以对 LVM 逻辑卷进行精简配置。有关信息，请参见<xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/>。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b15jy6mq">
       <title>瘦池︰</title>
       <para>逻辑卷是预留供瘦卷使用的空间池。瘦卷可以按需从瘦池分配它们所需的空间。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b15jy6mr">
       <title>瘦卷︰</title>
       <para>该卷会被创建为稀疏卷。瘦卷会按需从瘦池分配所需的空间。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="b15jy33e">
    <title>瘦快照</title>
    <para>可以对 LVM 逻辑卷快照进行精简配置。如果您创建快照时未指定大小，系统会使用瘦配置。有关信息，请参见<xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
  </sect2>
  <sect2 id="b15ds08e">
   <title>Multipath I/O</title>
   <para>对多路径 I/O 进行了如下更改和改进：</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jxva2" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jxva1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jxva0" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15jxva2">
    <title>mpathpersist(8)</title>
    <para>新推出了 <command>mpathpersist(8)</command> 实用程序。该实用程序可用来管理设备映射程序多路径设备上的 SCSI 永久保留。有关信息，请参见<xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="b15jxva1">
    <title>multipath(8)</title>
    <para>针对 <command>multipath(8)</command> 命令增加了以下增强功能：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>您可以使用 <literal>-r</literal> 选项强制重新装载设备映射。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="b15jxva0">
    <title>/etc/multipath.conf</title>
    <para>设备映射程序 - 多路径工具针对 <filename>/etc/multipath.conf</filename> 文件增加了以下增强功能：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b15jxy6m" role="intro">
       <title>udev_dir</title>
       <para/>
      </formalpara>
      <para>已弃用 <literal>udev_dir</literal> 属性。升级到 SLES 11 SP3 之后，您可以从 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults</literal> 部分删除下面的行：</para>

<screen>
udev_dir /dev
</screen>

     </listitem>
     <listitem>
      <formalpara id="b15jxy6n" role="intro">
       <title>getuid_callout</title>
       <para/>
      </formalpara>
      <para>在 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults</literal> 部分已弃用 <literal>getuid_callout</literal> 属性，取而代之的是 <literal>uid_attribute</literal> 参数。该参数是一个 udev 属性，提供唯一的路径标识符。默认值为 <literal>ID_SERIAL</literal>。</para>
      <para>升级到 SLES 11 SP3 之后，您可以修改 <filename>/etc/multipath.conf</filename> 文件 <literal>defaults</literal> 部分中的属性： </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>从 <literal>defaults</literal> 部分删除下面的行：</para>

<screen>
  getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

       </listitem>
       <listitem>
        <para>将下行添加到 <literal>defaults</literal> 部分：</para>

<screen>
  uid_attribute "ID_SERIAL"
</screen>

       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <formalpara id="b15jxy6o" role="intro">
       <title>path_selector</title>
       <para/>
      </formalpara>
      <para>在 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults</literal> 部分，<literal>path_selector</literal> 属性的默认值从 <literal>"round-robin 0"</literal> 更改为 <literal>"service-time 0"</literal>。<literal>service-time</literal> 选项会根据路径的未完成 I/O 量及路径相应的吞吐量来为下一批 I/O 选择路径。 </para>
      <para>升级到 SLES 11 SP3 之后，您可以将 <filename>/etc/multipath.conf</filename> 文件 <literal>defaults</literal> 部分中的属性值修改为建议采用的默认值： </para>

<screen>
  path_selector "service-time 0"
</screen>

     </listitem>
     <listitem>
      <formalpara id="b15jxy6p" role="intro">
       <title>user_friendly_names</title>
       <para/>
      </formalpara>
      <para>可以在 <literal>devices</literal> 和 <literal>multipaths</literal> 部分配置 <literal>user_friendly_names</literal> 属性。</para>
     </listitem>
     <listitem>
      <formalpara id="b15jxy6q" role="intro">
       <title>max_fds</title>
       <para/>
      </formalpara>
      <para role="intro"><literal>max_fds</literal> 属性的默认设置已更改为 <literal>max</literal>。如此，多路径守护程序便可在监控路径时打开系统所允许的最大文件描述符数量。 </para>
      <para role="intro">升级到 SLES 11 SP3 之后，您可以在 <filename>/etc/multipath.conf</filename> 文件中修改该属性值： </para>

<screen>
max_fds "max"
</screen>

     </listitem>
     <listitem>
      <formalpara id="b15jxy6r" role="intro">
       <title>reservation_key</title>
       <para/>
      </formalpara>
      <para role="intro"><filename>/etc/multipath.conf</filename> 文件 <literal>defaults</literal> 或 <literal>multipaths</literal> 部分中的 <literal>reservation_key</literal> 属性可用于指派一个服务操作保留密钥。<command>mpathpersist(8)</command> 实用程序会使用服务操作保留密钥来管理设备映射程序多路径设备的永久保留。默认情况下不会使用该属性。如果未设置该属性，<command>multipathd</command> 守护程序不会检查新发现的路径或已重新启用的路径的永久保留。 </para>

<screen>
reservation_key &lt;<replaceable>reservation key</replaceable>&gt;
</screen>

      <para>例如：</para>

<screen>
multipaths {
        multipath {
                          wwid   XXXXXXXXXXXXXXXX
                         alias      yellow
                         reservation_key  0x123abc
      }
}
</screen>

      <para> 有关设置永久保留的信息，请参见<xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
     <listitem>
      <formalpara id="b15jxy6s" role="intro">
       <title>hardware_handler</title>
       <para/>
      </formalpara>
      <para>在 SCSI 层中增加了四个 SCSI 硬件处理程序，它们可与 DM-Multipath 结合使用： </para>
      <simplelist>
       <member><filename>scsi_dh_alua</filename> </member> <member><filename>scsi_dh_rdac</filename> </member> <member><literal>scsi_dh_hp_sw</literal> </member> <member><literal>scsi_dh_emc</literal> </member>
      </simplelist>
      <para>这些处理程序是在 Linux 内核的 SCSI 目录下创建的模块。以前使用“设备映射程序”层中的硬件处理程序。</para>
      <para>将模块添加到 <filename>initrd</filename> 映像，然后在 <filename>/etc/multipath.conf</filename> 文件中将它们指定为 <literal>alua</literal>、<literal>rdac</literal>、<literal>hp_sw</literal> 和 <literal>emc</literal> 硬件处理程序类型。有关向 <filename>initrd</filename> 映像中添加设备驱动程序的信息，请参见<xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="bwkb7my">
  <title>SLES 11 SP2 中的新增功能</title>
  <para>除了 bug 修复外，本部分中的功能和行为更改是针对 SUSE Linux Enterprise Server 11 SP2 版本进行的：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>Btrfs 文件系统。请参见<xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>开放以太网光纤通道。请参见<xref linkend="cha_fcoe" xrefstyle="ChapTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>标记 LVM 储存对象。请参见<xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>NFSv4 ACL 工具。请参见<xref linkend="nfsv4acls" xrefstyle="ChapTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para><command>mdadm resize</command> 命令的 <command>--assume-clean</command> 选项。请参见<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>在 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults</literal> 部分，已不再使用 <literal>default_getuid</literal> 参数，取而代之的是 <literal>getuid_callout</literal> 参数：</para>
    <para>该行已从</para>

<screen>
  default_getuid "/sbin/scsi_id -g -u -s /block/%n"
</screen>

    <para>更改为</para>

<screen>
  getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 id="bndgyod">
  <title>SLES 11 SP1 中的新增功能</title>
  <para>除了 bug 修复，本部分中提及的功能和行为更改是针对 SUSE Linux Enterprise Server 11 SP1 版本进行的。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bnmqoyw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmr1a1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmqre5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmti6z" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtvr8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmrccr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmrfnk" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtwna" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmss2g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmszsy" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtqql" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bnmqoyw">
   <title>保存 iSCSI 目标信息</title> 
   <para>在 <link linkend="sec_inst_system_iscsi_target_yast"><guimenu>YaST</guimenu><guimenu>网络服务</guimenu><guimenu>iSCSI 目标</guimenu></link>功能中，添加了<guimenu>保存</guimenu>选项，允许您导出 iSCSI 目标信息。这使得向资源使用方提供此信息变得更容易。</para>
  </sect2>
  <sect2 id="bnmr1a1">
   <title>在 iSCSI 发起程序中修改身份验证参数</title> 
   <para>在 <link linkend="sec_inst_system_iscsi_target_yast"><guimenu>YaST</guimenu><guimenu>网络服务</guimenu><guimenu>iSCSI 发起程序</guimenu></link>功能中，您可以修改用于连接到目标设备的身份验证参数。以前，您需要删除此项并重创建它，才能更改身份验证信息。</para>
  </sect2>
  <sect2 id="bnmqre5">
   <title> 允许永久保留 MPIO 设备</title> 
   <para>SCSI 发起程序可以发出共享储存设备的 SCSI 保留命令，这将禁止其他服务器上的 SCSI 发起程序访问此设备。此类保留在作为 SCSI 异常处理进程的一部分而执行的 SCSI 重设置期间仍然有效。</para>
   <para>在以下情况下，SCSI 保留将很有用：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para> 在简单 SAN 环境中，永久 SCSI 保留有助于避免在试图将已由一台服务器使用的 LUN 添加到另一台服务器时出现管理员错误，否则可能导致数据损坏。SAN 分区通常用于防止此类错误。 </para>
    </listitem>
    <listitem>
     <para>在具有故障转移设置的高可用性环境中，永久 SCSI 保留有助于防止将错误的服务器连接到已由其他服务器保留的 SCSI 设备。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bnmti6z">
   <title>MDADM 3.0.2</title> 
   <para>使用最新版本的 Multiple Devices Administration（MDADM，<command>mdadm</command>）实用程序可利用 bug 修复和改进功能。</para>
  </sect2>
  <sect2 id="bnmtvr8">
   <title>MDRAID 外部元数据的引导加载程序支持</title> 
   <para>新增支持以使用 MDADM 实用程序版本 3.0 的外部元数据功能从由 Intel Matrix Storage Technology 元数据格式定义的 RAID 卷安装和运行操作系统。这将功能从 Device Mapper RAID (DMRAID) 基础结构移至 Multiple Devices RAID (MDRAID) 基础结构，从而提供了更成熟的 RAID 5 实施以及更广泛的 MD 内核基础结构功能集。它允许通用 RAID 驱动程序以各种元数据格式使用，包括 Intel、DDF（通用 RAID 磁盘数据格式）和本机 MD 元数据。</para>
  </sect2>
  <sect2 id="bnmrccr">
   <title>MDRAID 外部元数据的 YaST 安装和引导支持</title> 
   <para> YaST 安装程序工具新增了对 RAID 0、1、10、5 和 6 的 MDRAID 外部元数据的支持。安装程序可以检测 RAID 阵列并检测是否已启用平台 RAID 功能。如果在适用于 Intel Matrix Storage Manager 的平台 BIOS 中已启用多路径 RAID，则安装程序将提供选项 DMRAID、MDRAID（推荐）或无。还修改了 <filename>initrd</filename> 以支持汇编基于 BIOS 的 RAID 阵列。 </para>
  </sect2>
  <sect2 id="bnmrfnk">
   <title>针对包含根文件系统的 MDRAID 阵列改进了关闭功能</title>  
   <para>已修改关闭脚本以等待所有 MDRAID 阵列均标记为清洁。操作系统关闭进程现在将等待坏位 (dirty-bit) 清除，直到所有 MDRAID 卷均已完成写操作。 </para>
   <para>已更改启动脚本、关闭脚本和 <command>initrd</command>，以考虑根 (<filename>/</filename>) 文件系统（包含操作系统和应用程序文件的系统卷）是否驻留在软件 RAID 阵列上。阵列的元数据处理程序在关闭进程中启动较早，以监视关闭期间的最终根文件系统环境。此处理程序已从常规 <command>killall</command> 事件中排除。此进程还允许在关闭结束时使写入操作静默化并清除阵列的元数据坏位（指示阵列是否需要重新同步）。</para>
  </sect2>
  <sect2 id="bnmtwna">
   <title>通过 iSCSI 设备配置 MD</title> 
   <para>YaST 安装程序现在允许通过 iSCSI 设备配置 MD。 </para>
   <para>如果引导时需要 RAID 阵列，则将在 <filename>boot.md</filename> 之前装载 iSCSI 发起程序软件，以使 iSCSI 目标可针对 RAID 进行自动配置。</para>
   <para>对于全新安装，Libstorage 将创建一个 <filename>/etc/mdadm.conf</filename> 文件并添加行 <literal>AUTO -all</literal>。更新期间，不会添加此行。如果 <filename>/etc/mdadm.conf</filename> 包含此行， </para>

<screen>
AUTO -all
</screen>

   <para>那么不会自动汇编任何 RAID 阵列，除非将它们显式列于 <filename>/etc/mdadm.conf</filename> 中。</para>
  </sect2>
  <sect2 id="bnmss2g">
   <title>MD-SGPIO</title> 
   <para>MD-SGPIO 实用程序是用于通过 <command>sysfs(2)</command> 监视 RAID 阵列的独立应用程序。事件会触发 LED 更改请求，该请求控制与外围设备中的每个槽或储存子系统的驱动器机架相关的 LED 灯的闪烁情况。它支持两类 LED 系统： </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>2-LED 系统（活动 LED、状态 LED）</para>
    </listitem>
    <listitem>
     <para>3-LED 系统（活动 LED、查找 LED、失败 LED）</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bnmszsy">
   <title>调整 LVM 2 镜像大小 </title> 
   <para>已修改用于调整逻辑卷大小的 <command>lvresize</command>、<command>lvextend</command> 和 <command>lvreduce</command> 命令，以允许调整 LVM 2 镜像大小。以前，如果逻辑卷为镜像，则这些命令会报告错误。 </para>
  </sect2>
  <sect2 id="bnmtqql">
   <title>针对 IBM 服务器上的适配器更新储存驱动程序</title> 
   <para>更新以下储存驱动程序以使用最新的可用版本来支持 IBM 服务器上的储存适配器：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>Adaptec：<filename>aacraid</filename>、<filename>aic94xx</filename></para>
    </listitem>
    <listitem>
     <para>Emulex：<filename>lpfc</filename></para>
    </listitem>
    <listitem>
     <para>LSI：<filename>mptas</filename>、<filename>megaraid_sas</filename></para>
     <para><filename>mptsas</filename> 驱动程序现在支持本机 EEH（增强型错误处理程序）恢复，这是 Power 平台客户的所有 IO 设备的主要功能。 </para>
    </listitem>
    <listitem>
     <para>qLogic：<filename>qla2xxx</filename>、<filename>qla3xxx</filename>、<filename>qla4xxx</filename></para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 id="bndgyoe">
  <title>SLES 11 中的新增功能</title>
  <para>本节中注明的功能和行为更改是为 SUSE Linux Enterprise Server 11 版本进行的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bi72tak" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bi72zf2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12xr11r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu3u2m" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu3v96" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bin8klb" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="binagtl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="binahn3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bin9wm3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmqiv07" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy1edt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bn4yxd1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bvc111p" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bi72tak">
   <title>EVMS2 已弃用</title>
   <para>Enterprise Volume Management Systems (EVMS2) 储存管理解决方案已弃用。所有 EVMS 管理模块均已从 SUSE Linux Enterprise Server 11 包中删除。当您升级系统时，Linux Volume Manager 2 (LVM2) 会自动识别和管理 EVMS 所管理的非系统设备。有关更多信息，请参见 <ulink url="http://www.novell.com/linux/volumemanagement/strategy.html"><citetitle>Evolution of Storage and Volume Management in SUSE Linux Enterprise</citetitle></ulink>（SUSE Linux Enterprise 中储存和卷管理的演化）。</para>
   <para>如果让 EVMS 管理系统设备（任何包含根目录 (<filename>/</filename>)、<filename>/boot</filename> 或 <filename>swap</filename> 的设备），则在重引导 SLES 10 服务器进行升级之前，可以尝试执行以下步骤来准备服务器：</para>
   <procedure id="b176hy1d">
    <step id="b176hy1e" performance="required">
     <para>在 /etc/fstab 文件中，将引导和交换磁盘修改为默认目录 <filename>/dev/system/sys_lx</filename>：</para>
     <substeps performance="required">
      <step id="b176hy1f" performance="required">
       <para>从 <filename>swap</filename> 和根 (<filename>/</filename>) 分区的路径中去除 <filename>/evms/lvm2</filename>。</para>
      </step>
      <step id="b176hy1g" performance="required">
       <para>从 <filename>/boot</filename> 分区的路径中去除 <filename>/evms</filename>。</para>
      </step>
     </substeps>
    </step>
    <step id="b176hy1h" performance="required">
     <para>在 <filename>/boot/grub/menu.lst</filename> 文件中，从该路径去除 <filename>/evms/lvm2</filename>。 </para>
    </step>
    <step id="b176hy1i" performance="required">
     <para>在 <filename>/etc/sysconfig/bootloader</filename> 文件中，校验引导设备的路径是否为 <filename>/dev</filename> 目录。</para>
    </step>
    <step id="b176hy1j" performance="required">
     <para>确保已启用 <filename>boot.lvm</filename> 和 <filename>boot.md</filename>：</para>
     <substeps performance="required">
      <step id="b176hy1k" performance="required">
       <para>在 YaST 中单击<guimenu>系统</guimenu><guimenu>运行级别编辑器</guimenu><guimenu>专家模式</guimenu>。</para>
      </step>
      <step id="b176hy1l" performance="required">
       <para>选择 <filename>boot.lvm</filename>。</para>
      </step>
      <step id="b176hy1m" performance="required">
       <para>单击<guimenu>设置/重设置</guimenu><guimenu>启用服务</guimenu>。</para>
      </step>
      <step id="b176hy1n" performance="required">
       <para>选择 <filename>boot.md</filename>。</para>
      </step>
      <step id="b176hy1o" performance="required">
       <para>单击<guimenu>设置/重设置</guimenu><guimenu>启用服务</guimenu>。</para>
      </step>
      <step id="b176hy1p" performance="required">
       <para>单击<guimenu>完成</guimenu>，然后单击<guimenu>是</guimenu>。</para>
      </step>
     </substeps>
    </step>
    <step id="b176hy1q" performance="required">
     <para>重引导系统，然后开始升级。 </para>
    </step>
   </procedure>
   <para>有关在 SUSE Linux Enterprise Server 10 上使用 EVMS2 管理储存的信息，请参见<ulink url="http://www.novell.com/documentation/sles10/stor_admin/data/bookinfo.html">《<citetitle>SUSE Linux Enterprise Server 10 SP3：储存管理指南</citetitle>》</ulink>。</para>
  </sect2>
  <sect2 id="bi72zf2">
   <title>Ext3 成为默认文件系统</title>
   <para>Ext3 文件系统已替代了 ReiserFS 成为在安装时和创建文件系统时 YaST 工具推荐的默认文件系统。ReiserFS 仍受支持。有关详细信息，请参见 <citetitle>SUSE Linux Enterprise 11 技术规范</citetitle>网页上的<ulink url="http://www.novell.com/linux/techspecs.html?tab=2"><citetitle>文件系统支持</citetitle></ulink>。</para>
  </sect2>
  <sect2 id="b12xr11r">
   <title>为 Ext3 增加默认 inode 大小</title>
   <para>为了容纳 Ext3 文件系统上文件的扩展属性和 ACL，Ext3 的默认 inode 大小已从 SLES 10 上的 128 字节增加到 SLES 11 上的 256 字节。有关信息，请参阅<xref linkend="sec_fileystems_major_ext3inodesize" xrefstyle="HeadingOnPage"/>。</para>
  </sect2>
  <sect2 id="biu3u2m">
   <title>JFS 文件系统已弃用</title>
   <para>JFS 文件系统不再受支持。JFS 实用程序已从分发包中删除。</para>
  </sect2>
  <sect2 id="biu3v96">
   <title>OCFS2 文件系统在高可用性版本中</title>
   <para>OCFS2 文件系统作为 SUSE Linux Enterprise High Availability Extension 的一部分完全受支持。</para>
  </sect2>
  <sect2 id="bin8klb">
   <title>/dev/disk/by-name 已弃用</title>
   <para><filename>/dev/disk/by-name</filename> 路径在 SUSE Linux Enterprise Server 11 包中已弃用。 </para>
  </sect2>
  <sect2 id="binagtl">
   <title>/dev/disk/by-id 目录中设备名称的永久性</title>
   <para>在 SUSE Linux Enterprise Server 11 中，默认多路径设置依靠 <command>udev</command> 在多路径启动时重写 <filename>/dev/disk/by-id</filename> 目录中的现有符号链接。在启动多路径之前，链接使用其名称 <filename>scsi-xxx</filename> 指向 SCSI 设备。多路径运行时，符号链接使用其名称 <filename>dm-uuid-xxx</filename> 指向设备。这可确保 <filename>/dev/disk/by-id</filename> 路径中的符号链接始终指向同一设备，无论是否启动多路径。无需修改配置文件（如 <filename>lvm.conf</filename> 和 <filename>md.conf</filename>），因为它们会自动指向正确的设备。</para>
   <para>请参见以下各节，以了解有关此行为更改如何影响其他功能的更多信息：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="binahn3" xrefstyle="SectTitleOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bin9wm3" xrefstyle="SectTitleOnPage"/></para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="binahn3">
   <title>多路径设备的过滤器</title>
   <para><filename>/dev/disk/by-name</filename> 目录的弃用（如<xref linkend="bin8klb" xrefstyle="SectTitleOnPage"/>中所述）会影响在配置文件中设置多路径设备的过滤器的方式。如果在 <filename>/etc/lvm/lvm.conf</filename> 文件中对多路径设备过滤器使用了 <filename>/dev/disk/by-name</filename> 设备名称路径，则需要修改此文件以使用 <filename>/dev/disk/by-id</filename> 路径。设置使用 <filename>by-id</filename> 路径的过滤器时，请考虑以下因素：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><filename>/dev/disk/by-id/scsi-*</filename> 设备名称是永久性的，且仅为此目的而创建。</para>
    </listitem>
    <listitem>
     <para>不要在过滤器中使用 <filename>/dev/disk/by-id/dm-*</filename> 名称。这是设备映射程序设备的符号链接，并且会导致对 <filename>pvscan</filename> 命令响应报告重复的 PV。名称看上去从 <filename>LVM-pvuuid</filename> 更改为 <filename>dm-uuid</filename>，然后更改回 <filename>LVM-pvuuid</filename>。</para>
    </listitem>
   </itemizedlist>
   <para>有关设置过滤器的信息，请参见<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="bin9wm3">
   <title>多路径设备的用户友好的名称</title>
   <para>在 <filename>/dev/disk/by-id</filename> 目录中对多路径设备名称的处理方式的更改（如<xref linkend="binagtl" xrefstyle="SectTitleOnPage"/>中所述）会影响您对用户友好的名称的设置，因为同一设备的两个名称不同。您必须修改配置文件以在配置多路径后仅扫描设备映射程序名称。</para>
   <para>例如，需要修改 <filename>lvm.conf</filename> 文件，以使用多路径设备名称通过指定 <filename>/dev/disk/by-id/dm-uuid-.*-mpath-.*</filename> 路径而非 <filename>/dev/disk/by-id</filename> 进行扫描。</para>
  </sect2>
  <sect2 id="bmqiv07">
   <title>适用于多路径的高级 I/O 负载平衡选项</title>
   <para>除循环外，以下高级 I/O 负载平衡选项均可用于设备映射程序多路径：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>Least-pending</para>
    </listitem>
    <listitem>
     <para>Length-load-balancing</para>
    </listitem>
    <listitem>
     <para>Service-time</para>
    </listitem>
   </itemizedlist>
   <para>有关信息，请参见<xref linkend="beg263n" xrefstyle="HeadingOnPage"/>中的<xref linkend="b122sbgu" xrefstyle="RefNoPage"/>。</para>
  </sect2>
  <sect2 id="bmy1edt">
   <title>多路径工具调用的位置更改</title>
   <para>设备映射程序多路径工具的 <filename>mpath_*</filename> prio_callouts 已移动至 <filename>/lib/libmultipath/lib*</filename> 中的共享库。通过使用共享库，调用将在守护程序启动时装载到内存中。这有助于避免在所有路径都失败的情况下（在此期间程序应从磁盘装载，但磁盘此时可能不可用）出现系统死锁。</para>
  </sect2>
  <sect2 id="bn4yxd1">
   <title>mkinitrd -f 选项从 mpath 更改为 multipath</title>
   <para>用于将设备映射程序多路径服务添加到 <filename>initrd</filename> 的选项已从 <literal>-f mpath</literal> 更改为 <literal>-f multipath</literal>。 </para>
   <para>要创建新的 <filename>initrd</filename>，现在应使用以下命令：</para>

<screen>
mkinitrd -f multipath
</screen>

  </sect2>
  <sect2 id="bvc111p">
   <title>从多总线更改为故障转移以作为 MPIO 路径分组策略的默认设置</title>
   <para><filename>/etc/multipath.conf</filename> 文件中的 <literal>path_grouping_policy</literal> 的默认设置已从 <literal>multibus</literal> 更改为 <literal>failover</literal>。 </para>
   <para>有关配置 path_grouping_policy 的信息，请参见<xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
 </sect1>
</chapter>

<chapter id="storplan" lang="en" xml:base="01_planning.xml">
 <title>规划储存解决方案</title>
 <para>考虑一下储存需求以及如何可以有效地管理和划分储存空间以最好地满足需求。使用本部分中的信息帮助在您的 SUSE Linux Enterprise Server 11 服务器上规划文件系统的储存部署。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi72kf0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72p1s" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72o4h" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72q5v" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi739fa" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi72kf0">
  <title>将设备分区</title>
  <para>有关使用 YaST 专家分区程序的信息，请参见《<citetitle>SUSE Linux Enterprise Server 11 安装和管理指南</citetitle>》中的<quote>使用 YaST 分区程序</quote>。</para>
 </sect1>
 <sect1 id="bi72p1s">
  <title>多路径支持</title>
  <para>Linux 支持为服务器及其储存设备之间的容错连接使用多个 I/O 路径。默认情况下，Linux 多路径支持是禁用的。如果使用储存子系统供应商提供的多路径解决方案，则不需要另外配置 Linux 多路径。</para>
 </sect1>
 <sect1 id="bi72o4h">
  <title>软件 RAID 支持</title>
  <para>Linux 支持硬件 RAID 设备和软件 RAID 设备。如果使用硬件 RAID 设备，则无需使用软件 RAID 设备。您可以在同一服务器上同时使用硬件 RAID 设备和软件 RAID 设备。</para>
  <para>为了将软件 RAID 设备的性能优势发挥到最大，对 RAID 使用的分区应来自不同的物理设备。对于软件 RAID 1 设备，镜像分区无法共享任何磁盘。</para>
 </sect1>
 <sect1 id="bi72q5v">
  <title>文件系统快照</title>
  <para>Linux 支持文件系统快照。</para>
 </sect1>
 <sect1 id="bi739fa">
  <title>备份和防病毒支持</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="biu2e2j" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu2e2k" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="biu2e2j">
   <title>开放源代码备份</title>
   <para>用于在 Linux 上备份数据的开放源代码工具包括 <command>tar</command>、<command>cpio</command> 和 <command>rsync</command>。请参见手册页以了解这些工具的更多信息。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>PAX：POSIX 文件系统存档器。它支持 <command>cpio</command> 和 <command>tar</command>，这是标准存档（备份）文件最常见的两种形式。有关详细信息，请参见 manpage 文件。</para>
    </listitem>
    <listitem>
     <para>Amanda：高级 Maryland 自动网络磁盘存档器。请参见 <ulink url="http://www.amanda.org/">www.amanda.org</ulink>。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="biu2e2k">
   <title>商用备份和防病毒支持</title>
   <para>Novell Open Enterprise Server (OES) 2 for Linux 产品包含 SUSE Linux Enterprise Server (SLES) 10。支持 OES 2 的防病毒软件和备份软件供应商也支持 SLES 10。您可以访问供应商网站以了解他们对 SLES 11 提供的支持。 </para>
   <para>对于可能的备份软件和防病毒软件供应商的最新列表，请参见 <ulink url="http://www.novell.com/products/openenterpriseserver/partners_communities.html"><citetitle>Novell Open Enterprise Server Partner Support: Backup and Antivirus Support</citetitle></ulink>（Novell Open Enterprise Server 合作伙伴支持：备份和防病毒支持）。此列表按季度更新。</para>
  </sect2>
 </sect1>
</chapter>

<chapter id="lvm" lang="en" xml:base="02_lvm.xml">
 <title>LVM 配置</title>
 <para>本章简要介绍逻辑卷管理器 (LVM) 的原理及其基本功能，这些功能使 LVM 在许多情况下都很有用。YaST LVM 配置可以通过 YaST 专家分区程序完成。此分区工具用于编辑和删除现有分区并创建用于 LVM 的新分区。</para>
 <warning>
  <para>使用 LVM 可能会增加一些风险，例如数据丢失。这些风险还包括应用程序崩溃、电源故障及有问题的命令。在实施 LVM 或重配置卷前，请保存数据。决不要在没有备份的情况下工作。 </para>
 </warning>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec_yast2_system_lvm_explanation" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi706ct" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8b" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvm_activate_vgs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgpqe2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgqpfy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuz4lz" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgpmw3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgob84" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="btx9jxu" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sec_yast2_system_lvm_explanation">
  <title>了解逻辑卷管理器</title>
  <para>LVM 支持在多个文件系统上灵活分配硬盘空间。开发逻辑卷管理器是因为可能只有在安装期间初始分区完成后才需要更改硬盘空间的分段。因为在运行的系统中修改分区比较困难，LVM 提供了内存空间的虚拟池（卷组或 VG），如果需要，可以从中生成逻辑卷 (LV)。操作系统访问这些逻辑卷而不是物理分区。卷组可以跨多个磁盘，这样多个磁盘或部分磁盘可以构成一个 VG。LVM 以这种方式提供了一种对物理磁盘空间的抽象，从而能够以比物理分区更方便、更安全的方式更改硬盘空间的分段。 </para>
  <para role="intro"><xref linkend="bo1t1qx" xrefstyle="FigureXRef"/>比较物理分区（左）和 lvm 分段（右）。在左侧，将一个磁盘分成 3 个物理分区 (PART)，每个分区指派了一个安装点 (MP)，以便操作系统可以访问它们。在右侧，有两个磁盘，一个磁盘分为 2 个物理分区，另一个磁盘分为 3 个物理分区。定义了两个 LVM 卷组（VG1 和 VG2）。VG 1 包含 DISK 1 中的两个分区和 DISK 2 中的一个分区。VG 2 包含 DISK 2 中的其余两个分区。 </para>
  <figure pgwide="0" id="bo1t1qx">
   <title>物理分区与 LVM</title>
   <mediaobject>
    <imageobject role="fo">
    <imagedata fileref="lvm.png" width="445pt" format="eps"/></imageobject>
    <imageobject role="html">
    <imagedata fileref="lvm.png" width="445pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>在 LVM 中，合并到卷组的物理磁盘分区称为物理卷 (PV)。在<xref linkend="bo1t1qx" xrefstyle="FigureXRef"/> 的卷组中，定义了四个逻辑卷（LV 1 到 LV 4），可供操作系统通过关联的安装点来使用。不同逻辑卷之间的边界不一定是任何分区边界。请参见本示例中 LV 1 和 LV 2 之间的边界。 </para>
  <para>LVM 功能： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>可以将多块硬盘或多个分区合并为一个较大的逻辑卷。 </para>
   </listitem>
   <listitem>
    <para>如果配置合适，当可用空间用完后，可以扩大 LV（例如 <filename>/usr</filename>）。 </para>
   </listitem>
   <listitem>
    <para>通过使用 LVM，可以在正在运行的系统中添加硬盘或 LV。但这需要能执行此类操作的可热插拔的硬件。 </para>
   </listitem>
   <listitem>
    <para>可激活<emphasis>分段方式</emphasis>，此方式将通过若干物理卷来分发逻辑卷的数据流。如果这些物理卷驻留在不同的磁盘上，则可以提高读写性能，这与 RAID 0 类似。 </para>
   </listitem>
   <listitem>
    <para>使用快照功能可以在正在运行的系统中执行一致的备份（尤其适合服务器）。 </para>
   </listitem>
  </itemizedlist>
  <para>通过这些功能，使用 LVM 还对频繁使用的家用 PC 或小型服务器有用。如果您的数据储存量（如数据库、音乐存档或用户目录）不断增长，则 LVM 尤其有用。它支持您使用大于物理硬盘的文件系统。LVM 的另一个优点是最多可以添加 256 个 LV。但是，请记住，使用 LVM 与使用传统的分区截然不同。 </para>
  <para>从内核版本 2.6 开始，您便可以使用 LVM 版本 2 了，该版本向下兼容以前的 LVM ，从而使您能继续管理以前的卷组。在创建新卷组时，决定是使用新格式还是使用向下兼容的版本。LVM 2 不需要任何内核增补程序。它利用集成在内核 2.6 中的设备映射程序。该内核只支持 LVM V2。因此本章说到 LVM 时总是指 LVM V2。 </para>
  <para>您可以使用 YaST 分区程序管理新的或现有的 LVM 储存对象。官方 <ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"><citetitle>LVM HOWTO</citetitle></ulink> 提供了有关配置 LVM 的说明和详细信息。 </para>
  <important>
   <para>如果在配置 LVM 后添加多路径支持，则必须按照<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>中所述修改 <filename>/etc/lvm/lvm.conf</filename> 文件，以便仅扫描 <filename>/dev/disk/by-id</filename> 目录中的多路径设备名称，然后再重引导服务器。</para>
  </important>
 </sect1>
 <sect1 id="bi706ct">
  <title>创建 LVM 分区</title>
  <para>对于每个磁盘，将要用于 LVM 的可用空间分区为 <literal>0x8E Linux LVM</literal>。您可以在单个设备上创建一个或多个 LVM 分区。无需将一个设备上的所有分区都作为 LVM 分区。 </para>
  <para>您可以使用卷组功能将一个或多个 LVM 分区分组到称作卷组的逻辑空间池，然后从卷组的空间中划分出一个或多个逻辑卷。</para>
  <para>在 YaST 分区程序中，只有磁盘上的可用空间在您创建 LVM 分区时可供使用。如果要对单个 LVM 分区使用整个磁盘，而磁盘上已存在其他分区，则必须先删除所有现有的分区以释放空间，才能将该空间用于 LVM 分区中。 </para>
  <warning>
   <para>删除分区会清空分区中的所有数据。 </para>
  </warning>
  <procedure id="bq2fjmu">
   <step id="bq2fjmv" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="bq2fk0j" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgn1yt" performance="required">
    <para>（可选）删除一个或多个现有分区，以释放空间并使其对要创建的 LVM 分区可用。</para>
    <para>有关信息，请参见<xref linkend="brgob84" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
   <step id="bq2fk9e" performance="required">
    <para>在“分区”页中，单击<guimenu>添加</guimenu>。</para>
   </step>
   <step id="brgodov" performance="required">
    <para>在<guimenu>新分区类型</guimenu>下，选择<guimenu>主分区</guimenu>或<guimenu>扩展分区</guimenu>，再单击<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="brgoefx" performance="required">
    <para role="intro">指定<guimenu>新分区大小</guimenu>，单击<guimenu>下一步</guimenu>。</para>
    <informaltable role="1" frame="topbot" rowsep="0" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgpexh">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm2_a.png" width="151pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <itemizedlist mark="bullet" spacing="normal">
          <listitem>
           <formalpara id="brgof07">
            <title>最大大小：</title>
            <para>使用磁盘上的所有可用空间。</para>
           </formalpara>
          </listitem>
          <listitem>
           <formalpara id="brgooyf">
            <title>自定义大小：</title>
            <para>指定一个大小，不超过磁盘上的所有可用空间量。</para>
           </formalpara>
          </listitem>
          <listitem>
           <formalpara id="brgooyg">
            <title>自定义区域：</title>
            <para>指定磁盘上可用空间的开始和结束柱面。</para>
           </formalpara>
          </listitem>
         </itemizedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgpahi" performance="required">
    <para role="intro">配置分区格式：</para>
    <informaltable role="1" frame="topbot" rowsep="0" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgpi5z">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm3_a.png" width="139pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para>在<guimenu>格式化选项</guimenu>下，选择<guimenu>不格式化</guimenu>。</para>
          </listitem>
          <listitem>
           <para>从<guimenu>文件系统 ID</guimenu> 下拉列表中，选择 <guimenu>0x8E Linux LVM</guimenu> 作为分区标识符。</para>
          </listitem>
          <listitem>
           <para>在<guimenu>装入选项</guimenu>下，选择<guimenu>不装入分区</guimenu>。</para>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgosll" performance="required">
    <para>单击<guimenu>完成</guimenu>。</para>
    <para>在单击<guimenu>下一步</guimenu>后才真正创建分区，然后单击<guimenu>完成</guimenu>退出分区程序。</para>
   </step>
   <step id="bq2fkxr" performance="required">
    <para>对每个要添加的 Linux LVM 分区，重复<xref linkend="bq2fk9e" xrefstyle="StepXRef"/> 到<xref linkend="brgosll" xrefstyle="StepXRef"/>。 </para>
   </step>
   <step id="brgouy6" performance="required">
    <para>单击<guimenu>下一步</guimenu>，校验是否列出了新的 Linux LVM 分区，然后单击<guimenu>完成</guimenu>退出分区程序。</para>
   </step>
   <step id="bq2fl52" performance="required">
    <para>（可选）按<xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/>中所述继续卷组的配置。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchx8a">
  <title>创建卷组</title>
  <para>LVM 卷组将 Linux LVM 分区组织到逻辑空间池中。您可以从组的可用空间中划分出逻辑卷。组中的 Linux LVM 分区可以在相同或不同磁盘上。您可以从相同或不同磁盘中添加 LVM 分区，以扩展组大小。将为 LVM 预留的所有分区指派给卷组。否则，分区中的空间仍处于未使用状态。</para>
  <procedure id="brgncwg">
   <step id="brgnjca" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="brgnjcb" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgncwh" performance="required">
    <para>在左面板中，单击<guimenu>卷管理</guimenu>。</para>
    <para>右面板中将列出现有卷组的列表。</para>
   </step>
   <step id="brgnd6f" performance="required">
    <para role="intro">在“卷管理”页的左下角，单击<guimenu>添加卷组</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm4_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgndwo" performance="required">
    <para>指定<guimenu>卷组名称</guimenu>。</para>
    <para>如果在安装时创建卷组，建议对将包含 SUSE Linux Enterprise Server 文件系统的卷组采用名称 <literal>system</literal>。</para>
   </step>
   <step id="brgnght" performance="required">
    <para>指定<guimenu>物理区域大小</guimenu>。</para>
    <para><guimenu>物理区域大小</guimenu>定义卷组中物理块的大小。卷组中的所有磁盘空间都是按此大小的区块来处理的。值可以是 1 KB 到 16 GB（2 的幂数形式）。通常将此值设置为 4 MB。 </para>
    <para>在 LVM1 中，4 MB 物理区域允许的最大 LV 大小为 256 GB，因为它仅支持每个 LV 最多 65534 个区域。VM2 不限制物理区域数。区域数过多不影响逻辑卷的 I/O 性能，但会减慢 LVM 工具的速度。</para>
    <important>
     <para>单个 VG 中不应混合有不同的物理区域大小。区域在初始设置后不应修改。</para>
    </important>
   </step>
   <step id="brgnhd9" performance="required">
    <para>在<guimenu>可用物理卷</guimenu>列表中，选择要成为此卷组一部分的 Linux LVM 分区，然后单击<guimenu>添加</guimenu>将它们移动到<guimenu>所选物理卷</guimenu>列表。</para>
   </step>
   <step id="brgnihe" performance="required">
    <para>单击<guimenu>完成</guimenu>。</para>
    <para>新组将出现在<guimenu>卷组</guimenu>列表中。</para>
   </step>
   <step id="brgnk9f" performance="required">
    <para>在“卷管理”页上，单击<guimenu>下一步</guimenu>，验证是否列出了新卷组，然后单击<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchx8b">
  <title>配置物理卷</title>
  <para role="intro">将 Linux LVM 分区指派给卷组后，分区将称为物理卷。 </para>
  <figure pgwide="0" id="fig.yast2.lvm5">
   <title>Home 卷组中的物理卷</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_lvm5_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>向现有卷组添加更多的物理卷：</para>
  <procedure id="brgq6lc">
   <step id="brgq6ld" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="brgq6le" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgq6lf" performance="required">
    <para>在左面板中，选择“卷管理”并展开组列表。</para>
   </step>
   <step id="brgq6lg" performance="required">
    <para>在“卷管理”下，选择卷组，然后单击<guimenu>概述</guimenu>选项卡。</para>
   </step>
   <step id="brgq6lh" performance="required">
    <para role="intro">在页面底部，单击<guimenu>调整大小</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgq6li" performance="required">
    <para>从<guimenu>可用物理卷</guimenu>列表中选择物理卷（LVM 分区），然后单击“添加”将其移动到<guimenu>所选物理卷</guimenu>列表中。</para>
   </step>
   <step id="brgq6lj" performance="required">
    <para>单击<guimenu>完成</guimenu>。</para>
   </step>
   <step id="brgq6lk" performance="required">
    <para>单击<guimenu>下一步</guimenu>，验证是否列出了所做的更改，然后单击<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchx8c">
  <title>配置逻辑卷</title>
  <para>卷组包含物理卷后，使用“逻辑卷”对话框（请参见<xref linkend="fig.yast2.lvm6" xrefstyle="FigureXRef"/>）定义和管理操作系统应使用的逻辑卷。此对话框会列出该卷组中的所有逻辑卷。您可以使用<guimenu>添加</guimenu>、<guimenu>编辑</guimenu>和<guimenu>删除</guimenu>选项管理逻辑卷。请为每个卷组至少指派一个逻辑卷。您可以根据需要创建新的逻辑卷，直到卷组中的所有可用空间都用完为止。 </para>
  <para>从 SLES 11 SP3 开始，可以对 LVM 逻辑卷进行精简配置。精简配置可让您创建大小超出可用空间的逻辑卷。您创建包含未使用空间（预留供任意数目的瘦卷使用）的瘦池。瘦卷会被创建为稀疏卷，并会根据需要从瘦池分配空间。瘦池可以根据需要动态扩大，以实现储存空间的高效分配。</para>
  <important>
   <para>要使用群集中的精简配置卷，使用它的瘦池和瘦卷必须在单个群集资源中管理。如此可使瘦卷和瘦池始终在同一个节点上以独占方式装入。</para>
  </important>
  <figure pgwide="0" id="fig.yast2.lvm6">
   <title>逻辑卷管理</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_lvm6_a.png" width="339pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>可以在多个物理卷（分段）之间分布逻辑卷中的数据流。如果这些物理卷驻留在不同的硬盘上，则通常会提高读写性能（与 RAID 0 类似）。但是，只有可以将 LV 所需的硬盘空间平均分配给 <literal>n</literal> 个物理卷，才能正确创建有 <literal>n</literal> 个分段的分段 LV。例如，如果只有两个物理卷可用，则不可能存在有三个分段的逻辑卷。 </para>
  <procedure id="brgq5hr">
   <step id="brgq6ll" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="brgq6lm" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgq6ln" performance="required">
    <para>在左面板中，选择“卷管理”，并展开它以看到卷组列表。</para>
   </step>
   <step id="brgq6lo" performance="required">
    <para>在“卷管理”下，选择卷组，然后单击<guimenu>逻辑卷</guimenu> 选项卡。</para>
   </step>
   <step id="brgq5hs" performance="required">
    <para>在左下角，单击<guimenu>添加</guimenu>打开“添加逻辑卷”对话框。</para>
   </step>
   <step id="brgq8gl" performance="required">
    <para role="intro">指定逻辑卷的<guimenu>名称</guimenu>，单击<guimenu>下一步</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm9_a.png" width="137pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b15cmz3e" performance="required">
    <para>指定 LVM 卷类型：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b15cmz3f">
       <title>普通卷︰</title>
       <para>（默认）系统会立即分配卷的空间。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b15cmz3g">
       <title>瘦池︰</title>
       <para>逻辑卷是预留供瘦卷使用的空间池。瘦卷可以按需从瘦池分配它们所需的空间。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b15cmz3h">
       <title>瘦卷︰</title>
       <para>该卷会被创建为稀疏卷。瘦卷会按需从瘦池分配所需的空间。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm9a_a.png" width="137pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgqd13" performance="required">
    <para role="intro">指定卷的大小和是否使用多个分段。</para>
    <informaltable role="1" frame="topbot" rowsep="0" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgqgrg">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm10_a.png" width="137pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para>指定逻辑卷的大小，不超过最大可用大小。</para>
           <para>当前卷组的可用空间量将显示在<guimenu>最大大小</guimenu>选项旁边。</para>
          </listitem>
          <listitem>
           <para>指定分段数。</para>
           <warning>
            <para>YaST 此时还没有机会校验与分段有关的项的正确性。此处的任何错误只有稍后在磁盘上实施 LVM 时才会显现出来。 </para>
           </warning>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgqevk" performance="required">
    <para>为逻辑卷指定格式化选项：</para>
    <informaltable role="1" frame="topbot" rowsep="1" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgqevl">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm11_a.png" width="134pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para>在<guimenu>格式化选项</guimenu>下，选择<guimenu>格式化分区</guimenu>，然后从<guimenu>文件系统</guimenu>下拉列表中选择格式化类型，比如 Ext3。 </para>
          </listitem>
          <listitem>
           <para>在<guimenu>正在装入选项</guimenu>下，选择<guimenu>装入分区</guimenu>，然后选择安装点。</para>
           <para>此逻辑卷上储存的文件可以在已安装系统上的此安装点中找到。</para>
          </listitem>
          <listitem>
           <para>单击 <guimenu>Fstab 选项</guimenu>，为卷添加特殊装入选项。</para>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgqmpf" performance="required">
    <para>单击<guimenu>完成</guimenu>。</para>
   </step>
   <step id="brgqn20" performance="required">
    <para>单击<guimenu>下一步</guimenu>，验证是否列出了所做的更改，然后单击<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="lvm_activate_vgs">
  <title>自动激活非 root LVM 卷组</title>
  <para>非 root LVM 卷组的激活行为受 <literal>/etc/sysconfig/lvm</literal> 文件中参数设置的控制。</para>
  <para>默认情况下，<filename>/etc/rc.d/boot.lvm</filename> 在系统重启时会根据 <literal>/etc/sysconfig/lvm</literal> 文件中的 <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal> 参数设置自动激活非 root LVM 卷组。您可以使用此参数在系统重启时激活所有卷组，或仅激活指定的非 root LVM 卷组。</para>
  <para>要在系统重启时激活所有非 root LVM 卷组，请确保 <filename>/etc/sysconfig/lvm</filename> 文件中的 <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal> 参数值为空 (<literal>""</literal>)。这是默认设置。对于几乎所有标准的 LVM 安装，都可以安全地将该参数值保留为空。</para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="" 
</screen>

  <para>要在系统重启时仅激活指定的非 root LVM 卷组，则请将卷组名称指定为 <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal> 参数的值：</para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="vg1" 
</screen>

  <para>默认情况下，不会自动激活新发现的 LVM 卷组。<filename>/etc/sysconfig/lvm</filename> 文件中禁用 <literal>LVM_ACTIVATED_ON_DISCOVERED</literal> 参数：</para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="disable"
</screen>

  <para>您可以启用 <literal>LVM_ACTIVATED_ON_DISCOVERED</literal> 参数，以便通过 udev 规则激活新发现的 LVM 卷组：</para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="enable"
</screen>

 </sect1>
 <sect1 id="lvmtagging">
  <title>标记 LVM2 储存对象</title>
  <para role="intro">标记是无序的关键字或指派给储存对象元数据的术语。使用标记功能可以采用您认为有用的方式将无序的标记列表附加到 LVM 储存对象元数据，从而对储存对象集合进行分类。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bwkc8pi" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkc1zg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkc1ta" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkepmz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkdms3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkdqfz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bwkc8pi">
   <title>使用 LVM2 标记</title>
   <para role="intro">标记 LVM2 储存对象后，可以在命令中使用标记来完成以下任务：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>根据有或无特定标记选择要处理的 LVM 对象。</para>
    </listitem>
    <listitem>
     <para>使用配置文件中的标记，控制在服务器上激活哪些卷组和逻辑卷。</para>
    </listitem>
    <listitem>
     <para>通过在命令中指定标记，覆盖全局配置中的设置。</para>
    </listitem>
   </itemizedlist>
   <para>可以使用标记代替接受以下项的任何命令行 LVM 对象参考：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>对象列表</para>
    </listitem>
    <listitem>
     <para>单个对象，只要标记扩展到单个对象</para>
    </listitem>
   </itemizedlist>
   <para>目前，在任何位置都不支持将对象名称替换为标记。扩展自变量后，列表中的重复自变量将通过删除重复自变量而保留每个自变量的第一个实例来解决。</para>
   <para>只要是自变量类型可能不明确的位置，都必须在标记前面加上商业性 (@) 字符，比如 <literal>@mytag</literal>。在其他位置是否使用 <quote>@</quote> 前缀是可选的。</para>
  </sect2>
  <sect2 id="bwkc1zg">
   <title>创建 LVM2 标记的要求</title>
   <para role="intro">对 LVM 使用标记时，请注意以下要求：</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkc4lx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkc75c" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bwkc4lx">
    <title>支持的字符</title>
    <para>LVM 标记单词可以包含 ASCII 大写字符 A 到 Z、小写字符 a 到 z、数字 0 到 9、下划线 (_)、加号 (+)、连字符 (-) 和句点 (.)。单词不能以连字符开头。最大长度为 128 个字符。</para>
   </sect3>
   <sect3 id="bwkc75c">
    <title>支持的储存对象</title>
    <para>可以标记 LVM2 物理卷、卷组、逻辑卷和逻辑卷分段。PV 标记将储存在其卷组的元数据中。删除卷组时也删除孤立的物理卷中的标记。快照不能标记，但快照源可以标记。</para>
    <para>LVM1 对象不能标记，因为磁盘格式不支持此功能。</para>
   </sect3>
  </sect2>
  <sect2 id="bwkc1ta">
   <title>命令行标记语法</title>
   <variablelist>
    <varlistentry id="bwkddun">
     <term>--addtag &lt;<replaceable>标记信息</replaceable>&gt;</term>
     <listitem>
      <para>将标记添加到（或<emphasis>标记</emphasis>）LVM2 储存对象。</para>
      <formalpara id="bwkdj1p">
       <title>示例</title>
       <para/>
      </formalpara>

<screen>
vgchange --addtag @db1 vg1
</screen>

     </listitem>
    </varlistentry>
    <varlistentry id="bwkdh2t">
     <term>--deltag &lt;<replaceable>标记信息</replaceable>&gt;</term>
     <listitem>
      <para>删除（或<emphasis>取消标记</emphasis>）LVM2 储存对象中的标记。</para>
      <formalpara id="bwkdjin">
       <title>示例</title>
       <para/>
      </formalpara>

<screen>
vgchange --deltag @db1 vg1
</screen>

     </listitem>
    </varlistentry>
    <varlistentry id="bwkdh2u">
     <term>--tag &lt;<replaceable>标记信息</replaceable>&gt;</term>
     <listitem>
      <para>指定用于缩小要激活或停用的卷组列表或逻辑卷的标记。</para>
      <formalpara id="bwkdg98">
       <title>示例</title>
       <para/>
      </formalpara>
      <para>输入以下信息，以在卷的标记与提供的标记匹配时激活卷：</para>

<screen>
lvchange -ay --tag @db1 vg1/vol2
</screen>

     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="bwkepmz">
   <title>配置文件语法</title>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkcqoj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkeuio" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkcwqd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bwkcqoj">
    <title>在 lvm.conf 文件中启用主机名标记</title>
    <para>将以下代码添加到 <filename>/etc/lvm/lvm.conf</filename> 文件，以启用在主机的 <filename>/etc/lvm/lvm_&lt;<replaceable>主机名</replaceable>&gt;.conf</filename> 文件中单独定义的主机标记。</para>

<screen>
tags {
   # Enable hostname tags
   hosttags = 1
}
</screen>

    <para>您将激活代码置于主机上的 <filename>/etc/lvm/lvm_&lt;<replaceable>主机名</replaceable>&gt;.conf</filename> 文件中。请参见<xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/>。</para>
   </sect3>
   <sect3 id="bwkeuio">
    <title>在 lvm.conf 文件中定义主机名标记</title>

<screen>
tags {

   tag1 { }
      # Tag does not require a match to be set.

   tag2 {
      # If no exact match, tag is not set.
      host_list = [ "hostname1", "hostname2" ]
   }
}
</screen>

   </sect3>
   <sect3 id="bwkctd3">
    <title>定义激活</title>
    <para>您可以修改 <filename>/etc/lvm/lvm.conf</filename> 文件，以根据标记激活 LVM 逻辑卷。 </para>
    <para>在文本编辑器中，将以下代码添加到文件中：</para>

<screen>
  activation {
      volume_list = [ "vg1/lvol0", "@database" ]
  }
</screen>

    <para>将 <literal>@database</literal> 替换为您的标记。使用 <literal>"@*"</literal> 根据主机上设置的任何标记匹配此标记。 </para>
    <para>激活命令根据卷组和逻辑卷的元数据中设置的<replaceable>卷组名称</replaceable>、<replaceable>卷组名称/逻辑卷名称</replaceable> 或 @<replaceable>标记</replaceable>进行匹配。只有元数据标记匹配时，才激活卷组或逻辑卷。默认情况下，如果不匹配则不会激活。</para>
    <para>如果 <literal>volume_list</literal> 不存在，且主机上已定义任何标记，则只有主机标记与元数据标记匹配时，才会激活卷组或逻辑卷。</para>
    <para>如果 <literal>volume_list</literal> 不存在，且主机上未定义任何标记，则会激活卷组或逻辑卷。</para>
   </sect3>
   <sect3 id="bwkcwqd">
    <title>在多个主机名配置文件中定义激活</title>
    <para>在 <filename>lvm.conf</filename> 文件中启用主机标记后，可以在主机配置文件（<filename>/etc/lvm/lvm_&lt;<replaceable>主机标记</replaceable>&gt;.conf</filename>）中使用激活代码。例如，一个服务器在 <filename>/etc/lvm/</filename> 文件夹中有两个配置文件：</para>
    <simplelist>
     <member><filename>lvm.conf</filename></member> <member><filename>lvm_&lt;<replaceable>主机标记</replaceable>&gt;.conf</filename></member>
    </simplelist>
    <para>启动时，装载 <filename>/etc/lvm/lvm.conf</filename> 文件，并处理文件中的任何标记设置。如果定义了主机标记，则服务器将装载相关的 <filename>/etc/lvm/lvm_&lt;<replaceable>主机标记</replaceable>&gt;.conf</filename> 文件。当服务器搜索特定配置文件项时，先搜索主机标记文件，再搜索 <filename>lvm.conf</filename> 文件，等找到第一个匹配项时停止。在 <filename>lvm_&lt;<replaceable>主机标记</replaceable>&gt;.conf</filename> 文件内，使用与设置标记时相反的顺序。这样就可以先搜索最后设置标记的文件。主机标记文件中设置的新标记将会触发额外的配置文件装载。 </para>
   </sect3>
  </sect2>
  <sect2 id="bwkdms3">
   <title>将标记用于群集中的简单激活控制</title>
   <para>您可以设置简单主机名激活控制，方法是在 <filename>/etc/lvm/lvm.conf</filename> 文件中启用 <literal>hostname_tags</literal> 选项。将相同文件用于群集中的每一台计算机上，以便建立全局设置。 </para>
   <procedure id="bwkel6y">
    <step id="bwkel6z" performance="required">
     <para>在文本编辑器中，将以下代码添加到 <filename>/etc/lvm/lvm.conf</filename> 文件中：</para>

<screen>
tags {
   hostname_tags = 1
}
</screen>

    </step>
    <step id="bwkelf9" performance="required">
     <para>将文件复制到群集中的所有主机上。</para>
    </step>
    <step id="bwkelow" performance="required">
     <para>从群集中的任何计算机上，将 <literal>db1</literal> 添加到将激活 <filename>vg1/lvol2</filename> 的计算机列表中：</para>

<screen>
lvchange --addtag @db1 vg1/lvol2
</screen>

    </step>
    <step id="bwkelx8" performance="required">
     <para>在 <filename>db1</filename> 服务器上，输入以下内容以激活它：</para>

<screen>
lvchange -ay vg1/vol2
</screen>

    </step>
   </procedure>
  </sect2>
  <sect2 id="bwkdqfz">
   <title>使用标记激活群集中首选主机上的卷组</title>
   <para>本部分中的示例展示了完成以下任务的两种方法：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>仅激活数据库主机 <filename>db1</filename> 和 <filename>db2</filename> 上的卷组 <filename>vg1</filename>。</para>
    </listitem>
    <listitem>
     <para>仅激活文件服务器主机 <filename>fs1</filename> 上的卷组 <filename>vg2</filename>。</para>
    </listitem>
    <listitem>
     <para>最初在文件服务器备份主机 <filename>fsb1</filename> 上不激活任何卷组，但对其进行准备以从文件服务器主机 <filename>fs1</filename> 接管卷组。</para>
    </listitem>
   </itemizedlist>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkdsty" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkdtdw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bwkdsty">
    <title>选项 1：集中化管理和主机间静态配置复制</title>
    <para>在以下解决方案中，单个配置文件复制到多台主机中。</para>
    <procedure id="bwkdvwj">
     <step id="bwkdvwk" performance="required">
      <para>将 <literal>@database</literal> 标记添加到卷组 <filename>vg1</filename> 的元数据中。在终端控制台上，输入</para>

<screen>
vgchange --addtag @database vg1
</screen>

     </step>
     <step id="bwke0dt" performance="required">
      <para>将 <literal>@fileserver</literal> 标记添加到卷组 <filename>vg2</filename> 的元数据中。在终端控制台上，输入</para>

<screen>
vgchange --addtag @fileserver vg2
</screen>

     </step>
     <step id="bwke0du" performance="required">
      <para>在文本编辑器中，用以下代码修改 <filename>/etc/lvm/lvm.conf</filename> 文件，以定义 <literal>@database</literal>、<literal>@fileserver</literal> 和 <literal>@fileserverbackup</literal> 标记。</para>

<screen>
tags {
   database {
      host_list = [ "db1", "db2" ]
   }
   fileserver {
      host_list = [ "fs1" ]
   }
   fileserverbackup {
      host_list = [ "fsb1" ]
   }
}

activation {
   # Activate only if host has a tag that matches a metadata tag
   volume_list = [ "@*" ]
}
</screen>

     </step>
     <step id="bwke0dv" performance="required">
      <para>将修改后的 <filename>/etc/lvm/lvm.conf</filename> 文件复制到四台主机中：<filename>db1</filename>、<filename>db2</filename>、<filename>fs1</filename> 和 <filename>fsb1</filename>。</para>
     </step>
     <step id="bwke2yh" performance="required">
      <para>如果文件服务器主机出现故障，则在终端控制台的任何节点上输入以下命令即可在 <filename>fsb1</filename> 上启动 <filename>vg2</filename>：</para>

<screen>
vgchange --addtag @fileserverbackup vg2
vgchange -ay vg2
</screen>

     </step>
    </procedure>
   </sect3>
   <sect3 id="bwkdtdw">
    <title>选项 2: 本地化管理和配置</title>
    <para>在以下解决方案中，每台主机在本地保存有关激活哪些类别的卷的信息。</para>
    <procedure id="bwke3z3">
     <step id="bwke8yi" performance="required">
      <para role="intro">将 <literal>@database</literal> 标记添加到卷组 <filename>vg1</filename> 的元数据中。在终端控制台上，输入</para>

<screen>
vgchange --addtag @database vg1
</screen>

     </step>
     <step id="bwke8yj" performance="required">
      <para>将 <literal>@fileserver</literal> 标记添加到卷组 <filename>vg2</filename> 的元数据中。在终端控制台上，输入</para>

<screen>
vgchange --addtag @fileserver vg2
</screen>

     </step>
     <step id="bwke8yk" performance="required">
      <para>在 <filename>/etc/lvm/lvm.conf</filename> 文件中启用主机标记：</para>
      <substeps performance="required">
       <step id="bwke8dm" performance="required">
        <para>在文本编辑器中，用以下代码修改 <filename>/etc/lvm/lvm.conf</filename> 文件，以启用主机标记配置文件。</para>

<screen>
tags {
   hosttags = 1
}
</screen>

       </step>
       <step id="bwke8dn" performance="required">
        <para>将修改后的 <filename>/etc/lvm/lvm.conf</filename> 文件复制到四台主机上：<filename>db1</filename>、<filename>db2</filename>、<filename>fs1</filename> 和 <filename>fsb1</filename>。</para>
       </step>
      </substeps>
     </step>
     <step id="bwke7w8" performance="required">
      <para>在主机 <filename>db1</filename> 上，创建数据库主机 <filename>db1</filename> 的激活配置文件。在文本编辑器中，创建 <filename>/etc/lvm/lvm_db1.conf</filename> 文件并添加以下代码：</para>

<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>

     </step>
     <step id="bwkeef1" performance="required">
      <para>在主机 <filename>db2</filename> 上，创建数据库主机 <filename>db2</filename> 的激活配置文件。在文本编辑器中，创建 <filename>/etc/lvm/lvm_db2.conf</filename> 文件并添加以下代码：</para>

<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>

     </step>
     <step id="bwkeef2" performance="required">
      <para>在主机 fs1 上，创建文件服务器主机 <filename>fs1</filename> 的激活配置文件。在文本编辑器中，创建 <filename>/etc/lvm/lvm_fs1.conf</filename> 文件并添加以下代码：</para>

<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>

     </step>
     <step id="bwkeef3" performance="required">
      <para>如果文件服务器主机 <filename>fs1</filename> 出现故障，要启动备用文件服务器主机 fsb1 作为文件服务器：</para>
      <substeps performance="required">
       <step id="bwkeef4" performance="required">
        <para>在主机 <filename>fsb1</filename> 上，创建主机 <filename>fsb1</filename> 的激活配置文件。在文本编辑器中，创建 <filename>/etc/lvm/lvm_fsb1.conf</filename> 文件并添加以下代码：</para>

<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>

       </step>
       <step id="bwkeef5" performance="required">
        <para>在终端控制台上，输入以下命令之一：</para>

<screen>
vgchange -ay vg2

vgchange -ay @fileserver
</screen>

       </step>
      </substeps>
     </step>
    </procedure>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="brgpqe2">
  <title>调整卷组大小</title>
  <para role="intro">您可以在卷组中添加和删除 Linux LVM 分区，以扩展或缩小卷组。</para>
  <warning>
   <para>如果分区正在由逻辑卷使用，则删除分区会导致数据丢失。</para>
  </warning>
  <procedure id="brgpt5w">
   <step id="brgpt5x" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="brgpt5y" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgpt5z" performance="required">
    <para>在左面板中，选择“卷管理”，并展开它以看到卷组列表。</para>
   </step>
   <step id="brgpt60" performance="required">
    <para>在“卷管理”下，选择卷组，然后单击<guimenu>概述</guimenu>选项卡。</para>
   </step>
   <step id="brgpt61" performance="required">
    <para role="intro">在页面底部，单击<guimenu>调整大小</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgptkf" performance="required">
    <para>执行以下步骤之一：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="brgpw44">
       <title>添加：</title>
       <para>要扩展卷组大小，请将一个或多个物理卷（LVM 分区）从<guimenu>可用物理卷</guimenu>列表移动到<guimenu>所选物理卷</guimenu>列表。 </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="brgpxfv">
       <title>去除：</title>
       <para>要缩小卷组大小，请将一个或多个物理卷（LVM 分区）从<guimenu>所选物理卷</guimenu>列表移动到<guimenu>可用物理卷</guimenu>列表。 </para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step id="brgptf8" performance="required">
    <para>单击<guimenu>完成</guimenu>。</para>
   </step>
   <step id="brgpt62" performance="required">
    <para>单击<guimenu>下一步</guimenu>，校验是否列出了更改，然后单击<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="brgqpfy">
  <title>用 YaST 调整逻辑卷大小</title>
  <procedure id="brgqpvs">
   <step id="brgqsmd" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="brgqsme" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgqsmf" performance="required">
    <para>在左面板中，选择“卷管理”，并展开它以看到卷组列表。</para>
   </step>
   <step id="brgqsmg" performance="required">
    <para>在“卷管理”下，选择卷组，然后单击<guimenu>逻辑卷</guimenu> 选项卡。</para>
   </step>
   <step id="brgqsmh" performance="required">
    <para>在页面底部，单击<guimenu>调整大小</guimenu>打开“调整逻辑卷大小”对话框。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm12_a.png" width="244pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgqpvt" performance="required">
    <para>使用滑块扩展或缩小逻辑卷的大小。</para>
    <warning>
     <para>缩小包含数据的逻辑卷的大小会损坏数据。</para>
    </warning>
   </step>
   <step id="brgqueh" performance="required">
    <para>单击<guimenu>确定</guimenu>。</para>
   </step>
   <step id="brgqulm" performance="required">
    <para>单击<guimenu>下一步</guimenu>，校验是否列出了更改，然后单击<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuz4lz">
  <title>用命令调整逻辑卷大小</title>
  <para><command>lvresize</command>、<command>lvextend</command> 和 <command>lvreduce</command> 命令用于调整逻辑卷大小。有关语法和选项信息，请参见每个命令的手册页。</para>
  <para>您也可以使用 YaST 分区程序增加逻辑卷的大小。YaST 使用 <command>parted(8)</command> 增大分区。 </para>
  <para>要扩展 LV，VG 上必须有足够的可用未分配空间。 </para>
  <para>逻辑卷在使用时可扩展或缩小，但是不会影响其上的文件系统。扩展或收缩 LV 不会自动修改卷中文件系统的大小。随后必须使用其他命令增大文件系统。有关调整文件系统大小的信息，请参见<xref linkend="biuymaa" xrefstyle="ChapTitleOnPage"/>。</para>
  <para>请确保使用正确的序列： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>如果扩展逻辑卷，则必须在试图增大文件系统之前扩展逻辑卷。</para>
   </listitem>
   <listitem>
    <para>如果缩小逻辑卷，则必须在试图缩小逻辑卷之前缩小文件系统。</para>
   </listitem>
  </itemizedlist>
  <para>扩展逻辑卷的大小：</para>
  <procedure id="biuz4s4">
   <step id="biuz7nu" performance="required">
    <para>打开终端控制台，作为 <systemitem>root</systemitem> 用户登录。</para>
   </step>
   <step id="biuz81p" performance="required">
    <para>如果逻辑卷包含由虚拟机（如 Xen VM）托管的文件系统，请关闭 VM。</para>
   </step>
   <step id="biuz7ph" performance="required">
    <para>卸下逻辑卷上的文件系统。</para>
   </step>
   <step id="biuz4s5" performance="required">
    <para>在终端控制台提示时，输入以下命令以增加逻辑卷大小：</para>

<screen>
lvextend -L +<replaceable>size</replaceable> <replaceable>/dev/vgname/lvname</replaceable>
</screen>

    <para>对于<replaceable>大小</replaceable>，请指定要添加到逻辑卷的空间量，如 10GB。将逻辑卷的 <filename><replaceable>/dev/vgname/lvname</replaceable></filename> 替换为 Linux 路径，如 <filename>/dev/vg1/v1</filename>。例如：</para>

<screen>
lvextend -L +10GB /dev/vg1/v1<replaceable/>
</screen>

   </step>
  </procedure>
  <para>例如，使用 LV 上的（已装入且处于活动状态）ReiserFS 将 LV 扩展 10GB：</para>

<screen>
lvextend −L +10G <replaceable>/dev/vgname/lvname</replaceable>
resize_reiserfs −s +10GB −f <replaceable>/dev/vg−name/lv−name</replaceable>
</screen>

  <para>例如，使用 LV 上的 ReiserFS 将 LV 收缩 5GB：</para>

<screen>
umount <replaceable>/mountpoint−of−LV</replaceable>
resize_reiserfs −s −5GB <replaceable>/dev/vgname/lvname</replaceable>
lvreduce <replaceable>/dev/vgname/lvname</replaceable>
mount <replaceable>/dev/vgname/lvname</replaceable> <replaceable>/mountpoint−of−LV</replaceable>
</screen>

 </sect1>
 <sect1 id="brgpmw3">
  <title>删除卷组</title>
  <warning>
   <para>删除卷组会清空其每个成员分区中的所有数据。 </para>
  </warning>
  <procedure id="brgppd6">
   <step id="brgppd7" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="brgppd8" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgppd9" performance="required">
    <para>在左面板中，选择“卷管理”并展开组列表。</para>
   </step>
   <step id="brgpos4" performance="required">
    <para>在“卷管理”下，选择卷组，然后单击<guimenu>概述</guimenu>选项卡。</para>
   </step>
   <step id="brgpos5" performance="required">
    <para>在页面底部，单击<guimenu>删除</guimenu>，再单击<guimenu>是</guimenu>确认删除。</para>
   </step>
   <step id="brgpos6" performance="required">
    <para>单击<guimenu>下一步</guimenu>，校验是否列出了删除的卷组（用红色字体表示删除），然后单击<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="brgob84">
  <title>删除 LVM 分区（物理卷）</title>
  <warning>
   <para>删除分区会清空分区中的所有数据。 </para>
  </warning>
  <procedure id="brgobbw">
   <step id="brgobki" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="brgobkj" performance="required">
    <para>在 YaST 中，打开<guimenu>分区程序</guimenu>。</para>
   </step>
   <step id="brgobuj" performance="required">
    <para>如果 Linux LVM 分区正用作卷组成员，则从卷组中删除分区，或<link linkend="brgpmw3">删除卷组</link>。</para>
   </step>
   <step id="brgobkk" performance="required">
    <para>在 YaST 分区程序的<guimenu>硬盘</guimenu>下，选择设备（如 <filename>sdc</filename>）。</para>
   </step>
   <step id="brgobkl" performance="required">
    <para>在“分区”页上，选择要删除的分区，单击<guimenu>删除</guimenu>，再单击<guimenu>是</guimenu>确认删除。</para>
   </step>
   <step id="brgobkm" performance="required">
    <para>单击<guimenu>下一步</guimenu>，校验是否列出了删除的分区（用红色字体表示删除），然后单击<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="btx9jxu">
  <title>使用 LVM 命令</title>
  <para>有关使用 LVM 命令的信息，请参见<xref linkend="btx8b05" xrefstyle="TableXRef"/>所述的命令的手册页。以 <systemitem>root</systemitem> 用户身份执行命令。</para>
  <table id="btx8b05" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
   <title>LVM 命令</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="5001*"/>
   <colspec colnum="2" colname="2" colwidth="5001*"/>
    <thead>
     <row id="btx8b06">
      <entry>
       <para>命令</para>
      </entry>
      <entry>
       <para>说明</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="btx8b07">
      <entry>

<screen>
pvcreate <replaceable>&lt;device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>初始化设备（例如 <filename>/dev/sdb</filename>）以作为物理卷供 LVLM 使用。</para>
      </entry>
     </row>
     <row id="btx8yob">
      <entry>

<screen>
pvdisplay &lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>显示 LVM 物理卷的相关信息，例如当前它是否正在逻辑卷中使用。</para>
      </entry>
     </row>
     <row id="btx8b08">
      <entry>

<screen>
vgcreate -c y &lt;<replaceable>vg_name&gt;</replaceable> &lt;<replaceable>dev1</replaceable>&gt; [<replaceable>dev2</replaceable>...]
</screen>
</entry>
      <entry>
       <para>使用一个或多个指定的设备创建群集卷组。</para>
      </entry>
     </row>
     <row id="btx8b09">
      <entry>

<screen>
vgchange -a [ey | n] &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>激活 (<literal>-a ey</literal>) 或停用 (<literal>-a n</literal>) 卷组及其逻辑卷的输入/输出。</para>
       <important>
        <para>确保使用 <literal>ey</literal> 选项来以独占方式激活群集节点上的卷组。此选项默认在装载脚本中使用。</para>
       </important>
      </entry>
     </row>
     <row id="btx8lez">
      <entry>

<screen>
vgremove &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>删除卷组。请在使用此命令之前删除逻辑卷，然后停用卷组。</para>
      </entry>
     </row>
     <row id="btx8b0a">
      <entry>

<screen>
vgdisplay &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>显示指定卷组的相关信息。</para>
       <para>要了解卷组的物理区域总大小，请输入</para>

<screen>
vgdisplay vg_name | grep "Total PE"
</screen>

      </entry>
     </row>
     <row id="b15cnuq5">
      <entry>

<screen>
lvcreate -L <replaceable>size</replaceable> -n &lt;<replaceable>lv_name</replaceable>&gt; &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>创建具有指定大小的逻辑卷。</para>
      </entry>
     </row>
     <row id="btx8b0b">
      <entry>

<screen>
lvcreate -L &lt;size&gt; &lt;-T|--thinpool&gt; &lt;<replaceable>vg_name/thin_pool_name</replaceable>&gt;

lvcreate -virtualsize &lt;size&gt; &lt;-T|--thin&gt; 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;

lvcreate -L &lt;size&gt; -T 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; 
-virtualsize &lt;size&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;


</screen>
</entry>
      <entry>
       <para>创建指定了大小的瘦逻辑卷或瘦池。</para>
       <para>创建瘦池或瘦逻辑卷，或者两者都创建。指定可选自变量 --size 将会创建瘦池逻辑卷。指定可选自变量 --virtualsize 将会基于给定的瘦池卷创建瘦逻辑卷。指定这两个自变量将会创建瘦池和使用该池的瘦卷。</para>
      </entry>
     </row>
     <row id="b15cmns0">
      <entry>

<screen>
lvcreate -s [-L <replaceable>size</replaceable>] -n <replaceable>&lt;snap_volume</replaceable>&gt; <replaceable>&lt;source_volume_path</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>创建指定逻辑卷的快照卷。如果未包含大小选项（-L、--size），则会将快照创建为瘦快照。</para>
      </entry>
     </row>
     <row id="btx8b0c">
      <entry>

<screen>
lvremove&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>去除一个逻辑卷，例如 <filename>/dev/vg_name/lv_name</filename>。</para>
       <para>使用此命令之前，请先使用 <command>umount</command> 命令卸下逻辑卷以将其关闭。</para>
      </entry>
     </row>
     <row id="b15cmns1">
      <entry>

<screen>
lvremove <replaceable>snap_volume_path</replaceable>
</screen>
</entry>
      <entry>
       <para>删除快照卷。</para>
      </entry>
     </row>
     <row id="b15cmns2">
      <entry>

<screen role="compact2">
lvconvert --merge  [-b] [-i &lt;<replaceable>seconds</replaceable>&gt;] [&lt;<replaceable>snap_volume_path</replaceable>&gt;[...&lt;snapN&gt;]|@&lt;<replaceable>volume_tag</replaceable>&gt;]
</screen>
</entry>
      <entry>
       <para>将快照数据还原（回滚或合并）到原始卷。</para>
      </entry>
     </row>
     <row id="btx8b0d">
      <entry>

<screen>
vgextend <replaceable>&lt;vg_name&gt;</replaceable>&lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>将指定的物理卷添加到现有卷组</para>
      </entry>
     </row>
     <row id="btx8b0e">
      <entry>

<screen>
vgreduce <replaceable>&lt;vg_name</replaceable>&gt; &lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>从现有卷组中删除指定的物理卷。 </para>
       <important>
        <para>确保物理卷当前未被逻辑卷使用。如果正在使用中，则必须使用 <command>pvmove</command> 命令将数据移至另一个物理卷。</para>
       </important>
      </entry>
     </row>
     <row id="btx8b0f">
      <entry>

<screen>
lvextend -L <replaceable>size</replaceable>&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>扩大指定逻辑卷的大小。随后，您还必须相应地扩大文件系统以充分利用新扩充的空间。</para>
      </entry>
     </row>
     <row id="btx8b0g">
      <entry>

<screen>
lvreduce -L <replaceable>size</replaceable> <replaceable>&lt;/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>减少指定逻辑卷的大小。 </para>
       <important>
        <para>在缩小卷之前，请确保先减少文件系统的大小，否则可能会丢失数据。</para>
       </important>
      </entry>
     </row>
     <row id="b11lxo1l">
      <entry>

<screen>
lvrename <replaceable>&lt;/dev/vg_name/old_lv_name</replaceable>&gt; <replaceable>&lt;/dev/vg_name/new_lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>将卷组中现有的 LVM 逻辑卷由原来的卷名重命名为新的卷名。此操作不会更改卷组名。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </sect1>
</chapter>

<chapter id="biuymaa" lang="en" xml:base="02_fs_resize.xml">
 <title>调整文件系统大小</title>
 <para>如果数据要求增大卷，您可能需要增加分配到其文件系统的空间量。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="biuynjy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt5y" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt64" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt6a" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt6g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="biuynjy">
  <title>调整大小指导原则</title>
  <para>调整任何分区或文件系统的大小涉及可能会导致数据丢失的风险。 </para>
  <warning>
   <para>为了避免数据丢失，请确保在开始任何调整大小任务之前备份您的数据。</para>
  </warning>
  <para>计划调整文件系统大小时，请考虑以下指导原则。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="biuytzx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biuyupz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biuyw0v" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="biuytzx">
   <title>支持调整大小的文件系统</title>
   <para>文件系统必须支持调整大小才能利用卷上可用空间的增加。在 SUSE Linux Enterprise Server 11 中，提供了文件系统 Ext3、Ext4 和 ReiserFS 适用的文件系统调整大小实用程序。这些实用程序支持如下增加和减小大小：</para>
   <table id="b8qqe0i" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>文件系统对调整大小的支持</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="2500*"/>
    <colspec colnum="3" colname="3" colwidth="2500*"/>
    <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row id="b8qqedo">
       <entry>
        <para>文件系统</para>
       </entry>
       <entry>
        <para>实用程序</para>
       </entry>
       <entry>
        <para>增大大小（增大）</para>
       </entry>
       <entry>
        <para>减小大小（收缩）</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bxuadqe">
       <entry>
        <para>Ext2</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>仅限脱机</para>
       </entry>
       <entry>
        <para>仅限脱机</para>
       </entry>
      </row>
      <row id="bxuadqf">
       <entry>
        <para>Ext3</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>联机或脱机</para>
       </entry>
       <entry>
        <para>仅限脱机</para>
       </entry>
      </row>
      <row id="bxuacq3">
       <entry>
        <para>Ext4</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>仅限脱机</para>
       </entry>
       <entry>
        <para>仅限脱机</para>
       </entry>
      </row>
      <row id="b8qqedr">
       <entry>
        <para>ReiserFS</para>
       </entry>
       <entry>
        <para>resize_reiserfs</para>
       </entry>
       <entry>
        <para>联机或脱机</para>
       </entry>
       <entry>
        <para>仅限脱机</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="biuyupz">
   <title>增加文件系统的大小</title>
   <para>您可以将文件系统增大到设备上的最大可用空间，或指定一个准确大小。请确保在尝试增加文件系统的大小之前先增加设备或逻辑卷的大小。</para>
   <para>为文件系统指定精确大小时，请确保新大小满足以下条件：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必须大于现有数据的大小；否则会发生数据丢失。 </para>
    </listitem>
    <listitem>
     <para>新大小必须等于或小于当前设备大小，因为文件系统大小不能超出可用空间。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="biuyw0v">
   <title>减小文件系统的大小</title>
   <para>当减小设备上的文件系统的大小时，请确保新的大小满足以下条件：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必须大于现有数据的大小；否则会发生数据丢失。 </para>
    </listitem>
    <listitem>
     <para>新大小必须等于或小于当前设备大小，因为文件系统大小不能超出可用空间。</para>
    </listitem>
   </itemizedlist>
   <para>如果还计划减小用于保存文件系统的逻辑卷的大小，请确保在尝试减小设备或逻辑卷的大小之前先减小文件系统的大小。</para>
  </sect2>
 </sect1>
 <sect1 id="biuzt5y">
  <title>增加 Ext2、Ext3 或 Ext4 文件系统的大小</title>
  <para>安装文件系统时，可以使用 <command>resize2fs</command> 命令增加 Ext2、Ext3 和 Ext4 文件系统的大小。卸载文件系统时，也可以使用 <command>resize2fs</command> 命令增加 Ext3 文件系统的大小。</para>
  <procedure id="biuzt5z">
   <step id="biuzt60" performance="required">
    <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
   </step>
   <step id="bxuagy1" performance="required">
    <para>如果文件系统是 Ext2 或 Ext4，则必须卸载文件系统。可以安装或卸载 Ext3 文件系统。</para>
   </step>
   <step id="biuzt61" performance="required">
    <para>使用以下方法之一增加文件系统的大小：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>要将文件系统大小扩展为名为 <filename>/dev/sda1</filename> 的设备的最大可用大小，请输入</para>

<screen>
resize2fs /dev/sda1
</screen>

      <para>如果未指定大小参数，大小将默认为该分区的大小。</para>
     </listitem>
     <listitem>
      <para>要将文件系统扩展为指定大小，请输入 </para>

<screen>
resize2fs /dev/sda1 <replaceable>size</replaceable>
</screen>

      <para><replaceable>大小</replaceable>参数指定请求的文件系统新大小。如果不指定任何单位，则大小参数的单位是文件系统的块大小。（可选）大小参数可以加以下指定单位后缀：s 表示 512 字节扇区；K 表示 KB（1KB 是 1024 字节）；M 表示 MB；G 表示 GB。</para>
     </listitem>
    </itemizedlist>
    <para>等到调整大小完成再继续。</para>
   </step>
   <step id="biuzt62" performance="required">
    <para>如果未装入该文件系统，则现在装入它。 </para>
    <para>例如，要将名为 <filename>/dev/sda1</filename> 的设备的 Ext2 文件系统装入到安装点 <filename>/home</filename>，请输入</para>

<screen>
mount -t ext2 /dev/sda1 /home
</screen>

   </step>
   <step id="biuzt63" performance="required">
    <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

    <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuzt64">
  <title>增加 Reiser 文件系统的大小</title>
  <para>ReiserFS 文件系统在装入或卸载时可增加大小。</para>
  <procedure id="biuzt65">
   <step id="biuzt66" performance="required">
    <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
   </step>
   <step id="biuzt67" performance="required">
    <para>使用以下方法之一，增加名为 <filename>/dev/sda2</filename> 的设备上文件系统的大小：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>要将文件系统大小扩展为设备的最大可用大小，请输入</para>

<screen>
resize_reiserfs /dev/sda2
</screen>

      <para>不指定大小时，这会将卷增加到分区的完整大小。 </para>
     </listitem>
     <listitem>
      <para>要将文件系统扩展为指定大小，请输入</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/sda2
</screen>

      <para>将<replaceable>大小</replaceable>替换为所需大小（以字节为单位）。您还可以为值指定单位，例如 50000K (KB)、250M (MB) 或 2G (GB)。或者，可以通过在该值前面加加号 (+) 前缀，指定对当前大小的增加量。例如，以下命令将把 <filename>/dev/sda2</filename> 上的文件系统的大小增加 500 MB：</para>

<screen>
resize_reiserfs -s +500M /dev/sda2
</screen>

     </listitem>
    </itemizedlist>
    <para>等到调整大小完成再继续。</para>
   </step>
   <step id="biuzt68" performance="required">
    <para>如果未装入该文件系统，则现在装入它。 </para>
    <para>例如，要将设备 <filename>/dev/sda2</filename> 的 ReiserFS 文件系统装入到安装点 <filename>/home</filename>，请输入</para>

<screen>
mount -t reiserfs /dev/sda2 /home
</screen>

   </step>
   <step id="biuzt69" performance="required">
    <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

    <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuzt6a">
  <title>减小 Ext2 或 Ext3 文件系统的大小</title>
  <para>卸载卷时，可以缩小 Ext2、Ext3 或 Ext4 文件系统的大小。</para>
  <procedure id="biuzt6b">
   <step id="biuzt6c" performance="required">
    <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
   </step>
   <step id="bt5yjdr" performance="required">
    <para>卸载文件系统。</para>
   </step>
   <step id="biuzt6d" performance="required">
    <para>要减小 <filename>/dev/sda1</filename> 之类的设备上文件系统的大小，请输入</para>

<screen>
resize2fs /dev/sda1 &lt;size&gt;
</screen>

    <para>将<replaceable>大小</replaceable>替换为所需大小的整数值（单位为 KB）。（1 KB 是 1024 字节。）</para>
    <para>等到调整大小完成再继续。</para>
   </step>
   <step id="biuzt6e" performance="required">
    <para>装入文件系统。例如，要将名为 <filename>/dev/sda1</filename> 的设备的 Ext2 文件系统装入到安装点 <filename>/home</filename>，请输入</para>

<screen>
mount -t ext2 /dev/md0 /home
</screen>

   </step>
   <step id="biuzt6f" performance="required">
    <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

    <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuzt6g">
  <title>减小 Reiser 文件系统的大小</title>
  <para>仅当卷卸载后，才能减小 Reiser 文件系统的大小。 </para>
  <procedure id="biuzt6h">
   <step id="biuzt6i" performance="required">
    <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
   </step>
   <step id="biuzt6j" performance="required">
    <para>通过输入以下命令卸载设备</para>

<screen>
umount /mnt/point
</screen>

    <para>如果您尝试减小大小的分区包含文件系统（例如 root (<filename>/</filename>) 卷），则仅当从可引导 CD 或软盘引导时，才可以卸载。</para>
   </step>
   <step id="biuzt6k" performance="required">
    <para>要减小名为 <filename>/dev/sda1</filename> 的设备上文件系统的大小，请输入</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/sda2
</screen>

    <para>将<replaceable>大小</replaceable>替换为所需大小（以字节为单位）。您还可以为值指定单位，例如 50000K (KB)、250M (MB) 或 2G (GB)。或者，可以通过在该值前面加减号 (-) 前缀，指定对当前大小的减小量。例如，以下命令将 <filename>/dev/md0</filename> 上的文件系统的大小减小 500 MB：</para>

<screen>
resize_reiserfs -s -500M /dev/sda2
</screen>

    <para>等到调整大小完成再继续。</para>
   </step>
   <step id="biuzt6l" performance="required">
    <para>通过输入以下命令装入文件系统 </para>

<screen>
mount -t reiserfs /dev/sda2 /mnt/point
</screen>

   </step>
   <step id="biuzt6m" performance="required">
    <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

    <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" id="uuid" lang="en" revision="03/15/10" xml:base="03_uuid.xml">
 <title>使用 UUID 装入设备</title>
 <para>本章描述在引导加载程序文件和 <filename>/etc/fstab</filename> 文件中可以选择使用 UUID 而不是设备名来标识文件系统设备。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="udev" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="understanduuid" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidbootx86" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidbootia64" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidmoreinfo" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="udev">
  <title>使用 udev 命名设备</title>
  <para>在 Linux 2.6 和更新的内核中，<command>udev</command> 使用永久性设备命名，为动态的 <filename>/dev</filename> 目录提供了一种用户空间解决方案。作为热插拔系统的一部分，在系统中添加或删除设备时会执行 <command>udev</command>。</para>
  <para>使用一个规则列表来针对特定设备属性进行匹配。<command>udev</command> 规则基础设施（在 <filename>/etc/udev/rules.d</filename> 目录中定义）为所有磁盘设备提供了稳定的名称，无论它们的识别顺序或该设备使用的连接如何。<command>udev</command> 工具检查内核创建的用来根据特定总线、驱动器类型或文件系统应用命名规则的每个相应块设备。有关如何为 <command>udev</command> 定义您自己的规则的信息，请参见 <ulink url="http://reactivated.net/writing_udev_rules.html"><citetitle>Writing udev Rules</citetitle></ulink>（编写 udev 规则）。 </para>
  <para>和动态的内核提供的设备节点名一起，<command>udev</command> 还在 <filename>/dev/disk</filename> 目录中维护有指向该设备的永久符号链接的类，该目录进一步按 <filename>by-id</filename>、<filename>by-label</filename>、<filename>by-path</filename> 和 <filename>by-uuid</filename> 子目录分类。 </para>
  <note>
   <para>除了 <command>udev</command> 之外的其他程序（如 LVM 或 <command>md</command>）也可生成 UUID，但它们不在 <filename>/dev/disk</filename> 中列出。</para>
  </note>
 </sect1>
 <sect1 id="understanduuid">
  <title>了解 UUID</title>
  <para>UUID（全球唯一标识符）是表示文件系统的 128 位数字，在本地系统和其他系统中都是唯一的。它是使用系统硬件信息和时戳作为其源的一部分随机生成的。UUID 通常用于唯一性标记设备。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="usinguuid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="findinguuid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="usinguuid">
   <title>使用 UUID 组装或激活文件系统设备</title>
   <para>UUID 在分区中总是唯一的，不取决于它出现的顺序或装入的位置。当某些 SAN 设备挂接到服务器时，系统分区会重命名并移到最后一个设备。例如，如果在安装期间将 root (<filename>/</filename>) 指派给 <filename>/dev/sda1</filename>，则在连接 SAN 之后它会被指派给 <filename>/dev/sdg1</filename>。避免此问题的一个方法是在引导加载程序和引导设备的 <filename>/etc/fstab</filename> 文件中使用 UUID。 </para>
   <para>无论设备的装入位置如何，制造商为驱动器指派的设备 ID 不会更改，所以总是可以在引导时找到它。UUID 是文件系统的一个属性，如果重新格式化驱动器，UUID 会更改。在引导加载程序文件中，通常要指定设备位置（例如 <filename>/dev/sda1</filename>）以在系统引导时装入。引导加载程序可以使用设备的 UUID 和管理员指定的卷标装入它们。但是，如果使用卷标和文件位置，则在分区装入后不能更改卷标名称。 </para>
   <para>您可以使用 UUID 作为组装和激活软件 RAID 设备的条件。当创建 RAID 时，<command>md</command> 驱动程序会为该设备生成一个 UUID，并将该值储存在 <filename>md</filename> 超块中。 </para>
  </sect2>
  <sect2 id="findinguuid">
   <title>查找文件系统设备的 UUID</title>
   <para>您可以在 <filename>/dev/disk/by-uuid</filename> 目录中找到任何块设备的 UUID。例如，UUID 如下所示：</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a 
</screen>

  </sect2>
 </sect1>
 <sect1 id="uuidbootx86">
  <title>在引导加载程序和 /etc/fstab 文件 (x86) 中使用 UUID</title>
  <para>安装之后，可以选择使用以下过程在 x86 系统的引导加载程序和 <filename>/etc/fstab</filename> 文件中配置系统设备的 UUID。</para>
  <para>开始之前，请制作 <filename>/boot/grub/menu.1st</filename> 文件和 <filename>/etc/fstab</filename> 文件的副本。</para>
  <procedure id="b4pdcrj">
   <step id="b4pdcrk" performance="required">
    <para>在没有连接 SAN 设备的情况下，安装 SUSE Linux Enterprise Server for x86。</para>
   </step>
   <step id="b4pde5j" performance="required">
    <para>安装之后引导系统。</para>
   </step>
   <step id="b4pdeci" performance="required">
    <para>作为 <systemitem>root</systemitem> 用户或具有相同权限的用户打开终端控制台。</para>
   </step>
   <step id="b4pdejm" performance="required">
    <para>导航至 <filename>/dev/disk/by-uuid</filename> 目录以查找安装了 <filename>/boot</filename>、<filename>/root</filename> 和 <filename>swap</filename> 的设备的 UUID。</para>
    <substeps performance="required">
     <step id="b4pdgjc" performance="required">
      <para>在终端控制台提示符下，输入 </para>

<screen>
cd /dev/disk/by-uuid
</screen>

     </step>
     <step id="b4pdhde" performance="required">
      <para>通过输入以下命令列出所有分区</para>

<screen>
ll
</screen>

     </step>
     <step id="b4pdhy7" performance="required">
      <para>查找 UUID，如</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>

     </step>
    </substeps>
   </step>
   <step id="b4pdk3y" performance="required">
    <para>使用 YaST 中的“引导加载程序”选项或使用文本编辑器编辑 <filename>/boot/grub/menu.1st</filename> 文件。 </para>
    <para>例如，更改</para>

<screen>
kernel /boot/vmlinuz root=/dev/sda1
</screen>

    <para>更改为</para>

<screen>
kernel /boot/vmlinuz root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>

    <important>
     <para>如果您犯了一个错误，可以在不连接 SAN 的情况下引导服务器，并使用 <filename>/boot/grub/menu.1st</filename> 文件的备份副本作为指导修复该错误。</para>
    </important>
    <para>如果使用 YaST 中的“引导加载程序”选项，会有一个缺陷，即它会在您更改某个值时向引导加载程序文件中添加一些重复的行。使用编辑器删除以下重复的行：</para>

<screen>
color white/blue black/light-gray
</screen>


<screen>
default 0
</screen>


<screen>
timeout 8
</screen>


<screen>
gfxmenu (sd0,1)/boot/message
</screen>

    <para>当使用 YaST 更改 root (<filename>/</filename>) 设备装入的方式（如按 UUID 或按卷标），需要再次保存引导加载程序配置以使更改对引导加载程序有效。</para>
   </step>
   <step id="b4pdl03" performance="required">
    <para>作为 <systemitem>root</systemitem> 用户或具有相同权限的用户，执行以下操作之一以将 UUID 放置在 <filename>/etc/fstab</filename> 文件中。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>以 <systemitem>root</systemitem> 用户身份启动 YaST，选择<menuchoice> <guimenu>系统</guimenu><guimenu>分区程序</guimenu></menuchoice>，并选择所需设备，然后修改 <guimenu>Fstab 选项</guimenu>。</para>
     </listitem>
     <listitem>
      <para>编辑 <filename>/etc/fstab</filename> 文件，将系统设备的位置修改为 UUID。</para>
      <para>例如，如果 root (<filename>/</filename>) 卷的设备路径为 <filename>/dev/sda1</filename>，并且其 UUID 是 <filename>e014e482-1c2d-4d09-84ec-61b3aefde77a</filename>，则将行项 </para>

<screen>
/dev/sda1   /            reiserfs   acl,user_xattr        1 1
</screen>

      <para>更改为</para>

<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1 
</screen>

      <important>
       <para>不要在文件中留下垃圾字符或空格。</para>
      </important>
     </listitem>
    </itemizedlist>
   </step>
  </procedure>
 </sect1>
 <sect1 id="uuidbootia64">
  <title>在引导加载程序和 /etc/fstab 文件 (IA64) 中使用 UUID</title>
  <para>安装之后，使用以下过程在 IA64 系统的引导加载程序和 <filename>/etc/fstab</filename> 文件中配置系统设备的 UUID。IA64 使用 EFI BIOS。其文件系统配置文件是 <filename>/boot/efi/SuSE/elilo.conf</filename>，而不是 <filename>/etc/fstab</filename>。</para>
  <para>开始之前，制作 <filename>/boot/efi/SuSE/elilo.conf</filename> 文件的一个副本。</para>
  <procedure id="b4pec1b">
   <step id="b4pec1c" performance="required">
    <para>在没有连接 SAN 设备的情况下，安装 SUSE Linux Enterprise Server for IA64。</para>
   </step>
   <step id="b4pec1d" performance="required">
    <para>安装之后引导系统。</para>
   </step>
   <step id="b4pec1e" performance="required">
    <para>作为 <systemitem>root</systemitem> 用户或具有相同权限的用户打开终端控制台。</para>
   </step>
   <step id="b4pec1f" performance="required">
    <para>导航至 <filename>/dev/disk/by-uuid</filename> 目录以查找安装了 <filename>/boot</filename>、<filename>/root</filename> 和 <filename>swap</filename> 的设备的 UUID。</para>
    <substeps performance="required">
     <step id="b4pec1h" performance="required">
      <para>在终端控制台提示符下，输入 </para>

<screen>
cd /dev/disk/by-uuid
</screen>

     </step>
     <step id="b4pec1i" performance="required">
      <para>通过输入以下命令列出所有分区</para>

<screen>
ll
</screen>

     </step>
     <step id="b4pec1j" performance="required">
      <para>查找 UUID，如</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>

     </step>
    </substeps>
   </step>
   <step id="b4pec1k" performance="required">
    <para>使用 YaST 中的“引导加载程序”选项编辑引导加载程序文件。 </para>
    <para>例如，更改</para>

<screen>
root=/dev/sda1
</screen>

    <para>更改为</para>

<screen>
root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>

   </step>
   <step id="b4pec1l" performance="required">
    <para>编辑 <filename>/boot/efi/SuSE/elilo.conf</filename> 文件以将系统设备的位置修改为 UUID。</para>
    <para>例如，更改</para>

<screen>
/dev/sda1   /   reiserfs   acl,user_xattr        1 1
</screen>

    <para>更改为</para>

<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1
</screen>

    <important>
     <para>不要在文件中留下垃圾字符或空格。</para>
    </important>
   </step>
  </procedure>
 </sect1>
 <sect1 id="uuidmoreinfo">
  <title>其他信息</title>
  <para>有关使用 <command>udev(8)</command> 管理设备的详细信息，请参见《<citetitle>SUSE Linux Enterprise Server 11 管理指南</citetitle>》中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_admin/data/cha_udev.html"><quote>用 udev 动态管理内核设备</quote></ulink>。</para>
  <para>有关 <command>udev(8)</command> 命令的更多信息，请参见其手册页。在终端控制台提示符下输入以下命令：</para>

<screen>
man 8 udev
</screen>

 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" id="multipathing" lang="en" revision="03/15/10" xml:base="04_mpio.xml">
 <title>管理设备的多路径 I/O </title>
 <para>本章描述如何管理服务器和块储存设备之间多个路径的故障转移和路径负载平衡。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="mpioovw" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="be5rvii" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiotools" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiosysconf" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostart" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bkj8n9w" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="scandev" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostatus" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioerrormgmt" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostall" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpirk" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpionext" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="mpioovw">
  <title>了解多路径 I/O</title>
  <para>多路径是服务器与跨多个物理路径（这些路径在服务器中的主机总线适配器和设备储存控制器之间）的同一物理或逻辑块储存设备通讯的能力，通常是在光纤通道 (FC) 或 iSCSI SAN 环境中。当多个通道可用时，您还可以实现与直接挂接的储存器的多个连接。 </para>
  <para>Linux 的多路径提供连接容错，并可以跨多个活动连接提供负载平衡。当多路径已配置并且正在运行时，它会自动隔离和识别设备连接故障，并重路由 I/O 以改变连接。 </para>
  <para>常见连接问题包括适配器、电缆或控制器故障。当为一个设备配置多路径 I/O 时，多路径驱动程序将监视设备之间的活动连接。当多路径驱动程序检测到一个活动路径出现 I/O 错误时，它会故障转移到该设备的指定备用路径。当首选路径再次正常时，控制权会返回到首选路径。</para>
 </sect1>
 <sect1 id="be5rvii">
  <title>规划多路径</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpioovwguide" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122uvel" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingmdadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14ff9rs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bleqcv0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="be5rs3a" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="be5ruyr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="mpioovwguide">
   <title>多路径准则</title>
   <para>当规划多路径 I/O 解决方案时，请使用本节中的准则。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg2qyg" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2qpf" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2qgh" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2q2x" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pi0" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pdq" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pdr" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="beg2qyg">
    <title>先决条件</title>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>多路径在设备级别进行管理。 </para>
     </listitem>
     <listitem>
      <para>用于多路径设备的储存阵列必须支持多路径。有关详细信息，请参见<xref linkend="be5ruyr" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>仅当在服务器中的主机总线适配器和块储存设备的主机总线控制器之间存在多个物理路径时，才需要配置多路径。您可以将逻辑设备的多路径配置为对服务器可见。 </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="beg2qpf">
    <title>供应商提供的多路径解决方案</title>
    <para>对于某些储存阵列，供应商提供其自己的多路径软件以管理该阵列物理和逻辑设备的多路径。在这种情况下，您应遵循供应商关于为这些设备配置多路径的说明。</para>
   </sect3>
   <sect3 id="beg2qgh">
    <title>磁盘管理任务</title>
    <para>尝试为有多个路径的物理或逻辑设备配置多路径之前，请执行以下磁盘管理任务：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>使用第三方工具将物理磁盘刻为几个较小的逻辑磁盘。</para>
     </listitem>
     <listitem>
      <para>使用第三方工具将物理或逻辑磁盘分区。如果在运行的系统中更改分区，设备映射程序多路径 (DM-MP) 模块不会自动检测和反映这些更改。DM-MPIO 必须重新初始化，这通常要求重引导。</para>
     </listitem>
     <listitem>
      <para>使用第三方 SAN 阵列管理工具创建和配置硬件 RAID 设备。</para>
     </listitem>
     <listitem>
      <para>使用第三方 SAN 阵列管理工具创建诸如 LUN 的逻辑设备。给定阵列支持的逻辑设备类型取决于阵列供应商。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="beg2q2x">
    <title>软件 RAID</title>
    <para>Linux 软件 RAID 管理软件在多路径的基础上运行。对于具有多个 I/O 路径以及您计划在软件 RAID 中使用的每个设备，必须将该设备配置为支持多路径，才能尝试创建软件 RAID 设备。不能自动发现多路径设备。软件 RAID 并不了解在底层运行的多路径管理。</para>
    <para>有关为现有软件 RIAD 设置多路径的信息，请参见<xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="beg2pi0">
    <title>高可用性解决方案</title>
    <para>群集储存资源的高可用性解决方案基于每个节点上的多路径服务运行。请确保每个节点上的 <filename>/etc/multipath.conf</filename> 文件中的配置设置在整个集群中保持一致。 </para>
    <para>请确保所有设备上的多路径设备名称相同，可采用的方法如下： </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>使用 UUID 和别名确保多路径设备名称在集群中的所有节点上保持一致。别名在所有节点上必须唯一。从该节点将 <filename>/etc/multipath.conf </filename>文件复制到集群中所有其他节点的 <filename>/etc/</filename> 目录。</para>
     </listitem>
     <listitem>
      <para>当使用多路径映射设备的链接时，请确保在 <filename>/dev/disk/by-id</filename> 目录中指定 <filename>dm-uuid*</filename> 名称或别名，而不是设备的固定路径实例。有关信息，请参阅<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>将 <literal>user_friendly_names</literal> 配置选项设置为“no”以禁用它。用户友好名称对某个节点是唯一的，但集群中各个节点上的设备不得指派相同的用户友好名称。 </para>
      <para>您可以强制让系统定义的用户友好名称在集群中的所有节点上保持一致，方法如下：</para>
      <orderedlist spacing="normal">
       <listitem>
        <para>在一个节点上的 <filename>/etc/multipath.conf</filename> 文件中： </para>
        <orderedlist spacing="normal">
         <listitem>
          <para>将 <literal>user_friendly_names</literal> 配置选项设置为“yes”以启用它。 </para>
          <para>多路径使用 <filename>/var/lib/multipath/bindings</filename> 文件以 <filename>/dev/mapper </filename>目录中的 <filename>mpath&lt;<replaceable>n</replaceable>&gt;</filename> 格式为设备指派一个永久唯一的名称。 </para>
         </listitem>
         <listitem>
          <para>（可选）设置 <literal>/etc/multipath.conf</literal> 文件的 <literal>defaults</literal> 部分中的 <literal>bindings_file</literal> 选项，以指定 <filename>bindings</filename> 文件的备用位置。 </para>
          <para>默认位置为 <filename>/var/lib/multipath/bindings</filename>。</para>
         </listitem>
        </orderedlist>
       </listitem>
       <listitem>
        <para>设置该节点上的所有多路径设备。</para>
       </listitem>
       <listitem>
        <para>从该节点将 <filename>/etc/multipath.conf </filename>文件复制到集群中所有其他节点的 <filename>/etc/</filename> 目录。</para>
       </listitem>
       <listitem>
        <para>从该节点将 <filename>bindings</filename> 文件复制到集群中所有其他节点的 <filename>bindings_file</filename> 路径。 </para>
       </listitem>
      </orderedlist>
     </listitem>
    </itemizedlist>
    <para>用于跨 LAN 镜像设备的分布式复制块设备 (DRBD) 高可用性解决方案在多路径的基础上运行。对于具有多个 I/O 路径并且您计划在 DRDB 解决方案中使用的每个设备，必须先将该设备配置为支持多路径，再配置 DRBD。</para>
   </sect3>
   <sect3 id="beg2pdq">
    <title>卷管理器</title>
    <para>诸如 LVM2 以及集群的 LVM2 等卷管理器在多路径的基础上运行。必须先配置设备的多路径，才能使用 LVM2 或 cLVM2 在该设备上创建段管理器和文件系统。有关信息，请参阅<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="beg2pdr">
    <title>虚拟化环境</title>
    <para>当在虚拟化环境中使用多路径时，多路径在主机服务器环境中控制。先配置设备的多路径，再将其指派给虚拟 Guest 计算机。</para>
   </sect3>
  </sect2>
  <sect2 id="b122uvel">
   <title>multipath-tools-0.4.9 中的 PRIO 设置</title>
   <para>SLES 11 SP2 将 multipath-tools 从 0.4.8 升级到 0.4.9。PRIO 语法经过了一些更改，会要求您视需要手动更改 <filename>/etc/multipath.conf</filename> 文件，以符合新语法的要求。</para>
   <para><filename>/etc/multipath.conf</filename> 文件中针对 <literal>prio</literal> 关键字的语法在 <filename>multipath-tools-0.4.9</filename> 中已更改。<literal>prio</literal> 行用于指定优先级排序程序。如果优先级排序程序需要自变量，您要在第二行上使用 <literal>prio_args</literal> 关键字指定自变量。而在以往，则是 <literal>prio</literal> 行包含优先级排序程序以及其自变量。</para>
   <para>多路径工具 0.4.9 和更高版本使用 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 部分中的 <literal>prio</literal> 设置。当为 <literal>multipaths{}</literal> 部分中的单个 <literal>multipath</literal> 定义指定关键字 <literal>prio</literal> 时，它将被忽略而无反馈。在适用于 SLES 11 SP1 的多路径工具 0.4.8 以及早期版本中，允许使用 <literal>multipaths{}</literal> 部分中单个 <literal>multipath</literal> 定义中的 prio 设置来覆盖 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 部分中的 <literal>prio</literal> 设置。</para>
  </sect2>
  <sect2 id="mpiousingdev">
   <title>为多路径设备使用 WWID、用户友好名称以及别名</title>
   <para role="intro">多路径设备可以按 WWID、用户友好名称或您指派的别名进行唯一标识。格式为 <filename>/dev/sdn</filename> 和 <filename>/dev/dm-n</filename> 的设备节点名称在重引导时会发生更改，且每次都可能会被指派给不同的设备。而设备的 WWID、用户友好名称以及别名则在重引导期间始终不变，因此是标识设备的首选方式。</para>
   <para>如果要直接使用整个 LUN（例如，如果正在使用 SAN 功能对储存区分区），只要将名称 <filename>/dev/disk/by-id/xxx</filename> 用于 <command>mkfs</command>、<command>fstab</command>、应用程序等即可。已分区设备的设备名称后将追加 <filename>_part&lt;n&gt;</filename>，例如 <filename>/dev/disk/by-id/xxx_part1</filename>。</para>
   <para>在 <filename>/dev/disk/by-id</filename> 目录中，通过设备名 <filename>dm-uuid*</filename> 或别名（如果在 <filename>/etc/multipath.conf</filename> 文件中为其指派了别名）表示多路径映射设备。设备名 <filename>scsi-</filename> 和 <filename>wwn-</filename> 表示设备的物理路径。 </para>
   <important>
    <para>当使用多路径映射设备的链接时，请确保在 <filename>/dev/disk/by-id</filename> 目录中指定 <filename>dm-uuid*</filename> 名称或别名，而不是设备的固定路径实例。</para>
   </important>
   <para>在 <filename>/etc/multipath.conf</filename> 文件中定义设备别名时，请确保使用每个设备的 WWID（如 <filename>3600508e0000000009e6baa6f609e7908</filename>）而不是它的 WWN（以 <filename>0x</filename> 替换设备 ID 的第一个字符，如 <filename>0x600508e0000000009e6baa6f609e7908</filename>）。 </para>
   <para>有关使用多路径设备的用户友好名称以及别名的信息，请参见<xref linkend="mpionames" xrefstyle="HeadingOnPage"/>。</para>
  </sect2>
  <sect2 id="mpiousinglvm">
   <title>在多路径设备上使用 LVM2</title>
   <para>请确保 <filename>lvm.conf</filename> 的配置文件指向多路径设备名称而不是固定路径名称。如果已启用 <filename>boot.multipath</filename> 且要在 <filename>boot.lvm</filename> 之前加载，则应自动完成这一步骤。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b13iv5ro" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b13iv6p5" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b13iv6p6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b13iv5ro">
    <title>将多路径设备过滤器添加到 /etc/lvm/lvm.conf 文件</title>
    <para>默认情况下，LVM2 不能识别多路径设备。要让 LVM2 将多路径设备识别为可能的物理卷，则必须修改 <filename>/etc/lvm/lvm.conf</filename>，以通过多路径 I/O 层扫描多路径设备。 </para>
    <para>通过添加多路径过滤器，可以防止 LVM 扫描和使用代表 SAN (/dev/sd*) 的单个路径的原始设备节点的物理路径。请确保指定过滤器路径，以便 LVM 在配置多路径后仅会扫描设备 (<filename>/dev/disk/by-id/dm-uuid-.*-mpath-.*</filename>) 的设备映射程序名称。</para>
    <para>要修改 <filename>/etc/lvm/lvm.conf</filename> 以支持多路径用途：</para>
    <procedure id="bg89qbw">
     <step id="bg89qbx" performance="required">
      <para>在文本编辑器中打开 <filename>/etc/lvm/lvm.conf</filename>。</para>
      <para>如果 <filename>/etc/lvm/lvm.conf</filename> 不存在，可以根据当前的 LVM 配置，通过在终端控制台提示符处输入以下信息进行创建：</para>

<screen>
lvm dumpconfig &gt; /etc/lvm/lvm.conf
</screen>

     </step>
     <step id="bg89qku" performance="required">
      <para>将 <literal>/etc/lvm/lvm.conf</literal> 中的 <literal>filter</literal> 和 <filename>types</filename> 条目作如下更改： </para>

<screen>
filter = [ "a|/dev/disk/by-id/.*|", "r|.*|" ]
types = [ "device-mapper", 1 ]
</screen>

      <para>这使 LVM2 仅扫描 by-id 路径而拒绝其他。 </para>
      <para>如果要使用用户友好的名称，请指定过滤器路径，以便在配置多路径后仅对设备映射程序名称进行扫描。以下过滤器路径仅接受多路径设备上的分区：</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*-mpath-.*|", "r|.*|" ]
</screen>

      <para>要同时接受设备映射程序名称的原始磁盘以及分区，请按如下方式指定路径，<filename>mpath</filename> 前不要使用连字符 (-)：</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*mpath-.*|", "r|.*|" ]
</screen>

     </step>
     <step id="bg89rst" performance="required">
      <para>如果还要在非多路径设备上使用 LVM2，请在 <literal>filter</literal> 和 <literal>types</literal> 条目中作必要的调整以符合您的设置。否则，针对多路径修改 <filename>lvm.conf</filename> 文件后，不能使用 <command>pvscan</command> 看到其他 LVM 设备。 </para>
      <para>您只希望将配置了 LVM 的设备纳入 LVM 缓存中，因此请确保指定了要通过过滤器包括的其他非多路径设备。</para>
      <para>例如，如果本地磁盘是 <filename>/dev/sda</filename>，所有 SAN 设备在 <filename>/dev/sdb</filename> 及以上位置，请按如下方式指定本地和多路径路径：</para>

<screen>
filter = [ "a|/dev/sda.*|", "a|/dev/disk/by-id/.*|", "r|.*|" ]
types = [ "device-mapper", 253 ]
</screen>

     </step>
     <step id="bg89rib" performance="required">
      <para>保存文件。</para>
     </step>
     <step id="bg89zhw" performance="required">
      <para>向 <filename>/etc/sysconfig/kernel:INITRD_MODULES</filename> 中添加 dm-multipath。</para>
     </step>
     <step id="bg8aqrw" performance="required">
      <para>制作新的 <filename>initrd</filename> 以确保设备映射程序多路径服务使用更改后的设置装载。只有 root (/) 设备或其任何部分（比如 <filename>/var</filename>、<filename>/etc</filename> 和 <filename>/log</filename>）在 SAN 上且需要使用多路径引导，才需要运行 <command>mkinitrd</command>。</para>
      <para>在终端控制台提示符下输入以下命令：</para>

<screen>
mkinitrd -f multipath
</screen>

     </step>
     <step id="bg89rnr" performance="required">
      <para>重引导服务器以应用更改。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="b13iv6p5">
    <title>启用 boot.multipath</title>
    <para>必须在 LVM 之前加载多路径，以确保正确建立多路径映射。在 LVM 之后加载多路径可能会导致多路径设备的设备映射不完整，这是因为 LVM 会锁定设备，造成 MPIO 无法正确创建映射。 </para>
    <para>如果系统设备是未使用 MPIO 和 LVM 的本地设备，则您可以同时禁用 <filename>boot.multipath</filename> 和 <filename>boot.lvm</filename>。服务器启动后，您可以在启动 LVM 之前手动启动多路径，然后运行 <command>pvscan</command> 命令以识别 LVM 对象。</para>
   </sect3>
   <sect3 id="b13iv6p6">
    <title>LVM 设备的 MPIO 映射查错</title>
    <para>启动 LVM 进程的时机十分重要。如果在完成 MPIO 映射之前启动 LVM，则 LVM 可能会使用该设备的固定路径而不是其多路径。由于设备运行正常，因此您在固定路径失败前可能不会意识到设备的 MPIO 映射是不完整的。您可以通过启用 <filename>boot.multipath</filename> 并遵循<xref linkend="b13iv5ro" xrefstyle="HeadingOnPage"/>中的说明帮助防止发生该问题。 </para>
    <para>要查错映射问题，可以使用 <command>dmsetup</command> 命令检查每一个多路径设备是否拥有预期数量的路径。以 <systemitem>root</systemitem> 用户身份在命令提示符处输入以下内容：</para>

<screen>
dmsetup ls --tree
</screen>

    <para>在下面的示例响应中，第一台设备有四个路径。第二台设备是单路径的本地设备。第三台设备有两个路径。此工具不会报告主动和被动路径之间的差异。</para>

<screen>
  vg910-lv00 (253:23)
    └─ 360a980006465576657346d4b6c593362 (253:10)
      |- (65:96)
      |- (8:128)
      |- (8:240)
      └─ (8:16)
  vg00-lv08 (253:9)
    └─ (8:3)
  system_vg-data_lv (253:1)
    └─36006016088d014007e0d0d2213ecdf11 (253:0)
      ├─ (8:32)
      └─ (8:48)
</screen>

    <para>不正确的映射通常会返回很少的路径，且不含主号 253。例如，以下显示第三台设备的不正确映射情况：</para>

<screen>
  system_vg-data_lv (8:31)
     └─ (8:32)
</screen>

   </sect3>
  </sect2>
  <sect2 id="mpiousingmdadm">
   <title>对多路径设备使用 mdadm</title>
   <para><command>mdadm</command> 工具要求使用 ID 而不是设备节点路径访问设备。因此，应按照以下方式设置 <filename>/etc/mdadm.conf</filename> 文件中的 <systemitem>DEVICE</systemitem> 项，以确保在配置多路径后仅对设备映射程序名称进行扫描：</para>

<screen>
DEVICE /dev/disk/by-id/dm-uuid-.*mpath-.*
</screen>

   <para>如果要使用用户友好的名称或多路径别名，请按以下方式指定路径：</para>

<screen>
DEVICE /dev/disk/by-id/dm-name-.*
</screen>

  </sect2>
  <sect2 id="b14ff9rs">
   <title>使用 NetApp 设备的多路径</title>
   <para>使用适用于 NetApp 设备的多路径时，建议在 <filename>/etc/multipath.conf</filename> 文件中进行如下设置：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>为 NetApp 设备全局设置以下参数的默认值：</para>

<screen>
max_fds max

queue_without_daemon no
</screen>

    </listitem>
    <listitem>
     <para>在硬件表中为 NetApp 设备的以下参数设置默认值：</para>

<screen>
dev_loss_tmo infinity

fast_io_fail_tmo 5

features "3 queue_if_no_path pg_init_retries 50"
</screen>

    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bleqcv0">
   <title>对多路径设备使用 --noflush</title>
   <para>在多路径设备上运行时，应始终使用 <literal>--noflush</literal>选项。 </para>
   <para>例如，在执行重新装载表的脚本中，应继续使用 <literal>--noflush</literal> 选项以确保任何未解决的 I/O 不会被刷新，因为您需要多路径拓扑信息。</para>

<screen>
load
resume --noflush
</screen>

  </sect2>
  <sect2 id="bok8cn1">
   <title>根设备为多路径时的 SAN 超时设置</title> 
   <para>当多路径设备上的所有路径都失败并从系统中删除时，这些设备上的 root (<filename>/</filename>) 系统可能会停止运行，因为从储存子系统（如光纤通道储存阵列）中接收到 <literal>dev_loss_tmo</literal> 超时信息。 </para>
   <para>如果系统设备配置了多路径，且多路径 <literal>no_path_retry</literal> 设置处于活动状态，则应相应地修改储存子系统的 <literal>dev_loss_tmo</literal> 设置，以确保所有路径都失败时不会删除任何设备。强烈建议您将 <literal>dev_loss_tmo</literal> 值设置为等于或大于多路径的 <literal>no_path_retry</literal> 设置。</para>
   <para>建议将储存子系统的 <literal>dev_los_tmo</literal> 值设置为：</para>

<screen>
&lt;dev_loss_tmo&gt; = &lt;no_path_retry&gt; * &lt;polling_interval&gt;
</screen>

   <para>以下定义适用于多路径值：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><literal>no_path_retry</literal> 是将路径视为丢失并停止 IO 排队前多路径 I/O 的重试次数。 </para>
    </listitem>
    <listitem>
     <para><literal>polling_interval</literal> 是路径检查的间隔时间（以秒为单位）。</para>
    </listitem>
   </itemizedlist>
   <para>以上多路径值都应该从 <filename>/etc/multipath.conf</filename> 配置文件进行设置。有关信息，请参阅<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="mpiousingpart">
   <title>将多路径设备分区</title>
   <para>如果进行升级，则对多路径设备分区方式的行为更改可能会影响配置。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="binawqz" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="binazqd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="binazxj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="binawqz">
    <title>SUSE Linux Enterprise Server 11</title>
    <para>在 SUSE Linux Enterprise Server 11 中，默认多路径设置依靠 <command>udev</command> 在多路径启动时重写 <filename>/dev/disk/by-id</filename> 目录中的现有符号链接。在启动多路径之前，链接使用其名称 <filename>scsi-xxx</filename> 指向 SCSI 设备。多路径运行时，符号链接使用其名称 <filename>dm-uuid-xxx</filename> 指向设备。这可确保 <filename>/dev/disk/by-id</filename> 路径中的符号链接始终指向同一设备，无论是否启动多路径。 </para>
    <para>请确保 <filename>lvm.conf</filename> 和 <filename>md.conf</filename> 的配置文件指向多路径设备名称。如果已启用 <filename>boot.multipath</filename> 且在 <filename>boot.lvm</filename> 和 <filename>boot.md</filename> 之前加载，则应自动完成这一步骤。否则，LVM 和 MD 配置文件可能会包含多路径设备的固定路径，且您必须对那些路径进行更正，以使用多路径设备名称。有关 LVM2 和 cLVM 的信息，请参见<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。有关软件 RAID 的信息，请参见<xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="binazqd">
    <title>SUSE Linux Enterprise Server 10</title>
    <para>在 SUSE Linux Enterprise Server 10 中，对于任何新创建的分区，将使用 <filename>/etc/init.d/boot.multipath</filename> 中的 <filename>kpartx</filename> 软件向 <filename>multipath.conf</filename> 中的 <filename>/dev/dm-*</filename> 行添加符号链接，而无需重引导。这将触发 <filename>udevd</filename> 填写 <filename>/dev/disk/by-*</filename> 符号链接。主要好处是您可以使用新的参数调用 <filename>kpartx</filename>，而无需重引导服务器。</para>
   </sect3>
   <sect3 id="binazxj">
    <title>SUSE Linux Enterprise Server 9</title>
    <para>在 SUSE Linux Enterprise Server 9 中，不能将多路径 I/O 设备本身分区。如果底层物理设备已经分区，则多路径 I/O 设备会反映出那些分区，该层会提供 <filename>/dev/disk/by-id/&lt;name&gt;p1 ... pN</filename> 设备，以便可以通过多路径 I/O 层访问那些分区。因此，在启用多路径 I/O 之前需要将这些设备分区。如果在运行的系统中更改分区，DM-MPIO 不会自动检测并反映这些更改。该设备必须重新初始化，这通常要求重引导。 </para>
   </sect3>
  </sect2>
  <sect2 id="be5rs3a">
   <title>多路径 I/O 支持的体系结构</title>
   <para>多路径驱动程序和工具支持所有七种受支持的处理器体系结构：IA32、AMD64/EM64T、IPF/IA64、p-Series（32 位和 64 位）和 z-Series（31 位和 64 位）。</para>
  </sect2>
  <sect2 id="be5ruyr">
   <title>多路径支持的储存阵列</title>
   <para>多路径驱动程序和工具支持多数储存阵列。存放多路径设备的储存阵列必须支持多路径，才能使用多路径驱动程序和工具。某些储存阵列供应商提供自己的多路径管理工具。请查看供应商的硬件文档以确定需要哪些设置。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="be5s8ae">
    <title>自动检测到支持多路径的储存阵列</title>
    <para><filename>multipath-tools</filename> 包自动检测到以下储存阵列：</para>
    <simplelist>
     <member>3PARdata VV</member> <member>AIX NVDISK</member> <member>AIX VDASD</member> <member>APPLE Xserve RAID</member> <member>COMPELNT Compellent Vol</member> <member>COMPAQ/HP HSV101、HSV111、HSV200、HSV210、HSV300、HSV400、HSV 450</member> <member>COMPAQ/HP MSA、HSV</member> <member>COMPAQ/HP MSA VOLUME</member> <member>DataCore SANmelody</member> <member>DDN SAN DataDirector</member> <member>DEC HSG80</member> <member>DELL MD3000</member> <member>DELL MD3000i</member> <member>DELL MD32xx</member> <member>DELL MD32xxi</member> <member>DGC</member> <member>EMC Clariion</member> <member>EMC Invista</member> <member>EMC SYMMETRIX</member> <member>EUROLOGC FC2502</member> <member>FSC CentricStor</member> <member>FUJITSU ETERNUS_DX、DXL、DX400、DX8000</member> <member>HITACHI DF</member> <member>HITACHI/HP OPEN</member> <member>HP A6189A</member> <member>HP HSVX700</member> <member>HP LOGICAL VOLUME</member> <member>HP MSA2012fc、MSA 2212fc、MSA2012i</member> <member>HP MSA2012sa、MSA2312 fc/i/sa、MCA2324 fc/i/sa、MSA2000s VOLUME</member> <member>HP P2000 G3 FC|P2000G3 FC/iSCSI|P2000 G3 SAS|P2000 G3 iSCSI</member> <member>IBM 1722-600</member> <member>IBM 1724</member> <member>IBM 1726</member> <member>IBM 1742</member> <member>IBM 1745、1746</member> <member>IBM 1750500</member> <member>IBM 1814</member> <member>IBM 1815</member> <member>IBM 1818</member> <member>IBM 1820N00</member> <member>IBM 2105800</member> <member>IBM 2105F20</member> <member>IBM 2107900</member> <member>IBM 2145</member> <member>IBM 2810XIV</member> <member>IBM 3303 NVDISK</member> <member>IBM 3526</member> <member>IBM 3542</member> <member>IBM IPR</member> <member>IBM Nseries</member> <member>IBM ProFibre 4000R</member> <member>IBM S/390 DASD ECKD</member> <member>IBM S/390 DASD FBA</member> <member>Intel Multi-Flex</member> <member>LSI/ENGENIO INF-01-00</member> <member>NEC DISK ARRAY</member> <member>NETAPP LUN</member> <member>NEXENTA COMSTAR</member> <member>Pillar Axiom</member> <member>PIVOT3 RAIGE VOLUME</member> <member>SGI IS</member> <member>SGI TP9100、TP 9300</member> <member>SGI TP9400、TP9500</member> <member>STK FLEXLINE 380</member> <member>STK OPENstorage D280</member> <member>SUN CSM200_R</member> <member>SUN LCSM100_[IEFS]</member> <member>SUN STK6580、STK6780</member> <member>SUN StorEdge 3510、T4</member> <member>SUN SUN_6180</member>
    </simplelist>
    <para>一般来说，其他的储存阵列多数都可以用。当自动检测到储存阵列时，将应用多路径的默认设置。如果想要使用非默认设置，则必须手动创建和配置 <filename>/etc/multipath.conf</filename> 文件。有关信息，请参见<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
    <para>使用多路径对 IBM zSeries 设备进行的测试显示，应将参数 <literal>dev_loss_tmo</literal> 设置为 90 秒，将参数 <literal>fast_io_fail_tmo</literal> 设置为 5 秒。如果要使用 zSeries 设备，必须手动创建和配置文件 <filename>/etc/multipath.conf</filename> 以指定值。有关信息，请参见<xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/>。</para>
    <para>未自动检测到的硬件需要在 <literal>/etc/multipath.conf</literal> 文件的 <filename>devices</filename> 部分中有相应的项才能进行配置。在这种情况下，必须手动创建和配置该配置文件。有关信息，请参见<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
    <para>要注意下列事项： </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>并非自动检测到的所有储存阵列都在 SUSE Linux Enterprise Server 上可以检测到。有关信息，请参见<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>某些储存阵列可能需要特定的硬件处理程序。硬件处理程序是一个内核模块，当切换路径组和处理 I/O 错误时执行特定于硬件的操作。有关信息，请参见<xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>修改 <filename>/etc/multipath.conf</filename> 文件之后，必须运行 <command>mkinitrd</command> 在您的系统上重新创建 INITRD，然后重引导使更改生效。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="mpiosuphw">
    <title>测试过的支持多路径的储存阵列</title>
    <para>以下储存阵列已经使用 SUSE Linux Enterprise Server 测试过：</para>
    <simplelist>
     <member>EMC</member> <member>Hitachi</member> <member>Hewlett-Packard/Compaq</member> <member>IBM</member> <member>NetApp</member> <member>SGI</member>
    </simplelist>
    <para>其他供应商的储存阵列多数也可以用。请查看供应商的文档以获取相关指导。有关 <filename>multipath-tools</filename> 包可以识别的默认储存阵列的列表，请参见<xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/>。</para>
   </sect3>
   <sect3 id="be5s6p6">
    <title>需要特定硬件处理程序的储存阵列</title>
    <para>要求特殊命令来进行一个路径向另一路径故障转移的储存阵列或要求特殊非标准错误处理的储存阵列，可能要求更多支持。因此，设备映射程序多路径服务有用于硬件处理程序的钩子。例如，已为 EMC CLARiiON CX 系列的阵列提供了一个此类处理程序。 </para>
    <important>
     <para>请查看硬件供应商的文档以确定是否必须为设备映射程序多路径安装其硬件处理程序。</para>
    </important>
    <para><command>multipath -t</command> 命令显示一个要求使用特定硬件处理程序进行特殊处理的内部储存阵列表。显示的列表不是受支持储存阵列的穷举列表。仅列出要求特殊处理并且在工具开发期间 <filename>multipath-tools</filename> 开发人员可以访问的那些阵列。</para>
    <important>
     <para>真正支持活动/活动多路径的阵列不要求特殊处理，所以 <command>multipath -t</command> 命令不会列出它们。 </para>
    </important>
    <para><command>multipath -t</command> 表中的列表不一定表示在该特定硬件上测试过 SUSE Linux Enterprise Server。对于已测试过的储存阵列的列表，请参见<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>。</para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="mpiotools">
  <title>多路径管理工具</title>
  <para>SUSE Linux Enterprise Server 10 和更高版本中的多路径支持基于 Linux 2.6 内核的设备映射程序多路径模块和 <systemitem>multipath-tools</systemitem> 用户空间包。您可以使用 Multiple Devices Administration 实用程序（MDADM，<command>mdadm</command>）查看多路径设备的状态。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpiotoolsdm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiotoolsmpt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiotoolsmdadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="beep4ms" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="mpiotoolsdm">
   <title>设备映射程序多路径模块</title>
   <para>设备映射程序多路径 (DM-MP) 模块为 Linux 提供多路径功能。DM-MPIO 是 SUSE Linux Enterprise Server 11 上的首选多路径解决方案。它是随该产品提供的唯一多路径选项，完全受 Novell 和 SUSE 支持。 </para>
   <para>DM-MPIO 可以为各种设置自动配置多路径子系统。支持每个设备至多 8 个路径的配置。支持活动/不活动（一个路径活动、其他路径不活动）或活动/活动（所有路径都是活动，带循环负载平衡）的配置。 </para>
   <para>DM-MPIO 框架可按两种方式扩展： </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>使用特定硬件处理程序。有关信息，请参见<xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/>。</para>
    </listitem>
    <listitem>
     <para>使用比循环算法更精准的负载平衡算法</para>
    </listitem>
   </itemizedlist>
   <para>DM-MPIO 的用户空间组件负责自动路径发现和分组以及自动路径再测试，以便原先失败的路径在重新修复之后可以自动恢复使用。这可以最大程度地降低管理员对生产环境的关注。</para>
   <para>DM-MPIO 保护设备路径以及设备本身不会出故障。如果一个活动路径丢失（例如，一个网络适配器 I/O 断开或光纤电缆被删除），I/O 会重定向到剩余的路径。如果该配置是活动/不活动，则路径会故障转移到一个不活动路径。如果正在使用循环负载平衡配置，则会在剩余正常路径间平衡通讯量。如果所有活动路径均失败，则必须唤醒不活动的辅助路径，这样会发生故障转移，但延迟大约 30 秒钟。</para>
   <para>如果一个磁盘阵列有多个储存处理器，请确保 SAN 交换机连接到拥有要访问的 LUN 的储存处理器。在多数磁盘阵列上，所有 LUN 均属于这两个储存处理器，所以两个连接都是活动的。 </para>
   <note>
    <para>在某些磁盘阵列上，储存阵列通过储存处理器管理通讯，以便一次仅显示一个储存处理器。一个处理器是活动的，另一个是不活动的，直到发生故障。如果您连接到错误的储存处理器（具有不活动路径的那个），则可能无法看到所需的 LUN，或者可能看到这些 LUN，但在尝试访问它们时会出错。 </para>
   </note>
   <table id="b567ef1" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>储存阵列的多路径 I/O 功能</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2857*"/>
    <colspec colnum="2" colname="2" colwidth="7144*"/>
     <thead>
      <row id="b567fx1">
       <entry>
        <para>储存阵列的功能</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b567fx2">
       <entry>
        <para>活动/不活动控制器</para>
       </entry>
       <entry>
        <para>一个控制器是活动的，为所有 LUN 提供服务。第二个控制器充当备用控制器。第二个控制器还将 LUN 提供给多路径组件，以便操作系统了解冗余路径。如果主控制器失败，第二个控制器会接管，并且它为所有 LUN 提供服务。</para>
        <para>在某些阵列中，LUN 可以指派给不同的控制器。给定的 LUN 指派给要充当活动控制器的一个控制器。一个控制器每次为任何给定的 LUN 执行磁盘 I/O，第二个控制器是该 LUN 的备用控制器。第二个控制器也提供这些路径，但不可执行磁盘 I/O。使用该 LUN 的服务器连接到该 LUN 的指派的控制器。如果一组 LUN 的主控制器失败，第二个控制器会接管，并且它为所有 LUN 提供服务。</para>
       </entry>
      </row>
      <row id="b567fx3">
       <entry>
        <para>活动/活动控制器</para>
       </entry>
       <entry>
        <para>两个控制器共享所有 LUN 的负载，并且可以处理任何给定 LUN 的磁盘 I/O。如果一个控制器失败，第二个处理器会自动处理所有通讯。</para>
       </entry>
      </row>
      <row id="b567fx4">
       <entry>
        <para>负载平衡</para>
       </entry>
       <entry>
        <para>设备映射程序多路径驱动程序自动对所有活动路径中的通讯平衡负载。</para>
       </entry>
      </row>
      <row id="b567fx6">
       <entry>
        <para>控制器故障转移</para>
       </entry>
       <entry>
        <para>当活动控制器故障转移到不活动控制器（或备用控制器）时，设备映射程序多路径驱动程序会自动激活主机和备用控制器之间的路径，使它们成为主路径。 </para>
       </entry>
      </row>
      <row id="b567fx5">
       <entry>
        <para>引导/根设备支持</para>
       </entry>
       <entry>
        <para>在 SUSE Linux Enterprise Server 10 和更高版本中，根 (<filename>/</filename>) 设备支持多路径。主机服务器必须连接到引导设备当前活动的控制器和储存处理器。</para>
        <para>在 SUSE Linux Enterprise Server 11 和更高版本中，<filename>/boot</filename> 设备支持多路径。 </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>设备映射程序多路径将多路径设备的每个路径检测为独立的 SCSI 设备。SCSI 设备名的格式为 <filename>/dev/sd<replaceable>N</replaceable></filename>，其中 <filename><replaceable>N</replaceable></filename> 是为该设备自动生成的字母，从 a 开始，并在设备创建时顺序发放，例如 <filename>/dev/sda</filename>、<filename>/dev/sdb</filename> 等。如果设备数超过 26，则会使用两个字母，这样在 <filename>/dev/sdz</filename> 后的下一个设备将命名为 <filename>/dev/sdaa</filename>、<filename>/dev/sdab</filename> 等。</para>
   <para>如果未自动检测到多路径，则您可以在 <filename>/etc/multipath.conf</filename> 文件中手动配置它们。<filename>multipath.conf</filename> 文件在您创建和配置之前是不存在的。有关信息，请参见<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="mpiotoolsmpt">
   <title>多路径 I/O 管理工具</title>
   <para><command>multipath-tools</command> 用户空间包负责路径的自动发现和分组。它会定期自动测试该路径，以便当一个先前失败的路径重新正常之后，自动重新恢复使用该路径。这可以最大程度地降低管理员对生产环境的关注。</para>
   <table id="b59pxng" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>multipath-tools 包中的工具</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2857*"/>
    <colspec colnum="2" colname="2" colwidth="7144*"/>
     <thead>
      <row id="b59q186">
       <entry>
        <para>工具</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b59q187">
       <entry>
        <para>multipath</para>
       </entry>
       <entry>
        <para>扫描系统中的多路径设备并组装它们。</para>
       </entry>
      </row>
      <row id="b59q188">
       <entry>
        <para>multipathd</para>
       </entry>
       <entry>
        <para>等候映射事件，然后执行 <command>multipath</command>。</para>
       </entry>
      </row>
      <row id="b59q189">
       <entry>
        <para>devmap-name</para>
       </entry>
       <entry>
        <para>为设备映射 (devmaps) 的 <command>udev</command> 提供有意义的设备名。</para>
       </entry>
      </row>
      <row id="b59q18a">
       <entry>
        <para>kpartx</para>
       </entry>
       <entry>
        <para>将线性 devmaps 映射到多路径设备上的分区，使得能够为设备上的分区创建多路径监视。</para>
       </entry>
      </row>
      <row id="b15jwqx6">
       <entry>
        <para>mpathpersist</para>
       </entry>
       <entry>
        <para>管理设备映射程序多路径设备上的 SCSI 永久保留。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>包文件列表会随不同的服务器体系结构而异。有关多路径工具包中所包括的文件列表，请转至 <ulink url="http://www.novell.com/products/server/techspecs.html?tab=1"><citetitle>SUSE Linux Enterprise Server Technical Specifications</citetitle>（SUSE Linux Enterprise Server 技术规范）&gt; <citetitle>Package Descriptions</citetitle>（包说明）网页</ulink>，找到您的体系结构并选择 <guimenu>Packages Sorted by Name</guimenu>（按名称排列的包），然后在<quote>multipath-tools</quote>（多路径工具）上搜索以找到该体系结构的包列表。</para>
   <para>您还可以通过查询包本身来确定 RPM 文件的文件列表：使用 <command>rpm -ql</command> 或 <command>rpm -qpl</command> 命令选项。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>要查询已安装的包，请输入</para>

<screen>
rpm -ql &lt;<replaceable>package_name</replaceable>&gt;
</screen>

    </listitem>
    <listitem>
     <para>要查询未安装的包，请输入</para>

<screen>
rpm -qpl &lt;<replaceable>URL_or_path_to_package</replaceable>&gt;
</screen>

    </listitem>
   </itemizedlist>
   <para>要检查是否已安装 <filename>multipath-tools</filename> 包，请执行以下命令：</para>
   <procedure id="bcmre1m">
    <step id="bcmre1n" performance="required">
     <para>在终端控制台提示符下输入以下命令：</para>

<screen>
rpm -q multipath-tools
</screen>

     <para>如果已安装，响应会重复包名并提供版本信息，例如：</para>

<screen>
multipath-tools-04.7-34.23
</screen>

     <para>如果未安装，响应如下：</para>

<screen>
package multipath-tools is not installed
</screen>

    </step>
   </procedure>
  </sect2>
  <sect2 id="mpiotoolsmdadm">
   <title>对多路径设备使用 MDADM</title>
   <para>udev 是默认设备处理程序，系统会自动知道设备的全球 ID 而不是设备节点名。它解决了以前版本的 MDADM 和 LVM 中的问题，即配置文件（<filename>mdadm.conf</filename> 和 <filename>lvm.conf</filename>）不能正确识别多路径设备。 </para>
   <para>（仅对于 LVM2）MDADM 要求使用 ID 而不是设备节点路径访问设备。因此，<filename>/etc/mdadm.conf</filename> 中的 <systemitem>DEVICE</systemitem> 项应如下设置： </para>

<screen>
DEVICE /dev/disk/by-id/*
</screen>

   <para>如果要使用用户友好的名称，请按以下方式指定路径，以便在配置多路径后仅对设备映射程序名称进行扫描：</para>

<screen>
DEVICE /dev/disk/by-id/dm-uuid-.*-mpath-.*
</screen>

   <para>校验 MDADM 已安装：</para>
   <procedure id="bcmrfp3">
    <step id="bcmrfp4" performance="required">
     <para>确保通过在终端控制台提示符处输入以下命令安装 <filename>mdadm</filename> 包：</para>

<screen>
rpm -q mdadm
</screen>

     <para>如果已安装，响应会重复包名并提供版本信息。例如：</para>

<screen>
mdadm-2.6-0.11
</screen>

     <para>如果未安装，响应如下：</para>

<screen>
package mdadm is not installed
</screen>

    </step>
   </procedure>
   <para>有关修改 <filename>/etc/lvm/lvm.conf</filename> 文件的信息，请参见<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="beep4ms">
   <title>Linux 的 multipath(8) 命令</title>
   <para>使用 Linux 的 <command>multipath(8)</command> 命令配置和管理多路径设备。</para>
   <para><command>multipath(8)</command> 命令的常规语法：</para>

<screen>
multipath [-v verbosity_level] [-b bindings_file] [-d] [-h|-l|-ll|-f|-F|-B|-c|-q|-r|-w|-W] [-p failover|multibus|group_by_serial|group_by_prio|group_by_node_name] [<replaceable>devicename</replaceable>]
</screen>

   <bridgehead id="b15drtkg">选项</bridgehead>
   <variablelist>
    <varlistentry id="b15drtkh">
     <term>-v verbosity_level</term>
     <listitem>
      <para>打印所有路径和多路径。</para>
      <variablelist>
       <varlistentry id="b15drtki">
        <term>0</term>
        <listitem>
         <para>无输出。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drtkj">
        <term>1 </term>
        <listitem>
         <para>仅打印已创建或更新的多路径名称。用于推送 <command>kpartx</command> 等其他工具。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drtkk">
        <term>2+</term>
        <listitem>
         <para>打印所有信息：检测到的路径、多路径以及设备映射。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkl">
     <term>-h</term>
     <listitem>
      <para>打印用法文本。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkm">
     <term>-d</term>
     <listitem>
      <para>试运行：不创建或更新设备映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkn">
     <term>-l</term>
     <listitem>
      <para>基于从 <filename>sysfs</filename> 和设备映射程序中提取的信息显示当前的多路径拓扑结构。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtko">
     <term>-ll</term>
     <listitem>
      <para>基于所有可用的信息（sysfs、设备映射程序、路径检查程序等）显示当前的多路径拓扑结构。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkp">
     <term>-f</term>
     <listitem>
      <para>清理指定为参数的多路径设备映射（如果未使用）。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkq">
     <term>-F</term>
     <listitem>
      <para>刷新所有未用多路径设备映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkr">
     <term>-t</term>
     <listitem>
      <para>将内部硬件表打印到 <filename>stdout</filename> 中。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtks">
     <term>-r</term>
     <listitem>
      <para>强制重新装载设备映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkt">
     <term>-B</term>
     <listitem>
      <para>将绑定文件视为只读文件。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtku">
     <term>-b bindings_file</term>
     <listitem>
      <para>设置绑定文件 user_friendly_names 的位置。默认位置为 <filename>/etc/multipath/bindings</filename>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkv">
     <term>-c</term>
     <listitem>
      <para>检查块设备是否应该是多路径设备中的一个路径。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkw">
     <term>-q</term>
     <listitem>
      <para><filename>multipathd</filename> 未运行时，允许设置了 <literal>queue_if_no_path</literal> 的设备表。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkx">
     <term>-w</term>
     <listitem>
      <para>从 WWID 文件中去除指定设备的 WWID。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtky">
     <term>-W</term>
     <listitem>
      <para>重设置 WWID 文件，只包括当前的多路径设备。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drv6f">
     <term>-p 策略</term>
     <listitem>
      <para>强制新映射使用指定的策略。系统不会修改现有的映射。</para>
      <variablelist>
       <varlistentry id="b15drv6g">
        <term>failover</term>
        <listitem>
         <para>每个优先级组一个路径。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6h">
        <term>multibus</term>
        <listitem>
         <para>一个优先级组中的所有路径。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6i">
        <term>group_by_serial</term>
        <listitem>
         <para>每个序列对应一个优先级组。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6j">
        <term>group_by_prio</term>
        <listitem>
         <para>每个优先级值对应一个优先级组。优先级由调出程序来决定，在配置文件中指定为 global、per-controller 或 per-multipath 选项。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6k">
        <term>group_by_node_name</term>
        <listitem>
         <para>每个目标节点名一个优先级组。目标节点名是在 <filename>/sys/class/fc_transport/target*/node_name</filename> 中获取的。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drx1o">
     <term>device_name</term>
     <listitem>
      <para>仅更新指定设备的设备映射。将该名称指定为设备路径（例如 <filename>/dev/sdb</filename>），或者采用 <literal><replaceable>major</replaceable>:<replaceable>minor</replaceable></literal> 格式，或指定为多路径映射名称。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="beep4mt">常规示例</bridgehead>
   <variablelist>
    <varlistentry id="bomamxl">
     <term>multipath</term>
     <listitem>
      <para>配置所有多路径设备。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomalct">
     <term>multipath <replaceable>设备名</replaceable></term>
     <listitem>
      <para>配置特定多路径设备。</para>
      <para>使用诸如 <filename>/dev/sdb</filename>（如 udev 的 $DEVNAME 变量中所示）或<literal>主要:次要</literal>格式的设备节点名替换<replaceable>设备名</replaceable>。也可以使用该设备的多路径映射名称。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomamxm">
     <term>multipath -f</term>
     <listitem>
      <para>选择性地抑制多路径映射及其设备映射的分区。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomamxn">
     <term>multipath -d</term>
     <listitem>
      <para>排演。显示潜在多路径设备，但不创建任何设备，也不更新设备映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomamxo">
     <term>multipath -v2 -d</term>
     <listitem>
      <para>显示试运行中潜在多路径设备的多路径映射信息。-v2 选项仅显示本地磁盘。这种详细级别仅打印创建或更新的多路径名称，用于为 kpartx 之类的其他工具提供输入。 </para>
      <para>如果设备已经存在且未作更改，则无输出。使用 <command>multipath -ll</command> 可以查看配置的多路径设备的状态。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc3">
     <term>multipath -v2 <replaceable>设备名</replaceable></term>
     <listitem>
      <para>配置特定潜在多路径设备并显示它的多路径映射信息。这种详细级别仅打印创建的或更新的多路径名称，以用来为 <command>kpartx</command> 之类的其他工具提供输入。 </para>
      <para>如果设备已经存在且未作更改，则无输出。使用 <command>multipath -ll</command> 可以查看配置的多路径设备的状态。</para>
      <para>使用诸如 <filename>/dev/sdb</filename>（如 <command>udev</command> 的 $DEVNAME 变量中所示）或<literal>主要:次要</literal>格式的设备节点名替换<replaceable>设备名</replaceable>。也可以使用该设备的多路径映射名称。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc4">
     <term>multipath -v3</term>
     <listitem>
      <para>配置潜在多路径设备并显示它们的多路径映射信息。这种详细级别打印所有检测到的路径、多路径和设备映射。它同时显示 wwid 和 devnode 列入黑名单的设备。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc5">
     <term>multipath -v3 <replaceable>设备名</replaceable></term>
     <listitem>
      <para>配置特定潜在多路径设备并显示相关信息。-v3 选项显示完整的路径列表。这种详细级别打印所有检测到的路径、多路径和设备映射。它同时显示 wwid 和 devnode 列入黑名单的设备。</para>
      <para>使用诸如 <filename>/dev/sdb</filename>（如 <command>udev</command> 的 $DEVNAME 变量中所示）或<literal>主要:次要</literal>格式的设备节点名替换<replaceable>设备名</replaceable>。也可以使用该设备的多路径映射名称。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc6">
     <term>multipath -ll</term>
     <listitem>
      <para>显示所有多路径设备的状态。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomasgg">
     <term>multipath -ll <replaceable>设备名</replaceable></term>
     <listitem>
      <para>显示特定多路径设备的状态。</para>
      <para>使用诸如 <filename>/dev/sdb</filename>（如 <command>udev</command> 的 $DEVNAME 变量中所示）或<literal>主要:次要</literal>格式的设备节点名替换<replaceable>设备名</replaceable>。也可以使用该设备的多路径映射名称。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc7">
     <term>multipath -F</term>
     <listitem>
      <para>刷新所有未用多路径设备映射。它不解析多路径，且不删除设备。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomasgh">
     <term>multipath -F <replaceable>设备名</replaceable></term>
     <listitem>
      <para>刷新特定多路径设备的未用多路径设备映射。它不解析多路径，且不删除设备。</para>
      <para>使用诸如 <filename>/dev/sdb</filename>（如 <command>udev</command> 的 $DEVNAME 变量中所示）或<literal>主要:次要</literal>格式的设备节点名替换<replaceable>设备名</replaceable>。也可以使用该设备的多路径映射名称。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomasgi">
     <term>multipath -p [ failover | multibus | group_by_serial | group_by_prio | group_by_node_name ]</term>
     <listitem>
      <para>如<xref linkend="beg177b" xrefstyle="TableXRef"/>中所述，指定任一组策略选项来设置组策略：</para>
      <table id="beg177b" role="1" frame="topbot" rowsep="1" pgwide="0" width="96%">
       <title>multipath -p 命令的组策略选项</title>
       <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="2684*"/>
       <colspec colnum="2" colname="2" colwidth="7319*"/>
        <thead>
         <row id="beep4mu">
          <entry>
           <para>策略选项</para>
          </entry>
          <entry>
           <para>描述</para>
          </entry>
         </row>
        </thead>
        <tbody>
         <row id="beep4mv">
          <entry>
           <para>failover</para>
          </entry>
          <entry>
           <para>（默认）每个优先级组对应一个路径。您一次只能使用一个路径。</para>
          </entry>
         </row>
         <row id="beep4mw">
          <entry>
           <para>multibus</para>
          </entry>
          <entry>
           <para>一个优先级组中的所有路径。</para>
          </entry>
         </row>
         <row id="beep4mx">
          <entry>
           <para>group_by_serial</para>
          </entry>
          <entry>
           <para>每个检测到的 SCSI 序列号（控制器节点全球编号）一个优先级组。</para>
          </entry>
         </row>
         <row id="beep4my">
          <entry>
           <para>group_by_prio</para>
          </entry>
          <entry>
           <para>每个路径优先级值一个优先级组。具有相同优先级的路径在同一优先级组中。优先级由调出程序在 <filename>/etc/multipath.conf</filename> 配置文件中指定为 global、per-controller 或 per-multipath 选项来确定。</para>
          </entry>
         </row>
         <row id="beep4mz">
          <entry>
           <para>group_by_node_name</para>
          </entry>
          <entry>
           <para>每个目标节点名一个优先级组。目标节点名是在 <filename>/sys/class/fc_transport/target*/node_name</filename> 位置获取的。</para>
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b15jw320">
   <title>Linux mpathpersist(8) 实用程序</title>
   <para><command>mpathpersist(8)</command> 实用程序可用来管理设备映射程序多路径设备上的 SCSI 永久保留。 </para>
   <para><command>mpathpersist(8)</command> 命令的常规语法：</para>

<screen>
mpathpersist [options] [device]
</screen>

   <para>将此实用程序与 <filename>/etc/multipath.conf</filename> 文件中的服务操作保留密钥（<literal>reservation_key</literal> 属性）搭配使用，设置 SCSI 设备的永久保留。默认情况下不会使用该属性。如果未设置该属性，<command>multipathd</command> 守护程序不会检查新发现的路径或已重新启用的路径的永久保留。 </para>

<screen>
reservation_key &lt;<replaceable>reservation key</replaceable>&gt;
</screen>

   <para>您可以将该属性添加到 <literal>defaults</literal> 或 <literal>multipaths</literal> 部分。例如：</para>

<screen>
multipaths {
        multipath {
                          wwid   XXXXXXXXXXXXXXXX
                         alias      yellow
                         reservation_key  0x123abc
      }
}
</screen>

   <para>设置所有适合永久管理的多路径设备的 <literal>reservation_key</literal> 参数，然后重启动 <command>multipathd</command> 守护程序：设置它之后，您可以在 mpathpersist 命令中指定保留密钥。</para>
   <bridgehead id="b15jw321">选项</bridgehead>
   <variablelist>
    <varlistentry id="b15jwii5">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>输出命令用法信息，然后退出。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwii6">
     <term>-d &lt;<replaceable>设备</replaceable>&gt;</term>
     <term>--device=&lt;<replaceable>设备</replaceable>&gt;</term>
     <listitem>
      <para>查询或更改设备。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwii7">
     <term>-H</term>
     <term>--hex</term>
     <listitem>
      <para>以十六进制显示输出响应。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwii8">
     <term>-X &lt;TID&gt;</term>
     <term>--transportID=&lt;TID&gt;</term>
     <listitem>
      <para>可以用多种形式提及传输 ID。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jw322">
     <term>-v &lt;<replaceable>级别</replaceable>&gt;</term>
     <term>--verbose &lt;<replaceable>级别</replaceable>&gt;</term>
     <listitem>
      <para>指定冗长级别。</para>
      <variablelist>
       <varlistentry id="b15jw323">
        <term>0</term>
        <listitem>
         <para>重要讯息以及错误讯息。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15jw324">
        <term>1 </term>
        <listitem>
         <para>警告讯息。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15jw325">
        <term>2</term>
        <listitem>
         <para>信息性讯息。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15jw326">
        <term>3</term>
        <listitem>
         <para>启用了跟踪的信息性讯息。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="b15jwii9">PR In 选项</bridgehead>
   <variablelist>
    <varlistentry id="b15jwiie">
     <term>-i</term>
     <term>--位于</term>
     <listitem>
      <para>请求 PR In 命令。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiih">
     <term>-k</term>
     <term>--read-keys</term>
     <listitem>
      <para>PR In：读取密钥。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiim">
     <term>-s</term>
     <term>--read-status</term>
     <listitem>
      <para>PR In：读取完整状态。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiin">
     <term>-r</term>
     <term>--read-reservation</term>
     <listitem>
      <para>PR In：读取保留。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiir">
     <term>-c</term>
     <term>--report-capabilities</term>
     <listitem>
      <para>PR In：报告功能。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="b15jwiiz">PR Out 选项</bridgehead>
   <variablelist>
    <varlistentry id="b15jwij0">
     <term>-o</term>
     <term>--拔出</term>
     <listitem>
      <para>请求 PR Out 命令。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij1">
     <term>-c</term>
     <term>--清除</term>
     <listitem>
      <para>PR Out：清除</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij2">
     <term>-Z</term>
     <term>--param-aptpl</term>
     <listitem>
      <para>PR Out 参数 <literal>APTPL</literal>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij3">
     <term>-S SARK</term>
     <term>--param-sark=SARK</term>
     <listitem>
      <para>以十六进制打印出参数 Service Action Reservation Key (SARK)。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij4">
     <term>-P</term>
     <term>--preempt</term>
     <listitem>
      <para>PR Out：抢先。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij5">
     <term>-A</term>
     <term>--preempt-abort</term>
     <listitem>
      <para>PR Out：抢先与中止。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij6">
     <term>-T &lt;<replaceable>类型</replaceable>&gt;</term>
     <term>--prout-type=&lt;<replaceable>类型</replaceable>&gt;</term>
     <listitem>
      <para>PR Out 命令类型。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij7">
     <term>-G</term>
     <term>--注册</term>
     <listitem>
      <para>PR Out：注册。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij8">
     <term>-I</term>
     <term>--register-ignore</term>
     <listitem>
      <para>PR Out：注册并忽略。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij9">
     <term>-L</term>
     <term>--释放</term>
     <listitem>
      <para>PR Out：释放</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwija">
     <term>-R</term>
     <term>--保留</term>
     <listitem>
      <para>PR Out：保留。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="b15jwmcx">示例</bridgehead>
   <para>注册 <filename>/dev/mapper/mpath9</filename> 设备的服务操作保留密钥。</para>

<screen role="compact2">
mpathpersist --out --register --param-sark=123abc --prout-type=5 -d /dev/mapper/mpath9
</screen>

   <para>读取 <filename>/dev/mapper/mpath9</filename> 设备的服务操作保留密钥。</para>

<screen role="compact2">
mpathpersisst -i -k -d /dev/mapper/mpath9
</screen>

   <para>保留 <filename>/dev/mapper/mpath9</filename> 设备的服务操作保留密钥。</para>

<screen role="compact2">
mpathpersist --out --reserve --param-sark=123abc --prout-type=8 -d /dev/mapper/mpath9
</screen>

   <para>读取 <filename>/dev/mapper/mpath9</filename> 设备的保留状态。</para>

<screen role="compact2">
mpathpersist -i -s -d /dev/mapper/mpath9
</screen>

  </sect2>
 </sect1>
 <sect1 id="mpiosysconf">
  <title>为多路径配置系统</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpiosysconfsandevs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiosysconfpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpioboot" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="mpiosysconfsandevs">
   <title>为多路径准备 SAN 设备</title>
   <para>配置 SAN 设备的多路径 I/O 之前，请按需要执行以下操作准备 SAN 设备：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>使用供应商工具配置 SAN 并设置区域。</para>
    </listitem>
    <listitem>
     <para>使用供应商工具为储存阵列上的主机 LUN 配置访问权限。</para>
    </listitem>
    <listitem>
     <para>安装 Linux HBA 驱动程序模块。安装好模块后，驱动程序会自动扫描 HBA，以发现对该主机有访问权限的任何 SAN 设备。它将这些 SAN 设备提供给主机以进行进一步的配置。</para>
     <note>
      <para>确保您正在使用的 HBA 驱动程序没有启用本机多路径。</para>
     </note>
     <para>有关更多细节，请参见供应商的特定说明。</para>
    </listitem>
    <listitem>
     <para>装载驱动程序模块之后，发现指派给特定阵列 LUN 或分区的设备节点。</para>
    </listitem>
    <listitem>
     <para>如果将 SAN 设备用作服务器上的根设备，请按<xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/>中所述修改设备超时设置。</para>
    </listitem>
   </itemizedlist>
   <para>如果 HBA 驱动程序没有看到这些 LUN，则可以使用 <command>lsscsi</command> 检查操作系统是否正确看到这些 SCSI 设备。如果 HBA 驱动程序没有看到这些 LUN，请检查 SAN 的区域设置。特别是要检查 LUN 屏蔽是否是活动的，以及是否已将 LUN 正确指派给服务器。</para>
   <para>如果 HBA 驱动程序看到这些 LUN，但没有相应的块设备，则需要其他内核参数来更改 SCSI 设备扫描行为，例如表示 LUN 不连续编号。有关信息，请参见 <ulink url="http://support.novell.com/">Novell 支持知识库中的 <citetitle>TID 3955167：SCSI (LUN) 扫描问题查错</citetitle></ulink>。</para>
  </sect2>
  <sect2 id="mpiosysconfpart">
   <title>将多路径设备分区</title>
   <para>不建议使用但支持有多个路径的分区设备。使用 <command>kpartx</command> 工具无需重引导即可在多路径设备中创建分区。也可以在尝试配置多路径之前，使用 YaST 中的“分区程序”功能或使用第三方分区工具对设备分区。</para>
   <para>多路径设备是设备映射程序设备。虽然使用命令行工具（例如 parted、kpartx 或 fdisk）可以修改设备映射程序设备，但这并不一定会生成更新其他层所需的 udev 事件。对设备映射程序设备分区之后，您应该检查多路径映射，确保已映射设备映射程序设备。如果未映射它们，您可以重新映射多路径设备，或重引导服务器，以取得多路径映射中的所有新分区。</para>
   <para>多路径设备上的一个分区的设备映射程序设备不同于一个独立设备。使用整个设备创建 LVM 逻辑卷时，必须指定不包含分区的设备。如果将多路径分区指定为 LVM 逻辑卷的目标设备，则 LVM 会认为底层物理设备已分区，创建将会失败。如果需要细分 SAN 设备，则可以拆分 SAN 设备上的 LUN，并将每个 LUN 作为独立的多路径设备显示给服务器。</para>
  </sect2>
  <sect2 id="mpiosysconfsvr">
   <title>在 initrd 中配置设备驱动程序以使用多路径功能 </title>
   <para>您必须手动配置服务器，让其自动为多路径 IO 设备在 <literal>initrd</literal> 中所连接的控制器装载设备驱动程序。您需要向 <filename>/etc/sysconfig/kernel</filename> 文件中的 INITRD_MODULES 变量添加所需的驱动程序模块。 </para>
   <para>例如，如果系统包含 <filename>cciss</filename> 驱动程序访问的 RAID 控制器以及连接到由驱动程序 qla2xxx 访问的 Qlogic 控制器的多路径设备，该项将会如下所示： </para>

<screen>
   INITRD_MODULES="cciss"
</screen>

   <para>因为 QLogic 驱动程序没有在启动时自动装载，请在此添加： </para>

<screen>
   INITRD_MODULES="cciss qla23xx"
</screen>

   <para>更改 <filename>/etc/sysconfig/kernel</filename> 之后，必须在您的系统上使用 <literal>mkinitrd</literal> 命令重新创建 <command>initrd</command>，然后重引导使更改生效。</para>
   <para>当把 LILO 用作引导管理器时，请使用 <command>/sbin/lilo</command> 命令重新安装它。如果正在使用 GRUB，则无需进一步的操作。 </para>
   <para>从 SUSE Linux Enterprise Server 11 SP3 开始，SCSI 层中增加了四个 SCSI 硬件处理程序，它们可与 DM-Multipath 结合使用： </para>
   <simplelist>
    <member><filename>scsi_dh_alua</filename> </member> <member><filename>scsi_dh_rdac</filename> </member> <member><literal>scsi_dh_hp_sw</literal> </member> <member><literal>scsi_dh_emc</literal> </member>
   </simplelist>
   <para>将模块添加到 <filename>initrd</filename> 映像，然后在 <filename>/etc/multipath.conf</filename> 文件中将它们指定为 <literal>alua</literal>、<literal>rdac</literal>、<literal>hp_sw</literal> 和 <literal>emc</literal> 硬件处理程序类型。例如，添加以下其中一行作为设备定义：</para>

<screen>
hardware_handler "1 alua"

hardware_handler "1 rdac"

hardware_handler "1 hp_sw"

hardware_handler "1 emc"
</screen>

   <para>要在 <filename>initrd</filename> 映像中包含模块，请执行以下操作：</para>
   <procedure id="b15dscl4">
    <step id="b15dscl5" performance="required">
     <para>将设备处理程序模块添加到 <filename>/etc/sysconfig/kernel</filename> 中的 INITRD_MODULES 变量中。</para>
    </step>
    <step id="b15dscl6" performance="required">
     <para>创建新的 <filename>initrd</filename>：</para>

<screen>
mkinitrd -k /boot/vmlinux-&lt;<replaceable>flavour</replaceable>&gt; \
-i /boot/initrd-&lt;<replaceable>flavour</replaceable>&gt;-scsi-dh \
-M /boot/System.map-&lt;<replaceable>flavour</replaceable>&gt;
</screen>

    </step>
    <step id="b15dscl7" performance="required">
     <para>使用新构建的 <filename>initrd</filename> 更新引导配置文件 <filename>grub.conf</filename>、<filename>lilo.conf</filename> 和 <filename>yaboot.conf</filename>。</para>
    </step>
    <step id="b15dscl8" performance="required">
     <para>重启动服务器。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="mpioboot">
   <title>将 multipathd 添加到引导序列</title>
   <para>使用本节中的任何一种方法，将多路径 I/O 服务 (<command>multipathd</command>) 添加到引导序列。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b5c8qi6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b5c8qtj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b5c8qi6">
    <title>使用 YaST 添加 multipathd</title>
    <procedure id="b5997ck">
     <step id="b5997cl" performance="required">
      <para>在 YaST 中，单击<guimenu>系统</guimenu> &gt; <guimenu>系统服务（运行级别）</guimenu> &gt; <guimenu>简单模式</guimenu>。</para>
     </step>
     <step id="b5997cm" performance="required">
      <para>选择 <guimenu>multipathd</guimenu>，然后单击<guimenu>启用</guimenu>。 </para>
     </step>
     <step id="b5997cn" performance="required">
      <para>单击<guimenu>确定</guimenu>确认服务启动消息。</para>
     </step>
     <step id="b5997co" performance="required">
      <para>单击<guimenu>完成</guimenu>，然后单击<guimenu>是</guimenu>。</para>
      <para>服务器重启动后，更改才会生效。 </para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="b5c8qtj">
    <title>使用命令行添加 multipathd</title>
    <procedure id="b5c8qz1">
     <step id="b5c8qz2" performance="required">
      <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
     </step>
     <step id="b5c8r4x" performance="required">
      <para>在终端控制台提示符下，输入</para>

<screen>
insserv multipathd
</screen>

     </step>
    </procedure>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="mpiostart">
  <title>启用和启动多路径 I/O 服务</title>
  <para>启动多路径服务并使它们在重引导时启动：</para>
  <procedure id="b7jqkxe">
   <step id="b7jqkxg" performance="required">
    <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
   </step>
   <step id="b7jqkxh" performance="required">
    <para>在终端控制台提示符下，输入</para>

<screen>
chkconfig multipathd on
</screen>


<screen>
chkconfig boot.multipath on
</screen>

   </step>
  </procedure>
  <para>如果 boot.multipath 服务在系统引导时不自动启动，请执行以下操作以手动启动它们：</para>
  <procedure id="b5c8s8w">
   <step id="b5c8s8x" performance="required">
    <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
   </step>
   <step id="b5c8sla" performance="required">
    <para>输入</para>

<screen>
/etc/init.d/boot.multipath start
</screen>


<screen>
/etc/init.d/multipathd start
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bbillhs">
  <title>创建或修改 /etc/multipath.conf 文件</title>
  <para>只有创建 <filename>/etc/multipath.conf</filename>，该文件才会存在。除非您创建多路径配置文件并进行个性化设置，否则在运行守护程序 <command>multipathd</command> 时，将自动应用默认的多路径设备设置。<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.synthetic</filename> 文件包含一个样例文件 <filename>/etc/multipath.conf</filename>，您可以将其用作多路径设置的指导。 </para>
  <para>无论您何时创建或修改 <filename>/etc/multipath.conf</filename> 文件，当保存该文件时都不会自动应用更改。因此，在提交更改之前，您便有足够的时间进行试运行以校验这些更改。如果对更改的设置感到满意，就可以更新多路径映射以供运行的守护程序 multipathd 使用，或者这些更改将在下次重启守护程序 multipathd 时（如系统重启时）予以应用。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="beenynn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122wjjt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiohwsupconf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbj8y2r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="beenynn">
   <title>创建 /etc/multipath.conf 文件</title>
   <para>如果 <filename>/etc/multipath.conf</filename> 文件不存在，复制以下示例以创建该文件：</para>
   <procedure id="bbillht">
    <step id="bbillhu" performance="required">
     <para>在终端控制台中，作为 <systemitem>root</systemitem> 用户登录。</para>
    </step>
    <step id="bbillhv" performance="required">
     <para>输入以下命令（当然要都在一行中）以复制该模板。</para>

<screen>
cp /usr/share/doc/packages/multipath-tools/multipath.conf.synthetic /etc/multipath.conf
</screen>

    </step>
    <step id="bcmqvq2" performance="required">
     <para>使用 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename> 文件作为确定如何为您的系统配置多路径的参考。</para>
    </step>
    <step id="bcmqx5z" performance="required">
     <para>确保其中有您的 SAN 的相应 <command>device</command> 项。多数供应商提供关于正确设置 <command>device</command> 部分的文档。 </para>
     <para><filename>/etc/multipath.conf</filename> 文件要求对不同的 SAN 有不同的 <command>device</command> 部分。如果要使用自动检测到的储存子系统（请参见<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>），则可以使用该设备的默认项，不需要对 <filename>/etc/multipath.conf</filename> 文件进行任何进一步的配置。 </para>
    </step>
    <step id="bcmqweh" performance="required">
     <para>保存文件。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b122wjjt">
   <title>/etc/multipath.conf 文件中的部分</title>
   <para><filename>/etc/multipath.conf</filename> 文件由以下部分组成。请参见 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename>，它是一个模板，其中具有每种属性及其选项的大量注释。</para>
   <variablelist>
    <varlistentry id="b122vffx">
     <term>defaults</term>
     <listitem>
      <para>多路径 I/0 的常规默认设置。如果在相应的设备或多路径部分中未提供值，则会使用这些值。有关信息，请参阅<xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12donk3">
     <term>blacklist</term>
     <listitem>
      <para>列出不作为候选多路径而丢弃的设备名称。可以通过设备节点名称 (<literal>devnode</literal>)、设备 WWID (<literal>wwid</literal>) 或设备供应商或产品字符串 (<literal>device</literal>) 来识别设备。有关信息，请参阅<xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/>。</para>
      <para>您通常会忽略非多路径设备，例如 <filename>cciss</filename>、<filename>fd</filename>、<filename>hd</filename>、<filename>md</filename>、<filename>dm</filename>、<filename>sr</filename>、<filename>scd</filename>、<filename>st</filename>、<filename>ram</filename>、<filename>raw</filename> 和 <filename>loop</filename>。</para>
      <formalpara id="b122sbge" role="intro">
       <title>值</title>
       <para/>
      </formalpara>
      <para>有关示例，请参见 <xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12doufy">
     <term>blacklist_exceptions</term>
     <listitem>
      <para>列出即使包含在黑名单中仍视为候选多路径的设备的设备名称。可以通过设备节点名称 (<literal>devnode</literal>)、设备 WWID (<literal>wwid</literal>) 或设备供应商或产品字符串 (<literal>device</literal>) 来识别设备。您必须使用黑名单中使用的相同关键字指定例外的设备。例如，如果您在黑名单中使用设备关键字 devnode，则要同样使用关键字 devnode 在黑名单例外中排除一些设备。无法使用 <literal>devnode</literal> 关键字将设备列入黑名单，也无法使用 <literal>wwid</literal> 关键字排除某些设备。</para>
      <formalpara id="b122sbgg" role="intro">
       <title>值</title>
       <para/>
      </formalpara>
      <para>有关示例，请参见<xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/>和 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename> 文件。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b122vffy">
     <term>multipaths</term>
     <listitem>
      <para>指定单个多路径设备的设置。除不支持单个设置的设置外，这些值会重写配置文件的 <literal>defaults</literal> 和 <literal>devices</literal> 部分中的其他指定值。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b122vh2i">
     <term>devices</term>
     <listitem>
      <para>指定单个储存控制器的设置。这些值会重写配置文件的 <filename>defaults</filename> 部分中指定的值。如果您使用默认情况下不受支持的储存阵列，则可以创建 <literal>devices</literal> 子部分，以指定该储存阵列的默认设置。如果关键字允许，则可以使用单个多路径设备的设置重写这些值。</para>
      <para>有关信息，请参见以下内容：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
       </listitem>
       <listitem>
        <para><xref linkend="bkj8n9w" xrefstyle="SectTitleOnPage"/></para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="mpiohwsupconf">
   <title>校验 /etc/multipath.conf 文件中的多路径设置</title>
   <para>无论您何时创建或修改 <filename>/etc/multipath.conf</filename> 文件，当保存该文件时都不会自动应用更改。您可以在更新多路径映射之前对该设置执行<quote>试运行</quote>，以校验多路径设置。</para>
   <para>在服务器命令提示符处输入</para>

<screen>
<command>multipath -v2 -d</command>
</screen>

   <para>此命令会扫描设备，然后显示如果提交更改设置将产生的效果。该命令假设在您修改 <filename>/etc/multipath.conf</filename> 文件并执行试运行时，守护程序 <filename>multipathd</filename> 已使用旧的（或默认）多路径设置运行。如果更改可接受，则继续<xref linkend="bbj8y2r" xrefstyle="HeadingOnPage"/>。</para>
   <para>其输出类似于如下内容： </para>

<screen>
26353900f02796769
[size=127 GB]
[features="0"]
[hwhandler="1    emc"] 
</screen>


<screen>
\_ round-robin 0 [first]
  \_ 1:0:1:2 sdav 66:240  [ready ]
  \_ 0:0:1:2 sdr  65:16   [ready ]
</screen>


<screen>
\_ round-robin 0 
  \_ 1:0:0:2 sdag 66:0    [ready ]
  \_ 0:0:0:2 sdc   8:32   [ready ] 
</screen>

   <para>路径可分为多个优先级组。一次只有一个优先级组是活动的。要为活动/活动配置建模，所有路径都要分入同一个组。要为活动/不活动配置建模，不应该同时活动的路径要放在几个不同的优先级组中。这在设备发现中通常自动发生。 </para>
   <para>输出显示在组里用来平衡 I/O 的顺序、日程安排策略以及每个优先级组的路径。对于每个路径，显示其物理地址 (host:bus:target:lun)、设备节点名称、主要:次要编号以及状态。 </para>
   <para>在试运行中使用详细级别 -v3，即可查看所有检测到的路径、多路径和设备映射。它同时显示 WWID 和设备节点列入黑名单的设备。</para>

<screen>
multipath -v3 d
</screen>

   <para role="intro">以下示例显示了有两个 Qlogic HBA 连接到 Xiotech Magnitude 3000 SAN 的 64 位 SLES 11 SP2 服务器的 -v3 输出。为了简化示例，省略了一些多重项。</para>

<screen role="compact2">
dm-22: device node name blacklisted
&lt; content omitted &gt;
loop7: device node name blacklisted
&lt; content omitted &gt;
md0: device node name blacklisted
&lt; content omitted &gt;
dm-0: device node name blacklisted
sdf: not found in pathvec
sdf: mask = 0x1f
sdf: dev_t = 8:80
sdf: size = 105005056
sdf: subsystem = scsi
sdf: vendor = XIOtech
sdf: product = Magnitude 3D
sdf: rev = 3.00
sdf: h:b:t:l = 1:0:0:2
sdf: tgt_node_name = 0x202100d0b2028da
sdf: serial = 000028DA0014
sdf: getuid= "/lib/udev/scsi_id --whitelisted --device=/dev/%n" (config file default)
sdf: uid = 200d0b2da28001400 (callout)
sdf: prio = const (config file default)
sdf: const prio = 1
&lt; content omitted &gt;
ram15: device node name blacklisted
&lt; content omitted &gt;
===== paths list =====
uuid              hcil    dev dev_t pri dm_st  chk_st  vend/prod/rev
200d0b2da28001400 1:0:0:2 sdf 8:80  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 1:0:0:1 sde 8:64  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 1:0:0:0 sdd 8:48  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28001400 0:0:0:2 sdc 8:32  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 0:0:0:1 sdb 8:16  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 0:0:0:0 sda 8:0   1   [undef][undef] XIOtech,Magnitude 3D
params = 0 0 2 1 round-robin 0 1 1 8:80 1000 round-robin 0 1 1 8:32 1000
status = 2 0 0 0 2 1 A 0 1 0 8:80 A 0 E 0 1 0 8:32 A 0
sdf: mask = 0x4
sdf: path checker = directio (config file default)
directio: starting new request
directio: async io getevents returns 1 (errno=Success)
directio: io finished 4096/0
sdf: state = 2
&lt; content omitted &gt;
</screen>

  </sect2>
  <sect2 id="bbj8y2r">
   <title>应用 /etc/multipath.conf 文件更改以更新多路径映射</title>
   <para>对 <filename>/etc/multipath.conf</filename> 文件的更改在 <command>multipathd</command> 运行时不会生效。进行更改后，保存并关闭该文件，然后执行以下操作以应用更改并更新多路径映射：</para>
   <procedure id="bbj8ync">
    <step id="bbj8ynd" performance="required">
     <para>停止 <command>multipathd</command> 服务。</para>
    </step>
    <step id="bbj8zk2" performance="required">
     <para>通过输入以下命令，清除旧的多路径绑定</para>

<screen>
/sbin/multipath -F
</screen>

    </step>
    <step id="bbj91hd" performance="required">
     <para>通过输入以下命令，创建新的多路径绑定</para>

<screen>
/sbin/multipath -v2 -l
</screen>

    </step>
    <step id="bbj8zu9" performance="required">
     <para>启动 <command>multipathd</command> 服务。</para>
    </step>
    <step id="bi0ay0m" performance="required">
     <para>在您的系统上运行 <command>mkinitrd</command> 重新创建 <filename>initrd</filename> 映像，然后重引导使更改生效。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="bbj68de">
  <title>配置巡回检测、排队及故障回复的默认策略</title>
  <para>多路径 I/O 旨在于储存系统与服务器之间提供连接容错。所需的默认行为取决于服务器是独立服务器还是高可用性群集中的一个节点。 </para>
  <para>在配置独立服务器的多路径 I/O 时，<literal>no_path_retry</literal> 设置会保护服务器操作系统在尽可能长的时间内不会接收 I/O 错误。它会在出现多路径故障转移前将消息排队，并提供正常的连接。</para>
  <para>在为高可用性群集中的节点配置多路径 I/O 时，您需要让多路径报告 I/O 故障，以触发资源故障转移而不是等待多路径故障转移被解决。在群集环境中，您必须修改 <literal>no_path_retry</literal> 设置，以确保当与储存系统断开连接时，群集节点会收到与群集验证进程相关的 I/O 错误（建议为 Heartbeat 容错的 50%）。此外，您需要将多路径 I/O 故障回复设置为手动，以避免由于路径故障造成资源的“乒乓效应”。</para>
  <para><filename>/etc/multipath.conf</filename> 文件应包含一个 <command>defaults</command> 部分，您可以在此处指定巡回检测、排队以及故障回复的默认行为。如果该字段未另在 <command>device</command> 部分中指定，则为该 SAN 配置应用默认设置。</para>
  <para role="intro">以下为默认设置中的已编译内容。除非在创建及配置个性化 <filename>/etc/multipath.conf</filename> 文件时被重写，否则将使用这些值。</para>

<screen>
defaults {
  verbosity 2
#  udev_dir is deprecated in SLES 11 SP3
#  udev_dir              /dev
  polling_interval      5
#  path_selector default value is service-time in SLES 11 SP3
#  path_selector         "round-robin 0"
  path selector         "service-time 0"
  path_grouping_policy  failover
#  getuid_callout is deprecated in SLES 11 SP3 and replaced with uid_attribute
#  getuid_callout        "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
#  uid_attribute is new in SLES 11 SP3
  uid_attribute         "ID_SERIAL"
  prio                  "const"
  prio_args             ""
  features              "0"
  path_checker          "directio"
  alias_prefix          "mpath"
  rr_min_io_rq          1
  max_fds               "max"
  rr_weight             "uniform"
  queue_without_daemon  "yes"
  flush_on_last_del     "no"
  user_friendly_names   "no"
  fast_io_fail_tmo      5
  bindings_file         "/etc/multipath/bindings"
  wwids_file            "/etc/multipath/wwids"
  log_checker_err       "always"
  retain_attached_hw_handler  "no"
  detect_prio           "no"
  failback              "manual"
  no_path_retry         "fail"
  }
</screen>

  <para>有关巡回检测、排队和故障回复策略设置的信息，请参见<xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/>中的以下参数：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b122w0sa" xrefstyle="HeadingOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122sbgo" xrefstyle="HeadingOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122sbgh" xrefstyle="HeadingOnPage"/></para>
   </listitem>
  </itemizedlist>
  <para>如果修改 <literal>defaults</literal> 部分中的设置，在更新多路径映射或重启动 multipathd 守护程序（例如系统重启动时）之后，才会应用更改。</para>
 </sect1>
 <sect1 id="bbj5x7z">
  <title>将非多路径设备列入黑名单</title>
  <para><filename>/etc/multipath.conf</filename> 文件应包含一个 <command>blacklist</command> 部分，列出所有非多路径设备。您可以通过 WWID（<literal>wwid</literal> 关键词）、设备名称（<literal>devnode</literal> 关键词）或设备类型（<literal>device</literal> 部分）将设备加入黑名单。您还可以使用 <literal>blacklist_exceptions</literal> 部分，对通过 <literal>blacklist</literal> 部分中所用的正规表达式加入黑名单的一些设备启用多路径。 </para>
  <para>您通常会忽略<filename>cciss</filename>、<filename>fd</filename>、<filename>hd</filename>、<filename>md</filename>、<filename>dm</filename>、<filename>sr</filename>、 <filename>scd</filename>、<filename>st</filename>、<filename>ram</filename>、<filename>raw</filename>和<filename>loop</filename>等非多路径设备。例如，本地 IDE 硬盘驱动器以及软盘驱动器通常没有多路径。如果您希望 <command>multipath</command> 忽略单路径设备，请将它们放在 <command>blacklist</command> 部分。 </para>
  <note>
   <para>关键词 <literal>devnode_blacklist</literal> 已弃用且已替换为 <literal>blacklist</literal>。</para>
  </note>
  <para>例如，要将 <filename>cciss</filename> 驱动程序中的本地设备和所有阵列加入黑名单，使多路径不会管理它们，则 <command>blacklist</command> 部分将如下所示：</para>

<screen>
blacklist {
      wwid "26353900f02796769"
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
      devnode "^hd[a-z][0-9]*"
      devnode "^cciss.c[0-9]d[0-9].*"
}
</screen>

  <para>您可以仅将一个驱动程序中的分区而不是整个阵列加入黑名单。例如，您可以使用以下正规表达式，只将 <filename>cciss</filename> 驱动程序中的分区而非整个阵列加入黑名单：</para>

<screen>
blacklist {
      devnode "^cciss.c[0-9]d[0-9]*[p[0-9]*]"
}
</screen>

  <para>您可以在 blacklist 中添加 <literal>device</literal> 部分，并使用 <literal>vendor</literal> 和 <literal>product</literal> 关键词按特定设备类型加入黑名单。</para>

<screen>
blacklist {
      device {
           vendor  "DELL"
           product "*"
       }
}
</screen>

  <para>您可以使用 <literal>blacklist_exceptions</literal> 部分，对通过 <literal>blacklist</literal> 部分中所用的正规表达式加入黑名单的一些设备启用多路径。您可以通过 WWID（<literal>wwid</literal> 关键词）、设备名称（<literal>devnode</literal> 关键词）或设备类型（<literal>device</literal> 部分）添加例外。您必须以将相应设备加入黑名单的相同方式指定例外。也就是说，<literal>wwid</literal> 例外适用于 <literal>wwid</literal> 黑名单，<literal>devnode</literal> 例外适用于 <literal>devnode</literal> 黑名单，而设备类型例外适用于设备类型黑名单。</para>
  <para>例如，如果您拥有来自不同供应商的设备类型，可以针对所需的设备类型启用多路径。在 <literal>blacklist</literal> 部分中将所有供应商的设备类型加入黑名单，然后在 <literal>blacklist_exceptions</literal> 部分中添加 <literal>device</literal> 部分，针对所需的设备类型启用多路径。</para>

<screen>
blacklist {
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
      device {
           vendor  "DELL"
           product "*"
       }
}

blacklist_exceptions {
      device {
           vendor  "DELL"
           product "MD3220i"
       }
}
</screen>

  <para>您还可以使用 blacklist_exceptions 仅针对特定设备启用多路径。例如：</para>

<screen>
blacklist {
      wwid "*"
}

blacklist_exceptions {
        wwid "3600d0230000000000e13955cc3751234"
        wwid "3600d0230000000000e13955cc3751235"
}
</screen>

  <para>修改 <filename>/etc/multipath.conf</filename> 文件之后，必须在您的系统上运行 <command>mkinitrd</command> 以重新创建 <filename>initrd</filename>，然后重启动服务器，以使更改生效。 </para>
  <para>之后，当发出 <command>multipath -ll</command> 命令时，这些本地设备应不再列于多路径映射中。</para>
 </sect1>
 <sect1 id="mpionames">
  <title>配置用户用好的名称或别名</title>
  <para role="intro">多路径设备可以按 WWID、用户友好的名称或您指派的别名进行标识。开始之前，请查看<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/>中的要求。</para>
  <important>
   <para>因为格式为 <filename>/dev/sdn</filename> 和 <filename>/dev/dm-n</filename> 的设备节点名称在重引导时会发生更改，所以最好使用其 WWID 来表示多路径设备。为了在重引导时唯一标识设备，您也可以使用与 WWID 映射的用户友好名称或别名。</para>
  </important>
  <para><xref linkend="bq7xokx" xrefstyle="TableXRef"/>描述了可用于 <filename>/etc/multipath.conf</filename> 文件中的设备的设备名称类型。有关 <filename>multipath.conf</filename> 设置的示例，请参见 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.synthetic</filename> 文件。 </para>
  <table id="bq7xokx" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <title>多路径设备名称类型比较</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="1667*"/>
   <colspec colnum="2" colname="2" colwidth="8334*"/>
    <thead>
     <row id="bq7xoky">
      <entry>
       <para>名称类型</para>
      </entry>
      <entry>
       <para>描述</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="bq7xokz">
      <entry>
       <para>WWID（默认）</para>
      </entry>
      <entry>
       <para>WWID（全球标识符）序列是保证全球唯一且不会更改的多路径设备标识符。在多路径中使用的默认名称是 <filename>/dev/disk/by-id</filename> 目录中的逻辑单元的 ID。例如，WWID 为 <literal>3600508e0000000009e6baa6f609e7908</literal> 的设备将作为 <filename>/dev/disk/by-id/scsi-3600508e0000000009e6baa6f609e7908</filename> 列出。</para>
      </entry>
     </row>
     <row id="bq7xol0">
      <entry>
       <para>用户友好</para>
      </entry>
      <entry>
       <para><filename>/dev/mapper</filename> 目录中的设备映射程序多路径设备名称也参考逻辑单元的 ID。这些多路径设备名称都是用户友好的名称，格式为 <filename>/dev/mapper/mpath&lt;<replaceable>n</replaceable>&gt;</filename>，比如 <filename>/dev/mapper/mpath0</filename>。名称是唯一且永久的，因为它们使用 <filename>/var/lib/multipath/bindings</filename> 文件跟踪 UUID 和用户友好的名称之间的关联。 </para>
      </entry>
     </row>
     <row id="bq7xol1">
      <entry>
       <para>别名</para>
      </entry>
      <entry>
       <para>别名是由管理员为多路径设备提供的全局唯一名称。别名覆盖 WWID 和用户友好的 <filename>/dev/mapper/mpathN</filename> 名称。</para>
       <para>如果使用 user_friendly_names，则不要将别名设置为 mpathN 格式。否则可能会与自动指派的用户友好名称产生冲突，导致所提供的设备节点名称不正确。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
  <para><filename>/etc/multipath.conf</filename> 文件中的全局多路径 <literal>user_friendly_names</literal> 选项用于对多路径设备启用或禁用用户友好的名称。如果设置为“no”（默认），多路径将使用 WWID 作为设备名称。如果设置为“yes”，多路径将使用 <filename>/var/lib/multipath/bindings</filename> 文件以 <filename>/dev/mapper <replaceable>目录中的 </replaceable>mpath&lt;</filename>n<filename>&gt;</filename> 格式为设备指派一个永久唯一的名称。<literal>/etc/multipath.conf</literal> 文件中的 <literal>bindings_file</literal> 选项可用于指定 <filename>bindings</filename> 文件的备用位置。 </para>
  <para><filename>/etc/multipath.conf</filename> 文件中的全局多路径 <literal>alias</literal> 选项用于明确为设备指派一个名称。如果为多路径设备设置了别名，则使用别名，而不使用 WWID 或用户友好的名称。</para>
  <para>使用 <literal>user_friendly_names</literal> 选项时，在以下情形中可能会出现问题：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <formalpara id="bq7wtcr" role="intro">
     <title>根设备使用的是多路径：</title>
     <para>如果系统根设备使用的是多路径，而您使用的是 <literal>user_friendly_names</literal> 选项，则 <filename>initrd</filename> 文件中将会包含 <filename>/var/lib/multipath/bindings</filename> 文件中的用户友好设置。如果稍后更改储存设置，比如添加或删除了设备，则 <filename>initrd</filename> 内的绑定设置和 <filename>/var/lib/multipath/bindings</filename> 中的绑定设置之间会存在不匹配。</para>
    </formalpara>
    <warning>
     <para><filename>initrd</filename> 和 <filename>/var/lib/multipath/bindings</filename> 之间的绑定不匹配会导致对设备指派错误的安装点，进而导致文件系统损坏和数据丢失。</para>
    </warning>
    <para>为了避免此问题，建议对系统根设备使用默认 WWID 设置。对于系统根设备不应使用别名。由于设备名称不同，因此使用别名会导致您无法通过内核命令行无缝关闭多路径。</para>
   </listitem>
   <listitem>
    <formalpara id="bq7uui0">
     <title>从另一个分区装入 /var：</title>
     <para><literal>user_friendly_names</literal> 配置文件的默认位置是 <filename>/var/lib/multipath/bindings</filename>。如果 <filename>/var</filename> 数据不是位于系统根设备上，而是从另一个分区装入，则设置多路径时 <filename>bindings</filename> 文件不可用。</para>
    </formalpara>
    <para>请确保 <filename>/var/lib/multipath/bindings</filename> 文件在系统根设备上可用，并且多路径可以找到它。例如，可以按如下操作来确保这一点：</para>
    <orderedlist spacing="normal">
     <listitem>
      <para>将 <filename>/var/lib/multipath/bindings</filename> 文件移动到 <filename>/etc/multipath/bindings</filename>。</para>
     </listitem>
     <listitem>
      <para>将 /<filename>etc/multipath.conf</filename> 的 <literal>defaults</literal> 部分的 <literal>bindings_file</literal> 选项设置为此新位置。例如：</para>

<screen>
defaults {
               user_friendly_names yes
               bindings_file "/etc/multipath/bindings"
}
</screen>

     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <formalpara id="bq7wpfj" role="intro">
     <title>多路径在 initrd 中：</title>
     <para>即使系统根设备不在多路径上，多路径也可以包含在 <filename>initrd</filename> 中。例如，系统根设备在 LVM 上时就可以发生这种情况。如果您使用 <literal>user_friendly_names</literal> 选项，且多路径在 <filename>initrd</filename> 中，则应当使用参数 <command>multipath=off</command> 进行引导，以免出现问题。</para>
    </formalpara>
    <para>这样在系统引导过程中仅禁用了 <filename>initrd</filename> 中的多路径。系统引导后，<filename>boot.multipath</filename> 和 <filename>multipathd</filename> 引导脚本能够激活多路径。</para>
   </listitem>
  </itemizedlist>
  <para>启用用户友好名称或指定别名：</para>
  <procedure id="b7jqnux">
   <step id="b7jqqgl" performance="required">
    <para>在终端控制台中，作为 <systemitem>root</systemitem> 用户登录。</para>
   </step>
   <step id="b7jqp5o" performance="required">
    <para>在文本编辑器中打开 <filename>/etc/multipath.conf</filename>。</para>
   </step>
   <step id="bq7y78q" performance="required">
    <para role="intro">（可选）修改 <filename>/var/lib/multipath/bindings</filename> 文件的位置。 </para>
    <para>备用路径必须在系统根设备上可用，且多路径可以找到它。 </para>
    <substeps performance="required">
     <step id="bq7y96x" performance="required">
      <para>将 <filename>/var/lib/multipath/bindings</filename> 文件移动到 <filename>/etc/multipath/bindings</filename>。</para>
     </step>
     <step id="bq7y96y" performance="required">
      <para>将 /<filename>etc/multipath.conf</filename> 的 <literal>defaults</literal> 部分的 <literal>bindings_file</literal> 选项设置为此新位置。例如：</para>

<screen>
defaults {
               user_friendly_names yes
               bindings_file "/etc/multipath/bindings"
}
</screen>

     </step>
    </substeps>
   </step>
   <step id="b7jqp5q" performance="required">
    <para>（可选但不建议使用）启用用户友好的名称：</para>
    <substeps performance="required">
     <step id="bq7xauk" performance="required">
      <para>取消注释 <literal>defaults</literal> 部分及其结尾括号。</para>
     </step>
     <step id="bq7xb1y" performance="required">
      <para>取消注释 <literal>user_friendly_names</literal> 选项，然后将其值从 No 更改为 Yes。</para>
      <para>例如：</para>

<screen>
## Use user friendly names, instead of using WWIDs as names.
defaults {
  user_friendly_names yes
}
</screen>

     </step>
    </substeps>
   </step>
   <step id="b7jrp3u" performance="required">
    <para role="intro">（可选）使用 <command>multipath</command> 部分中的 <command>alias</command> 选项为设备指定您自己的名称。</para>
    <para role="intro">例如：</para>

<screen>
## Use alias names, instead of using WWIDs as names.
multipaths {
       multipath {
               wwid           36006048000028350131253594d303030
               alias             blue1
       }
       multipath {
               wwid           36006048000028350131253594d303041
               alias             blue2
       }
       multipath {
               wwid           36006048000028350131253594d303145
               alias             yellow1
       }
       multipath {
               wwid           36006048000028350131253594d303334
               alias             yellow2
       }
}
</screen>

   </step>
   <step id="b7jqp5r" performance="required">
    <para>保存更改，然后关闭该文件。</para>
    <para>更新多路径映射或重启动 multipathd 守护程序（例如系统重启动时）之后才会应用更改。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bkj8n9w">
  <title>配置 zSeries 设备的默认设置</title>
  <para>使用多路径对 IBM zSeries 设备进行的测试显示，应将参数 dev_loss_tmo 设置为 90 秒，将参数 fast_io_fail_tmo 设置为 5 秒。如果要使用 zSeries 设备，请按以下方式修改文件 <filename>/etc/multipath.conf</filename> 以指定值：</para>

<screen>
defaults {
       dev_loss_tmo 90
       fast_io_fail_tmo 5
}
</screen>

  <para>参数 dev_loss_tmo 设置将多路径链接标记为无效之前等待的秒数。如果路径失败，则已失败路径上的任何当前 I/O 将失败。默认值根据所使用的设备驱动程序而异。值的有效范围为 0 到 600 秒。要使用驱动程序的内部超时，请将此值设置为零 (0) 或大于 600 的任意值。</para>
  <para>参数 fast_io_fail_tmo 设置检测到链接问题时 I/O 失败之前等待的时长。到达驱动程序的 I/O 将失败。如果 I/O 处于受阻止队列中，则此 I/O 在 dev_loss_tmo 超时和队列解除阻止之前不会失败。</para>
  <para>如果修改 <filename>/etc/multipath.conf</filename> 文件，则在更新多路径映射或重启动 multipathd 守护程序（例如系统重启动时）之后，才会应用更改。</para>
 </sect1>
 <sect1 id="bbi89rh">
  <title>配置路径故障转移策略和优先级</title>
  <para>在 Linux 主机中，当存在多个路径到某储存控制器时，每个路径都显示为独立的块设备，导致单个 LUN 有多个块设备。设备映射程序多路径服务检测到具有同一 LUN ID 的多个路径，并使用该 ID 创建了一个新的多路径设备。例如，如果具有两个 HBA 的主机通过单个未确定区域的光纤通道交换机挂接到一个带两个端口的储存控器，则会看到四个块设备：<filename>/dev/sda</filename>、<filename>/dev/sdb</filename>、<filename>/dev/sdc</filename> 和 <filename>/dev/sdd</filename>。设备映射程序多路径服务创建了单个块设备 <filename>/dev/mpath/mpath1</filename>，它将通过这四个底层块设备重路由 I/O。</para>
  <para>本节描述如何指定故障转移策略和配置路径的优先级。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="beep0mu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi89xy" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbj87iv" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi8acn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi8els" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="beep0mu">
   <title>配置路径故障转移策略</title>
   <para>使用带 -p 选项的 <command>multipath</command> 命令设置路径故障转移策略：</para>

<screen>
multipath <replaceable>devicename</replaceable> -p <replaceable>policy</replaceable> 
</screen>

   <para role="intro">将<replaceable>策略</replaceable>替换为以下策略选项之一：</para>
   <table id="beg1vn7" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>multipath -p 命令的组策略选项</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2381*"/>
    <colspec colnum="2" colname="2" colwidth="7620*"/>
     <thead>
      <row id="beg1vn8">
       <entry>
        <para>策略选项</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="beg1vn9">
       <entry>
        <para>failover</para>
       </entry>
       <entry>
        <para>（默认）每个优先级组对应一个路径。</para>
       </entry>
      </row>
      <row id="beg1vna">
       <entry>
        <para>multibus</para>
       </entry>
       <entry>
        <para>一个优先级组中的所有路径。</para>
       </entry>
      </row>
      <row id="beg1vnb">
       <entry>
        <para>group_by_serial</para>
       </entry>
       <entry>
        <para>每个检测到的序列号一个优先级组。</para>
       </entry>
      </row>
      <row id="beg1vnc">
       <entry>
        <para>group_by_prio</para>
       </entry>
       <entry>
        <para>每个路径优先级值一个优先级组。优先级由调出程序在 <filename>/etc/multipath.conf</filename> 配置文件中指定为 global、per-controller 或 per-multipath 选项来确定。</para>
       </entry>
      </row>
      <row id="beg1vnd">
       <entry>
        <para>group_by_node_name</para>
       </entry>
       <entry>
        <para>每个目标节点名一个优先级组。目标节点名是在 <filename>/sys/class/fc_transport/target*/node_name</filename> 位置获取的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="bbi89xy">
   <title>配置故障转移优先级</title>
   <para>必须在 <filename>/etc/multipath.conf</filename> 文件中手动输入设备的故障转移优先级。<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename> 文件中有所有设置和选项的示例。</para>
   <para>如果修改 <filename>/etc/multipath.conf</filename> 文件，当保存该文件时不会自动应用更改。有关信息，请参见<xref linkend="mpiohwsupconf" xrefstyle="SectTitleOnPage"/>和<xref linkend="bbj8y2r" xrefstyle="SectTitleOnPage"/>。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8jjc" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8jjd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8g9x" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="beg263n">
    <title>了解优先级组和属性</title>
    <para><emphasis>优先级组</emphasis>是通向同一物理 LUN 的路径的集合。默认情况下，I/O 在组中的所有路径中以循环方式分布。<command>multipath</command> 命令会基于 SAN 的 path_grouping_policy 设置为该 SAN 中的每个 LUN 自动创建优先级组。<literal/><command>multipath</command> 命令将一个组中的路径数乘以该组的优先级以确定哪个组是主组。计算出的值最高的组即是主组。当主组中的所有路径失败时，具有下一个最高值的优先级组即变为活动的组。 </para>
    <para><emphasis>路径优先级</emphasis>是指派给一个路径的整数值。该值越高，优先级越高。将使用一个外部程序来指派每个路径的优先级。对于给定的设备，具有相同优先级的路径属于同一优先级组。</para>
    <para>SLES 11 SP2 的多路径工具 0.4.9 使用 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 部分中的 <literal>prio</literal> 设置。当为 <literal>multipaths{}</literal> 部分中的单个 <literal>multipath</literal> 定义指定关键字 <literal>prio</literal> 时，它将被忽略而无反馈。在适用于 SLES  11 SP1 的多路径工具 0.4.8 以及早期版本中，允许使用 <literal>multipaths{}</literal> 部分中单个 <literal>multipath</literal> 定义中的 prio 设置来覆盖 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 部分中的 <literal>prio</literal> 设置。</para>
    <para><filename>/etc/multipath.conf</filename> 文件中针对 <literal>prio</literal> 关键字的语法在 <filename>multipath-tools-0.4.9</filename> 中已更改。<literal>prio</literal> 行用于指定优先级排序程序。如果优先级排序程序需要自变量，您要在第二行上使用 <literal>prio_args</literal> 关键字指定自变量。而在以往，则是 <literal>prio</literal> 行包含优先级排序程序以及其自变量。</para>
    <bridgehead id="b15gvvaa">Defaults 或 Devices 部分的 PRIO 设置</bridgehead>
    <variablelist>
     <varlistentry id="b122w59j">
      <term>prio</term>
      <listitem>
       <para>指定要调用的优先级排序程序，以获取路径优先级的值。将加总每个路径组的权重以确定发生故障时要使用的下一个路径组。</para>
       <para>如果指定的优先级排序程序需要自变量，则使用关键字 <literal>prio_args</literal> 指定自变量。</para>
       <formalpara id="b122w59k" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>如果未指定关键字 <literal>prio</literal>，则所有路径具有相同优先级。默认设置为“const”且 <literal>prio_args</literal> 设置为空。</para>

<screen>
prio      "const"
prio_args ""
</screen>

       <para>优先级排序程序示例如下：</para>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2907*"/>
        <colspec colnum="2" colname="2" colwidth="7096*"/>
         <thead>
          <row id="b122xdcu">
           <entry>
            <para>优先级排序程序</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122xdcv">
           <entry>
            <para>alua</para>
           </entry>
           <entry>
            <para>基于 SCSI-3 ALUA 设置生成路径优先级。 </para>
           </entry>
          </row>
          <row id="b122xdcw">
           <entry>
            <para>const</para>
           </entry>
           <entry>
            <para>为所有路径生成同一优先级。</para>
           </entry>
          </row>
          <row id="b122xdcx">
           <entry>
            <para>emc</para>
           </entry>
           <entry>
            <para>为 EMC 阵列生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122xdcy">
           <entry>
            <para>hdc</para>
           </entry>
           <entry>
            <para>为 Hitachi HDS Modular 储存阵列生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122xdcz">
           <entry>
            <para>hp_sw</para>
           </entry>
           <entry>
            <para>为活动/备用模式的 Compaq/HP 控制器生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122xdd0">
           <entry>
            <para>ontap</para>
           </entry>
           <entry>
            <para>为 NetApp 阵列生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122xdd1">
           <entry>
            <para>random</para>
           </entry>
           <entry>
            <para>为每个路径生成随机优先级。</para>
           </entry>
          </row>
          <row id="b122xdd2">
           <entry>
            <para>rdac</para>
           </entry>
           <entry>
            <para>为 LSI/Engenio RDAC 控制器生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122xdd3">
           <entry>
            <para>weightedpath</para>
           </entry>
           <entry>
            <para>根据您在 <literal>prio_args</literal> 自变量中指定的加权值生成路径优先级，例如：</para>

<screen>
&lt;hbtl|devname&gt; &lt;<replaceable>regex1</replaceable>&gt; &lt;<replaceable>prio1</replaceable>&gt; &lt;<replaceable>regex2</replaceable>&gt; &lt;<replaceable>prio2</replaceable>&gt;...
</screen>

            <para><literal>hbtl regex</literal> 自变量格式采用 SCSI <literal>H:B:T:L</literal> 表示法（例如 <literal>1:0:.:.</literal> 和 <literal>*:0:0:.</literal>）并带有加权值，其中 H、B、T 和 L 分别代表设备的主机、总线、目标以及 LUN ID。例如：</para>

<screen>
prio "weightedpath"
prio_args "hbtl 1:.:.:. 2 4:.:.:. 4"
</screen>

            <para>devname 正则表达式自变量格式使用设备节点名称以及每个设备的加权值。例如：</para>

<screen>
prio "weightedpath"
prio_args "devname sda 50 sde 10 sdc 50 sdf 10"
</screen>

           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122w59l">
      <term>prio_args</term>
      <listitem>
       <para>为需要自变量的指定优先级排序程序指定自变量。大多数 <literal>prio</literal> 程序并不需要自变量。</para>
       <formalpara id="b122w59m" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>无默认值。该值取决于 <literal>prio</literal> 设置以及优先级排序程序是否需要自变量。</para>

<screen>
prio      "const"
prio_args ""
</screen>

      </listitem>
     </varlistentry>
    </variablelist>
    <bridgehead id="b15gvvab">多路径属性</bridgehead>
    <para>多路径属性用于控制设备的多路径 I/O 行为。您可以按默认方式为所有多路径设备指定属性。也可以通过在多路径配置文件的 <literal>multipaths</literal> 部分中创建设备项的方式，指定仅对指定多路径设备应用的属性。</para>
    <variablelist>
     <varlistentry id="b122sbg9">
      <term>user_friendly_names</term>
      <listitem>
       <para>指定是使用全球 ID (WWID) 还是使用 <filename>/var/lib/multipath/bindings</filename> 文件以 <filename>/dev/mapper/mpathN</filename> 的格式为多路径设备指派一个永久唯一的别名。</para>
       <para>此选项可以在 <literal>devices</literal> 部分和 <literal>multipaths</literal> 部分使用。</para>
       <formalpara id="b122sbga" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122skbh">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122skbi">
           <entry>
            <para>no</para>
           </entry>
           <entry>
            <para>（默认）使用 <filename>/dev/disk/by-id/</filename> 位置中显示的 WWID。</para>
           </entry>
          </row>
          <row id="b122skbj">
           <entry>
            <para>yes </para>
           </entry>
           <entry>
            <para>自动生成用户友好的名称作为多路径设备的别名而不是实际 ID。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgh">
      <term>failback</term>
      <listitem>
       <para>指定是否监视失败路径恢复，并指明失败路径重新使用之后组故障回复的时间。</para>
       <para>当失败的路径恢复时，该路径会基于此设置重新添加到支持多路径的路径列表中。多路径计算优先级组，并在主路径的优先级超出备用组时更改活动优先级组。 </para>
       <formalpara id="b122sbgi" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122sm95">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122sm96">
           <entry>
            <para>manual</para>
           </entry>
           <entry>
            <para>（默认）不监视失败的路径是否恢复。管理员运行 <command>multipath</command> 命令以更新启用的路径和优先级组。</para>
           </entry>
          </row>
          <row id="b122sm97">
           <entry>
            <para>immediate</para>
           </entry>
           <entry>
            <para>当一个路径恢复时，立即启用该路径。</para>
           </entry>
          </row>
          <row id="b122sm98">
           <entry>
            <para>n</para>
           </entry>
           <entry>
            <para>当路径恢复时，等待 <replaceable>n</replaceable> 秒再启用该路径。指定大于 0 的整数值。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>为了防止多路径故障转移出现乒乓效应，建议将群集环境下的多路径故障回复设置为“manual”。</para>

<screen>
failback "manual"
</screen>

       <important>
        <para>请确保与您的储存系统供应商确认故障回复设置。不同的储存系统可能会有不同的设置要求。</para>
       </important>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgm">
      <term>getuid_callout</term>
      <listitem>
       <para>用于调用以获取唯一路径标识符的默认程序和自变量。使用 Linux 绝对路径指定位置。</para>
       <para>SLES 11 SP3 中已弃用该属性。取而代之的是 <link linkend="b15gvth2"><literal>uid_attribute</literal></link>。</para>
       <formalpara id="b122sbgn" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>默认位置和自变量是：</para>

<screen>
/lib/udev/scsi_id -g -u -s
</screen>

       <para>示例：</para>

<screen>
getuid_callout "/lib/udev/scsi_id -g -u -d /dev/%n"

getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgo">
      <term>no_path_retry</term>
      <listitem>
       <para>指定在路径失败时使用的行为。</para>
       <formalpara id="b122sbgp" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122sr39">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122sr3a">
           <entry>
            <para>n</para>
           </entry>
           <entry>
            <para>指定 <command>multipath</command> 停止排队和路径失败之前的重试次数。指定大于 0 的整数值。</para>
            <para>在群集中，您可以将值指定为 0 以避免发生排队现象，并允许资源进行故障转移。</para>
           </entry>
          </row>
          <row id="b122sr3b">
           <entry>
            <para>fail</para>
           </entry>
           <entry>
            <para>指定立即失败（不排队）。</para>
           </entry>
          </row>
          <row id="b122sr3c">
           <entry>
            <para>queue</para>
           </entry>
           <entry>
            <para>永不停止排队（一直排队，直到该路径成为活动路径）。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>在群集下工作时，建议在 <filename>/etc/multipath.conf</filename> 文件中将重试设置为“fail”或“0”。如此一来，当与储存的连接中断时便可让资源进行故障转移。否则会将消息排队而不会发生资源故障转移。 </para>

<screen>
no_path_retry "fail"
no_path_retry "0"
</screen>

       <important>
        <para>请确保与您的储存系统供应商确认重试设置。不同的储存系统可能会有不同的设置要求。</para>
       </important>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgs">
      <term>path_checker</term>
      <listitem>
       <para role="intro">确定路径的状态。</para>
       <formalpara id="b122sbgt" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122swb1">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122swb2">
           <entry>
            <para>directio</para>
           </entry>
           <entry>
            <para>（在 <filename>multipath-tools</filename> 版本 0.4.8 和更高版本中是默认的）读取具有直接 I/O 的第一个扇区。对于 DASD 设备非常有用。在 <filename>/var/log/messages</filename> 中记录故障消息。</para>
           </entry>
          </row>
          <row id="b122swb3">
           <entry>
            <para>readsector0</para>
           </entry>
           <entry>
            <para>（<filename>multipath-tools</filename> 0.4.7 以及更低版本中的默认值，现已弃用，由 <literal>directio</literal> 替代。）读取设备的第一个扇区。在 <filename>/var/log/messages</filename> 中记录故障消息。</para>
           </entry>
          </row>
          <row id="b122swb4">
           <entry>
            <para>tur</para>
           </entry>
           <entry>
            <para>向设备发出 SCSI 测试单元就绪命令。如果 LUN 支持，则这是首选设置。失败时，命令不在 <filename>/var/log/messages</filename> 中填充消息。</para>
           </entry>
          </row>
          <row id="b122swb5">
           <entry>
            <para><replaceable>自定义供应商值</replaceable></para>
           </entry>
           <entry>
            <para>一些 SAN 供应商提供了自定义的 path_checker 选项：</para>
            <itemizedlist mark="bullet" spacing="normal">
             <listitem>
              <formalpara id="b122w9oz">
               <title>cciss_tur：</title>
               <para>检查 HP 智能储存阵列的路径状态。</para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara id="b122swb6">
               <title>emc_clariion：</title>
               <para>查询 EMC Clariion EVPD 页 0xC0 以确定路径状态。</para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara id="b122swb7">
               <title>hp_sw：</title>
               <para>使用活动/备用固件检查 HP 储存阵列的路径状态（Up、Down 还是 Ghost）。 </para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara id="b122swb8">
               <title>rdac：</title>
               <para>检查 LSI/Engenio RDAC 储存控制器的路径状态。</para>
              </formalpara>
             </listitem>
            </itemizedlist>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgq">
      <term>path_grouping_policy</term>
      <listitem>
       <para role="intro">指定由给定控制器托管的多路径设备的路径分组策略。</para>
       <formalpara id="b122sbgr" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122swaq">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122swar">
           <entry>
            <para>failover</para>
           </entry>
           <entry>
            <para>（默认）为每个优先级组指派一个路径，以便每次只使用一个路径。</para>
           </entry>
          </row>
          <row id="b122swas">
           <entry>
            <para>multibus</para>
           </entry>
           <entry>
            <para>所有有效路径在一个优先级组中。通讯在该组所有活动路径之间平衡负载。</para>
           </entry>
          </row>
          <row id="b122swat">
           <entry>
            <para>group_by_prio</para>
           </entry>
           <entry>
            <para>对于每个路径优先级值，都存在一个优先级组。具有相同优先级的路径在同一优先级组中。优先级由外部程序指派。</para>
           </entry>
          </row>
          <row id="b122swau">
           <entry>
            <para>group_by_serial</para>
           </entry>
           <entry>
            <para>路径按 SCSI 目标序列号（控制器节点 WWN）分组。</para>
           </entry>
          </row>
          <row id="b122swav">
           <entry>
            <para>group_by_node_name</para>
           </entry>
           <entry>
            <para>每个目标节点名指派一个优先级组。目标节点名是在 <filename>/sys/class/fc_transport/target*/node_name</filename> 中获取的。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgu">
      <term>path_selector</term>
      <listitem>
       <para role="intro">指定用于负载平衡的 path-selector 算法。</para>
       <formalpara id="b122sbgv" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122t3po">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122t3pp">
           <entry>
            <para>round-robin 0</para>
           </entry>
           <entry>
            <para>（SLES 11 SP2 以及更低版本中的默认值）用于平衡一个优先级组中所有活动路径之间的通讯的负载平衡算法。</para>
           </entry>
          </row>
          <row id="b122t3pr">
           <entry>
            <para>queue-length 0</para>
           </entry>
           <entry>
            <para>用于平衡路径上运行中 I/O 数的动态负载平衡器，类似于 least-pending 选项。</para>
           </entry>
          </row>
          <row id="b122t3ps">
           <entry>
            <para>service-time 0</para>
           </entry>
           <entry>
            <para>（SLES 11 SP3 以及更高版本中的默认值）面向服务时间的、用于根据延迟情况来平衡多个路径上的 I/O 的负载平衡器。 </para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgw">
      <term>pg_timeout</term>
      <listitem>
       <para>指定路径组超时处理。</para>
       <formalpara id="b122sbgx" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>NONE（内部默认值）</para>
      </listitem>
     </varlistentry>
     <varlistentry id="b122w0sa">
      <term>polling_interval</term>
      <listitem>
       <para>指定某个路径检查周期结束到下一个路径检查周期开始之间的时间（以秒为单位）。</para>
       <formalpara id="b122w0sb" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>指定大于 0 的整数值。默认值为 5。请确保与您的储存系统供应商确认 polling_interval 设置。不同的储存系统可能会有不同的设置要求。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgy">
      <term>prio_callout</term>
      <listitem>
       <para>指定用于确定多路径映射布局的程序和自变量。</para>
       <para>多路径 prio_callout 程序位于 <filename>/lib/libmultipath/lib*</filename> 的共享库中。使用共享库可在守护程序启动时将该调出程序装载到内存中。 </para>
       <para>当使用 <command>multipath</command> 命令查询时，指定的 mpath_prio_* 调出程序会返回给定路径与整个多路径布局相对的优先级。 </para>
       <para>当与 group_by_prio 的 path_grouping_policy 一起使用时，具有相同优先级的所有路径会分到一个多路径组中。具有最高聚合优先级的组成为活动组。</para>
       <para>当一个组中的所有路径失败时，具有下一个最高聚合优先级的组成为活动组。此外，可能会向目标发送故障转移命令（由硬件处理程序确定）。</para>
       <para>mpath_prio_* 程序也可以是由指定安装的供应商或管理员创建的自定义脚本。</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>命令行中的 <literal>%n</literal> 会展开为 <filename>/dev</filename> 目录中的设备名。 </para>
        </listitem>
        <listitem>
         <para>命令行中的 <literal>%b</literal> 会展开为采用 <filename>/dev</filename> 目录中<replaceable>主要:次要</replaceable>格式的设备号。</para>
        </listitem>
        <listitem>
         <para>命令行中的 <literal>%d</literal> 会展开为 <filename>/dev/disk/by-id</filename> 目录中的设备 ID。</para>
        </listitem>
       </itemizedlist>
       <para>如果设备可热拔插，请使用 <literal>%d</literal> 标志而不是 <literal>%n</literal>。此方法可解决设备可使用与 <command>udev</command> 创建设备节点之间时间间隔短的问题。</para>
       <formalpara id="b122sbgz" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122tqh2">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122tqh3">
           <entry>
            <para>（无值）</para>
           </entry>
           <entry>
            <para>如果不使用 <literal>prio_callout</literal> 属性，所有路径都是等同的。这是默认值。</para>
           </entry>
          </row>
          <row id="b122tqh4">
           <entry>
            <para>/bin/true</para>
           </entry>
           <entry>
            <para>当不使用 group_by_prio 时指定此值。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>当用 <command>multipath</command> 命令查询时，<command>prioritizer</command> 程序会生成路径优先级。程序名必须以 <filename>mpath_prio_</filename> 开头，并按使用的设备类型或平衡方法命名。当前优先级排序程序包括以下程序：</para>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="3539*"/>
        <colspec colnum="2" colname="2" colwidth="6464*"/>
         <thead>
          <row id="b122tml8">
           <entry>
            <para>优先级排序程序</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122tml9">
           <entry>
            <para>mpath_prio_alua %n</para>
           </entry>
           <entry>
            <para>基于 SCSI-3 ALUA 设置生成路径优先级。 </para>
           </entry>
          </row>
          <row id="b122tmla">
           <entry>
            <para>mpath_prio_balance_units</para>
           </entry>
           <entry>
            <para>为所有路径生成同一优先级。</para>
           </entry>
          </row>
          <row id="b122tp25">
           <entry>
            <para>mpath_prio_emc %n</para>
           </entry>
           <entry>
            <para>为 EMC 阵列生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122tp26">
           <entry>
            <para>mpath_prio_hds_modular %b</para>
           </entry>
           <entry>
            <para>为 Hitachi HDS Modular 储存阵列生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122tp27">
           <entry>
            <para>mpath_prio_hp_sw %n</para>
           </entry>
           <entry>
            <para>为活动/备用模式的 Compaq/HP 控制器生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122tp28">
           <entry>
            <para>mpath_prio_netapp %n</para>
           </entry>
           <entry>
            <para>为 NetApp 阵列生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122tp29">
           <entry>
            <para>mpath_prio_random %n</para>
           </entry>
           <entry>
            <para>为每个路径生成随机优先级。</para>
           </entry>
          </row>
          <row id="b122tp2a">
           <entry>
            <para>mpath_prio_rdac %n</para>
           </entry>
           <entry>
            <para>为 LSI/Engenio RDAC 控制器生成路径优先级。</para>
           </entry>
          </row>
          <row id="b122tp2b">
           <entry>
            <para>mpath_prio_tpc %n</para>
           </entry>
           <entry>
            <para>您还可以选择使用由供应商或管理员创建的脚本，从您用于为每个路径指定所用优先级的文件获取优先级。</para>
           </entry>
          </row>
          <row id="b122tp2c">
           <entry>
            <para>mpath_prio_spec.sh %n</para>
           </entry>
           <entry>
            <para>提供基于另一个数据文件中包含的信息，为多路径生成优先级的用户创建脚本的路径。（此路径和文件名仅作为示例提供。请改为您的脚本的位置。）该脚本可由供应商或管理员创建。脚本的目标文件可以识别所有多路径设备的每个路径并为每个路径指定优先级。有关示例，请参见 <xref linkend="bbj87iv" xrefstyle="SectTitleOnPage"/>。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbh0">
      <term>rr_min_io</term>
      <listitem>
       <para>指定在切换到同一路径组中的下一个路径之前要路由到一个路径的 I/O 事务数，下一个路径由 <literal>path_selector</literal> 设置中指定的算法确定。</para>
       <para>rr_min_io 属性仅在内核 2.6.31 以及更早版本中使用。SLES 11 SP2 中已不再使用该属性，取而代之的是 <literal>rr_min_io_rq</literal> 属性。</para>
       <formalpara id="b122sbh1" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>指定大于 0 的整数值。默认值是 1000。</para>

<screen>
rr_min_io "1000"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry id="b122sbh2">
      <term>rr_min_io_rq</term>
      <listitem>
       <para role="intro">指定在使用基于请求的 device-mapper-multipath 切换到当前路径组中的下一个路径前，路由至某个路径的 I/O 请求的数量。 </para>
       <para>此属性用于运行 SLES 11 SP2 及更高版本的系统。它替代了 rr_min_io 属性。</para>
       <formalpara id="b122sbh3" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>指定大于 0 的整数值。默认值是 1。</para>

<screen>
rr_min_io_rq "1"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry id="b122sbh4">
      <term>rr_weight</term>
      <listitem>
       <para role="intro">指定用于路径的加权方法。</para>
       <formalpara id="b122sbh5" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122tlbj">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122tlbk">
           <entry>
            <para>uniform</para>
           </entry>
           <entry>
            <para>（默认）所有路径具有相同的循环复用权重。</para>
           </entry>
          </row>
          <row id="b122tlbl">
           <entry>
            <para>priorities</para>
           </entry>
           <entry>
            <para>每个路径的权重由该路径的优先级乘以 rr_min_io_rq 设置值（对于内核 2.6.31 及更早版本则为 rr_min_io 设置值）决定。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b15gvth2">
      <term>uid_attribute</term>
      <listitem>
       <para>提供唯一路径标识符的 udev 属性。默认值为 <literal>ID_SERIAL</literal>。</para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="bbi8jjc">
    <title>配置循环负载平衡</title>
    <para>所有路径都是活动的。I/O 被配置为等候数秒或一定的 I/O 事务数，再移到序列中下一个打开的路径。</para>
   </sect3>
   <sect3 id="bbi8jjd">
    <title>配置单路径故障转移</title>
    <para>具有最高优先级（设置值为最低）的一个路径是活动的，可以进行通讯。其他路径可用于故障转移，但在发生故障转移前不会使用。 </para>
   </sect3>
   <sect3 id="bbi8g9x">
    <title>为循环负载平衡将 I/O 路径分组</title>
    <para>具有相同优先级的多个路径分在活动的组中。当该组中的所有路径失败时，设备会故障转移到下一个最高优先级的组。该组中的所有路径以循环负载平衡的方式共享通讯负载。</para>
   </sect3>
  </sect2>
  <sect2 id="bbj87iv">
   <title>使用脚本设置路径优先级</title>
   <para>您可以创建与“设备映射程序多路径 (DM-MPIO)”交互的脚本，从而当 LUN 设置为 <command>prio_callout</command> 设置的资源时提供通向 LUN 的路径的优先级。 </para>
   <para>首先，设置一个文本文件，列出关于每个设备的信息和要指派给每个路径的优先级值。例如，将该文件命名为 <filename>/usr/local/etc/primary-paths</filename>。以下列格式为每个路径输入一行：</para>

<screen>
host_wwpn target_wwpn scsi_id priority_value
</screen>

   <para>为设备上的每个路径返回一个优先级值。确保变量 FILE_PRIMARY_PATHS 解析为含有每个设备相应数据（主机 wwpn、目标 wwpn、scsi_id 和优先级值）的真实文件。 </para>
   <para>单个 LUN 有 8 个路径的 <filename>primary-paths</filename> 文件内容类似如下所示：</para>

<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:0 sdb 3600a0b8000122c6d00000000453174fc 50
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:1 sdc 3600a0b80000fd6320000000045317563 2
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:2 sdd 3600a0b8000122c6d0000000345317524 50
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:3 sde 3600a0b80000fd6320000000245317593 2
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:0 sdi 3600a0b8000122c6d00000000453174fc 5
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:1 sdj 3600a0b80000fd6320000000045317563 51
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:2 sdk 3600a0b8000122c6d0000000345317524 5
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:3 sdl 3600a0b80000fd6320000000245317593 51
</screen>

   <para>要继续<xref linkend="b122sbgy" xrefstyle="HeadingOnPage"/>中提及的示例，请创建一个名为 <filename>/usr/local/sbin/path_prio.sh</filename> 的脚本。您可以使用任何路径和文件名。该脚本将执行以下任务：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>使用 multipath 查询时，从 <filename>/usr/local/etc/primary-paths</filename> 文件 grep 该设备及其路径。</para>
    </listitem>
    <listitem>
     <para>向 multipath 返回该文件中该项最后一列的优先级值。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bbi8acn">
   <title>配置 ALUA (mpath_prio_alua)</title>
   <para><command>mpath_prio_alua(8)</command> 命令用作 Linux <command>multipath(8)</command> 命令的优先级调出值。它返回一个由 DM-MPIO 用于将具有相同优先级的 SCSI 设备分组到一起的编号。路径优先级工具基于 ALUA（异步逻辑单元访问）。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg2eyu" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2e1m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbj46qo" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbj4fvf" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="beg2eyu">
    <title>语法</title>

<screen>
mpath_prio_alua [-d <replaceable>directory</replaceable>] [-h] [-v] [-V] <replaceable>device</replaceable> [<replaceable>device</replaceable>...] 
</screen>

   </sect3>
   <sect3 id="beg2e1m">
    <title>前提条件</title>
    <para>SCSI 设备。</para>
   </sect3>
   <sect3 id="bbj46qo">
    <title>选项</title>
    <variablelist>
     <varlistentry id="bbj46v3">
      <term>-d <replaceable>目录</replaceable></term>
      <listitem>
       <para>指定可以找到列出的设备节点名的 Linux 目录路径。默认目录是 <filename>/dev</filename>。使用此选项时，请仅指定要管理的一个或多个设备的设备节点名（例如 <filename>sda</filename>）。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4am6">
      <term>-h</term>
      <listitem>
       <para>显示此命令的帮助，然后退出。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4am7">
      <term>-v</term>
      <listitem>
       <para>打开详细输出以按用户可读格式显示状态。输出包含关于指定的设备属于哪个端口组及其当前状态的信息。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4am8">
      <term>-V</term>
      <listitem>
       <para>显示此工具的版本号，然后退出。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4c17">
      <term><replaceable>device</replaceable> [<replaceable>device</replaceable>...] </term>
      <listitem>
       <para>指定要管理的一个或多个 SCSI 设备。该设备必须是支持报告目标端口组 (<command>sg_rtpg(8)</command>) 命令的 SCSI 设备。对该设备节点名使用以下格式之一：</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>完整 Linux 目录路径，例如 <filename>/dev/sda</filename>。不要使用 -d 选项。</para>
        </listitem>
        <listitem>
         <para>仅设备节点名，例如 <filename>sda</filename>。使用 -d 选项指定该目录路径。</para>
        </listitem>
        <listitem>
         <para>设备的主号和次号，使用冒号 (:) 隔开，没有空格，例如 <filename>8:0</filename>。这会在 <filename>/dev</filename> 目录中创建一个临时设备节点，名称格式为 <filename>tmpdev-&lt;major&gt;:&lt;minor&gt;-&lt;pid&gt;</filename>。例如，<filename>/dev/tmpdev-8:0-&lt;pid&gt;</filename>。</para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="bbj4fvf">
    <title>返回值</title>
    <para>成功后，返回值 0 和该组的优先级值。<xref linkend="bbilsw8" xrefstyle="TableXRef"/>显示由 <command>mpath_prio_alua</command> 命令返回的优先级值。 </para>
    <table id="bbilsw8" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
     <title>设备映射程序多路径的 ALUA 优先级</title>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="2381*"/>
     <colspec colnum="2" colname="2" colwidth="7620*"/>
      <thead>
       <row id="bbiltgc">
        <entry>
         <para>优先级值</para>
        </entry>
        <entry>
         <para>描述</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="bbiltgd">
        <entry>
         <para>50</para>
        </entry>
        <entry>
         <para>该设备在活动的优化组中。</para>
        </entry>
       </row>
       <row id="bbiltge">
        <entry>
         <para>10</para>
        </entry>
        <entry>
         <para>该设备在活动但非优化组中。</para>
        </entry>
       </row>
       <row id="bbj4j3r">
        <entry>
         <para>1</para>
        </entry>
        <entry>
         <para>该设备在备用组中。</para>
        </entry>
       </row>
       <row id="bbiltgf">
        <entry>
         <para>0</para>
        </entry>
        <entry>
         <para>所有其他组。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para>由于 <command>multipath</command> 处理值的方式，这些值的间隔很大。它将一个组中的路径数乘以该组的优先级值，然后选择结果最高的组。例如，如果一个非优化组有六个路径 (6 x 10 = 60)，并且优化路径组有单个路径 (1 x 50 = 50)，则该非优化组得分最高，所以 multipath 选择该非优化组。发往该设备的通讯以循环方式使用该组中的所有六个路径。</para>
    <para>发生故障时，返回值 1 到 5，表示该命令发生故障的原因。有关信息，请参见 <command>mpath_prio_alua</command> 的手册页。</para>
   </sect3>
  </sect2>
  <sect2 id="bbi8els">
   <title>报告目标路径组</title>
   <para>使用 SCSI 报告目标端口组 (<command>sg_rtpg(8)</command>) 命令。有关信息，请参见 <command>sg_rtpg(8)</command> 的手册页。</para>
  </sect2>
 </sect1>
 <sect1 id="mpioroot">
  <title>为根设备配置多路径 I/O</title>
  <para>SUSE Linux Enterprise Server 11 中的 <filename>/boot</filename> 和 <filename>/root</filename> 可以使用并支持设备映射程序多路径 I/O (DM-MPIO)。此外，YaST 安装程序中的 YaST 分区程序支持在安装时启用多路径。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bp27t6u" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bomc64f" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bomc64g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bp27t6u">
   <title>安装时启用多路径 I/O</title>
   <para>如果要在多路径设备上安装操作系统，则安装时必须运行多路径软件。multipathd 守护程序在系统安装过程中不是自动激活的。您可以使用 YaST 分区程序中的<guimenu>配置多路径</guimenu>选项启动它。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bomcrff" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bomc64e" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bomcrff">
    <title>安装时在主动/主动多路径储存 LUN 上启用多路径 I/O</title>
    <procedure id="bomcrfg">
     <step id="bomcrfh" performance="required">
      <para>安装过程中，在“YaST 安装设置”页单击<guimenu>分区</guimenu>以打开 YaST 分区程序。</para>
     </step>
     <step id="bomcrfi" performance="required">
      <para>选择<guimenu>自定义分区（仅限专家）</guimenu>。</para>
     </step>
     <step id="bomcrfj" performance="required">
      <para>选择<guimenu>硬盘</guimenu>主图标，单击<guimenu>配置</guimenu>按钮，然后选择<guimenu>配置多路径</guimenu>。</para>
     </step>
     <step id="bomcrfk" performance="required">
      <para role="intro">启动多路径。</para>
      <para>YaST 会开始重扫描磁盘，并显示可用的多路径设备（如 <filename>/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</filename>）。它是应做所有进一步处理的设备。 </para>
     </step>
     <step id="bomcrfl" performance="required">
      <para>单击<guimenu>下一步</guimenu>继续安装。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bomc64e">
    <title>安装时在主动/被动多路径储存 LUN 上启用多路径 I/O</title>
    <para>multipathd 守护程序在系统安装过程中不是自动激活的。您可以使用 YaST 分区程序中的<guimenu>配置多路径</guimenu>选项启动它。 </para>
    <para>在安装时为主动/被动多路径储存 LUN 启用多路径 I/O：</para>
    <procedure id="bomc6el">
     <step id="bomc6em" performance="required">
      <para>安装过程中，在“YaST 安装设置”页单击<guimenu>分区</guimenu>以打开 YaST 分区程序。</para>
     </step>
     <step id="bomc7xx" performance="required">
      <para>选择<guimenu>自定义分区（仅限专家）</guimenu>。</para>
     </step>
     <step id="bomc83f" performance="required">
      <para>选择<guimenu>硬盘</guimenu>主图标，单击<guimenu>配置</guimenu>按钮，然后选择<guimenu>配置多路径</guimenu>。</para>
     </step>
     <step id="bomc8h8" performance="required">
      <para>启动多路径。</para>
      <para>YaST 会开始重扫描磁盘，并显示可用的多路径设备（如 <filename>/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</filename>）。它是应做所有进一步处理的设备。记下设备路径和 UUID，您以后会需要这些信息。 </para>
     </step>
     <step id="bomcatl" performance="required">
      <para>单击<guimenu>下一步</guimenu>继续安装。</para>
     </step>
     <step id="bomca3n" performance="required">
      <para>执行所有设置并完成安装后，YaST 会开始写入引导加载程序的信息，并显示重启动系统的倒计时。单击<guimenu>停止</guimenu>按钮以停止倒计时，并按 CTRL+ALT+F5 访问控制台。</para>
     </step>
     <step id="bomcamo" performance="required">
      <para>通过控制台确定是否已在 <filename>/boot/grub/device.map</filename> 文件中为 <filename>hd0</filename> 条目输入了不活动路径。</para>
      <para>这一点是必需的，因为安装时不会区分活动和不活动路径。</para>
      <substeps performance="required">
       <step id="bomcby2" performance="required">
        <para role="intro">输入以下命令将根设备装入 <filename>/mnt</filename></para>

<screen>
mount /dev/disk/by-id/&lt;<replaceable>UUID</replaceable>&gt;_part2 /mnt
</screen>

        <para role="intro">例如，输入</para>

<screen>
mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt
</screen>

       </step>
       <step id="bomcfm2" performance="required">
        <para role="intro">输入以下命令将引导设备装入 <filename>/mnt/boot</filename></para>

<screen>
mount /dev/disk/by-id/&lt;<replaceable>UUID</replaceable>&gt;_part1 /mnt/boot
</screen>

        <para role="intro">例如，输入 </para>

<screen>
mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt/boot
</screen>

       </step>
       <step id="bomcg7c" performance="required">
        <para>输入以下命令打开 <filename>/mnt/boot/grub/device.map</filename> 文件</para>

<screen>
less /mnt/boot/grub/device.map
</screen>

       </step>
       <step id="bomcg05" performance="required">
        <para>在 <filename>/mnt/boot/grub/device.map</filename> 文件中，确定 <filename>hd0</filename> 条目是否指向不活动路径，然后执行以下操作之一：</para>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <formalpara id="bomchix">
           <title>活动路径：</title>
           <para>不需要操作，跳过<xref linkend="bomc8jz" xrefstyle="StepXRef"/> 并继续<xref linkend="bomcboo" xrefstyle="StepXRef"/>。</para>
          </formalpara>
         </listitem>
         <listitem>
          <formalpara id="bomciib">
           <title>不活动路径：</title>
           <para>必须更改配置并重新安装引导加载程序。继续<xref linkend="bomc8jz" xrefstyle="StepXRef"/>。</para>
          </formalpara>
         </listitem>
        </itemizedlist>
       </step>
      </substeps>
     </step>
     <step id="bomc8jz" performance="required">
      <para role="intro">如果 hd0 条目指向不活动路径，请更改配置并重新安装引导加载程序：</para>
      <substeps performance="required">
       <step id="bomcmd6" performance="required">
        <para role="intro">在控制台的命令提示符处，输入以下命令：</para>

<screen>
mount -o bind /dev /mnt/dev

mount -o bind /sys /mnt/sys

mount -o bind /proc /mnt/proc

chroot

</screen>

       </step>
       <step id="bomclu7" performance="required">
        <para role="intro">在控制台中，运行 <command>multipath -ll</command>，然后检查输出以找到活动路径。 </para>
        <para>不活动路径标有 <literal>ghost</literal> 字样。</para>
       </step>
       <step id="bomcmwr" performance="required">
        <para>在 <filename>/mnt/boot/grub/device.map</filename> 文件中，将 <literal>hd0</literal> 条目更改为活动路径，保存更改并关闭文件。</para>
       </step>
       <step id="bomcndj" performance="required">
        <para role="intro">如果选择从 MBR 引导，<filename>/etc/grub.conf</filename> 应该看上去如下所示：</para>

<screen>
setup --stage2=/boot/grub/stage2 (hd0) (hd0,0)
quit
</screen>

       </step>
       <step id="bomcoe1" performance="required">
        <para role="intro">输入以下命令重新安装引导加载程序</para>

<screen>
grub &lt; /etc/grub.conf
</screen>

       </step>
       <step id="bomcol7" performance="required">
        <para role="intro">输入以下命令：</para>

<screen>
exit

umount /mnt/*

umount /mnt
</screen>

       </step>
      </substeps>
     </step>
     <step id="bomcboo" performance="required">
      <para>按 CTRL+ALT+F7 返回 YaST 图形环境。 </para>
     </step>
     <step id="bomcjfg" performance="required">
      <para>单击<guimenu>确定</guimenu>继续安装重引导。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="bomc64f">
   <title>为现有根设备启用多路径 I/O</title>
   <procedure id="b7cjqvq">
    <step id="b7cjqvr" performance="required">
     <para>将 Linux 安装为仅有一个路径活动（最好是分区程序中列出 <filename>by-id</filename> 符号链接的路径）。</para>
    </step>
    <step id="b7cjrle" performance="required">
     <para>使用安装期间使用的 <filename>/dev/disk/by-id</filename> 路径装入设备。</para>
    </step>
    <step id="b7cjs32" performance="required">
     <para>安装之后，向 <filename>/etc/sysconfig/kernel:INITRD_MODULES</filename> 中添加 <command>dm-multipath</command>。</para>
    </step>
    <step id="bky5jc7" performance="required">
     <para>对于 System Z，在运行 mkinitrd 之前，请编辑文件 <filename>/etc/zipl.conf</filename> 以将 <filename>zipl.conf</filename> 中的按路径信息更改为 /<filename>etc/fstab</filename> 中所使用的相同按 ID 信息。 </para>
    </step>
    <step id="b7cjsl3" performance="required">
     <para>重新运行 <command>/sbin/mkinitrd</command> 以更新 <filename>initrd</filename> 映像。</para>
    </step>
    <step id="bky5j1x" performance="required">
     <para>对于 System Z，在运行 <command>mkinitrd</command> 之后，请运行 <command>zipl</command>。</para>
    </step>
    <step id="b7cjuv4" performance="required">
     <para>重引导服务器。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="bomc64g">
   <title>禁用根设备上的 I/O 多路径</title>
   <procedure id="b7jqdde">
    <step id="b7jqddf" performance="required">
     <para>向内核命令行中添加 <literal>multipath=off</literal>。</para>
     <para>这仅会影响根设备。不会影响所有其他设备。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="mpioraid">
  <title>为现有软件 RAID 配置多路径 I/O</title>
  <para>理想的情况下，应先为设备配置多路径，再将这些设备用作软件 RAID 设备的组件。如果创建任何软件 RAID 设备之后添加多路径，则在重引导时，DM-MPIO 服务可能会比 <command>multipath</command> 服务启动得晚，导致多路径似乎不可用于 RAID。您可以使用本节中的过程使多路径对先前现有的软件 RAID 运行。 </para>
  <para>例如，您可能需要在以下情况中对软件 RAID 中的设备配置多路径：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>如果在全新安装或升级期间将一个新的软件 RAID 创建为分区设置的一部分。</para>
   </listitem>
   <listitem>
    <para>如果在软件 RAID 将设备用作成员设备或备用设备之前，没有将这些设备配置为支持多路径。</para>
   </listitem>
   <listitem>
    <para>如果通过向服务器添加新的 HBA 适配器或扩展 SAN 中的储存子系统而增加了系统规模。 </para>
   </listitem>
  </itemizedlist>
  <note>
   <para>以下指令假定软件 RAID 设备是 <filename>/dev/mapper/mpath0&gt;</filename>，这是内核所识别的设备名。它假设您已按照<xref linkend="mpionames" xrefstyle="HeadingOnPage"/>中的说明启用了 <filename>/etc/multipath.conf</filename> 文件中的用户友好名称。 </para>
   <para>确保按照您软件 RAID 的设备名修改指令。</para>
  </note>
  <procedure id="b59pkd5">
   <step id="b59qv1e" performance="required">
    <para role="intro">打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
    <para>除非另行说明，请使用此控制台输入以下步骤中的命令。</para>
   </step>
   <step id="b59qezr" performance="required">
    <para>如果当前已装入或正在运行任何软件 RAID 设备，请为每个设备输入以下命令以卸下并停止该设备。</para>

<screen>
umount /dev/mapper/mpath0
</screen>


<screen>
mdadm --misc --stop /dev/mapper/mpath0
</screen>

   </step>
   <step id="b59q95b" performance="required">
    <para>通过输入以下命令停止 <command>boot.md</command> 服务</para>

<screen>
/etc/init.d/boot.md stop
</screen>

   </step>
   <step id="b59qeuu" performance="required">
    <para>通过输入以下命令启动 <filename>boot.multipath</filename> 和 <filename>multipathd</filename> 服务：</para>

<screen>
/etc/init.d/boot.multipath start
</screen>


<screen>
/etc/init.s/multipathd start
</screen>

   </step>
   <step id="b59qp65" performance="required">
    <para>启动多路径服务之后，校验软件 RAID 的组件设备是否已列在 <filename>/dev/disk/by-id</filename> 目录中。执行以下操作之一：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b59qrp7">
       <title>已列出设备：</title>
       <para>现在设备名应已具有到其设备映射程序多路径设备名的符号链接，例如 <filename>/dev/dm-1</filename>。 </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b59qrx0">
       <title>未列出设备：</title>
       <para>刷新并重新发现设备，强制多路径服务识别它们。 </para>
      </formalpara>
      <para>要执行此操作，输入以下命令：</para>

<screen>
multipath -F
</screen>


<screen>
multipath -v0
</screen>

      <para>这些设备现在应已在 <filename>/dev/disk/by-id</filename> 中列出，并且有到其设备映射程序多路径设备名的符号链接。例如：</para>

<screen>
lrwxrwxrwx 1 root root 10 2011-01-06 11:42 dm-uuid-mpath-36006016088d014007e0d0d2213ecdf11 -&gt; ../../dm-1
</screen>

     </listitem>
    </itemizedlist>
   </step>
   <step id="b59qtrw" performance="required">
    <para>通过输入以下命令，重启动 <filename>boot.md</filename> 服务和 RAID 设备 </para>

<screen>
/etc/init.d/boot.md start
</screen>

   </step>
   <step id="b59qu7z" performance="required">
    <para>通过输入以下命令，检查软件 RAID 的状态</para>

<screen>
mdadm --detail /dev/mapper/mpath0
</screen>

    <para>RAID 的组件设备应匹配在 <filename>/dev/disk/by-id</filename> 目录中列为设备符号链接的设备映射程序多路径设备名。</para>
   </step>
   <step id="b59r62x" performance="required">
    <para>制作新的 <filename>initrd</filename> 以确保重引导时设备映射程序多路径服务在 RAID 服务之前装载。只有 root (/) 设备或其任何部分（比如 <filename>/var</filename>、<filename>/etc</filename> 和 <filename>/log</filename>）在 SAN 上，并且需要使用多路径引导，才需要运行 <command>mkinitrd</command> 命令。</para>
    <para>输入</para>

<screen>
mkinitrd -f multipath
</screen>

   </step>
   <step id="b59rekg" performance="required">
    <para>重引导服务器以应用这些安装后进行的配置设置。</para>
   </step>
   <step id="b59rf4m" performance="required">
    <para>通过检查 RAID 状态，校验软件 RAID 阵列在多路径设备之上正确工作。输入</para>

<screen>
mdadm --detail /dev/mapper/mpath0
</screen>

    <para>例如：</para>
    <simplelist>
     <member><literal>Number Major Minor RaidDevice State</literal></member> <member> <literal>0 253 0 0 active sync /dev/dm-0</literal></member> <member> <literal>1 253 1 1 active sync /dev/dm-1</literal></member> <member> <literal>2 253 2 2 active sync /dev/dm-2</literal></member>
    </simplelist>
   </step>
  </procedure>
 </sect1>
 <sect1 id="scandev">
  <title>在不重引导的情况下扫描新设备</title>
  <para>如果系统已针对多路径进行配置并且稍后需要向 SAN 添加更多储存区，则可以使用脚本 <command>rescan-scsi-bus.sh</command> 扫描新设备。默认情况下，此脚本将扫描具有典型 LUN 范围的所有 HBA。 </para>
  <warning>
   <para>在 EMC PowerPath 环境中，请勿使用操作系统随附的 <filename>rescan-scsi-bus.sh</filename> 实用程序或 HBA 供应商脚本来扫描 SCSI 总线。为了避免可能发生的文件系统损坏，EMC 要求您遵照 EMC PowerPath for Linux 的供应商文档中提供的过程操作。</para>
  </warning>
  <bridgehead id="boimjzp">语法</bridgehead>

<screen>
rescan-scsi-bus.sh [options] [host [host ...]]
</screen>

  <para>可以通过命令行（已弃用）指定主机，或使用 <literal>--hosts=LIST</literal> 选项（建议）。</para>
  <bridgehead id="boimk55">选项</bridgehead>
  <para>对于大多数储存子系统，此脚本可在无选项的情况下成功运行。但是，某些特殊情况可能需要针对脚本 <command>rescan-scsi-bus.sh</command> 使用以下参数中的一个或多个：</para>
  <informaltable role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="2381*"/>
   <colspec colnum="2" colname="2" colwidth="7620*"/>
    <thead>
     <row id="boiml8l">
      <entry>
       <para>选项</para>
      </entry>
      <entry>
       <para>描述</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="boiml8m">
      <entry>

<screen>
-l
</screen>
</entry>
      <entry>
       <para>激活对 LUN 0-7 的扫描。[默认值：0]</para>
      </entry>
     </row>
     <row id="boiml8n">
      <entry>

<screen>
-L NUM
</screen>
</entry>
      <entry>
       <para>激活对 LUN 0 到 NUM 的扫描。[默认值：0]</para>
      </entry>
     </row>
     <row id="boiml8o">
      <entry>

<screen>
-w
</screen>
</entry>
      <entry>
       <para>扫描目标设备 ID 0 到 15。[默认值：0 到 7]</para>
      </entry>
     </row>
     <row id="boimoae">
      <entry>

<screen>
-c
</screen>
</entry>
      <entry>
       <para>启用通道 0 或 1 的扫描。[默认值：0]</para>
      </entry>
     </row>
     <row id="boimoaf">
      <entry>

<screen>
-r
--remove
</screen>
</entry>
      <entry>
       <para>启用设备的删除。[默认值：已禁用]</para>
      </entry>
     </row>
     <row id="boimoag">
      <entry>

<screen>
-i
--issueLip
</screen>
</entry>
      <entry>
       <para>发出光纤通道 LIP 重设置。[默认值：已禁用]</para>
      </entry>
     </row>
     <row id="boimoah">
      <entry>

<screen>
--forcerescan
</screen>
</entry>
      <entry>
       <para>重新扫描现有设备。</para>
      </entry>
     </row>
     <row id="boimoai">
      <entry>

<screen>
--forceremove
</screen>
</entry>
      <entry>
       <para>删除并重新添加每个设备。 </para>
       <warning>
        <para>使用时要小心，此选项有风险。</para>
       </warning>
      </entry>
     </row>
     <row id="boimoaj">
      <entry>

<screen>
--nooptscan
</screen>
</entry>
      <entry>
       <para>如果找不到 0，则不停止查找 LUN。</para>
      </entry>
     </row>
     <row id="boj5t9m">
      <entry>

<screen>
--color
</screen>
</entry>
      <entry>
       <para>使用彩色前缀 OLD/NEW/DEL。</para>
      </entry>
     </row>
     <row id="boj5t9n">
      <entry>

<screen>
--hosts=LIST
</screen>
</entry>
      <entry>
       <para>仅扫描 LIST 中的主机，其中 LIST 是单值和范围的逗号分隔列表。不允许空格。</para>

<screen>
--hosts=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row id="boj5t9o">
      <entry>

<screen>
--channels=LIST
</screen>
</entry>
      <entry>
       <para>仅扫描 LIST 中的通道，其中 LIST 是单值和范围的逗号分隔列表。不允许空格。 </para>

<screen>
--channels=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row id="boj5t9p">
      <entry>

<screen>
--ids=LIST
</screen>
</entry>
      <entry>
       <para>仅扫描 LIST 中的目标 ID，其中 LIST 是单值和范围的逗号分隔列表。不允许空格。 </para>

<screen>
--ids=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row id="boimoak">
      <entry>

<screen>
--luns=LIST
</screen>
</entry>
      <entry>
       <para>仅扫描 LIST 中的 LUN，其中 LIST 是单值和范围的逗号分隔列表。不允许空格。</para>

<screen>
--luns=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <bridgehead id="boj5xxj">操作步骤</bridgehead>
  <para>使用以下过程扫描设备并在不重引导系统的情况下使这些设备可用于多路径。 </para>
  <procedure id="b59rt6j">
   <step id="b59rt6k" performance="required">
    <para>在储存子系统上，使用供应商的工具分配设备并更新其访问控制设置，以允许 Linux 系统访问新的储存区。有关细节，请参见供应商的文档。</para>
   </step>
   <step id="b59rw69" performance="required">
    <para>在所有目标中扫描查找一个主机，使其新设备为 Linux 内核 SCSI 子系统的中间层所知。在终端控制台提示符下，输入</para>

<screen>
rescan-scsi-bus.sh [options]
</screen>

   </step>
   <step id="b8ru7x3" performance="required">
    <para>在系统日志（<filename>/var/log/messages</filename> 文件）中查找扫描进度。在终端控制台提示符下，输入</para>

<screen>
tail -30 /var/log/messages
</screen>

    <para>此命令显示日志的最后 30 行。例如：</para>

<screen>
# tail -30 /var/log/messages
. . .
Feb 14 01:03 kernel: SCSI device sde: 81920000
Feb 14 01:03 kernel: SCSI device sdf: 81920000
Feb 14 01:03 multipathd: sde: path checker registered
Feb 14 01:03 multipathd: sdf: path checker registered
Feb 14 01:03 multipathd: mpath4: event checker started
Feb 14 01:03 multipathd: mpath5: event checker started
Feb 14 01:03:multipathd: mpath4: remaining active paths: 1
Feb 14 01:03 multipathd: mpath5: remaining active paths: 1
</screen>

   </step>
   <step id="b8ruapd" performance="required">
    <para>重复<xref linkend="b59rw69" xrefstyle="StepXRef"/>到<xref linkend="b8ru7x3" xrefstyle="StepXRef"/>，以添加通过连接到新设备上的 Linux 系统上的其他 HBA 适配器的路径。</para>
   </step>
   <step id="b59ryjx" performance="required">
    <para>运行 <command>multipath</command> 命令以识别 DM-MPIO 配置的设备。在终端控制台提示符下，输入 </para>

<screen>
multipath
</screen>

    <para>现在可以为多路径配置新设备了。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="be48i9g">
  <title>在不重引导的情况下扫描新的分区设备</title>
  <para role="intro">使用本节中的示例，在不重引导的情况下检测新添加的多路径 LUN。</para>
  <warning>
   <para>在 EMC PowerPath 环境中，请勿使用操作系统随附的 <filename>rescan-scsi-bus.sh</filename> 实用程序或 HBA 供应商脚本来扫描 SCSI 总线。为了避免可能发生的文件系统损坏，EMC 要求您遵照 EMC PowerPath for Linux 的供应商文档中提供的过程操作。</para>
  </warning>
  <procedure id="befqdst">
   <step id="befqdsu" performance="required">
    <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户登录。</para>
   </step>
   <step id="boj61wx" performance="required">
    <para>在所有目标中扫描查找一个主机，使其新设备为 Linux 内核 SCSI 子系统的中间层所知。在终端控制台提示符下，输入</para>

<screen>
rescan-scsi-bus.sh [options]
</screen>

    <para>有关脚本 <filename>rescan-scsi-bus-sh</filename> 的语法和选项信息，请参见<xref linkend="scandev" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
   <step id="befqeer" performance="required">
    <para>通过输入以下命令校验该设备是否可见（例如链接是否有一个新的时戳）</para>

<screen>
ls -lrt /dev/dm-*
</screen>

    <para>您也可以通过输入以下命令来校验设备存在于 <filename>/dev/disk/by-id</filename> 中</para>

<screen>
ls -l /dev/disk/by-id/
</screen>

   </step>
   <step id="befqfh9" performance="required">
    <para>通过输入以下命令，校验新设备是否出现在日志中</para>

<screen>
tail -33 /var/log/messages
</screen>

   </step>
   <step id="befqhvc" performance="required">
    <para>使用文本编辑器，在 <filename>/etc/multipath.conf</filename> 文件中为该设备添加新的别名定义，例如 <filename>data_vol3</filename>。 </para>
    <para>例如，如果 UUID 是 <filename>36006016088d014006e98a7a94a85db11</filename>，则进行以下更改：</para>

<screen>
defaults {
     user_friendly_names   yes
  }
multipaths {  
     multipath {      
          wwid    36006016088d014006e98a7a94a85db11      
          alias  data_vol3      
          }
  }
</screen>

   </step>
   <step id="befqj91" performance="required">
    <para>通过输入以下命令，为该设备创建分区表</para>

<screen>
fdisk /dev/disk/by-id/dm-uuid-mpath-&lt;UUID&gt;
</screen>

    <para>使用设备的 WWID（如 <filename>36006016088d014006e98a7a94a85db11</filename>）替换 UUID。</para>
   </step>
   <step id="befqjhp" performance="required">
    <para>通过输入以下命令触发 udev</para>

<screen>
echo 'add' &gt; /sys/block/&lt;<replaceable>dm_device</replaceable>&gt;/uevent
</screen>

    <para>例如，要为 <filename>dm-8</filename> 上的分区生成设备映射程序设备，请输入</para>

<screen>
echo 'add' &gt; /sys/block/dm-8/uevent
</screen>

   </step>
   <step id="befqkj8" performance="required">
    <para>通过输入以下命令，为新分区创建文件系统和标签：</para>

<screen>
mke2fs -j /dev/disk/by-id/dm-uuid-mpath-&lt;<replaceable>UUID_partN</replaceable>&gt;
tune2fs -L <replaceable>data_vol3</replaceable> /dev/disk/by-id/dm-uuid-&lt;<replaceable>UUID_partN</replaceable>&gt;
</screen>

    <para>使用实际的 UUID 以及分区编号（如 36006016088d014006e98a7a94a85db11_part1）替换 <filename>UUID_part1</filename>。</para>
   </step>
   <step id="befqljm" performance="required">
    <para>输入以下命令以重启动 DM-MPIO，使其读取别名。</para>

<screen>
/etc/init.d/multipathd restart
</screen>

   </step>
   <step id="befqmbi" performance="required">
    <para role="intro">通过输入以下命令，校验该设备已由 <command>multipathd</command> 识别</para>

<screen>
multipath -ll
</screen>

   </step>
   <step id="befqmno" performance="required">
    <para>使用文本编辑器在 <filename>/etc/fstab</filename> 文件中添加新的装入项。 </para>
    <para>此时，在<xref linkend="befqhvc" xrefstyle="StepXRef"/>中创建的别名还不在 <filename>/dev/disk/by-label</filename> 目录中。添加 <filename>/dev/dm-9</filename> 路径的装入项，然后下次先更改该项，再重引导为 </para>

<screen>
LABEL=data_vol3
</screen>

   </step>
   <step id="befqr98" performance="required">
    <para>创建一个目录用作安装点，然后通过输入以下命令，装入该设备</para>

<screen>
md <replaceable>/data_vol3</replaceable>
</screen>


<screen>
mount <replaceable>/data_vol3</replaceable>
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="mpiostatus">
  <title>查看多路径 I/O 状态</title>
  <para>查询多路径 I/O 状态会输出多路径映射的当前状态。 </para>
  <para><command>multipath -l</command> 选项可显示从上次运行路径检查程序以来的当前路径状态。它不会运行路径检查程序。 </para>
  <para><command>multipath -ll</command> 选项运行路径检查程序，更新路径信息，然后显示当前状态信息。此选项总是显示关于路径状态的最新信息。</para>
  <procedure id="b8ruq0c">
   <step id="b8ruq0d" performance="required">
    <para>在终端控制台提示符下，输入</para>

<screen>
multipath -ll
</screen>

    <para>这将显示每个多路径设备的信息。例如：</para>

<screen>
3600601607cf30e00184589a37a31d911
[size=127 GB][features="0"][hwhandler="1 emc"]
</screen>


<screen>
\_ round-robin 0 [active][first]
  \_ 1:0:1:2 sdav 66:240  [ready ][active]
  \_ 0:0:1:2 sdr  65:16   [ready ][active]
</screen>


<screen>
\_ round-robin 0 [enabled]
  \_ 1:0:0:2 sdag 66:0    [ready ][active]
  \_ 0:0:0:2 sdc  8:32    [ready ][active]
</screen>

   </step>
  </procedure>
  <para>对于每个设备，它显示该设备的 ID、大小、功能和硬件处理程序。</para>
  <para>在设备发现时，通向该设备的路径会自动分组为多个优先级组。一次只有一个优先级组是活动的。对于活动/活动配置，所有路径均在同一组中。对于活动/不活动配置，不活动的路径会放在另外的优先级组中。 </para>
  <para>会针对每个组显示下列信息：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>用于在组内平衡 I/O 的日程安排策略，例如循环</para>
   </listitem>
   <listitem>
    <para>该组为活动、已禁用还是已启用</para>
   </listitem>
   <listitem>
    <para>该组是否是第一个（最高优先级）组</para>
   </listitem>
   <listitem>
    <para>该组内包含的路径</para>
   </listitem>
  </itemizedlist>
  <para>会针对每个路径显示下列信息：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>物理地址，格式为 <replaceable>host:bus:target:lun</replaceable>，例如 1:0:1:2</para>
   </listitem>
   <listitem>
    <para>设备节点名，例如 <filename>sda</filename></para>
   </listitem>
   <listitem>
    <para>主要:次要编号</para>
   </listitem>
   <listitem>
    <para>设备的状态</para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 id="mpioerrormgmt">
  <title>在错误状况下管理 I/O</title>
  <para>如果所有路径同时失败，则可能需要通过启用 queue_if_no_path 来配置多路径以使 I/O 排队。否则，I/O 将在通过所有路径后立即失败。在某些情形下，即驱动程序、HBA 或光纤遇到欺骗性错误时，应该将 DM-MPIO 配置为在这些错误导致丢失所有路径时将所有 I/O 排队，并且永不向上散播错误。 </para>
  <para>在群集中使用多路径设备时，可以选择禁用 queue_if_no_path。这会自动使路径失败，而不是使 I/O 排队，并升级 I/O 错误以引发群集资源的故障转移。</para>
  <para>因为启用 queue_if_no_path 会导致 I/O 无限排队（除非有一个路径恢复），所以请确保 <command>multipathd</command> 正在运行且在您的环境中起作用。否则，可能需要在受影响的多路径设备上永远停止 I/O，直到重引导或手动返回到故障转移而不是排队。</para>
  <para>测试该情形：</para>
  <procedure id="b5c8xoe">
   <step id="b7jqv1b" performance="required">
    <para>在终端控制台中，作为 <systemitem>root</systemitem> 用户登录。 </para>
   </step>
   <step id="b7jqw8e" performance="required">
    <para>通过输入以下命令，激活设备 I/O 的排队而不是故障转移：</para>

<screen>
dmsetup message <replaceable>device_ID</replaceable> 0 queue_if_no_path
</screen>

    <para>将<replaceable>设备 ID</replaceable> 替换为您的设备的 ID。值 0 代表扇区，在不需要扇区信息时使用该值。 </para>
    <para>例如，输入：</para>

<screen>
dmsetup message 3600601607cf30e00184589a37a31d911 0 queue_if_no_path
</screen>

   </step>
   <step id="b7jqwaz" performance="required">
    <para>通过输入以下命令，返回到设备 I/O 的故障转移：</para>

<screen>
dmsetup message <replaceable>device_ID</replaceable> 0 fail_if_no_path
</screen>

    <para>该命令会立即导致所有排队的 I/O 失败。</para>
    <para>将<replaceable>设备 ID</replaceable> 替换为您的设备的 ID。例如，输入：</para>

<screen>
dmsetup message 3600601607cf30e00184589a37a31d911 0 fail_if_no_path
</screen>

   </step>
  </procedure>
  <para>在所有路径失败的情形下设置将 I/O 排队：</para>
  <procedure id="b7jqzyt">
   <step id="b7jr0j0" performance="required">
    <para>在终端控制台中，作为 <systemitem>root</systemitem> 用户登录。 </para>
   </step>
   <step id="b5c9aza" performance="required">
    <para>在文本编辑器中打开 <filename>/etc/multipath.conf</filename>。</para>
   </step>
   <step id="b5c99rh" performance="required">
    <para>取消注释 defaults 部分及其结尾括号，然后如下所示添加 <literal>default_features</literal> 设置：</para>

<screen>
defaults {
  default_features "1 queue_if_no_path"
}
</screen>

   </step>
   <step id="bi0b03b" performance="required">
    <para>修改 <filename>/etc/multipath.conf</filename> 文件之后，必须在您的系统上运行 <command>mkinitrd</command> 以重新创建 <filename>initrd</filename>，然后重引导使更改生效。</para>
   </step>
   <step id="b7jr4r4" performance="required">
    <para>当准备好返回到设备 I/O 的故障转移时，输入：</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 fail_if_no_path
</screen>

    <para>将<replaceable>映射名称</replaceable>替换为映射的别名或该设备的设备 ID。值 0 代表扇区，在不需要扇区信息时使用该值。 </para>
    <para>此命令会立即导致所有排队的 I/O 失败，并且将该错误传播到调用的应用程序。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="mpiostall">
  <title>解决停止的 I/O</title>
  <para>如果所有路径同时失败，并且 I/O 排队并停止，请执行以下操作：</para>
  <procedure id="b7jlq1g">
   <step id="b7jlq1h" performance="required">
    <para>在终端控制台提示符下输入以下命令：</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 fail_if_no_path
</screen>

    <para>将<literal><replaceable>映射名称</replaceable></literal>替换为正确的设备 ID 或设备的映射别名。值 0 代表扇区，在不需要扇区信息时使用该值。 </para>
    <para>此命令会立即导致所有排队的 I/O 失败，并且将该错误传播到调用的应用程序。 </para>
   </step>
   <step id="b7jlq74" performance="required">
    <para>通过在终端控制台提示符输入以下命令重激活排队：</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 queue_if_no_path
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bpjpirk">
  <title>MPIO 查错</title>
  <para>本节对 MPIO 的一些已知问题以及可行的解决方案进行了说明。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b11qkzgw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122uxzr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b11qkzgx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b11qkzgw">
   <title>升级至多路径 0.4.9 后单个设备的 PRIO 设置不起作用</title>
   <para>SLES  11 SP2 的多路径工具 0.4.9 使用 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 部分中的 <literal>prio</literal> 设置。当为 <literal>multipaths{}</literal> 部分中的单个 <literal>multipath</literal> 定义指定关键字 <literal>prio</literal> 时，它将被忽略而无反馈。</para>
   <para>在适用于 SLES  11 SP1 的多路径工具 0.4.8 以及早期版本中，允许使用 <literal>multipaths{}</literal> 部分中单个 <literal>multipath</literal> 定义中的 prio 设置来覆盖 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 部分中的 <literal>prio</literal> 设置。</para>
  </sect2>
  <sect2 id="b122uxzr">
   <title>升级至 multipath-tools-0.4.9 后带有自变量的 PRIO 设置不起作用</title>
   <para>从 <filename>multipath-tools-0.4.8</filename> 升级到 <filename>multipath-tools-0.4.9</filename> 时，若优先级排序程序需要自变量，则 <filename>/etc/multipath.conf</filename> 文件中的 <literal>prio</literal> 设置会损坏。在 multipath-tools-0.4.9 中，使用关键字 <literal>prio</literal> 指定优先级排序程序，使用关键字 <literal>prio_args</literal> 为需要自变量的优先级排序程序指定自变量。而在早前版本中，优先级排序程序及其自变量均在同一个 <literal>prio</literal> 行上指定。</para>
   <para>例如，在 multipath-tools-0.4.8 中，可使用以下一行命令指定优先级排序程序及其自变量。</para>

<screen>
prio "weightedpath hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"
</screen>

   <para role="intro">因此升级到 <command>multipath-tools-0.4.9</command> 之后，该命令会导致错误。出现的消息类似如下所示：</para>

<screen>
&lt;Month day hh:mm:ss&gt; | Prioritizer 'weightedpath hbtl [1,3]:.:.+:.+ 260
[0,2]:.:.+:.+ 20' not found in /lib64/multipath
</screen>

   <para>要解决此问题，请使用文本剪辑器修改 <filename>/etc/multipath.conf</filename> 文件中的 <literal>prio</literal> 行。创建两行，其中 <filename>prio</filename> 行指定优先级排序程序，而下方的 <filename>prio_args</filename> 行指定其自变量：</para>

<screen>
prio "weightedpath"
prio_args "hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"
</screen>

  </sect2>
  <sect2 id="b11qkzgx">
   <title>技术信息文档</title>
   <para>有关 SUSE Linux Enterprise Server 上多路径 I/O 问题的查错信息，请参见 Novell 支持知识库中的以下技术信息文档 (TID)：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=3231766"><citetitle>SLES 多路径 (MPIO) 问题查错 (TID 3231766)</citetitle></ulink></para>
    </listitem>
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=3029706"><citetitle>在 multipath.conf 中未遵从 DM MPIO 设备黑名单 (TID3029706)</citetitle></ulink></para>
    </listitem>
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=3955167"><citetitle>SCSI (LUN) 扫描问题查错 (TID 3955167)</citetitle></ulink></para>
    </listitem>
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=7007498"><citetitle>在多路径 (DM MPIO) 设备上使用 LVM</citetitle></ulink></para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 id="mpionext">
  <title>下一步</title>
  <para>如果想要使用软件 RAID，先创建和配置它们，然后再在这些设备上创建文件系统。有关信息，请参见以下内容：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidyast" xrefstyle="ChapTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadm" xrefstyle="ChapTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>

<chapter id="raidyast" lang="en" xml:base="05_raid.xml">
 <title>软件 RAID 配置</title>
 <para>RAID（独立磁盘冗余阵列）的用途是将多个硬盘分区合并成一个大的虚拟硬盘，以便优化性能和/或数据安全性。大多数 RAID 控制器使用 SCSI 协议，因为对大量硬盘，它可用比 IDE 协议更高效的方式寻址，更适于命令的并行处理。还有一些支持 IDE 或 SATA 硬盘的 RAID 控制器。软件 RAID 具有 RAID 系统的优势，同时没有硬件 RAID 控制器的额外成本。但是这需要一些 CPU 时间以及内存，所以不适用于真正高性能的计算机。 </para>
 <important>
  <para>在群集文件系统（例如 OCFS2）下不支持软件 RAID，因为 RAID 不支持并行激活。如果想要 RAID 用于 OCFS2，则需要 RAID 由储存子系统处理。</para>
 </important>
 <para>SUSE Linux Enterprise 提供了将若干硬盘组合为一个软 RAID 系统的选项。RAID 暗示将多块硬盘合成一个 RAID 系统的多种策略，这些策略的目标、优点及特点各不相同。这些变化形式通常称作 <emphasis>RAID 级别</emphasis>。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi70wwi" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec.yast2.system.raid.yast" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchysg" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchysh" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi70wwi">
  <title>了解 RAID 级别</title>
  <para>本节描述常见的 RAID 级别 0、1、2、3、4、5 和嵌套的 RAID 级别。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bgchysa" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysb" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchyse" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bgchysa">
   <title>RAID 0</title>
   <para>此级别通过将每个文件按块分放到多个磁盘驱动器上，提高了数据访问性能。这实际上并不是真正的 RAID，因为它未提供数据备份，但 <emphasis>RAID  0</emphasis> 已成为这种类型的系统的标准名称。使用 RAID 0，可以将两块或多块硬盘组合在一起。这样性能固然很好，但如果有任何一块硬盘出现故障，都将损坏 RAID 系统并丢失数据。 </para>
  </sect2>
  <sect2 id="bgchysb">
   <title>RAID 1</title>
   <para>此级别为数据提供了充分的安全性，因为它将数据按 1:1 复制到另一块硬盘上。这种方法称为<emphasis>硬盘镜像</emphasis>。如果一块磁盘损坏，则可以使用另一块镜像磁盘上的内容副本。在所有这些硬盘中，只要有一块硬盘没有损坏，您的数据就不会丢失。但是，如果没有检测到损坏，损坏的数据可能会镜像到正确的磁盘，并以这种方式损坏其数据。与使用单个磁盘访问时相比，写性能在复制过程中稍有损失（慢 10% 到 20%），但读访问的速度要大大快于任何一块普通物理硬盘，原因是对数据进行了复制，从而可以并行扫描它们。RAID 1 通常提供几乎为单个磁盘读事务速率两倍的速率，写事务速率与单个磁盘几乎相同。 </para>
  </sect2>
  <sect2 id="bgchysc">
   <title>RAID 2 和 RAID 3</title>
   <para>这些不是典型的 RAID 实现。级别 2 在位一级而不是块一级对数据进行分段。级别 3 则利用专用的校验磁盘在字节一级进行分段，但不能同时处理多个请求。这两种级别都极少使用。 </para>
  </sect2>
  <sect2 id="bgchysd">
   <title>RAID 4</title>
   <para>级别 4 与级别 0 一样，也是在块一级进行分段，只是结合使用了专用的校验磁盘。如果一块数据磁盘失败，将使用奇偶校验数据创建替换磁盘。不过，这块奇偶校验磁盘可能造成写访问的瓶颈。尽管如此，有时仍使用级别 4。 </para>
  </sect2>
  <sect2 id="bgchyse">
   <title>RAID 5</title>
   <para>RAID 5 是级别 0 和级别 1 在性能和冗余方面经优化后的折衷方案。硬盘空间等于使用的磁盘数减 1。数据分布在这些硬盘上，这一点与 RAID  0 相同。但出于安全原因，在其中一个分区上创建了<emphasis>奇偶校验块</emphasis>。这些块通过 XOR 互相链接，并在系统出现故障时，通过启用相应的校验块重构建内容。对于 RAID 5，在同一时间只能有一块硬盘出现故障。如果一块硬盘出现故障，则必须尽快将其更换，以防止丢失数据。 </para>
  </sect2>
  <sect2 id="bgchysf">
   <title>嵌套的 RAID 级别</title>
   <para>已经开发出了若干其他 RAID 级别，例如 RAIDn、RAID 10、RAID 0+1、RAID 30 和 RAID 50。硬件供应商正在专有实施其中的一些。由于这些级别并不是很普及，在此不再赘述。 </para>
  </sect2>
 </sect1>
 <sect1 id="sec.yast2.system.raid.yast">
  <title>使用 YaST 配置软 RAID</title>
  <para>可以通过 YaST 专家分区程序访问 YaST 软 RAID 配置。此分区工具用于编辑和删除现有分区并创建用于软 RAID 的新分区。 </para>
  <para>利用该工具可创建 RAID 分区，方法是首先单击<menuchoice><guimenu>创建</guimenu><guimenu>不格式化</guimenu></menuchoice>，然后选择 <guimenu>0xFD Linux RAID</guimenu> 作为分区标识符。对于 RAID 0 和 RAID 1，至少需要两个分区，而对于 RAID 1，通常只需要两个分区。如果使用 RAID 5，则至少需要 3 个分区。 建议仅使用大小相同的分区，因为每个段仅可将相同的空间量作为最小大小的分区。应将 RAID 分区储存在不同硬盘上，以降低由于某块硬盘出现问题而丢失数据的风险（RAID 1 和 5），同时还可以优化 RAID 0 的性能。创建了所有用于 RAID 的分区后，请单击 <menuchoice><guimenu>RAID</guimenu><guimenu>创建 RAID</guimenu></menuchoice> 开始 RAID 配置。 </para>
  <para>在向导的下一页上，从 RAID 级别 0、1 和 5 中进行选择，然后单击<guimenu>下一步</guimenu>。以下对话框（请参见<xref linkend="fig.yast2.raid2" xrefstyle="FigureXRef"/>）列出类型为 <guimenu>Linux RAID</guimenu> 或 <guimenu>Linux native</guimenu> 的所有分区。未显示交换分区或 DOS 分区。如果已将某个分区指派给 RAID 卷，则在列表中显示此 RAID 设备的名称（例如，<filename>/dev/md0</filename>）。用<quote>--</quote>表示未指派的分区。 </para>
  <figure pgwide="0" id="fig.yast2.raid2">
   <title>RAID 分区</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_raid2_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>要将以前未指派的分区添加到所选的 RAID 卷中，请先选择该分区，然后单击<guimenu>添加</guimenu>。此时，RAID 设备的名称将显示在所选分区的旁边。指派所有为 RAID 保留的分区。否则，分区中的空间仍处于未使用状态。指派了所有分区后，单击<guimenu>下一步</guimenu>进入设置对话框，从中对性能进行微调（请参见<xref linkend="fig.yast2.raid3" xrefstyle="FigureXRef"/>）。 </para>
  <figure pgwide="0" id="fig.yast2.raid3">
   <title>文件系统设置</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_raid3_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>与传统的分区一样，设置所用的文件系统，以及 RAID 卷的加密方法和安装点。单击<guimenu>完成</guimenu>完成配置后，请查看 <filename>/dev/md0</filename> 设备和专家分区程序中指示为 <emphasis>RAID</emphasis> 的其他设备。 </para>
 </sect1>
 <sect1 id="bgchysg">
  <title>软件 RAID 疑难解答</title>
  <para>查看 <filename>/proc/mdstats</filename> 文件以确定 RAID 分区是否受损。如果系统出现故障，请关闭 Linux 系统并用以同样方式分区的新硬盘替换出现问题的硬盘。然后重启动您的系统并输入命令 <command>mdadm /dev/mdX --add /dev/sdX</command>。将 <literal>X</literal> 替换为您的特定设备标识符。此命令会自动将该硬盘集成到 RAID 系统并进行完全重构建。 </para>
  <para>尽管可以在重构建期间访问所有数据，但在 RAID 完全重构建之前，仍然可能遇到一些性能问题。 </para>
 </sect1><?dbfo-need height="10em"?>


 <sect1 id="bgchysh">
  <title>更多信息</title>
  <para>位于下列位置的 HOWTO 文档提供了软 RAID 的配置说明和详细信息： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="https://raid.wiki.kernel.org/index.php/Linux_Raid"><citetitle>Linux RAID wiki</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><filename>/usr/share/doc/packages/mdadm/Software-RAID.HOWTO.html</filename> 文件中的<citetitle>软件 RAID HOWTO</citetitle></para>
   </listitem>
  </itemizedlist>
  <para>此外还提供有 Linux RAID 邮件列表，例如 <ulink url="http://marc.info/?l=linux-raid"><citetitle/>linux-raid</ulink>。</para>
 </sect1>
</chapter>

<chapter id="raidroot" lang="en" xml:base="05_raid_root.xml">
 <title>为根分区配置软件 RAID1</title>
 <para>在 SUSE Linux Enterprise Server 11 中，设备映射程序 RAID 工具已集成到 YaST 分区程序中。安装时可以使用此分区程序为包含根 (<filename>/</filename>) 分区的系统设备创建软件 RAID1。必须在单独的设备而不是 MD RAID1 上创建 <filename>/boot</filename> 分区。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi9d2lj" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9dppp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9dnnt" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi9d2lj">
  <title>针对根分区使用软件 RAID1 设备的先决条件</title>
  <para>请确保配置满足以下要求：</para>
  <itemizedlist mark="box" spacing="normal">
   <listitem>
    <para>创建 RAID1 镜像设备需要两块硬盘驱动器。硬盘驱动器应具有类似大小。RAID 使用较小驱动器大小。块储存设备可以是本地设备（计算机中或直接挂接到计算机）、光纤通道储存子系统或 iSCSI 储存子系统的任意组合。 </para>
   </listitem>
   <listitem>
    <para>需要第三台设备用于 <filename>/boot </filename>分区。引导设备应是本地设备。</para>
   </listitem>
   <listitem>
    <para>如果要使用硬件 RAID 设备，请不要在其上尝试运行软件 RAID。</para>
   </listitem>
   <listitem>
    <para>如果要使用 iSCSI 目标设备，必须在创建 RAID 设备之前启用对 iSCSI 发起程序的支持。</para>
   </listitem>
   <listitem>
    <para>如果储存子系统在服务器和其直接挂接的本地设备、光纤通设备或要在软件 RAID 中使用的 iSCSI 设备之间提供多个 I/O 路径，则在创建 RAID 设备之前必须启用多路径支持。</para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 id="bi9dppp">
  <title>在安装时启用 iSCSI 发起程序支持</title>
  <para>如果存在要用于根 (/) 分区的 iSCSI 目标设备，则必须启用 iSCSI 发起程序软件以使这些设备在创建软件 RAID1 设备之前变得可用。</para>
  <procedure id="bi9dppq">
   <step id="bi9dppr" performance="required">
    <para>继续 SUSE Linux Enterprise 11 的 YaST 安装，直至到达“安装设置”页。</para>
   </step>
   <step id="bi9dpps" performance="required">
    <para>单击<guimenu>分区</guimenu>打开“准备硬盘”页，单击<guimenu>自定义分区（仅限专家）</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="bi9dppt" performance="required">
    <para>在“专家分区程序”页上，展开<guimenu>系统视图</guimenu>面板中的<guimenu>硬盘</guimenu>以查看默认建议。</para>
   </step>
   <step id="bi9dppu" performance="required">
    <para>在<guimenu>硬盘</guimenu>页上，选择<guimenu>配置</guimenu><guimenu>配置 iSCSI</guimenu>，然后在系统提示继续初始化 iSCSI 发起程序配置时单击<guimenu>继续</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bi9dnnt">
  <title>在安装时启用多路径 I/O 支持</title>
  <para>如果要用于根 (/) 分区的设备存在多个 I/O 路径，则必须在创建软件 RAID1 设备之前启用多路径支持。</para>
  <procedure id="bi9dnnu">
   <step id="bi9dnnv" performance="required">
    <para>继续 SUSE Linux Enterprise 11 的 YaST 安装，直至到达“安装设置”页。</para>
   </step>
   <step id="bi9dnnw" performance="required">
    <para>单击<guimenu>分区</guimenu>打开“准备硬盘”页，单击<guimenu>自定义分区（仅限专家）</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="bi9dnnx" performance="required">
    <para>在“专家分区程序”页上，展开<guimenu>系统视图</guimenu>面板中的<guimenu>硬盘</guimenu>以查看默认建议。</para>
   </step>
   <step id="bi9dnny" performance="required">
    <para>在<guimenu>硬盘</guimenu>页上，选择<guimenu>配置</guimenu><guimenu>配置多路径</guimenu>，然后在系统提示激活多路径时单击<guimenu>是</guimenu>。 </para>
    <para>这会重新扫描设备并解析多个路径，以使每个设备在硬盘列表中仅列出一次。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bi9d19d">
  <title>为根 (/) 分区创建软件 RAID1 设备</title>
  <procedure id="bi9d207">
   <step id="bi9d208" performance="required">
    <para>继续 SUSE Linux Enterprise 11 的 YaST 安装，直至到达“安装设置”页。</para>
   </step>
   <step id="bi9dfe6" performance="required">
    <para>单击<guimenu>分区</guimenu>打开“准备硬盘”页，单击<guimenu>自定义分区（仅限专家）</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="bi9dgrg" performance="required">
    <para>在“专家分区程序”页上，展开<guimenu>系统视图</guimenu>面板中的<guimenu>硬盘</guimenu>以查看默认建议，选择建议的分区，然后单击<guimenu>删除</guimenu>。</para>
   </step>
   <step id="b13za1ue" performance="required">
    <para>创建 <filename>/boot</filename> 分区。</para>
    <substeps performance="required">
     <step id="b13za3rl" performance="required">
      <para>在“专家分区程序”页上的<guimenu>硬盘</guimenu>下，选择要用于 /boot 分区的设备，然后在<guimenu>硬盘分区</guimenu>选项卡上单击<guimenu>添加</guimenu>。</para>
     </step>
     <step id="b13za3rm" performance="required">
      <para>在<guimenu>新分区类型</guimenu>下，选择<guimenu>主分区</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="b13za3rn" performance="required">
      <para>在<guimenu>新分区大小</guimenu>下，指定要使用的大小，然后单击<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="b13za3ro" performance="required">
      <para>在<guimenu>格式化选项</guimenu>下，选择<guimenu>格式化分区</guimenu>，然后从下拉列表中选择您首选的文件系统类型（例如 Ext2 或 Ext3）。</para>
     </step>
     <step id="b13za3rp" performance="required">
      <para>在<guimenu>装入选项</guimenu>下，选择<guimenu>装入分区</guimenu>，然后从下拉列表中选择 <guimenu>/boot</guimenu>。</para>
     </step>
     <step id="b13za3rq" performance="required">
      <para>单击<guimenu>完成</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="bi9drnn" performance="required">
    <para>创建交换分区。</para>
    <substeps performance="required">
     <step id="bi9dq0p" performance="required">
      <para>在“专家分区程序”页上的<guimenu>硬盘</guimenu>下，选择要用于交换分区的设备，然后在<guimenu>硬盘分区</guimenu>选项卡上单击<guimenu>添加</guimenu>。</para>
     </step>
     <step id="bi9drt8" performance="required">
      <para>在<guimenu>新分区类型</guimenu>下，选择<guimenu>主分区</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9drz9" performance="required">
      <para>在<guimenu>新分区大小</guimenu>下，指定要使用的大小，然后单击<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9dt2p" performance="required">
      <para>在<guimenu>格式化选项</guimenu>下，选择<guimenu>格式化分区</guimenu>，然后从下拉列表中选择<guimenu>交换</guimenu>。</para>
     </step>
     <step id="bi9dtld" performance="required">
      <para>在<guimenu>装入选项</guimenu>下，选择<guimenu>装入分区</guimenu>，然后从下拉列表中选择<guimenu>交换</guimenu>。</para>
     </step>
     <step id="bi9du9n" performance="required">
      <para>单击<guimenu>完成</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="bi9dv06" performance="required">
    <para>为要用于软件 RAID1 的每个设备设置 <guimenu>0xFD Linux RAID</guimenu> 格式。</para>
    <substeps performance="required">
     <step id="bi9dx99" performance="required">
      <para>在“专家分区程序”页的<guimenu>硬盘</guimenu>下，选择要用于 RAID1 的设备，然后在<guimenu>硬盘分区</guimenu>选项卡上单击<guimenu>添加</guimenu>。</para>
     </step>
     <step id="bi9dx9a" performance="required">
      <para>在<guimenu>新分区类型</guimenu>下，选择<guimenu>主分区</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9dx9b" performance="required">
      <para>在<guimenu>新分区大小</guimenu>下，指定要使用最大大小，然后单击<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9dx9c" performance="required">
      <para>在<guimenu>格式化选项</guimenu>下，选择<guimenu>不格式化分区</guimenu>，然后从下拉列表中选择 <guimenu>0xFD Linux RAID</guimenu>。</para>
     </step>
     <step id="bi9dx9d" performance="required">
      <para>在<guimenu>装入选项</guimenu>下，选择<guimenu>不装入分区</guimenu>。</para>
     </step>
     <step id="bi9dx9e" performance="required">
      <para>单击<guimenu>完成</guimenu>。</para>
     </step>
     <step id="bi9dy2u" performance="required">
      <para>对计划用于软件 RAID 的每个设备重复<xref linkend="bi9dx99" xrefstyle="StepXRef"/>到<xref linkend="bi9dx9e" xrefstyle="StepXRef"/>。1.</para>
     </step>
    </substeps>
   </step>
   <step id="bi9e4kt" performance="required">
    <para>创建 RAID 设备。</para>
    <substeps performance="required">
     <step id="bi9djfy" performance="required">
      <para>在<guimenu>系统视图</guimenu>面板中，选择 <guimenu>RAID</guimenu>，然后在 RAID 页上单击<guimenu>添加 RAID</guimenu>。</para>
      <para>在<xref linkend="bi9dv06" xrefstyle="StepXRef"/>中准备的设备将列在<guimenu>可用设备</guimenu>中。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install_a.png" width="213pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="bi9dzpu" performance="required">
      <para>在 <guimenu>RAID 类型</guimenu>下，选择 <guimenu>RAID 1（镜像）</guimenu>。</para>
     </step>
     <step id="bi9e26m" performance="required">
      <para>在<guimenu>可用设备</guimenu>面板中，选择要用于 RAID 的设备，然后选择<guimenu>添加</guimenu>将设备移动到<guimenu>所选设备</guimenu>面板中。</para>
      <para>为 RAID1 指定两个或两个以上的设备。</para>
      <para>继续上例，为 RAID 1 选择了两个设备。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install2_a.png" width="218pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="bi9e393" performance="required">
      <para>单击<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9e3nr" performance="required">
      <para>在 <guimenu>RAID 选项</guimenu>下，从下拉列表中选择大块大小。</para>
      <para> RAID 1（镜像）的默认大块大小为 4 KB。</para>
      <para>可用大块大小有 4 KB、8 KB、16 KB、32 KB、64 KB、128 KB、256 KB、512 KB、1 MB、2 MB 或 4 MB。</para>
     </step>
     <step id="bi9e530" performance="required">
      <para>在<guimenu>正在格式化选项</guimenu>下，选择<guimenu>格式化分区</guimenu>，然后从<guimenu>文件系统</guimenu>下拉列表中选择文件系统类型（如 Ext3）。</para>
     </step>
     <step id="bi9e97s" performance="required">
      <para>在<guimenu>正在装入选项</guimenu>下，选择<guimenu>装入分区</guimenu>，然后从<guimenu>安装点</guimenu>下拉列表中选择 <filename>/</filename>。</para>
     </step>
     <step id="bi9e9uc" performance="required">
      <para>单击<guimenu>完成</guimenu>。</para>
      <para>软件 RAID 设备受管于设备映射程序，并会在路径 <filename>/dev/md0</filename> 下创建一个设备。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install3_a.png" width="213pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
    </substeps>
   </step>
   <step id="bi9ec68" performance="required">
    <para>在“专家分区程序”页上，单击<guimenu>接受</guimenu>。</para>
    <para>新建议将出现在“安装设置”页上的<guimenu>分区</guimenu>下。</para>
    <para>例如，设置 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="raid_yast_install4_a.png" width="129pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bi9eh7a" performance="required">
    <para>继续安装。</para>
    <para>只要重引导服务器，设备映射程序就会在引导时启动，以便自动识别软件 RAID，并可在根 (/) 分区上启动操作系统。</para>
   </step>
  </procedure>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,yes,,80" id="raidmdadm" lang="en" revision="01/23/09" xml:base="05_raid10.xml">
 <title>使用 mdadm 管理软件 RAID 6 和 10</title>
 <para>本章描述如何使用多个设备管理 (<command>mdadm(8)</command>) 工具创建软件 RAID 6 和 10 设备。您还可以使用 <filename>mdadm</filename> 创建 RAID 0、1、4 和 5。<command>mdadm</command> 工具提供了旧版程序 <command>mdtools</command> 和 <command>raidtools</command> 的功能。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="raidmdadmr6" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmr10nest" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmr10cpx" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmdegraded" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="raidmdadmr6">
  <title>创建 RAID 6</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr6ovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr6create" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="raidmdadmr6ovw">
   <title>了解 RAID 6</title>
   <para>RAID 6 实际上是 RAID 5 的扩展，通过允许第二种独立分布式奇偶校验模式（双重奇偶校验），允许更多容错功能。即使在数据恢复过程中两个硬盘设备失败，系统仍将继续运行，数据不会丢失。</para>
   <para>RAID 6 通过承受多个并行驱动器故障，而提供非常高的数据容错性能。它处理任何两个设备的丢失而不会丢失数据。此外，它还需要 N+2 个驱动器来储存相当于 N 个驱动器的数据。它需要至少 4 个设备。</para>
   <para>RAID 6 的性能稍微低一些，但在正常模式和单磁盘故障模式下可以与 RAID 5 媲美。它在双磁盘故障模式下非常慢。 </para>
   <table id="b8i9zn7" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>RAID 5 和 RAID 6 的比较</title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row id="b8ihegi">
       <entry>
        <para>功能</para>
       </entry>
       <entry>
        <para>RAID 5</para>
       </entry>
       <entry>
        <para>RAID 6</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8ihegj">
       <entry>
        <para>设备数</para>
       </entry>
       <entry>
        <para>N+1，至少 3 个</para>
       </entry>
       <entry>
        <para>N+2，至少 4 个</para>
       </entry>
      </row>
      <row id="b8ihegk">
       <entry>
        <para>奇偶校验</para>
       </entry>
       <entry>
        <para>分布式，单</para>
       </entry>
       <entry>
        <para>分布式，双</para>
       </entry>
      </row>
      <row id="b8ihegl">
       <entry>
        <para>性能</para>
       </entry>
       <entry>
        <para>在写和重构建方面有中度影响</para>
       </entry>
       <entry>
        <para>比 RAID 5 在串行写方面影响大</para>
       </entry>
      </row>
      <row id="b8ihegm">
       <entry>
        <para>容错</para>
       </entry>
       <entry>
        <para>一个组件设备的故障</para>
       </entry>
       <entry>
        <para>两个组件设备的故障</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="raidmdadmr6create">
   <title>创建 RAID 6</title>
   <para>本节中的过程使用四个设备创建 RAID 6 设备 <filename>/dev/md0</filename>：<filename>/dev/sda1</filename>、<filename>/dev/sdb1</filename>、<filename>/dev/sdc1</filename> 和 <filename>/dev/sdd1</filename>。确保修改该过程以使用实际设备节点。</para>
   <procedure id="b8ihegn">
    <step id="b8ihego" performance="required">
     <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="b8ihegp" performance="required">
     <para>创建 RAID 6 设备。在命令提示符处输入 </para>

<screen>
mdadm --create /dev/md0 --run --level=raid6 --chunk=128 --raid-devices=4 /dev/sdb1 /dev/sdc1 /dev/sdc1 /dev/sdd1
</screen>

     <para>默认大块大小为 64 KB。</para>
    </step>
    <step id="b8ihegq" performance="required">
     <para>在 RAID 6 设备 <filename>/dev/md0</filename> 上创建一个文件系统，例如 Reiser 文件系统 (reiserfs)。例如，在命令提示符处输入</para>

<screen>
mkfs.reiserfs /dev/md0
</screen>

     <para>如果要使用其他文件系统，请修改该命令。</para>
    </step>
    <step id="b8ihegr" performance="required">
     <para>编辑 <filename>/etc/mdadm.conf</filename> 文件以添加组件设备和 RAID 设备 <filename>/dev/md0</filename> 的项。</para>
    </step>
    <step id="b8ihegs" performance="required">
     <para>编辑 <filename>/etc/fstab</filename> 文件以添加 RAID 6 设备 <filename>/dev/md0</filename> 的项。 </para>
    </step>
    <step id="b8ihegt" performance="required">
     <para>重引导服务器。</para>
     <para>该 RAID 6 设备即装入到 <filename>/local</filename>。</para>
    </step>
    <step id="b8ihegu" performance="required">
     <para>（可选）添加热备用设备以服务于该 RAID 阵列。例如，在命令提示符处输入：</para>

<screen>
mdadm /dev/md0 -a /dev/sde1
</screen>

    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="raidmdadmr10nest">
  <title>使用 mdadm 创建嵌套的 RAID 10 设备</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr10nestovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10nest1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10nest2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="raidmdadmr10nestovw">
   <title>了解嵌套的 RAID 设备</title>
   <para>嵌套的 RAID 设备由使用另一个 RAID 阵列（而不是物理磁盘）作为其基本元素的 RAID 阵列组成。此配置的目标是提高 RAID 的性能和容错能力。 </para>
   <para>Linux 支持 RAID 1（镜像）和 RAID 0（分段）阵列的嵌套。通常，这种组合称为 RAID 10。为了区别嵌套的顺序，本文档使用以下术语：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <formalpara id="b8ghlom">
      <title>RAID 1+0：</title>
      <para>先构建 RAID 1（镜像）阵列，然后组合形成 RAID 0（条带化）阵列。 </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara id="b8gzg7q">
      <title>RAID 0+1：</title>
      <para>先构建 RAID 0（条带化）阵列，然后组合形成 RAID 1（镜像）阵列。 </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <para>下表描述嵌套为 1+0 和 0+1 的 RAID 10 的优点和缺点。假定您使用的储存对象驻留在不同的磁盘上，每个都有专用的 I/O 功能。</para>
   <table id="b57a7uv" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>嵌套的 RAID 级别</title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="1191*"/>
    <colspec colnum="2" colname="2" colwidth="1905*"/>
    <colspec colnum="3" colname="3" colwidth="6906*"/>
     <thead>
      <row id="b57a7uw">
       <entry>
        <para>RAID 级别</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
       <entry>
        <para>性能和容错</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b57a7uz">
       <entry>
        <para>10 (1+0)</para>
       </entry>
       <entry>
        <para>使用 RAID 1（镜像）阵列构建的 RAID 0（条带化）</para>
       </entry>
       <entry>
        <para>RAID 1+0 提供高级别的 I/O 性能、数据冗余、和磁盘容错。因为 RAID 0 中的每个成员设备都分别镜像，因此可以容忍多个磁盘故障，并且只要失败的磁盘在不同的镜像中，数据仍然可用。 </para>
        <para>您可以选择为每个底层的镜像阵列配置一个备用设备，或配置一个备用设备充当服务于所有镜像的备用组。 </para>
       </entry>
      </row>
      <row id="b57a7uy">
       <entry>
        <para>10 (0+1)</para>
       </entry>
       <entry>
        <para>使用 RAID 0（条带化）阵列构建的 RAID 1（镜像） </para>
       </entry>
       <entry>
        <para>RAID 0+1 提供高级别的 I/O 性能和数据冗余，但比 1+0 的容错稍差。如果在镜像的一端多个磁盘失败，则另一个镜像可用。但是，如果在镜像的两端同时丢失磁盘，则所有数据会丢失。</para>
        <para>这种解决方案比 1+0 解决方案磁盘容错差，但是如果需要在不同的站点执行维护或维护镜像，则可以使镜像的整个一端脱机，并仍可以有完全正常的储存设备。同时，如果丢失两个站点之间的连接，每个站点会彼此独立地运行。如果条带化镜像分段，则不是这种情况，因为这些镜像在较低级别进行管理。 </para>
        <para>如果一个设备失败，该端的镜像则会失败，因为 RAID 1 不容错。创建新的 RAID 0 以替换失败的一端，然后重新同步这两个镜像。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="raidmdadmr10nest1">
   <title>使用 mdadm 创建嵌套的 RAID 10 (1+0)</title>
   <para>嵌套的 RAID 1+0 的构建方法是，创建两个或更多 RAID 1（镜像），然后使用它们作为 RAID 0 中的组件设备。</para>
   <important>
    <para>如果需要管理到这些设备的多个连接，则在配置这些 RAID 设备之前，必须配置多路径 I/O。有关信息，请参见<xref linkend="multipathing" xrefstyle="ChapTitleOnPage"/>。</para>
   </important>
   <para>本节中的过程使用下表中显示的设备名。确保使用您自己的设备名称修改这些设备名称。</para>
   <table id="b6670cx" role="1" frame="topbot" rowsep="0" pgwide="0" width="100%">
    <title>通过嵌套创建 RAID 10 (1+0) 的情形 </title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row id="b6670cy">
       <entry>
        <para>原始设备</para>
       </entry>
       <entry>
        <para>RAID 1（镜像）</para>
       </entry>
       <entry>
        <para>RAID 1+0（条带化镜像）</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8o7og9">
       <entry>
        <simplelist>
         <member><filename>/dev/sdb1</filename></member> <member><filename>/dev/sdc1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry morerows="1">
        <para/>
        <para><filename>/dev/md2</filename></para>
       </entry>
      </row>
      <row id="b8o7ogb">
       <entry>
        <simplelist>
         <member><filename>/dev/sdd1</filename></member> <member><filename>/dev/sde1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure id="b6670d3">
    <step id="b6670d4" performance="required">
     <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="b6670d5" performance="required">
     <para>创建 2 个软件 RAID 1 设备，为每个 RAID 1 设备使用两个不同的设备。在命令提示符处，输入以下两个命令：</para>

<screen>
mdadm --create /dev/md0 --run --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1
</screen>


<screen>
mdadm --create /dev/md1 --run --level=1 --raid-devices=2 /dev/sdd1 /dev/sde1
</screen>

    </step>
    <step id="b6670d6" performance="required">
     <para>创建嵌套的 RAID 1+0 设备。在命令提示符处，使用您在<xref linkend="b6670d5" xrefstyle="StepXRef"/>中创建的软件 RAID 1 设备输入以下命令：</para>

<screen>
mdadm --create /dev/md2 --run --level=0 --chunk=64 --raid-devices=2 /dev/md0 /dev/md1
</screen>

     <para>默认大块大小为 64 KB。 </para>
    </step>
    <step id="b6670d7" performance="required">
     <para>在 RAID 1+0 设备 <filename>/dev/md2</filename> 上创建一个文件系统，例如 Reiser 文件系统 (reiserfs)。例如，在命令提示符处输入</para>

<screen>
mkfs.reiserfs /dev/md2
</screen>

     <para>如果要使用其他文件系统，请修改该命令。</para>
    </step>
    <step id="b6670d8" performance="required">
     <para>编辑 <filename>/etc/mdadm.conf</filename> 文件以添加组件设备和 RAID 设备 <filename>/dev/md2</filename> 的项。</para>
    </step>
    <step id="b6670d9" performance="required">
     <para>编辑 <filename>/etc/fstab</filename> 文件以添加 RAID 1+0 设备 <filename>/dev/md2</filename> 的项。 </para>
    </step>
    <step id="b6670da" performance="required">
     <para>重引导服务器。</para>
     <para>该 RAID 1+0 设备即装入到 <filename>/local</filename>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="raidmdadmr10nest2">
   <title>使用 mdadm 创建嵌套的 RAID 10 (0+1)</title>
   <para>嵌套的 RAID 0+1 的构建方法是，创建两个到四个 RAID 0（分段）设备，然后将它们镜像为 RAID 1 中的组件设备。 </para>
   <important>
    <para>如果需要管理到这些设备的多个连接，则在配置这些 RAID 设备之前，必须配置多路径 I/O。有关信息，请参见<xref linkend="multipathing" xrefstyle="ChapTitleOnPage"/>。</para>
   </important>
   <para>在此配置中，不能为底层的 RAID 0 设备指定备用设备，因为 RAID 0 不能容忍设备丢失。如果在镜像的一端一个设备失败，则必须创建一个替换 RAID 0 设备，然后将其添加到镜像。 </para>
   <para>本节中的过程使用下表中显示的设备名。确保使用您自己的设备名称修改这些设备名称。</para>
   <table id="b8gzg7s" role="1" frame="topbot" rowsep="0" pgwide="0" width="100%">
    <title>通过嵌套创建 RAID 10 (0+1) 的情形 </title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row id="b8gzg7t">
       <entry>
        <para>原始设备</para>
       </entry>
       <entry>
        <para>RAID 0（条带化）</para>
       </entry>
       <entry>
        <para>RAID 0+1（镜像条带化）</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bi71dhe">
       <entry>
        <simplelist>
         <member><filename>/dev/sdb1</filename></member> <member><filename>/dev/sdc1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry morerows="1">
        <para/>
        <para><filename>/dev/md2</filename></para>
       </entry>
      </row>
      <row id="bi71dhf">
       <entry>
        <simplelist>
         <member><filename>/dev/sdd1</filename></member> <member><filename>/dev/sde1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure id="b8gzg7y">
    <step id="b8gzg7z" performance="required">
     <para>打开终端控制台并作为 root 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="b8gzg80" performance="required">
     <para>创建两个软件 RAID 0 设备，为每个 RAID 0 设备使用两个不同的设备。在命令提示符处，输入以下两个命令：</para>

<screen>
mdadm --create /dev/md0 --run --level=0 --chunk=64 --raid-devices=2 /dev/sdb1 /dev/sdc1
</screen>


<screen>
mdadm --create /dev/md1 --run --level=0 --chunk=64 --raid-devices=2 /dev/sdd1 /dev/sde1
</screen>

     <para>默认大块大小为 64 KB。</para>
    </step>
    <step id="b8gzg81" performance="required">
     <para>创建嵌套的 RAID 0+1 设备。在命令提示符处，使用您在<xref linkend="b8gzg80" xrefstyle="StepXRef"/>中创建的软件 RAID 0 设备输入以下命令：</para>

<screen>
mdadm --create /dev/md2 --run --level=1 --raid-devices=2 /dev/md0 /dev/md1
</screen>

    </step>
    <step id="b8gzg82" performance="required">
     <para>在 RAID 0+1 设备 <filename>/dev/md2</filename> 上创建一个文件系统，例如 Reiser 文件系统 (reiserfs)。例如，在命令提示符处输入</para>

<screen>
mkfs.reiserfs /dev/md2
</screen>

     <para>如果要使用其他文件系统，请修改该命令。</para>
    </step>
    <step id="b8gzg83" performance="required">
     <para>编辑 <filename>/etc/mdadm.conf</filename> 文件以添加组件设备和 RAID 设备 <filename>/dev/md2</filename> 的项。</para>
    </step>
    <step id="b8gzg84" performance="required">
     <para>编辑 <filename>/etc/fstab</filename> 文件以添加 RAID 0+1 设备 <filename>/dev/md2</filename> 的项。 </para>
    </step>
    <step id="b8gzg85" performance="required">
     <para>重引导服务器。</para>
     <para>该 RAID 0+1 设备即装入到 <filename>/local</filename>。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="raidmdadmr10cpx">
  <title>创建复杂 RAID 10</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10cpxcreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="raidmdadmr10cpxovw">
   <title>了解复杂 RAID10</title>
   <para>在 <command>mdadm</command> 中，RAID 10 级别创建了一个复杂软件 RAID，将 RAID 0（分段）和 RAID 1（镜像）的功能组合在一起。所有数据块的多个副本遵循一个分段准则在多个驱动器上排列。组件设备应大小相同。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b8ghyxy" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cym9j" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cym15" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cyneb" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cynnk" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="byz81ho" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b8ghyxy">
    <title>比较复杂 RAID10 和嵌套 RAID 10 (1+0)</title>
    <para role="intro">复杂 RAID 10 与嵌套 RAID 10 (1+0) 的目的类似，但在以下方面不同：</para>
    <table id="b8ghz5p" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
     <title>复杂 RAID 10 与嵌套 RAID 10</title>
     <tgroup cols="3">
     <colspec colnum="1" colname="1" colwidth="3334*"/>
     <colspec colnum="2" colname="2" colwidth="3334*"/>
     <colspec colnum="3" colname="3" colwidth="3334*"/>
      <thead>
       <row id="b8gzgca">
        <entry>
         <para>功能</para>
        </entry>
        <entry>
         <para>复杂 RAID10</para>
        </entry>
        <entry>
         <para>嵌套 RAID 10 (1+0)</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="b8gzgcb">
        <entry>
         <para>设备数</para>
        </entry>
        <entry>
         <para>允许组件设备数为奇数或偶数</para>
        </entry>
        <entry>
         <para>要求组件设备数为偶数</para>
        </entry>
       </row>
       <row id="b8gzgcc">
        <entry>
         <para>组件设备</para>
        </entry>
        <entry>
         <para>作为单个 RAID 设备管理</para>
        </entry>
        <entry>
         <para>作为嵌套 RAID 设备管理 </para>
        </entry>
       </row>
       <row id="b8gzgcd">
        <entry>
         <para>分段</para>
        </entry>
        <entry>
         <para>在组件设备的近布局或远布局中发生分段。 </para>
         <para>远布局提供根据驱动器数（而不是 RAID 1 对数）缩放的串行读吞吐量。</para>
        </entry>
        <entry>
         <para>在组件设备之间连续发生分段</para>
        </entry>
       </row>
       <row id="b8gzgce">
        <entry>
         <para>数据的多个副本</para>
        </entry>
        <entry>
         <para>两个或更多副本，最多为阵列中的设备数</para>
        </entry>
        <entry>
         <para>每个镜像段上的副本</para>
        </entry>
       </row>
       <row id="b8gzgcf">
        <entry>
         <para>热备用设备</para>
        </entry>
        <entry>
         <para>单个备用设备可以服务于所有组件设备</para>
        </entry>
        <entry>
         <para>为每个底层的镜像阵列配置一个备用设备，或配置一个备用设备充当服务于所有镜像的备用组。 </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </sect3>
   <sect3 id="b7cym9j">
    <title>复杂 RAID10 中的复本数</title>
    <para>当配置复杂 RAID10 阵列时，必须指定需要的每个数据块复本数。默认复本数是 2，但该值可以是 2 到阵列中的设备数之间的任何数字。 </para>
   </sect3>
   <sect3 id="b7cym15">
    <title>复杂 RAID10 中的设备数</title>
    <para>必须至少使用指定的复本数的组件设备。但是，RAID10 阵列中的组件设备数不需要是每个数据块的复本数的倍数。有效储存大小是设备数除以复本数。</para>
    <para>例如，如果为使用 5 个组件设备创建的阵列指定 2 个复本，则每个块的副本储存在两个不同的设备上。所有数据的一个副本的有效储存大小是 5/2 或 2.5 乘以组件设备的大小。</para>
   </sect3>
   <sect3 id="b7cyneb">
    <title>近布局</title>
    <para>使用近布局，数据块的副本会在不同的组件设备上彼此邻近地条带化。即，一个数据块的多个副本在不同设备中的偏移类似。近布局是 RAID10 的默认布局。例如，如果使用奇数个组件设备以及数据的两个副本，则一些副本可能在设备的一个大块中。 </para>
    <para><command>mdadm</command> RAID10 的近布局在半数的驱动器中产生类似于 RAID 0 的读写性能。 </para>
    <para role="intro">具有偶数个磁盘和两个复本的近布局：</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    0    1    1
  2    2    3    3
  4    4    5    5
  6    6    7    7
  8    8    9    9
</screen>

    <para>具有奇数个磁盘和两个复本的近布局：</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    0    1    1    2
  2    3    3    4    4
  5    5    6    6    7
  7    8    8    9    9
  10   10   11   11   12
</screen>

   </sect3>
   <sect3 id="b7cynnk">
    <title>远布局</title>
    <para>远布局在所有驱动器的前面部分条带化数据，然后在所有驱动器的后面部分条带化数据的另一份副本，以确保块的所有副本在不同的驱动器上。第二个值集合在组件驱动器的中间开始。</para>
    <para>使用远布局，<command>mdadm</command> RAID10 的读性能类似于在所有驱动器上的 RAID 0，但写性能比 RAID 0 要慢得多，因为需要更多地搜寻驱动器头。适用于读密集性操作，例如只读文件服务器。 </para>
    <para>raid10 的写入速度类似于其他镜像 RAID 类型，如使用近布局的 raid1 和 raid10，因为文件系统的电梯式操作会以最佳方式而不是原始写入方式调度写入。在适用于镜像写入应用程序的远布局中使用 raid10。</para>
    <para role="intro">具有偶数个磁盘和两个复本的远布局：</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    1    2    3
  4    5    6    7       
  . . .
  3    0    1    2
  7    4    5    6
</screen>

    <para role="intro">具有奇数个磁盘和两个复本的远布局：</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  5    6    7    8    9
  . . .
  4    0    1    2    3
  9    5    6    7    8
</screen>

   </sect3>
   <sect3 id="byz81ho">
    <title>偏移布局</title>
    <para>偏移布局会复制分段，从而使指定大块的多个副本在连续的驱动器上以连续偏移进行布局。事实上，会复制每个分段且副本会按每个设备进行偏移。如果使用适当较大的大块大小且不超过写入的寻道大小，则此方式会赋予远布局类似的读特征。 </para>
    <para role="intro">具有偶数个磁盘和两个复本的偏移布局：</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    1    2    3
  3    0    1    2       
  4    5    6    7
  7    4    5    6
  8    9   10   11
 11    8    9   10
</screen>

    <para role="intro">具有奇数个磁盘和两个复本的偏移布局：</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  4    0    1    2    3
  5    6    7    8    9
  9    5    6    7    8
 10   11   12   13   14
 14   10   11   12   13                
</screen>

   </sect3>
  </sect2>
  <sect2 id="raidmdadmr10cpxcreate">
   <title>使用 mdadm 创建复杂 RAID 10</title>
   <para><command>mdadm</command> 的 RAID10 选项可创建不包含嵌套的 RAID 10。有关 RAID10 的信息，请参见<xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/>。</para>
   <para>本节中的过程使用下表中显示的设备名。确保使用您自己的设备名称修改这些设备名称。</para>
   <table id="b667706" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>使用 mdadm RAID10 选项创建 RAID 10 的情形 </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b667707">
       <entry>
        <para>原始设备</para>
       </entry>
       <entry>
        <para>RAID10（近或远分段模式）</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b667708">
       <entry>
        <para><filename>/dev/sdf1</filename></para>
        <para><filename>/dev/sdg1</filename></para>
        <para><filename>/dev/sdh1</filename></para>
        <para><filename>/dev/sdi1</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/md3</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure id="b66770c">
    <step id="b667c10" performance="required">
     <para>使用 YaST 在要在 RAID 中使用的设备上创建 0xFD Linux RAID 分区，如 <filename>/dev/sdf1</filename>、<filename>/dev/sdg1</filename>、<filename>/dev/sdh1</filename> 和 <filename>/dev/sdi1</filename>。</para>
    </step>
    <step id="b66770d" performance="required">
     <para>打开终端控制台并作为 root 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="b66770e" performance="required">
     <para>创建 RAID 10 命令。在命令提示符处，输入（都在同一行中）：</para>

<screen>
mdadm --create /dev/md3 --run --level=10 --chunk=4 --raid-devices=4 /dev/sdf1 /dev/sdg1 /dev/sdh1 /dev/sdi1
</screen>

    </step>
    <step id="b66770g" performance="required">
     <para>在 RAID 10 设备 <filename>/dev/md3</filename> 上创建 Reiser 文件系统。在命令提示符处输入</para>

<screen>
mkfs.reiserfs /dev/md3
</screen>

    </step>
    <step id="b66770h" performance="required">
     <para>编辑 <filename>/etc/mdadm.conf</filename> 文件以添加组件设备和 RAID 设备 <filename>/dev/md3</filename> 的项。例如：</para>

<screen>
DEVICE /dev/md3
</screen>

    </step>
    <step id="b66770i" performance="required">
     <para>编辑 <filename>/etc/fstab</filename> 文件以添加 RAID 10 设备 <filename>/dev/md3</filename> 的项。 </para>
    </step>
    <step id="b66770j" performance="required">
     <para>重引导服务器。</para>
     <para>该 RAID10 设备即装入到 <filename>/raid10</filename>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b14drcbo">
   <title>使用 YaST 分区程序创建复杂 RAID10</title>
   <procedure id="b14dtk6s">
    <step id="b14dtk6t" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份启动 YaST，然后打开该分区程序。</para>
    </step>
    <step id="b14dtk6u" performance="required">
     <para>选择<guimenu>硬盘</guimenu>，以查看可用的磁盘，例如 sdab、sdc、sdd 和 sde。</para>
    </step>
    <step id="b14dtk6v" performance="required">
     <para>为要在软件 RAID 中使用的每个磁盘，在设备上创建一个 RAID 分区。每个分区应大小相同。对于 RAID 10 设备，您需要 </para>
     <substeps performance="required">
      <step id="b14dtk6w" performance="required">
       <para>在<guimenu>硬盘</guimenu>下，选择设备，然后在右侧的面板中选择<guimenu>分区</guimenu>选项卡。</para>
      </step>
      <step id="b14dtk6x" performance="required">
       <para>单击<guimenu>添加</guimenu>打开<guimenu>添加分区</guimenu>向导。</para>
      </step>
      <step id="b14dtk6y" performance="required">
       <para>在<guimenu>新分区类型</guimenu>下，选择<guimenu>主分区</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b14dtk6z" performance="required">
       <para>对于<guimenu>新分区大小</guimenu>，指定此磁盘上所需的 RAID 分区大小，然后单击<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b14dtk70" performance="required">
       <para>在<guimenu>格式化选项</guimenu>下，选择<guimenu>不格式化分区</guimenu>，然后从<guimenu>文件系统 ID</guimenu> 下拉列表中选择 <guimenu>0xFD Linux RAID</guimenu>。</para>
      </step>
      <step id="b14dtk71" performance="required">
       <para>在<guimenu>装入选项</guimenu>下，选择<guimenu>不装入分区</guimenu>，然后单击<guimenu>完成</guimenu>。</para>
      </step>
      <step id="b14dtk72" performance="required">
       <para>重复这些步骤，直到在 RAID 10 设备中要使用的磁盘上定义好 RAID 分区。</para>
      </step>
     </substeps>
    </step>
    <step id="b14dtk73" performance="required">
     <para>创建 RAID 10 设备：</para>
     <substeps performance="required">
      <step id="b14dtk74" performance="required">
       <para>选择 <guimenu>RAID</guimenu>，然后在右侧的面板中选择<guimenu>添加 RAID</guimenu>，以打开<guimenu>添加 RAID</guimenu> 向导。</para>
      </step>
      <step id="b14dtk75" performance="required">
       <para>在 <guimenu>RAID 类型</guimenu>下，选择 <guimenu>RAID 10（镜像和分段）</guimenu>。</para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="raid10_a.png" width="302pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b14dtk76" performance="required">
       <para>在<guimenu>可用设备</guimenu>列表中选择所需的 Linux RAID 分区，然后单击<guimenu>添加</guimenu>，将其移到<guimenu>所选设备</guimenu>列表中。</para>
      </step>
      <step id="b14dtk77" performance="required">
       <para>（可选）单击<guimenu>分类</guimenu>，指定磁盘在 RAID 阵列中的首选顺序。</para>
       <para>对于添加磁盘的顺序事关重要的 RAID 类型，您可以指定设备的使用顺序，以确保阵列的一半驻留在一个磁盘子系统中，而另一半驻留在另一个磁盘子系统中。例如，如果一个磁盘子系统出现故障，则系统仍可以通过第二个磁盘子系统继续运行。</para>
       <substeps performance="required">
        <step id="b14dutul" performance="required">
         <para>依次选择每个磁盘，并单击其中一个 <guimenu>X 类</guimenu>按钮，其中 X 表示要指派给磁盘的字母。可用的类有 A、B、C、D 和 E，但在很多情况下只需要较少的类（例如仅需要 A 和 B）。以此方式指派所有可用的 RAID 磁盘。 </para>
         <para>您可以按下 Ctrl 或 Shift 键选择多个设备。也可以右键单击所选设备并从环境菜单中选择合适的类。</para>
        </step>
        <step id="b14dutum" performance="required">
         <para>选择以下其中一个排序选项指定设备的顺序：</para>
         <formalpara id="b14dutun">
          <title>排序：</title>
          <para>将所有 A 类设备排序在所有 B 类设备之前，并以此类推。例如：<literal>AABBCC</literal>。</para>
         </formalpara>
         <formalpara id="b14dutuo">
          <title>交错：</title>
          <para>按照先是 A 类的第一个设备，然后是 B 类的第一个设备，以此类推直到排完所有指派了后面类的设备。再然后是 A 类的第二个设备，B 类的第二个设备，以此类推。没有类的所有设备将排在设备列表的末尾。例如 <literal>ABCABC</literal>。</para>
         </formalpara>
         <formalpara id="b14dutup">
          <title>模式文件：</title>
          <para>选择一个包含多行的现有文件，其中的每一行都是一个正则表达式以及一个类名称 (<literal>"sda.* A"</literal>)。所有与该正则表达式匹配的设备都将被指派给该行指定的类。正则表达式会依次与内核名称 (<filename>/dev/sda1</filename>)、udev 路径名称 (<filename>/dev/disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0-part1</filename>) 以及 udev ID (/dev/disk/by-id/ata-ST3500418AS_9VMN8X8L-part1) 进行比对。如果设备名称与多个正则表达式匹配，则会使用首个匹配项来决定类。</para>
         </formalpara>
        </step>
        <step id="b14dutuq" performance="required">
         <para>在对话框的底部，单击<guimenu>确定</guimenu>，以确认顺序。</para>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject>
           <imagedata fileref="raid10_classify_a.png" width="292pt" format="png"/></imageobject>
          </mediaobject>
         </informalfigure>
        </step>
       </substeps>
      </step>
      <step id="b14dttix" performance="required">
       <para>单击<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b14dttiy" performance="required">
       <para>在 <guimenu>RAID 选项</guimenu>下，指定<guimenu>大块大小</guimenu>以及<guimenu>奇偶校验算法</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
       <para>对于 RAID 10，奇偶校验选项包括 n（近）、f（远）和 o（偏移）。数字表示所需的每个数据块的复本数。默认值为 2。有关信息，请参阅<xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/>。</para>
      </step>
      <step id="b14dttiz" performance="required">
       <para>将文件系统和装入选项添加至 RAID 设备，然后单击<guimenu>完成</guimenu>。</para>
      </step>
     </substeps>
    </step>
    <step id="b14dttj0" performance="required">
     <para role="intro">选择 <guimenu>RAID</guimenu>，再选择新建的 RAID 设备，然后单击<guimenu>已用设备</guimenu>，以查看其分区。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="raid10_useddevs_a.png" width="302pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b14dtw8j" performance="required">
     <para>单击<guimenu>下一步</guimenu>。</para>
    </step>
    <step id="b14dtw8k" performance="required">
     <para>确认要进行的更改，然后单击<guimenu>完成</guimenu>以创建 RAID。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="raidmdadmdegraded">
  <title>创建降级 RAID 阵列</title>
  <para role="intro">降级阵列是缺少某些设备的阵列。仅对 RAID 1、RAID 4、RAID 5 和 RAID 6 支持降级阵列。这些 RAID 类型被设计为作为容错功能的一部分，容忍缺少一些设备。通常，当一个设备失败时，会发生降级阵列。可以故意创建一个降级阵列。 </para>
  <informaltable role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="3334*"/>
   <colspec colnum="2" colname="2" colwidth="3334*"/>
   <colspec colnum="3" colname="3" colwidth="3334*"/>
    <thead>
     <row id="b8gzm1p">
      <entry>
       <para>RAID 类型</para>
      </entry>
      <entry>
       <para>允许缺少的槽数</para>
      </entry>
      <entry/>
     </row>
    </thead>
    <tbody>
     <row id="b8gzm1q">
      <entry>
       <para>RAID 1</para>
      </entry>
      <entry>
       <para>除一个设备外的所有设备</para>
      </entry>
      <entry/>
     </row>
     <row id="b8gzm1r">
      <entry>
       <para>RAID 4</para>
      </entry>
      <entry>
       <para>一个槽</para>
      </entry>
      <entry/>
     </row>
     <row id="b8h0rww">
      <entry>
       <para>RAID 5</para>
      </entry>
      <entry>
       <para>一个槽</para>
      </entry>
      <entry/>
     </row>
     <row id="b8gzm1s">
      <entry>
       <para>RAID 6</para>
      </entry>
      <entry>
       <para>一个或两个槽</para>
      </entry>
      <entry/>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>要创建缺少某些设备的降级阵列，只需使用单词 <literal>missing</literal> 替换设备名即可。这会导致 <command>mdadm</command> 将阵列中的相应槽保留为空。 </para>
  <para>当创建 RAID 5 阵列时，<command>mdadm</command> 会自动使用额外的备用驱动器创建降级阵列。这是因为将备用设备构建为降级阵列通常比在非降级但不清洁的阵列上重新同步奇偶校验要更快。您可以使用 <literal>--force</literal> 选项覆盖该功能。</para>
  <para>在要创建 RAID，但要使用的一个设备上已经有数据时，创建降级阵列非常有用。在这种情况下，使用其他设备创建一个降级阵列，将使用中的设备上的数据复制到以降级模式运行的 RAID 上，将该设备添加到 RAID 中，然后等待 RAID 重构建以便该数据分散在所有设备中。以下过程是如此处理的一个示例：</para>
  <procedure id="b8h2aqj">
   <step id="b8h2aqk" performance="required">
    <para>使用一个驱动器 <filename>/dev/sd1</filename> 创建一个降级 RAID 1 设备 <filename>/dev/md0</filename>，在命令提示符处输入以下命令：</para>

<screen>
mdadm --create /dev/md0 -l 1 -n 2 /dev/sda1 missing
</screen>

    <para>该设备的大小应等于或大于计划添加到该设备的设备。</para>
   </step>
   <step id="b8h2atq" performance="required">
    <para>如果要添加到镜像的设备包含要移到 RAID 阵列中的数据，现在将其复制到处于降级模式的 RAID 阵列中。</para>
   </step>
   <step id="b8h2avw" performance="required">
    <para>向镜像中添加设备。例如，要向 RAID 中添加 <filename>/dev/sdb1</filename>，在命令提示符处输入以下命令：</para>

<screen>
mdadm /dev/md0 -a /dev/sdb1
</screen>

    <para>您一次只能添加一个设备。必须等到内核构建镜像并将其完全联机，才能添加另一个镜像。 </para>
   </step>
   <step id="b8h2ayp" performance="required">
    <para>在命令提示符处输入以下命令，监视构建过程：</para>

<screen>
cat /proc/mdstat
</screen>

    <para>要在每秒刷新重建进度时查看此进度，请输入</para>

<screen>
watch -n 1 cat /proc/mdstat 
</screen>

   </step>
  </procedure>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,,80" id="raidresize" lang="en" revision="02/22/07" xml:base="05_raid_resize.xml">
 <title>使用 mdadm 调整软件 RAID 阵列的大小</title>
 <para>本章描述如何使用多设备管理 (<command>mdadm(8)</command>) 工具增加或减小软件 RAID 1、4、5 或 6 设备的大小。 </para>
 <warning>
  <para>开始本节中描述的任何任务之前，请确保已有效备份所有数据。 </para>
 </warning>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="resizeincr" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="resizedecr" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="resizeunderstand">
  <title>了解调整大小过程</title>
  <para>调整现有软件 RAID 设备的大小涉及增加或降低每个组件分区提供的空间。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b8ppjxz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b8pr3ol" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b8ppjxz">
   <title>调整软件 RAID 大小的准则 </title>
   <para><command>mdadm(8)</command> 工具仅支持调整软件 RAID 级别 1、4、5 和 6 的大小。这些 RAID 级别提供磁盘容错，这样在调整大小时，可以一次卸下一个组件分区。基本上来说，可以对 RAID 分区执行热调整大小，但是这样做时，必须额外注意您的数据。 </para>
   <para>在 RAID 上驻留的文件系统也必须能够调整大小，以充分利用设备上可用空间的更改。在 SUSE Linux Enterprise Server 11 中，具有用于文件系统 Ext2、Ext3 和 ReiserFS 的文件系统调整大小实用程序。这些实用程序支持如下增加和减小大小：</para>
   <table id="biuzuno" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>文件系统对调整大小的支持</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="2500*"/>
    <colspec colnum="3" colname="3" colwidth="2500*"/>
    <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row id="biuzunp">
       <entry>
        <para>文件系统</para>
       </entry>
       <entry>
        <para>实用程序</para>
       </entry>
       <entry>
        <para>增大大小</para>
       </entry>
       <entry>
        <para>减小大小</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="biuzunq">
       <entry>
        <para>Ext2 或 Ext3</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>是，仅脱机</para>
       </entry>
       <entry>
        <para>是，仅脱机</para>
       </entry>
      </row>
      <row id="biuzunr">
       <entry>
        <para>ReiserFS</para>
       </entry>
       <entry>
        <para>resize_reiserfs</para>
       </entry>
       <entry>
        <para>是，联机或脱机</para>
       </entry>
       <entry>
        <para>是，仅脱机</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>调整任何分区或文件系统的大小涉及可能会导致数据丢失的风险。 </para>
   <warning>
    <para>为了避免数据丢失，请确保在开始任何调整大小任务之前备份您的数据。</para>
   </warning>
  </sect2>
  <sect2 id="b8pr3ol">
   <title>任务概述</title>
   <para>调整 RAID 大小涉及以下任务。这些任务执行的顺序取决于您是要增加还是减小其大小。 </para>
   <table id="b8ppko3" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>调整 RAID 大小中涉及的任务</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
    <colspec colnum="3" colname="3" colwidth="1250*"/>
    <colspec colnum="4" colname="4" colwidth="1250*"/>
     <thead>
      <row id="b8pps5o">
       <entry>
        <para>任务</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
       <entry>
        <para>增加大小的顺序</para>
       </entry>
       <entry>
        <para>减小大小的顺序</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8pps5p">
       <entry>
        <para>调整每个组件分区的大小。</para>
        <para/>
       </entry>
       <entry>
        <para>增加或减小每个组件分区的活动大小。一次仅可删除一个组件分区，修改其大小，然后将其返回到 RAID。</para>
       </entry>
       <entry>
        <para>1</para>
       </entry>
       <entry>
        <para>2</para>
       </entry>
      </row>
      <row id="b8pps5q">
       <entry>
        <para>调整软件 RAID 本身的大小。</para>
       </entry>
       <entry>
        <para>RAID 不会自动知道您对底层组件分区大小进行的增加或减小操作。您必须向其告知新的大小。</para>
       </entry>
       <entry>
        <para>2</para>
       </entry>
       <entry>
        <para>3</para>
       </entry>
      </row>
      <row id="b8pps5r">
       <entry>
        <para>调整文件系统的大小。</para>
       </entry>
       <entry>
        <para>必须调整驻留在 RAID 上的文件系统的大小。仅适用于提供调整大小工具的文件系统，例如 Ext2、Ext3、 和 ReiserFS。</para>
       </entry>
       <entry>
        <para>3</para>
       </entry>
       <entry>
        <para>1</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para/>
  </sect2>
 </sect1>
 <sect1 id="resizeincr">
  <title>增加软件 RAID 的大小</title>
  <para>开始之前，请查看<xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/>中的准则。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="resizeincrpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="resizeincrpart">
   <title>增加组件分区的大小</title>
   <para>应用本节中的过程以增加 RAID 1、4、5 或 6 的大小。对于 RAID 中的每个组件分区，从 RAID 中删除该分区，修改其大小，将其返回到 RAID，然后等待 RAID 稳定下来以继续。删除一个分区时，RAID 会以降级模式运行，没有磁盘容错或降低磁盘容错。即使对于可以容忍多个并行磁盘故障的 RAID，也不要一次删除多个组件分区。</para>
   <warning>
    <para>如果 RAID 没有磁盘容错，或只是不一致，则在删除其任何分区的情况下，将会导致数据丢失。删除分区时要非常小心，并确保有可用的数据备份。 </para>
   </warning>
   <para>本节中的过程使用下表中显示的设备名。确保使用您自己的设备名称修改这些名称。</para>
   <table id="b8prrn8" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>增加组件分区的大小的情形 </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b8pry2e">
       <entry>
        <para>RAID 设备</para>
       </entry>
       <entry>
        <para>组件分区</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8pry2f">
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/sda1</filename></para>
        <para><filename>/dev/sdb1</filename></para>
        <para><filename>/dev/sdc1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>增加 RAID 组件分区的大小：</para>
   <procedure id="b8pp3av">
    <step id="b8progi" performance="required">
     <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="b8pp3aw" performance="required">
     <para>通过输入以下命令，确保 RAID 阵列一致并同步 </para>

<screen>
cat /proc/mdstat
</screen>

     <para>如果根据此命令的输出，RAID 阵列仍然正在同步，则必须等到同步完成，才能继续。 </para>
    </step>
    <step id="b8pp3ax" performance="required">
     <para>从 RAID 阵列中删除一个组件分区。例如，要删除 <filename>/dev/sda1</filename>，请输入 </para>

<screen>
mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1
</screen>

     <para>为了成功，必须进行失败和删除操作。 </para>
    </step>
    <step id="b8pp3ay" performance="required">
     <para>执行以下操作之一，增加您在<xref linkend="b8pp3ax" xrefstyle="StepXRef"/>中删除的分区的大小：</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>使用诸如 <command>fdisk(8)</command>、<command>cfdisk(8)</command> 或 <command>parted(8)</command> 的磁盘分区程序增加分区的大小。该选项是通常的选项。</para>
      </listitem>
      <listitem>
       <para>将分区驻留的磁盘替换为高容量设备。 </para>
       <para>仅当系统不访问原始磁盘上的任何其他文件系统时，该选项才可用。当将替换设备添加回 RAID 时，同步数据需要的时间长得多，因为原始设备上的所有数据都必须重构建。</para>
      </listitem>
     </itemizedlist>
    </step>
    <step id="b8pp3az" performance="required">
     <para>将该分区重新添加到 RAID 阵列。例如，要添加 <filename>/dev/sda1</filename>，请输入 </para>

<screen>
mdadm -a /dev/md0 /dev/sda1
</screen>

     <para>等到 RAID 同步并一致，然后再继续下一个分区。</para>
    </step>
    <step id="b8ps27a" performance="required">
     <para>对阵列中的每个剩余组件设备重复<xref linkend="b8pp3aw" xrefstyle="StepXRef"/>到<xref linkend="b8pp3az" xrefstyle="StepXRef"/>。确保按照正确的组件分区修改命令。</para>
    </step>
    <step id="b8ps2tp" performance="required">
     <para>如果得到一个消息，告知您内核不能重读 RAID 的分区表，则必须在调整所有分区大小后重引导计算机，以强制更新分区表。</para>
    </step>
    <step id="b8q915s" performance="required">
     <para>继续<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="resizeincrraid">
   <title>增加 RAID 阵列的大小</title>
   <para>调整 RAID 中的每个组件分区之后（请参见<xref linkend="resizeincrpart" xrefstyle="SectTitleOnPage"/>），RAID 阵列配置将继续使用原始阵列大小，直到您强制其了解新的可用空间。您可以为 RAID 指定大小或使用最大可用空间。 </para>
   <para>本节中的过程对 RAID 设备使用设备名 <filename>/dev/md0</filename>。确保使用您自己的设备名称修改名称。</para>
   <procedure id="b8pp3b0">
    <step id="b8psa0o" performance="required">
     <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="b8pp3b1" performance="required">
     <para>通过输入以下命令，检查阵列了解到的阵列大小和设备大小</para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="b8psbwk" performance="required">
     <para>执行以下操作之一：</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>通过输入以下命令，将阵列大小增加到最大可用大小 </para>

<screen>
mdadm --grow /dev/md0 -z max
</screen>

      </listitem>
     </itemizedlist>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>通过输入以下命令，将阵列大小增加到最大可用大小 </para>

<screen>
mdadm --grow /dev/md0 -z max --assume-clean
</screen>

       <para>阵列会利用添加到设备中的任何空间，但不会同步此空间。建议对 RAID1 执行此操作，因为它不需要同步。如果添加到成员设备中的空间已预先置零，则对其他 RAID 级别可能也有用。</para>
      </listitem>
     </itemizedlist>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>通过输入以下命令，将阵列大小增加到指定值 </para>

<screen>
mdadm --grow /dev/md0 -z <replaceable>size</replaceable>
</screen>

       <para>将<replaceable>大小</replaceable>替换为表示所需大小（KB，每 KB 等于 1024 字节）的整数值。 </para>
      </listitem>
     </itemizedlist>
    </step>
    <step id="b8pp3b3" performance="required">
     <para>通过输入以下命令，重新检查阵列了解到的阵列大小和设备大小 </para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="b8psgk9" performance="required">
     <para>执行以下操作之一： </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>如果已成功调整阵列大小，请继续<xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/>。</para>
      </listitem>
      <listitem>
       <para>如果未能和预期一样调整阵列大小，则请重引导，然后重试该过程。 </para>
      </listitem>
     </itemizedlist>
    </step>
   </procedure>
  </sect2>
  <sect2 id="resizeincrfs">
   <title>增加文件系统的大小</title>
   <para>增加阵列大小之后（请参见<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>），您就准备好调整文件系统大小了。 </para>
   <para>您可以将文件系统的大小增加到最大可用空间或指定精确大小。为文件系统指定精确大小时，请确保新大小满足以下条件：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必须大于现有数据的大小；否则会发生数据丢失。 </para>
    </listitem>
    <listitem>
     <para>新大小必须等于或小于当前 RAID 大小，因为文件系统大小不能超出可用空间。</para>
    </listitem>
   </itemizedlist>
   <sect3 id="b8uks1t">
    <title>Ext2 或 Ext3</title>
    <para>使用 <command>resize2fs</command> 命令装入或卸载 Ext2 和 Ext3 文件系统时，可以调整它们的大小。</para>
    <procedure id="b8uksb5">
     <step id="b8uksb6" performance="required">
      <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
     </step>
     <step id="b8uksjw" performance="required">
      <para>使用以下方法之一增加文件系统的大小：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>要将文件系统大小扩展为名为 <filename>/dev/md0</filename> 的软件 RAID 设备的最大可用大小，请输入</para>

<screen>
resize2fs /dev/md0
</screen>

        <para>如果未指定大小参数，大小将默认为该分区的大小。</para>
       </listitem>
       <listitem>
        <para>要将文件系统扩展为指定大小，请输入 </para>

<screen>
resize2fs /dev/md0 <replaceable>size</replaceable>
</screen>

        <para><replaceable>大小</replaceable>参数指定请求的文件系统新大小。如果不指定任何单位，则大小参数的单位是文件系统的块大小。（可选）大小参数可以加以下指定单位后缀：s 表示 512 字节扇区；K 表示 KB（1KB 是 1024 字节）；M 表示 MB；G 表示 GB。</para>
       </listitem>
      </itemizedlist>
      <para>等到调整大小完成再继续。</para>
     </step>
     <step id="b8ule4k" performance="required">
      <para>如果未装入该文件系统，则现在装入它。 </para>
      <para>例如，要将名为 <filename>/dev/md0</filename> 的 RAID 的 Ext2 文件系统装入到安装点 <filename>/raid</filename>，请输入</para>

<screen>
mount -t ext2 /dev/md0 /raid
</screen>

     </step>
     <step id="b8ul4ag" performance="required">
      <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

      <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="b8ul8fq">
    <title>ReiserFS</title>
    <para>与对 Ext2 和 Ext3 一样，可以在装入或卸载时增加 ReiserFS 文件系统的大小。调整大小将在 RAID 阵列的块设备上完成。</para>
    <procedure id="b8ul8cv">
     <step id="b8ul8cw" performance="required">
      <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
     </step>
     <step id="b8ul8cx" performance="required">
      <para>使用以下方法之一，增加名为 <filename>/dev/md0</filename> 的软件 RAID 设备的文件系统的大小：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>要将文件系统大小扩展为设备的最大可用大小，请输入</para>

<screen>
resize_reiserfs /dev/md0
</screen>

        <para>不指定大小时，这会将卷增加到分区的完整大小。 </para>
       </listitem>
       <listitem>
        <para>要将文件系统扩展为指定大小，请输入</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/md0
</screen>

        <para>将<replaceable>大小</replaceable>替换为所需大小（以字节为单位）。您还可以为值指定单位，例如 50000K (KB)、250M (MB) 或 2G (GB)。或者，可以通过在该值前面加加号 (+) 前缀，指定对当前大小的增加量。例如，以下命令将把 <filename>/dev/md0</filename> 上的文件系统的大小增加 500 MB：</para>

<screen>
resize_reiserfs -s +500M /dev/md0
</screen>

       </listitem>
      </itemizedlist>
      <para>等到调整大小完成再继续。</para>
     </step>
     <step id="b8ulei7" performance="required">
      <para>如果未装入该文件系统，则现在装入它。 </para>
      <para>例如，要将名为 <filename>/dev/md0</filename> 的 RAID 的 ReiserFS 文件系统装入到安装点 <filename>/raid</filename>，请输入</para>

<screen>
mount -t reiserfs /dev/md0 /raid
</screen>

     </step>
     <step id="b8ul8cy" performance="required">
      <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

      <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="resizedecr">
  <title>减小软件 RAID 的大小</title>
  <para>开始之前，请查看<xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/>中的准则。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="resizedecrfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizedecrpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="resizedecrfs">
   <title>减小文件系统的大小</title>
   <para>当减小 RAID 设备上的文件系统的大小时，请确保新的大小满足以下条件：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必须大于现有数据的大小；否则会发生数据丢失。 </para>
    </listitem>
    <listitem>
     <para>新大小必须等于或小于当前 RAID 大小，因为文件系统大小不能超出可用空间。</para>
    </listitem>
   </itemizedlist>
   <para>在 SUSE Linux Enterprise Server 中，Ext2、Ext3 和 ReiserFS 都提供减小文件系统大小的实用程序。使用下面相应的过程减小文件系统的大小。</para>
   <para>本节中的过程对 RAID 设备使用设备名 <filename>/dev/md0</filename>。确保使用您自己的设备名称修改这些命令。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bznzca1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bznzca8" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bznzca1">
    <title>Ext2 或 Ext3</title>
    <para>Ext2 和 Ext3 文件系统可以在装入或卸载时调整大小。 </para>
    <procedure id="bznzca2">
     <step id="bznzca3" performance="required">
      <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
     </step>
     <step id="bznzca4" performance="required">
      <para>通过输入以下命令，减小 RAID 上文件系统的大小</para>

<screen>
resize2fs /dev/md0 &lt;size&gt;
</screen>

      <para>将<replaceable>大小</replaceable>替换为所需大小的整数值（单位为 KB）。（1 KB 是 1024 字节。）</para>
      <para>等到调整大小完成再继续。</para>
     </step>
     <step id="bznzca5" performance="required">
      <para>如果未装入该文件系统，则现在装入它。例如，要将名为 <filename>/dev/md0</filename> 的 RAID 的 Ext2 文件系统装入到安装点 <filename>/raid</filename>，请输入</para>

<screen>
mount -t ext2 /dev/md0 /raid
</screen>

     </step>
     <step id="bznzca6" performance="required">
      <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

      <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
     </step>
     <step id="bznzca7" performance="required">
      <para>继续<xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bznzca8">
    <title>ReiserFS</title>
    <para>仅当在卷卸载后，才可以减小 ReiserFS 文件系统的大小。 </para>
    <procedure id="bznzca9">
     <step id="bznzcaa" performance="required">
      <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
     </step>
     <step id="bznzcab" performance="required">
      <para>通过输入以下命令卸载设备</para>

<screen>
umount /mnt/point
</screen>

      <para>如果您尝试减小大小的分区包含文件系统（例如 root (<filename>/</filename>) 卷），则仅当从可引导 CD 或软盘引导时，才可以卸载。</para>
     </step>
     <step id="bznzcac" performance="required">
      <para>通过输入以下命令，减小名为 <filename>/dev/md0</filename> 的软件 RAID 设备上的文件系统的大小</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/md0
</screen>

      <para>将<replaceable>大小</replaceable>替换为所需大小（以字节为单位）。您还可以为值指定单位，例如 50000K (KB)、250M (MB) 或 2G (GB)。或者，可以通过在该值前面加减号 (-) 前缀，指定对当前大小的减小量。例如，以下命令将 <filename>/dev/md0</filename> 上的文件系统的大小减小 500 MB：</para>

<screen>
resize_reiserfs -s -500M /dev/md0
</screen>

      <para>等到调整大小完成再继续。</para>
     </step>
     <step id="bznzcad" performance="required">
      <para>通过输入以下命令装入文件系统 </para>

<screen>
mount -t reiserfs /dev/md0 /mnt/point
</screen>

     </step>
     <step id="bznzcae" performance="required">
      <para>通过输入以下命令，检查已装入文件系统的调整大小的结果</para>

<screen>
df -h
</screen>

      <para>磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项以用户可读格式打印大小，例如 1K、234M 或 2G。</para>
     </step>
     <step id="bznzcaf" performance="required">
      <para>继续<xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="resizedecrraid">
   <title>减小 RAID 阵列的大小</title>
   <para>在调整完文件系统的大小后，RAID 阵列配置会继续使用原来的阵列大小，直到您强制它减少可用空间。使用 <command>mdadm --grow</command> 模式强制 RAID 使用较小的段大小。为此，您必须使用 -z 选项指定 RAID 中的每个设备上可使用的空间量（单位为 KB）。此大小必须是大块大小的倍数，且必须为将要写入设备的 RAID 超块预留大约 128KB 的空间。 </para>
   <para>本节中的过程对 RAID 设备使用设备名 <filename>/dev/md0</filename>。确保使用您自己的设备名称修改这些命令。</para>
   <procedure id="bznzcau">
    <step id="bznzcav" performance="required">
     <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="bznzcaw" performance="required">
     <para>通过输入以下命令，检查阵列了解到的阵列大小和设备大小</para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="bznzcax" performance="required">
     <para>通过输入以下命令，将阵列的设备大小减小到指定值 </para>

<screen>
mdadm --grow /dev/md0 -z <replaceable>&lt;size</replaceable>&gt;
</screen>

     <para>将<replaceable>大小</replaceable>替换为所需大小的整数值（单位为 KB）。（1 KB 是 1024 字节。） </para>
     <para>例如，以下命令将每个 RAID 设备的段大小设置为大约 40 GB，其中大块大小为 64 KB。还包含为 RAID 超块预留的 128 KB。</para>

<screen>
mdadm --grow /dev/md2 -z 41943168
</screen>

    </step>
    <step id="bznzcay" performance="required">
     <para>通过输入以下命令，重新检查阵列了解到的阵列大小和设备大小 </para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="bznzcaz" performance="required">
     <para>执行以下操作之一： </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>如果已成功调整阵列大小，请继续<xref linkend="resizedecrpart" xrefstyle="SectTitleOnPage"/>。</para>
      </listitem>
      <listitem>
       <para>如果未能和预期一样调整阵列大小，则请重引导，然后重试该过程。 </para>
      </listitem>
     </itemizedlist>
    </step>
   </procedure>
  </sect2>
  <sect2 id="resizedecrpart">
   <title>减小组件分区的大小</title>
   <para>减小 RAID 中每个设备使用的段大小之后，RAID 将不会使用每个组件分区中的剩余空间。您可以让分区保持其当前大小，以为 RAID 将来的增长留出空间，或者也可以回收这些当前未使用的空间。</para>
   <para>要回收空间，请逐个减少组件分区。对于每个组件分区执行以下步骤：从 RAID 中删除它，减小其分区大小，将该分区装回到 RAID，然后等到 RAID 稳定。要允许元数据，则应指定比您在<xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>中为 RAID 指定的大小略大的大小值。</para>
   <para>删除一个分区时，RAID 会以降级模式运行，没有磁盘容错或降低磁盘容错。即使对于可以容忍多个并行磁盘故障的 RAID，也不要一次删除多个组件分区。</para>
   <warning>
    <para>如果 RAID 没有磁盘容错，或只是不一致，则在删除其任何分区的情况下，将会导致数据丢失。删除分区时要非常小心，并确保有可用的数据备份。 </para>
   </warning>
   <para>本节中的过程使用下表中显示的设备名。确保使用您自己的设备名称修改这些命令。</para>
   <table id="bznzcah" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>增加组件分区的大小的情形 </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="bznzcai">
       <entry>
        <para>RAID 设备</para>
       </entry>
       <entry>
        <para>组件分区</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bznzcaj">
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/sda1</filename></para>
        <para><filename>/dev/sdb1</filename></para>
        <para><filename>/dev/sdc1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>减小 RAID 的组件分区的大小：</para>
   <procedure id="bznzcak">
    <step id="bznzcal" performance="required">
     <para>打开终端控制台并作为 <systemitem>root</systemitem> 用户或具有相同权限的用户登录。</para>
    </step>
    <step id="bznzcam" performance="required">
     <para>通过输入以下命令，确保 RAID 阵列一致并同步 </para>

<screen>
cat /proc/mdstat
</screen>

     <para>如果根据此命令的输出，RAID 阵列仍然正在同步，则必须等到同步完成，才能继续。 </para>
    </step>
    <step id="bznzcan" performance="required">
     <para>从 RAID 阵列中删除一个组件分区。例如，要删除 <filename>/dev/sda1</filename>，请输入 </para>

<screen>
mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1
</screen>

     <para>为了成功，必须进行失败和删除操作。 </para>
    </step>
    <step id="bznzcao" performance="required">
     <para>减小您在<xref linkend="b8pp3ax" xrefstyle="StepXRef"/>中删除的分区的大小，让其值略大于您为段大小设置的大小。该大小应是大块大小的倍数，并为 RAID 超块预留 128 KB 的空间。使用诸如 <command>fdisk</command>、<command>cfdisk</command> 或 <command>parted</command> 的磁盘分区程序减少分区的大小。</para>
    </step>
    <step id="bznzcap" performance="required">
     <para>将该分区重新添加到 RAID 阵列。例如，要添加 <filename>/dev/sda1</filename>，请输入 </para>

<screen>
mdadm -a /dev/md0 /dev/sda1
</screen>

     <para>等到 RAID 同步并一致，然后再继续下一个分区。</para>
    </step>
    <step id="bznzcaq" performance="required">
     <para>对阵列中的每个剩余组件设备重复<xref linkend="b8pp3aw" xrefstyle="StepXRef"/>到<xref linkend="b8pp3az" xrefstyle="StepXRef"/>。确保按照正确的组件分区修改命令。</para>
    </step>
    <step id="bznzcar" performance="required">
     <para>如果得到一个消息，告知您内核无法重读 RAID 的分区表，则您必须在重新调整其所有组件分区大小后重引导计算机。</para>
    </step>
    <step id="bzo0b0b" performance="required">
     <para>（可选）扩展 RAID 和文件系统的大小，以使用当前较小组件分区中的最大空间：</para>
     <substeps performance="required">
      <step id="bznzcas" performance="required">
       <para>扩展 RAID 的大小，以使用在减小的组件分区中当前可用的最大空间：</para>

<screen>
mdadm --grow /dev/md0 -z max
</screen>

      </step>
      <step id="bzo00hx" performance="required">
       <para>扩展文件系统的大小，以使用刚调整过大小的 RAID 中的所有可用空间。有关信息，请参阅<xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/>。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>
 </sect1>
</chapter>

<chapter id="cha_raids_lee" lang="en" xml:base="05_raid_led.xml">
 <title>适用于 MD 软件 RAID 的储存机箱 LED 实用程序</title>
 <para>储存机箱 LED 监视实用程序 (<command>ledmon(8)</command>) 以及 LED 控件 (<command>ledctl(8)</command>) 实用程序属于 Linux 用户空间应用程序，它们使用各种接口和协议控制储存机箱 LED。主要用途是视觉化显示使用 mdadm 实用程序创建的 Linux MD 软件 RAID 设备的状态。守护程序 ledmon 会监视驱动器阵列的状态，然后相应更新驱动器 LED 的状态。您可以使用实用程序 ledctl 为指定的设备设置 LED 模式。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="b14fewb2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14fewb3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5li" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5lj" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5lk" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14feg6m" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="b14fewb2">
  <title>支持的 LED 管理协议</title>
  <para>这些 LED 实用程序使用 SGPIO（通用串行输入/输出）规范（小型 (SFF) 8485）以及 SCSI 机箱服务 (SES) 2 协议控制 LED。它们实施 SGPIO 的 SFF-8489 规范中的国际闪烁模式解释 (IBPI) 模式。IBPI 定义了 SGPIO 标准将如何解释成驱动器以及底板上各插槽的状态，以及底板将如何通过 LED 视觉化显示状态。 </para>
  <para>有些储存机箱并未严格遵循 SFF-8489 规范。机箱处理器可能会接受 IBPI 模式，但不会按照 SFF-8489 规范闪烁 LED，或者处理器可能仅支持部分 IBPI 模式。 </para>
  <para><command>ledmon</command> 以及 <command>ledctl</command> 实用程序不支持 LED 管理(AHCI) 和 SAF-TE 协议。</para>
 </sect1>
 <sect1 id="b14fewb3">
  <title>支持的储存机箱系统</title>
  <para><command>ledmon</command> 和 <command>ledctl</command> 应用程序经验证可以用于 Intel AHCI 控制器以及 Intel SAS 控制器等 Intel 储存控制器。自 SUSE Linux Enterprise Server 11 SP3 起，这些应用程序还支持使用 PCIe-SSD（固态硬盘）机箱 LED 来控制属于 MD 软件 RAID 卷一部分的 PCIe-SSD 设备的储存机箱状态（正常、故障、正在重建）LED。这些应用程序也可能可以用于其他供应商提供的符合 IBPI 的储存控制器（特别是 SAS/SCSI 控制器）；不过其他供应商的控制器未经过测试。</para>
 </sect1>
 <sect1 id="b13jg5li">
  <title>储存机箱 LED 监视服务 (ledmon(8))</title>
  <para><command>ledmon</command> 应用程序是一个守护程序进程，它会持续监视 MD 软件 RAID 设备的状态或储存机箱或驱动器机架中块设备的状态。一次只能运行一个该守护程序的实例。<command>ledmon</command> 应用程序是 Intel 机箱 LED 实用程序的组成部分。 </para>
  <para>状态通过与储存阵列机箱或驱动器机架中的每个槽对应的 LED 视觉化显示。应用程序会监视所有软件 RAID 设备并视觉化显示其状态。无法通过该应用程序仅监视选定的软件 RAID 卷。</para>
  <para><command>ledmon</command> 应用程序支持两类 LED 系统：二 LED 系统（活动 LED 和状态 LED）以及三 LED 系统（活动 LED、查找 LED 和故障 LED）。此工具在访问 LED 时具有最高优先级。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14fbg00" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfkj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfkq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfku" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14fbg00">
   <title>语法</title>

<screen>
ledmon [options]
</screen>

   <para>以 <systemitem>root</systemitem> 用户身份或以具有 <systemitem>root</systemitem> 权限的用户身份发出命令。</para>
  </sect2>
  <sect2 id="b14fbfkj">
   <title>选项</title>
   <variablelist>
    <varlistentry id="b14fbfkk">
     <term>-c</term>
     <term>--confg=path</term>
     <listitem>
      <para>设置本地配置文件的路径。如果指定此选项，则全局配置文件和用户配置文件都将失效。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkl">
     <term>-l</term>
     <term>--log=path</term>
     <listitem>
      <para>设置本地日志文件的路径。如果指定此用户定义的文件，则将不会使用全局日志文件 <filename>/var/log/ledmon.log</filename>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkm">
     <term>-t</term>
     <term>--interval=seconds</term>
     <listitem>
      <para>设置 <filename>sysfs</filename> 的扫描间隔时间。该值以秒为单位。最小值为 5 秒。不指定最大值。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkn">
     <term>&lt;--quiet|--error|--warning|--info|--debug|--all&gt;</term>
     <listitem>
      <para>指定冗长级别。级别选项按从无信息到最详细信息的顺序指定。如果不记录日志，则使用 --quiet 选项。如果要记录所有内容，则使用 --all 选项。如果指定多个冗长选项，则会应用命令中的最后一个选项。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfko">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>将命令信息打印至控制台，然后退出。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkp">
     <term>-v</term>
     <term>--version</term>
     <listitem>
      <para>显示 <command>ledmon</command> 的版本以及许可证的相关信息，然后退出。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fbfkq">
   <title>文件</title>
   <variablelist>
    <varlistentry id="b14fbfkr">
     <term>/var/log/ledmon.log</term>
     <listitem>
      <para><command>ledmon</command> 应用程序使用的全局日志文件。要强制记录到用户定义的文件，请使用 <literal>-l</literal> 选项。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfks">
     <term>~/.ledctl</term>
     <listitem>
      <para>在 <command>ledmon</command> 和所有 <command>ledctl</command> 应用程序实例之间共享的用户配置文件。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkt">
     <term>/etc/ledcfg.conf</term>
     <listitem>
      <para>在 <command>ledmon</command> 和所有 <command>ledctl</command> 应用程序实例之间共享的全局配置文件。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fbfku">
   <title>已知问题</title>
   <para><command>ledmon</command> 守护程序无法识别 SFF-8489 规范中的 PFA（故障预警分析）状态。因此无法视觉化显示 PFA 模式。 </para>
  </sect2>
 </sect1>
 <sect1 id="b13jg5lj">
  <title>储存机箱 LED 控制应用程序 (ledctl(8))</title>
  <para>机箱 LED 应用程序 (<command>ledctl(8)</command>) 是一款用户空间应用程序，用于控制与储存机箱或驱动器机架中的每个槽相关的 LED。<command>ledctl</command> 应用程序是 Intel 机箱 LED 实用程序的组成部分。 </para>
  <para>在您发出命令时，指定设备的 LED 将被设置为指定的模式，并且所有其他的 LED 都将关闭。要使用此应用程序，用户必须具有 root 权限。由于 <command>ledmon</command> 应用程序在访问 LED 时具有最高优先级，因此如果 <command>ledmon</command> 正在运行，则由 ledctl 设置的某些模式可能会无效（查找模式除外）。</para>
  <para><command>ledctl</command> 应用程序支持两类 LED 系统：二 LED 系统（活动 LED 和状态 LED）以及三 LED 系统（活动 LED、故障 LED 和查找 LED）。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14fbijh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbj24" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcdo6" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fck4r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fck4s" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcmzl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcrjc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14fbijh">
   <title>语法</title>

<screen>
ledctl [options] <replaceable>pattern_name</replaceable>=list_of_devices 
</screen>

   <para>以 <systemitem>root</systemitem> 用户身份或以具有 <systemitem>root</systemitem> 权限的用户身份发出命令。</para>
  </sect2>
  <sect2 id="b14fbj24">
   <title>模式名称</title>
   <para>根据 SFF-8489 规范，<command>ledctl</command> 应用程序会接受以下 <guimenu>pattern_name</guimenu> 自变量的名称。</para>
   <variablelist>
    <varlistentry id="b14fbl2q">
     <term>locate</term>
     <listitem>
      <para>打开与指定设备或空槽相关的查找 LED。此状态用于标识槽或驱动器。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbxbj">
     <term>locate_off</term>
     <listitem>
      <para>关闭与指定设备或空槽相关的查找 LED。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc0mu">
     <term>normal</term>
     <listitem>
      <para>关闭与指定设备相关的状态 LED、故障 LED 以及查找 LED。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc0mv">
     <term>off</term>
     <listitem>
      <para>仅关闭与指定设备相关的状态 LED 和故障 LED。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc0mw">
     <term>ica</term>
     <term>degraded</term>
     <listitem>
      <para>可视化显示 <literal>In a Critical Array</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc1ii">
     <term>rebuild</term>
     <term>rebuild_p</term>
     <listitem>
      <para>可视化显示 <literal>Rebuild</literal> 模式。由于兼容性和旧版原因，支持两种重构建状态。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc1ij">
     <term>ifa</term>
     <term>failed_array</term>
     <listitem>
      <para>可视化显示 <literal>In a Failed Array</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc1ik">
     <term>hotspare</term>
     <listitem>
      <para>可视化显示 <literal>Hotspare</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc2n0">
     <term>pfa</term>
     <listitem>
      <para>可视化显示 <literal>Predicted Failure Analysis</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc2n1">
     <term>failure</term>
     <term>disk_failed</term>
     <listitem>
      <para>可视化显示 <literal>Failure</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdno">
     <term>ses_abort</term>
     <listitem>
      <para>SES-2 R/R ABORT</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnp">
     <term>ses_rebuild</term>
     <listitem>
      <para>SES-2 REBUILD/REMAP</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnq">
     <term>ses_ifa</term>
     <listitem>
      <para>SES-2 IN FAILED ARRAY</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnr">
     <term>ses_ica</term>
     <listitem>
      <para>SES-2 IN CRITICAL ARRAY</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdns">
     <term>ses_cons_check</term>
     <listitem>
      <para>SES-2 CONS CHECK</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnt">
     <term>ses_hotspare</term>
     <listitem>
      <para>SES-2 HOTSPARE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnu">
     <term>ses_rsvd_dev</term>
     <listitem>
      <para>SES-2 RSVD DEVICE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnv">
     <term>ses_ok</term>
     <listitem>
      <para>SES-2 OK</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnw">
     <term>ses_ident</term>
     <listitem>
      <para>SES-2 IDENT</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnx">
     <term>ses_rm</term>
     <listitem>
      <para>SES-2 REMOVE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdny">
     <term>ses_insert</term>
     <listitem>
      <para>SES-2 INSERT</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnz">
     <term>ses_missing</term>
     <listitem>
      <para>SES-2 MISSING</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo0">
     <term>ses_dnr</term>
     <listitem>
      <para>SES-2 DO NOT REMOVE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo1">
     <term>ses_active</term>
     <listitem>
      <para>SES-2 ACTIVE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo2">
     <term>ses_enable_bb</term>
     <listitem>
      <para>SES-2 ENABLE BYP B</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo3">
     <term>ses_enable_ba</term>
     <listitem>
      <para>SES-2 ENABLE BYP A</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo4">
     <term>ses_devoff</term>
     <listitem>
      <para>SES-2 DEVICE OFF</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo5">
     <term>ses_fault</term>
     <listitem>
      <para>SES-2 FAULT</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fcdo6">
   <title>模式转换</title>
   <para>将非 SES-2 模式发送至机箱中的设备时，该模式会自动转换为<xref linkend="b14fcdo7" xrefstyle="TableXRef"/>中所示的 SCSI 机箱服务 (SES) 2 模式。</para>
   <table id="b14fcdo7" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <title>非 SES-2 模式与 SES-2 模式之间的转换</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14fcdo8">
       <entry>
        <para>非 SES-2 模式</para>
       </entry>
       <entry>
        <para>SES-2 模式</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14fcdo9">
       <entry>
        <para>locate</para>
       </entry>
       <entry>
        <para>ses_ident</para>
       </entry>
      </row>
      <row id="b14fcdoa">
       <entry>
        <para>locate_off</para>
       </entry>
       <entry>
        <para>ses_ident</para>
       </entry>
      </row>
      <row id="b14fcdob">
       <entry>
        <para>normal</para>
       </entry>
       <entry>
        <para>ses_ok</para>
       </entry>
      </row>
      <row id="b14fcdoc">
       <entry>
        <para>off</para>
       </entry>
       <entry>
        <para>ses_ok</para>
       </entry>
      </row>
      <row id="b14fcdod">
       <entry>
        <para>ica</para>
       </entry>
       <entry>
        <para>ses_ica</para>
       </entry>
      </row>
      <row id="b14fcdoe">
       <entry>
        <para>degraded</para>
       </entry>
       <entry>
        <para>ses_ica</para>
       </entry>
      </row>
      <row id="b14fcdof">
       <entry>
        <para>rebuild</para>
       </entry>
       <entry>
        <para>ses_rebuild</para>
       </entry>
      </row>
      <row id="b14fcdog">
       <entry>
        <para>rebuild_p</para>
       </entry>
       <entry>
        <para>ses_rebuild</para>
       </entry>
      </row>
      <row id="b14fcdoh">
       <entry>
        <para>ifa</para>
       </entry>
       <entry>
        <para>ses_ifa</para>
       </entry>
      </row>
      <row id="b14fcdoi">
       <entry>
        <para>failed_array</para>
       </entry>
       <entry>
        <para>ses_ifa</para>
       </entry>
      </row>
      <row id="b14fcdoj">
       <entry>
        <para>hotspare</para>
       </entry>
       <entry>
        <para>ses_hotspare</para>
       </entry>
      </row>
      <row id="b14fcdok">
       <entry>
        <para>pfa</para>
       </entry>
       <entry>
        <para>ses_rsvd_dev</para>
       </entry>
      </row>
      <row id="b14fcdol">
       <entry>
        <para>failure</para>
       </entry>
       <entry>
        <para>ses_fault</para>
       </entry>
      </row>
      <row id="b14fcdom">
       <entry>
        <para>disk_failed</para>
       </entry>
       <entry>
        <para>ses_fault</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="b14fck4r">
   <title>设备列表</title>
   <para>在您发出 <command>ledctl</command> 命令时，指定设备的 LED 将被设置为指定的模式，并且所有其他的 LED 都将关闭。设备列表可采用以下两种格式中的一种提供：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>以逗号分隔且无空格的设备列表</para>
    </listitem>
    <listitem>
     <para>以空格分隔且用花括号括住的设备列表</para>
    </listitem>
   </itemizedlist>
   <para>如果在同一个命令中指定多个模式，则每一个模式的设备列表可以使用相同格式也可以使用不同格式。有关显示两种列表格式的示例，请参见<xref linkend="b14fcrjc" xrefstyle="SectTitleOnPage"/>。</para>
   <para>设备就是指向 <filename>/dev</filename> 目录或 <filename>/sys/block</filename> 目录中文件的路径。该路径可以标识块设备、MD 软件 RAID 设备或容器设备。对于软件 RAID 设备或容器设备，会为所有关联的块设备设置所报告的 LED 状态。</para>
   <para>list_of_devices 中列出设备的 LED 将被设置为指定模式 pattern_name 并且所有其他 LED 都将关闭。 </para>
  </sect2>
  <sect2 id="b14fck4s">
   <title>选项</title>
   <variablelist>
    <varlistentry id="b14fck4t">
     <term>-c</term>
     <term>--confg=path</term>
     <listitem>
      <para>设置本地配置文件的路径。如果指定此选项，则全局配置文件和用户配置文件都将失效。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4u">
     <term>-l</term>
     <term>--log=path</term>
     <listitem>
      <para>设置本地日志文件的路径。如果指定此用户定义的文件，则将不会使用全局日志文件 <filename>/var/log/ledmon.log</filename>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4v">
     <term>--quiet</term>
     <listitem>
      <para>关闭所有向 <filename>stdout</filename> 或从 <filename>stderr</filename> 发送的消息。但在本地文件和 <filename>syslog</filename> 功能中仍会记录这些消息。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4w">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>将命令信息打印至控制台，然后退出。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4x">
     <term>-v</term>
     <term>--version</term>
     <listitem>
      <para>显示 <command>ledctl</command> 的版本以及许可证的相关信息，然后退出。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fcmzl">
   <title>文件</title>
   <variablelist>
    <varlistentry id="b14fcmzm">
     <term>/var/log/ledctl.log</term>
     <listitem>
      <para><command>ledctl</command> 应用程序的所有实例使用的全局日志文件。要强制记录到用户定义的文件，请使用 <literal>-l</literal> 选项。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcmzn">
     <term>~/.ledctl</term>
     <listitem>
      <para>在 <command>ledmon</command> 和所有 <command>ledctl</command> 应用程序实例之间共享的用户配置文件。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcmzo">
     <term>/etc/ledcfg.conf</term>
     <listitem>
      <para>在 <command>ledmon</command> 和所有 <command>ledctl</command> 应用程序实例之间共享的全局配置文件。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fcrjc">
   <title>示例</title>
   <para>查找单个块设备：</para>

<screen>
ledctl locate=/dev/sda
</screen>

   <para>关闭单个块设备的“查找 LED”：</para>

<screen>
ledctl locate_off=/dev/sda
</screen>

   <para>查找 MD 软件 RAID 设备的磁盘，并同时为两个块设备设置重构建模式：</para>

<screen>
ledctl locate=/dev/md127 rebuild={ /sys/block/sd[a-b] }
</screen>

   <para>关闭指定设备的“状态 LED”和“故障 LED”：</para>

<screen>
ledctl off={ /dev/sda /dev/sdb }
</screen>

   <para>查找三个块设备：</para>

<screen>
ledctl locate=/dev/sda,/dev/sdb,/dev/sdc

ledctl locate={ /dev/sda /dev/sdb /dev/sdc }
</screen>

  </sect2>
 </sect1>
 <sect1 id="b13jg5lk">
  <title>机箱 LED 实用程序配置文件 (ledctl.conf(5))</title>
  <para><filename>ledctl.conf</filename> 文件是 Intel 机箱 LED 实用程序的配置文件。这些实用程序此时不使用配置文件。文件的名称和位置被保留待日后功能改进。 </para>
 </sect1>
 <sect1 id="b14feg6m">
  <title>其他信息</title>
  <para>有关 LED 模式以及监视工具的详细信息，请参见以下资源：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="http://ledmon.sourceforge.net/">Sourceforge.net 上的 LEDMON 开源项目</ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="ftp://ftp.seagate.com/sff/SFF-8485.PDF">SGPIO 规范 SFF-8485</ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="ftp://ftp.seagate.com/sff/SFF-8489.PDF">IBPI 规范 SFF-8489</ulink></para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>

<chapter id="isns" lang="en" xml:base="06_isns.xml">
 <title>iSNS for Linux</title>
 <para>储存区域网络 (SAN) 可包含分布在复杂网络间的许多磁盘驱动器。这会使设备发现和设备所有权变得复杂。iSCSI 发起程序必须能够识别 SAN 中的储存资源，并确定是否可对其进行访问。 </para>
 <para>因特网储存名称服务 (iSNS) 是一项基于标准的服务，使用它可方便地自动发现、管理和配置 TCP/IP 网络上 iSCSI 设备。与光纤通道网络中的服务相比，iSNS 可提供智能的储存发现和管理服务。</para>
 <important>
  <para>只有在安全的内部网络中，才应使用 iSNS。</para>
 </important>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec.isns.overview" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec.iscsi.setup" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchyh0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi0bdwd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi0cewc" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchyhq" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sec.isns.overview">
  <title>iSNS 的工作原理</title>
  <para>iSCSI 发起程序要发现 iSCSI 目标，需要识别网络中的哪些设备是储存资源以及访问这些资源需要哪些 IP 地址。对 iSNS 服务器的查询会返回发起程序有权访问的一个 iSCSI 目标和 IP 地址的列表。 </para>
  <para>使用 iSNS，可以创建 iSNS 发现域和发现域集。然后，将 iSCSI 目标和发起程序分组或组织为发现域，并将发现域分组到发现域集。通过将储存节点划分到域，您可以将每个主机的发现进程限制为在 iSNS 中注册的最合适的目标子集，这使得储存网络可通过降低不必要的发现数和限制每个主机在建立发现关系时花费的时间而按比例缩放。这使您可以控制和简化必须发现的目标和发起程序的数目。 </para>
  <figure pgwide="0" id="bcna0wb">
   <title>iSNS 发现域和发现域集</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="isns_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>iSCSI 目标和 iSCSI 发起程序都使用 iSNS 客户端启动通过 iSNS 协议与 iSNS 服务器的事务。然后，它们在公共发现域中注册设备属性信息、下载有关其他注册客户端的信息，以及接收出现在其发现域中的事件的异步通知。 </para>
  <para>iSNS 服务器响应由 iSNS 客户端使用 iSNS 协议作出的 iSNS 协议查询和请求。iSNS 服务器启动 iSNS 协议状态更改通知，并正确储存由 iSNS 数据库中的注册请求提交的身份验证信息。 </para>
  <para>iSNS for Linux 的某些优点包括： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>提供信息设备以供注册、发现和管理联网储存资产。 </para>
   </listitem>
   <listitem>
    <para>与 DNS 基础结构集成。 </para>
   </listitem>
   <listitem>
    <para>统一 iSCSI 储存的注册、发现和管理。 </para>
   </listitem>
   <listitem>
    <para>简化储存管理实施。 </para>
   </listitem>
   <listitem>
    <para>与其他发现方法相比，改进了可伸缩性。 </para>
   </listitem>
  </itemizedlist>
  <para>以下情境可以帮助您更好地理解 iSNS 的优点： </para>
  <para>假定您拥有一家配有 100 个 iSCSI 发起程序和 100 个 iSCSI 目标的公司。根据您的配置，所有 iSCSI 发起程序都可能尝试发现并连接到 100 个 iSCSI 目标的任一个。这将造成发现和连接出现问题。通过将发起程序和目标分组到发现域，您可以阻止某个部门的 iSCSI 发起程序发现其他部门的 iSCSI 目标。因此，某特定部门中的 iSCSI 发起程序只发现属于该部门发现域中的那些 iSCSI 目标。 </para>
 </sect1>
 <sect1 id="sec.iscsi.setup">
  <title>安装 iSNS Server for Linux</title>
  <para>iSNS Server for Linux 随附在 SLES 10 SP2 和更高版本中，但默认情况下不会安装或配置。必须配置 iSNS 包模块（<filename>isns</filename> 和 <filename>yast2-isns</filename> 模块）并配置 iSNS 服务。 </para>
  <note>
   <para>可以在安装了 iSCSI 目标或 iSCSI 发起程序软件的同一服务器上安装 iSNS。不支持在同一服务器上同时安装 iSCSI 目标软件和 iSCSI 发起程序软件。 </para>
  </note>
  <para>安装 iSNS for Linux： </para>
  <procedure id="bgchygw">
   <step id="bgchygx" performance="required">
    <para>启动 YaST 并选择<guimenu>网络服务</guimenu> <guimenu>iSNS 服务器</guimenu>。</para>
   </step>
   <step id="bi0bpeh" performance="required">
    <para>当系统提示安装 <filename>isns</filename> 包时，单击<guimenu>安装</guimenu>。</para>
   </step>
   <step id="bi0bq1e" performance="required">
    <para>遵循安装说明，提供 SUSE Linux Enterprise Server 11 安装磁盘。</para>
    <para role="intro">当安装完成后，“iSNS 服务配置”对话框会自动打开，显示<guimenu>服务</guimenu>选项卡。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="isns_config_a.png" width="307pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bi0bxbd" performance="required">
    <para>在 <guimenu>iSNS 服务器地址</guimenu>中，指定 iSNS 服务器的 DNS 名或 IP 地址。</para>
   </step>
   <step id="bgchygy" performance="required">
    <para>在<guimenu>启动服务</guimenu>中，选择以下选项之一： </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bi0c15l">
       <title>引导时：</title>
       <para>iSNS 服务会在服务器启动时自动启动。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bi0c69a">
       <title>手动（默认）：</title>
       <para>必须在安装了 iSNS 服务的服务器的控制台上输入 <command>rcisns start</command> 或 <command>/etc/init.d/isns start</command>，手动启动该服务。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step id="bi0c2ei" performance="required">
    <para>指定以下防火墙设置：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bi0c69b">
       <title>打开防火墙中的端口：</title>
       <para>选中该复选框以打开防火墙，并允许从远程计算机访问该服务。默认情况下，防火墙端口是关闭的。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bi0c69c">
       <title>防火墙细节：</title>
       <para>如果打开防火墙端口，默认情况下会在所有网络接口上打开该端口。单击<guimenu>防火墙细节</guimenu>以选择要打开该端口的接口，选择要使用的网络接口，然后单击<guimenu>确定</guimenu>。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step id="bgchygz" performance="required">
    <para>单击<guimenu>完成</guimenu>应用配置设置并完成安装。 </para>
   </step>
   <step id="bi0c7d1" performance="required">
    <para>继续<xref linkend="bgchyh0" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchyh0">
  <title>配置 iSNS 发现域</title>
  <para>为使 iSCSI 发起程序和目标使用 iSNS 服务，它们必须属于某个发现域。 </para>
  <important>
   <para>SNS 必须已安装并且正在运行，才能配置 iSNS 发现域。有关信息，请参见<xref linkend="bi0bdwd" xrefstyle="SectTitleOnPage"/>。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="sec.isns.ddcreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec.isns.ddscreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec.isns.ddadd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec.isns.ddsadd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="sec.isns.ddcreate">
   <title>创建 iSNS 发现域</title>
   <para>安装 iSNS 服务时，将会自动创建一个名为<guimenu>默认 DD</guimenu> 的默认发现域。已配置为使用 iSNS 的现有 iSCSI 目标和发起程序会自动添加到默认的发现域。 </para>
   <para>创建新的发现域： </para>
   <procedure id="bgchyh5">
    <step id="bgchyh6" performance="required">
     <para>启动 YaST，然后在<guimenu>网络服务</guimenu>下选择 <guimenu>iSNS 服务器</guimenu>。 </para>
    </step>
    <step id="bgchyh7" performance="required">
     <para>单击<guimenu>发现域</guimenu>选项卡。 </para>
     <para><guimenu>发现域</guimenu>区域将列出所有发现域。您可以创建新的发现域或删除现有的发现域。删除域将从域中删除成员，但不会删除 iSCSI 节点成员。</para>
     <para><guimenu>发现域成员</guimenu>区域列出指派给所选发现域的所有 iSCSI 节点。选择不同的发现域会使用该发现域的成员刷新该列表。您可以在所选发现域中添加和删除 iSCSI 节点。删除 iSCSI 节点会从域中删除该节点，但不会删除该 iSCSI 节点。</para>
     <para>创建 iSCSI 节点允许将尚未注册的节点添加为发现域的成员。当 iSCSI 发起程序或目标注册该节点时，它会成为该域的一部分。 </para>
     <para role="intro">当 iSCSI 发起程序执行发现请求时，iSNS 服务会返回作为同一发现域成员的所有 iSCSI 节点目标。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_discdomains_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bi0cku8" performance="required">
     <para>单击<guimenu>创建发现域</guimenu>按钮。 </para>
     <para>还可以选择现有发现域，然后单击<guimenu>删除</guimenu>按钮删除该发现域。 </para>
    </step>
    <step id="bgchyh8" performance="required">
     <para>指定创建的发现域的名称，然后单击<guimenu>确定</guimenu>。 </para>
    </step>
    <step id="bi71u1v" performance="required">
     <para>继续<xref linkend="sec.isns.ddscreate" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec.isns.ddscreate">
   <title>创建 iSNS 发现域集</title>
   <para>发现域必须属于某个发现域集。您可以创建一个发现域，并向该发现域添加节点，但除非将该发现域添加到某发现域集，否则，它是不活动的，且 iSNS 服务不起作用。安装 iSNS 时将自动创建一个名为<guimenu>默认 DDS</guimenu> 的默认发现域集，默认发现域将自动添加到该域集。 </para>
   <para>创建发现域集： </para>
   <procedure id="bgchyh9">
    <step id="bgchyha" performance="required">
     <para>启动 YaST，然后在<guimenu>网络服务</guimenu>下选择 <guimenu>iSNS 服务器</guimenu>。 </para>
    </step>
    <step id="bi0cs2c" performance="required">
     <para>单击<guimenu>发现域集</guimenu>选项卡。 </para>
     <para><guimenu>发现域集</guimenu>区域会列出所有发现域集。发现域必须是发现域集的成员才能活动。</para>
     <para>在 iSNS 数据库中，发现域集包含发现域，发现域又包含 iSCSI 节点成员。 </para>
     <para><guimenu>发现域集成员</guimenu>区域可以列出指派到所选发现域集的所有发现域。选择不同的发现域集会使用该发现域集的成员刷新该列表。您可以在所选发现域集中添加和删除发现域。删除发现域会将其从域集中删除，但不会真正删除该发现域。</para>
     <para>向一个集中添加发现域允许将尚未注册的 iSNS 发现域添加为该发现域集的成员。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_discdomainsets_a.png" width="422pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bgchyhb" performance="required">
     <para>单击<guimenu>创建发现域集</guimenu>按钮。 </para>
     <para>还可以选择现有发现域集，然后单击<guimenu>删除</guimenu>按钮删除该发现域集。 </para>
    </step>
    <step id="bgchyhc" performance="required">
     <para>指定创建的发现域集的名称，然后单击<guimenu>确定</guimenu>。</para>
    </step>
    <step id="bi71u8j" performance="required">
     <para>继续<xref linkend="sec.isns.ddadd" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec.isns.ddadd">
   <title>向发现域添加 iSCSI 节点</title>
   <procedure id="bgchyhd">
    <step id="bgchyhe" performance="required">
     <para>启动 YaST，然后在<guimenu>网络服务</guimenu>下选择 <guimenu>iSNS 服务器</guimenu>。 </para>
    </step>
    <step id="bi0csq8" performance="required">
     <para>单击 <guimenu>iSCSI 节点</guimenu>选项卡。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_iscsinodes_a.png" width="422pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bgchyhf" performance="required">
     <para>检查节点列表以确保列出了要使用 iSNS 服务的 iSCSI 目标和发起程序。 </para>
     <para>如果未列出 iSCSI 目标或发起程序，可能需要在节点上重启动 iSCSI 服务。还可以通过运行 <command>rcopen-iscsi restart</command> 命令重启动发起程序或 <command>rciscsitarget restart</command> 命令重启动目标来完成此操作。 </para>
     <para>可以选择某 iSCSI 节点，然后单击<guimenu>删除</guimenu>按钮从 iSNS 数据库中删除该节点。如果不再使用某 iSCSI 节点或已对其重命名，这十分有用。 </para>
     <para>除非删除或注释掉 iSCSI 配置文件的 iSNS 部分，否则，在重启动 iSCSI 服务或重引导服务器时，iSCSI 节点将再次自动添加到列表（iSNS 数据库）。 </para>
    </step>
    <step id="bgchyhg" performance="required">
     <para>单击<guimenu>发现域</guimenu>选项卡，选择所需的发现域，然后单击<guimenu>显示成员</guimenu>按钮。 </para>
    </step>
    <step id="bgchyhh" performance="required">
     <para>单击<guimenu>添加现有 iSCSI 节点</guimenu>，选择要添加到域中的节点，然后单击<guimenu>添加节点</guimenu>。 </para>
    </step>
    <step id="bgchyhi" performance="required">
     <para>重复<xref linkend="bgchyho" xrefstyle="StepXRef"/>（重复次数等于要向发现域添加的节点数），然后在添加节点完成后单击<guimenu>完成</guimenu>。 </para>
     <para>一个 iSCSI 节点可能属于多个发现域。 </para>
    </step>
    <step id="bi71uie" performance="required">
     <para>继续<xref linkend="sec.isns.ddsadd" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec.isns.ddsadd">
   <title>将发现域添加到发现域集</title>
   <procedure id="bgchyhj">
    <step id="bgchyhk" performance="required">
     <para>启动 YaST，然后在<guimenu>网络服务</guimenu>下选择 <guimenu>iSNS 服务器</guimenu>。 </para>
    </step>
    <step id="bgchyhl" performance="required">
     <para>单击<guimenu>发现域集</guimenu>选项卡。 </para>
    </step>
    <step id="bgchyhm" performance="required">
     <para>选择<guimenu>创建发现域集</guimenu>将新集添加到发现域集列表。 </para>
    </step>
    <step id="bgchyhn" performance="required">
     <para>选择要修改的发现域集。 </para>
    </step>
    <step id="bgchyho" performance="required">
     <para>单击<guimenu>添加发现域</guimenu>，选择要添加到发现域集中的发现域，然后单击<guimenu>添加发现域</guimenu>。 </para>
    </step>
    <step id="bgchyhp" performance="required">
     <para>重复上一步骤（重复次数等于要向发现域集添加的发现域数），然后单击<guimenu>完成</guimenu>。 </para>
     <para>一个发现域可属于多个发现域集。 </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="bi0bdwd">
  <title>启动 iSNS</title>
  <para>必须在安装 iSNS 的服务器上启动它。在终端控制台作为 <systemitem>root</systemitem> 用户输入以下命令之一：</para>

<screen>
<command>rcisns start</command> 
</screen>


<screen>
<command>/etc/init.d/isns start</command>
</screen>

  <para>您还可以对 iSNS 使用 <command>stop</command>、<command>status</command> 和 <command>restart</command> 选项。</para>
  <para>iSNS 还可以配置为在每次重引导服务器时自动启动： </para>
  <procedure id="bgchyh1">
   <step id="bgchyh2" performance="required">
    <para>启动 YaST，然后在<guimenu>网络服务</guimenu>下选择 <guimenu>iSNS 服务器</guimenu>。 </para>
   </step>
   <step id="bgchyh3" performance="required">
    <para>使用所选的<guimenu>服务</guimenu>选项卡，指定 iSNS 服务器的 IP 地址，然后单击<guimenu>保存地址</guimenu>。 </para>
   </step>
   <step id="bgchyh4" performance="required">
    <para>在屏幕的<guimenu>启动服务</guimenu>部分，选择<guimenu>引导时</guimenu>。 </para>
    <para>还可以选择手动启动 iSNS 服务器。然后，每次重启动服务器时，必须使用 <command>rcisns start</command> 命令启动该服务。 </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bi0cewc">
  <title>停止 iSNS</title>
  <para>必须在运行 iSNS 的服务器上停止它。在终端控制台作为 <systemitem>root</systemitem> 用户输入以下命令之一：</para>

<screen>
<command>rcisns stop</command> 
</screen>


<screen>
<command>/etc/init.d/isns stop</command> 
</screen>

 </sect1>
 <sect1 id="bgchyhq">
  <title>更多信息</title>
  <para>有关信息，请参见 <ulink url="http://sourceforge.net/projects/linuxisns/"><citetitle>Linux iSNS for iSCSI project</citetitle></ulink>（适用于 iSCSI 项目的 Linux iSNS）。此项目的电子邮件列表为 <ulink url="http://sourceforge.net/mailarchive/forum.php?forum_name=linuxisns-discussion"><citetitle>Linux iSNS - Discussion</citetitle></ulink>（Linux iSNS － 讨论）。 </para>
  <para>关于 iSNS 的常规信息在 <ulink url="http://www.ietf.org/rfc/rfc4171"><citetitle>RFC 4171: Internet Storage Name Service</citetitle></ulink>（因特网储存名称服务）中提供。 </para>
 </sect1>
</chapter>

<chapter id="cha_inst_system_iscsi" lang="en" xml:base="06_iscsi.xml">
 <title>经由 IP 网络的大容量储存：iSCSI </title>
 <para>计算机中心和运行服务器时的核心问题之一是为服务器系统提供硬盘容量。通常为此目的使用光纤通道。iSCSI（因特网 SCSI）解决方案提供了光纤通道的低成本备用方案，可以充分利用商品服务器和以太网联网设备。Linux iSCSI 提供 iSCSI 发起程序和目标软件，用于将 Linux 服务器连接到中心储存系统。</para>
 <figure pgwide="0" id="bo1n90f">
  <title>使用 iSNS 服务器的 iSCSI SAN</title>
  <mediaobject>
   <imageobject role="fo">
   <imagedata fileref="iscsi_san_a.png" width="445pt" format="eps"/></imageobject>
   <imageobject role="html">
   <imagedata fileref="iscsi_san_a.png" width="445pt" format="png"/></imageobject>
  </mediaobject>
 </figure>
 <para>iSCSI 是一种储存联网协议，便于在块储存设备和服务器之间通过 TCP/IP 网络将数据作为 SCSI 包传送。iSCSI 目标软件在目标服务器上运行，并将逻辑单元定义为 iSCSI 目标设备。iSCSI 发起程序软件在不同服务器上运行并连接到目标设备，以使此服务器上的储存设备可用。 </para>
 <important>
  <para>不支持在生产环境中的同一服务器上运行 iSCSI 目标软件和 iSCSI 发起程序软件。</para>
 </important>
 <para>iSCSI 目标和 iSCSI 发起程序服务器通过在 LAN 中发送 IP 级的 SCSI 包进行通讯。当运行在 iSCSI 发起程序服务器上的应用程序启动针对 iSCSI 目标设备的查询时，操作系统会生成必需的 SCSI 命令。然后，SCSI 命令会嵌入到 IP 包中并在需要时由软件进行加密，此软件通常为 <emphasis>iSCSI 发起程序</emphasis>。包将从内部 IP 网络传送到相应的 iSCSI 远程站（称为 <emphasis>iSCSI 目标</emphasis>）。 </para>
 <para>许多储存解决方案允许通过 iSCSI 进行访问，但是也可以运行提供 iSCSI 目标的 Linux 服务器。在此情况下，对已针对文件系统服务优化过的 Linux 服务器进行设置是很重要的。iSCSI 目标会访问 Linux 中的块设备。因此，可以使用 RAID 解决方案增加磁盘空间以及大量内存，从而改善数据缓存。有关 RAID 的更多信息，请参见<xref linkend="raidyast" xrefstyle="ChapTitleOnPage"/>。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bj4rqa5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_inst_system_iscsi_target" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_inst_system_iscsi_initiator" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkrqdd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_inst_system_iscsi_ts" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec_inst_system_iscsi_initiator_info" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bj4rqa5">
  <title>安装 iSCSI 目标和发起程序</title>
  <para>YaST 包括 iSCSI 目标和 iSCSI 发起程序软件的条目，但是默认情况下不会安装这些包。 </para>
  <important>
   <para>不支持在生产环境中的同一服务器上运行 iSCSI 目标软件和 iSCSI 发起程序软件。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bj4rsgl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bj4rrj9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bj4rsgl">
   <title>安装 iSCSI 目标软件</title>
   <para>在要创建 iSCSI 目标设备的服务器上安装 iSCSI 目标软件。</para>
   <procedure id="bj4rsgm">
    <step id="bj4rsgn" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
    </step>
    <step id="bj4rsgo" performance="required">
     <para>选择<guimenu>网络服务</guimenu><guimenu>iSCSI 目标</guimenu>。</para>
    </step>
    <step id="bj4rsma" performance="required">
     <para>当系统提示您安装 <filename>iscsitarget</filename> 包时，请单击<guimenu>安装</guimenu>。</para>
    </step>
    <step id="bj4rsz7" performance="required">
     <para>按照屏幕安装指导执行操作，并根据需要提供安装媒体。</para>
     <para>安装完成后，YaST 会打开<guimenu>服务</guimenu>选项卡处于选中状态的“iSCSI 目标概述”页。</para>
    </step>
    <step id="bj58wf8" performance="required">
     <para>继续<xref linkend="sec_inst_system_iscsi_target" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="bj4rrj9">
   <title>安装 iSCSI 发起程序软件</title>
   <para>在要访问已在 iSCSI 目标服务器上设置的目标设备的每个服务器上安装 iSCSI 发起程序软件。 </para>
   <procedure id="bj4rqhd">
    <step id="bj4rqhe" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
    </step>
    <step id="bj4rqsk" performance="required">
     <para>选择<guimenu>网络服务</guimenu><guimenu>iSCSI 发起程序。</guimenu></para>
    </step>
    <step id="bj4rsth" performance="required">
     <para>当系统提示您安装 <filename>open-iscsi</filename> 包时，请单击<guimenu>安装</guimenu>。</para>
    </step>
    <step id="bj4rt8u" performance="required">
     <para>按照屏幕安装指导执行操作，并根据需要提供安装媒体。</para>
     <para>安装完成后，YaST 会打开<guimenu>服务</guimenu>选项卡处于选中状态的“iSCSI 发起程序概述”页。</para>
    </step>
    <step id="bj4saer" performance="required">
     <para>继续<xref linkend="sec_inst_system_iscsi_initiator" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sec_inst_system_iscsi_target">
  <title>设置 iSCSI 目标</title>
  <para>SUSE Linux Enterprise Server 附带从 Ardis iSCSI 目标演进的开放源代码 iSCSI 目标解决方案。基本设置可以通过 YaST 来完成，但是要充分利用 iSCSI，将需要手动设置。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bj5erpx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_inst_system_iscsi_target_yast" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_inst_system_iscsi_target_manual" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_inst_system_iscsi_target_ietadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bj5erpx">
   <title>准备储存空间</title>
   <para>iSCSI 目标配置会将现有块设备导出到 iSCSI 发起程序。必须准备要在目标设备中使用的储存空间，方法是使用 YaST 中的分区程序或从命令行通过对设备分区来设置未格式化的分区或设备。iSCSI LIO 目标可将未格式化的分区用于 Linux、Linux LVM 或 Linux RAID 文件系统 ID。 </para>
   <important>
    <para>设置完用作 iSCSI 目标的设备或分区后，切勿通过其本地路径直接对其进行访问。创建时，不要为其指定安装点。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bj5rdlu" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bj5py87" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bj5rdlu">
    <title>将设备分区</title>
    <procedure id="bj5expw">
     <step id="bj5expx" performance="required">
      <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
     </step>
     <step id="bj5f8l7" performance="required">
      <para>选择<guimenu>系统</guimenu><guimenu>分区程序</guimenu>。</para>
     </step>
     <step id="bj5f902" performance="required">
      <para>单击<guimenu>是</guimenu>跳过关于使用分区程序的警告。</para>
     </step>
     <step id="bj5f9hl" performance="required">
      <para>单击<guimenu>添加</guimenu>创建分区，但不要对其进行格式化，也不要装入它。 </para>
      <substeps performance="required">
       <step id="bj5fl5y" performance="required">
        <para>选择<guimenu>主分区</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
       </step>
       <step id="bj5fld1" performance="required">
        <para>指定要使用的空间量，然后单击<guimenu>下一步</guimenu>。</para>
       </step>
       <step id="bj5flp9" performance="required">
        <para>选择<guimenu>不格式化</guimenu>，然后指定文件系统 ID 类型。</para>
        <para>iSCSI 目标可将未格式化的分区用于 Linux、Linux LVM 或 Linux RAID 文件系统 ID。</para>
       </step>
       <step id="bj5flz6" performance="required">
        <para>选择<guimenu>不装入</guimenu>。</para>
       </step>
       <step id="bj5fm1h" performance="required">
        <para>单击<guimenu>完成</guimenu>。</para>
       </step>
      </substeps>
     </step>
     <step id="bj5fjxr" performance="required">
      <para>对稍后要用作 iSCSI LUN 的每个区域重复<xref linkend="bj5f9hl" xrefstyle="StepXRef"/>。</para>
     </step>
     <step id="bj5fm9v" performance="required">
      <para>单击<guimenu>接受</guimenu>保留更改，然后关闭 YaST。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bj5py87">
    <title>在虚拟环境中对设备分区</title>
    <para>可以使用 Xen guest 服务器作为 iSCSI 目标服务器。必须指派要用于 guest 虚拟机的 iSCSI 储存设备的储存空间，然后在 guest 环境中作为虚拟磁盘访问此空间。每个虚拟磁盘都可以是一个物理块设备，如整个磁盘、分区或卷，或者可以是一个基于文件的磁盘映像，其中虚拟磁盘是 Xen 主机服务器上较大物理磁盘上的单个映像文件。为了获得最佳性能，请从物理磁盘或分区创建每个虚拟磁盘。为 guest 虚拟机设置完虚拟磁盘后，请启动 guest 服务器，然后按照物理服务器所用的同一过程将新的空虚拟磁盘配置为 iSCSI 目标设备。 </para>
    <para>将在 Xen 主机服务器上创建基于文件的磁盘映像，并指派给 Xen guest 服务器。默认情况下，Xen 将基于文件的磁盘映像储存在目录 <filename>/var/lib/xen/images/<replaceable>虚拟机名称</replaceable></filename> 中，其中<filename><replaceable>虚拟机名称</replaceable></filename>是虚拟机的名称。</para>
    <para>例如，如果要创建大小为 4 GB 的磁盘映像 <filename>/var/lib/xen/images/vm_one/xen-0</filename>，首先应确保此目录存在，然后再创建映像本身。</para>
    <procedure id="bj5q7wn">
     <step id="bj5q7wo" performance="required">
      <para>以 <systemitem>root</systemitem> 用户身份登录主机服务器。</para>
     </step>
     <step id="bj5q4xg" performance="required">
      <para>在终端控制台提示符处，输入以下命令</para>

<screen>
mkdir -p /var/lib/xen/images/vm_one
dd if=/dev/zero of=/var/lib/xen/images/vm_one/xen-0 seek=1M bs=4096 count=1
</screen>

     </step>
     <step id="bj5q56y" performance="required">
      <para>将文件系统映像指派给 Xen 配置文件中的 guest 虚拟机。</para>
     </step>
     <step id="bj5q81p" performance="required">
      <para>以 <systemitem>root</systemitem> 用户身份登录 guest 服务器，然后使用 YaST 按照<xref linkend="bj5rdlu" xrefstyle="HeadingOnPage"/>中的过程设置虚拟块设备。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="sec_inst_system_iscsi_target_yast">
   <title>通过 YaST 创建 iSCSI 目标</title>
   <para>
    要配置 iSCSI 目标，请运行 YaST 中的 <guimenu>iSCSI 目标</guimenu>模块（命令 <command>yast2 iscsi-server</command>）。将在三个选项卡中完成配置。在<guimenu>服务</guimenu>选项卡中，选择启动方式和防火墙设置。如果希望从远程计算机访问 iSCSI 目标，则选择<guimenu>在防火墙中打开端口</guimenu>。如果 iSNS 服务器应管理发现和访问控制，则激活 <guimenu>iSNS 访问控制</guimenu>并输入 iSNS 服务器的 IP 地址。您不可使用主机名或 DNS 名称，而必须使用 IP 地址。有关 iSNS 的更多信息，请阅读<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>。
   </para>
   <para>
    全局<guimenu>选项卡提供 iSCSI 服务器的设置。</guimenu>此处的身份验证设置用于发现服务而非用于访问目标。如果不希望限制对发现的访问，则使用<guimenu>无身份验证</guimenu>。
   </para>
   <para>
    如果需要身份验证，则需要考虑两种可能性。<guimenu>进来的身份验证</guimenu>要求发起程序证明它具有在 iSCSI 目标上运行发现的权限。<guimenu>发出的身份验证</guimenu>要求 iSCSI 目标证明它是预期的目标。因此，iSCSI 目标还可提供用户名和口令。在 <ulink url="http://www.ietf.org/rfc/rfc3720.txt"><citetitle>RFC 3720</citetitle></ulink> 中可以找到有关身份验证的更多信息。
   </para>
   <para>
    目标在<guimenu>目标</guimenu>选项卡中定义。使用<guimenu>添加</guimenu>创建新的 iSCSI 目标。第一个对话框会询问有关要导出设备的信息。 </para>
   <variablelist>
    <varlistentry id="bgchy7j">
     <term>目标</term>
     <listitem>
      <para role="intro">目标<guimenu>行有固定语法，如下所示：</guimenu> </para>

<screen>
iqn.yyyy-mm.&lt;reversed domain name&gt;:<replaceable>unique_id</replaceable>
</screen>

      <para>语法始终以 iqn 开头。yyyy-mm 是日期格式（日期为激活此目标的日期）。可在 <ulink url="http://www.ietf.org/rfc/rfc3722.txt"><citetitle>RFC 3722</citetitle></ulink> 中找到有关命名约定的更多信息。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchy7k">
     <term>标识符</term>
     <listitem>
      <para>可自由选择<guimenu>标识符</guimenu>。标识符应跟在某模式之后以使整个系统具有良好的结构。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchy7l">
     <term>LUN</term>
     <listitem>
      <para>可以向目标指派多个 LUN。为此，请在<guimenu>目标</guimenu>选项卡中选择一个目标，然后单击<guimenu>编辑</guimenu>。然后，向某现有目标添加新的 LUN。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchy7m">
     <term>路径</term>
     <listitem>
      <para>添加到块设备的路径，或添加到要导出的文件系统映像的路径。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>下个菜单配置目标的访问限制。配置与发现身份验证的配置非常相似。在此情况下，至少应设置一个进入的身份验证。 </para>
   <para><guimenu>下一步</guimenu>完成新目标配置，并返回到<guimenu>目标</guimenu>选项卡的概述页面。可通过单击<guimenu>完成</guimenu>来激活更改。</para>
   <para>创建目标设备：</para>
   <procedure id="bj5fomq">
    <step id="bj5fomr" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
    </step>
    <step id="bj5foms" performance="required">
     <para>选择<guimenu>网络服务</guimenu><guimenu>iSCSI 目标</guimenu>。</para>
     <para role="intro">YaST 会打开<guimenu>服务</guimenu>选项卡处于选中状态的“iSCSI 目标概述”页。。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="iscsi_target_service_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bj5fomv" performance="required">
     <para>在<guimenu>启动服务</guimenu>区域中，选择以下选项之一：</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara id="bj5fomw">
        <title>引导时：</title>
        <para>在后续服务器重引导时自动启动发起程序服务。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="bj5fomx">
        <title> 手动（默认）：</title>
        <para>手动启动服务。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </step>
    <step id="bj5fomy" performance="required">
     <para>如果要将 iSNS 用于目标广告，请选中 <guimenu>iSNS 访问控制</guimenu>复选框，然后键入 IP 地址。</para>
    </step>
    <step id="bj5fydf" performance="required">
     <para>如果需要，请打开防火墙端口以允许从远程计算机访问此服务器。</para>
     <substeps performance="required">
      <step id="bj5fomz" performance="required">
       <para>选中<guimenu>打开防火墙中的端口</guimenu>复选框。</para>
      </step>
      <step id="bj5fon0" performance="required">
       <para>单击<guimenu>防火墙细节</guimenu>、选中网络接口旁边的复选框以启用它，然后单击<guimenu>确定</guimenu>接受设置，以上操作可以指定要打开端口的网络接口。</para>
      </step>
     </substeps>
    </step>
    <step id="bj5fon1" performance="required">
     <para>如果要求进行身份验证才能连接到在此服务器上设置的目标设备，请选择<guimenu>全局</guimenu>选项卡，取消选择<guimenu>无身份验证</guimenu>以启用身份验证，然后指定进来的和发出的身份验证必需的身份凭证。</para>
     <para role="intro">默认情况下，<guimenu>无身份验证</guimenu>选项处于启用状态。如需更加安全的配置，可以为进来的和/或发出的指定身份验证。还可以将用户名和口令成对添加到<guimenu>进来的身份验证</guimenu>下方的列表中，从而为进来的身份验证指定多组身份凭证。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="iscsi_target_global_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bj5fon2" performance="required">
     <para>配置 iSCSI 目标设备。</para>
     <substeps performance="required">
      <step id="bj5fon3" performance="required">
       <para>选择<guimenu>目标</guimenu>选项卡。</para>
      </step>
      <step id="bj5fzxo" performance="required">
       <para>如果未执行此操作，请从列表中选择并删除示例 iSCSI 目标，然后单击<guimenu>继续</guimenu>确认删除。</para>
      </step>
      <step id="bj5fon4" performance="required">
       <para>单击<guimenu>添加</guimenu>可添加新的 iSCSI 目标。</para>
       <para>iSCSI 目标会自动显示未格式化分区或块设备并完成“目标”和“标识符”字段。 </para>
      </step>
      <step id="bj5g2b7" performance="required">
       <para>可以接受此空间，或浏览以选择其他空间。 </para>
       <para>还可以分割空间并通过单击<guimenu>添加</guimenu>且指定要分配给 LUN 的扇区来在设备上创建 LUN。如果需要查看这些 LUN 的更多选项，请选择<guimenu>专家设置</guimenu>。</para>
      </step>
      <step id="bj5g2n0" performance="required">
       <para>单击<guimenu>下一步</guimenu></para>
      </step>
      <step id="bj5g45h" performance="required">
       <para>对要创建的每个 iSCSI 目标设备重复<xref linkend="bj5fon4" xrefstyle="StepXRef"/>到<xref linkend="bj5g2n0" xrefstyle="StepXRef"/>。</para>
      </step>
      <step id="bojud2n" performance="required">
       <para>（可选）在<guimenu>服务</guimenu>选项卡上，单击<guimenu>保存</guimenu>以将已配置的 iSCSI 目标的信息导出到文件。</para>
       <para>这使得稍后向资源使用方提供此信息变得更容易。</para>
      </step>
      <step id="bj5fon5" performance="required">
       <para>单击<guimenu>完成</guimenu>创建设备，然后单击<guimenu>是</guimenu>重启动 iSCSI 软件堆栈。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec_inst_system_iscsi_target_manual">
   <title>手动配置 iSCSI 目标</title>
   <para>在 <filename>/etc/ietd.conf</filename> 中配置 iSCSI 目标。此文件中第一个<emphasis>目标</emphasis>声明之前的所有参数对于文件来说是全局的。此部分的身份验证信息有特殊的意义－它不是全局的，但是可用于发现 iSCSI 目标。 </para>
   <para>如果可以访问一个 iSNS 服务器，应先配置该文件来向目标告知该服务器的情况。iSNS 服务器的地址必须始终用 IP 地址给出。不能指定该服务器的 DNS 名。此功能的配置类似如下所示： </para>

<screen>
iSNSServer 192.168.1.111
iSNSAccessControl no
</screen>

   <para>此配置使得 iSCSI 目标可在 <literal>iSNS</literal> 服务器中自我注册，后者提供对发起程序的发现。有关 iSNS 的更多信息，请参见<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>。不支持 iSNS 发现的访问控制。仅保留 <literal>iSNSAccessControl no</literal>。 </para>
   <para>所有直接 iSCSI 身份验证都可双向进行。iSCSI 目标可要求 iSCSI 发起程序使用 <option>IncomingUser</option> 来身份验证，可添加多次。iSCSI 发起程序还可要求 iSCSI 目标进行身份验证。在此情况下请使用 <option>OutgoingUser</option>。这两个方向的语法相同： </para>

<screen>
IncomingUser &lt;username&gt; &lt;password&gt;
OutgoingUser &lt;username&gt; &lt;password&gt;
</screen>

   <para>身份验证后跟一个或多个目标定义。为每个目标添加 <literal>Target</literal> 部分。此部分总是以 <literal>Target</literal> 标识符开头，后跟逻辑单元编号定义： </para>

<screen>
Target iqn.yyyy-mm.&lt;reversed domain name&gt;[:identifier]
          Lun 0 Path=/dev/mapper/system-v3
          Lun 1 Path=/dev/hda4
          Lun 2 Path=/var/lib/xen/images/xen-1,Type=fileio
</screen>

   <para>在 <literal>Target</literal> 行中，<literal>yyyy-mm</literal> 是激活此目标的日期，并可自由选择 <literal>identifier</literal>。可在 <ulink url="http://www.ietf.org/rfc/rfc3722.txt"><citetitle>RFC 3722</citetitle></ulink> 中找到有关命名约定的更多信息。在此示例中导出了三个不同的块设备。第一个块设备是逻辑卷（另见<xref linkend="lvm" xrefstyle="ChapTitleOnPage"/>），第二个块设备是 IDE 分区，第三个设备是可在逻辑文件系统中获得的映像。对 iSCSI 发起程序来说，所有这三个块设备是相同的。 </para>
   <para>激活 iSCSI 目标之前，请在 <option>Lun</option> 定义后至少添加一个 <option>IncomingUser</option>。此操作身份验证此目标的使用。 </para>
   <para>要激活所有更改，可使用 <command>rcopen-iscsi <option>restart</option></command> 重启动 iscsitarget 守护程序。在 <filename>/proc</filename> 文件系统中检查配置： </para>

<screen>
cat /proc/net/iet/volume
tid:1 name:iqn.2006-02.com.example.iserv:systems
        lun:0 state:0 iotype:fileio path:/dev/mapper/system-v3
        lun:1 state:0 iotype:fileio path:/dev/hda4
        lun:2 state:0 iotype:fileio path:/var/lib/xen/images/xen-1
</screen>

   <para>还有一些选项可控制 iSCSI 目标的行为。有关更多信息，请参见 <filename>ietd.conf</filename> 的手册页。 </para>
   <para><filename>/proc</filename> 文件系统中还会显示活动会话。对于每个连接的发起程序，会向 <filename>/proc/net/iet/session</filename> 额外添加一个项： </para>

<screen>
cat /proc/net/iet/session
tid:1 name:iqn.2006-02.com.example.iserv:system-v3
   sid:562949957419520 initiator:iqn.2005-11.de.suse:cn=rome.example.com,01.9ff842f5645
      cid:0 ip:192.168.178.42 state:active hd:none dd:none
   sid:281474980708864 initiator:iqn.2006-02.de.suse:01.6f7259c88b70
      cid:0 ip:192.168.178.72 state:active hd:none dd:none
</screen>

  </sect2>
  <sect2 id="sec_inst_system_iscsi_target_ietadm">
   <title>通过 ietadm 配置联机目标</title>
   <para>当必须更改 iSCSI 目标配置时，必须始终重启动目标以激活配置文件中所作的更改。不幸的是，在此过程中将中断所有活动会话。要使操作不受干扰，应在主配置文件 <filename>/etc/ietd.conf</filename> 中执行更改，但是还要通过管理实用程序 ietadm 来手动更改当前配置。 </para>
   <para>要通过 LUN 创建新 iSCSI 目标，请首先更新配置文件。以下是附加项： </para>

<screen>
Target iqn.2006-02.com.example.iserv:system2
          Lun 0 Path=/dev/mapper/system-swap2
          IncomingUser joe secret
</screen>

   <para>要手动设置此配置，请如下继续操作： </para>
   <procedure id="bgchy7n">
    <step id="bgchy7o" performance="required">
     <para>使用命令 <command>ietadm --op new --tid=2 --params Name=iqn.2006-02.com.example.iserv:system2</command> 创建新目标。 </para>
    </step>
    <step id="bgchy7p" performance="required">
     <para>使用 <command>ietadm --op new --tid=2 --lun=0 --params Path=/dev/mapper/system-swap2</command> 添加逻辑单元。 </para>
    </step>
    <step id="bgchy7q" performance="required">
     <para>使用 <command>ietadm --op new --tid=2 --user --params=IncomingUser=joe,Password=secret</command> 设置此目标上的用户名和口令组合。 </para>
    </step>
    <step id="bgchy7r" performance="required">
     <para>使用 <command>cat /proc/net/iet/volume</command> 检查配置。 </para>
    </step>
   </procedure>
   <para>还可以删除活动连接。首先，使用命令 <command>cat /proc/net/iet/session</command> 检查所有活动连接。此操作可能如下所示： </para>

<screen>
cat /proc/net/iet/session
tid:1 name:iqn.2006-03.com.example.iserv:system
        sid:281474980708864 initiator:iqn.1996-04.com.example:01.82725735af5
                cid:0 ip:192.168.178.72 state:active hd:none dd:none
</screen>

   <para>要删除会话 ID 为 281474980708864 的会话，请使用命令 <command>ietadm --op delete --tid=1 --sid=281474980708864 --cid=0</command>。请注意：此操作会导致在客户端系统上无法访问设备并且访问此设备的进程可能会挂起。 </para>
   <para>ietadm 还可用来更改各种配置参数。使用 <command>ietadm --op show --tid=1 --sid=0</command> 获取全局变量列表。输出将如下所示： </para>

<screen>
InitialR2T=Yes
ImmediateData=Yes
MaxConnections=1
MaxRecvDataSegmentLength=8192
MaxXmitDataSegmentLength=8192
MaxBurstLength=262144
FirstBurstLength=65536
DefaultTime2Wait=2
DefaultTime2Retain=20
MaxOutstandingR2T=1
DataPDUInOrder=Yes
DataSequenceInOrder=Yes
ErrorRecoveryLevel=0
HeaderDigest=None
DataDigest=None
OFMarker=No
IFMarker=No
OFMarkInt=Reject
IFMarkInt=Reject
</screen>

   <para>所有这些参数均可轻松更改。例如，如果要将最大连接数更改为两个，请使用</para>

<screen>
ietadm --op update --tid=1 --params=MaxConnections=2. 
</screen>

   <para>在文件 <filename>/etc/ietd.conf</filename> 中，关联行应类似于 <option>MaxConnections 2</option>。 </para>
   <warning>
    <para>使用命令 <command>ietadm</command> 实用程序所作的更改对系统来说并不是永久的。如果未将更改添加到 <filename>/etc/ietd.conf</filename> 配置文件中，则下次重引导时将丢失这些更改。根据网络中 iSCSI 的使用情况，此操作可能会导致严重的问题。 </para>
   </warning>
   <para><command>ietadm</command> 实用程序还有多个选项。使用 <command>ietadm -h</command> 查找概述。该处的缩写为目标 ID（tid）、会话 ID（sid）和连接 ID（cid）。还可在 <filename>/proc/net/iet/session</filename> 中找到这些缩写。 </para>
  </sect2>
 </sect1>
 <sect1 id="sec_inst_system_iscsi_initiator">
  <title>配置 iSCSI 发起程序</title>
  <para>iSCSI 发起程序也称为 iSCSI 客户端，可用来连接到任意 iSCSI 目标。连接不限于<xref linkend="sec_inst_system_iscsi_target" xrefstyle="SectTitleOnPage"/>说明的 iSCSI 目标解决方案。iSCSI 发起程序配置包括两个主要步骤 － 发现可用 iSCSI 目标和设置 iSCSI 会话。这两个步骤都可通过 YaST 完成。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="sec_inst_system_iscsi_initiator_yast" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_inst_system_iscsi_initiator_manual" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec_iscsi_database" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="sec_inst_system_iscsi_initiator_yast">
   <title>使用 YaST 执行 iSCSI 发起程序配置</title>
   <para>在 YaST 中，“iSCSI 发起程序概述”包括三个选项卡：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <formalpara id="bkob6lr">
      <title>服务：</title>
      <para>可使用<guimenu>服务</guimenu>选项卡来在引导时启用 iSCSI 发起程序。它还允许设置唯一的<guimenu>发起程序名称</guimenu>和 iSNS 服务器以用于发现。iSNS 的默认端口为 3205。 </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara id="bkob6ls">
      <title>已连接目标：</title>
      <para><guimenu>已连接目标</guimenu>选项卡概述了当前已连接的 iSCSI 目标。与<guimenu>已发现目标</guimenu>选项卡类似，它还提供用于向系统添加新目标的选项。 </para>
     </formalpara>
     <para>在此页上，可以选择目标设备，然后切换每个 iSCSI 目标设备的启动设置：</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara id="bkob6lt">
        <title>自动：</title>
        <para>此选项用于 iSCSI 服务本身启动时要连接的 iSCSI 目标。这是典型配置。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="bkob6lu">
        <title>引导时：</title>
        <para>此选项用于引导期间要连接的 iSCSI 目标；即，当根目录 (<filename>/</filename>) 位于 iSCSI 上时。这样，iSCSI 目标设备在服务器引导时将从 initrd 进行评估。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </listitem>
    <listitem>
     <formalpara id="bkob6lv">
      <title>已发现目标：</title>
      <para><guimenu>已发现目标</guimenu>使您能够手动发现网络中的 iSCSI 目标。 </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bkob990" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkobick" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkob8pj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkob9pj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bkob990">
    <title>配置 iSCSI 发起程序</title>
    <procedure id="bj5fon6">
     <step id="bj5fon7" performance="required">
      <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
     </step>
     <step id="bj5fon8" performance="required">
      <para>选择<guimenu>网络服务</guimenu><guimenu>iSCSI 发起程序</guimenu>（也可以使用 <command>yast2 iscsi-client</command>）。</para>
      <para role="intro">YaST 会打开<guimenu>服务</guimenu>选项卡处于选中状态的“iSCSI 发起程序概述”页。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="iscsi_init_service_a.png" width="307pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="bj5fonb" performance="required">
      <para>在<guimenu>启动服务</guimenu>区域中，选择以下选项之一：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="bj5fonc">
         <title>引导时：</title>
         <para>在后续服务器重引导时自动启动发起程序服务。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="bj5fond">
         <title> 手动（默认）：</title>
         <para>手动启动服务。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step id="bj5fone" performance="required">
      <para>指定或校验<guimenu>发起程序名称</guimenu>。</para>
      <para>为此服务器上的 iSCSI 发起程序指定格式正确的 iSCSI 限定名称 (IQN)。此发起程序名称在网络上必须具有全局唯一性。IQN 使用以下常规格式：</para>

<screen>
iqn.yyyy-mm.com.mycompany:n1:n2
</screen>

      <para>其中，n1 和 n2 是字母数字字符。例如：</para>

<screen>
iqn.1996-04.de.suse:01:9c83a3e15f64
</screen>

      <para><guimenu>发起程序名称</guimenu>将用服务器上文件 <filename>/etc/iscsi/initiatorname.iscsi</filename> 中的相应值自动填充。</para>
      <para>
       如果服务器提供 iBFT (iSCSI Boot Firmware Table) 支持，则<guimenu>发起程序名称</guimenu>将用 IBFT 中的相应值填充，并且您不能在此界面中更改发起程序名称。应使用 BIOS 设置来修改它。iBFT 是指包含各种对 iSCSI 引导进程有用的参数的信息块，包括服务器的 iSCSI 目标与发起程序描述。</para>
     </step>
     <step id="bj5fonf" performance="required">
      <para>使用以下方法之一发现网络上的 iSCSI 目标。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="bj5fong">
         <title>iSNS：</title>
         <para>要使用 iSNS (Internet Storage Name Service) 来发现 iSCSI 目标，请按<xref linkend="bkobick" xrefstyle="HeadingOnPage"/>中所述继续操作。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="bj5fonh">
         <title>已发现目标：</title>
         <para>要手动发现 iSCSI 目标设备，请按<xref linkend="bkob8pj" xrefstyle="HeadingOnPage"/>中所述继续操作。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bkobick">
    <title>使用 iSNS 发现 iSCSI 目标</title>
    <para>必须在环境中已安装并配置 iSNS 服务器后，才能使用此选项。有关信息，请参见<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>。</para>
    <procedure id="bkobiky">
     <step id="bkobikz" performance="required">
      <para>在 YaST 中，选择<guimenu> iSCSI 发起程序</guimenu>，然后选择<guimenu>服务</guimenu>选项卡。 </para>
     </step>
     <step id="bkobjno" performance="required">
      <para>指定 iSNS 服务器的 IP 地址和端口。 </para>
      <para>默认端口为 3205。</para>
     </step>
     <step id="bkobl8n" performance="required">
      <para>在“iSCSI 发起程序概述”页上，单击<guimenu>完成</guimenu>以保存并应用更改。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bkob8pj">
    <title>手动发现 iSCSI 目标</title>
    <para>对要从已设置 iSCSI 发起程序的服务器访问的每个 iSCSI 目标服务器重复以下过程。</para>
    <procedure id="bgchy7s">
     <step id="bgchy7t" performance="required">
      <para>在 YaST 中，选择<guimenu> iSCSI 发起程序</guimenu>，然后选择<guimenu>已发现目标</guimenu>选项卡。 </para>
     </step>
     <step id="bkobfda" performance="required">
      <para>单击<guimenu>发现</guimenu>打开“iSCSI 发起程序发现”对话框。 </para>
     </step>
     <step id="bgchy7u" performance="required">
      <para>输入 IP 地址并根据需要更改端口。系统支持 IPv6 地址。</para>
      <para>默认端口为 3260。</para>
     </step>
     <step id="bgchy7v" performance="required">
      <para>如果要求进行身份验证，请取消选择<guimenu>无身份验证</guimenu>，然后指定<guimenu>进来的</guimenu>或<guimenu>发出的</guimenu>身份验证。 </para>
     </step>
     <step id="bgchy7w" performance="required">
      <para>单击<guimenu>下一步</guimenu>启动发现并连接到 iSCSI 目标服务器。</para>
     </step>
     <step id="bi728ck" performance="required">
      <para>如果要求提供身份凭证，在成功发现后，请使用<guimenu>登录</guimenu>激活目标。 </para>
      <para>系统会提示您输入身份验证凭证以使用所选 iSCSI 目标。 </para>
     </step>
     <step id="bi727ln" performance="required">
      <para>单击<guimenu>下一步</guimenu>完成配置。 </para>
      <para>如果操作一切顺利，则目标将会显示在<guimenu>已连接目标</guimenu>中。 </para>
      <para>虚拟 iSCSI 设备现在为可用。 </para>
     </step>
     <step id="bkobeht" performance="required">
      <para>在“iSCSI 发起程序概述”页上，单击<guimenu>完成</guimenu>以保存和应用更改。</para>
     </step>
     <step id="bi728cl" performance="required">
      <para>使用命令 <command>lsscsi</command> 可以找到 iSCSI 目标设备的本地设备路径：</para>

<screen>
lsscsi
[1:0:0:0]   disk    IET      VIRTUAL-DISK     0     /dev/sda
</screen>

     </step>
    </procedure>
   </sect3>
   <sect3 id="bkob9pj">
    <title>为 iSCSI 目标设备设置启动自选设置</title>
    <procedure id="bkobg1r">
     <step id="bkobg1s" performance="required">
      <para>在 YaST 中，选择<guimenu> iSCSI 发起程序</guimenu>，然后选择<guimenu>已连接目标</guimenu>选项卡以查看当前连接到服务器的 iSCSI 目标设备的列表。 </para>
     </step>
     <step id="bkobg1t" performance="required">
      <para>选择要管理的 iSCSI 目标设备。 </para>
     </step>
     <step id="bkobg1u" performance="required">
      <para>单击<guimenu>切换启动</guimenu>修改设置：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="bkobg1v">
         <title>自动：</title>
         <para>此选项用于 iSCSI 服务本身启动时要连接的 iSCSI 目标。这是典型配置。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="bkobg1w">
         <title>引导时：</title>
         <para>此选项用于引导期间要连接的 iSCSI 目标；即，当根目录 (<filename>/</filename>) 位于 iSCSI 上时。这样，iSCSI 目标设备在服务器引导时将从 initrd 进行评估。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step id="bkobg1x" performance="required">
      <para>单击<guimenu>完成</guimenu>保存并应用更改。 </para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="sec_inst_system_iscsi_initiator_manual">
   <title>手动设置 iSCSI 发起程序</title>
   <para>发现和配置 iSCSI 连接都要求 iscsid 正在运行。首次运行发现时，将在 <filename>/var/lib/open-iscsi</filename> 目录中创建 iSCSI 发起程序的内部数据库。 </para>
   <para>如果发现受口令保护，则向 iscsid 提供身份验证信息。由于首次执行发现时内部数据库并不存在，因而因此将无法使用内部数据库。相反，必须编辑配置文件 <filename>/etc/iscsid.conf</filename> 以提供信息。要为发现添加口令信息，请在 <filename>/etc/iscsid.conf</filename> 末尾添加以下行： </para>

<screen>
discovery.sendtargets.auth.authmethod = CHAP
discovery.sendtargets.auth.username = &lt;username&gt;
discovery.sendtargets.auth.password = &lt;password&gt;
</screen>

   <para>发现会将所有接收到的值储存在一个内部持久数据库中。此外，它会显示所有检测到的目标。使用以下命令运行此发现：</para>

<screen>
iscsiadm <option>-m discovery --type=st --portal=&lt;targetip&gt;</option>
</screen>

   <para>输出如下所示： </para>

<screen>
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems
</screen>

   <para>要在 <literal>iSNS</literal> 服务器上发现可用目标，请使用下列命令：</para>

<screen>
iscsiadm --mode discovery --type isns --portal &lt;targetip&gt; 
</screen>

   <para>对于 iSCSI 目标上定义的每个目标，将显示一行。有关储存数据的更多信息，请参见<xref linkend="sec_iscsi_database" xrefstyle="SectTitleOnPage"/>。 </para>
   <para><option>iscsiadm</option> 的特殊 <command> --login</command> 选项会创建所有需要的设备： </para>

<screen>
iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems --login
</screen>

   <para>新生成的设备会显示在 <command>lsscsi</command> 的输出中，并且现在可以通过 mount 访问这些设备。 </para>
  </sect2>
  <sect2 id="sec_iscsi_database">
   <title>iSCSI 客户端数据库</title>
   <para>iSCSI 发起程序发现的所有信息都储存在位于 <filename>/var/lib/open-iscsi</filename> 的两个数据库文件中。一个数据库用于发现的目标，另一个数据库用于发现的节点。访问数据库时，首先必须选择是希望从发现获取数据还是从节点数据库获取数据。可使用 <command>iscsiadm</command> 的参数 <option>-m discovery</option> 和 <option>-m node</option> 来执行此操作。仅将 <command>iscsiadm</command> 与其中一个参数一起使用可提供储存记录概述： </para>

<screen>
iscsiadm -m discovery
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems
</screen>

   <para>本示例中的目标名称为 <literal>iqn.2006-02.com.example.iserv:systems</literal>。与此特殊数据集相关的所有操作都需要此名称。要检查 ID 为 <literal>iqn.2006-02.com.example.iserv:systems</literal> 数据记录的内容，可使用以下命令： </para>

<screen>
iscsiadm -m node --targetname iqn.2006-02.com.example.iserv:systems
node.name = iqn.2006-02.com.example.iserv:systems
node.transport_name = tcp
node.tpgt = 1
node.active_conn = 1
node.startup = manual
node.session.initial_cmdsn = 0
node.session.reopen_max = 32
node.session.auth.authmethod = CHAP
node.session.auth.username = joe
node.session.auth.password = ********
node.session.auth.username_in = &lt;empty&gt;
node.session.auth.password_in = &lt;empty&gt;
node.session.timeo.replacement_timeout = 0
node.session.err_timeo.abort_timeout = 10
node.session.err_timeo.reset_timeout = 30
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
....
</screen>

   <para>要编辑这些变量的值，可将 <command>iscsiadm</command> 与<option>更新</option>操作一起使用。例如，如果希望 iscsid 在初始化时登录 iSCSI 目标，则将变量 <option>node.startup</option> 的值设置为 <option>automatic</option>： </para>

<screen role="compact2">
iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems -p ip:port --op=update --name=node.startup --value=automatic
</screen>

   <para>使用 <literal>delete</literal> 操作删除旧的数据集 如果目标 <literal>iqn.2006-02.com.example.iserv:systems</literal> 不再是有效记录，请使用以下命令删除该记录：</para>

<screen>
<command>iscsiadm <option>-m node -n iqn.2006-02.com.example.iserv:systems -p ip:port --op=delete</option></command>
</screen>

   <important>
    <para>使用此选项时应谨慎，因为它会删除该记录而无任何附加确认提示。 </para>
   </important>
   <para>要获取所有已发现目标的列表，请运行 <command>iscsiadm -m node</command> 命令。</para>
  </sect2>
 </sect1>
 <sect1 id="bwkrqdd">
  <title>安装时使用 iSCSI 磁盘</title>
  <para>当使用启用 iSCSI 的固件时，支持从 i386、x86_64 和 ppc64 体系结构上的 iSCSI 磁盘引导。 </para>
  <para>要在安装过程中使用 iSCSI 磁盘，必须将以下参数添加到引导选项行： </para>

<screen>
withiscsi=1
</screen>

  <para>安装过程中会额外显示一个屏幕，让您可以将 iSCSI 磁盘连接到系统，并在安装过程中加以使用。</para>
 </sect1>
 <sect1 id="sec_inst_system_iscsi_ts">
  <title>iSCSI 查错</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="nofail" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bp5cdib" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bpjp8x0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7p6z" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="nofail">
   <title>热插拔对装入 iSCSI 目标不起作用。</title>
   <para>在 SLES 10 中，您可以在 <filename>/etc/fstab</filename> 文件中为设备添加 <literal>hotplug</literal> 选项，以装入 iSCSI 目标。例如：</para>

<screen>
/dev/disk/by-uuid-blah /oracle/db   ext3       hotplug,rw            0 2
</screen>

   <para>在 SLES 11 中，<literal>hotplug</literal> 选项不再起作用。请改用 <literal>nofail</literal> 选项。例如：</para>

<screen>
/dev/sdb1   /mnt/mountpoint   ext3   acl,user,nofail   0 0
</screen>

   <para>有关信息，请参见 <ulink url="http://www.novell.com/support/php/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=7004427"><citetitle>TID 7004427：/etc/fstab 项不在引导时装入 iSCSI 设备</citetitle></ulink>。</para>
  </sect2>
  <sect2 id="bp5cdib">
   <title>丢弃 iSCSI 通讯的数据包</title>
   <para>如果防火墙很忙，可能会丢弃包。SUSE 防火墙默认为三分钟后丢弃包。如果您发现防火墙正在丢弃 iSCSI 通讯包，可以考虑将 SUSE 防火墙配置为对包排队，而不是太忙时丢弃包。 </para>
  </sect2>
  <sect2 id="bpjp8x0">
   <title>将 iSCSI 卷用于 LVM</title>
   <para>在 iSCSI 目标上使用 LVM 时，请使用本部分的查错提示。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bpkq3ci" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bpkpzuj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bpkq3ci">
    <title>检查 iSCSI 发起程序在引导时能否被发现</title>
    <para>设置 iSCSI 发起程序时，确保引导时启用发现，以便 udev 在引导时可以发现 iSCSI 设备，并设置可供 LVM 使用的设备。</para>
   </sect3>
   <sect3 id="bpkpzuj">
    <title>检查 iSCSI 目标在引导时能否被发现</title>
    <para>请记住，SLES 11 中的 <filename>udev</filename> 能为设备提供默认设置。确保创建设备的所有应用程序都具有在引导时运行的运行级别设置，以便 <command>udev</command> 在系统启动时能识别设备并为它们指派设备。如果应用程序或服务在稍后才启动，则 <command>udev</command> 不会像在引导时那样自动创建设备。 </para>
    <para>您可以在 <guimenu>YaST</guimenu> 中转至<guimenu>系统</guimenu><guimenu>系统服务（运行级别）</guimenu><guimenu>专家方式</guimenu>，检查 LVM2 和 iSCSI 的运行级别设置。引导 (B) 时应该启用以下服务：</para>
    <simplelist>
     <member>boot.lvm</member> <member>boot.open-iscsi</member> <member>open-iscsi</member>
    </simplelist>
   </sect3>
  </sect2>
  <sect2 id="bwk7p6z">
   <title>配置文件设置为手动时，会装入 iSCSI 目标</title>
   <para>即使 <filename>/etc/iscsi/iscsid.conf</filename> 文件中的 <literal>node.startup</literal> 选项设置为手动（如果手动修改了此配置文件），Open-iSCSI 在启动时也可以装入目标。</para>
   <para>检查 <filename>/etc/iscsi/nodes/&lt;<replaceable>目标名称</replaceable>&gt;/&lt;<replaceable>IP 地址</replaceable>,<replaceable>端口</replaceable>&gt;/default</filename> 文件。它包含覆盖 <filename>/etc/iscsi/iscsid.conf</filename> 文件的 <literal>node.startup</literal> 设置。使用 YaST 界面将装入选项设置为手动也会在 <filename>/etc/iscsi/nodes/&lt;<replaceable>目标名称</replaceable>&gt;/&lt;<replaceable>IP 地址</replaceable>,<replaceable>端口</replaceable>&gt;/default</filename> 文件中设置 <literal>node.startup = manual</literal>。</para>
  </sect2>
 </sect1>
 <sect1 id="sec_inst_system_iscsi_initiator_info">
  <title>其他信息</title>
  <para>iSCSI 协议已面世多年。有许多评论和其他文档将 iSCSI 与 SAN 解决方案作比较，通常是比较性能基准，或只说明硬件解决方案。有关 open-iscsi 的更多信息，请参见以下重要页面： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="http://www.open-iscsi.org/"><citetitle>Open-iSCSI 项目</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://www.novell.com/coolsolutions/appnote/15394.html"><citetitle>AppNote：Open Enterprise Server Linux 群集上使用 iSCSI 的 iFolder</citetitle></ulink></para>
   </listitem>
  </itemizedlist>
  <para>还有一些联机文档。请参见 <command>iscsiadm</command>、<command>iscsid</command>、<filename>ietd.conf</filename> 和 <command>ietd</command> 的手册页，以及示例配置文件 <filename>/etc/iscsid.conf</filename>。 </para>
 </sect1>
</chapter>

<chapter id="cha_iscsi_lio" lang="en" xml:base="06_iscsi_lio.xml">
 <title>经由 IP 网络的大容量储存：iSCSI LIO 目标服务器</title>
 <para>LIO (linux-iscsi.org) 是 Linux 适用的标准开源多协议 SCSI 目标。LIO 以 Linux 内核 2.6.38 及更高版本替代 STGT（SCSI 目标）框架成为 Linux 中的标准统一储存目标。在 SUSE Linux Enterprise Server 11 SP3 及更高版本中，YaST 支持 iSCSI LIO 目标服务器软件。 </para>
 <para>本章说明如何使用 YaST 配置 iSCSI LIO 目标服务器以及如何设置 iSCSI LIO 目标设备。您可以使用任何 iSCSI 发起程序访问目标设备。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sect_iscsi_lio_install" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect_iscsi_lio_service" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect_iscsi_lio_discovery" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect_iscsi_lio_storage" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect_iscsi_lio_targetgp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect_iscsi_lio_edit" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect_iscsi_lio_delete" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13g8i2g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12iqi8o" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sect_iscsi_lio_install">
  <title>安装 iSCSI LIO 目标服务器软件</title>
  <para>使用 YaST 软件管理工具，将 iSCSI LIO 目标服务器软件安装到想要创建 iSCSI LIO 目标设备的 SUSE Linux Enterprise Server 11 SP3 服务器上。</para>
  <procedure id="b12jepdi">
   <step id="b12jepdj" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="b12jepdk" performance="required">
    <para>选择<guimenu>软件</guimenu><guimenu>软件管理。</guimenu></para>
   </step>
   <step id="b12jepdl" performance="required">
    <para>选择<guimenu>搜索</guimenu>选项卡，键入 <literal>lio</literal>，然后单击<guimenu>搜索</guimenu>。</para>
   </step>
   <step id="b12jepdm" performance="required">
    <para>选择 iSCSI LIO 目标服务器包：</para>
    <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="4091*"/>
     <colspec colnum="2" colname="2" colwidth="5912*"/>
      <thead>
       <row id="b12gs3f1">
        <entry>
         <para>iSCSI LIO 目标服务器包</para>
        </entry>
        <entry>
         <para>描述</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="b12gs3f2">
        <entry>
         <para><filename>yast2-iscsi-lio-server</filename></para>
        </entry>
        <entry>
         <para>在 YaST 中提供 GUI 界面，以供配置 iSCSI LIO 目标设备之用。</para>
        </entry>
       </row>
       <row id="b12gs3f3">
        <entry>
         <para><filename>lio-utils</filename></para>
        </entry>
        <entry>
         <para>提供 <filename>yast2-iscsi-lio-server</filename> 用于配置和控制 iSCSI LIO 目标设备的 API。</para>
        </entry>
       </row>
       <row id="b12gs3f4">
        <entry>
         <para><filename>lio-mibs</filename></para>
        </entry>
        <entry>
         <para>提供 SNMP（简单网络管理协议），通过使用 Net-SNMP 代理的动态装载模块 (<filename>dlmod</filename>) 功能监视 iSCSI LIO 目标设备。它支持 SNMP v1、v2c 和 v3。配置文件是 <filename>/etc/snmp/snmpd.conf</filename>。</para>
         <para><filename>lio-mibs</filename> 软件使用 <filename>perl-SNMP</filename> 和 <filename>net-snmp</filename> 包。</para>
         <para>有关 Net-SNMP 的信息，请参见开源 <ulink url="http://www.net-snmp.org/">Net-SNMP 项目</ulink>。</para>
        </entry>
       </row>
       <row id="b12gs3f5">
        <entry>
         <para><filename>lio</filename>-utils-debuginfo</para>
        </entry>
        <entry>
         <para>提供 <filename>lio-utils</filename> 包的调试信息。在开发或调试 <filename>lio-utils</filename> 应用程序时您可以使用此软件包。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="b12r0abb" performance="required">
    <para>单击对话框右下角的<guimenu>接受</guimenu>，以安装选中的软件包。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_install_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jepdn" performance="required">
    <para role="intro">当系统提示您确认自动更改时，单击<guimenu>继续</guimenu>以接受 iSCSI LIO 目标服务器对 <filename>lio-utils</filename>、<filename>perl-SNMP</filename> 以及 <filename>net-snmp</filename> 包的依赖性。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_install_changes_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jepdo" performance="required">
    <para role="intro">关闭并重启 YaST，然后单击<guimenu>网络服务</guimenu>并确认 <guimenu>iSCSI LIO 目标</guimenu>选项在菜单中是否可用。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast_option_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jepdp" performance="required">
    <para>继续<xref linkend="sect_iscsi_lio_service" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect_iscsi_lio_service">
  <title>启动 iSCSI LIO 目标服务</title>
  <para>iSCSI LIO 目标服务默认配置为手动启动。您可以配置该服务，使其在系统重启动时自动启动。如果服务器上使用防火墙，并且您想让 iSCSI LIO 目标对其他计算机可用，则必须为想要用于目标访问的每一个适配器打开防火墙中的端口。TCP 端口 3260 是 IANA（因特网号码分配机构）所定义的 iSCSI 协议的端口号。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jbaln" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jbalo" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12jbbfh">
   <title>配置 iSCSI LIO 启动自选设置</title>
   <para>配置 iSCSI LIO 目标服务器的服务设置：</para>
   <procedure id="b12jauce">
    <step id="b13n0ujo" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份登录到 iSCSI LIO 目标服务器，然后启动终端控制台。</para>
    </step>
    <step id="b13n0ujp" performance="required">
     <para>确保 <filename>/etc/init.d/target</filename> 守护程序在运行中。在命令提示符处输入</para>

<screen>
/etc/init.d/target start
</screen>

     <para>命令会返回一条消息确认守护程序已启动，或守护程序已经在运行。</para>
    </step>
    <step id="b12jaucf" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
    </step>
    <step id="b12jaucg" performance="required">
     <para>在 YaST 控制中心，选择<guimenu>网络服务</guimenu>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
     <para>您也可以搜索 <quote>lio</quote>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jauch" performance="required">
     <para role="intro">在“iSCSI LIO 目标概述”对话框中，选择<guimenu>服务</guimenu>选项卡。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_service_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jauci" performance="required">
     <para role="intro">在<guimenu>服务启动</guimenu>下，指定 iSCSI LIO 目标服务的启动方式： </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara id="b12jaucj">
        <title>引导时：</title>
        <para>服务器重启动时自动启动服务。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b12jauck">
        <title>手动：</title>
        <para>（默认）您必须在服务器重启动后手动启动服务。只有启动服务后才可以使用目标设备。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </step>
    <step id="b12jaucl" performance="required">
     <para>如果服务器上使用防火墙，并且您想让 iSCSI LIO 目标对其他计算机可用，则要为想要用于目标访问的每一个适配器接口打开防火墙中的端口。 </para>
     <para>默认情况下禁用防火墙设置。除非在服务器上部署了防火墙，否则无需设置。默认端口号是 3260。如果端口对于所有网络接口均为关闭，则其他计算机将无法使用 iSCSI LIO 目标。</para>
     <substeps performance="required">
      <step id="b12jaucm" performance="required">
       <para>在<guimenu>服务</guimenu>选项卡上，选中<guimenu>打开防火墙中的端口</guimenu>复选框，以启用防火墙设置。</para>
      </step>
      <step id="b12jaucn" performance="required">
       <para>单击<guimenu>防火墙细节</guimenu>，查看或配置要使用的网络接口。</para>
       <para>列出所有可用的网络接口，并且默认全部选中。</para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="lio_firewall_ports_a.png" width="250pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12jauco" performance="required">
       <para>对于每个接口，指定是打开还是关闭它的端口：</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <formalpara id="b12jaucp">
          <title>打开：</title>
          <para>选中接口的复选框，以打开其端口。您也可以单击<guimenu>全选</guimenu>，以打开所有接口上的端口。 </para>
         </formalpara>
        </listitem>
        <listitem>
         <formalpara id="b12jaucq">
          <title>关闭：</title>
          <para>取消选中接口的复选框，以关闭其端口。您也可以单击<guimenu>全部不选</guimenu>，以关闭所有接口上的端口。 </para>
         </formalpara>
        </listitem>
       </itemizedlist>
      </step>
      <step id="b12jaucr" performance="required">
       <para>单击<guimenu>确定</guimenu>保存并应用更改。 </para>
      </step>
      <step id="b12r0it6" performance="required">
       <para>如果系统提示确认设置，请单击<guimenu>是</guimenu>可继续操作，或单击<guimenu>否</guimenu>可返回到对话框进行所需的更改。</para>
      </step>
     </substeps>
    </step>
    <step id="b12jb97x" performance="required">
     <para>单击<guimenu>完成</guimenu>，以保存和应用 iSCSI LIO 目标服务设置。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b12jbaln">
   <title>在命令行手动启动 iSCSI LIO 目标</title>
   <procedure id="b12gboje">
    <step id="b13n0ujq" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份登录，然后启动终端控制台。</para>
    </step>
    <step id="b13n0ujr" performance="required">
     <para>在命令提示符处输入</para>

<screen>
/etc/init.d/target start
</screen>

     <para>命令会返回一条消息确认守护程序已启动，或守护程序已经在运行。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b12jbalo">
   <title>在 YaST 中手动启动 iSCSI LIO 目标</title>
   <procedure id="b12gblm7">
    <step id="b12gblm8" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
    </step>
    <step id="b12gblm9" performance="required">
     <para>在 YaST 控制中心，选择<guimenu>系统</guimenu>，然后再选择<guimenu>系统服务（运行级别）</guimenu>。</para>
    </step>
    <step id="b12gblma" performance="required">
     <para>在“YaST 系统服务”对话框中，选择<guimenu>专家方式</guimenu>，然后再在服务列表中选择<guimenu>目标</guimenu>（<guimenu>TCM/ConfigFS 和 LIO-Target</guimenu>）。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_runlevel_a.png" width="300pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12gbmn5" performance="required">
     <para>选择右下方的<guimenu>启动/停止/刷新</guimenu><guimenu>立即启动</guimenu>。</para>
    </step>
    <step id="b12jbalp" performance="required">
     <para>单击<guimenu>确定</guimenu>。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sect_iscsi_lio_discovery">
  <title>配置 iSCSI LIO 目标和客户端的发现身份验证</title>
  <para>iSCSI LIO 目标服务器软件支持 PPP-CHAP（点对点协议-挑战握手身份验证协议），该协议是<ulink url="http://www.ietf.org/rfc/rfc1994.txt"><citetitle>因特网工程任务组 (IETF) RFC 1994</citetitle></ulink> 中定义的一个三向身份验证方法。iSCSI LIO 目标服务器使用此身份验证方法来发现 iSCSI LIO 目标和客户端，但不用于访问目标上的文件。如果不希望限制对发现的访问，则使用<guimenu>无身份验证</guimenu>。默认情况下，<guimenu>无身份验证</guimenu>选项处于启用状态。如果启用发现身份验证，则其设置将应用到所有 iSCSI LIO 目标组。</para>
  <important>
   <para>建议您在生产环境中使用针对目标和客户端发现的身份验证。</para>
  </important>
  <para>如果是为了更为安全的配置而需要身份验证，则可以使用进来的身份验证、发出的身份验证，或二者皆使用。<guimenu>进来的身份验证</guimenu>要求 iSCSI 发起程序证明其具有在 iSCSI LIO 目标上运行发现的权限。发起程序必须提供进来的用户名和口令。<guimenu>发出的身份验证</guimenu>要求 iSCSI LIO 目标向发起程序证明它是预期的目标。iSCSI LIO 目标必须向 iSCSI 发起程序提供发出的用户名和口令。对于进来和发出的发现，用户名和口令对可以有所不同。 </para>
  <para>配置 iSCSI LIO 目标的身份验证自选设置：</para>
  <procedure id="b12g8sjw">
   <step id="b13n0ujs" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份登录到 iSCSI LIO 目标服务器，然后启动终端控制台。</para>
   </step>
   <step id="b13n0ujt" performance="required">
    <para>确保 <filename>/etc/init.d/target</filename> 守护程序在运行中。在命令提示符处输入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>命令会返回一条消息确认守护程序已启动，或守护程序已经在运行。</para>
   </step>
   <step id="b12g8sjx" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="b12g8sjy" performance="required">
    <para>在 YaST 控制中心，选择<guimenu>网络服务</guimenu>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <para>您也可以搜索 <quote>lio</quote>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12g9s76" performance="required">
    <para>在“iSCSI LIO 目标概述”对话框中，选择<guimenu>全局</guimenu>选项卡以对身份验证设置进行配置。默认情况下禁用身份验证设置。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_global_noauth_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jco93" performance="required">
    <para>指定对于 iSCSI LIO 目标是否要求进行身份验证：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b12jcrm7">
       <title>禁用身份验证：</title>
       <para>（默认）选中<guimenu>无身份验证</guimenu>复选框，以禁用针对此服务器上的发现的进来和出去身份验证。同一网络上的任何 iSCSI 发起程序客户端都可以发现此服务器上的所有 iSCSI LIO 目标。此服务器可以发现同一个网络上无需发现身份验证的任何 iSCSI 发起程序客户端。跳过<xref linkend="b12r1015" xrefstyle="StepXRef"/>并继续<xref linkend="b12gb2ux" xrefstyle="StepXRef"/>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12jcrm8">
       <title>启用身份验证：</title>
       <para>取消选中<guimenu>无身份验证</guimenu>复选框。<guimenu>进来的身份验证</guimenu>和<guimenu>发出的身份验证</guimenu>复选框将同时自动选中。继续<xref linkend="b12r1015" xrefstyle="StepXRef"/>。</para>
      </formalpara>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_global_in_out_auth_a.png" width="250pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </itemizedlist>
   </step>
   <step id="b12r1015" performance="required">
    <para role="intro">配置进来的发现、发出的发现或二者所需的身份验证凭证。对于进来和发出的发现，用户名和口令对可以有所不同。 </para>
    <substeps performance="required">
     <step id="b12jcw2u" performance="required">
      <para>执行以下一个步骤配置进来的身份验证：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="b12r0xyn">
         <title>禁用进来的身份验证： </title>
         <para>取消选中<guimenu>进来的身份验证</guimenu>复选框。同一网络上的任何 iSCSI 发起程序客户端都可以发现此服务器上的所有 iSCSI LIO 目标。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="b12r0xyo">
         <title>启用进来的身份验证： </title>
         <para>选中<guimenu>进来的身份验证</guimenu>复选框，然后指定 iSCSI LIO 目标的进来发现使用的现有用户名和口令对。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step id="b12jcw2x" performance="required">
      <para>执行以下一个步骤配置发出的身份验证： </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="b12r0xyp">
         <title>禁用发出的身份验证： </title>
         <para>取消选中<guimenu>发出的身份验证</guimenu>复选框。此服务器可以发现同一个网络上无需发现身份验证的任何 iSCSI 发起程序客户端。 </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="b12r0xyq">
         <title>启用发出的身份验证： </title>
         <para>选中<guimenu>发出的身份验证</guimenu>复选框，然后指定 iSCSI 发起程序客户端的出去发现使用的现有用户名和口令对。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
    </substeps>
   </step>
   <step id="b12gb2ux" performance="required">
    <para>单击<guimenu>完成</guimenu>保存并应用设置。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect_iscsi_lio_storage">
  <title>准备储存空间</title>
  <para>iSCSI LIO 目标配置会将现有块设备导出到 iSCSI 发起程序。您必须通过设置服务器上的未格式化分区或设备，准备好要用于目标设备的储存空间。iSCSI LIO 目标可将未格式化的分区用于 Linux、Linux LVM 或 Linux RAID 文件系统 ID。 </para>
  <important>
   <para>设置完用作 iSCSI 目标的设备或分区后，切勿通过其本地路径直接对其进行访问。创建时，不要为其指定安装点。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12jcw6s" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jcw75" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12jcw6s">
   <title>将设备分区</title>
   <procedure id="b12jcw6t">
    <step id="b12jcw6u" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
    </step>
    <step id="b12jcw6v" performance="required">
     <para>在 YaST 中，选择<guimenu>系统</guimenu><guimenu>分区程序</guimenu>。</para>
    </step>
    <step id="b12jcw6w" performance="required">
     <para>单击<guimenu>是</guimenu>跳过关于使用分区程序的警告。</para>
    </step>
    <step id="b12jcw6x" performance="required">
     <para>在“分区”页面的底部，单击<guimenu>添加</guimenu>创建分区，但不要对其进行格式化，也不要将其装入。 </para>
     <substeps performance="required">
      <step id="b12o0qiv" performance="required">
       <para>在“专家分区程序”页面，选择<guimenu>硬盘</guimenu>，然后选择要进行配置的磁盘的叶节点名称（例如 <filename>sdc</filename>）。</para>
      </step>
      <step id="b12jcw6y" performance="required">
       <para>选择<guimenu>主分区</guimenu>，然后单击<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b12jcw6z" performance="required">
       <para>指定要使用的空间量，然后单击<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b12jcw70" performance="required">
       <para>在<guimenu>格式化选项</guimenu>下，选择<guimenu>不格式化</guimenu>，然后从下拉列表中选择文件系统 ID 类型。</para>
       <para>iSCSI LIO 目标可将未格式化的分区用于 Linux (0x83)、Linux LVM (0x8E) 或 Linux RAID (0xFD) 文件系统 ID。 </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="lio_disk_format_a.png" width="250pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12jcw71" performance="required">
       <para>在<guimenu>装入选项</guimenu>下，选择<guimenu>不装入</guimenu>。</para>
      </step>
      <step id="b12jcw72" performance="required">
       <para>单击<guimenu>完成</guimenu>。</para>
      </step>
     </substeps>
    </step>
    <step id="b12jcw73" performance="required">
     <para>重复<xref linkend="bj5f9hl" xrefstyle="StepXRef"/>为每个日后要用作 iSCSI LIO 目标的区域创建未格式化分区。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_disk_format_multi_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jcw74" performance="required">
     <para>单击<guimenu>下一步</guimenu><guimenu>完成</guimenu>，以保留更改，然后关闭 YaST。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b12jcw75">
   <title>在虚拟环境中对设备分区</title>
   <para>您可以将虚拟机 guest 服务器作为 iSCSI LIO 目标服务器使用。本节说明如何给 Xen 虚拟机指派分区。您也可以使用 SUSE Linux Enterprise Server 11 SP2 或更高版本所支持的其他虚拟环境。</para>
   <para>在 Xen 虚拟环境中，必须将要用于 iSCSI LIO 目标设备的储存空间指派给 guest 虚拟机，然后作为 guest 环境中的虚拟磁盘访问该空间。每个虚拟磁盘都可以是一个物理块设备，如整个磁盘、分区或卷，或者可以是一个基于文件的磁盘映像，其中虚拟磁盘是 Xen 主机服务器上较大物理磁盘上的单个映像文件。为了获得最佳性能，请从物理磁盘或分区创建每个虚拟磁盘。为 guest 虚拟机设置完虚拟磁盘后，请启动 guest 服务器，然后按照物理服务器所用的同一过程将新的空虚拟磁盘配置为 iSCSI 目标设备。 </para>
   <para>在 Xen 主机服务器上创建基于文件的磁盘映像，然后将其指派给 Xen guest 服务器。默认情况下，Xen 将基于文件的磁盘映像储存在目录 <filename>/var/lib/xen/images/<replaceable>虚拟机名称</replaceable></filename> 中，其中<filename><replaceable>虚拟机名称</replaceable></filename>是虚拟机的名称。</para>
   <para>例如，如果要创建大小为 4 GB 的磁盘映像 <filename>/var/lib/xen/images/vm_one/xen-0</filename>，首先应确保此目录存在，然后再创建映像本身。</para>
   <procedure id="b12jcw76">
    <step id="b12jcw77" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份登录主机服务器。</para>
    </step>
    <step id="b12jcw78" performance="required">
     <para>在终端控制台提示符处，输入以下命令：</para>

<screen>
mkdir -p /var/lib/xen/images/vm_one
dd if=/dev/zero of=/var/lib/xen/images/vm_one/xen-0 seek=1M bs=4096 count=1
</screen>

    </step>
    <step id="b12jcw79" performance="required">
     <para>将文件系统映像指派给 Xen 配置文件中的 guest 虚拟机。</para>
    </step>
    <step id="b12jcw7a" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份登录 guest 服务器，然后使用 YaST 按照<xref linkend="b12jcw6s" xrefstyle="HeadingOnPage"/>中的过程设置虚拟块设备。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sect_iscsi_lio_targetgp">
  <title>设置 iSCSI LIO 目标组</title>
  <para>您可以使用 YaST 配置 iSCSI LIO 目标设备。YaST 使用 <command>lio-utils</command> 软件提供的 API。iSCSI LIO 目标可将未格式化的分区用于 Linux、Linux LVM 或 Linux RAID 文件系统 ID。</para>
  <important>
   <para>开始之前，请按照<xref linkend="sect_iscsi_lio_storage" xrefstyle="SectTitleOnPage"/>中所述创建想要用作 iSCSI LIO 目标的未格式化分区。</para>
  </important>
  <procedure id="b12jbfdv">
   <step id="b13n0uju" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份登录到 iSCSI LIO 目标服务器，然后启动终端控制台。</para>
   </step>
   <step id="b13n0ujv" performance="required">
    <para>确保 <filename>/etc/init.d/target</filename> 守护程序在运行中。在命令提示符处输入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>命令会返回一条消息确认守护程序已启动，或守护程序已经在运行。</para>
   </step>
   <step id="b12jbfdw" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="b12jbfdx" performance="required">
    <para>在 YaST 控制中心，选择<guimenu>网络服务</guimenu>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <para>您也可以搜索 <quote>lio</quote>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jbfdy" performance="required">
    <para>在“iSCSI LIO 目标概述”对话框中，选择<guimenu>目标</guimenu>选项卡以配置目标。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_targets_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jdln1" performance="required">
    <para role="intro">单击<guimenu>添加</guimenu>，然后定义新的 iSCSI LIO 目标组以及设备：</para>
    <para role="intro">iSCSI LIO 目标软件将自动填写 <guimenu>目标</guimenu>、<guimenu>标识符</guimenu>、<guimenu>门户组</guimenu>、<guimenu>IP 地址</guimenu>以及<guimenu>端口号</guimenu>字段。默认会选择<guimenu>使用身份验证</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_add_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <substeps performance="required">
     <step id="b12jdzge" performance="required">
      <para>如果您有多个网络接口，请使用 IP 地址下拉列表选择此目标组要使用的网络接口的 IP 地址。</para>
     </step>
     <step id="b12jdzgf" performance="required">
      <para>如果对此目标组要求进行客户端身份验证，则请选择<guimenu>使用身份验证</guimenu>。</para>
      <important>
       <para>建议在生产环境中要求进行身份验证。</para>
      </important>
     </step>
     <step id="b12je5o1" performance="required">
      <para>单击<guimenu>添加</guimenu>，浏览以选择设备或分区，指定名称，然后单击<guimenu>确定</guimenu>。</para>
      <para>系统将自动生成 LUN 号（从 0 开始）。如果将该字段保留为空，则会自动生成名称。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_target_addnew_a.png" width="91pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12jebk1" performance="required">
      <para>（可选）重复<xref linkend="b12jdzge" xrefstyle="StepXRef"/>至<xref linkend="b12je5o1" xrefstyle="StepXRef"/>，将更多目标添加至此目标组中。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_target_list_a.png" width="250pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12jeipi" performance="required">
      <para>将所有所需的目标添加到该组后，单击<guimenu>下一步</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="b12jeipj" performance="required">
    <para>在“修改 iSCSI 目标客户端设置”页面，配置允许访问目标组中 LUN 的客户端的信息：</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_client_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <para>在为目标组指定了至少一个客户端后，<guimenu>编辑 LUN</guimenu>、<guimenu>编辑身份验证</guimenu>、<guimenu>删除</guimenu>以及<guimenu>复制</guimenu>按钮才会启用。您可以使用<guimenu>添加</guimenu>或<guimenu>复制</guimenu>为目标组添加更多客户端。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_client_options_a.png" width="200pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b12mh6xo">
       <title>添加：</title>
       <para>为选中的 iSCSI LIO 目标组添加新的客户端项。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggu">
       <title>编辑 LUN：</title>
       <para>配置将 iSCSI LIO 目标组中的哪些 LUN 映射到选中客户端。您可以将每一个指派的目标映射到首选的客户端 LUN。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggv">
       <title>编辑身份验证：</title>
       <para>为选中客户端配置首选身份验证方法。您可以指定无身份验证，也可以配置进来的身份验证、发出的身份验证或二者皆配置。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggw">
       <title>删除：</title>
       <para>将选中客户端项从分配给目标组的客户端列表中删除。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggx">
       <title>复制：</title>
       <para>添加与选中的客户端项具有相同 LUN 映射和身份验证设置的新客户端项。如此，您便可以轻松地将相同的共享 LUN 逐一分配给群集中的每一个节点。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <substeps performance="required">
     <step id="b12mdr9g" performance="required">
      <para>单击<guimenu>添加</guimenu>，指定客户端名称，选中或取消选中<guimenu>从 TPG 中导入 LUN</guimenu> 复选框，然后单击<guimenu>确定</guimenu>保存设置。 </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client1_new_a.png" width="200pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12mdr9h" performance="required">
      <para>选择客户端项，单击<guimenu>编辑 LUN</guimenu>，修改 LUN 映射，以指定将 iSCSI LIO 目标组中的哪些 LUN 分配给选中的客户端，然后单击<guimenu>确定</guimenu>保存更改。 </para>
      <para>如果 iSCSI LIO 目标组由多个 LUN 组成，则您可以将一个或多个 LUN 分配给选中的客户端。默认情况下，会将该组中的每一个可用 LUN 指派给客户端 LUN。 </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client3_edit_lun_a.png" width="107pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
      <para>要修改 LUN 分配，请完成以下一项或多项操作： </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="b12mhta3">
         <title>添加：</title>
         <para>单击<guimenu>添加</guimenu>新建<guimenu>客户端 LUN</guimenu> 项，然后使用<guimenu>更改</guimenu>下拉列表将目标 LUN 映射到该项。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun4_add_a.png" width="107pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <formalpara id="b12mhta4" role="intro">
         <title>删除：</title>
         <para>选择<guimenu>客户端 LUN</guimenu> 项，然后单击<guimenu>删除</guimenu>以删除目标 LUN 映射。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun3_delete_a.png" width="106pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <formalpara id="b12mhta5">
         <title>将:</title>
         <para>选择<guimenu>客户端 LUN</guimenu> 项，然后使用<guimenu>更改</guimenu>下拉列表选择要与之映射的目标 LUN。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun2_change_a.png" width="108pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
      </itemizedlist>
      <para>典型的分配计划包括：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>列出作为客户端的单个服务器。将目标组中的所有 LUN 分配给它。</para>
        <para>您可以使用此分组策略，为指定服务器逻辑分组 iSCSI SAN 储存。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <para role="intro">列出作为客户端的多个独立服务器。将一个或多个目标 LUN 分配给每一个服务器。将每个 LUN 只分配给一个服务器。 </para>
        <para>您可以使用此分组策略，为数据中心中的指定部门或服务类别逻辑分组 iSCSI SAN 储存。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list3_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <para>列出作为客户端的群集的每个节点。将所有共享的目标 LUN 分配给每一个节点。所有节点都将连接到设备，但对于大多数文件系统，群集软件会锁定设备不让它们访问，并且一次只在一个节点上装入该设备。共享的文件系统（例如 OCFS2）可让多个节点同时装入相同的文件结构，并以读写访问权打开相同文件。</para>
        <para>您可以使用此分组策略，为指定服务器群集逻辑分组 iSCSI SAN 储存。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list2_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
      </itemizedlist>
     </step>
     <step id="b12mdr9i" performance="required">
      <para>选择客户端项，单击<guimenu>编辑身份验证</guimenu>，指定客户端的身份验证设置，然后单击<guimenu>确定</guimenu>保存设置。</para>
      <para>您可以要求<guimenu>无身份验证</guimenu>，也可以配置<guimenu>进来的身份验证</guimenu>、<guimenu>发出的身份验证</guimenu>，或二者皆配置。您可以为每个客户端指定唯一一对用户名和口令。对于客户端的进来和发出的身份验证，其身份凭证可以有所不同。每个客户端的身份凭证可以均不相同。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client4_edit_auth2_inout_a.png" width="200pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12mdr9j" performance="required">
      <para>为每个可以访问此目标组的 iSCSI 客户端重复<xref linkend="b12mdr9g" xrefstyle="StepXRef"/>到<xref linkend="b12mdr9i" xrefstyle="StepXRef"/>。</para>
     </step>
     <step id="b12mdr9k" performance="required">
      <para> 配置完客户端指派后，单击<guimenu>下一步</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="b12jbfdz" performance="required">
    <para>单击<guimenu>完成</guimenu>保存并应用设置。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_targets_group_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect_iscsi_lio_edit">
  <title>修改 iSCSI LIO 目标组</title>
  <para>您可以按照如下方式修改现有 iSCSI LIO 目标组：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>在目标组中添加或删除目标 LUN 设备</para>
   </listitem>
   <listitem>
    <para>为目标组添加或删除客户端</para>
   </listitem>
   <listitem>
    <para>为目标组的客户端修改客户端 LUN 与目标 LUN 的映射</para>
   </listitem>
   <listitem>
    <para>修改客户端身份验证（进来、出去或二者）的用户名和口令身份凭证。</para>
   </listitem>
  </itemizedlist>
  <para>查看或修改 iSCSI LIO 目标组的设置：</para>
  <procedure id="b12o1qa2">
   <step id="b13n0ujw" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份登录到 iSCSI LIO 目标服务器，然后启动终端控制台。</para>
   </step>
   <step id="b13n0ujx" performance="required">
    <para>确保 <filename>/etc/init.d/target</filename> 守护程序在运行中。在命令提示符处输入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>命令会返回一条消息确认守护程序已启动，或守护程序已经在运行。</para>
   </step>
   <step id="b12o1qa3" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="b12o1qa4" performance="required">
    <para role="intro">在 YaST 控制中心，选择<guimenu>网络服务</guimenu>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <para role="intro">您也可以搜索 <quote>lio</quote>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1qa5" performance="required">
    <para role="intro">在“iSCSI LIO 目标概述”对话框中，选择<guimenu>目标</guimenu>选项卡，查看目标组的列表。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1qa6" performance="required">
    <para role="intro">选择要修改的 iSCSI LIO 目标组，然后单击<guimenu>编辑</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_edit_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1qa7" performance="required">
    <para>在“修改 iSCSI 目标 LUN 设置”页面上，将 LUN 添加到目标组，编辑 LUN 指派或从组中删除目标 LUN。在对组完成所有想要的更改后，单击<guimenu>下一步</guimenu>。</para>
    <para>有关选项信息，请参见<xref linkend="sect_iscsi_lio_targetgp" xrefstyle="SectTitleOnPage"/>中的<xref linkend="b12jdln1" xrefstyle="StepXRef"/>。</para>
   </step>
   <step id="b12o1qad" performance="required">
    <para>在“修改 iSCSI 目标客户端设置”页面，配置允许访问目标组中 LUN 的客户端的信息。在对组完成所有想要的更改后，单击<guimenu>下一步</guimenu>。</para>
    <para>有关选项信息，请参见<xref linkend="sect_iscsi_lio_targetgp" xrefstyle="SectTitleOnPage"/>中的<xref linkend="b12jeipj" xrefstyle="StepXRef"/>。</para>
   </step>
   <step id="b12o1qar" performance="required">
    <para>单击<guimenu>完成</guimenu>保存并应用设置。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect_iscsi_lio_delete">
  <title>删除 iSCSI LIO 目标组</title>
  <para>删除 iSCSI LIO 目标组会同时删除组的定义以及客户端的相关设置，包括 LUN 映射和身份验证凭证。该操作不会销毁分区上的数据。要再次赋予客户端访问权限，您可以将目标 LUN 分配给不同的或新的目标组，并为其配置客户端访问权限。</para>
  <procedure id="b12o1fhc">
   <step id="b13n0ury" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份登录到 iSCSI LIO 目标服务器，然后启动终端控制台。</para>
   </step>
   <step id="b13n0urz" performance="required">
    <para>确保 <filename>/etc/init.d/target</filename> 守护程序在运行中。在命令提示符处输入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>命令会返回一条消息确认守护程序已启动，或守护程序已经在运行。</para>
   </step>
   <step id="b12o1fhd" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份启动 YaST。</para>
   </step>
   <step id="b12o1fhe" performance="required">
    <para>在 YaST 控制中心，选择<guimenu>网络服务</guimenu>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <para>您也可以搜索 <quote>lio</quote>，然后选择 <guimenu>iSCSI LIO 目标</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1fhf" performance="required">
    <para>在“iSCSI LIO 目标概述”对话框中，选择<guimenu>目标</guimenu>选项卡，查看已配置的目标组列表。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1fhg" performance="required">
    <para role="intro">选择要删除的 iSCSI LIO 目标组，然后单击<guimenu>删除</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1iuu" performance="required">
    <para>系统提示时，单击<guimenu>继续</guimenu>确认删除，或单击<guimenu>取消</guimenu>予以取消。</para>
   </step>
   <step id="b12o1fi0" performance="required">
    <para>单击<guimenu>完成</guimenu>保存并应用设置。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="b13g8i2g">
  <title>iSCSI LIO 目标服务器查错</title>
  <para>本节对 iSCSI LIO 目标服务器的一些已知问题以及可行的解决方案进行了说明。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13g8i2h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g8r6r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b13g8i2h">
   <title>设置目标 LUN 时发生门户错误 </title>
   <para>添加或编辑 iSCSI LIO 目标组时发生错误：</para>

<screen>
Problem setting network portal &lt;ip_address&gt;:3260
</screen>

   <para><filename>/var/log/YasT2/y2log</filename> 日志文件包含以下错误：</para>

<screen>
find: `/sys/kernel/config/target/iscsi': No such file or directory
</screen>

   <para>若 iSCSI LIO 目标服务器软件当前未运行则会发生此问题。要解决此问题，请退出 YaST，并在命令行手动启动 iSCSI LIO，然后重试。</para>
   <procedure id="b13g8i2i">
    <step id="b13g8i2j" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份打开终端控制台。</para>
    </step>
    <step id="b13g8i2k" performance="required">
     <para>在命令提示符处输入</para>

<screen>
/etc/init.d/target start
</screen>

    </step>
   </procedure>
   <para role="intro">您也可以输入以下内容来检查 <command>configfs</command>、<command>iscsi_target_mod</command> 和 <command>target_core_mod</command> 是否载入。随即显示响应示例。</para>

<screen>
<command>lsmod | grep iscsi</command>

  iscsi_target_mod      295015  0
  target_core_mod       346745  4
  iscsi_target_mod,target_core_pscsi,target_core_iblock,target_core_file
  configfs               35817  3 iscsi_target_mod,target_core_mod
  scsi_mod              231620  16
  iscsi_target_mod,target_core_pscsi,target_core_mod,sg,sr_mod,mptctl,sd_mod,
  scsi_dh_rdac,scsi_dh_emc,scsi_dh_alua,scsi_dh_hp_sw,scsi_dh,libata,mptspi,
  mptscsih,scsi_transport_spi
</screen>

  </sect2>
  <sect2 id="b13g8r6r">
   <title>iSCSI LIO 目标在其他计算机上不可见</title>
   <para>如果目标服务器上使用防火墙，则必须打开要使用的 iSCSI 端口，以允许其他计算机看到 iSCSI LIO 目标。有关信息，请参见<xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/>中的<xref linkend="b12jaucl" xrefstyle="StepXRef"/>。</para>
  </sect2>
 </sect1>
 <sect1 id="b12iqi8o">
  <title>iSCSI LIO 目标术语</title>
  <variablelist>
   <varlistentry id="b12iqi8p">
    <term>后备储存</term>
    <listitem>
     <para>提供 iSCSI 端点底层的实际储存的物理储存对象。 </para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir33x">
    <term>CDB（命令描述符块）</term>
    <listitem>
     <para>SCSI 命令的标准格式。CDB 通常长度为 6、10 或 12 个字节，但也可以达到 16 个字节或具有可变长度。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8q">
    <term>CHAP （Challenge Handshake Authentication Protocol）</term>
    <listitem>
     <para>点对点协议 (PPP) 身份验证方法用于向另一台计算机确认一台计算机的身份。链路控制协议 (LCP) 连接两台计算机并协商 CHAP 方法后，身份验证者会向对等体发送随机询问。然后该对等体会根据询问以及密钥发出以哈希加密的应答。再由身份验证者比照由预期哈希值自己计算出的结果对该哈希应答进行验证，以决定是确认身份验证还是中断连接。有关 CHAP 的定义，请参见<ulink url="http://www.ietf.org">因特网工程任务组 (IETF)</ulink> RFC 1994。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8r">
    <term>CID（连接标识符）</term>
    <listitem>
     <para>由发起程序生成的 16 位编号，用于唯一识别两个 iSCSI 设备之间的连接。登录阶段会显示此编号。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8s">
    <term>端点</term>
    <listitem>
     <para> iSCSI 目标名称与 iSCSI TPG（IQN + 标记）的组合。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8t">
    <term>EUI（扩展的唯一标识符）</term>
    <listitem>
     <para>在全球范围内唯一标识每个设备的 64 位编号。其格式由指定公司的唯一的 24 位编号和由该公司分配给所构建的每个设备的 40 位编号组成。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8u">
    <term>发起程序</term>
    <listitem>
     <para>SCSI 会话的发起端。通常是计算机等控制设备。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8v">
    <term>IPS（因特网协议储存）</term>
    <listitem>
     <para>使用 IP 协议在储存网络中移动数据的一类协议或设备。FCIP（基于 IP 的光纤通道）、iFCP（因特网光纤通道协议）以及 iSCSI（因特网 SCSI）都属于 IPS 协议。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8w">
    <term>IQN（iSCSI 限定的名称）</term>
    <listitem>
     <para>在全球范围内唯一标识每个设备的 iSCSI 的名称格式（例如：<filename>iqn.5886.com.acme.tapedrive.sn‐a12345678</filename>）。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8x">
    <term>ISID（发起程序会话标识符）</term>
    <listitem>
     <para> 由发起程序生成的 48 位编号，用于唯一标识发起程序和目标之间的会话。此值在登录过程中创建，生成后将与登录 PDU 一起发送给目标。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8y">
    <term>MCS（每个会话多重连接）</term>
    <listitem>
     <para>它是 iSCSI 规范的组成部分，允许发起程序与目标之间存在多个 TCP/IP 连接。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8z">
    <term>MPIO（多路径 I/O）</term>
    <listitem>
     <para>一种可在服务器和储存设备之间建立多个冗余数据路径的方法。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8e">
    <term>网络门户</term>
    <listitem>
     <para>iSCSI 端点与 IP 地址及 TCP（传输控制协议）端口的组合。TCP 端口 3260 是 IANA（因特网号码分配机构）所定义的 iSCSI 协议的端口号。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8f">
    <term>SAM（SCSI 体系结构模型）</term>
    <listitem>
     <para>以一般术语说明 SCSI 行为的文档。它支持不同类型的设备通过各种介质进行通讯。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8g">
    <term>目标</term>
    <listitem>
     <para>SCSI 会话的接收端，通常是磁盘驱动器、磁带驱动器或扫描仪等设备。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8h">
    <term>目标组 (TG)</term>
    <listitem>
     <para>在创建视图时视为同等对待的 SCSI 目标端口的列表。创建视图可便于 LUN（逻辑单元号）映射。每个视图项指定一个目标组、主机组以及一个 LUN。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir33y">
    <term>目标端口</term>
    <listitem>
     <para>一个 iSCSI 端点与一个或多个 LUN 的组合。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir33z">
    <term>目标端口组 (TPG)</term>
    <listitem>
     <para>IP 地址和 TCP 端口号的列表，用于确定特定 iSCSI 目标将要侦听的接口。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir340">
    <term>目标会话标识符 (TSID)</term>
    <listitem>
     <para>由目标生成的 16 位编号，用于唯一标识发起程序和目标之间的会话。此值在登录过程中创建，生成后将与登录响应 PDU（协议数据单元）一起发送给发起程序。</para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" id="cha_fcoe" lang="en" revision="02/01/12" xml:base="06_fcoe.xml">
 <title>以太网光纤通道储存：FCoE</title>
 <para>许多企业数据中心的 LAN 和数据流量都依赖于以太网，而其储存基础设施则依赖于光纤通道网络。开放以太网光纤通道 (FCoE) 发起程序软件允许配有以太网适配器的服务器经由以太网网络连接光纤通道储存子系统。而在以前，只允许配有光纤通道适配器的系统经由光纤通道架构进行连接。FCoE 技术通过支持网络融合降低了数据中心的复杂度。这有助于保护您在光纤通道储存基础设施方面的现有投资，并简化网络管理。 </para>
 <figure pgwide="0" id="bwkfm8v">
  <title>开放以太网 SAN 光纤通道</title>
  <mediaobject>
   <imageobject role="fo">
   <imagedata fileref="fcoe_san_a.png" width="445pt" format="eps"/></imageobject>
   <imageobject role="html">
   <imagedata fileref="fcoe_san_a.png" width="445pt" format="png"/></imageobject>
  </mediaobject>
 </figure>
 <para>Open-FCoE 可让您在主机上而不是主机总线适配器上的专有硬件上运行光纤通道协议。它专用于 10 Gbps（每秒千兆位）以太网适配器，但也可用于任何支持暂停帧的以太网适配器。发起程序软件提供光纤通道协议处理模块以及基于以太网的传输模块。Open-FCoE 模块充当 SCSI 的低级驱动程序。Open-FCoE 传输使用 <command>net_device</command> 发送和接收包。数据中心桥接 (DCB) 驱动程序提供 FCoE 的服务质量。 </para>
 <para>FCoE 是一种封装协议，它可以通过以太网连接移动光纤通道协议流量而无需更改光纤通道数据帧。如此一来，您的网络安全和流量管理基础设施就可以像使用光纤通道一样使用 FCoE。</para>
 <para>如果存在以下情况，则可以选择在您的企业中部署 Open-FCoE： </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>贵企业已有光纤通道储存子系统，并拥有具备光纤通道技能和知识的管理员。</para>
  </listitem>
  <listitem>
   <para>您的网络中部署的是 10 Gbps 以太网。</para>
  </listitem>
 </itemizedlist>
 <para>本节说明如何在您的网络中设置 FCoE。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bxurl07" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycsjf0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxyqov2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuri58" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuptlv" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycscw6" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycscw7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuqb00" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bxurl07">
  <title>安装 FCoE 和 YaST FCoE 客户端</title>
  <para>您可以通过在交换机上为服务器的连接启用 FCoE，来于储存基础设施中设置 FCoE 磁盘。安装 SUSE Linux Enterprise Server 操作系统时，如果可以使用 FCoE 磁盘，则会在当时自动安装 FCoE 发起程序软件。 </para>
  <para>如果没有安装 FCoE 发起程序软件和 YaST FCoE 客户端软件，请通过以下步骤将它们手动安装到现有系统：</para>
  <procedure id="bxurln0">
   <step id="byd2977" performance="required">
    <para>以 <systemitem>root</systemitem> 用户的身份登录服务器。</para>
   </step>
   <step id="bxurln1" performance="required">
    <para>在 YaST 中，选择<guimenu>软件</guimenu><guimenu>软件管理</guimenu>。</para>
   </step>
   <step id="bxurlrs" performance="required">
    <para>搜索并选择以下 FCoE 包：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>open-fcoe</para>
     </listitem>
     <listitem>
      <para>yast2-fcoe-client</para>
     </listitem>
    </itemizedlist>
    <para role="intro">例如，在<guimenu>搜索</guimenu>字段中键入 <literal>fcoe</literal>，单击<guimenu>搜索</guimenu>以查找该软件包，然后选中要安装的每个软件包旁的复选框。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_install2_a.png" width="241pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bxurni7" performance="required">
    <para>单击<guimenu>接受</guimenu>，然后单击<guimenu>继续</guimenu>，以接受自动更改。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bycsjf0">
  <title>安装过程中配置 FCoE 接口</title>
  <para>您可以使用针对 SUSE Linux Enterprise Server 的 YaST 安装在安装操作系统期间配置 FCoE 磁盘，前提是在交换机上为服务器与光纤通道储存基础设施之间的连接启用 FCoE。有些类型的系统 BIOS 能够自动检测到 FCoE 磁盘，并向 YaST 安装软件报告该磁盘。但不是所有类型的 BIOS 都支持 FCoE 磁盘自动检测。在此情况下若要启用自动检测，您可以在开始安装时将 <command>withfcoe</command> 选项添加到内核命令行：</para>

<screen>
withfcoe=1
</screen>

  <para role="intro">当检测到 FCoE 磁盘时，YaST 安装便会在当时提供配置 FCoE 实例的选项。在“磁盘激活”页面上，选择<guimenu>配置 FCoE 接口</guimenu>，以访问 FCoE 配置。有关配置 FCoE 接口的信息，请参见<xref linkend="bxyqov2" xrefstyle="SectTitleOnPage"/>。</para>
  <informalfigure pgwide="0">
   <mediaobject>
    <imageobject>
    <imagedata fileref="fcoe_inst_disk_activation_a.png" width="253pt" format="png"/></imageobject>
   </mediaobject>
  </informalfigure>
 </sect1>
 <sect1 id="bxyqov2">
  <title>使用 YaST 管理 FCoE 服务</title>
  <para>您可以使用“YaST FCoE 客户端配置”选项为光纤通道储存基础设施中的 FCoE 磁盘创建、配置和删除 FCoE 接口。要使用此选项，必须安装并运行 FCoE 发起程序服务（<filename>fcoemon</filename> 守护程序）以及链路层发现协议代理守护程序 (<command>lldpad</command>)，并且必须在支持 FCoE 的交换机上启用 FCoE 连接。</para>
  <procedure id="bxyqpcm">
   <step id="bxyqpcn" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份登录，然后启动 YaST。</para>
   </step>
   <step id="bxyqpl8" performance="required">
    <para>在 YaST 中，选择<guimenu>网络服务</guimenu><guimenu>FCoE 客户端配置</guimenu>。 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_yast2_a.png" width="191pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <para>“以太网光纤通道配置”对话框提供有三个选项卡：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para><guimenu>服务</guimenu></para>
     </listitem>
     <listitem>
      <para><guimenu>接口</guimenu></para>
     </listitem>
     <listitem>
      <para><guimenu>配置</guimenu></para>
     </listitem>
    </itemizedlist>
   </step>
   <step id="bycsvr4" performance="required">
    <para role="intro">在<guimenu>服务</guimenu>选项卡上，可按需要查看或修改 FCoE 服务和 Lldpad（链路层发现协议代理守护程序）服务启动时间。 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_services_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bycssp2" role="intro">
       <title>FCoE 服务启动：</title>
       <para>指定是在服务器引导时启动以太网光纤通道服务 <command>fcoemon</command> 守护程序还是手动启动。该守护程序用于控制 FCoE 接口，并会与 <command>lldpad</command> 守护程序建立连接。可用值为<guimenu>引导时</guimenu>（默认）或<guimenu>手动</guimenu>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bycsvr5" role="intro">
       <title>Lldpad 服务启动：</title>
       <para>指定是在服务器引导时启动链路层发现协议代理 <command>lldpad</command> 守护程序还是手动启动。<command>lldpad</command> 守护程序会向 <command>fcoemon</command> 守护程序通知有关数据中心桥接特性以及 FCoE 接口配置的情况。可用值为<guimenu>引导时</guimenu>（默认）或<guimenu>手动</guimenu>。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>如果修改设置，则单击<guimenu>确定</guimenu>保存并应用更改。</para>
   </step>
   <step id="bycsxr4" performance="required">
    <para>在<guimenu>接口</guimenu>选项卡上，可查看有关服务器上所有检测到的网络适配器的信息，包括有关 VLAN 和 FCoE 配置的信息。您也可以创建 FCoE VLAN 接口、更改现有 FCoE 接口的设置，或删除 FCoE 接口。</para>
    <formalpara id="byct84b" role="intro">
     <title>查看 FCoE 信息</title>
     <para/>
    </formalpara>
    <para role="intro"><guimenu>FCoE 接口</guimenu>表中显示每个适配器的以下相关信息：</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_notconfig_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="byd3h1o" role="intro">
       <title>设备名称：</title>
       <para>指定适配器名称，例如 <filename>eth4</filename>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3hdt">
       <title>型号：</title>
       <para>指定适配器型号信息。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3l6i" role="intro">
       <title>FCoE VLAN 接口</title>
       <para/>
      </formalpara>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="byd3nbb">
         <title>接口名：</title>
         <para>如果将 <filename>eth4.200</filename> 之类名称指派给接口，则 FCoE 在交换机上可用，并会为该适配器激活 FCoE 接口。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="byd3o01">
         <title>未配置：</title>
         <para>如果状态为<guimenu>未配置</guimenu>，则表示在交换机上启用 FCoE 但尚未为适配器激活 FCoE 接口。选择适配器，然后单击<guimenu>创建 FCoE VLAN 接口</guimenu>，以在适配器上激活接口。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="byd3ohg">
         <title>不可用：</title>
         <para>如果状态为<guimenu>不可用</guimenu>，则表示因为没有在交换机上为该连接启用 FCoE，所以 FCoE 对适配器不可用。 </para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <formalpara id="byd3mds">
       <title>启用 FCoE：</title>
       <para>指定是否在交换机上为适配器连接启用 FCoE。（<guimenu>是</guimenu>或<guimenu>否</guimenu>）</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3pvk">
       <title>需要 DCB：</title>
       <para>指定适配器是否需要数据中心桥接。（<guimenu>是</guimenu>或<guimenu>否</guimenu>）</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3qba">
       <title>自动 VLAN：</title>
       <para>指定是否为适配器启用自动 VLAN 配置。（<guimenu>是</guimenu>或<guimenu>否</guimenu>）</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3r0o">
       <title>支持 DCB：</title>
       <para>指定适配器是否支持数据中心桥接。（<guimenu>是</guimenu>或<guimenu>否</guimenu>）</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <formalpara id="byct8zr" role="intro">
     <title>更改 FCoE 设置</title>
     <para/>
    </formalpara>
    <para role="intro">选择 FCoE VLAN 接口，然后单击页面底部的<guimenu>更改设置</guimenu>，打开“更改 FCoE 设置”对话框。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_modify_config_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="byctmy6">
       <title>启用 FCoE：</title>
       <para>启用或禁用为适配器创建 FCoE 实例。可用值为<guimenu>是</guimenu>或<guimenu>否</guimenu>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byctn94">
       <title>需要 DCB：</title>
       <para>指定适配器是否需要数据中心桥接。可用值为<guimenu>是</guimenu>（默认）或<guimenu>否</guimenu>。通常需要 DCB。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byctn95">
       <title>自动 VLAN：</title>
       <para>指定 <filename>fcoemon</filename> 守护程序是否自动创建 VLAN 接口。可用值为<guimenu>是</guimenu>或<guimenu>否</guimenu>。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>如果修改设置，则单击<guimenu>下一步</guimenu>保存并应用更改。设置将写入 <filename>/etc/fcoe/eth<replaceable>X</replaceable></filename> 文件。<command>fcoemon</command> 守护程序会在初始化时读取每个 FCoE 接口的配置文件。每个 FCoE 接口都有一个配置文件。 </para>
    <formalpara id="byctarx" role="intro">
     <title>创建 FCoE VLAN 接口</title>
     <para/>
    </formalpara>
    <para role="intro">选择已启用但未配置 FCoE 的适配器，然后单击<guimenu>是</guimenu>，以配置 FCoE 接口。指派的接口名称即会出现在列表中，例如 <filename>eth5.200</filename>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_create_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <formalpara id="byct8zs" role="intro">
     <title>删除 FCoE 接口</title>
     <para/>
    </formalpara>
    <para role="intro">选择要删除的 FCoE 接口，单击页面底部的<guimenu>删除接口</guimenu>，然后单击<guimenu>继续</guimenu>以确认。FCoE 接口值将更改为<guimenu>未配置</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_remove_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bxyqqb9" performance="required">
    <para role="intro">在<guimenu>配置</guimenu>选项卡上，可查看或修改 FCoE 系统服务的常规设置。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_configtab_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bycsz4d" role="intro">
       <title>调试：</title>
       <para>从 FCoE 服务脚本以及 <command>fcoemon</command> 守护程序启用或禁用调试消息。可用值为<guimenu>是</guimenu>或<guimenu>否</guimenu>（默认）。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bycsz4e" role="intro">
       <title>使用系统日志：</title>
       <para>指定是否将消息发送到系统日志 (<filename>/var/log/syslog</filename>)。可用值为<guimenu>是</guimenu>（默认）或<guimenu>否</guimenu>。（数据将记录到 <filename>/var/log/messages</filename> 中。）</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>如果修改设置，则单击<guimenu>确定</guimenu>保存并应用更改。设置将写入 <filename>/etc/fcoe/config</filename> 文件。</para>
   </step>
   <step id="bxyqr8g" performance="required">
    <para>单击<guimenu>确定</guimenu>保存并应用更改。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bxuri58">
  <title>使用命令配置 FCoE</title>
  <procedure id="bxupm0j">
   <step id="bxupo5v" performance="required">
    <para>以 <systemitem>root</systemitem> 用户身份登录到服务器，然后打开终端控制台。</para>
   </step>
   <step id="bxupmnl" performance="required">
    <para>使用 YaST 配置以太网网络接口卡，例如 <filename>eth2</filename>。</para>
   </step>
   <step id="bxuslhx" performance="required">
    <para>启动链路层发现协议代理守护程序 (<command>lldpad</command>)。</para>

<screen>
rclldpad start
</screen>

   </step>
   <step id="bxupmpk" performance="required">
    <para role="intro">在以太网适配器上启用数据中心桥接<filename/>。</para>

<screen>
dcbtool sc eth2 dcb on
  Version:       2
  Command:       Set Config
  Feature:       DCB State
  Port:          eth2
  Status:        Successful
</screen>

   </step>
   <step id="bynkhpe" performance="required">
    <para>启用并设置数据中心桥接的优先级流量控制 (PFC) 设置。</para>

<screen>
dcbtool sc eth&lt;x&gt; pfc e:1 a:1 w:1
</screen>

    <para>自变量设置值为：</para>
    <variablelist>
     <varlistentry id="bynkj1s">
      <term>e:&lt;0|1&gt;</term>
      <listitem>
       <para>控制功能启用。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bynkjej">
      <term>a:&lt;0|1&gt;</term>
      <listitem>
       <para>控制是否通过数据中心桥接交换协议向对等体推广功能。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bynkjy8">
      <term>w:&lt;0|1&gt;</term>
      <listitem>
       <para> 控制功能是否希望根据从对等体接收到的反馈来更改其操作配置。 </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step id="bxuppth" performance="required">
    <para>启用数据中心桥接，以接受交换机的 FCoE 优先级设置。</para>

<screen>
dcbtool sc eth2 app:fcoe e:1
  Version:       2
  Command:       Set Config
  Feature:       Application FCoE
  Port:          eth2
  Status:        Successful
</screen>

   </step>
   <step id="bxupsun" performance="required">
    <para>将默认的 FCoE 配置文件复制到 <filename>/etc/fcoe/cfg-eth2</filename>。</para>

<screen>
cp /etc/fcoe/cfg-ethx /etc/fcoe/cfg-eth2

</screen>

   </step>
   <step id="bxupsnh" performance="required">
    <para>启动 FCoE 发起程序服务。</para>

<screen>
rcfcoe start
  Starting FCoE initiator service
</screen>

   </step>
   <step id="bxuslzn" performance="required">
    <para>将链路层发现协议代理守护程序 (<command>lldpad</command>) 和 FCoE 发起程序服务设置为引导时启动。</para>

<screen>
chkconfig boot.lldpad on

chkconfig boot.fcoe on
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bxuptlv">
  <title>使用 FCoE 管理工具管理 FCoE 实例</title>
  <para><command>fcoeadm</command> 实用程序是 Open-FCoE 项目的以太网光纤通道 (FCoE) 管理工具。可以使用该工具创建、销毁和重置指定网络接口上的 FCoE 实例。<command>fcoeadm</command> 实用程序通过套接字接口将命令发送给正在运行的 <command>fcoemon</command> 进程。有关 <command>fcoemon</command> 的信息，请参见 <command>fcoemon(8)</command> 手册页。</para>
  <para><command>fcoeadm</command> 实用程序可让您查询 FCoE 实例的以下相关信息：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>接口</para>
   </listitem>
   <listitem>
    <para>目标 LUN</para>
   </listitem>
   <listitem>
    <para>端口统计数字</para>
   </listitem>
  </itemizedlist>
  <para> <command>fcoeadm</command> 实用程序是 <filename>fcoe-utils</filename> 包的组成部分，由 <ulink url="http://open-fcoe.org/">Open-FCoE 项目</ulink>进行维护。</para>
  <variablelist>
   <varlistentry id="bxuq220">
    <term>语法</term>
    <listitem>
     <para>以太网光纤通道管理 1.0.12 版。</para>

<screen>
fcoeadm
  [-c|--create] [&lt;ethX&gt;]
  [-d|--destroy] [&lt;ethX&gt;]
  [-r|--reset] [&lt;ethX&gt;]
  [-S|--Scan] [&lt;ethX&gt;]
  [-i|--interface] [&lt;ethX&gt;]
  [-t|--target] [&lt;ethX&gt;]
  [-l|--lun] [&lt;ethX&gt;]
  [-s|--stats &lt;ethX&gt;] [&lt;interval&gt;]
  [-v|--version]
  [-h|--help]
</screen>

    </listitem>
   </varlistentry>
   <varlistentry id="bxus2zv">
    <term>选项</term>
    <listitem>
     <variablelist>
      <varlistentry id="bxus360">
       <term><literal>-c</literal></term>
       <term><literal>--create &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>根据指定的网络接口创建 FCoE 实例。如果 Open-FCoE 服务守护程序接口没有 <command>fcoemon</command> 配置文件（<filename>/etc/fcoe/cfg-ethx</filename>；请参见 <command>fcoemon(8)</command> 手册页），则创建的 FCoE 实例将不需要数据中心桥接功能。</para>
        <formalpara id="bycrwhb">
         <title>示例：</title>
         <para>在 <filename>eth2.101</filename> 上创建 FCoE 实例：</para>
        </formalpara>

<screen>
fcoeadm -c eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxus6nh">
       <term><literal>-d</literal></term>
       <term><literal>--destroy &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>销毁指定网络接口上的 FCoE 实例。此操作不会销毁 <command>fipvlan</command> 所创建的 FCoE 实例。</para>
        <formalpara id="bycrz5k">
         <title>示例：</title>
         <para>销毁 <filename>eth2.101</filename> 上的 FCoE 实例：</para>
        </formalpara>

<screen>
fcoeadm -d eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusdp0">
       <term><literal>-h</literal></term>
       <term><literal>--help </literal></term>
       <listitem>
        <para>显示 <command>fcoeadm</command> 命令的用法消息。</para>
       </listitem>
      </varlistentry>
      <varlistentry id="bxusaym">
       <term><literal>-i</literal></term>
       <term><literal>--interface [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>显示指定网络接口上的 FCoE 实例的相关信息。如果没有指定网络接口，则会显示所有 FCoE 实例的信息。</para>
        <formalpara id="bycrz5l">
         <title>示例</title>
         <para/>
        </formalpara>
        <para>显示所有适配器及其创建了 FCoE 实例的端口的信息：</para>

<screen>
fcoeadm -i
</screen>

        <para>显示接口 <filename>eth3</filename> 上所有 FCoE 实例的相关信息：</para>

<screen>
fcoeadm -i eth3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusayp">
       <term><literal>-l</literal></term>
       <term><literal>--lun [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>显示与指定网络接口上的 FCoE 实例关联的已发现 SCSI LUN 的详细信息。如果没有指定网络接口，则会显示来自所有 FCoE 实例的 SCSI LUN 的相关信息。</para>
        <formalpara id="bycs78a" role="intro">
         <title>示例</title>
         <para/>
        </formalpara>
        <para role="intro">显示在所有 FCoE 连接上发现的所有 LUN 的详细信息：</para>

<screen>
fcoeadm -l
</screen>

        <para>显示在 <filename>eth3.101</filename> 等特定连接上发现的所有 LUN 的详细信息：</para>

<screen>
fcoeadm -l eth3.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxus75n">
       <term><literal>-r</literal></term>
       <term><literal>--reset &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>重置指定网络接口上的 FCoE 实例。此操作不会重置 <command>fipvlan</command> 所创建的 FCoE 实例。</para>
        <formalpara id="bycrz5m">
         <title>示例：</title>
         <para>重置 <filename>eth2.101</filename> 上的 FCoE 实例：</para>
        </formalpara>

<screen>
fcoeadm -r eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxuscy5">
       <term><literal>-s</literal></term>
       <term><literal>--stats &lt;eth<replaceable>X</replaceable>&gt; [interval]</literal></term>
       <listitem>
        <para>显示指定网络接口上的 FCoE 实例的统计数字（包括 FC4 统计数字）。每隔一段指定时间会显示一行。指定大于 0 的整数间隔值。间隔值是以秒为单位的间隔流逝时间。如果不指定间隔时间，则默认的间隔时间为 1 秒。</para>
        <formalpara id="bycs78b">
         <title>示例：</title>
         <para/>
        </formalpara>
        <para>您可以显示具有 FCoE 实例的特定 <filename>eth3</filename> 端口的统计信息。每隔一段时间会显示一行统计数字。若命令中未指定，则默认间隔时间为 1 秒。</para>

<screen>
fcoeadm -s eth3
</screen>

        <para>以 3 秒的时间间隔显示具有 FCoE 实例的特定 <filename>eth3</filename> 端口的统计信息。每隔一段时间会显示一行统计数字。 </para>

<screen>
fcoeadm -s eth3 3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusayn">
       <term><literal>-S</literal></term>
       <term><literal>--Scan &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>重扫描指定网络接口的新目标和 LUN。此操作不会重扫描同一端口上创建的任何 NPIV（N_Port ID 虚拟化）实例，也不会重扫描 <command>fipvlan</command> 所创建的任何 FCoE 实例。</para>
       </listitem>
      </varlistentry>
      <varlistentry id="bxusayo">
       <term><literal>-t</literal></term>
       <term><literal>--target [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>显示与指定网络接口上的 FCoE 实例关联的已发现目标的相关信息。如果没有指定网络接口，则会显示来自所有 FCoE 实例的已发现目标的相关信息。</para>
        <formalpara id="bycs3pt">
         <title>示例</title>
         <para/>
        </formalpara>
        <para>您可以显示来自具有 FCoE 实例的所有端口的所有已发现目标的相关信息。它们可能位于不同的适配卡。每一个已发现目标后面列出了所有关联的 LUN。</para>

<screen>
fcoeadm -t
</screen>

        <para>您可以显示来自具有 FCoE 实例的指定 <filename>eth3</filename> 端口的所有已发现目标的相关信息。每一个已发现目标后面列出了所有关联的 LUN。</para>

<screen>
fcoeadm -t eth3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusdp1">
       <term><literal>-v</literal></term>
       <term><literal>--version</literal></term>
       <listitem>
        <para>显示 <command>fcoeadm</command> 命令的版本。</para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry id="bxupx3p">
    <term>FCoE 响应示例</term>
    <listitem>
     <variablelist>
      <varlistentry id="bxupyie">
       <term>查看 FCoE 发起程序状态以获取 FC-ID 节点/端口号</term>
       <listitem>

<screen role="screenshot">
fcoeadm -i eth0.201
  Description:      82599EB 10-Gigabit SFI/SFP+ Network Connection 
  Revision:         01
  Manufacturer:     Intel Corporation 
  Serial Number:    001B219B258C 
  Driver:           ixgbe 3.3.8-k2 
  Number of Ports:  1      

      Symbolic Name:     fcoe v0.1 over eth0.201     
      OS Device Name:    host8     
      Node Name:         0x1000001B219B258E     
      Port Name:         0x2000001B219B258E     
      FabricName:        0x2001000573D38141     
      Speed:             10 Gbit     
      Supported Speed:   10 Gbit     
      MaxFrameSize:      2112     
      FC-ID (Port ID):   0x790003     
      State:             Online
</screen>
</listitem>
      </varlistentry>
      <varlistentry id="bxuq45l">
       <term>查看 FCoE 目标以获取 FC-ID 节点/端口号</term>
       <listitem>

<screen role="screenshot">
fcoeadm -t eth0.201  
  Interface:        eth0.201 
  Roles:            FCP Target 
  Node Name:        0x200000D0231B5C72 
  Port Name:        0x210000D0231B5C72 
  Target ID:        0 
  MaxFrameSize:     2048 
  OS Device Name:   rport-8:0-7 
  FC-ID (Port ID):  0x79000C 
  State:            Online  

LUN ID  Device Name   Capacity   Block Size  Description 
------  -----------  ----------  ----------  ----------------------------     
    40  /dev/sdqi     792.84 GB      512     IFT DS S24F-R2840-4 (rev 386C)
    72  /dev/sdpk     650.00 GB      512     IFT DS S24F-R2840-4 (rev 386C)
   168  /dev/sdgy       1.30 TB      512     IFT DS S24F-R2840-4 (rev 386C)
</screen>
</listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="bycscw6">
  <title>设置 FCoE 发起程序磁盘的分区</title>
  <para role="intro">您可以使用 <command>fdisk(8)</command> 命令为 FCoE 发起程序磁盘设置分区。</para>

<screen role="screenshot">
fdisk /dev/sdc
  Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel.
  Building a new DOS disklabel with disk identifier 0xfc691889.
  Changes will remain in memory only, until you decide to write them.
  After that, of course, the previous content won’t be recoverable.

  Warning: Invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

  Command (n for help): n
  Command action
     e    extended
     p    primary partition (1-4)

  p
     Partition number (1-4): 4
     First cylinder (1-1017, default 1): 
       Using default value 1
     Last cylinder, *cylinders or *size(K,M,G) (1-1017, default 1017):
       Using default value 1017

  Command (n for help): w
     The partition table has been altered!

     Calling loctl() to re-read partition table.
     Syncing disks.
</screen>

 </sect1>
 <sect1 id="bycscw7">
  <title>在 FCoE 发起程序磁盘上创建文件系统</title>
  <para>您可以使用 <command>mkfs(8)</command> 命令在 FCoE 发起程序磁盘上创建文件系统。</para>

<screen role="screenshot">
mkfs /dev/sdc
  mke2fs 1.41.9 (22-Aug-2011)
  /dev/sdc is entire device, not just one partition!
  Proceed anyway? (y, n) y
  Filesystem label=
  OS type: Linux
  Block size=4096 (log-2)
  262144 inodes, 1048576 blocks
  52428 blocks (5.00%) reserved for the super user
  First data block=0
  Maximum filesystem blocks=1073741824
  32 block groups
  32768 blocks per group, 32768 fragments per group
  8192 inodes per group
  Superblock backups stored on blocks:
          32768, 98304, 163840, 229376, 294912, 819200, 804736

  Writing inode tables: done
  Writing superblocks and filesystem accounting information: done

  This filesystem will be automatically checked every 27 mounts or
  180 days, whichever comes first. Use tune2fs -c or -i to override.
</screen>

 </sect1>
 <sect1 id="bxuqb00">
  <title>其他信息</title>
  <para>有关信息，请参见以下文档：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>有关 Open-FCoE 服务守护程序的信息，请参见 <command>fcoemon(8)</command> 手册页。</para>
   </listitem>
   <listitem>
    <para>有关 Open-FCoE 管理工具的信息，请参见 <command>fcoeadm(8)</command> 手册页。</para>
   </listitem>
   <listitem>
    <para>有关数据中心桥接配置工具的信息，请参见 <command>dcbtool(8)</command> 手册页。</para>
   </listitem>
   <listitem>
    <para>有关链路层发现协议代理守护程序的信息，请参见 <filename>lldpad(8)</filename> 手册页。</para>
   </listitem>
   <listitem>
    <para><ulink url="http://www.open-fcoe.org/open-fcoe/wiki/quickstart"><citetitle>开放以太网光纤通道快速入门</citetitle></ulink>。</para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>

<chapter id="snapshots" lang="en" xml:base="07_snapshots.xml">
 <title>LVM 卷快照</title>
 <para>逻辑卷管理器 (LVM) 逻辑卷快照是一种写入时复制技术，它会监控现有卷数据块的更改，以便在对其中一个块执行写入操作时，将进行快照时块的值复制到快照卷。这样，便可保留数据的时间点副本，直到快照卷删除为止。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi7xb8b" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biu259x" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi7uzm8" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="snapshot_xen_host" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvconvert_merge" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi7xb8b">
  <title>了解卷快照</title>
  <para>文件系统快照包含自从拍摄快照后更改过的来源逻辑卷的元数据及数据块。通过快照访问数据时，您会看到复制来源逻辑卷的时间点。不需要从备份媒体恢复数据或重写更改过的数据。 </para>
  <important>
   <para>在快照有效期内，必须先装入快照，然后才能装入其来源逻辑卷。</para>
  </important>
  <para>LVM 卷快照可用于从文件系统的时间点视图创建备份。快照是即时创建并永久保留的，直到您将其删除为止。可以在卷本身对于其他用户仍然可用的同时从快照备份文件系统。快照最初包含自身相关的一些元数据，但不包含来源逻辑卷的实际数据。快照使用写时复制技术在原始数据块中的数据发生更改时进行检测。当对快照卷中的块捕获快照时，它会复制所包含的值，然后允许在来源块中储存新的数据。随着来源逻辑卷上有更多块更改其原始值，快照大小将会增大。 </para>
  <para>调整快照大小时，请考虑来源逻辑卷中要更改的数据量，以及要保留快照的时间。您为快照卷分配的空间量因以下因素而异：来源逻辑卷的大小、计划保留快照的时间，以及在快照有效期中预期会更改的数据块数。快照卷创建后不能调整大小。从原则上说，应创建一个约占原始逻辑卷大小 10% 的快照卷。如果您预测在删除快照前，来源逻辑卷中的每个块都会至少更改一次，则快照的容量至少应相当于来源逻辑卷的容量加上部份额外空间，其中后者用于储存快照卷的相关元数据。如果数据更改不那么频繁或如果预期的有效期足够短，则需要的空间较少。</para>
  <para>在 LVM2 中，快照默认为读/写。直接将数据写入快照时，该块在例外表格中标示为使用，不会从来源逻辑卷中复制。您可以装载快照卷，并通过直接将数据写入快照卷来测试应用更改。您可以通过卸载快照，去除快照，然后重新装入来源逻辑卷，轻松放弃更改。 </para>
  <para>在虚拟 Guest 环境中，您可以像在物理服务器上一样，对您在服务器磁盘上创建的 LVM 逻辑卷使用快照功能。</para>
  <para>在虚拟主机环境中，您可以使用快照功能来备份虚拟机的储存后端，或测试对虚拟机映像（例如用于修补程序或升级）进行的更改，而不必修改来源逻辑卷。虚拟机必须将 LVM 逻辑卷用做其储存后端，以免使用虚拟磁盘文件。您可以装载 LVM 逻辑卷，并将它用做文件型磁盘来储存虚拟机映像；也可以指派 LVM 逻辑卷做为物理磁盘，以便将其视为块设备进行写入操作。</para>
  <para>从 SLES 11 SP3 开始，可以对 LVM 逻辑卷快照进行精简配置。如果您创建快照时未指定大小，系统会使用瘦配置。创建为瘦卷的快照在需要时使用瘦池中的空间。快照瘦卷的特性与任何其他瘦卷相同。您可以独立地激活卷、扩展卷、重命名卷、去除卷，甚至可以创建卷的快照。</para>
  <important>
   <para>若要使用群集中瘦配置的快照，来源逻辑卷及其快照必须在单个群集资源中管理。这允许卷及其快照在同一个节点上始终独占性地装载。</para>
  </important>
  <para>当用完快照后，一定要将其从系统中删除。随着来源逻辑卷上数据块的不断更改，快照终将完全填满。填满时就会处于禁用状态，导致您无法重新装载来源逻辑卷。</para>
  <para>如果您为一个来源逻辑卷创建多个快照，在去除最后创建快照之前，请先删除较旧的快照。</para>
 </sect1>
 <sect1 id="bi7uttc">
  <title>使用 LVM 创建 Linux 快照</title>
  <para>可以使用逻辑卷管理器 (LVM) 创建文件系统的快照。 </para>
  <procedure id="bi7wb4p">
   <step id="bi7wb4q" performance="required">
    <para>打开终端控制台，作为 <systemitem>root</systemitem> 用户登录，然后输入</para>

<screen>
lvcreate -s [-L <replaceable>&lt;size</replaceable>&gt;] -n <replaceable>snap_volume</replaceable> <replaceable>source_volume_path</replaceable>
</screen>

    <para>如果不指定大小，快照会创建为瘦快照。</para>
    <para>例如：</para>

<screen>
lvcreate -s -L 1G -n linux01-snap /dev/lvm/linux01
</screen>

    <para>快照将被创建为 <filename>/dev/lvm/linux01-snap</filename> 卷。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biu259x">
  <title>监视快照</title>
  <procedure id="biu25qe">
   <step id="biu25qf" performance="required">
    <para>打开终端控制台，作为 <systemitem>root</systemitem> 用户登录，然后输入</para>

<screen>
lvdisplay <replaceable>snap_volume</replaceable>
</screen>

    <para>例如：</para>

<screen>
lvdisplay /dev/vg01/linux01-snap

--- Logical volume ---
  LV Name                /dev/lvm/linux01
  VG Name                vg01
  LV UUID                QHVJYh-PR3s-A4SG-s4Aa-MyWN-Ra7a-HL47KL
  LV Write Access        read/write
  LV snapshot status     active destination for /dev/lvm/linux01
  LV Status              available
  # open                 0
  LV Size                80.00 GB
  Current LE             1024
  COW-table size         8.00 GB
  COW-table LE           512
  Allocated to snapshot  30%
  Snapshot chunk size    8.00 KB
  Segments               1
  Allocation             inherit
  Read ahead sectors     0
  Block device           254:5
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bi7uzm8">
  <title>删除 Linux 快照</title>
  <procedure id="bi7x85s">
   <step id="bi7x85t" performance="required">
    <para>打开终端控制台，作为 <systemitem>root</systemitem> 用户登录，然后输入</para>

<screen>
lvremove <replaceable>snap_volume_path</replaceable>
</screen>

    <para>例如：</para>

<screen>
lvremove /dev/lvmvg/linux01-snap
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="snapshot_xen_host">
  <title>在虚拟主机上使用虚拟机的快照</title>
  <para>如果将 LVM 逻辑卷用做虚拟机的后端储存，可以让系统灵活地管理基础设备，例如更轻松地移动储存对象、创建快照和备份数据。您可以装载 LVM 逻辑卷，并将它用做文件型磁盘来储存虚拟机映像；也可以指派 LVM 逻辑卷做为物理磁盘，以便将其视为块设备进行写入操作。您可以在 LVM 逻辑卷上创建虚拟磁盘映像，然后创建 LVM 快照。 </para>
  <para>您可以利用快照的读/写功能创建虚拟机的不同实例，并在这些实例中更改特定虚拟机实例的快照。您也可以在 LVM 逻辑卷上创建虚拟磁盘映像、创建来源逻辑卷的快照以及修改特定虚拟机实例的快照。您还可以创建来源逻辑卷的另一个快照，并修改该快照以取得不同虚拟机实例。不同虚拟机实例的大部分数据与映像一起储存在来源逻辑卷上。</para>
  <para>在 Guest 环境中，您还可以利用快照的读/写功能保留虚拟磁盘映像，同时测试修补程序或升级。您创建包含映像的 LVM 卷的快照，然后在快照位置运行虚拟机。来源逻辑卷保持不变，对机器的所有更改均写入快照。为了恢复到虚拟机映像的来源逻辑卷，您需要关闭虚拟机，然后从来源逻辑卷中去除快照。若要重新开始，请重新创建快照、装载快照，然后在快照映像上重启动虚拟机。 </para>
  <important>
   <para>下列程序使用文件型虚拟磁盘映像和 Xen 超级管理程序。对于在 SUSE Linux 平台上运行的其他超级管理程序（例如 KVM），您可以调整本节中的程序。</para>
  </important>
  <para>若要从快照卷中运行文件型虚拟机映像，请运行下列步骤：</para>
  <procedure id="b17cn63v">
   <step id="b17cnkv7" performance="required">
    <para>确保包含文件型虚拟机映像的来源逻辑卷已装载，例如在安装点 <filename>/var/lib/xen/images/&lt;<replaceable>映像名称</replaceable>&gt;</filename> 中。 </para>
   </step>
   <step id="b17cn63w" performance="required">
    <para>创建具有足够空间来储存预期差别的 LVM 逻辑卷快照。 </para>

<screen>
lvcreate -s -L 20G -n myvm-snap /dev/lvmvg/myvm
</screen>

    <para>如果不指定大小，快照会创建为瘦快照。</para>
   </step>
   <step id="b17cn8re" performance="required">
    <para>创建安装点，用于装入快照卷。</para>

<screen>
mkdir -p /mnt/xen/vm/myvm-snap
</screen>

   </step>
   <step id="b17cn8rf" performance="required">
    <para role="intro">在所创建的安装点装入快照卷。</para>

<screen>
mount -t auto /dev/lvmvg/myvm-snap /mnt/xen/vm/myvm-snap
</screen>

   </step>
   <step id="b17cnd0k" performance="required">
    <para>在文本编辑器中，复制来源虚拟机的配置文件，修改指向装入快照卷上的文件型图像文件的路径，然后储存文件，例如 <filename>/etc/xen/myvm-snap.cfg</filename>。</para>
   </step>
   <step id="b17cnd0l" performance="required">
    <para>使用虚拟机的已装入快照卷启动虚拟机。</para>

<screen>
xm create -c /etc/xen/myvm-snap.cfg
</screen>

   </step>
   <step id="b17cnd0m" performance="required">
    <para>（可选）去除快照，然后在来源逻辑卷使用未更改的虚拟机映像。</para>

<screen>
unmount /mnt/xenvms/myvm-snap
lvremove -f /dev/lvmvg/mylvm-snap
</screen>

   </step>
   <step id="b17cnd0n" performance="required">
    <para>（可选）根据需要重复此程序。 </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="lvconvert_merge">
  <title>将快照与来源逻辑卷合并以还原更改或回滚至先前的状态</title>
  <para>如果您需要将卷上的数据回滚或还原至先前的状态，快照可能非常有用。例如，如果因管理员失误，或是因包安装或升级出故障或没必要，导致数据出现更改，您可能需要予以还原。 </para>
  <para>您可以使用 <command>lvconvert --merge</command> 命令还原对 LVM 逻辑卷的更改。合并按如下所示开始：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>如果来源逻辑卷和快照卷均未打开，合并将立即开始。 </para>
   </listitem>
   <listitem>
    <para>如果来源逻辑卷或快照卷已打开，合并将在来源逻辑卷或快照卷第一次启动和同时关闭时开始。 </para>
   </listitem>
   <listitem>
    <para>如果无法关闭来源逻辑卷（例如<systemitem>根</systemitem>文件系统），系统会推迟到下一次服务器重引导并激活来源逻辑卷的时候再合并。 </para>
   </listitem>
   <listitem>
    <para>如果来源逻辑卷包含虚拟机映像，您必须关闭虚拟机，停用来源逻辑卷和快照卷（也就是依次卸下这些卷），然后发出合并命令。因为来源逻辑卷会自动重新装入，而且合并完成时会删除快照卷，所以在合并完成之前请勿重启动虚拟机。合并完成之后，您可以将生成的逻辑卷用于虚拟机。</para>
   </listitem>
  </itemizedlist>
  <para>合并开始之后，系统将在服务器重启动之后继续合并，直到合并完成。在合并期间，无法为来源逻辑卷创建新快照。 </para>
  <para>合并期间，系统对来源逻辑卷的读取或写入操作会透明地重定向到正在合并的快照，因此用户能够立即查看和访问数据，就像当时创建快照时一样，不必等到合并完成。 </para>
  <para>合并完成后，来源逻辑卷会包含与创建快照时相同的数据，加上合并开始后对数据的任何更改。生成的逻辑卷沿用了来源逻辑卷的名称、次要编号和 UUID。系统会自动重新装入来源逻辑卷，并去除快照卷。</para>
  <procedure id="b15cjobl">
   <step id="b15cjobm" performance="required">
    <para>打开终端控制台，作为 <systemitem>root</systemitem> 用户登录，然后输入</para>

<screen role="compact2">
lvconvert --merge  [-b] [-i &lt;<replaceable>seconds</replaceable>&gt;] [&lt;<replaceable>snap_volume_path</replaceable>&gt;[...&lt;snapN&gt;]|@&lt;<replaceable>volume_tag</replaceable>&gt;]
</screen>

    <para>您可以在命令行上指定一或多个快照；也可以使用相同卷标记标记多个来源逻辑卷，然后在命令行上指定 <literal>@&lt;<replaceable>卷标记</replaceable>&gt;</literal>。标记过的卷的快照会合并到其各自的来源逻辑卷中。有关标记逻辑卷的的相关信息，请参见<xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/>。</para>
    <para>选项包括：</para>
    <variablelist>
     <varlistentry id="b15ck6lb">
      <term>-b</term>
      <term>--background</term>
      <listitem>
       <para>在背景中执行守护程序，这样可以并行合并多个指定的快照。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="b15ck6lc">
      <term>-i</term>
      <term>--interval &lt;<replaceable>秒</replaceable>&gt;</term>
      <listitem>
       <para>以固定的间隔以百分比形式报告进度。指定的间隔以秒为单位。</para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>有关此命令的详细信息，请参见 <command>lvconvert(8)</command> man 页面。</para>
    <para>例如：</para>

<screen>
lvconvert --merge /dev/lvmvg/linux01-snap
</screen>

    <para>此命令将 <filename>/dev/lvmvg/linux01-snap</filename> 合并到其来源逻辑卷中。 </para>

<screen>
lvconvert --merge @mytag
</screen>

    <para>如果 <filename>lvol1</filename>、<filename>lvol2</filename> 和 <filename>lvol3</filename> 全都以 <literal>mytag</literal> 标记，每个快照卷将依序与其各自的来源逻辑卷合并；即先 <filename>lvol1</filename>，再 <filename>lvol2</filename>，然后 <filename>lvol3</filename>。如果指定了 <literal>--background</literal> 选项，相应标记过的逻辑卷的快照将并行同时合并。 </para>
   </step>
   <step id="b15clkwi" performance="required">
    <para>（可选）如果来源逻辑卷和快照卷均已打开且可以关闭，则您可以手动停用然后激活来源逻辑卷，以便让合并立即开始。</para>

<screen>
umount &lt;<replaceable>original_volume</replaceable>&gt;
lvchange -an &lt;<replaceable>original_volume</replaceable>&gt;
lvchange -ay &lt;<replaceable>original_volume</replaceable>&gt;
mount &lt;<replaceable>original_volume</replaceable>&gt; &lt;<replaceable>mount_point</replaceable>&gt;
</screen>

    <para>例如：</para>

<screen>
umount /dev/lvmvg/lvol01
lvchange -an /dev/lvmvg/lvol01
lvchange -ay /dev/lvmvg/lvol01
mount /dev/lvmvg/lvol01 /mnt/lvol01
</screen>

   </step>
   <step id="b15clm73" performance="required">
    <para>（可选）如果来源逻辑卷和快照卷均已打开且来源逻辑卷不能关闭（例如<systemitem>根</systemitem>文件系统），则您可以重启动服务器并装入来源逻辑卷，以让合并在重启动之后立即开始。</para>
   </step>
  </procedure>
 </sect1>
</chapter>

<chapter id="nfsv4acls" lang="en" xml:base="08a_nfsv4_acls.xml">
 <title>管理 NFSv4 访问控制列表</title>
 <para>Linux 中除了简单的“用户-组-其他人”读、写和执行 (<literal>rwx</literal>) 标志外，没有一个访问控制列表 (ACL) 标准。一个较好的控制选项是<citetitle>草稿 POSIX ACL</citetitle>，它从未被 POSIX 正式标准化。另一个选择是 NFSv4 ACL，它是 NFSv4 网络文件系统的一部分，目的是为了在 Linux 上的 POSIX 系统与 Microsoft Windows 上的 WIN32 系统之间提供适当的兼容性。</para>
 <para>NFSv4 ACL 不足以正确实施草稿 POSIX ACL，因此未进行在 NFSv4 客户端上映射 ACL 访问的尝试（比如使用 <command>setfacl</command>）。</para>
 <para>使用 NFSv4 时，连在仿真模式下也无法使用草稿 POSIX ACL，并且需要直接使用 NFSv4 ACL；即虽然 <command>setfacl</command> 能够在 NFSv3 上运行，却不能在 NFSv4 上运行。为了实现在 NFSv4 文件系统上使用 NFSv4 ACL 的目的，SUSE Linux Enterprise Server 提供了 <filename>nfs4-acl-tools</filename> 包，其中包含下列各项：</para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para><filename>nfs4-getfacl</filename></para>
  </listitem>
  <listitem>
   <para><filename>nfs4-setfacl</filename></para>
  </listitem>
  <listitem>
   <para><filename>nfs4-editacl</filename></para>
  </listitem>
 </itemizedlist>
 <para>它们的操作方式通常与 <command>getfacl</command> 和 <command>setfacl</command> 类似，用于检查及修改 NFSv4 ACL。这些命令仅当 NFS 服务器上的文件系统完全支持 NFSv4 ACL 时才有效。虽然某些访问控制项 (ACE) 的特定组合可能在客户端中不可用，但客户端上运行的程序都将受到服务器施加的任何限制的影响。</para>
 <para>不支持在输出 NFS 服务器上本地装入 NFS 卷。</para>
 <bridgehead id="bxut1i2">其他信息</bridgehead>
 <para>有关信息，请参见 <ulink url="http://wiki.linux-nfs.org/wiki/index.php/ACLs#Introduction_to_NFSv4_ACLs">Linux-nfs.org 网站上的<quote>NFSv4 ACL 简介</quote></ulink>。</para>
</chapter>

<chapter id="trbl" lang="en" xml:base="08_troubleshooting.xml">
 <title>储存问题查错</title>
 <para>本章描述如何解决有关设备、软件 RAID、多路径 I/O 和卷的已知问题。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="trblmpioboot" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="trbl_btrfs_volfull" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpklm" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpgil" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjphka" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="ts_iscsi_lio" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="trblmpioboot">
  <title>引导分区是否可用 DM-MPIO？</title>
  <para>从 SUSE Linux Enterprise Server 10 支持包 1 开始，引导分区支持设备映射程序多路径 I/O (DM-MPIO)。有关信息，请参见<xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="trbl_btrfs_volfull">
  <title>Btrfs 错误：设备上没有剩余空间 </title>
  <para>使用 Btrfs 文件系统的根 (<filename>/</filename>) 分区停止接受数据。您收到错误<quote><literal>设备上没有剩余空间</literal></quote>。</para>
  <para>请参见下列各部分，了解有关此问题的可能原因和预防措施的信息。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b15tk0m4" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15tk0m7" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b15tk0m4">
   <title>快照程序快照使用的磁盘空间</title>
   <para>如果快照程序是针对 Btrfs 文件系统运行的，则<quote><literal>设备上没有剩余空间</literal></quote>问题通常是由于系统上做为快照储存的数据过多所致。</para>
   <para>您可以从快照程序中去除一些快照，不过，快照不会立即删除，可能不能释放您需要的空间容量。 </para>
   <para>若要从快照程序中删除文件：</para>
   <procedure id="b15q34ft">
    <step id="b15tk0m5" performance="required">
     <para>以 <systemitem>root</systemitem> 用户身份登录，然后打开终端控制台。</para>
    </step>
    <step id="b15tk9ch" performance="required">
     <para>收回系统启动所需的足够空间。</para>
     <substeps performance="required">
      <step id="b15tk0m6" performance="required">
       <para>在命令提示符处输入</para>

<screen>
btrfs filesystem show
</screen>


<screen>
Label: none uuid: 40123456-cb2c-4678-8b3d-d014d1c78c78
 Total devices 1 FS bytes used 20.00GB
 devid 1 size 20.00GB used 20.00GB path /dev/sda3
</screen>

      </step>
      <step id="b15q34fu" performance="required">
       <para>输入</para>

<screen>
btrfs fi balance start &lt;<replaceable>/mountpoint</replaceable>&gt; -dusage=5
</screen>

       <para>此命令会尝试将数据重新放置在空的或接近空的数据块中，从而允许收回空间并将其重新指派给元数据。此操作可能需要一些时间（1 TB 数据可能需要许多小时），不过，在此期间系统仍可以使用。 </para>
      </step>
     </substeps>
    </step>
    <step id="b15q34fv" performance="required">
     <para>列出快照程序中的快照。输入</para>

<screen>
snapper -c root list
</screen>

    </step>
    <step id="b15q34fw" performance="required">
     <para role="intro">从快照程序中删除一或多个快照。输入</para>

<screen>
snapper -c root delete #
</screen>

     <para>务必先删除最旧的快照。快照生成的时间越长，其占用的空间就越大。 </para>
    </step>
   </procedure>
   <para>为防止该问题的发生，您可以将 <filename>/etc/snapper/configs/root</filename> 配置文件中的快照程序清理默认值更改为更为激进的数值，或更改为针对其他的安装点。快照程序提供有三种清理旧快照的算法。这些算法以每天计划作业方式执行。快照程序安装点的配置中定义了清理频率。请将每日、每月和每年的 TIMELINE_LIMIT 参数设置得较低，以缩短快照的保留时间并减少其数量。有关信息，请参见<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html">《SUSE Linux Enterprise Server 11 SP3 管理指南》</ulink>中的<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_snapper_config.html#sec_snapper_config_modify"><quote>调整配置文件</quote></ulink>。<citetitle/></para>
   <para>如果在文件系统磁盘上搭配使用快照程序和 Btrfs，建议您保留两倍于标准储存建议的磁盘空间容量。YaST 分区程序会自动在 Btrfs 储存建议中为根文件系统建议标准磁盘空间的两倍容量。</para>
  </sect2>
  <sect2 id="b15tk0m7">
   <title>日志、崩溃和缓存文件使用的磁盘空间 </title>
   <para>如果系统磁盘填满了数据，您可以尝试从 <filename>/var/log</filename>、<filename>/var/crash</filename> 和 <filename>/var/cache</filename> 中删除文件。</para>
   <para>Btrfs <systemitem>根</systemitem>文件系统子卷 <filename>/var/log</filename>、<filename>/var/crash</filename> 和 <filename>/var/cache</filename> 在正常运作情况下可能会使用所有可用的磁盘空间，此时将导致系统故障。为避免出现此状况，SUSE Linux Enterprise 11 SP3 提供了 Btrfs 子卷定额支持。有关详细信息，请参见 <filename>btrfs(8)</filename> 手册页。</para>
  </sect2>
 </sect1>
 <sect1 id="bpjpklm">
  <title>多路径 I/O 问题</title>
  <para>请参见<xref linkend="bpjpirk" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="bpjpgil">
  <title>软件 RAID 问题</title>
  <para>请参见<xref linkend="bgchysg" xrefstyle="AppTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="bpjphka">
  <title>iSCSI 问题</title>
  <para>请参见<xref linkend="sec_inst_system_iscsi_ts" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="ts_iscsi_lio">
  <title>iSCSI LIO 目标的问题</title>
  <para>请参见<xref linkend="b13g8i2g" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
</chapter>

<appendix conformance="sles11,Novell,no,0,80" id="common_legal" revision="01/01/03" xml:base="appendix_common_legal.xml">
 <title>GNU 许可证</title>
 <para>此附录包含 GNU 通用公共许可证版本 2 和 GNU 自由文档许可证版本 1.2。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="common_gplv2_i" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="gfdl_i" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="common_gplv2_i" role="legal" xml:base="common_gplv2_i.xml">
  <title>GNU 通用公共许可证</title>
  <para>版本 2，1981 年 6 月 </para>
  <para>Copyright (C) 1989, 1991 Free Software Foundation, Inc. 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA </para>
  <para>允许任何人复制和分发此许可证文档的逐字副本，但禁止对其进行更改。 </para>
  <sect2 id="gplv2_preamble">
   <title>导言</title>
   <para>大多数软件许可证的目的是为了剥夺您共享和更改软件的自由。与之相反，GNU 通用公共许可证旨在保证您可以自由共享和更改自由软件，即确保软件对其所有用户都是自由的。本通用公共许可证适用于自由软件基金会的大多数软件以及由作者提交使用的任何其他程序。（其他一些自由软件基金会软件遵照 GNU 库通用公共许可证。）您也可以将它应用于自己的程序。 </para>
   <para>我们所说的“自由”软件，是指自由而非价格。我们的通用公共许可证旨在确保您能够自由分发自由软件副本（以及根据需要对此服务收取费用）、获得源代码（或根据需要获取）、更改软件或将其某些部分用在新的自由程序中；并使您知道自己可以做这些事情。 </para>
   <para>为了保护您的权利，我们需要作出某些限制，以防止任何人剥夺或要求您放弃这些权利。如果您分发软件的副本或修改它，这些限制同样会转化为您的某些责任。 </para>
   <para>例如，无论您免费或有偿分发这样的程序副本，都必须向接收者提供您拥有的所有相关权利。您必须确保他们也会收到或能够获得源代码。而且您必须向他们提供这些条款，以便他们能够了解其权利。 </para>
   <para>我们采用两步措施保护您的权利：(1) 取得软件的版权，(2) 为您提供此许可证，使您获得复制、分发和/或修改此软件的合法权限。 </para>
   <para>此外，为了保护每个作者和我们自己，我们希望所有人都明确地知道这个自由软件不提供任何担保。如果此软件经过某人的修改后分发给别人，我们希望接收者了解他们收到的不是原始软件，以便由其他人带来的任何问题不会影响原作者的声誉。 </para>
   <para>最后，任何自由程序都会经常受到软件专利的威胁。自由程序的再分发者可能会个人获得专利许可证，从而使该程序变为专有程序，我们希望避免这样的危险。为了防止这一点，我们必须明确，申请任何专利必须是为了所有人能够自由使用这些自由程序，否则不要为这些自由程序申请专利。 </para>
   <para>下面是有关复制、分发和修改的具体条款和条件。 </para>
  </sect2><?dbfo-need height="20em"?>


  <sect2 id="gplv2_terms">
   <title>GNU 通用公共许可证关于复制、分发和修改的条款和条件</title>
   <formalpara id="bw4vaov">
    <title>0.</title>
    <para>此许可证适用的对象：由版权所有者在其中明确声明可按照此通用公共许可证条款分发的任何程序和其他作品。以下所述的本<quote>程序</quote>是指任何此类程序或作品，<quote>基于本程序的作品</quote>表示受版权法保护的本程序或任何衍生作品：即，包含本程序或本程序一部分的作品，无论本程序是按原样还是经过修改和/或被翻译成其他语言。（在下文中，<quote>修改</quote>一词将没有限制地包含翻译的意思。）每个获得许可证的人都被称为<quote>您</quote>。 </para>
   </formalpara>
   <para>本许可证不适用于复制、分发和修改之外的其他活动；它们超出了本许可证的适用范围。运行本程序的行为不受限制，对于本程序生成的输出，仅当其内容构成了基于本程序的作品时才在此许可证的适用范围之内（与是否是通过运行本程序生成的无关）。判断其内容是否构成基于本程序的作品的依据是本程序的用途。 </para>
   <formalpara id="bw4vaow">
    <title>1.</title>
    <para>您可以采用任何媒体来复制和分发本程序源代码的逐字副本，前提是您必须：显著而适当地在其每个副本上提供适当的版权声明和免责声明；保持涉及本许可证和不提供任何担保的所有声明的完整性；并随本程序为任何其他接收者提供本许可证的副本。 </para>
   </formalpara>
   <para>您可以为分发副本的实际行为收取费用，也可以选择为提供担保保护而收取费用。 </para>
   <formalpara id="bw4vaox">
    <title>2.</title>
    <para>您可能会修改本程序的任何副本或任何部分，并由此形成基于本程序的作品，此时您可以按照第 1 节的规定复制和分发这些修改或作品，但必须满足以下所有条件： </para>
   </formalpara>
   <formalpara id="bw4vaoy">
    <title>a)</title>
    <para>您必须在被修改的文件中提供显著声明，指出您更改了这些文件并给出更改日期。 </para>
   </formalpara>
   <formalpara id="bw4vaoz">
    <title>b)</title>
    <para>如果要分发或发布全部或部分包含本程序或其任何部分、以及从本程序或其任何部分衍生的任何作品，都必须在本许可证条款的规定下以一个整体为所有第三方免费提供许可证。 </para>
   </formalpara>
   <formalpara id="bw4vap0">
    <title>c)</title>
    <para>如果经过修改的程序在运行时通常以交互方式读取命令，在为了实现这种交互使用而以最普通的方式开始运行它时，必须使它输出和显示一条声明，其中应包含适当的版权声明和不提供任何担保的声明（或者声明您提供担保），并告知用户可以在这些条款和条件下再分发此程序以及如何查看本许可证的副本。（例外：如果程序本身是交互式的但通常不做出这样的声明，则您的基于本程序的作品就不需要做出声明。） </para>
   </formalpara>
   <para>这些要求也适用于作为一个整体经过修改的作品。如果作品可以确认的组成部分不是从本程序中衍生的，并且有充分理由将其本身视为独立和单独的作品，则当您将这些组成部分作为单独的作品分发时，就不受本许可证及其条款的约束。但是，如果您分发的作品的某些组成部分与基于本程序的作品整体的一部分相同时，则此作品的分发必须在整体上遵照本许可证的条款，它为其他许可证获得者提供的权限将延伸到整个作品，并由此延伸到每一部分，而不考虑每一部分的作者是谁。 </para>
   <para>因此，本节的意图不是主张拥有或争夺完全由您创作的作品的权利；相反，我们的意图是行使控制基于本程序的衍生性或集合性作品分发的权利。 </para>
   <para>此外，如果只是将不基于本程序的另一作品和本程序（或基于本程序的作品）一起储存在某个储存或分发媒体上，则另一作品并不受本许可证的约束。 </para>
   <formalpara id="bw4vap1">
    <title>3.</title>
    <para>您可以在第 1 节和 2 节条款的规定下以结果代码或可执行表单的形式复制和分发本程序（或基于它的作品，按照第 2 节的规定），但前提是必须满足以下要求之一： </para>
   </formalpara>
   <formalpara id="bw4vap2">
    <title>a)</title>
    <para>随本程序提供完整的、对应的计算机可读源代码，且这些源代码必须按照第 1 节和第 2 节条款的规定在某种通常用于软件交换的媒体上分发。 </para>
   </formalpara>
   <formalpara id="bw4vap3">
    <title>b)</title>
    <para>随本程序为任何第三方提供一个有效期至少为三年的书面收费报价，该报价不得高于进行源代码分发而实际发生的成本，并提供对应源代码的完整的计算器可读副本，同时，该副本必须按照第 1 节和第 2 节条款的规定在某种通常用于软件交换的媒体上分发。 </para>
   </formalpara>
   <formalpara id="bw4vap4">
    <title>c)</title>
    <para>随本程序提供您收到的有关分发对应源代码的报价信息。（仅当您的分发为非商业性、并且您收到了带有这一报价的采用结果代码或可执行表单形式的程序（与上述 b 小节一致）时，才能使用此选择。） </para>
   </formalpara>
   <para>作品的源代码表明了对它进行修改时的首选作品形式。对于可执行作品，完整源代码表示它包含的所有模块的所有源代码、任何相关接口定义文件以及用于控制可执行文件的编译和安装的脚本。但有一种特殊情况，要分发的源代码不需要包含通常要与可执行文件在其上运行的操作系统的主要部件（编译器、内核等）一起（以源代码或二进制形式）分发的任何对象，除非这些部件本身带有可执行文件。 </para>
   <para>如果采用提供指定地址供接收者复制的方式来分发可执行文件或结果代码，则分发源代码就必须为第三方提供等效的访问权限在相同的地址复制源代码，虽然并不要求第三方在复制结果代码时一定要复制源代码。 </para>
   <formalpara id="bw4vap5">
    <title>4.</title>
    <para>除本许可证中有明确规定外，您不能对本程序进行复制、修改、分授许可或分发。在本许可证规定外对本程序所进行的任何复制、修改、分授许可或分发都是无效的，并且将自动终止您在本许可证下所拥有的权利。但是，对于在此许可证的规定下从您这里获得副本或权利的各方，只要其完全遵守此许可证的规定，其许可证将不会被终止。 </para>
   </formalpara>
   <formalpara id="bw4vap6">
    <title>5.</title>
    <para>由于您还没有对本许可证签名，我们不要求您接受本许可证。但是，除本许可证之外，没有任何东西可授予您修改或分发本程序或其衍生作品的权利。如果您不接受本许可证，则这些活动就被法律所禁止。因此，如果您修改或分发了本程序（或基于本程序的任何作品），即表明您接受了本许可证来进行这样的活动，也就是接受了它所有的关于复制、分发或修改本程序或基于本程序的作品的条款和条件。 </para>
   </formalpara>
   <formalpara id="bw4vap7">
    <title>6.</title>
    <para>每次您再分发本程序（或任何基于本程序的作品）时，接收者应自动收到来自原始许可人的许可证，接收者可按照这些条款和条件复制、分发或修改本程序。您不能对接收者行使在许可证中获得的权利施加任何其他限制。您不负责强制第三方遵守本许可证。 </para>
   </formalpara>
   <formalpara id="bw4vap8">
    <title>7.</title>
    <para>如果由于法庭判决或专利侵权诉讼或任何其他原因（并不限于专利事宜），而造成向您施加的条款和条件（无论是法院指令、协议或其他）与本许可证的条款和条件冲突，它们并不能使您免受本许可证的条款和条件的约束。如果在分发本程序时不能同时满足本许可证规定的义务和任何其他相关义务，则您就根本不能分发本程序。例如，如果某专利许可证禁止通过您直接或间接收到本程序副本的所有人对本程序进行无版税再分发，则要同时满足此规定和本许可证条款和条件的唯一方法就是您完全不分发本程序。 </para>
   </formalpara>
   <para>如果本节的任何部分在任何特定情形下变得无效或无法执行，则本节的其他部分仍适用，而且本节作为一个整体仍适用于其他情形。 </para>
   <para>本节的目的不在于诱使您侵犯专利或其他财产权主张，或争论这种主张的有效性。本节的唯一目的在于保护自由软件分发体系的完整性，它是通过通用许可证的应用来实现的。许多人相信这一体系的一致应用，并且慷慨地贡献了许多软件来通过这一体系进行分发。作者/捐赠者拥有全部权利来决定他/她是否愿意通过任何其他体系分发软件，许可证获得者不能强制他们作出选择。 </para>
   <para>本节的目的在于明确说明本许可证其余部分所产生的结果。 </para>
   <formalpara id="bw4vap9">
    <title>8.</title>
    <para>如果本程序的分发和/或使用在某些国家/地区受到专利或受版权保护接口的限制，那么将本程序置于本许可证约束下的原始版权所有者可以明确添加分发地理限制来排除这些国家/地区，从而使得分发只能在未排除的国家/地区进行。在这种情况下，本许可证将包括这些限制，其效力同写入本许可证正文的条款和条件一样。 </para>
   </formalpara>
   <formalpara id="bw4vapa">
    <title>9.</title>
    <para>自由软件基金会有时会发布通用公共许可证的修订版和/或新版本。这些新版本的主旨和精神与当前版本是一致的，但在解决新问题的具体细节方面可能有所不同。 </para>
   </formalpara>
   <para>每个版本都有一个不同的版本号。如果本程序指定了它所应用的本许可证的某个版本和<quote>任何以后版本</quote>，则您可以选择遵照此版本或自由软件基金会发布的任何以后版本的条款和条件。如果本程序没有指定本许可证的版本号，您可以选择自由软件基金会发布的任何版本的许可证。 </para>
   <formalpara id="bw4vapb">
    <title>10.</title>
    <para>如果希望将本程序的某些部分包含在其分发条款和条件不同的其他自由程序中，请致函作者来获得许可。对于受自由软件基金会版权保护的软件，应致函自由软件基金会；我们有时对此有例外处理。我们的决定以两个目标为导向，第一个目标是保持我们的自由软件的所有衍生作品的自由状态，第二个目标是广泛地促进软件的共享和重用。 </para>
   </formalpara>
   <sect3 id="gplv2_nowarranty">
    <title>不担保条款</title>
    <formalpara id="bw4vapd">
     <title>11.</title>
     <para>因为本程序为免费许可，所以在适用法律允许范围内，对本程序不提供任何担保。除非版权持有人和/或其他各有关方另行书面声明，否则本程序将“按原样”提供，而不做任何明示或默示担保，包含但不限于对适销性和适于特定用途的默示担保。有关本程序质量和性能的风险完全由您承担。如果证实程序有缺陷，您需要承担所有必需的维护、修复或更正的成本。 </para>
    </formalpara>
    <formalpara id="bw4vape">
     <title>12.</title>
     <para>除非适用法律要求或书面同意，否则在任何情况下任何版权持有人或可能如上所述被允许修改和/或重新分发本程序的任何其他方，对您的损害概不负责。包括由于使用或不能使用本程序任何一般、特殊、伴随或结果性的损害，包括但不限于您或第三方数据丢失或数据输出转换不正确或丢失，或本程序无法与其他程序一起使用，即使已经告知此类持有人或其他方此类损害的可能性。 </para>
    </formalpara>
   </sect3>
   <sect3 id="gplv2_endterms">
    <title>条款和条件结束</title>
    <para/>
   </sect3>
  </sect2>
  <sect2 id="gplv2_apply">
   <title>如何将这些条款应用于您的新程序</title>
   <para>如果您开发了一个新程序并希望使它最大限度地对公众有用，最好的方法是使它成为自由软件，这样每个人都可以在这些条款的规定下再分发和更改它。 </para>
   <para>要做到这一点，请为您的程序附加以下声明。最安全的方式是将它们附加在每个源文件的开头，以便最有效地表明此程序不提供担保；而且每个文件至少有<quote>版权声明</quote>行以及指向完整声明所在位置的指示。 </para>

<screen>
one line to give the program’s name and an idea of what it does. 
Copyright (C) yyyy name of author

</screen>


<screen>
This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

</screen>


<screen>
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

</screen>


<screen>
You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307,
USA.

</screen>

   <para>另外还要添加您的电子邮件和邮政地址等联系信息。 </para>
   <para>如果此程序是交互式的，使它在交互方式下启动时输出如下简短声明： </para>

<screen>
Gnomovision version 69, Copyright (C) year name of author
Gnomovision comes with ABSOLUTELY NO WARRANTY; for details
type `show w’. This is free software, and you are welcome
to redistribute it under certain conditions; type `show c’ 
for details.

</screen>

   <para>假设的命令 `show w' 和 `show c' 应显示通用公共许可证的相应部分。当然，您使用的命令也可以不称为 `show w' 和 `show c'；它们甚至可以是鼠标点击或菜单项 即可以是适合您的程序的任何形式。 </para>
   <para>如果需要，您应让您的雇主（如果您是程序员）或学校（如果有）为该程序签署一份<quote>版权免责声明</quote>。下面是一个示例（可更改其名称）： </para>

<screen>
Yoyodyne, Inc., hereby disclaims all copyright
interest in the program `Gnomovision’
(which makes passes at compilers) written 
by James Hacker.

</screen>


<screen>
signature of Ty Coon, 1 April 1989
Ty Coon, President of Vice

</screen>

   <para>本通用公共许可证不允许将您的程序包含在专有程序中。如果您的程序是一个子例程库，您可能认为允许专有应用程序链接此库会更有用。如果您希望这样做，请使用 GNU 较宽松通用公共许可证来代替本许可证。 </para>
   <para/>
   <para/>
   <para/>
   <para/>
   <para/>
  </sect2>
 </sect1>
 <sect1 id="gfdl_i" role="legal" xml:base="common_gfdl_i.xml">
  <title>GNU 自由文档许可证</title>
  <para>版本 1.2，2002 年 11 月 </para>
  <para>Copyright (C) 2000,2001,2002 Free Software Foundation, Inc. 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA </para>
  <para>允许任何人复制和分发此许可证文档的逐字副本，但禁止对其进行更改。 </para>
  <sect2 id="gfdl_preamble">
   <title>导言</title>
   <para>此许可证的目的是赋予手册、教科书或其他功能性的和有用的文档以“自由”：即保证每个人都有复制和再分发此类文档的有效自由，无论是否进行修改，也无论将其用于商业或非商业用途。其次，此许可证为作者和出版者保留了因工作获得声誉但不视为对他人所做修改负责的方式。 </para>
   <para>此许可证是一种<quote>非盈利版权</quote>，这意味着从该文档衍生的作品也必须是以同一方式自由的。它补充了 GNU 通用公共许可证（为自由软件设计的非盈利版权许可证）。 </para>
   <para>我们设计此许可证旨在将其用于免费软件的手册，因为免费软件需要自由文档：免费程序所附手册应具有与软件本身同样的自由。但是此许可证不限于软件手册；它可以用于任何文本作品，无论主题如何或它是否作为印刷书籍出版。建议本许可证主要用于目的是指导或参考的作品。 </para>
  </sect2>
  <sect2 id="gfdl_definitions">
   <title>适用性和定义</title>
   <para>此许可证适用的对象：由版权所有者在其中明确声明可按照此许可证条款以任何媒体分发的任何手册和其他作品。此类声明授予在此处所述的条款和条件下使用该作品的全球无限期无版权许可证。下述<quote>文档</quote>指任何此类手册或作品。任何公共成员都是一个被许可人，以下称为<quote>您</quote>。如果您以需要版权法许可的任何方式复制、修改或分发该作品，则表示您接受该许可证。 </para>
   <para>该文档的<quote>修改版本</quote>表示包含该文档或其一部分（或者逐字复制或有修改和/或翻译为另一语言）的任何作品。 </para>
   <para><quote>次要章节</quote>是该文档的命名附录或扉页章节，专门讲述该文档的出版者或作者与该文档整个主题（或相关问题）的关系，不包含与整个主题相关的内容。（因此，如果该文档是数学课本的一部分，则辅助部分可能不说明任何数学问题。）这种关系可以是与主题或相关问题的历史联系，或与它们相关的法律、商业、哲学、伦理或政治地位。 </para>
   <para>在该文档基于此许可证项发布的声明中，<quote>固定章节</quote>是将其标题指定为固定章节标题的一些辅助章节。如果一个章节不适用上述辅助章节的定义，则不允许将其指定为固定章节。该文档可能不包含固定章节。如果该文档不标识任何固定章节，则表示没有固定章节。 </para>
   <para>在该文档基于此许可证项发布的声明中，<quote>封页文本</quote>是作为封面文本或封底文本列出的简短文本段落。封面文本最多 5 个单词，封底文本最多 25 个单词。 </para>
   <para>文档的<quote>透明</quote>副本是一个计算机可读的副本，使用公众可以得到其规范的格式表达，这样的副本适合于使用通用文本编辑器、（对于像素构成的图像）通用绘图程序、（对于绘制的图形）广泛使用的绘画编辑器，也适用于输入到文本格式处理程序或自动翻译成各种适于输入到文本格式处理程序的格式。一个用其他透明文件格式表示的副本，如果该格式的标记（或缺少标记）已经构成了对读者的后续修改的障碍，那么就是不透明的。表示实质性数量的文本的图像格式都是不透明的。不<quote>透明</quote>的副本称为<quote>不透明</quote>。 </para>
   <para>适于作为透明副本的格式的示例有：没有标记的纯 ASCII 文本、Texinfo 输入格式、LaTeX 输入格式、使用公共可用 DTD 的 SGML 或 XML，符合标准的简单 HTML、可以人为修改的 PostScript 或 PDF。透明图像格式的示例有 PNG、XCF 和 JPG。不透明的格式包括：仅可以被私有版权的字处理软件使用的私有版权格式、所用的 DTD 和/或处理工具不是广泛可用的的 SGML 或 XML、机器生成的 HTML、一些字处理器生成的只用于输出目的的 PostScript 或 PDF。 </para>
   <para>对于印刷书籍，<quote>扉页</quote>就是扉页本身以及随后的一些用于补充的页，显然本许可资料需要出现在扉页上。对于那些没有扉页的作品形式，<quote>扉页</quote>代表接近作品最突出标题的、在文本正文之前的文本。 </para>
   <para>章节<quote>命名 XYZ</quote>表示文档的一个特定的子单元，其标题就是 XYZ 或在括号中包含 XYZ 且后跟 XYZ 的其他语言翻译文本。（这里 XYZ 代表下面提及的特定章节名称，比如<quote>致谢</quote>、<quote>题献</quote>、<quote>签名</quote>或<quote>历史</quote>。）要在修改文档时对这类章节<quote>保留标题</quote>就是依据此定义保持这样一个<quote>命名 XYZ</quote>章节。 </para>
   <para>文档可能在文档遵照此许可证的声明后面包含免责声明。这些免责声明应作为参考信息包含在此许可证中，但是只能将其视作免责声明：这些免责声明暗指的任何其他含义均无效，且对此许可证的含义不产生任何影响。 </para>
  </sect2>
  <sect2 id="gfdl_verbatim">
   <title>逐字复制</title>
   <para>您可以用任何媒体复制并分发文档，无论是否出于商业目的，只要保证此许可证、版权声明和声称此许可证应用于文档的声明都完整地、无任何附加条件地存在于所有副本中。不能使用任何技术手段阻碍或控制您制作或发布的副本的阅读或再次复制。不过您可以在副本交易中得到报酬。如果发布足够多的副本，则您必须遵循下面第三节中的条件。 </para>
   <para>您也可以在如上的条件下出租副本和向公众放映副本。 </para>
  </sect2>
  <sect2 id="gfdl_quantity">
   <title>大量复制</title>
   <para>如果您出版的文档印刷版副本（或是有印制封页的其他媒体副本）多于 100 份，而文档的许可证声明中要求有封页文本，则您必须将它清晰地置于封页之上，封面文本在封面上，封底文本在封底上。封面和封底上还必须标明您是这些副本的出版者。封面必须同等显著地完整展现标题的所有文字。您可以在封页上加入其他资料。改动仅限于封页的复制，只要保持文档的标题不变并满足这些条件，可以在其他方面被视为逐字复制。 </para>
   <para>如果需要加上的文本对于封面或封底过多，无法明显地表示，您应该在封页上列出前面的（在合理的前提下尽量多），把其他的放在邻近的页面上。 </para>
   <para>如果您出版或分发了超过 100 份文档的不透明副本，则必须在每个不透明副本中包含一份计算机可读的透明副本，或是在每个不透明副本中给出一个计算机网络地址，通过这个地址，网络公共用户可以使用标准网络协议下载文档的无任何附加资料的完整透明副本。如果您选择后者，则必须在开始大量分发非透明副本的时候采用相当谨慎的步骤，保证透明副本在其所给出的位置在（直接或通过代理和零售商）分发最后一次该版本的非透明副本的时间之后一年之内始终是有效的。 </para>
   <para>在重新大量发布副本之前，请您（但不是必须）与文档的作者联系，以便他们可以有机会向您提供文档的更新版本。 </para>
  </sect2>
  <sect2 id="gfdl_modify">
   <title>修改</title>
   <para>在上述第 2、3 节的条件下，您可以复制和分发文档的修改版本，前提是严格按照此许可证发布修改后的文档，将修改版本用作文档，从而允许任何拥有此修改版副本的人执行分发或修改。另外，在修改版中，您需要做到如下几点： </para>
   <formalpara id="bw4vnmy">
    <title>A.</title>
    <para>用于与文档以及以前各个版本（如果有，应该列在文档的“历史”章节中）显著不同的扉页（和封页，如果有）。如果那个版本的原始发行者允许的话，您可以使用和以前版本相同的标题。 </para>
   </formalpara>
   <formalpara id="bw4vnmz">
    <title>B.</title>
    <para>与作者一样，在扉页上列出承担修改版本中的修改的作者责任的一个或多个人或实体和至少五个文档的原作者（如果原作者不足五个就全部列出），除非他们免除了您的这个责任。 </para>
   </formalpara>
   <formalpara id="bw4vnn0">
    <title>C.</title>
    <para>与原来的发行者一样，在扉页上列出修改版的发行者的姓名。 </para>
   </formalpara>
   <formalpara id="bw4vnn1">
    <title>D.</title>
    <para>保持该文档的全部版权声明不变。 </para>
   </formalpara>
   <formalpara id="bw4vnn2">
    <title>E.</title>
    <para>在与其他版权声明邻近的位置加入恰当的针对您的修改的版权声明。 </para>
   </formalpara>
   <formalpara id="bw4vnn3">
    <title>F.</title>
    <para>在紧接着版权声明的位置加入许可声明，按照下面附录中给出的形式，以本许可证给公众授于是用修订版本的权利。 </para>
   </formalpara>
   <formalpara id="bw4vnn4">
    <title>G.</title>
    <para>保持原文档的许可声明中的全部不可变章节、封面文字和封底文字的声明不变。 </para>
   </formalpara>
   <formalpara id="bw4vnn5">
    <title>H.</title>
    <para>包含一份未作任何修改的本协议的副本。 </para>
   </formalpara>
   <formalpara id="bw4vnn6">
    <title>I.</title>
    <para>保持名为<quote>历史</quote>的章节不变，保持它的标题不变，并在其中加入一项，至少声明扉页上的已修改版本的标题、年份、新作者和出版者。如果文档中没有<quote>历史</quote>章节，则请新建它，并加入一项以声明原文档扉页上所列的标题、年份、作者与出版者，再在其后加入如上所说的描述修改版本的项。 </para>
   </formalpara>
   <formalpara id="bw4vnn7">
    <title>J.</title>
    <para>如果文档中有用于公共用户访问的文档透明副本的网址，则保持网址不变，并同样提供它所基于的以前文档版本的网址。这些网址可以放在<quote>历史</quote>章节。您可以不给出那些在原文档发行之前已经发行至少四年的版本给出的网址，或者该版本的发行者授权不列出网址。 </para>
   </formalpara>
   <formalpara id="bw4vnn8">
    <title>K.</title>
    <para>对于任何以<quote>致谢</quote>或<quote>献给</quote>作标题的章节，保持标题的章节不变，并保持其全部内容和对每个贡献者的感谢与列出的奉献的语气不变。 </para>
   </formalpara>
   <formalpara id="bw4vnn9">
    <title>L.</title>
    <para>保持文档的所有固定章节不变，不改变它们的标题和内容。章节的编号或相当的内容不被认为是章节标题的一部分。 </para>
   </formalpara>
   <formalpara id="bw4vnna">
    <title>M.</title>
    <para>删除名为<quote>签名</quote>的章节。这样的章节不可以被包含在修改后的版本中。 </para>
   </formalpara>
   <formalpara id="bw4vnnb">
    <title>N.</title>
    <para>不要把任何现有章节重命名为标题<quote>签名</quote>或和任何不可变章节的名字相冲突的名字。 </para>
   </formalpara>
   <formalpara id="bw4vnnc">
    <title>O.</title>
    <para>保持任何免责声明不变。 </para>
   </formalpara>
   <para>如果修改版本加入了新的符合次要章节定义的引言或附录章节，并且不含有从原文档中复制的内容，您可以选择将其标记为固定。如果需要这样做，则将它们的标题加入修改版本许可声明的固定章节列表之中。这些标题必须和其他章节的标题相区分。 </para>
   <para>你可以加入一个标题为<quote>签名</quote>的章节，只要它只包含对你的修改版本由不同的各方给出的签名，例如书评或是声明文本已经被一个组织认定为一个标准的权威定义。 </para>
   <para>您可以加入一个最多 5 个字的段落作为封面文本和一个最多 25 个字的段落作为封底文本，将它们加入修改版本的封页文本列表末端。一个实体只可以添加（或编排）一段封面和一段封底文本。如果原文档已经为该封页（封面或封底）包含了封页文本，由您或您所代表的实体先前加入或排列的文本，不能再新加入一个，但您可以在原来的发行者的显式许可下替换掉原来的那个。 </para>
   <para>作者和发行者不能通过本许可证授权公众使用他们的名字推荐或暗示认可任何一个修改版本。 </para>
  </sect2>
  <sect2 id="gfdl_combine">
   <title>组合文档</title>
   <para>遵照第 4 节所说的修改版本的规定，您以将文档和其他文档合并并以本许可证发布，只要您在合并结果中包含原文档的所有不可变章节，对它们不加以任何改动，并在合并结果的许可声明中将它们全部列为不可变章节，而且维持原作者的免责声明不变。 </para>
   <para>合并作品仅需要包含一份此许可证，多个相同的固定章节可以由一个副本取代。如果有多个名称相同但内容不同的固定章节，通过在章节名称后面的括号中加上原作者或出版者的姓名（如果已知）来加以区别，或者使用唯一编号加以区别。并对合并作品许可声明中的固定章节列表中的章节标题做相同的调整。 </para>
   <para>在合并过程中，必须合并不同原始文档中任何名为<quote>历史</quote>的章节，从而形成新的名为<quote>历史</quote>的章节；类似地，还要合并名为<quote>致谢</quote>和<quote>题献</quote>的章节。必须删除所有标题为<quote>签名</quote>的章节。 </para>
  </sect2>
  <sect2 id="gfdl_collect">
   <title>文档的合集</title>
   <para>您可以制作一个文档和其他文档的合集，在本许可证下发布，并在合集中将不同文档中的多个本许可证的副本以一个单独的副本来代替，只要您在文档的其他方面遵循本许可证的逐字复制的条款即可。 </para>
   <para>您可以从一个这样的合集中提取一个单独的文档，并将它在本许可证下单独发布，只要您想这个提取出的文档中加入一份本许可证的副本，并在文档的其他方面遵循本许可证的逐字复制的原则。 </para>
  </sect2>
  <sect2 id="gfdl_aggregate">
   <title>独立作品的聚合体</title>
   <para>将文档或其派生品以及其他独立和无关文档或作品编撰在一个储存卷中或分发媒体上，这称为文档的“聚合体”，前提是编撰成品的著作权对其使用者的法律权限的限制未超出各个独立作品的许可范围。当基于此许可证发布的文档包含在一个聚合体中时，此许可证不适用于聚合体中的本非该文档派生作品的其他作品。 </para>
   <para>如果第 3 节中的封页文本要求适用于这些文档的副本，则若文档在聚合体中所占的比重小于全作品的一半，文档的封页文本可以放置在聚合体内包含文档部分的封页上，或是电子文档中的等效部分。否则，它必须位于整个聚合体的印刷的封页上。 </para>
  </sect2>
  <sect2 id="gfdl_translate">
   <title>翻译</title>
   <para>翻译被视为一种修改，所以您可以按照第 4 节的条款分发文档的翻译版本。如果要将文档的固定章节替换为翻译版本，则需要得到版权持有者的授权，但您可以将部分或全部固定章节的翻译版本附加在原始版本后面。您可以包含一个此许可证以及所有许可证声明和免责声明的翻译版本，前提是同时包含它们的原始英文版本。当翻译版本和英文版发生冲突的时候，原始版本有效。 </para>
   <para>如果在文档中有标题为<quote>致谢</quote>、<quote>献给</quote>、<quote>版本历史</quote>的章节，保持标题（第 1 节）的要求（第 4 节）恰恰需要更换实际的标题。 </para>
  </sect2>
  <sect2 id="gfdl_termination">
   <title>许可的终止</title>
   <para>除非此许可证中有明确规定，否则您不能对该文档进行复制、修改、分授许可或分发。在此许可证规定外对该文档所进行的任何复制、修改、分授许可或分发都是无效的，并且将自动终止您在此许可证下所拥有的权利。但是，对于在此许可证的规定下从您这里获得副本或权利的各方，只要其完全遵守此许可证的规定，其许可证将不会被终止。 </para>
  </sect2>
  <sect2 id="gfdl_revisions">
   <title>本许可的未来修订版本</title>
   <para>自由软件基金会有时会发布 GNU 自由文档许可证的新的修订版版本。这些新版本的主旨和精神与当前版本是一致的，但在解决新问题的具体细节方面可能有所不同。请参见 http://www.gnu.org/copyleft/。 </para>
   <para>许可证的每个版本都有一个不同的版本号。如果文档指定了适用于它的此许可证或<quote>任何后续版本</quote>的特定带编号版本，则您可以选择遵从指定版本或自由软件基金会发布的任何随后版本（非草稿）的条款和条件。如果文档没有指定此许可证的版本号，您可以选择自由软件基金会发布的任何许可证版本（非草稿）。 </para>
  </sect2>
  <sect2 id="gfdl_apply">
   <title>附录：如何针对您的文档使用此许可证</title>
   <para>要在您编写的文档中使用本许可证，请在文档中包含一份本许可证的副本，并将以下版权和许可声明放在扉页的后面： </para>

<screen>
Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.

</screen>

   <para>如果有不可变章节、封面文本和封底文本，请使用以下内容替换“附带...文本”部分： </para>

<screen>
with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.

</screen>

   <para>如果有不可变章节而没有封页文本，或这三种内容（不可变章节、封面文本、封底文本）的任何其他组合，请合并这两个备选项以适应您的情况。 </para>
   <para>如果您的文档包含不一般的程序代码示例，建议同时选择自由软件许可证（如 GNU 通用公共许可证）发布这些示例，以允许它们可以用于自由软件。 </para>
  </sect2>
 </sect1>
</appendix>

<appendix id="b653gv6" xml:base="ax_docupdates.xml">
 <title>文档更新</title>
 <para>此部分包含有关自 SUSE Linux Enterprise Server 11 首次发行以来对《<citetitle>SUSE Linux Enterprise Server 储存管理指南</citetitle>》所做的文档内容更改的信息。</para>
 <para>本文档更新日期如下：</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="b18f6m4l" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b17tlcs5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b17ir4gy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b176hzef" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg9cw" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14jt4a4" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14dmrrl" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13z9xd2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13g65gi" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12irb56" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12mdifb" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12doybp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b10v707p" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bzit5x5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bw4b1n8" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bvqj59s" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bvc15n0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="burkc4m" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bt5x8xp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgqw2y" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bq2fgom" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndh000" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="boj6043" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bmy23qz" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bm18yt7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bleqdg7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bkkotcf" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bfmmkat" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="b18f6m4l">
  <title>2013 年 12 月 16 日</title>
  <para/>
  <sect2 id="b18f6m4m">
   <title>管理设备的多路径 I/O </title>
   <para>对下面一节进行了更新。下面说明所作的更改。</para>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b18f6m4n">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b18f6m4o">
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>更正了 cciss 示例：</para>

<screen>
devnode "^cciss.c[0-9]d[0-9].*"

devnode "^cciss.c[0-9]d[0-9]*[p[0-9]*]"
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b17tlcs5">
  <title>2013 年 11 月 4 日</title>
  <para/>
  <sect2 id="b17tlcs6">
   <title>管理设备的多路径 I/O </title>
   <para>对下面一节进行了更新。下面说明所作的更改。</para>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17tlcs7">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17tlcs8">
       <entry>
        <para><xref linkend="mpiosysconfpart" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>添加了与分区多路径设备有关的问题。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b17ir4gy">
  <title>2013 年 10 月 14 日</title>
  <para>对下面一节进行了更新。下面说明所作的更改。</para>
  <sect2 id="b17ir4gz">
   <title>iSNS for Linux</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17ir4h0">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17ir4h1">
       <entry>
        <para><xref linkend="sec.isns.ddadd" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在以下命令中添加了 -p ip:port 选项：</para>

<screen>
iscsiadm -m node -t iqn.2006-02.com.example.iserv:systems -p ip:port --op=update --name=node.startup --value=automatic

iscsiadm -m node -t iqn.2006-02.com.example.iserv:systems -p ip:port --op=delete
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b176hzef">
  <title>2013 年 10 月 4 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b17cmfjk" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b17cmlvf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b176hzeg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b17cmfjk">
   <title>管理设备的多路径 I/O </title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17cmfjl">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17cmfjm">
       <entry>
        <para><xref linkend="b12doufy" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在<xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/>中的 <literal>blacklist_exceptions</literal> 示例中添加了一个链接。</para>
       </entry>
      </row>
      <row id="b17cmfjn">
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>添加了多个示例，说明如何使用 <literal>blacklist_exceptions</literal> 部分为 <literal>blacklist</literal> 部分所用的正则表达式加入到黑名单的设备启用多路径。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b17cmlvf">
   <title>卷快照</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17cmlvg">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17cmlvh">
       <entry>
        <para><xref linkend="snapshots" xrefstyle="ChapTitleOnPage"/></para>
       </entry>
       <entry>
        <para>为明确起见，将“原始卷”更改为“来源逻辑卷”。</para>
       </entry>
      </row>
      <row id="b17cnp7r">
       <entry>
        <para><xref linkend="bi7xb8b" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 Xen 主机环境中，您可以使用快照功能来备份虚拟机的储存后端，或测试对虚拟机映像（例如用于修补程序或升级）进行的更改。 </para>
       </entry>
      </row>
      <row id="b17cnp7s">
       <entry>
        <para><xref linkend="snapshot_xen_host" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="b17cnp7t">
       <entry>
        <para><xref linkend="lvconvert_merge" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>如果来源逻辑卷包含虚拟机映像，则您必须关闭虚拟机、停用来源逻辑卷以及快照卷（通过按该顺序卸下这些卷）、发出合并命令，然后启用快照卷和来源逻辑卷（通过按该顺序装入这些卷）。因为来源逻辑卷会自动重新装入，而且合并完成时会删除快照卷，所以在合并完成之前请勿重启动虚拟机。合并完成之后，您可以将生成的逻辑卷用于虚拟机。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b176hzeg">
   <title>SLES 11 中的存储的新功能</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b176hzeh">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b176hzei">
       <entry>
        <para><xref linkend="bndgyoe" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>添加了有关如何完成将 SLES 10 SP4 升级到 SLES 11 的准备工作（如果使用 EVMS 来管理系统设备）的信息。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b13jg9cw">
  <title>2013 年 6 月 (SLES 11 SP3)</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14ffk97" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g63v9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15coqxp" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14dug5l" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b155zz9h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13jg9cx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15coqxs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15q3ht8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14ffkub" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14ffk97">
   <title>LVM 配置</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14ffk98">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14ffk99">
       <entry>
        <para><xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>添加了有关 LVM 逻辑卷的精简配置的信息。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b13g63v9">
   <title>经由 IP 网络的大容量储存：iSCSI LIO 目标服务器</title>
   <para><xref linkend="cha_iscsi_lio" xrefstyle="ChapTitleOnPage"/>为新增的。</para>
  </sect2>
  <sect2 id="b15coqxp">
   <title>管理设备的多路径 I/O </title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b15coqxq">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15coqxr">
       <entry>
        <para><xref linkend="b14ff9rs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="b15gv138">
       <entry>
        <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>更新了在 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.defaults</filename> 文件中具有默认定义的储存阵列列表。</para>
       </entry>
      </row>
      <row id="b15gv4eu">
       <entry>
        <para><xref linkend="beep4ms" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><literal>-r</literal> 选项是新增的。</para>
       </entry>
      </row>
      <row id="b15jxit2">
       <entry>
        <para><xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="b15dsfgw">
       <entry>
        <para><xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>添加了有关 <literal>alua</literal>、<literal>rdac</literal>、<literal>hp-sw</literal> 和 <literal>emc</literal> 的 SCSI 硬件处理程序的信息。</para>
       </entry>
      </row>
      <row id="b15gv4ev">
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>更新了默认值列表，对已弃用的属性 <literal>udev_dir</literal> 和 <literal>getuid_callout</literal>、新属性 <literal>uid_attribute</literal>，以及 <literal>path_selector</literal> 和 <literal>max_fds</literal> 的更改过的默认值进行了注解。</para>
       </entry>
      </row>
      <row id="b15gvcrm">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><literal>path_selector</literal> 的默认值由 <literal>round-robin</literal> 更改为 <literal>service-time</literal>。</para>
        <para>已弃用 <literal>getuid_callout</literal> 属性，由参数 <literal>uid_attribute</literal> 取而代之。</para>
        <para>添加了 <literal>uid_attribute</literal>。</para>
       </entry>
      </row>
      <row id="b15cq0jh">
       <entry>
        <para><xref linkend="scandev" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <warning>
         <para>在 EMC PowerPath 环境中，请勿使用操作系统随附的 <filename>rescan-scsi-bus.sh</filename> 实用程序或 HBA 供应商脚本来扫描 SCSI 总线。为了避免可能发生的文件系统损坏，EMC 要求您遵照 EMC PowerPath for Linux 的供应商文档中提供的过程操作。</para>
        </warning>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b14dug5l">
   <title>使用 mdadm 管理软件 RAID 6 和 10</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14dug5m">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14dug5n">
       <entry>
        <para><xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b155zz9h">
   <title>Linux 中的文件系统的概述</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b155zz9i">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15tkrrw">
       <entry>
        <para><xref linkend="b15tkr5k" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>快照程序安装点的配置中定义了清理频率。请将每日、每月和每年的 TIMELINE_LIMIT 参数设置得较低，以缩短快照的保留时间并减少其数量。</para>
       </entry>
      </row>
      <row id="b155zz9j">
       <entry>
        <para><xref linkend="b15tkr5p" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b13jg9cx">
   <title>适用于软件 RAID 的储存机箱 LED 实用程序</title>
   <para><xref linkend="cha_raids_lee" xrefstyle="ChapTitleOnPage"/>为新增的。</para>
  </sect2>
  <sect2 id="b15coqxs">
   <title>卷快照</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b15coqxt">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15coqxu">
       <entry>
        <para><xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>添加了有关 LVM 逻辑卷快照的精简配置的信息。</para>
       </entry>
      </row>
      <row id="b15coqxv">
       <entry>
        <para><xref linkend="lvconvert_merge" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b15q3ht8">
   <title>储存问题查错</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b15q3ht9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15q3hta">
       <entry>
        <para><xref linkend="trbl_btrfs_volfull" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b14ffkub">
   <title>SLES 11 中的存储的新功能</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14ffkuc">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14ffkud">
       <entry>
        <para><xref linkend="new_sles11sp3" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b14jt4a4">
  <title>2013 年 3 月 19 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14jt4a5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14jt4a5">
   <title>Linux 中的文件系统的概述</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14jt4a6">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14jt4a7">
       <entry>
        <para><xref linkend="sec_fileystems_major_ext3inodesize" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本部分已更新，对 SLES 11 中的 inode 大小默认设置以及每 inode 的字节数比率的更改进行了说明。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b14dmrrl">
  <title>2013 年 3 月 11 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14doxle" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14dmrrm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14doxle">
   <title>LVM 配置</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14doxlf">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14doxlg">
       <entry>
        <para><xref linkend="lvm_activate_vgs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b14dmrrm">
   <title>Linux 中的文件系统的概述</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14dmrrn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14dmrro">
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>多设备支持，允许增加或缩小文件系统。该功能计划将在 YaST 分区程序以后的发行版本中提供。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b13z9xd2">
  <title>2013 年 2 月 8 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13z9xd3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b13z9xd3">
   <title>为根分区配置软件 RAID1</title>
   <para>本节经过修改，重点介绍软件 RAID1 类型。不支持软件 RAID0 和 RAID5。之前曾错误地将它们纳入了支持范围。以下说明其他重要更改。</para>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b13z9xd4">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b13z9xd5">
       <entry>
        <para><xref linkend="bi9d2lj" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>需要第三台设备用于 <filename>/boot </filename>分区。设备应该是本地设备。</para>
       </entry>
      </row>
      <row id="b13za2s6">
       <entry>
        <para><xref linkend="b13za1ue" xrefstyle="StepXRef"/> 位于 <xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>创建 <filename>/boot</filename> 分区。设备应该是本地设备。</para>
       </entry>
      </row>
      <row id="b13za83a">
       <entry>
        <para><xref linkend="bi9dzpu" xrefstyle="StepXRef"/> 位于 <xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 <guimenu>RAID 类型</guimenu>下，选择 <guimenu>RAID 1（镜像）</guimenu>。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b13g65gi">
  <title>2013 年 1 月 8 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13jh2o0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g65z1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b13jh2o0">
   <title>LVM 配置</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b13jh2o1">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b13jh2o2">
       <entry>
        <para><xref linkend="sec_yast2_system_lvm_explanation" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <important>
         <para>如果在配置 LVM 后添加多路径支持，则必须按照<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>中所述修改 <filename>/etc/lvm/lvm.conf</filename> 文件，以便仅扫描 <filename>/dev/disk/by-id</filename> 目录中的多路径设备名称，然后再重引导服务器。</para>
        </important>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b13g65z1">
   <title>管理设备的多路径 I/O </title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b13g65z2">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b13jbspx">
       <entry>
        <para><xref linkend="beg2pi0" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>请确保每个节点上的 <filename>/etc/multipath.conf</filename> 文件中的配置设置在整个集群中保持一致。 </para>
       </entry>
      </row>
      <row id="b13g65z3">
       <entry>
        <para><xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>当使用 <filename>/dev/disk/by-id</filename> 目录中的多路径映射设备的链接时，请务必指定 <filename>dm-uuid*</filename> 名称或别名，而不是该设备的固定路径实例。</para>
       </entry>
      </row>
      <row id="b13gbii2">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>要同时接受设备映射程序名称的原始磁盘以及分区，请按如下方式指定路径，<filename>mpath</filename> 前不要使用连字符 (-)：</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*mpath-.*|", "r|.*|" ]
</screen>

       </entry>
      </row>
      <row id="b13gbxz9">
       <entry>
        <para><xref linkend="mpiousingpart" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>请确保 <filename>lvm.conf</filename> 和 <filename>md.conf</filename> 的配置文件指向多路径设备名称。如果已启用 <filename>boot.multipath</filename> 且在 <filename>boot.lvm</filename> 和 <filename>boot.md</filename> 之前加载，则应自动完成这一步骤。否则，LVM 和 MD 配置文件可能会包含多路径设备的固定路径，且您必须对那些路径进行更正，以使用多路径设备名称。 </para>
       </entry>
      </row>
      <row id="b13g705m">
       <entry>
        <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>开始之前，请查看<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/>中的要求。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b12irb56">
  <title>2012 年 11 月 14 日</title>
  <para>对下面一节进行了更新。下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12o29bv" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12o29bv">
   <title>Linux 中的文件系统的概述</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b12o29bw">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b12r1r9k">
       <entry>
        <para><xref linkend="sec_filesystems_lfs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本节经过更新，为了与 <ulink url="http://www.suse.com/products/server/technical-information/">SUSE Linux Enterprise Server 技术信息网站</ulink>上的<ulink url="http://www.suse.com/products/server/technical-information/#FileSystem">文件系统支持与大小</ulink>中的内容保持一致。</para>
       </entry>
      </row>
      <row id="b12o29bx">
       <entry>
        <para><xref linkend="sect_stor_limits" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b12mdifb">
  <title>2012 年 10 月 29 日</title>
  <para>扉页更正与排版勘误。 </para>
 </sect1>
 <sect1 id="b12doybp">
  <title>2012 年 10 月 19 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12doybq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12doybu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12doybq">
   <title>管理设备的多路径 I/O </title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b12doybr">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b12doybs">
       <entry>
        <para><xref linkend="bbillhs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>配置设备的特定实例移至上一级组织级别。</para>
       </entry>
      </row>
      <row id="b12doybt">
       <entry>
        <para><xref linkend="mpiohwsupconf" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>该命令假设在您修改 <filename>/etc/multipath.conf</filename> 文件并执行试运行时，守护程序 <filename>multipathd</filename> 已使用旧的（或默认）多路径设置运行。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b12doybu">
   <title>Linux 中的文件系统的概述</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b12doybv">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b12doybw">
       <entry>
        <para><xref linkend="sec_fileystems_major_ext3inodesize" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>为了容纳 Ext3 文件系统上文件的扩展属性和 ACL，Ext3 的默认 inode 大小已从 SLES 10 上的 128 字节增加到 SLES 11 上的 256 字节。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b10v707p">
  <title>2012 年 9 月 28 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b10v71m2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b10v71m1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b10v71m2">
   <title>管理设备的多路径 I/O </title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b11v3x0i">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b122v4qy">
       <entry>
        <para><xref linkend="b122uvel" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 SLES 11 SP2 中，使用关键字 <literal>prio</literal> 指定优先级排序程序，使用关键字 <literal>prio_args</literal> 指定自变量（如果优先级排序程序需要自变量的话）。</para>
        <para>多路径工具 0.4.9 和更高版本使用 <filename>/etc/multipath.conf</filename> 文件的 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 部分中的 <literal>prio</literal> 设置。当为 <literal>multipaths{}</literal> 部分中的单个 <literal>multipath</literal> 定义指定关键字 <literal>prio</literal> 时，它将被忽略而无反馈。</para>
       </entry>
      </row>
      <row id="b122xhwg">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>添加了有关使用 <literal>prio</literal> 和 <literal>prio_args</literal> 关键字的信息。</para>
       </entry>
      </row>
      <row id="b122u3zy">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 SLES 11 SP2 中，rr_min_io 多路径属性已废弃，由 rr_min_io_rq 属性替代。</para>
       </entry>
      </row>
      <row id="b11v3x0j">
       <entry>
        <para><xref linkend="b11qkzgw" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="b122v4qz">
       <entry>
        <para><xref linkend="b122uxzr" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="b122v4r0">
       <entry>
        <para><xref linkend="b11qkzgx" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>修复了损坏的链接。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b10v71m1">
   <title>Linux 中的文件系统的概述</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b10v72jy">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b10v72jz">
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>Btrfs 工具包是 <filename>btrfsprogs</filename>。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bzit5x5">
  <title>2012 年 4 月 12 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bznyukh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bznyugr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bznyukh">
   <title>管理设备的多路径 I/O </title>
   <para>本节经过更新，在所有示例中使用 <filename>/dev/disk/by-id</filename> 目录作为设备路径。</para>
  </sect2>
  <sect2 id="bznyugr">
   <title>使用 mdadm 调整软件 RAID 阵列的大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bznyyes">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bznyyet">
       <entry>
        <para><xref linkend="resizedecr" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>修订了步骤顺序，让您先减少 RAID 大小再减少单个组件分区大小。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bw4b1n8">
  <title>2012 年 2 月 27 日 (SLES 11 SP2)</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bw4b52h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7nlj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkbgyt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkgdv2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bw4b1n9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="byz8ra8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7y6n" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk9zeq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bxuakwj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkf9o0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bw4b52h">
   <title>以太网光纤通道储存：FCoE</title>
   <para>此部分为新增的。从 SLES 11 开始，支持以太网开放光纤通道 (OpenFCoE)。</para>
  </sect2>
  <sect2 id="bwk7nlj">
   <title>GNU 许可证</title>
   <para>此部分为新增的。</para>
  </sect2>
  <sect2 id="bwkbgyt">
   <title>LVM 配置 </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwkbgyu">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwkbgyv">
       <entry>
        <para><xref linkend="lvmtagging" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwkgdv2">
   <title>管理 NFSv4 访问控制列表</title>
   <para>此部分为新增的。</para>
  </sect2>
  <sect2 id="bw4b1n9">
   <title>管理设备的多路径 I/O </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bw4b1na">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bw4b1nb">
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>SLES 11 的默认 <literal>getuid</literal> 路径是 /lib/udev/scsi_id。</para>
       </entry>
      </row>
      <row id="bwk7js1">
       <entry>
        <para><xref linkend="mpioerrormgmt" xrefstyle="HeadingOnPage"/></para>
        <para><xref linkend="mpiostall" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 <command>dmsetup message</command> 命令中，值 0 代表扇区，在不需要扇区信息时使用该值。 </para>
       </entry>
      </row>
      <row id="bxu9zlh">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>添加了当在群集环境中使用多路径 I/O 时，对 no_path_retry 和故障回复设置的建议。</para>
       </entry>
      </row>
      <row id="bxu9zli">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>更正了 path-selector 选项名称及设置：</para>
        <simplelist>
         <member>round-robin 0</member> <member>least-pending 0</member> <member>service-time 0</member> <member>queue-length 0</member>
        </simplelist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="byz8ra8">
   <title>使用 mdadm 管理软件 RAID 6 和 10</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="byz8ra9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="byz8raa">
       <entry>
        <para><xref linkend="byz81ho" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwk7y6n">
   <title>经由 IP 网络的大容量储存：iSCSI </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwk7ylk">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwkrs5c">
       <entry>
        <para><xref linkend="bwkrqdd" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="bwk7yll">
       <entry>
        <para><xref linkend="bwk7p6z" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwk9zeq">
   <title>Linux 中的文件系统的概述</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwk9zer">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwk9zes">
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。 </para>
        <para>使用 SUSE Linux Enterprise 11 SP2 时，Btrfs 文件系统将作为 SUSE Linux Enterprise 11 SP2 所有体系结构中的根文件系统（即操作系统的文件系统）受到支持。 </para>
       </entry>
      </row>
      <row id="bwkbczk">
       <entry>
        <para><xref linkend="sec_filesystems_major_reiser" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <important>
         <para>在专为迁移目的设计的 SUSE Linux Enterprise Server 11 的生命周期中，完全支持 ReiserFS 文件系统。SUSE 计划从 SUSE Linux Enterprise Server 12 开始不再支持创建新的 ReiserFS 文件系统。</para>
        </important>
       </entry>
      </row>
      <row id="bwks4dw">
       <entry>
        <para><xref linkend="bwkryet" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="bwkbc4f">
       <entry>
        <para><xref linkend="sec_filesystems_lfs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本部分的值都已更改到当前标准。</para>
       </entry>
      </row>
      <row id="bwkbkhq">
       <entry>
        <para><xref linkend="bwkbhpd" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bxuakwj">
   <title>调整文件系统大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bxuakwk">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bxuakwl">
       <entry>
        <para><xref linkend="biuynjy" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="biuzt6a" xrefstyle="SectTitleOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>resize2fs 命令只允许调整已装入 Ext3 文件系统的大小。Ext3 卷可以在装入或卸载时增加或减少其大小值。Ext2/4 文件系统必须在卸载后方可增加或减少其卷大小。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwkf9o0">
   <title>使用 mdadm 调整软件 RAID 阵列的大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwkfa7i">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwkfa7j">
       <entry>
        <para><xref linkend="resizeincrraid" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para><command>--assume-clean</command> 选项是新的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bvqj59s">
  <title>2011 年 7 月 12 日</title>
  <para>对下面一节进行了更新。下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bvqj7sc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bvqj7sc">
   <title>管理设备的多路径 I/O </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bvqj7sd">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bvqj7se">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>只有 root (/) 设备或其任何部分（比如 <filename>/var</filename>、<filename>/etc</filename> 和 <filename>/log</filename>）在 SAN 上，并且需要使用多路径引导，才需要运行 <command>mkinitrd</command> 命令。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bvc15n0">
  <title>2011 年 6 月 14 日</title>
  <para>对下面一节进行了更新。下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bvc17t5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bvc17t8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bvc17t5">
   <title>管理设备的多路径 I/O </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bvc17t6">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bvc17t7">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 SLES 11 中，path_grouping_policy 的默认设置由 multibus 更改为 failover。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bvc17t8">
   <title>SLES 11 中的存储的新功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bvc17t9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bvc17ta">
       <entry>
        <para><xref linkend="bvc111p" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="burkc4m">
  <title>2011 年 5 月 5 日</title>
  <para>本版本修复了断开的链接，删除了过时的参考。</para>
 </sect1>
 <sect1 id="bt5x8xp">
  <title>2011 年 1 月</title>
  <para>对下面一节进行了更新。下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bt5yoiu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bt5wm3n" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bt5ylzd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bt5yoiu">
   <title>LVM 配置</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bt5yoiv">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bt5yoiw">
       <entry>
        <para><xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>LVM2 不限制物理区域数。区域数过多不影响逻辑卷的 I/O 性能，但会减慢 LVM 工具的速度。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bt5wm3n">
   <title>管理设备的多路径 I/O </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bt5wpqq">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bt5wpqr">
       <entry>
        <para>使用特定主机总线适配器调整故障转移</para>
       </entry>
       <entry>
        <para>本部分已删除。有关 HBA 故障转移的指导信息，请参考您供应商的文档。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bt5ylzd">
   <title>调整文件系统大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bt5ylze">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bt5ylzf">
       <entry>
        <para><xref linkend="resizedecrfs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>卸载文件系统时，不支持减少文件系统大小。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="brgqw2y">
  <title>2010 年 9 月 16 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="brgqysi" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="brgqysi">
   <title>LVM 配置</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="brgqysj">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="brgqysk">
       <entry>
        <para><xref linkend="bi706ct" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>展开讨论并扩展了步骤，以阐述如何配置使用整个磁盘的分区。</para>
        <para>为了使用 YaST 分区程序中的硬盘分区功能，对步骤进行了修改。</para>
       </entry>
      </row>
      <row id="brgqysl">
       <entry>
        <para> 所有 LVM 管理部分</para>
       </entry>
       <entry>
        <para>为了使用 YaST 分区程序中的卷管理功能，对整章的步骤都进行了修改。</para>
       </entry>
      </row>
      <row id="brgqysm">
       <entry>
        <para><xref linkend="brgpqe2" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="brgqysn">
       <entry>
        <para><xref linkend="brgqpfy" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="brgqyso">
       <entry>
        <para><xref linkend="brgpmw3" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="brgqysp">
       <entry>
        <para><xref linkend="brgob84" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bq2fgom">
  <title>2010 年 6 月 21 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bq2fjfm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq7udwm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq2fh2u" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq2gisd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bq2fjfm">
   <title>LVM 配置</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq2fjfn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq2fjfo">
       <entry>
        <para><xref linkend="bi706ct" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>步骤中添加了细节。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bq7udwm">
   <title>管理多路径 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq7udwn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq7udwo">
       <entry>
        <para><xref linkend="mpionames" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>对根设备使用用户友好的名称会使数据丢失。从 <ulink url="http://www.novell.com/support/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=7001133"><citetitle>TID 7001133：建议在多路径配置中使用 user_friendly_names</citetitle></ulink> 中添加了备用选项。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bq2fh2u">
   <title>使用 mdadm 管理软件 RAID 6 和 10</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq2fi7n">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq2fi7o">
       <entry>
        <para><xref linkend="b7cynnk" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>更正了示例中的 Errata。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bq2gisd">
   <title>IP 网络上的大批量储存：iSCSI</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq2gise">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq2gisf">
       <entry>
        <para><xref linkend="nofail" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bndh000">
  <title>2010 年 5 月 (SLES 11 SP1)</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bo1piss" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bok8zbg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bpjchpc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bndh0qn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bo1piss">
   <title>管理设备的多路径 I/O </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bo1pist">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bo1pisu">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><xref linkend="bg89rst" xrefstyle="StepOnPage"/>中的示例已更正。</para>
       </entry>
      </row>
      <row id="bombwdc">
       <entry>
        <para><xref linkend="bok8cn1" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="bothcg7">
       <entry>
        <para><xref linkend="mpiotoolsmpt" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>包文件列表会因不同的服务器体系结构而异。有关多路径工具包中所包括的文件列表，请转至 <ulink url="http://www.novell.com/products/server/techspecs.html?tab=1"><guimenu>SUSE Linux Enterprise Server Technical Specifications</guimenu>（SUSE Linux Enterprise Server 技术规范）<guimenu>Package Descriptions</guimenu>（包说明）网页</ulink>，找到您的体系结构并选择 <guimenu>Packages Sorted by Name</guimenu>（按名称排序的包），然后在“multipath-tools”（多路径工具）上搜索以找到该体系结构的包列表。</para>
       </entry>
      </row>
      <row id="bomc4i7">
       <entry>
        <para><xref linkend="mpiosysconfsandevs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>如果将 SAN 设备用作服务器上的根设备，请按<xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/>中所述修改超时设置。</para>
       </entry>
      </row>
      <row id="bpjp7nk">
       <entry>
        <para><xref linkend="mpiohwsupconf" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>为 -v3 详细程度添加了输出示例。</para>
       </entry>
      </row>
      <row id="bomcuqx">
       <entry>
        <para><xref linkend="bomcrff" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="bomcuqy">
       <entry>
        <para><xref linkend="bomc64e" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bok8zbg">
   <title>经由 IP 网络的大容量储存：iSCSI</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bok8zbh">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bok8zbi">
       <entry>
        <para><xref linkend="bojud2n" xrefstyle="StepXRef"/> 位于 <xref linkend="sec_inst_system_iscsi_target_yast" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 <guimenu>YaST</guimenu> <guimenu>网络服务</guimenu> <guimenu>iSCSI 目标</guimenu>功能中，添加了使您能够导出 iSCSI 目标信息的<guimenu>保存</guimenu>选项，这使得向资源使用方提供此信息变得更容易。</para>
       </entry>
      </row>
      <row id="bp5cfck">
       <entry>
        <para><xref linkend="sec_inst_system_iscsi_ts" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bpjchpc">
   <title>软件 RAID 配置</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bpjchpd">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bpjchpe">
       <entry>
        <para><xref linkend="bgchysh" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>弃用了软件 RAID 操作指南。改用 <ulink url="https://raid.wiki.kernel.org/index.php/Linux_Raid"><citetitle>Linux RAID </citetitle>wiki</ulink>。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bndh0qn">
   <title>新增功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bndh0qo">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bndh0qp">
       <entry>
        <para><xref linkend="bndgyod" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="boj6043">
  <title>2010 年 2 月 23 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="boj6044" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="boja57r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="boj6044">
   <title>为 Root 分区配置软件 RAID</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="boj6045">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="boj62jo">
       <entry>
        <para><xref linkend="bi9d2lj" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>更正了 RAID 0 定义中的错误。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="boja57r">
   <title>管理多路径 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="boja57s">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="boja57t">
       <entry>
        <para><xref linkend="scandev" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>添加了有关使用脚本 <filename>rescan-scsi-bus.sh</filename> 在不重引导的情况下扫描设备的信息。</para>
       </entry>
      </row>
      <row id="boja57u">
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>添加了有关使用脚本 <filename>rescan-scsi-bus.sh</filename> 在不重引导的情况下扫描设备的信息。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bmy23qz">
  <title>2009 年 12 月 1 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bmy26at" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy2h0k" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy26aw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bmy26at">
   <title>管理设备的多路径 I/O </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmy26au">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bn4z2ku">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>-f mpath 选项已更改为 -f multipath：</para>
        <para>mkinitrd -f multipath</para>
       </entry>
      </row>
      <row id="bmy26av">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/>中的 <link linkend="b122sbgy">prio_callout</link></para>
       </entry>
       <entry>
        <para>多路径 prio_callout 程序位于 <filename>/lib/libmultipath/lib*</filename> 的共享库中。使用共享库可在守护程序启动时将该调出程序装载到内存中。 </para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bmy2h0k">
   <title>调整文件系统大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmy2h0l">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bmy2h0m">
       <entry>
        <para><xref linkend="biuytzx" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>resize2fs 实用程序支持联机或脱机调整 ext3 文件系统大小。 </para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bmy26aw">
   <title>新增功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmy26ax">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bmy26ay">
       <entry>
        <para><xref linkend="bmy1edt" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bn4z2kv">
       <entry>
        <para><xref linkend="bn4yxd1" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bm18yt7">
  <title>2009 年 10 月 20 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bm18yt8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bm1n6qa" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmqj45v" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bm18yt8">
   <title>LVM 配置</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bm18yt9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bm18yta">
       <entry>
        <para><xref linkend="sec_yast2_system_lvm_explanation" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 YaST 控制中心中，选择<menuchoice><guimenu>系统</guimenu><guimenu>分区程序</guimenu></menuchoice>。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bm1n6qa">
   <title>管理设备的多路径 I/O </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bm1n6qb">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bm1n6qc">
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>关键字 devnode_blacklist 已弃用且已替换为关键字黑名单。</para>
       </entry>
      </row>
      <row id="bmqiea8">
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>已将 getuid_callout 更改为 getuid。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bmqicwf">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>已将 getuid_callout 更改为 getuid。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bmqj3nw">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>添加了对 least-pending、length-load-balancing 和 service-time 选项的 path_selector 的说明。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bmqj45v">
   <title>新增功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmqj45w">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bmqj45x">
       <entry>
        <para><xref linkend="bmqiv07" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bleqdg7">
  <title>2009 年 8 月 3 日</title>
  <para>对下面一节进行了更新。更改解释如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bleqegm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bleqegm">
   <title>管理多路径 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bleqegn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bleqego">
       <entry>
        <para><xref linkend="bleqcv0" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bkkotcf">
  <title>2009 年 6 月 22 日</title>
  <para>对以下几节进行了更新：下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bkobnh2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bky5or6" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bkkout0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bkobnh2">
   <title>管理多路径 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bkobnh3">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bky5lwj">
       <entry>
        <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>针对 System Z 增加了<xref linkend="bky5jc7" xrefstyle="StepOnPage"/>和<xref linkend="bky5j1x" xrefstyle="StepOnPage"/>。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bkobnh4">
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>更正了步骤 2 中命令行的语法。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bky51ut">
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><xref linkend="befqjhp" xrefstyle="StepOnPage"/>替换旧的步骤 7 和步骤 8。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bky5or6">
   <title>使用 mdadm 管理软件 RAID 6 和 10</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bky5or7">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bky5or8">
       <entry>
        <para><xref linkend="raidmdadmdegraded" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>要在每秒刷新重建进度时查看此进度，请输入</para>

<screen>
watch -n 1 cat /proc/mdstat 
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bkkout0">
   <title>经由 IP 网络的大容量储存：iSCSI </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bkkout1">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bkkout2">
       <entry>
        <para><xref linkend="sec_inst_system_iscsi_initiator_yast" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>为了条理清晰，已重新整理材料。</para>
        <para>增加了有关如何将启动选项设置用于 iSCSI 目标设备的信息：</para>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <formalpara id="bkobopt">
           <title>自动：</title>
           <para>此选项用于 iSCSI 服务本身启动时要连接的 iSCSI 目标。这是典型配置。</para>
          </formalpara>
         </listitem>
         <listitem>
          <formalpara id="bkobopu">
           <title>引导时：</title>
           <para>此选项用于引导期间要连接的 iSCSI 目标；即，当根目录 (<filename>/</filename>) 位于 iSCSI 上时。这样，iSCSI 目标设备在服务器引导时将从 initrd 进行评估。</para>
          </formalpara>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bfmmkat">
  <title>2009 年 5 月 21 日</title>
  <para>对下面一节进行了更新。下面说明所作的更改。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bfmml01" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bfmml01">
   <title>管理多路径 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bfmml02">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>更改</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bkk3nxd">
       <entry>
        <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>使用多路径对 IBM zSeries 设备进行的测试显示，应将参数 dev_loss_tmo 设置为 90 秒，将参数 fast_io_fail_tmo 设置为 5 秒。如果要使用 zSeries 设备，必须手动创建和配置文件 <filename>/etc/multipath.conf</filename> 以指定值。有关信息，请参见<xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/>。</para>
       </entry>
      </row>
      <row id="bfmml04">
       <entry>
        <para><xref linkend="mpiotoolsdm" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 SUSE Linux Enterprise Server 11 和更高版本中，<filename>/boot</filename> 设备支持多路径。 </para>
       </entry>
      </row>
      <row id="bkj949q">
       <entry>
        <para><xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>此部分为新增的。</para>
       </entry>
      </row>
      <row id="bfmml03">
       <entry>
        <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 SUSE Linux Enterprise Server 11 中，对于 <filename>/boot</filename> 和 <filename>/root</filename>，DM-MP 现已可用并受到支持。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
</appendix>

</book>
