<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect1
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="lvm.xml" xml:id="sec-yast2-system-lvm">
 <title>LVMの設定</title><indexterm> <primary>YaST</primary> <secondary>LVM</secondary></indexterm><indexterm> <primary>LVM</primary> <secondary>YaST</secondary></indexterm><indexterm> <primary>論理ボリュームマネージャ</primary> <see>LVM</see></indexterm>

 <para>
  このセクションでは、LVM(論理ボリュームマネージャ)とその多目的機能の背後にある原理を手短に説明します。では、YaSTを使用したLVMのセットアップ方法を学びます。<xref linkend="sec-yast2-system-lvm-yast"/>
 </para>

 <warning>
  <para>
   LVMの使用によって、データ損失などの危険性が増大する場合があります。この危険性にはアプリケーションのクラッシュ、電源障害、誤ったコマンドなども含まれます。LVMまたはボリュームの再設定を実施する前にデータを保存してください。バックアップなしでは作業を実行しないでください。
  </para>
 </warning>

 <section xml:id="sec-yast2-system-lvm-explained">
  <title>論理ボリュームマネージャ(LVM)</title>
  <para>
   LVMは、複数のファイルシステム上でハードディスクスペースを柔軟に割り振ることができます。LVMが開発された理由は、初期パーティショニングの完了直後に、ハードディスクスペースのセグメンテーションを変更する必要が生じる場合があるためです。稼動中のシステムでパーティションを変更することは困難なため、LVMは必要に応じて論理ボリューム(LV)を作成できるメモリスペースの仮想プール(ボリュームグループ(VG))を提供します。オペレーティングシステムは物理パーティションの代わりにこれらのLVにアクセスします。ボリュームグループは2つ以上のディスクを占有できるので、複数のディスクまたはそれらの一部で1つのボリュームグループを構成することができます。このようにして、LVMは物理ディスクスペースからの一種の抽象化を提供します。これによって、物理的な再パーティショニングよりはるかに簡単で安全な方法で物理ディスクスペースのセグメンテーションを変更できます。物理パーティショニングに関連する背景情報については<xref linkend="sec-IB-part-typen"/>および<xref linkend="sec-yast2-i-y2-part-expert"/>を参照してください。
  </para>
  <figure xml:id="fig-lvm-explained-schematic">
   <title>物理パーティショニング対LVM</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="lvm.svg" width="75%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="lvm.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   <xref linkend="fig-lvm-explained-schematic"/>では物理パーティショニング(左)とLVM区分(右)を比較しています。左側では、1つのディスクが3つの物理パーティション(PART)に分割され、オペレーティングシステムがアクセスできるように、各PARTにはマウントポイント(MP)が割り当てられています。右側では2つのディスクがそれぞれ3つの物理パーティションに分かれています。2つのLVMボリュームグループ(VG 1およびVG 2)が定義されています。VG 1にはDISK 1とDISK 2の2つのパーティションが含まれます。VG 2はDISK 2の2つのパーティションを除いた残り部分になります。LVMではボリュームグループに組み込まれた物理ディスクパーティションは物理ボリューム(PV)と呼ばれます。ボリュームグループ内では、4つのLV(LV1からLV4まで)が定義されています。オペレーティングシステムは、これらのLVを関連のマウントポイントを介して使用できます。異なるLV間の境界をパーティション境界と整合させる必要はありません。この例ではLV 1およびLV 2の間に境界があります。
  </para>
  <para>
   LVMの機能:
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     複数のハードディスクまたはパーティションを大きな論理ボリュームにまとめることができます。
    </para>
   </listitem>
   <listitem>
    <para>
     設定が適切であれば、空き領域がなくなった場合には、LV(<filename>/usr</filename>など)を拡張できます。
    </para>
   </listitem>
   <listitem>
    <para>
     LVMを使用すると、実行中のシステムにハードディスクやLVを追加できます。ただし、これには、ホットスワップ可能なハードウェアが必要です。
    </para>
   </listitem>
   <listitem>
    <para>
     複数のPV上にLVのデータストリームを割り当てる「ストライピングモード」を有効にすることもできます。これらのPVが異なるディスクに分散している場合は、RAID 0と同様に、読み取り/書き込みのパフォーマンスが向上します。
    </para>
   </listitem>
   <listitem>
    <para>
     スナップショット機能は、稼動中のシステム(特に稼働中のサーバ)から一貫性のあるバックアップを取ることを可能にします。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   これらの機能を持つLVMは、酷使される家庭用PCや小規模なサーバに利用できます。LVMは、データストック(データベース、ミュージックアーカイブ、ユーザディレクトリなど)が増大するユーザに最適です。LVMは物理ハードディスクより大きなファイルシステムを利用できます。LVMのもう1つの利点は最大256個のLVを追加できることです。ただし、LVMの操作は、従来のパーティションの操作と異なります。LVMの設定についての指示および詳しい情報は<link xlink:href="http://tldp.org/HOWTO/LVM-HOWTO/"/>の公式LVM HOWTOからご利用いただけます。
  </para>
  <para>
   LVMバージョン2は、カーネルバージョン2.6以降で使用可能です。LVMバージョン2は、旧バージョンと後方互換性があり、これまでのボリュームグループの管理を継続できます。新しいボリュームグループを作成する場合は、新しいフォーマットと後方互換バージョンのどちらを使用するか決定します。LVM 2にはいずれのカーネルパッチも必要ありません。これは、カーネル2.6に統合されているデバイスマッパーを活用しています。このカーネルはLVMバージョン2のみをサポートしています。そのため、このセクションでLVMと書かれている場合、それはLVMバージョン2を指しています。
  </para>
  <section>
   <title>シンプロビジョニング</title>
   <para>
    カーネルバージョン3.4から、LVMではシンプロビジョニングをサポートしています。シンプロビジョニングされたボリュームには、仮想の容量と実際の容量が含まれます。<emphasis>仮想</emphasis>の容量とは、ホストで使用可能なボリュームストレージ容量です。<emphasis>実際</emphasis>の容量とは、ストレージプールからボリュームコピーに割り当てられたストレージ容量です。割り当てられたボリューム全体では、仮想の容量と実際の容量は同じになります。しかし、シンプロビジョニングされたボリュームでは、仮想の容量を実際の容量よりかなり大きくすることができます。シンプロビジョニングされたボリュームに書き込み操作のための十分な実際の容量がない場合、ボリュームはオフラインとなり、エラーが記録されます。
   </para>
   <para>
    一般情報の詳細については、<link xlink:href="http://wikibon.org/wiki/v/Thin_provisioning"/>を参照してください。
   </para>
  </section>
 </section>

 <section xml:id="sec-yast2-system-lvm-yast">
  <title>YaSTによるLVMの設定</title>
  <para>
   YaSTのLVM設定には、<guimenu>システムビュー</guimenu>ペインの<guimenu>ボリューム管理</guimenu>項目にあるYaSTエキスパートパーティショナ(<xref linkend="sec-yast2-i-y2-part-expert"/>参照)からアクセスできます。エキスパートパーティショナにより、既存のパーティションを編集および削除できます。また、LVMで使用する必要のある新規パーティションを作成することもできます。最初のタスクは、ボリュームグループに容量を提供するPVを作成することです。
  </para>
  <procedure>
   <step>
    <para>
     <guimenu>ハードディスク</guimenu>からハードディスクを選択します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>パーティション</guimenu>タブに変更します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>追加</guimenu>をクリックし、このディスク上のPVの適切なサイズを入力します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>パーティションをフォーマットしない</guimenu>を使用し、<guimenu>ファイルシステムID</guimenu>を<guimenu>0x8E Linux LVM</guimenu>に変更します。このパーティションはマウントしないでください。
    </para>
   </step>
   <step>
    <para>
     利用可能なディスク上で目的のすべての物理ボリュームを定義するまで、この手順を繰り返します。
    </para>
   </step>
  </procedure>
  <section>
   <title>ボリュームグループの作成</title>
   <para>
    システムにボリュームグループがまったく存在しない場合は、ボリュームグループを追加する必要があります(<xref linkend="fig-lvm-yast-volgrp"/>を参照)。<guimenu>システムビュー</guimenu>ペインで<guimenu>ボリューム管理</guimenu>をクリックし、次に、<guimenu>ボリュームグループの追加</guimenu>をクリックすることで、追加グループを作成できます。ボリュームグループは、通常、1つだけで十分です。
   </para>
   <procedure>
    <step>
     <para>
      ボリュームグループの名前(たとえば、<literal>システム</literal>)を入力します。
     </para>
    </step>
    <step>
     <para>
      <guimenu>Physical Extend Size</guimenu>で希望する物理エクステントサイズを選択します。この値はボリュームグループの物理ブロックサイズを定義します。ボリュームグループ内の全ディスクスペースが、このサイズのブロック単位で操作されます。
     </para>
    </step>
    <step>
     <para>
      デバイスを選択して<guimenu>追加</guimenu>をクリックし、用意のできたPVをVGに追加します。<keycap>Ctrl</keycap>キーを押しながらデバイスを選択すると、複数のデバイスを選択できます。
     </para>
    </step>
    <step>
     <para>
      <guimenu>完了</guimenu>を選択し、さらに詳細な設定手順でVGを使用できるようにします。
     </para>
    </step>
   </procedure>
   <figure xml:id="fig-lvm-yast-volgrp">
    <title>ボリュームグループの作成</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    複数の定義されたボリュームグループがあり、PVを追加または削除したい場合は、<guimenu>ボリューム管理</guimenu>リストでボリュームグループを選択し、<guimenu>サイズ変更</guimenu>をクリックします。次のウィンドウでは、選択したボリュームグループに対してPVを追加または削除できます。
   </para>
  </section>
  <section>
   <title>物理ボリュームの設定</title>
   <para>
    ボリュームグループへのPVの追加を完了したら、次のダイアログでオペレーティングシステムが使用するLVを定義します。現在のボリュームグループを選択し、<guimenu>論理ボリューム</guimenu>タブに切り替えます。ボリュームグループ内のすべての領域が満たされるまで、必要に応じて、<guimenu>追加</guimenu>、<guimenu>編集</guimenu>、<guimenu>サイズ変更</guimenu>、または<guimenu>削除</guimenu>でLVを操作します。各ボリュームグループに少なくとも1つのLVを割り当ててください。
   </para>
   <figure xml:id="fig-lvm-yast-mgmt">
    <title>論理ボリューム管理</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    <guimenu>追加</guimenu>をクリックして開いたウィザードのようなポップアップの指示に従って、次の手順を実行します。
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      LVの名前を入力します。<filename>/home</filename>にマウントするパーティションには、<literal>HOME</literal>などわかりやすい名前を使用します。
     </para>
    </listitem>
    <listitem>
     <para>
      LVのタイプを選択します。<guimenu>ノーマルボリューム</guimenu>、<guimenu>シンプール</guimenu>、または<guimenu>シンボリューム</guimenu>のいずれかとすることができます。個々のシンボリュームを保存できるシンプールを最初に作成する必要のあることに注意してください。
     </para>
    </listitem>
    <listitem>
     <para>
      LVのサイズ、およびストライプ数を選択します。PVが1つだけの場合は、複数のストライプを選択しても役に立ちません。
     </para>
     <tip>
      <para>
       シンプロビジョニングの大きなメリットは、シンプールに保存されたすべてのシンボリュームの総合計がプール自体のサイズを超過することができることです。
      </para>
     </tip>
    </listitem>
    <listitem>
     <para>
      LV上で使用するファイルシステムとマウントポイントを選択します。
     </para>
    </listitem>
   </orderedlist>
   <para>
    ストライプを使用することにより、複数のPV上(ストライピング)に存在するLVにデータストリームを分配することも可能です。ただし、ボリュームのストライピングは、各PVが少なくともそのボリュームのスペース量を提供する異なるPV間でのみ実行できます。ストライプの最大数は、PVの数に等しいので、ストライプ「1」とは、「ストライピングなし」を意味します。ストライピングは、互いに異なるハード デスクに存在するPV間で行う場合のみ有用です。そうでない場合は、パフォーマンスが減少します。
   </para>
   <warning>
    <title>ストライピング</title>
    <para>
     YaSTは、現時点では、ストライピングに関するエントリの正しさを確認できません。何か間違いがあった場合、それが明らかになるのはLVMがディスクに実装された後です。
    </para>
   </warning>
   <para>
    すでにシステム上にLVMを設定した場合、ここで既存の論理ボリュームを使用することもできます。続行する前に、これらのLVに適切なマウントポイントを割り当てます。<guimenu>完了</guimenu>を選択してYaSTエキスパートパーティショナに戻り、そこで作業を完了します。
   </para>
  </section>
 </section>


</section>
