<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="printing.xml" id="cha.p">
 <title>プリンタの運用</title><indexterm> <primary>印刷</primary> </indexterm>
 <para>
  <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>は、リモートネットワークプリンタも含め、さまざまな種類のプリンタを使った印刷をサポートしています。プリンタは手動で設定することも、YaSTを使用して設定することもできます。設定の詳細については、<xref linkend="sec.y2.hw.print"/>を参照してください。プリントジョブの開始、管理には、グラフィカルインタフェースまたはコマンドラインユーティリティの両方を利用できます。 プリンタが正常に動作しない場合は、<xref linkend="sec.drucken.prob"/>を参照してください。
 </para>
 <para>
  CUPS (Common Unix Printing System)は、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>の標準印刷システムです。
 </para>
 <para>
  プリンタは、インタフェース(USB、ネットワークなど)と、プリンタ言語によって区別できます。プリンタの購入時には、プリンタにご利用のハードウェアで利用できるインタフェース(USBやパラレルポートなど)が搭載されていること、およびプリンタの対応言語が正しいことをご確認ください。プリンタは、次の3つのプリンタ言語クラスに基づいて分類できます。
 </para>
 <variablelist>
  <varlistentry>
   <term>PostScriptプリンタ</term>
   <listitem>
    <para>
     PostScriptは、LinuxとUnix環境のほとんどの印刷ジョブを生成する際に使用されるプリンタ言語であり、内部の印刷システムもこの言語を使用して処理を行います。使用中のプリンタがPostScriptドキュメントを直接処理でき、印刷システム側で追加のステージを使用して変換を行う必要がない場合、潜在的なエラーの原因の数が減少します。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>標準的なプリンタ(PCLおよびESC/Pなどの言語)</term>
   <listitem>
    <para>
     これらのプリンタ言語はかなり古いのですが、プリンタで新機能を実現するために、引き続き拡張が行われています。既知のプリンタ言語の場合、印刷システムはGhostscriptの支援により、PostScriptのジョブを該当のプリンタ言語へ変換できます。この処理ステージを「解釈」(interpreting)と呼びます。非常によく知られている言語としては、ほとんどのHPのプリンタおよび互換モデルが採用しているPCLと、Epsonのプリンタが採用しているESC/Pがあります。これらのプリンタ言語は、通常、Linuxによってサポートされており、十分な印刷結果が得られています。Linuxは、一部の特殊な印刷機能に対応できない場合があります。HPが開発したHPLIP(HP Linux Imaging and Printing)を除き、現時点では、Linuxドライバを開発してオープンソースライセンスでそれらをLinuxディストリビュータに提供するプリンタメーカは存在しません。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry id="sec.p.prep.gdi">
   <term>独自規格のプリンタ(GDIプリンタ)</term>
   <listitem>
    <para>
     これらのプリンタは、共通のプリンタ言語をサポートしていません。これらのプリンタは独自のプリンタ言語を使用しており、新しいエディション/モデルがリリースされると、プリンタ言語も変更される可能性があります。一般的にこのようなプリンタでは、Windowsドライバしか利用できません。詳細については、<xref linkend="sec.drucken.gdi"/>を参照してください。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <para>
  新しいプリンタを購入する前に、次の各ソース(情報源)を参照し、購入を予定しているプリンタがどの程度までサポートされているかを確認してください。
 </para>
 <variablelist>
  <varlistentry>
   <term><ulink url="http://www.linuxfoundation.org/OpenPrinting/"/>
   </term>
   <listitem>
    <para>
     プリンタデータベースのあるOpenPrintingホームページです。このデータベースは、最新のLinuxサポートステータスを示します。しかし、Linuxのディストリビューションが統合できるのは、製造の時点で使用可能だったドライバだけです。したがって、現時点で<quote/>「完全にサポート済み」と評価されているプリンタであっても、最新バージョンの<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>がリリースされた時点では、そのステータスに達していなかった可能性があります。そのため、これらのデータベースは必ずしも正しいステータスを表しているとは限らず、おおよその状況を提示するだけにとどまっています。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><ulink url="http://pages.cs.wisc.edu/~ghost/"/>
   </term>
   <listitem>
    <para>
     GhostscriptのWebページ。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><filename>/usr/share/doc/packages/ghostscript-library/catalog.devices</filename>
   </term>
   <listitem>
    <para>
     付属するドライバのリスト
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <sect1 id="sec.p.workflow">
  <title>印刷システムのワークフロー</title>

  <para>
   ユーザが印刷ジョブを作成します。印刷ジョブは、印刷するデータとスプーラの情報から構成されますが、その情報には、プリンタの名前またはプリントキューの名前だけでなく、必要に応じて、プリンタ固有のオプションなど、フィルタに関する情報も含まれます。
  </para>

  <para>
   各プリンタには、1つ以上の専用印刷キューが存在しています。指定のプリンタがデータを受け取れるようになるまで、スプーラは印刷ジョブをキュー内に留めています。プリンタの準備が整うと、スプーラはフィルタおよびバックエンドを経由して、プリンタにデータを送信します。
  </para>

  <para>
   このフィルタは、印刷中のアプリケーションが生成したデータ(通常的はPostScriptやPDFですが、ASCII、JPEGなどの場合もあります)を、プリンタ固有のデータ(PostScript、PCL、ESC/Pなど)に変換します。プリンタの機能については、PPDファイルに記述されています。PPDファイルには、プリンタ固有のオプションが記述されています。各オプションに対しては、プリンタでそのオプションを有効にするために必要なパラメータが指定されています。フィルタシステムは、ユーザが有効として選択したオプションを確認します。
  </para>

  <para>
   PostScriptプリンタを選択すると、フィルタシステムがデータをプリンタ固有のPostScriptに変換します。この変換にプリンタドライバは必要ありません。PostScript非対応プリンタを使用すると、フィルタシステムがデータをプリンタ固有データに変換します。この変換には、使用しているプリンタに適応したプリンタドライバが必要です。バックエンドは、プリンタ固有データをフィルタから受信し、そのデータをプリンタに送信します。
  </para>
 </sect1>
 <sect1 id="sec.p.method">
  <title>プリンタに接続するための方法とプロトコル</title>

  <para>
   プリンタをシステムに接続するには、さまざまな方法があります。CUPS印刷システムの設定は、ローカルプリンタと、ネットワーク経由でシステムに接続されているプリンタを区別しません。
   
  </para>

  <para os="sles" arch="zseries">
   IBM System zのメインフレームにローカルで接続するz/VMによって提供されるプリンタおよび類似デバイスは、CUPSまたはLPRngのどちらでもサポートされていません。これらのプラットフォーム上では、ネットワーク経由の印刷だけを利用できます。ネットワークプリンタのケーブリング(ケーブル接続)は、プリンタメーカの指示にしたがって設置する必要があります。
  </para>



  <warning>
   <title>稼働中システムのケーブル接続の変更</title>
   <para>
    プリンタをコンピュータに接続する場合、コンピュータの動作中に接続と取り外しを行って良いのはUSBデバイスだけであることに注意してください。システムやプリンタの損傷を回避するために、USB以外の接続を変更する場合は、あらかじめシステムをシャットダウンしてください。
   </para>
  </warning>
 </sect1>
 <sect1 id="sec.p.software">
  <title>ソフトウェアのインストール</title>

  <para>
   PPD (PostScript printer description、PostScriptプリンタ記述)は、PostScriptプリンタの特性(解像度など)やオプション(両面印刷ユニットなど)を記述するコンピュータ言語です。これらの記述は、CUPS側でさまざまなプリンタオプションを使用するために必須です。PPDファイルがない場合、印刷データは<quote>raw</quote>(ロー、未加工)状態でプリンタへ送信されますが、そのことは通常は望ましくありません。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>のインストール中、多くのPPDファイルが事前インストールされます。
  </para>

  <para>
   PostScriptプリンタを設定する場合、最善のアプローチは、適切なPPDファイルを入手することです。この種の多数のPPDファイルは、標準インストールの範囲内で自動的にインストールされるパッケージ<systemitem>manufacturer-PPDs</systemitem>に用意されています。および<xref linkend="sec.drucken.prob.ppd"/>を参照してください。<xref linkend="sec.p.special.ppd"/>
  </para>



  <para>
   新しいPPDファイルは、<filename>/usr/share/cups/model/</filename>ディレクトリ内に保存するか、YaSTで印刷システムに追加できます(<xref linkend="sec.y2.hw.print.local.get_ppd"/>を参照)。その後は、プリンタのセットアップ時にPPDファイルを選択できるようになります。
  </para>

  <para>
   プリンタメーカーがソフトウェアパッケージ全体をインストールさせようとする場合には注意してください。第一に、このタイプのインストールを行うと、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>によって提供されているサポートが失われる場合があります。第二に、印刷コマンドが異なる動作をする可能性があり、システムが他のメーカーのデバイスに対応できなくなる場合があります。この理由で、メーカのソフトウェアをインストールすることをお勧めしません。
  </para>
 </sect1>
 <sect1 id="sec.p.net">
  <title>ネットワークプリンタ</title>

  <para>
   ネットワークプリンタは、さまざまなプロトコルをサポートできますし、その複数を同時にサポートすることも可能です。サポートされているプロトコルのほとんどが標準化されているので、一部のメーカーは標準を変更します。そして、メーカーは、2、3のオペレーティングシステムにのみ対応するドライバを提供します。残念なことに、Linuxドライバはめったに提供されません。現在の状況では、あらゆるプロトコルがLinux環境で円滑に動作するという仮定に基づいて行動することはできません。したがって、機能する設定を実現するために、さまざまなオプションを実験する必要があります。
  </para>



  <para>
   CUPSは、<systemitem>socket</systemitem>、<systemitem>LPD</systemitem>、<systemitem>IPP</systemitem>、および<systemitem>smb</systemitem>の各プロトコルをサポートしています。
  </para>

  <variablelist>
   <varlistentry>
    <term>socket</term>
    <listitem>
     <para>
      <emphasis>ソケット</emphasis>は、プレインプリントデータのTCPソケットへの直接送信に使用される接続です。一般的に使用されるsocketのポート番号のいくつかは、<option>9100</option>または<option>35</option>です。デバイスURI (Uniform Resource Identifier)の構文は、socket://<replaceable>IP.of.the.printer</replaceable>:<replaceable>port</replaceable>です(たとえば、<systemitem>socket://192.168.2.202:9100/</systemitem>)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>LPD (line printer daemon、ラインプリンタデーモン)</term>
    <listitem>
     <para>
      LPDプロトコルについては、RFC 1179で説明されています。このプロトコルの下では、印刷キューのIDなど、一部のジョブ関連データが送信されてから、実際の印刷データが送信されます。したがって、LPDプロトコルの設定時には印刷キューを指定する必要があります。さまざまなプリンタメーカによる実装は、プリントキューとして任意の名前を受け入れる柔軟性を備えています。必要に応じて、使用可能な名前がプリンタのマニュアルに提示されています。多くの場合、LPT、LPT1、LP1、または他の類似した名前が使用されています。LPDサービスが使用するポート番号は<option>515</option>です。デバイスURIの例は、<systemitem>lpd://192.168.2.202/LPT1</systemitem>です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>IPP (Internet Printing Protocol、インターネット印刷プロトコル)</term>
    <listitem>
     <para>
      IPPは、HTTPプロトコルに基づいた比較的新しい(1999年)プロトコルです。IPPを使用する場合、他のプロトコルより、ジョブとの関連性が高いデータが送信されます。CUPSは、IPPを使用して内部のデータ送信を行います。IPPを正しく設定するには、印刷キューの名前は必須です。IPPのポート番号は<literal>631</literal>です。デバイスURIの例は、<systemitem>ipp://192.168.2.202/ps</systemitem>および<systemitem>ipp://192.168.2.202/printers/ps</systemitem>です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SMB (Windows共有)</term>
    <listitem>
     <para>
      CUPSは、Windows共有に接続されたプリンタへの印刷もサポートしています。この目的で使用されるプロトコルは、SMBです。SMBは、ポート番号<option>137</option>、<option>138</option>、および<option>139</option>を使用します。デバイスURIの例は、<systemitem>smb://user:password@workgroup/smb.example.com/printer</systemitem>、<systemitem>smb://user:password@smb.example.com/printer</systemitem>、および<systemitem>smb://smb.example.com/printer</systemitem>です。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   設定を行う前に、プリンタがサポートしているプロトコルを決定する必要があります。メーカーから必要な情報が提供されていない場合は、コマンド<command>nmap</command>(<systemitem>nmap</systemitem>パッケージに付属)を使用して、プロトコルを推定します。<command>nmap</command>はホストのオープンポートを確認します。例:
  </para>

<screen>nmap -p 35,137-139,515,631,9100-10000 <replaceable>printerIP</replaceable></screen>

  <sect2 id="sec.p.net.config_cmdl">
   <title>コマンドラインツールによるCUPS設定</title>
   <para>
    CUPSは、<command>lpinfo</command>、<command>lpadmin</command>、<command>lpoptions</command>などのコマンドラインツールで設定できます。バックエンド(パラレルなど)とパラメータで構成されるデバイスURIが必要です。システム上の有効なデバイスURIを判断するには、<command>lpinfo -v | grep ":/"</command>コマンドを使用します。
   </para>
<screen># lpinfo -v | grep ":/"
direct usb://ACME/FunPrinter%20XL
direct parallel:/dev/lp0
</screen>
   <para>
    <command>lpadmin</command>を使用すると、CUPSサーバ管理者は、印刷キューの追加、削除、または管理を実行できます。プリントキューを追加するには、次の構文を使用します。
   </para>
<screen>lpadmin -p <replaceable>queue</replaceable> -v <replaceable>device-URI</replaceable> -P <replaceable>PPD-file</replaceable> -E</screen>
   <para>
    このデバイス(<option>-v</option>)は、指定したPPDファイル(<replaceable>-P</replaceable>)を使用して、<option>queue</option> (<option>-p</option>)として使用できます。プリンタを手動で設定する場合は、このPPDファイルとデバイスのURIを把握しておく必要があります。
   </para>
   <para>
    -E<option>は、最初のオプションとして使用しないでください。</option>どのCUPSコマンドでも、<option>-E</option>を最初の引数として使用した場合、暗号化接続を使用することを暗示的に意味します。プリンタを使用可能にするには、次の例に示す方法で<option>-E</option>を使用する必要があります。
   </para>
<screen>lpadmin -p ps -v parallel:/dev/lp0 -P \
/usr/share/cups/model/Postscript.ppd.gz -E</screen>
   <para>
    ネットワークプリンタの設定例:
   </para>
<screen>lpadmin -p ps -v socket://192.168.2.202:9100/ -P \
/usr/share/cups/model/Postscript-level1.ppd.gz -E</screen>
   <para>
    <command>lpadmin</command>のオプションの詳細は、<systemitem>lpadmin(8)</systemitem>のマニュアルページを参照してください。
   </para>
   <para>
    プリンタのセットアップ時には、一部のオプションがデフォルトとして設定されています。これらのオプションは、各印刷ジョブ用に変更できます(使用される印刷ツールに依存)。YaSTを使用して、これらのデフォルトオプションを変更することもできます。コマンドラインツールを使用して、デフォルトオプションを次のように設定します。
   </para>
   <procedure>
    <step performance="required">
     <para>
      最初に、すべてのオプションを列挙します。
     </para>
<screen>lpoptions -p <replaceable>queue</replaceable> -l</screen>
     <para>
      例:
     </para>
<screen>Resolution/Output Resolution: 150dpi *300dpi 600dpi</screen>
     <para>
      アクティブになったデフォルトオプションは、先頭にアスタリスク(<literal>*</literal>)が付いています。
     </para>
    </step>
    <step performance="required">
     <para>
      次のように<command>lpadmin</command>を使用してオプションを変更します。
     </para>
<screen>lpadmin -p <replaceable>queue</replaceable> -o Resolution=600dpi</screen>
    </step>
    <step performance="required">
     <para>
      新しい設定値の確認:
     </para>
<screen>lpoptions -p <replaceable>queue</replaceable> -l

Resolution/Output Resolution: 150dpi 300dpi *600dpi</screen>
    </step>
   </procedure>
   <para>
    標準ユーザが<command>lpoptions</command>を実行すると、設定が<filename>~/.cups/lpoptions</filename>に書き込まれます。ただし、<systemitem class="username">root</systemitem>設定は<filename>/etc/cups/lpoptions</filename>に書き込まれます。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.p.appl.commandline">
  <title>コマンドラインからの印刷</title><indexterm> <primary>印刷</primary> <secondary>コマンドライン</secondary> </indexterm> <indexterm> <primary>コマンド</primary> <secondary>lp</secondary> </indexterm>

  <para>
   コマンドラインから印刷するには、コマンド「<command>lp -d <replaceable>queuename</replaceable><replaceable>filename</replaceable></command>」を入力し、<replaceable>queuename</replaceable>および<replaceable>filename</replaceable>を対応する名前で置き換えます。
  </para>

  <para>
   一部のアプリケーションでは、印刷処理を<command>lp</command>コマンドに依存しています。この場合、アプリケーションの印刷ダイアログで正しいコマンドを入力します。ただし、通常は<replaceable>filename</replaceable>を指定しません。たとえば、「<command>lp -d <replaceable>queuename</replaceable></command>」と入力します。
  </para>
 </sect1>
 <sect1 id="sec.p.special">
  <title><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>の特別な機能</title>

  <para>
   CUPSの複数の機能は、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>で使用できるように調整されています。ここでは、最も重要な変更点について説明します。
  </para>

  <sect2 id="sec.p.special.cupsfire">
   <title>CUPSとファイアウォール</title>
   <para>
    デフォルトの<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>インストールを実行した後、SuSEfirewall2はアクティブになり、ネットワークインタフェースは着信トラフィックをブロックする<literal>外部ゾーン</literal>に設定されます。SuSEFirewall2の設定の詳細については、<xref linkend="sec.fire.SuSE"/>および<ulink url="http://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings"/>を参照してください。
   </para>
   <sect3 id="sec.p.special.cupsfire.client">
    <title>CUPSクライアント</title>
    <para>
     通常、CUPSクライアントはファイアウォール内部の信頼されるネットワーク環境の通常のワークステージョンで実行されます。この場合、ネットワークインタフェースを<literal>内部ゾーン</literal>に設定し、ワークステーションにネットワーク内部から到達できるようにすることを推奨します。
    </para>
   </sect3>
   <sect3 id="sec.p.special.cupsfire.server">
    <title>CUPSサーバ</title>
    <para>
     CUPSサーバがファイアウォールで保護された信頼済みネットワーク環境の一部の場合、ネットワークインタフェースはファイアウォールの<literal>内部ゾーン</literal>に設定します。CUPS設定で特別なファイアウォールルールおよびセキュア設定により保護する場合を除いて、信頼できないネットワーク環境でCUPSサーバを設定することはお勧めできません。
    </para>
   </sect3>
  </sect2>

  <sect2 id="sec.p.special.ppd">
   <title>各種パッケージ内のPPDファイル</title>
   <para>
    YaSTのプリンタ環境設定では、<filename>/usr/share/cups/model</filename>にインストールされたPPDファイルを使用して、CUPSのキューがセットアップされます。プリンタモデルに適合するPPDファイルを見つけるため、YaSTはハードウェア検出時に判別されたベンダおよびモデルを、すべてのPPDファイル内のベンダおよびモデルと比較します。このために、YaSTのプリンタ環境設定機能は、PPDファイルから抽出したベンダおよびモデルの情報に基づいて、データベースを生成します。
   </para>
   <para>
    PPDファイルのみを使用し、他の情報ソースを使用しない設定には、<filename>/usr/share/cups/model/</filename>内のPPDファイルを自由に変更できるという利点があります。たとえば、PostScriptプリンタのみを使用している場合、通常は<systemitem>cups-drivers</systemitem>パッケージ内にあるFoomatic PPDファイルや、<systemitem>gutenprint</systemitem>パッケージ内にあるGutenprint PPDファイルを必要としません。代わりに、使用中のPostScriptプリンタ用のPPDファイルを<filename>/usr/share/cups/model/</filename>へ直接コピーし(それらがまだ<systemitem>manufacturer-PPDs</systemitem>パッケージ内に存在していない場合)、使用中のプリンタに合わせて最適な設定を行うこともできます。
   </para>
   <sect3 id="sec.p.special.ppd.cups">
    <title>cups<systemitem>パッケージ内のCUPS PPDファイル</systemitem></title>
    <para>
     cups<systemitem>パッケージ内にある基本PPDファイルは、PostScript Level 1およびLevel 2プリンタに適応したFoomatic PPDファイルによって補足されます。</systemitem>
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       <filename>/usr/share/cups/model/Postscript-level1.ppd.gz</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       <filename>/usr/share/cups/model/Postscript-level2.ppd.gz</filename>
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="sec.p.special.ppd.foomatic">
    <title>cups-drivers<systemitem>パッケージ内のPPDファイル</systemitem></title>
    <para>
     通常、Foomaticプリンタフィルタの<systemitem>foomatic-rip</systemitem>は、PostScript非対応プリンタ用のGhostscriptと組み合わせて使用されます。適切なFoomatic PPDファイルには、<systemitem>*NickName: ... Foomatic/Ghostscript driver</systemitem>および<systemitem>*cupsFilter: ... foomatic-rip</systemitem>のエントリがあります。これらのPPDファイルは、<systemitem>cups-drivers</systemitem>パッケージ内にあります。
    </para>
    <para>
     YaSTでは一般に、<systemitem>manufacturer-PPD</systemitem>ファイルが優先されます。ただし、適切な<systemitem>manufacturer-PPD</systemitem>ファイルが存在しない場合は、<systemitem>*NickName: ... Foomatic ... (recommended)</systemitem>エントリを含むFoomatic PPDファイルが選択されます。
    </para>
   </sect3>
   <sect3 id="sec.p.special.ppd.gimp">
    <title><systemitem>gutenprint</systemitem>パッケージのGutenprint PPDファイル</title>
    <para>
     多くのPostScript非対応プリンタでは、<systemitem>foomatic-rip</systemitem>の代わりに、Gutenprint(以前のGIMP-Print)から取得したCUPSフィルタ<systemitem>rastertogutenprint</systemitem>を使用できます。このフィルタと、適切なGutenprint PPDファイルは、<systemitem>gutenprint</systemitem>パッケージ内に用意されています。Gutenprint PPD ファイルは <filename>/usr/share/cups/model/gutenprint/</filename> 内に配置されていて、そのファイル内にエントリ<systemitem>*NickName: ... CUPS+Gutenprint</systemitem>および<systemitem>*cupsFilter: ... rastertogutenprint</systemitem>があります。
    </para>
   </sect3>
   <sect3 id="sec.p.special.ppd.manu">
    <title>manufacturer-PPDs<systemitem>パッケージ内にあるプリンタメーカからのPPDファイル</systemitem></title>
    <para>
     manufacturer-PPDs<systemitem>パッケージには、十分自由なライセンスに基づいてプリンタメーカから提供されたPPDファイルが含まれています。</systemitem>PostScriptプリンタは、プリンタメーカの適切なPPDファイルを使用して設定するのが妥当です。このファイルを使用すると、そのPostScriptプリンタの機能すべてを活用できるためからです。<systemitem>manufacturer-PPDs</systemitem>パッケージから得られたPPDファイルが優先されます。ただし、モデル名が一致しない場合は、YaSTが<systemitem>manufacturer-PPD</systemitem>パッケージからのPPDファイルを使用することはできません。これは、Funprinter 12xxシリーズなど、類似モデルについて1つのPPDファイルのみが<systemitem>manufacturer-PPD</systemitem>パッケージに含まれる場合に該当します。この場合は、YaSTで対応するPPDファイルを手動で選択します。
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.drucken.prob">
  <title>トラブルシューティング</title>

  <para>
   ここでは、プリンタハードウェアおよびソフトウェアに最も一般的に発生する問題と、それを解決または回避する方法について説明します。GDIプリンタ、PPDファイル、およびポート設定などのトピックをカバーしています。一般的なネットワークプリンタに関する問題、印刷に問題がある場合、およびキュー処理についても対処しています。
  </para>

  <sect2 id="sec.drucken.gdi">
   <title>標準的なプリンタ言語をサポートしないプリンタ</title><indexterm> <primary>印刷</primary> <secondary>GDIプリンタ</secondary> </indexterm>
   <para>
    これらのプリンタは、共通のプリンタ言語をサポートしておらず、独自のコントロールシーケンスを使用しないと対処できません。そのため、これらのプリンタは、メーカがドライバを添付した特定のバージョンのオペレーティングシステムでのみ動作します。GDIは、Microsoft*がグラフィックデバイス用に開発したプログラミングインタフェースです。通常、メーカーはWindows用のドライバだけを提供しており、WindowsドライバはGDIインタフェースを使用しているため、これらのプリンタは「<emphasis>GDIプリンタ</emphasis>」と呼ばれることもあります。実質的な問題は、このプログラミングインタフェースではなく、これらのプリンタを制御できるのは、各プリンタモデルが採用している独自のプリンタ言語のみという事実にあります。
   </para>
   <para>
    いくつかのGDIプリンタは、GDIモードと標準的なプリンタ言語のいずれかの間で操作を切り替えることができます。切り替えができるかどうかは、プリンタのマニュアルを参照してください。モデルによっては、切り替えを行うために特別なWindowsソフトウェアが必要なこともあります(Windowsから印刷する場合、Windowsプリンタドライバは常にプリンタをGDIモードに切り替える場合があることに注意してください)。他のGDIプリンタでは、標準のプリンタ言語を利用するための拡張モジュールが用意されています。
   </para>
   <para>
    一部のメーカは、プリンタに独自規格のドライバを提供しています。独自規格のプリンタドライバの欠点は、インストール済みの印刷システムとそのドライバを組み合わせたときに動作するという保証も、さまざまなハードウェアプラットフォームに適しているという保証もないことです。一方、標準的なプリンタ言語をサポートするプリンタは、特殊なバージョンの印刷システムや特殊なハードウェアプラットフォームに依存しません。
   </para>
   <para>
    専有のLinuxドライバを機能させようと時間を費やす代わりに、標準プリンタ言語(PostScript推奨)をサポートするプリンタを購入する方が費用効率が高い場合があります。この方法により、ドライバの問題を一度だけで、そしてあらゆる状況で解決できます。特殊なドライバソフトウェアのインストールと設定を行う必要はなく、新しい印刷システムの開発に伴ってドライバのアップデートを入手する必要もありません。
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.ppd">
   <title>特定のPostScriptプリンタに適したPPDファイルが入手できない</title>
   <para>
    <systemitem>manufacturer-PPDs</systemitem>パッケージに、PostScriptプリンタに適したPPDファイルが含まれていない場合は、プリンタメーカのドライバCDにあるPPDファイルを使用したり、プリンタメーカのWebページから適切なPPDファイルをダウンロードすることができます。
   </para>
   <para>
    PPDファイルがzipアーカイブ(.zip)または自己展開zipアーカイブ(<filename>.exe</filename>)の形で提供されている場合、<command>unzip</command>を使用してそのファイルを展開します。最初に、PPDファイルのライセンス(許諾契約)条項を読みます。次に<command>cupstestppd</command>ユーティリティを使って、PPDファイルが<quote>Adobe PostScript Printer Description File Format Specification, version 4.3</quote>に準拠しているかどうかを確認します。<quote>FAIL</quote>ユーティリティから失敗が返された場合は、PPDファイル中のエラーは深刻なもので、問題を引き起こす可能性があります。<command>cupstestppd</command>によって報告された問題点は、取り除く必要があります。必要に応じて、適切なPPDファイルが入手できるかどうかをプリンタメーカに問い合わせることも考えられます。
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.parport">
   <title>パラレルポート</title>
   <para>
    最も安全なアプローチは、プリンタを最初のパラレルポートに直接接続し、BIOS内で次のパラレルポート設定値を選択することです。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      I/Oアドレス:<literal>378</literal> (16進)
     </para>
    </listitem>
    <listitem>
     <para>
      割り込み:無関係
     </para>
    </listitem>
    <listitem>
     <para>
      モード:<literal>Normal</literal> (通常)、<literal>SPP</literal>、または<literal>Output Only (出力専用)</literal>
     </para>
    </listitem>
    <listitem>
     <para>
      DMA:無効
     </para>
    </listitem>
   </itemizedlist>
   <para>
    これらの設定値を使用した場合でも、パラレルポートに接続したプリンタを使用できない場合、BIOS内での設定値に合わせて、I/Oアドレスを<literal>0x378</literal>という形で<filename>/etc/modprobe.conf</filename>内に明示的に入力します。2つのパラレルポートが存在し、それぞれのI/Oアドレスが<literal>378</literal>と<literal>278</literal> (16進)に設定されている場合、それらを<literal>0x378,0x278</literal>という形で入力します。
   </para>
   <para>
    割り込み(IRQ) <literal>7</literal>が空いている場合、<xref linkend="dat.d.interface.parport0.interrupt"/>に示すエントリを使用して、その割り込みを有効にすることもできます。割り込みモードを有効にする前に、<filename>/proc/interrupts</filename>ファイルを参照して、すでに使用中の割り込みを調べます。現時点で使用中の割り込みだけが表示されます。どのハードウェアコンポーネントがアクティブになっているかに応じて、この表示は変化することがあります。パラレルポート用の割り込みは、他のどのデバイスも使用してはなりません。自信がない場合、<literal>irq=none</literal>を指定してポーリングモードを使用します。
   </para>
   <example id="dat.d.interface.parport0.interrupt">
    <title><filename>/etc/modprobe.conf</filename>:最初のパラレルポートの割り込みモード</title>
<screen>alias parport_lowlevel parport_pc
options parport_pc io=0x378 irq=7</screen>
   </example>
  </sect2>

  <sect2 id="sec.drucken.prob.netconnect">
   <title>ネットワークプリンタ接続</title><indexterm> <primary>印刷</primary> <secondary>ネットワーク</secondary> </indexterm> <indexterm> <primary>印刷</primary> <secondary>トラブルシューティング</secondary> <tertiary>ネットワーク</tertiary> </indexterm>
   <variablelist>
    <varlistentry>
     <term>ネットワークの問題の識別</term>
     <listitem>
      <para>
       プリンタをコンピュータに直接接続します。テストの目的で、そのプリンタをローカルプリンタとして設定します。この方法で動作する場合、問題はネットワークに関連しています。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>TCP/IPネットワークの確認</term>
     <listitem>
      <para>
       TCP/IPネットワークと名前解決が正しく機能していることが必要です。
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term>リモート<command>lpd</command>の確認
     </term>
     <listitem>
      <para>
       次のコマンドを使用して、<replaceable>host</replaceable>上の<command>lpd</command> (ポート<literal>515</literal>)に対するTCP接続を確立できるかどうかをテストします。
      </para>
<screen>netcat -z <replaceable>host</replaceable> 515 &amp;&amp; echo ok || echo failed</screen>
      <para>
       <command>lpd</command>への接続を確立できない場合、<command>lpd</command>がアクティブになっていないか、ネットワークの基本的な問題があります。
      </para>
      <para>
       <systemitem class="username">root</systemitem>ユーザで次のコマンドを使用し、リモート<replaceable>host</replaceable>上の<replaceable>queue</replaceable>に関するステータスレポート(おそらく、非常に長い)を照会することもできます。これは、該当の<command>lpd</command>がアクティブで、そのホストが照会を受け付けることを前提にしています。
      </para>
<screen>echo -e "\004queue" \
| netcat -w 2 -p 722 <replaceable>host</replaceable> 515</screen>
      <para>
       <command>lpd</command>が応答しない場合、それがアクティブになっていないか、ネットワークの基本的な問題が発生している可能性があります。<command>lpd</command>が応答する場合、その応答は、<literal>host</literal>上にある<literal>queue</literal>を介して印刷ができない理由を示すはずです。<xref linkend="aus.d.lpd"/>で示すような応答を受け取った場合、問題はリモートの<command>lpd</command>にあります。
      </para>
      <example id="aus.d.lpd">
       <title><command>lpd</command>からのエラーメッセージ</title>
<screen>lpd: your host does not have line printer access
lpd: queue does not exist
printer: spooling disabled
printer: printing disabled</screen>
      </example>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>リモート<command>cupsd</command>の確認
     </term>
     <listitem>
      <para>
       CUPSネットワークサーバは、デフォルトで、UDPポート<literal>631</literal>から30秒ごとにキューをブロードキャストできます。したがって、次のコマンドを使用すると、ブロードキャストするCUPSネットワークサーバがネットワーク内に存在しているかどうかテストすることができます。コマンドを実行する前に、ローカルCUPSデーモンが終了していることを確認します。
      </para>
<screen>netcat -u -l -p 631 &amp; PID=$! ; sleep 40 ; kill $PID</screen>
      <para>
       ブロードキャストを行っているCUPSネットワークサーバが存在している場合、出力は<xref linkend="aus.d.bcast"/>に示すようになります。
      </para>
      <example id="aus.d.bcast">
       <title>CUPSネットワークサーバからのブロードキャスト</title>
<screen>ipp://192.168.2.202:631/printers/queue</screen>
      </example>
      <para os="sles" arch="zseries">
       IBM System zのイーサネットデバイスは、デフォルトではブロードキャストを受信しないことを考慮してください。
      </para>


      <para>
       次のコマンドを使用して、<replaceable>host</replaceable>上の<command>cupsd</command> (ポート<literal>631</literal>)に対するTCP接続を確立できるかどうかをテストすることができます。
      </para>
<screen>netcat -z <replaceable>host</replaceable> 631 &amp;&amp; echo ok || echo failed</screen>
      <para>
       <command>cupsd</command>への接続を確立できない場合は、<command>cupsd</command>が有効になっていないか、基本的なネットワークの問題が発生している可能性があります。<command>lpstat -h <replaceable>host</replaceable> -l -t</command>は、<replaceable>host</replaceable>上のすべてのキューに関するステータスレポート(非常に長い場合がある)を返しますが、それぞれの<command>cupsd</command>が有効になっていて、ホストがクエリを受け入れることが前提になります。
      </para>
      <para>
       次のコマンドを使用して、<replaceable>host</replaceable>上の<replaceable>queue</replaceable>が、1つのキャリッジリターン(CR、改行)文字からなる印刷ジョブを受け付けるかどうかをテストできます。何も印刷されないのが妥当です。おそらく、空白のページが排出されるはずです。
      </para>
<screen>echo -en "\r" \
| lp -d queue -h <replaceable>host</replaceable></screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>
      ネットワークプリンタまたは印刷サーバボックスのトラブルシューティング
     </term>
     <listitem>
      <para>
       プリントサーバボックス上のスプーラは時々、複数の印刷ジョブを処理する必要が生じた場合、問題を引き起こすことがあります。これはプリントサーバボックスのスプーラで発生するため、この問題を解決する方法はありません。回避策として、TCPソケットを使用して、プリントサーバボックスに接続されているプリンタに直接送信することで、プリントサーバボックス内のスプーラを使用しないようにします。詳細については、<xref linkend="sec.p.net"/>を参照してください。
      </para>
      <para>
       この方法により、印刷サーバボックスは異なる形式のデータ転送(TCP/IPネットワークとローカルプリンタ接続)間の単純なコンバータになります。この方法を使用するには、印刷サーバボックス内にある、該当するTCPポートについて把握する必要があります。プリンタがプリントサーバボックスに接続されていて、電源がオンになっている場合、プリントサーバボックスの電源をオンにした後、しばらく経過した時点で、<command>nmap</command>パッケージの<systemitem>nmap</systemitem>ユーティリティを使用することにより、このTCPポートを特定できます。たとえば、<command>nmap <replaceable>IP-address</replaceable></command>は、印刷サーバボックスに関して次のような出力をすることがあります。
      </para>
<screen>Port       State       Service
23/tcp     open        telnet
80/tcp     open        http
515/tcp    open        printer
631/tcp    open        cups
9100/tcp   open        jetdirect</screen>
      <para>
       この出力は、印刷サーバボックスに接続されているプリンタが、ポート<literal>9100</literal>上のTCPソケットを介して使用できることを示します。<command>nmap</command>はデフォルトでは、<filename>/usr/share/nmap/nmap-services</filename>内でリストされている多数の一般的な既知のポートだけを確認します。可能性のあるすべてのポートをチェックするには、<command>nmap -p <replaceable>from_port</replaceable>-<replaceable>to_port</replaceable><replaceable>IP-address</replaceable></command>コマンドを使用します。これは、ある程度の時間を要することがあります。詳細な情報については、<command>nmap</command>のマニュアルページを参照してください。
      </para>
      <para>
       次のようなコマンドを入力します。
      </para>
<screen>echo -en "\rHello\r\f" | netcat -w 1 IP-address port
cat file | netcat -w 1 IP-address port</screen>
      <para>
       これは、このポートを通してプリンタを使用できるかどうかをテストするために、該当のポートへ文字列またはファイルを直接送信します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 id="sec.drucken.prob.defective_printouts">
   <title>エラーメッセージを生成しない異常なプリントアウト</title>
   <para>
    印刷システムの観点では、CUPSバックエンドが受信側(プリンタ)へのデータ転送を完了した段階で、印刷ジョブは完了します。受信側でそれ以降の処理が失敗した場合(たとえば、プリンタがそのプリンタ固有のデータを印刷できない)、印刷システムはこれを検出しません。プリンタがそのプリンタ固有のデータを印刷できない場合、そのプリンタにより適していると考えられるPPDファイルを選択します。
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.disabled_queues">
   <title>無効にされたキュー</title>
   <para>
    受信側へのデータ転送が数回の試行後に完全に失敗した場合、<literal>usb</literal>や<literal>socket</literal>などのCUPSバックエンドは印刷システム(より正確には<command>cupsd</command>)にエラーを報告します。データ転送が不可能と報告される前に、バックエンドは何回の試行の失敗が妥当であるかを判断します。それ以上の試行は無駄に終わる可能性があるので、<command>cupsd</command>はそれぞれのキューの印刷を無効にします。問題の原因を取り除いた後、システム管理者は<command>cupsenable</command>コマンドを使用して、印刷を再度有効にする必要があります。
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.deleting_jobs">
   <title>CUPS参照:印刷ジョブの削除</title>
   <para>
    CUPSネットワークサーバが参照機能を使用して自らのキューをクライアントホストへブロードキャストし、クライアントホスト側で適切なローカル<command>cupsd</command>がアクティブになっている場合、クライアント側の<command>cupsd</command>はアプリケーションから印刷ジョブを受け付け、サーバ側の<command>cupsd</command>へそれらを転送します。サーバ上で<command>cupsd</command>が印刷ジョブを受け付けると、そのジョブには新しいジョブ番号が割り当てられます。したがって、クライアントホスト上のジョブ番号は、サーバ上のジョブ番号とは異なっています。印刷ジョブは通常、即座に転送されるので、クライアントホスト上でジョブ番号でそのジョブを削除することはできません。クライアント側の<command>cupsd</command>は、サーバ側の<command>cupsd</command>への転送が完了した時点で、その印刷ジョブは完了したと考えるからです。
   </para>
   <para>
    サーバ上にあるプリントジョブを削除したい場合、<command>lpstat -h cups.example.com -o</command>などのコマンドを使用してサーバ上のジョブ番号を判断します。サーバがまだそのプリントジョブを完了していない(つまり、プリンタへ完全に送信していない)ことが前提条件です。このジョブ番号を使用して、サーバ上にある印刷ジョブを削除できます。
   </para>
<screen>cancel -h cups.example.com <replaceable>queue-jobnumber</replaceable></screen>
  </sect2>

  <sect2 id="sec.drucken.prob.brokenjobs">
   <title>異常な印刷ジョブとデータ転送エラー</title>
   <para>
    印刷プロセス中にプリンタの電源を切ったり、コンピュータをシャットダウンすると、印刷ジョブはキュー内に残ります。コンピュータ(またはプリンタ)の電源を再度投入すると、印刷が再開されます。異常な印刷ジョブは、<command>cancel</command>を使用してキューから削除する必要があります。
   </para>
   <para>
    印刷ジョブが異常な場合、またはホストとプリンタの間で通信エラーが発生した場合、プリンタはデータを正しく処理できなくなるので、文字化けのような大量のページを印刷することがあります。この状況を修正するには、次の手順に従います。
   </para>
   <procedure>
    <step performance="required">
     <para>
      プリンタの動作を停止するために、インクジェットプリンタの場合、すべての用紙を取り除きます。レーザープリンタの場合、用紙トレイを開けます。上位機種のプリンタでは、現在のプリントアウトをキャンセルするボタンを用意していることもあります。
     </para>
    </step>
    <step performance="required">
     <para>
      この時点で、印刷ジョブはキューに残っている可能性があります。ジョブがキューから削除されるのは、ジョブ全体をプリンタへ送信した後に限られるからです。<command>lpstat -o</command>または<command>lpstat -h cups.example.com -o</command>を使用して、どのキューが現在印刷に使用されているかを確認します。<command>cancel <replaceable>queue</replaceable>-<replaceable>jobnumber</replaceable> </command>または<command>cancel -h cups.example.com <replaceable>queue</replaceable>-<replaceable>jobnumber</replaceable></command>を使用して、該当のプリントジョブを削除します。
     </para>
    </step>
    <step performance="required">
     <para>
      印刷ジョブがすでにキューから削除されたにもかかわらず、一部のデータが依然として、プリンタへ送信され続けることもあります。CUPSバックエンドプロセスが、引き続き該当のキューを対象として動作しているかどうかをチェックし、その処理を終了します。たとえば、プリンタがパラレルポートに接続されている場合、<command>fuser -k /dev/lp0</command>コマンドを使用して、引き続きそのプリンタ(より正確に表現すると、パラレルポート)にアクセスしているすべてのプロセスを終了することができます。
     </para>
    </step>
    <step performance="required">
     <para>
      ある程度の時間にわたって電源をオフにして、プリンタを完全にリセットします。その後、紙を元に戻し、プリンタの電源をオンにします。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.drucken.prob.debugging">
   <title>CUPS印刷システムのデバッグ</title>
   <para>
    CUPS印刷システムの問題を特定するために、次の一般的な処理を実行してください。
   </para>
   <procedure>
    <step performance="required">
     <para>
      <filename>/etc/cups/cupsd.conf</filename>内に、<command>LogLevel debug</command>を設定します。
     </para>
    </step>
    <step performance="required">
     <para>
      <command>cupsd</command>コマンドを停止します。
     </para>
    </step>
    <step performance="required">
     <para>
      <filename>/var/log/cups/error_log*</filename>を削除して、大規模なログファイルから検索を行うことを避けます。
     </para>
    </step>
    <step performance="required">
     <para>
      <command>cupsd</command>を起動します。
     </para>
    </step>
    <step performance="required">
     <para>
      問題の原因となったアクションをもう一度実行します。
     </para>
    </step>
    <step performance="required">
     <para>
      <filename>/var/log/cups/error_log*</filename>内のメッセージを確認し、問題の原因を識別します。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.drucken.prob.more_information">
   <title>詳細情報</title>
   
   <para os="sles;sled;">
    SUSE Knowledgebase (<ulink url="http://www.suse.com/support/"/>)では、さまざまな個別の問題のソリューションが紹介されています。<literal>CUPS</literal>のテキスト検索機能により関連する記事を見つけてください。
   </para>
  </sect2>
 </sect1>
</chapter>
