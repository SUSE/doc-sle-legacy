<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="sle_update.xml" id="cha-update-sle">
 <title>SUSE Linux Enterpriseのアップデート</title>
 <abstract>
  <para>
   SUSE® Linux Enterprise (SLE)には、完全な再インストールを実行せずに既存のシステムを新しいバージョンに更新できるオプションがあります。新たにインストールする必要はありません。ホームディレクトリ、システム設定などの既存のデータは、そのまま保持されます。製品のライフサイクル中は、サービスパックを適用することで、システムセキュリティを向上させ、ソフトウェアの不具合を修正し、新機能にアクセスすることができます。CD/DVDドライブから、またはネットワーク上のインストールソースからインストールします。
  </para>
 </abstract>
 <sect1 id="sec-update-terminology">
  <title>用語集</title>

  <para>
   この章では、いくつかの用語を使用します。それらの情報を理解するには、以下の定義をお読みください。
  </para>

  <variablelist>
   <varlistentry>
    <term>バックポート</term>
    <listitem>
     <para>
      バックポートとは、新しいバージョンのソフトウェアによる特定の変更内容を採用し、それを古いバージョンに適用することを意味します。最も一般的な使用事例は、古いソフトウェアコンポーネントのセキュリティホールの修正です。通常は、拡張機能や(頻度は低いものの)新機能を提供するための保守モデルの一部にもなります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>Deltarpm</term>
    <listitem>
     <para>
      delatrpmは、2つの定義されたパッケージバージョンのバイナリ差分のみで構成されているので、ダウンロードサイズは最小です。インストールの前に、RPMのフルパッケージがローカルコンピュータ上で再構築されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>ダウンストリーム</term>
    <listitem>
     <para>
      オープンソースワールドにおけるソフトウェア開発方法のメタファーです(<emphasis>アップストリーム</emphasis>と対比)。<emphasis/>「ダウンストリーム」という用語は、アップストリームからのソースコードを他のソフトウェアと統合し、エンドユーザが使用するためのディストリビューションを構築する、SUSEのような人や組織を指しています。つまり、ソフトウェアは開発者からインテグレータを介して、エンドユーザーまで、ダウンストリーム(下向き)に流れていきます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>オンラインマイグレーション</term>
    <listitem>
     <para>
      それぞれのパッチをインストールするために、(インストールメディアではなく)オンラインアップデートツールを使用して、サービスパック(SP)への更新を行うことです。インストールシステムのすべてのパッケージを最新状態にアップデートします(SP3およびSP2アップデートを含む)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>パッケージ</term>
    <listitem>
     <para>
      パッケージは、<literal>rpm</literal>形式で圧縮されたファイルで、特定のプログラムのすべてのファイルが格納されています。環境設定、サンプル、ドキュメントなどのオプションコンポーネントも含まれます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>パッチ</term>
    <listitem>
     <para>
      パッチは、１つ以上のパッケージから成り、deltarpmで適用されることがあります。また、まだインストールされていないパッケージへの依存関係を導入することもあります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>サービスパック(SP)</term>
    <listitem>
     <para>
      複数のパッチを組み合わせて、インストールまたは展開しやすい形式にします。サービスパックには番号が付けられ、通常、プログラムのセキュリティ修正、更新、アップグレード、または拡張機能が含まれます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>アップストリーム</term>
    <listitem>
     <para>
      オープンソースワールドにおけるソフトウェア開発方法のメタファーです(<emphasis>ダウンストリーム</emphasis>と対比)。<emphasis>アップストリーム</emphasis>という用語は、ソースコードとして配布されるソフトウェアの元のプロジェクト、作者、またはメンテナンス者を指しています。フィードバック、パッチ、拡張機能、その他の改良機能は、エンドユーザまたはコントリビュータからアップストリーム(上流)の開発者に流れていきます。開発者は、リクエストを組み込むのか却下するのか決定します。
     </para>
     <para>
      プロジェクトメンバーがリクエストを組み込むように決定すると、それが新しいバージョンのソフトウェアに出現します。受け入れられたリクエストは、すべての関係者にメリットをもたらします。
     </para>
     <para>
      リクエストが受け入れられない場合は、別の理由が考えられます。プロジェクトのガイドラインに準拠していない、無効である、すでに組み込まれている、プロジェクトに関係ないかロードマップ上に存在しないなどの中のいずれかの理由です。リクエストが受け入れられない場合、アップストリームの開発者にとっては、自分のパッチをアップストリームのコードと同期させる必要があるために困難が生じます。この操作は一般的には回避されますが、まだ必要な場合もあります。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term>アップデート</term>
    <listitem>
     <para>
      パッケージの新しい<emphasis>マイナー</emphasis>バージョンのインストール。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>アップグレード</term>
    <listitem>
     <para>
      パッケージまたは配布の新しい<emphasis>主要</emphasis>バージョンのインストール。これにより<emphasis>新機能</emphasis>がもたらされます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec-update-nmm">
  <title>SUSE Linux Enterprise 11の保守モデル</title>

  <para>
   SUSE Linux Enterprise 11の保守モデルでは、サービスパックの柔軟性と制御を組み合わせています。このモデルには、次の利点があります。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     サービスパックが軽量化し、そのテストと展開が容易になります。
    </para>
   </listitem>
   <listitem>
    <para>
     旧バージョンとの共存を可能にする一方で、フルシステムをサポートします。
    </para>
   </listitem>
   <listitem>
    <para>
     選択的な機能拡張でサービスパック間のマーケットニーズに対処し、一般更新リポジトリ内におけるより多くの更新を可能にします。機能拡張の選択により、サービスパックの間隔が長期化するのを緩和します。
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec-update-background">
   <title>予備知識</title>
   <para>
    この数年間、お客様のフィードバックに基づく機能改善の必要性が明らかになり、SUSEでは、ユーザにアップデートを提供する方法に関してさまざまな変更を実施しました。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      SLES 9では、すべてのアップデートが収集されるアップデートリポジトリが1つしかなく、最新リリースのアップデートが唯一サポートされているだけでした。
     </para>
    </listitem>
    <listitem>
     <para>
      SLES 10 SP1以降、<quote>SP固有のリポジトリ</quote>という概念が導入されました。つまり、1つのサービスパックに対するすべてのアップデートが、1つの固有のリポジトリで提供されるようになったのです。Novell Customer Centerで直接登録した場合、新しいサービスパックにマイグレートしたユーザは、それ以前のリポジトリにはアクセスできなくなります。SMTまたはSUSE Managerのユーザは、これまでも現在も、すべてのSPチャネルを無料で購読できます。この変更の主な理由は、リリースされたサービスパックの検証を可能にし、お客様に対するマイグレーション窓口を用意するための6か月の重複期間(1つ前のサービスパックのサポート)という概念でした。これにより、古いSP内でメンテナンスとサポートが完全に継続されることになります。
     </para>
    </listitem>
    <listitem>
     <para>
      SLES 11 GAとSLES 11 SP1は、SLES 10モデルの後継バージョンです。SLES 11 SP2により、以下で構成される新しいリポジトリモデルが導入されました。
     </para>
     <orderedlist numeration="lowerroman" spacing="normal">
      <listitem>
       <para>
        SLES 11 SP1アップデートリポジトリは、購読されたままです。SP2にも適用可能なすべてのアップデートは、SP1アップデートリポジトリにもリリースされるか、SP1アップデートリポジトリのみにリリースされています。つまり、ここには、ABIおよびAPIの互換性を保持しているすべてのアップデートが引き続き配信されています。
       </para>
      </listitem>
      <listitem>
       <para>
        SLES 11 SP2アップデートリポジトリには、(さまざまな理由で)SP1アップデートリポジトリには配信できない最新の革新的なアップデートのみが含まれています。これに加えて当社ではコアリポジトリを導入しました。これは、SP1とSP2のどちらのアップデートリポジトリにもリリースされなかったパッケージの<quote>ギャップ</quote>を提供するものです。
       </para>
      </listitem>
      <listitem>
        <para>SLES 11 SP4は、SLES 10と同様のチャネルモデルを持つことになります。このモデルは、特定のサービスパックを対象にしたアップデートを提供するための最も簡単で迅速な方法として受け入れられています。すべてのアップデートは、特別なアップデートチャネルを介して提供されます。お使いのマシンでは追加のチャネルが使用可能になりますが、古いチャネルは削除されます。 </para>
      </listitem>
     </orderedlist>
    </listitem>
   </itemizedlist>
   <para>
    上記の一部の側面は、<xref linkend="fig-update-maintenance-evolution"/>で説明されています。
   </para>
   <figure id="fig-update-maintenance-evolution">
    <title>メンテナンス配信の進化(SLEDにも当てはまる)</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="new-maintenance-model.svg" width="75%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="new-maintenance-model.png" width="75%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    弊社の製品のライフサイクルは10年です。そのうち10年間は一般サポート、3年間は拡張サポートが適用されます。主要リリースは4年ごと、サービスパックは18カ月ごとに作成されます。Long Term Service Pack Support(長期サービスパックサポート)は、延長された期間つまり延長された主要リリースライフサイクルをサポートします(<xref linkend="fig-update-maintenance-long-term-service-pack"/>参照)。
   </para>
   <figure id="fig-update-maintenance-long-term-service-pack">
    <title>長期サービスパックサポート</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="long-term-service-pack-support.svg" width="75%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="long-term-service-pack-support.png" width="75%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Long Term Service Pack Supportには、アクティブな購読(標準または優先のいずれか)が必要です。このサポートは、L1やL2の購読約款には影響しません。セキュリティ更新は、<quote>プロアクティブに</quote>処理されます。これらは、非ユーザ主導の更新であり、重大な脆弱性やカーネルでのローカルルートエクスプロイトなどのルートエクスプロイトの修正をユーザ介入なしで直接実行します。
   </para>
  </sect2>

  <sect2 id="sec-update-supportlevel-lifecycle">
   <title>サポートレベル</title>
   <para>
    拡張サポートレベルの範囲は、8年目から10年目までになります。これらのサポートレベルには、継続されるL3エンジニアリングレベルの診断とリアクティブな重大なバク修正が含まれます。これらのサポートレベルでは、重要でないカーネルでのローカルルートエクスプロイトなどのルートエクスプロイトに対しては、ユーザ介入なしで直接実行可能な更新をプロアクティブにサポートします。さらに、限られたパッケージ除外リストを使用して、既存のワークロード、ソフトウェアスタック、およびハードウェアをサポートします。概要については、<xref linkend="tab-security-and-bug-fixes"/>を参照してください。
   </para>
   <table id="tab-security-and-bug-fixes">
    <title>セキュリティ更新とバグの修正</title>
    <tgroup cols="6">
     <colspec colname="c1"/>
     <colspec colname="c2"/>
     <colspec colname="c3"/>
     <colspec colname="c4"/>
     <colspec colname="c5"/>
     <colspec colname="c6"/>
     <thead>
      <row>
       <entry/>
       <entry namest="c2" nameend="c5" align="center">
        <para>
         — 一般サポート —
        </para>
       </entry>
       <entry>
        <para>
         拡張サポート
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         トピック
        </para>
       </entry>
       <entry>
        <para>
         現在のSP
        </para>
       </entry>
       <entry>
        <para>
         SP (n-1)
<?dblinebreak ?>


         6ヶ月
        </para>
       </entry>
       <entry>
        <para>
         SP (n-1)
<?dblinebreak ?>


         LTSS
        </para>
       </entry>
       <entry>
        <para>
         6年目と7年目
<?dblinebreak ?>


         LTSS
        </para>
       </entry>
       <entry>
        <para>
         8、9、10年目
<?dblinebreak ?>


         LTSS
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         L1/L2テクニカルサービス
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         先行保守
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry/>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry/>
      </row>
      <row>
       <entry>
        <para>
         PLDPによるドライバ更新
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry/>
       <entry/>
      </row>
      <row>
       <entry>
        <para>
         先行セキュリティ更新
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry/>
      </row>
      <row>
       <entry>
        <para>
         L3エンジニアリングサポート
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         バックポートあり
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry/>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
       <entry>
        <para>
         ✓
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 id="sec-update-nmm-channels">
   <title>チャネルモデル</title>
   <para os="sles">
    以前の保守モデルでは、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>には、<literal>SLES11-SPx-Pool</literal>と<literal>SLES11-SPx-Updates</literal>という2つのチャネルが割り当てられていました。SPx+1へのオンラインマイグレーションの過程で、これらのチャネルは一時的に<literal>SLES11-SPx-Online</literal>に置き換えられていました。
   </para>
   
   <para>
    SUSE Linux Enterprise SP 2では、新しい保守モデルの利点をサポートするために、チャネルレイアウトが変更されました。<xref linkend="tab-update-nmm-channels-sp2"/>には、SP1からSP3までのすべてのチャネルのリストが含まれています。
   </para>
   <table id="tab-update-nmm-channels-sp2">
    <title>SUSE Linux Enterprise 11 SP1、SP2、およびSP3のチャネルレイアウト</title>

    <tgroup cols="3">
     <colspec colnum="1" colname="c1" colwidth="1.2*"/>
     <colspec colnum="2" colname="c2" colwidth="3*"/>
     <colspec colnum="3" colname="c3" colwidth="3*"/>
     <thead>
      <row>
       <entry>
        <para>
         タイプ
        </para>
       </entry>
       <entry>
        <para>
         SLES
        </para>
       </entry>
       <entry>
        <para>
         SLED
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         必要なチャネル
        </para>
       </entry>
       <entry>
        <para>
         SP1
        </para>
        <simplelist>
         <member><literal>SLES11-SP1-Pool</literal> </member> <member><literal>SLES11-SP1-Updates</literal> </member>
        </simplelist>
        <para>
         SP2
        </para>
        <simplelist>
         <member><literal>SLES11-SP1-Pool</literal> </member> <member><literal>SLES11-SP1-Updates</literal> </member> <member><literal>SLES11-SP2-Core</literal> </member> <member><literal>SLES11-SP2-Updates</literal> </member>
        </simplelist>
        <para>
         SP3
        </para>
        <simplelist>
         <member><literal>SLES11-SP3-Pool</literal> </member> <member><literal>SLES11-SP3-Updates</literal> </member>
        </simplelist>
         <para>SP4</para>
         <simplelist>
           <member><literal>SLES11-SP4-Pool</literal> </member> <member><literal>SLES11-SP4-Updates</literal></member>
         </simplelist>
       </entry>
       <entry>
        <para>
         SP1
        </para>
        <simplelist>
         <member><literal>SLED11-SP1-Pool</literal> </member> <member><literal>SLED11-SP1-Updates</literal> </member>
        </simplelist>
        <para>
         SP2
        </para>
        <simplelist>
         <member><literal>SLED11-SP1-Pool</literal> </member> <member><literal>SLED11-SP1-Updates</literal> </member> <member><literal>SLED11-SP2-Core</literal> </member> <member><literal>SLED11-SP2-Updates</literal> </member>
        </simplelist>
        <para>
         SP3
        </para>
        <simplelist>
         <member><literal>SLED11-SP3-Pool</literal> </member> <member><literal>SLED11-SP3-Updates</literal> </member>
        </simplelist>
        <para>SP4</para>
         <simplelist>
           <member><literal>SLED11-SP4-Pool</literal> </member> <member><literal>SLED11-SP4-Updates</literal></member>
         </simplelist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         オプションチャネル
        </para>
       </entry>
       <entry>
        <para>
         SP1
        </para>
        <simplelist>
         <member><literal>SLES11-SP1-Debuginfo-Pool</literal> </member> <member><literal>SLES11-SP1-Debuginfo-Updates</literal> </member>
        </simplelist>
        <para>
         SP2
        </para>
        <simplelist>
         <member><literal>SLES11-SP2-Debuginfo-Core</literal> </member> <member><literal>SLES11-SP2-Debuginfo-Updates</literal> </member> <member><literal>SLES11-Extras</literal> </member> <member><literal>SLES11-SP2-Extension-Store</literal> </member>
        </simplelist>
        <para>
         SP3
        </para>
        <simplelist>
         <member><literal>SLES11-SP3-Debuginfo-Core</literal> </member> <member><literal>SLES11-SP3-Debuginfo-Updates</literal> </member> <member><literal>SLES11-SP3-Extension-Store</literal> </member> <member><literal>SLES11-Extra</literal> </member>
        </simplelist>
         <para>SP4</para>
         <simplelist>
           <member><literal>SLES11-SP4-Debuginfo-Pool</literal> </member> <member><literal>SLES11-SP4-Debuginfo-Updates</literal></member> <member><literal>SLES11-Extra</literal></member> <member><literal>SLES11-Security-Module</literal></member>
         </simplelist>
       </entry>
       <entry>
        <para>
         SP1
        </para>
        <simplelist>
         <member><literal>SLED11-SP1-Debuginfo-Pool</literal> </member> <member><literal>SLED11-SP1-Debuginfo-Updates</literal> </member>
        </simplelist>
        <para>
         SP2
        </para>
        <simplelist>
         <member><literal>SLED11-SP2-Debuginfo-Core</literal> </member> <member><literal>SLED11-SP2-Debuginfo-Updates</literal> </member> <member><literal>SLED11-Extras</literal> </member> <member><literal>SLED11-SP2-Extension-Store</literal> </member>
        </simplelist>
        <para>
         SP3
        </para>
        <simplelist>
         <member><literal>SLED11-SP3-Debuginfo-Core</literal> </member> <member><literal>SLED11-SP3-Debuginfo-Updates</literal> </member> <member><literal>SLED11-SP3-Extension-Store</literal> </member> <member><literal>SLED11-Extra</literal> </member>
        </simplelist>
         <para>SP4</para>
         <simplelist>
           <member><literal>SLED11-SP4-Debuginfo-Pool</literal> </member> <member><literal>SLED11-SP4-Debuginfo-Updates</literal></member>
         </simplelist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         製品固有(例)
        </para>
       </entry>
       <entry>
        <simplelist>
         <member><literal>SLES11-WebYaST-SP2-Pool</literal> </member> <member><literal>SLES11-WebYaST-SP2-Updates</literal> </member>
        </simplelist>
       </entry>
       <entry>
        <simplelist>
         <member><literal>SLED11-MSI-Updates</literal> </member>
        </simplelist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <variablelist>
    <title>必要なチャネルの説明</title>
    <varlistentry>
     <term>Core</term>
     <listitem>
      <para>
       パックされていないインストールメディアのサブセットで、SPxの<quote>コア</quote>だと見なされるパッケージのみが格納されます(パッケージ全体の約30%)。SPリポジトリには、SPとそのテーマ(ハードウェアイネーブルメントなど)に固有のパッケージのみが格納されます。SP2のみに存在します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>更新内容</term>
     <listitem>
      <para>
       保守によって更新されるのは、対応する<literal>Core</literal>または<literal>Pool</literal>リポジトリ内のパッケージのみです。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Pool</term>
     <listitem>
      <para>
       インストールメディアからのすべてのバイナリRPMとパターン情報が格納され、ステータスメタデータをサポートします。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <variablelist>
    <title>オプションチャネルの説明</title>
    <varlistentry>
     <term>Debuginfo-Pool</term>
     <term>Debuginfo-Updates</term>
     <listitem>
      <para>
       これらのチャネルには、静的なコンテンツが格納されます。ただし、アップデートを受信するのは<literal>Debuginfo-Updates</literal>チャネルのみです。問題の発生時にデバッグ情報を含むライブラリをインストールする必要がある場合は、これらのチャネルを有効にします。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Extension-Store</term>
     <listitem>
      <para> 未使用です。(将来的な)アドオン製品用のパッケージを格納するためにサポートされています。SLES 11 SP4以降、Extension Storeチャネルは削除されます。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>LTSS-Updates</term>
     <listitem>
      <para>
       Long Term Support Service (LTSS)を含むインストールの場合に、対応する<literal>Pool</literal>リポジトリ内のパッケージが保守によって更新されます。この特定のチャネルにはLTSS契約が必要です。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <sect3 id="sec-update-nmm-channels-origin">
    <title>パッケージの起源</title>
    <formalpara>
     <title>SUSE Linux Enterprise 11 SP3/SP4</title>
     <para>SP3のインストールでは、SLES11-SP3-PoolとSLES11-SP3-Updatesという2つのチャネルのみが使用可能です。SP2からの以前のチャネルは表示されますが、有効にはなりません。これらの無効なチャネルは、特定のニーズを持つユーザのみが必要としています。 
     </para>
    </formalpara>
   </sect3>
   <sect3 id="sec-update-nmm-channels-working">
    <title>チャネルの操作</title>
    <para>
     登録を行うと、システムが Customer Centerからチャネルを受信します。チャネル名はカスタマセンター内の特定のURIにマップされています(<ulink url="http://scc.suse.com"/>を参照)。ご使用のシステムで使用可能なすべてのチャネルを一覧するには、次のように<command>zypper</command>を使用します。
    </para>
<screen>zypper repos -u</screen>

    <para>
     これにより、ご使用のシステムで使用可能なすべてのチャネルのリストが表示されます。チャネルごとに、エイリアス、名前、有効化どうか、リフレッシュされるかどうかといった情報がリストされます。オプション<option>-u</option>を使用すると、元となるURIも表示されます。
    </para>
    <para>
     古いチャネル(SP1にあるものなど)を削除する場合は、<command>zypper removerepo</command>と、チャネルの名前を使用します。たとえば、SP1およびSP2の古いチャネルを削除するには、次のコマンドを使用します。
    </para>
<screen>zypper removerepo SLES11-SP1-Pool SLES11-SP1-Updates \
  SLE11-SP1-Debuginfo-Pool SLE11-SP1-Debuginfo-Updates \
  SLES11-SP2-Core SLES11-SP2-Updates \
  SLE11-SP2-Debuginfo-Core SLES11-SP2-Extension-Store\
  SLE11-SP2-Debuginfo-Updates</screen>
    <para>
     チャネルを再度追加する場合は、<ulink url="http://www.novell.com/ncc"/>にログインして、<menuchoice><guimenu>マイプロダクト</guimenu><guimenu>資格情報のミラー</guimenu></menuchoice>の順に選択します。URIのリストが表示され、この製品リストにあるチャネルのみを追加することができます。たとえば、SP2 Extension Storeを追加する場合は、次のコマンドを使用します(1行で、バックスラッシュなし)。
    </para>
<screen>zypper addrepo -n SLES11-SP2-Extension-Store \
 https://nu.novell.com/repo/$RCE/SLES11-SP2-Extension-Store/nu_novell_com:SLES11-SP2-Extension-Store</screen>
   </sect3>
    
    
  </sect2>
 
 </sect1>
  
 <sect1 id="sec-update-proc-prep-paths">
  <title>SLE SP4へのサポートされているアップグレードパス</title>


  <variablelist>
   <varlistentry>
    <term>SLES 8、SLES 9、NLD 9のアップグレード</term>
    <listitem>
     <para>
      これらのバージョンからの直接的なアップグレードパスはサポートされていません。その代わりに、新しいインストールの実行を推奨します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 10 (任意のサービスパック)からのアップグレード</term>
    <listitem>
      
     <para>SLES 10 GAおよびSPx、またはSLES 11 GAおよび SP1からSLES 11 SP3へのアップグレード方法はサポートされていますが、次のような中間アップグレード手順の実行が必要な場合があります。</para>
      <itemizedlist mark="bullet" spacing="normal">
        <listitem>
          <para>SLES 10 GA -&gt; SLES 10 SP1 -&gt; SLES 10 SP2 -&gt; SLES 10 SP3 -&gt; SLES 10 SP4 -&gt; SLES 11 SP3、または</para>
        </listitem>
        <listitem>
          <para>SLES 11 GA -&gt; SLES 11 SP1 -&gt; SLES 11 SP2 -&gt; SLES 11 SP3 -&gt; SLES 11 SP4</para>
        </listitem>
      </itemizedlist>
     <para>SLES 10 SP4からのアップグレードは、ブート可能なメディア(PXEブートを含む)を介してサポートされます。詳細については、<ulink url="https://www.suse.com/releasenotes/x86_64/SUSE-SLES/11-SP4/#Update.General.Sequence"/>のリリースノートを参照してください。
       </para>
      <para>
        SLEDユーザへの注意:一部の開発パッケージは、<literal>SLED11-SP2</literal>インストールメディアから<literal>SLED11-Extras</literal>リポジトリに移動されました。アップグレード時に依存関係の競合を回避するには、実際のアップグレードを実行する前にこのリポジトリを有効化してください。<command>yast2 repositories</command>を実行し、そこで<literal>SLED11-Extras</literal>を有効化します。SLESでは、この余分なステップは不要です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 11 GAからのアップグレード</term>
    <listitem>
     <para>
      SUSE Linux Enterprise 11 SP3への直接的なマイグレーションパスはサポートされていません。まず、SUSE Linux Enterprise 11 GAからSP1へのアップデートを実行する必要があります。その後、<xref linkend="sec-update-sle11sp1"/>および<xref linkend="sec-update-sle11sp2"/>に従って手順を進めます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 11 SP1からのアップグレード</term>
    <listitem>
     <para>
      詳細については、<xref linkend="sec-update-sle11sp1"/>を参照してください。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 11 SP2からのアップグレード</term>
    <listitem>
     <para>
      詳細については、<xref linkend="sec-update-sle11sp2"/>を参照してください。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 11 SP3からのアップグレード</term>
    <listitem>
     <para>
      詳細については、<xref linkend="sec-update-sle11sp3"/>を参照してください。
     </para>
    </listitem>
   </varlistentry> 
  </variablelist>

  <important>
   <title>クロスアーキテクチャアップグレードはサポートされない</title>
   <para>
    
    クロスアーキテクチャアップグレード(32ビットから64ビット、64ビットから32ビットへのアップグレード)はサポートされていません。
   </para>
  </important>
  
 </sect1>
 <sect1 id="sec-update-prep">
  <title>アップデートのための一般的な準備</title>

  <para>
   アップデート手順を開始する前に、システムが正しく準備されていることを確認します。準備内容には、データのバックアップとリリースノートの確認などがあります。
  </para>

  <sect2 id="sec-update-prep-backup">
   <title>バックアップの作成</title>
   <para>
    更新の前に、既存の設定ファイルを別個のメディア(テープデバイス、リムーバブルハードディスクなど)にコピーして、データをバックアップします。主に、<filename>/etc</filename>の下に格納されているファイル、また、<filename>/var</filename>と<filename>/opt</filename>の下にあるディレクトリとファイルの一部に当てはまります。さらに、<filename>/home</filename> (<envar>HOME</envar>ディレクトリ)下のユーザデータをバックアップメディアに書き込むようにします。このデータは、<systemitem class="username">root</systemitem>ユーザでバックアップします。<systemitem class="username">root</systemitem>のみに、すべてのローカルファイルに関する読み込みパーミッションがあります。
   </para>
   <para>
    YaSTのインストールモードとして<guimenu>既存システムの更新</guimenu>を選択している場合は、もっと後の時点で(システム)バックアップを実行することができます。変更されたすべてのファイルと<filename>/etc/sysconfig</filename>ディレクトリにあるファイルを含めることができます。ただし、これは完全なバックアップではありません。前述したその他の重要なディレクトリがすべて含まれていないからです。<filename>/var/adm/backup</filename>ディレクトリでバックアップを見つけます。
   </para>
  </sect2>

  <sect2 id="sec-update-prep-disks">
   <title>パーティションとディスク容量</title>
   <para>
    更新を開始する前に、ルートパーティションの記録をとります。<command>df /</command>コマンドは、ルートパーティションのデバイス名リストを表示します。<xref linkend="aus-update-df"/>に示すように、書き留めておくルートパーティションは、<filename>/dev/hda3</filename>です(<filename>/</filename>としてマウントされています)。
   </para>
   <example id="aus-update-df">
    <title><command>df -h</command>の出力例</title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
     /dev/sda3       74G   22G   53G  29% /
     tmpfs          506M     0  506M   0% /dev/shm
     /dev/sda5      116G  5.8G  111G   5% /home
     /dev/sda1       44G    4G   40G   9% /data</screen>
   </example>
   <para>
    ソフトウェアは、バージョンが上がるたびに<quote>増加する</quote>傾向があります。そのため、更新する前に、はじめに<command>df</command>コマンドで、利用できるパーティションの容量を調べてください。ディスク容量が不足していると思われる場合は、システムの更新とパーティション再設定を行う前に、データをバックアップしておきます。各パーティションに必要な容量を決定する一般的なルールはありません。必要な容量は、特定のパーティションプロファイルおよび選択したソフトウェアによって異なります。
   </para>
  </sect2>

  <sect2 id="sec-update-prep-vms">
   <title>仮想マシンのシャットダウン</title>
   <para>
    お使いのマシンがKVMまたはXenのVMホストサーバとして機能している場合、アップデートの前には、実行中のすべてのVMゲストを正しくシャットダウンするようにします。そうでないと、更新後にゲストにアクセスできなくなる可能性があります。
   </para>
  </sect2>

  <sect2 id="sec-update-prep-relnotes">
   <title>バージョン固有の要件</title>
   <para>
    バージョン固有の要件については、アップデート製品に付属しているリリースノートを参照してください。リリースノートには、アップグレード手順に関する追加情報が含まれています。
   </para>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>の最新情報を含むリリースノートの最新バージョンのドキュメントは、<ulink url="http://www.suse.com/doc/sles11/#additional"/>でオンラインで読むことができます。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec-update-sle11sp1">
  <title>SLE 11 SP1からSLE 11 SP2へのアップデート</title>

  <para>
   SUSE Linux Enterprise 11 SP1システムからサービスパック2へのアップデートについては、さまざまな方法がサポートされています。オンラインのアップデートツールを使用してそれぞれのパッチをインストールすることでアップデートするか(<quote>オンラインマイグレーション</quote>)、サービスパックのインストールメディアを介してアップデートすることができます。さらに、Subscription Management ToolまたはSUSE Managerをホストするサーバを介して実行できます。
  </para>

  <para>
   オンラインマイグレーションは、次のツールによってサポートされています。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <guimenu>YaST Wagon</guimenu> (グラフィカルユーザインタフェース)
    </para>
   </listitem>
   <listitem>
    <para>
     <command>zypper</command> (コマンドライン)
    </para>
   </listitem>
  </itemizedlist>

  <para>
   または、サービスパックメディア(DVD ISOイメージ)全体をダウンロードすることもできます。アップデートプロセスは、物理的なサービスパックメディアまたはネットワークインストールソースからブートすることで開始します。
  </para>

  <sect2 id="sec-update-sle11spx-online">
   <title>オンラインマイグレーション</title>
   <para>
    オンラインマイグレーションによるシステムのアップデートは、稼働中のシステム内から実行されます。アップデートの完了後、1度だけ再起動の必要があります。
   </para>
   <sect3 id="sec-update-sle11spx-online-requirements">
    <title>要件</title>
    <para>
     オンラインアップデートを実行するには、次の要件を満たす必要があります。必ず、<xref linkend="sec-update-prep"/>も読んでください。
    </para>
    <variablelist>
     <varlistentry>
      <term>製品登録</term>
      <listitem>
       <para>
        アップデートチャネルに接続できるようになるには、製品を登録する必要があります。そうでない場合は、YaSTの<guimenu>Novell Customer Centerの設定</guimenu>モジュール、または<command>suse_register</command>コマンドラインツールを実行して、登録を開始します。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>オンラインアップデートの実行</term>
      <listitem>
       <para>
        現在インストールされているバージョンに最新のパッチがインストールされていることを確認します。オンラインマイグレーションの前に、オンラインアップデートを実行します。グラフィカルインタフェースを使用して、YaSTオンラインアップデートまたはアップデータアプレットを起動します。コマンドラインで、次のコマンドを実行します(最後のコマンドは2回実行する必要があります)。
       </para>
<screen>zypper ref -s
zypper update -t patch
zypper update -t patch</screen>
       <para>
        必要に応じて、システムを再起動します。
       </para>
       <para>
        詳細については、<xref linkend="cha-onlineupdate-you"/>または<xref linkend="sec-zypper-softup"/>を参照してください。オンラインアップデートツールの
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>サードパーティのソフトウェア</term>
      <listitem>
       <para>
        セットアップにサードパーティのソフトウェアまたはアドオンソフトウェアが含まれている場合は、別のコンピュータでこのプロシージャをテストして、依存関係が更新によって破損していないかどうか確認してください。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <important>
     <title>完全なオンラインマイグレーションを常に実行</title>
     <para>
      オンラインマイグレーションは常に、最初から最後まで完全に実行する必要があります。オンラインマイグレーションが中断された場合、システムは破損され回復不能な状態になります。
     </para>
    </important>
   </sect3>
   <sect3 id="sec-update-sle11spx-online-wagon">
    <title>YaST <guimenu>Wagon</guimenu>によるオンラインマイグレーション</title>
     <para>SLES 11 SP1システムの場合は、<ulink url="https://www.suse.com/support/kb/doc.php?id=7011872"/>で必要な手順を確認してください。次の手順は、SP2からSP3へのオンラインマイグレーションで実行します。</para>     
    <procedure>
     <step performance="required">
      <para>
       すべての要件が満たされている場合(<xref linkend="sec-update-sle11spx-online-requirements"/>を参照)、トレイのアップデートアプレットには、配布アップグレードが使用可能であることを示すメッセージが表示されます。これをクリックして、YaST <guimenu>Wagon</guimenu>を起動します。または、コマンドラインから<systemitem class="username">root</systemitem>として<command>/usr/sbin/wagon</command>を実行します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>ようこそ</guimenu>ダイアログの<guimenu>次へ</guimenu>を選択して確定します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>Wagon</guimenu>では、要件が満たされていない(必要な保守アップデートが使用可能なのに、まだインストールされていない)ことが見つかったら、自動的なセルフアップデートが実行されます。この場合再起動が必要になります。画面の指示に従って操作します。
      </para>
     </step>
     <step performance="required">
      <para>
       次のダイアログで、アップデート方法を選択します。デフォルトの設定を使用するには、<guimenu>Customer Center</guimenu>を選択します(推奨)。
      </para>
      <para>
       オンラインマイグレーションに使用するソフトウェアチャネルを手動で選択するには、<guimenu>Custom URL</guimenu>をクリックします。チャネルのリストが表示され、チャネルを手動で有効化、無効化、追加、または削除できるようになります。SP2アップデートソースを追加します。これは、SP2インストールメディアか、<literal>SP2-Core</literal>および<literal>SP2-Updates</literal>チャネルのいずれかの可能性があります。<guimenu>OK</guimenu>をクリックして、<guimenu>アップデート方法</guimenu>ダイアログに戻ります。
      </para>
      <para>
       アップデートプロセスによって発生したチャネル設定に対する変更を確認する必要がある場合は、<guimenu>Check Automatic Repository Changes</guimenu>を選択します。
      </para>
      <para>
       <guimenu>次へ</guimenu>で続行します。
      </para>
     </step>
     <step performance="required">
      <para>
       システムが再登録されます。このプロセスの実行中に、<literal>SP2-Core</literal>および<literal>SP2-Updates</literal>チャネルがシステムに追加されます(詳細については、<xref linkend="sec-update-nmm-channels"/>を参照してください)。チャネルの追加を確認します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>Update Method</guimenu>ダイアログで<guimenu>Check Automatic Repository Changes</guimenu>を選択した場合、リポジトリのリストが表示され、チャネルを手動で有効化、無効化、追加、または削除できるようになります。終了したら、<guimenu>OK</guimenu>で続行します。
      </para>
     </step>
     <step performance="required">
      <para>
       マイグレーションタイプを選択します。
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>完全マイグレーション</guimenu>
        </term>
        <listitem>
         <para>
          すべてのパッケージを最新のSP2レベルに更新します。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>最小マイグレーション</guimenu>
        </term>
        <listitem>
         <para>
          パッケージの最小限のセットを最新のSP2レベルに更新します。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       <guimenu>詳細</guimenu>をクリックして、アップグレードに使用するリポジトリを手動で選択します。
      </para>
      <para>
       選択内容を確認します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>配布アップグレード設定</guimenu>画面が開き、アップデート設定の概要が表示されます。次のセクションを使用できます。
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>アドオン製品</guimenu>
        </term>
        <listitem>
         <para>
          ここでは、SUSE Linux Enterprise Serverのアドオン製品か、サードパーティの製品を追加できます。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>アップデートオプション</guimenu>
        </term>
        <listitem>
         <para>
          アップデート中に実行されるアクションがリストされます。インストールの前にすべてのパッケージをダウンロードするのか(デフォルト、推奨)、パッケージを1つずつダウンロードしてインストールするのかを選択できます。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>パッケージ</guimenu>
        </term>
        <listitem>
         <para>
          アップデートの統計概要。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>バックアップ</term>
        <listitem>
         <para>
          バックアップオプションを設定します。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       <guimenu>次へ</guimenu>および<guimenu>Start The Update</guimenu>をクリックして続行します。
      </para>
      <important>
       <title>オンラインマイグレーションを中止する</title>
       <para>
        この画面で<guimenu>Start The Update</guimenu>をクリックする<emphasis>前</emphasis>と、それ以前のすべての画面では、オンラインマイグレーションを安全に中止することができます。<guimenu>Abort (中止)</guimenu>をクリックしてアップデート手順を中止し、YaST Wagonを開始する前の状態にシステムを戻します。画面の指示に従って、Wagonを中止する前に再登録を実行し、SP2チャネルをシステムから削除します。
       </para>
      </important>
     </step>
     <step performance="required">
      <para>
       アップデート手順の過程では、次のステップが実行されます。
      </para>
      <substeps performance="required">
       <step performance="required">
        <para>
         パッケージが更新されます。
        </para>
       </step>
       <step performance="required">
        <para>
         <command>SuSEconfig</command>が実行されます。
        </para>
       </step>
       <step performance="required">
        <para>
         システムが再起動されます(<guimenu>OK</guimenu>を選択します)。
        </para>
       </step>
       <step performance="required">
        <para>
         新しく更新されたシステムが再登録されます。
        </para>
       </step>
      </substeps>
     </step>
     <step performance="required">
      <para>
       システムがサービスパック2に正しく更新されます。
      </para>
     </step>
    </procedure>
    
   </sect3>
   <sect3 id="sec-update-sle11spx-online-zypper">
    <title><command>zypper</command>によるオンラインマイグレーション</title>
    <procedure>
     <step performance="required">
      <para>
       すべての要件が満たされている場合(<xref linkend="sec-update-sle11spx-online-requirements"/>を参照)、オンラインマイグレーションに必要な<quote>製品</quote>が<filename>/etc/products.d</filename>に追加されます。次のコマンドを実行することで、これらの製品のリストを取得します。
      </para>

<screen>zypper se -t product | grep -h -- "-migration" | cut -d'|' -f2</screen>
      <para>
       このコマンドでは、少なくとも<literal os="sles">SUSE_SLES-SP2-migration</literal>が返されます。インストールの範囲によっては、もっと多くの製品がリストされている場合があります。
      </para>
     </step>
     <step performance="required">
      <para>
       <command>zypper in -t product <replaceable>LIST_OF_PRODUCTS</replaceable></command>というコマンドを使用して、前のステップで取得したマイグレーション製品をインストールします。たとえば次のようになります。
      </para>
<screen os="sles">zypper in -t product SUSE_SLES-SP2-migration</screen>

     </step>
     <step performance="required">
      <para>
       それぞれのアップデートチャネルを取得するために、前のステップでインストールした製品を登録します。
      </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
     </step>
     <step performance="required">
      <para>
       リポジトリとサービスを再度リフレッシュします。
      </para>
<screen>zypper ref -s</screen>
     </step>
     <step performance="required">
      <para>
       <command>zypper lr</command>で取得可能なリポジトリのリストを確認します。<emphasis>少なくとも</emphasis>次のリポジトリを<guimenu>有効化</guimenu>する必要があります。
      </para>
      <itemizedlist os="sles" mark="bullet" spacing="normal">
       <listitem>
        <para>
         <literal>SLES11-SP1-Pool</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP1-Updates</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP2-Core</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP2-Updates</literal>
        </para>
       </listitem>
      </itemizedlist>
      
      <para>
       インストールの範囲によっては、アドオン製品や拡張機能用のリポジトリをさらに有効化する必要があります。
      </para>
      <para>
       これらのリポジトリのいずれかが有効でない場合(このワークフローに従うと、<literal>SP2</literal>のリポジトリはデフォルトでは有効化されません)、<command>zypper modifyrepo --enable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用して有効化します。たとえば次のようになります。
      </para>
<screen os="sles">zypper modifyrepo --enable SLES11-SP2-Core SLES11-SP2-Updates</screen>

      <para>
       セットアップにSP2と互換性がない可能性があるサードパーティのリポジトリが含まれている場合は、<command>zypper modifyrepo --disable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用してそれらを無効にします。
      </para>
     </step>
     <step performance="required">
      <para>
       これで、<command>zypper dup --from <replaceable>REPO 1</replaceable> --from <replaceable>REPO 2</replaceable> <replaceable>...</replaceable></command>を使用して配布アップグレードを実行するための準備がすべて整いました。 必ず<option>--from</option>を使用して必要なリポジトリをすべてリストするようにしてください。たとえば次のようになります。
      </para>
<screen os="sles">zypper dup --from SLES11-SP2-Core --from SLES11-SP2-Updates</screen>

      <para>
       <guimenu>y</guimenu>を入力して、アップグレードを開始します。
      </para>
     </step>
     <step performance="required">
      <para>
       前のステップからの配布アップグレードが完了したら、［Minimal Migration］が実行されたことになります(パッケージの最小限のセットが最新のSP2レベルに更新されたということです)。［Full Migration］を実行しない場合は、このステップをスキップします。
      </para>
      <para>
       ［Full Migration］を実行する(すべてのパッケージを最新のSP2レベルに更新する)には、次のコマンドを実行します。
      </para>
<screen>zypper update -t patch</screen>
     </step>
     <step performance="required">
      <para>
       これでSP2へのアップグレードは完了したので、製品を再登録する必要があります。
      </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
     </step>
     <step performance="required">
      <para>
       最後に、システムを再起動します。
      </para>
     </step>
     <step performance="required">
      <para>
       システムがサービスパック2に正しく更新されます。
      </para>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 id="sec-update-sle11spx-medium">
   <title>インストールソースからブートすることでアップデート</title>
   <para>
    オンラインマイグレーション(詳細については<xref linkend="sec-update-sle11spx-online"/>を参照)の代わりとして、インストールソース(DVDまたはネットワークインストールソース)からブートすることでシステムをアップデートできます。アップデートは、通常のインストールと同じように開始されます。
   </para>
   <para>
    サービスパック2 ISOイメージは、<ulink url="http://download.novell.com/"/>から取得できます。これをDVDに書き込むか、<xref linkend="sec-deployment-remoteinst-instserver"/>の説明に従ってネットワークインストールソースを準備します。
   </para>
   <sect3 id="sec-upgrade-install-from-dvd">
    <title>ローカルDVDドライブからのアップデート</title>
    <para>
     SUSE Linux Enterprise SPの新規インストールを開始する前に、サービスパックのインストールメディア(DVD)が全部揃っていることを確認してください。
    </para>
    <procedure id="upgrade-sp-instsp-fromsp">
     <title>サービスパックメディアからのブート</title>
     <step performance="required">
      <para>
       1枚目のSUSE Linux Enterprise SPメディアを挿入し、マシンをブートします。元のSUSE Linux Enterprise 11のインストール時と同様のブート画面が表示されます。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>インストール</guimenu>を選択し、<xref linkend="cha-inst"/>のYaSTインストールに関する説明に従って作業を続行してください。
      </para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="sec-upgrade-install-from-network">
    <title>ネットワークインストールソースからのアップデート</title>
    <para>
     SUSE Linux Enterprise SPのネットワークインストールソースからのアップデートを開始する前に、次の要件を満たしていることを確認します。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       ネットワークインストールソースが<xref linkend="sec-deployment-remoteinst-instserver"/>の記述どおりにセットアップされていること。
      </para>
     </listitem>
     <listitem>
      <para>
       インストールサーバと、ネームサービス、DHCP (オプションですが、PXEブートには必要)、およびOpenSLP (オプション)が含まれているターゲットコンピュータの両方で機能しているネットワーク接続が存在すること。
      </para>
     </listitem>
     <listitem>
      <para>
       ターゲットシステムのブート用のSUSE Linux EnterpriseサービスパックのDVD 1か、<emphasis/><xref linkend="sec-deployment-remoteinst-boot-pxeprep" xrefstyle="HeadingOnPage"/>の説明に従ってPXEブート用にセットアップされたターゲットシステムが存在すること。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     リモートサーバからのアップグレードの詳細については、<xref linkend="cha-deployment-remoteinst"/>を参照してください。
    </para>
    <sect4 id="sec-upgrade-install-from-network-dvdboot">
     <title>ネットワークインストール - DVDからのブート</title>
     <para>
      ブートメディアとしてSPのDVDを使ってネットワークインストールを実行するには、次の手順に従います。
     </para>
     <procedure>
      <step performance="required">
       <para>
        SUSE Linux Enterprise SP DVD 1を挿入し、マシンをブートします。元のSUSE Linux Enterprise 11のインストール時と同様のブート画面が表示されます。
       </para>
      </step>
      <step performance="required">
       <para>
        <guimenu>インストール</guimenu>を選択してサービスパックカーネルをブートし、 <keycap>F4</keycap>キーを押してネットワークインストールソースの種類(FTP、HTTP、NFS、またはSMB)を選択します。
       </para>
      </step>
      <step performance="required">
       <para>
        適切なパス情報を入力するか、<guimenu>SLP</guimenu>をインストールソースとして選択します。
       </para>
      </step>
      <step performance="required">
       <para>
        表示されるものから適切なインストールサーバを選択するか、<xref linkend="sec-i-yast2-source-network"/>に説明しているとおり、ブートオプションプロンプトを使用してインストールソースの種類とその実際の場所を指定します。YaSTが起動します。
       </para>
       <para>
        <xref linkend="sec-update-sle11spx-medium-update"/>の説明に従って、インストールを完了します。
       </para>
      </step>
     </procedure>
    </sect4>
    <sect4 id="sec-upgrade-install-from-network-pxeboot">
     <title>ネットワークインストール - PXEブート</title>
     <para>
      ネットワークからSUSE Linux Enterpriseサービスパックのネットワークインストールを実行するには、次の手順に従います。
     </para>
     <procedure>
      <step performance="required">
       <para>
        <xref linkend="sec-deployment-remoteinst-boot-pxeprep"/>に従って、DHCPサーバのセットアップを調整してPXEブートに必要なアドレス情報を取得します。
       </para>
      </step>
      <step performance="required">
       <para>
        PXEブートに必要なブートイメージが保管されるTFTPサーバをセットアップします。
       </para>
       <para>
        このセットアップを実行するには、SUSE Linux EnterpriseサービスパックのCDまたはDVDの1枚目を使用するか、または<xref linkend="sec-deployment-remoteinst-boot-tftp"/>の手順に従います。
       </para>
      </step>
      <step performance="required">
       <para>
        ターゲットコンピュータにPXEブートとWake-on-LANを準備します。
       </para>
      </step>
      <step performance="required">
       <para>
        ターゲットシステムのブートを開始し、VNCを使用してこのコンピュータで実行中のインストールルーチンにリモートで接続します。詳細については、<xref linkend="sec-deployment-remoteinst-monitor-vnc"/>を参照してください。
       </para>
      </step>
      <step performance="required">
       <para>
        <xref linkend="sec-update-sle11spx-medium-update"/>の説明に従って、インストールを完了します。
       </para>
      </step>
     </procedure>
    </sect4>
   </sect3>
   <sect3 id="sec-update-sle11spx-medium-update">
    <title>アップデート手順</title>
    <para>
     インストールメディアまたはネットワークから正しくブートしたら、次の手順を実行してアップデートを開始します。
    </para>
    <procedure>
     <step performance="required">
      <para>
       <guimenu>ようこそ</guimenu>画面で、<guimenu>言語</guimenu>および<guimenu>キーボード</guimenu>を選択し、ライセンス契約に同意します。<guimenu>次へ</guimenu>で続行します。
      </para>
     </step>
     <step performance="required">
      <para>
       物理メディアからブートした場合は、<guimenu>メディアチェック</guimenu>を実行して、メディアの整合性を確認します。すでにメディアをチェック済みの場合は、このステップをスキップします。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>Installation Mode</guimenu>画面で、<guimenu>アップデート</guimenu>を選択します。<guimenu>次へ</guimenu>をクリックすると、アップデート手順が開始されます。
      </para>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 id="sec-update-sle11spx-smt">
   <title>サブスクリプション管理ツール(SMT)によるアップデート</title>
   <para>
    Novellアップデートサーバからクライアントシステムごとにアップデートをダウンロードする代わりに、SUSE Linux Enterprise用のサブスクリプション管理ツール(SMT)を使用して、アップデートをローカルサーバにミラーリングすることもできます。
   </para>
   <para>
    このツールはクライアント登録用のNovell Customer Centerプロキシ、およびソフトウェアアップデートリポジトリとして機能します。<ulink url="http://www.suse.com/doc/smt11/"/>にあるSMTのマニュアルに、機能の概要と実装方法の説明が記載されています。
   </para>
  </sect2>

  <sect2 id="sec-update-sle11spx-manager">
   <title>SUSE Managerによるアップデート</title>
   <para>
    SUSE Managerは、SUSE Linux Enterpriseクライアントに対するアップデート、パッチ、およびセキュリティ修正を提供するためのサーバソリューションです。これには、一連のツールと、管理タスク用のWebベースのユーザインタフェースが付属しています。
   </para>
   <para>
    <ulink url="http://www.suse.com/doc/suse_manager/"/>にあるSUSE Managerのマニュアルに、機能の概要とサーバおよびクライアントのセットアップ方法の説明が記載されています。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec-update-sle11sp2">
  <title>SLE 11 SP2からSLE 11 SP3へのアップデート</title>

  

  <para>
   オンラインマイグレーションは、次のツールによってサポートされています。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <guimenu>YaST Wagon</guimenu> (グラフィカルユーザインタフェース)
    </para>
   </listitem>
   <listitem>
    <para>
     <command>zypper</command> (コマンドライン)
    </para>
   </listitem>
  </itemizedlist>

  <para>
   オンラインマイグレーションを介してシステムをアップデートする場合、アップデートはシステムの稼働中に実行されます。アップデートの完了後、1度だけ再起動の必要があります。次に示す代替方法によってアップデートを行うこともできます。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <xref linkend="sec-update-sle11spx-medium"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec-update-sle11spx-smt"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec-update-sle11spx-manager"/>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec-update-sle11sp2-online-requirements">
   <title>要件</title>
   <para>
    オンラインアップデートを実行するには、次の要件を満たす必要があります。必ず、<xref linkend="sec-update-prep"/>も読んでください。
   </para>
   <variablelist>
    <varlistentry>
     <term>製品登録</term>
     <listitem>
      <para>
       アップデートチャネルに接続できるようになるには、製品を登録する必要があります。そうでない場合は、YaSTの<guimenu>Novell Customer Centerの設定</guimenu>モジュール、または<command>suse_register</command>コマンドラインツールを実行して、登録を開始します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>オンラインアップデートの実行</term>
     <listitem>
      <para>
       現在インストールされているバージョンに最新のパッチがインストールされていることを確認します。オンラインマイグレーションの前に、オンラインアップデートを実行します。グラフィカルインタフェースを使用して、YaSTオンラインアップデートまたはアップデータアプレットを起動します。コマンドラインで、次のコマンドを実行します(最後のコマンドは2回実行する必要があります)。
      </para>
<screen>zypper ref -s
zypper update -t patch
zypper update -t patch</screen>
      <para>
       必要に応じて、システムを再起動します。
      </para>
      <para>
       オンラインアップデートツールの詳細については、<xref linkend="cha-onlineupdate-you"/>または<xref linkend="sec-zypper-softup"/>を参照してください。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>サードパーティのソフトウェア</term>
     <listitem>
      <para>
       セットアップにサードパーティのソフトウェアまたはアドオンソフトウェアが含まれている場合は、別のコンピュータでこのプロシージャをテストして、依存関係が更新によって破損していないかどうか確認してください。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <important>
    <title>完全なオンラインマイグレーションを常に実行</title>
    <para>
     オンラインマイグレーションは常に、最初から最後まで完全に実行する必要があります。オンラインマイグレーションが中断された場合、システムは破損され回復不能な状態になります。
    </para>
   </important>
  </sect2>

  <sect2 id="sec-update-sle11sp2-online-wagon">
   <title>YaST <guimenu>Wagon</guimenu>によるオンラインマイグレーション</title>
   <procedure>
    <step performance="required">
     <para>
      すべての要件が満たされている場合(<xref linkend="sec-update-sle11spx-online-requirements"/>を参照)、トレイのアップデートアプレットには、配布アップグレードが使用可能であることを示すメッセージが表示されます。これをクリックして、YaST <guimenu>Wagon</guimenu>を起動します。または、コマンドラインから<systemitem class="username">root</systemitem>として<command>/usr/sbin/wagon</command>を実行します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>ようこそ</guimenu>ダイアログの<guimenu>次へ</guimenu>を選択して確定します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>Wagon</guimenu>では、要件が満たされていない(必要な保守アップデートが使用可能なのに、まだインストールされていない)ことが見つかったら、自動的なセルフアップデートが実行されます。この場合再起動が必要になります。画面の指示に従って操作します。
     </para>
    </step>
    <step performance="required">
     <para>
      次のダイアログで、アップデート方法を選択します。デフォルトの設定を使用するには、<guimenu>Customer Center</guimenu>を選択します(推奨)。
     </para>
     <para>
      オンラインマイグレーションに使用するソフトウェアチャネルを手動で選択するには、<guimenu>Custom URL</guimenu>をクリックします。チャネルのリストが表示され、チャネルを手動で有効化、無効化、追加、または削除できるようになります。SP3アップデートソースを追加します。これは、SP3インストールメディアか、<literal>SP3-Pool</literal>および<literal>SP3-Updates</literal>チャネルのいずれかの可能性があります。<guimenu>OK</guimenu>をクリックして、<guimenu>Update Method</guimenu>ダイアログに戻ります。
     </para>
     <para>
      アップデートプロセスによって発生したチャネル設定に対する変更を確認する必要がある場合は、<guimenu>Check Automatic Repository Changes</guimenu>を選択します。
     </para>
     <para>
      <guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step performance="required">
     <para>
      システムが再登録されます。このプロセスの実行中に、<literal>SP3-Pool</literal>および<literal>SP3-Updates</literal>チャネルがシステムに追加されます(詳細については、<xref linkend="sec-update-nmm-channels"/>を参照してください)。チャネルの追加を確認します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>Update Method</guimenu>ダイアログで<guimenu>Check Automatic Repository Changes</guimenu>を選択した場合、リポジトリのリストが表示され、チャネルを手動で有効化、無効化、追加、または削除できるようになります。終了したら、<guimenu>OK</guimenu>で続行します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>Distribution Upgrade Settings</guimenu>画面が開き、アップデート設定の概要が表示されます。次のセクションを使用できます。
     </para>
     <variablelist>
      <varlistentry>
       <term><guimenu>アドオン製品</guimenu>
       </term>
       <listitem>
        <para>
         ここでは、SUSE Linux Enterprise Serverのアドオン製品か、サードパーティの製品を追加できます。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>アップデートオプション</guimenu>
       </term>
       <listitem>
        <para>
         アップデート中に実行されるアクションがリストされます。インストールの前にすべてのパッケージをダウンロードするのか(デフォルト、推奨)、パッケージを1つずつダウンロードしてインストールするのかを選択できます。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>パッケージ</guimenu>
       </term>
       <listitem>
        <para>
         アップデートの統計概要。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>バックアップ</term>
       <listitem>
        <para>
         バックアップオプションを設定します。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      <guimenu>次へ</guimenu>および<guimenu>Start The Update</guimenu>をクリックして続行します。
     </para>
     <important>
      <title>オンラインマイグレーションを中止する</title>
      <para>
       この画面で<guimenu>Start The Update</guimenu>をクリックする<emphasis>前</emphasis>と、それ以前のすべての画面では、オンラインマイグレーションを安全に中止することができます。<guimenu>Abort (中止)</guimenu>をクリックしてアップデート手順を中止し、YaST Wagonを開始する前の状態にシステムを戻します。画面の指示に従って、Wagonを中止する前に再登録を実行し、SP2チャネルをシステムから削除します。
      </para>
     </important>
    </step>
    <step performance="required">
     <para>
      アップデート手順の過程では、次のステップが実行されます。
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        パッケージが更新されます。
       </para>
      </step>
      <step performance="required">
       <para>
        <command>SuSEconfig</command>が実行されます。
       </para>
      </step>
      <step performance="required">
       <para>
        システムが再起動されます(<guimenu>OK</guimenu>を選択します)。
       </para>
      </step>
      <step performance="required">
       <para>
        新しく更新されたシステムが再登録されます。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      システムがサービスパック3に正しく更新されます。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec-update-sle11sp2-online-zypper">
   <title><command>zypper</command>によるオンラインマイグレーション</title>
   <procedure>
    <step performance="required">
     <para>
      すべての要件が満たされている場合(<xref linkend="sec-update-sle11spx-online-requirements"/>を参照)、オンラインマイグレーションに必要な<quote>製品</quote>が<filename>/etc/products.d</filename>に追加されます。次のコマンドを実行することで、これらの製品のリストを取得します。
     </para>

<screen>zypper se -t product | grep -h -- "-migration" | cut -d'|' -f2</screen>
     <para>
      このコマンドでは、少なくとも<literal os="sles">SUSE_SLES-SP3-migration</literal>が返されます。インストールの範囲によっては、もっと多くの製品がリストされている場合があります。
     </para>
    </step>
    <step performance="required">
     <para>
      <command>zypper in -t product <replaceable>LIST_OF_PRODUCTS</replaceable></command>というコマンドを使用して、前のステップで取得したマイグレーション製品をインストールします。たとえば次のようになります。
     </para>
<screen os="sles">zypper in -t product SUSE_SLES-SP3-migration</screen>

    </step>
    <step performance="required">
     <para>
      それぞれのアップデートチャネルを取得するために、前のステップでインストールした製品を登録します。
     </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
    </step>
    <step performance="required">
     <para>
      リポジトリとサービスをリフレッシュします。
     </para>
<screen>zypper ref -s</screen>
    </step>
    <step performance="required">
     <para>
      <command>zypper lr</command>で取得可能なリポジトリのリストを確認します。
     </para>
     <para>
      これらのリポジトリのいずれかが有効でない場合(このワークフローに従うと、<literal>SP3</literal>のリポジトリはデフォルトでは有効化されません)、<command>zypper modifyrepo --enable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用して有効化します。たとえば次のようになります。
     </para>
<screen os="sles">zypper modifyrepo --enable SLES11-SP3-Core SLES11-SP3-Updates</screen>

     <para>
      セットアップにSP3と互換性がない可能性があるサードパーティのリポジトリが含まれている場合は、<command>zypper modifyrepo --disable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用してそれらを無効にします。
     </para>
    </step>
    <step performance="required">
     <para>
      これで、<command>zypper dup --from <replaceable>REPO 1</replaceable> --from <replaceable>REPO 2</replaceable> <replaceable>...</replaceable></command>を使用して配布アップグレードを実行するための準備がすべて整いました。 必ず<option>--from</option>を使用して必要なリポジトリをすべてリストするようにしてください。たとえば次のようになります。
     </para>
<screen os="sles">zypper dup --from SLES11-SP3-Pool --from SLES11-SP3-Updates</screen>

     <para>
      <guimenu>y</guimenu>を入力して、アップグレードを開始します。
     </para>
    </step>
    <step performance="required">
     <para>
      前のステップからの配布アップグレードが完了したら、次のコマンドを実行します。
     </para>
<screen>zypper update -t patch</screen>
    </step>
    <step performance="required">
     <para>
      これでSP3へのアップグレードは完了したので、製品を再登録する必要があります。
     </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
    </step>
    <step performance="required">
     <para>
      最後に、システムを再起動します。
     </para>
    </step>
    <step performance="required">
     <para>
      システムがサービスパック3に正しく更新されます。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
  
 <sect1 id="sec-update-sle11sp3">
   <title>SLE 11 SP3からSLE 11 SP4へのアップデート</title>
   <para>SUSE Linux Enterprise Server 11 SP3システムからサービスパック4へのアップデートについては、さまざまな方法がサポートされています。オンラインのアップデートツールを使用してそれぞれのパッチをインストールすることでアップデートするか(オンラインマイグレーション)、サービスパックのインストールメディアを介してアップデートすることができます。さらに、サブスクリプション管理ツール(SMT)またはSUSE Managerをホストするサーバを介して実行できます。</para>
   <para>オンラインマイグレーションは、次のツールによってサポートされています。
     </para>
       <itemizedlist mark="bullet" spacing="normal">
         <listitem>
           <para>YaST Wagon (グラフィカルユーザインタフェース) </para>
         </listitem>
         <listitem>
           <para><command>zypper</command> (コマンドライン)</para>
         </listitem>
       </itemizedlist>
     <para>または、サービスパックメディア(DVD ISOイメージ)全体をダウンロードすることもできます。アップデートプロセスは、物理的なサービスパックメディアまたはネットワークインストールソースからブートすることで開始します。 </para>
   
   <sect2 id="sec-update-sle11sp3-onlinemigration">
     <title>オンラインマイグレーション</title>
     <para>オンラインマイグレーションによるシステムのアップデートは、稼働中のシステム内から実行されます。アップデートの完了後、1度だけ再起動の必要があります。</para>
     <sect3>
       <title>要件</title>
       <para>オンラインアップデートを実行するには、次の要件を満たす必要があります。必ず、<xref linkend="sec-update-prep"/>も読んでください。
       </para>
       
       <variablelist>
         <varlistentry>
           <term>製品登録</term>
           <listitem>
             <para>アップデートチャネルに接続できるようになるには、製品を登録する必要があります。そうでない場合は、YaSTの［Novell Customer Centerの設定］モジュール、または<command>suse_register</command>コマンドラインツールを実行して、登録を開始します。 </para>
           </listitem>
         </varlistentry>
         <varlistentry>
           <term>オンラインアップデートの実行</term>
           <listitem>
             <para>現在インストールされているバージョンに最新のパッチがインストールされていることを確認します。オンラインマイグレーションの前に、オンラインアップデートを実行します。グラフィカルインタフェースを使用して、YaSTオンラインアップデートまたはアップデータアプレットを起動します。コマンドラインで、次のコマンドを実行します(最後のコマンドは2回実行する必要があります)。 </para>
             <screen>zypper ref -s
zypper update -t patch
zypper update -t patch</screen>
             <para>必要に応じて、システムを再起動します。</para>
             <para>オンラインアップデートツールの詳細については、セクション1.0「YaSTオンラインアップデート」(↑管理ガイド)またはセクション6.1.3「Zypperによるソフトウェアの更新」(↑管理ガイド)を参照してください。</para>
           </listitem>
         </varlistentry>
         <varlistentry>
           <term>サードパーティのソフトウェア</term>
           <listitem>
             <para>セットアップにサードパーティのソフトウェアまたはアドオンソフトウェアが含まれている場合は、別のコンピュータでこのプロシージャをテストして、依存関係が更新によって破損していないかどうか確認してください。 </para>
           </listitem>
         </varlistentry>
       </variablelist>
       
       <important>
         <title>完全なオンラインマイグレーションを常に実行</title>
         <para>オンラインマイグレーションは常に、最初から最後まで完全に実行する必要があります。オンラインマイグレーションが中断された場合、システムは破損され回復不能な状態になります。</para>
       </important>
     </sect3>
   
   <sect3 id="sec-update-sle11sp3-online-wagon">
     <title>YaST <guimenu>Wagon</guimenu>によるオンラインマイグレーション</title>
     <para>SLES 11 SP1システムの場合は、<ulink url="https://www.suse.com/support/kb/doc.php?id=7011872"/>で必要な手順を確認してください。次の手順は、SP3からSP4へのオンラインマイグレーションで実行します。</para>
     <procedure>
       <step performance="required">
         <para>
           すべての要件が満たされている場合(<xref linkend="sec-update-sle11spx-online-requirements"/>を参照)、トレイのアップデートアプレットには、配布アップグレードが使用可能であることを示すメッセージが表示されます。これをクリックして、YaST <guimenu>Wagon</guimenu>を起動します。または、コマンドラインから<systemitem class="username">root</systemitem>として<command>/usr/sbin/wagon</command>を実行します。
         </para>
       </step>
       <step performance="required">
         <para>
           <guimenu>ようこそ</guimenu>ダイアログの<guimenu>次へ</guimenu>を選択して確定します。
         </para>
       </step>
       <step performance="required">
         <para>
           <guimenu>Wagon</guimenu>では、要件が満たされていない(必要な保守アップデートが使用可能なのに、まだインストールされていない)ことが見つかったら、自動的なセルフアップデートが実行されます。この場合再起動が必要になります。画面の指示に従って操作します。
         </para>
       </step>
       <step performance="required">
         <para>
           次のダイアログで、アップデート方法を選択します。デフォルトの設定を使用するには、<guimenu>Customer Center</guimenu>を選択します(推奨)。
         </para>
         <para>
           オンラインマイグレーションに使用するソフトウェアチャネルを手動で選択するには、<guimenu>Custom URL</guimenu>をクリックします。チャネルのリストが表示され、チャネルを手動で有効化、無効化、追加、または削除できるようになります。SP4アップデートソースを追加します。これは、SP4インストールメディアか、<literal>SP4-Pool</literal>および<literal>SP4-Updates</literal>チャネルのいずれかの可能性があります。<guimenu>OK</guimenu>をクリックして、<guimenu>Update Method</guimenu>ダイアログに戻ります。
         </para>
         <para>
           アップデートプロセスによって発生したチャネル設定に対する変更を確認する必要がある場合は、<guimenu>Check Automatic Repository Changes</guimenu>を選択します。
         </para>
         <para>
           <guimenu>次へ</guimenu>で続行します。
         </para>
       </step>
       <step performance="required">
         <para>
           システムが再登録されます。このプロセスの実行中に、<literal>SP4-Pool</literal>および<literal>SP4-Updates</literal>チャネルがシステムに追加されます(詳細については、<xref linkend="sec-update-nmm-channels"/>を参照してください)。チャネルの追加を確認します。
         </para>
       </step>
       <step performance="required">
         <para>
           <guimenu>Update Method</guimenu>ダイアログで<guimenu>Check Automatic Repository Changes</guimenu>を選択した場合、リポジトリのリストが表示され、チャネルを手動で有効化、無効化、追加、または削除できるようになります。終了したら、<guimenu>OK</guimenu>で続行します。
         </para>
       </step>
       <step performance="required">
         <para>マイグレーションタイプを選択します。</para>
         <variablelist>
           <varlistentry>
             <term>完全マイグレーション</term>
             <listitem>
               <para>すべてのパッケージを最新のSP4レベルに更新します。</para>
             </listitem>
           </varlistentry>
           <varlistentry>
             <term>最小マイグレーション</term>
             <listitem>
               <para>パッケージの最小限のセットを最新のSP4レベルに更新します。</para>
             </listitem>
           </varlistentry>
         </variablelist>
         <para><guimenu>詳細</guimenu>をクリックして、アップグレードに使用するリポジトリを手動で選択します。選択内容を確認します。
         </para>
       </step>
       
       <step performance="required">
         <para>
           <guimenu>Distribution Upgrade Settings</guimenu>画面が開き、アップデート設定の概要が表示されます。次のセクションを使用できます。
         </para>
         <variablelist>
           <varlistentry>
             <term><guimenu>アドオン製品</guimenu>
             </term>
             <listitem>
               <para>
                 ここでは、SUSE Linux Enterprise Serverのアドオン製品か、サードパーティの製品を追加できます。
               </para>
             </listitem>
           </varlistentry>
           <varlistentry>
             <term><guimenu>アップデートオプション</guimenu>
             </term>
             <listitem>
               <para>
                 アップデート中に実行されるアクションがリストされます。インストールの前にすべてのパッケージをダウンロードするのか(デフォルト、推奨)、パッケージを1つずつダウンロードしてインストールするのかを選択できます。
               </para>
             </listitem>
           </varlistentry>
           <varlistentry>
             <term><guimenu>パッケージ</guimenu>
             </term>
             <listitem>
               <para>
                 アップデートの統計概要。
               </para>
             </listitem>
           </varlistentry>
           <varlistentry>
             <term>バックアップ</term>
             <listitem>
               <para>
                 バックアップオプションを設定します。
               </para>
             </listitem>
           </varlistentry>
         </variablelist>
         <para>
           <guimenu>次へ</guimenu>および<guimenu>Start The Update</guimenu>をクリックして続行します。
         </para>
         <important>
           <title>オンラインマイグレーションを中止する</title>
           <para>
             この画面で<guimenu>Start The Update</guimenu>をクリックする<emphasis>前</emphasis>と、それ以前のすべての画面では、オンラインマイグレーションを安全に中止することができます。<guimenu>Abort (中止)</guimenu>をクリックしてアップデート手順を中止し、YaST Wagonを開始する前の状態にシステムを戻します。画面の指示に従って、Wagonを中止する前に再登録を実行し、SP4チャネルをシステムから削除します。
           </para>
         </important>
       </step>
       <step performance="required">
         <para>
           アップデート手順の過程では、次のステップが実行されます。
         </para>
         <orderedlist spacing="normal">
           <listitem>
             <para>
               パッケージが更新されます。
             </para>
           </listitem>
           <listitem>
             <para>
               <command>SuSEconfig</command>が実行されます。
             </para>
           </listitem>
           <listitem>
             <para>
               システムが再起動されます(<guimenu>OK</guimenu>を選択します)。
             </para>
           </listitem>
           <listitem>
             <para>
               新しく更新されたシステムが再登録されます。
             </para>
           </listitem>
         </orderedlist>
       </step>
       <step performance="required">
         <para>
           システムがサービスパック4に正しく更新されます。
         </para>
       </step>
     </procedure>
   </sect3>
   
   <sect3 id="sec-update-sle11sp3-online-zypper">
     <title><command>zypper</command>によるオンラインマイグレーション</title>
     <procedure>
       <step performance="required">
         <para>
           すべての要件が満たされている場合(<xref linkend="sec-update-sle11spx-online-requirements"/>を参照)、オンラインマイグレーションに必要な<quote>製品</quote>が<filename>/etc/products.d</filename>に追加されます。次のコマンドを実行することで、これらの製品のリストを取得します。
         </para>
         
         <screen>zypper se -t product | grep -h -- "-migration" | cut -d'|' -f2</screen>
         <para>
           このコマンドでは、少なくとも<literal os="sles">SUSE_SLES-SP4-migration</literal>が返されます。インストールの範囲によっては、もっと多くの製品がリストされている場合があります。
         </para>
       </step>
       <step performance="required">
         <para>
           <command>zypper in -t product <replaceable>LIST_OF_PRODUCTS</replaceable></command>というコマンドを使用して、前のステップで取得したマイグレーション製品をインストールします。たとえば次のようになります。
         </para>
         <screen os="sles">zypper in -t product SUSE_SLES-SP4-migration</screen>
         
       </step>
       <step performance="required">
         <para>
           それぞれのアップデートチャネルを取得するために、前のステップでインストールした製品を登録します。
         </para>
         <screen>suse_register -d 2 -L /root/.suse_register.log</screen>
       </step>
       <step performance="required">
         <para>
           リポジトリとサービスをリフレッシュします。
         </para>
         <screen>zypper ref -s</screen>
       </step>
       <step performance="required">
         <para>
           <command>zypper lr</command>で取得可能なリポジトリのリストを確認します。少なくとも次のリポジトリを有効化する必要があります。 
         </para>
         
         <itemizedlist mark="bullet" spacing="normal">
           <listitem>
             <para>SLES11-SP4-Pool</para>
           </listitem>
           <listitem>
             <para>SLES11-SP4-Updates</para>
           </listitem>
         </itemizedlist>
         
         <para>インストールの範囲によっては、アドオン製品や拡張機能用のリポジトリをさらに有効化する必要があります。 </para>
         
         <para>
           これらのリポジトリのいずれかが有効でない場合(このワークフローに従うと、<literal>SP4</literal>のリポジトリはデフォルトでは有効化されません)、<command>zypper modifyrepo --enable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用して有効化します。たとえば次のようになります。
         </para>
         <screen os="sles">zypper modifyrepo --enable SLES11-SP4-Pool --enable SLES11-SP4-Updates</screen>
         
         <para>
           セットアップにSP4と互換性がない可能性があるサードパーティのリポジトリが含まれている場合は、<command>zypper modifyrepo --disable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用してそれらを無効にします。
         </para>
       </step>
       <step performance="required">
         <para>
           これで、<command>zypper dup --from <replaceable>REPO 1</replaceable> --from <replaceable>REPO 2</replaceable> <replaceable>...</replaceable></command>を使用して配布アップグレードを実行するための準備がすべて整いました。 必ず<option>--from</option>を使用して必要なリポジトリをすべてリストするようにしてください。たとえば次のようになります。
         </para>
         <screen os="sles">zypper dup --from SLES11-SP4-Pool --from SLES11-SP4-Updates</screen>
         
         <para>
           <guimenu>y</guimenu>を入力して、アップグレードを開始します。
         </para>
       </step>
       <step performance="required">
         <para>
           前のステップからの配布アップグレードが完了したら、最小マイグレーションが実行されたことになります(パッケージの最小限のセットが最新のSP4レベルにアップデートされたということです)。完全マイグレーションを実行しない場合は、このステップをスキップします。
         </para>
         <para>［Full Migration］を実行する(すべてのパッケージを最新のSP4レベルに更新する)には、次のコマンドを実行します。 </para>
         <screen>zypper update -t patch</screen>
       </step>
       <step performance="required">
         <para>
           これでSP4へのアップグレードは完了したので、製品を再登録する必要があります。
         </para>
         <screen>suse_register -d 2 -L /root/.suse_register.log</screen>
       </step>
       <step performance="required">
         <para>
           最後に、システムを再起動します。
         </para>
       </step>
     </procedure>
     <para>
       システムがサービスパック4に正しく更新されます。
     </para>
   </sect3>
    
    <sect3>
      <title>インストールソースからブートすることでアップデート</title>
      <para>オンラインマイグレーションの代わりとして、インストールソース(DVDまたはネットワークインストールソース)からブートすることでシステムをアップデートできます。アップデートは、通常のインストールと同じように開始されます。 </para>
      <para>サービスパック4 ISOイメージは、<ulink url="http://download.suse.com/"/>から取得できます。これをDVDに書き込むか、<xref linkend="sec-deployment-remoteinst-instserver"/>の説明に従ってネットワークインストールソースを準備します。
      </para>
    </sect3>
   </sect2>
   
 </sect1>
 
 <sect1 id="sec-update-backports">
  <title>ソースコードのバックポート</title>

  <para>
   SUSEではバックポートを広範囲に使用します。このセクションでは、ソフトウェアの機能と問題を判断するためにバージョン番号を比較しても当てにならない可能性がある理由について説明します。

  </para>

  <sect2 id="sec-update-backports-why">
   <title>バックポートの理由</title>
   <para>
    アップストリームの開発者は、自分が開発するソフトウェアを前進させることを念頭に置いています。多くの場合、バグの修正と新機能の導入が組み合わせられますが、その新機能は詳細なテストをまだ受けていないために、新しいバグを生み出す可能性があります。
   </para>
   <para>
    配布物の開発者としては、次のものを見分けることが重要です。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      バグ修正(機能を中断する限定的な可能性がある)。
     </para>
    </listitem>
    <listitem>
     <para>
      変更(既存の機能を中断する可能性がある)。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    多くの場合、パッケージがリリースされた配布物の一部になったら、配布物の開発者はアップストリームでのすべての変更を追うことはしません。通常は、最初にリリースされたアップストリームバージョンから離れずに、アップストリームの変更に基づいてパッチを作成してバグを修正します。こうした一連の処理は<emphasis>バックポート</emphasis>と呼ばれています。
   </para>
   <para>
    一般的に、配布物の開発者が新しいバージョンのソフトウェアを導入するのは、次の2つの場合のみです。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      パッケージとアップストリームバージョンの変更内容の差があまりに大きくなり、バックポートが不可能になってしまった場合。
     </para>
    </listitem>
    <listitem>
     <para>
      本質的に経年劣化するソフトウェア(マルウェア対策ソフトウェアなど)。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 id="sec-update-backports-reasons-for">
   <title>バックポートを行う理由</title>
   <para>
    SUSEでは、エンタープライズソフトウェアに対する数多くの考慮事項のバランスをうまく取るために、広い範囲でバックポートを使用しています。こうした考慮事項のうち最も重要なものは次のとおりです。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      SUSEのエンタープライズ製品上で使用する製品を構築する際にソフトウェアベンダーが信頼することのできる安定したインタフェース(API)を提供すること。
     </para>
    </listitem>
    <listitem>
     <para>
      SUSEのエンタープライズ製品のリリースで使用するパッケージが、単体としてもエンタープライズ製品全体の一部としても、最高品質であり、完全にテスト済みであることを確認すること。
     </para>
    </listitem>
    <listitem>
     <para>
      SUSEのエンタープライズ製品に対するその他のベンダーによるさまざまな証明書を維持すること(OracleまたはSAP製品の証明書など)。
     </para>
    </listitem>
    <listitem>
     <para>
      SUSEの開発者が、リリース全体に薄く広く注意を拡散させる必要なく、できるだけ優れた次のバージョンの製品の開発に集中できるようにすること。
     </para>
    </listitem>
    <listitem>
     <para>
      特定のエンタープライズ向けリリースの内容の明確性を保ち、サポートがそのリリースについて正確かつタイムリーな情報を提供できるようにすること。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 id="sec-update-backports-reasons-against">
   <title>バックポートを行わない理由</title>
   <para>
    一般的なポリシールールとしては、当社のエンタープライズ製品に、パッケージの新しいアップストリームバージョンは導入されないことになっています。ただしこのルールは絶対的なものではありません。限られたクラスのパッケージ(特定のウィルス対策ソフトウェア内)では、品質確保の観点から選ばれた保守的なアプローチよりも、セキュリティに関する考慮事項の方が重視されます。こうしたクラスのパッケージでは、時として、エンタープライズ製品ラインのリリース済みバージョンに、新しいバージョンが導入されることがあります。
   </para>
   <para>
    その他のタイプのパッケージについても、バックポートではなく新しいバージョンの導入が選択される場合があります。バックポートの作成が経済的に不可能な場合や、新しいバージョンの導入に対する非常に妥当な技術的な理由が存在する場合などがこれに該当します。
   </para>
  </sect2>

  <sect2 id="sec-update-backports-implication">
   <title>バージョン番号の解釈に対するバックポートの意味</title>
   <para>
    バックポートが実行されているために、SUSEパッケージに特定の問題の修復が含まれているのか、または特定の機能が追加されているのかを、バージョン番号を単純に比較して判断することはできません。バックポートでは、SUSEパッケージのバージョン番号のアップストリーム部分は、単にSUSEパッケージの基となっているアップストリームバージョンを示しているだけです。ここには、対応するアップストリームリリースには存在しないけれどもSUSEパッケージにはバックポートされている修正や機能が含まれている可能性があります。
   </para>
   <para>
    こうしたバグ修復や機能にか案する情報が保存されている場所は数多くあります。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      パッケージの変更ログ:
     </para>
<screen>rpm -q --changelog name-of-installed-package
rpm -qp --changelog packagefile.rpm</screen>
     <para>
      パッケージの変更履歴を簡単にドキュメント化した出力です。
     </para>
    </listitem>
    <listitem>
     <para>
      パッケージの変更ログには、NovellのBugzillaトラッキングシステム内でバグを示す<literal>bnc#1234</literal>のようなエントリや、その他のバグトラッキングシステムへのリンクなどが含まれます(機密保護ポリシーにより、ユーザがこうした情報のすべてにアクセスできるわけではありません)。
     </para>
    </listitem>
    <listitem>
     <para>
      パッケージには、SUSEパッケージに固有の一般的な概要情報を含む<filename>/usr/share/doc/packagename/README.SUSE</filename>または<filename>README.SuSE</filename>ファイルが格納されている場合もあります。
     </para>
    </listitem>
    <listitem>
     <para>
      RPMソースパッケージには、通常のバイナリRPMを個別のファイルとして構築するときに適用されたパッチが含まれます。これらのファイルは、ソースコードの解読に精通していれば解釈することができます。詳細については、<ulink url="http://www.rpm.org/max-rpm/">Maximum RPM</ulink>ブックを参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      セキュリティ上のバグ修正については、<ulink url="https://www.suse.com/support/security/#1">SUSEのセキュリティ告知</ulink>を参照してください。バグは、<literal>CAN-2005-2495</literal>などの標準名で示されることがよくあります。こうした名前は、<ulink url="http://cve.mitre.org">Common Vulnerabilities and Exposures (CVE)</ulink>によって維持されています。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    バックポートが関係する場合にバージョン番号のこの限られた値が問題を引き起こす可能性がある、1つの特定の領域として、セキュリティスキャンツールの使用が挙げられます。セキュリティの脆弱性スキャンツール(または、それらのツールによる特定のテスト)の中には、単にバージョン情報のみに基づいて機能するものがあります。したがって、これらのツール/テストでは、バックポートが関係している場合に<quote>false positive</quote>(実際は脆弱ではないのに、ソフトウェアに脆弱な部分が見つかったというクレーム)が生成される傾向があります。セキュリティスキャンツールによるレポートを評価する場合は、エントリがバージョン番号のみに基づくものなのか、脆弱性が本当に存在するかどうかに関する実際のテストに基づくものかを、常に調査する必要があります。
   </para>
  </sect2>
 </sect1>
 <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="update_split_brain.xml" parse="xml"/>
 <sect1 id="sec-update-wagonhooks">
  <title>YaST Wagonのマイグレーションフック</title>



  <para>
   マイグレーションフックによって、マイグレーションプロセスの過程のどこかの時点で、カスタムの外部スクリプトを実行できます。これらのスクリプトを使用して、通常のRPMスクリプトでは処理できない特定の問題を処理したり、マイグレーション中に必要とされるような(通常のパッケージアップデートでは必要とされない)追加のアクションを実行することができます。
  </para>

  <para>
   マイグレーションフックはルート権限で実行されるので、スクリプト内では任意の保守タスクを実行できます(サービスの開始/停止、データのバックアップ、データマイグレーションなど)。これらのスクリプトは対話型にはできません。YaSTでの実行中にSTDINおよびSTDOUTがパイプにリダイレクトされます。Xセッションは使用できません。すべてのケースで使用できるとは限らないからです(テキストモードで実行中の場合など)。フックスクリプトについては、実行可能パーミッションを設定することを忘れないでください。
  </para>

  <para>
   マイグレーションフックは、<systemitem class="resource">yast2-wagon</systemitem>パッケージのバージョン2.17.32.1 (SLES11-SP2に対するアップデートとして提供)または2.17.34 (SLES11-SP3に含まれる)以上でサポートされています。
  </para>

  <sect2>
   <title>フックスクリプトの場所と命名規則</title>
   <para>
    これらのスクリプトは、<filename>/var/lib/YaST2/wagon/hooks/</filename>ディレクトリで見つけることができます。想定されるスクリプト名の形式は、<replaceable>step_seq_prefix_name</replaceable>です。各文字列は次のような意味になります。
   </para>
   <variablelist>
    <varlistentry>
     <term><replaceable>step</replaceable>
     </term>
     <listitem>
      <para>
       事前定義されたマイグレーションステップ名で、現在のマイグレーションステップを説明します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>seq</replaceable>
     </term>
     <listitem>
      <para>
       00～99までのシーケンス番号で、これによりスクリプトの実行順序を設定することができます(正しくソートするためには、必ず00から開始することが重要です)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>prefix</replaceable>
     </term>
     <listitem>
      <para>
       競合を避けるために一意にする必要があります(ネームスペースのように)。(パッケージの一部であれば)パッケージ名、またはベンダ名やインターネットドメイン名などを使用します。一意であると十分に考えられるものであれば基本的に何でも使用できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>name</replaceable>
     </term>
     <listitem>
      <para>
       任意の文字列にできます(スクリプトを区別するだけのものです)。わかりやすい名前にすることをお勧めします。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <example>
    <title>完全パスのフックスクリプト</title>
<screen>/var/lib/YaST2/wagon/hooks/before_package_migration_00_postgresql_backup</screen>
   </example>
  </sect2>

  <sect2>
   <title>フックスクリプトの終了値</title>
   <para>
    スクリプトは終了値0を返す必要があります。失敗した(終了値がゼロ以外の)場合は、Wagonにエラーメッセージが表示され、スクリプトを再起動するか、失敗を無視(別のスクリプトで続行)するか、現在のステップおよびステージのフックを完全にキャンセルすることができます。
   </para>
  </sect2>

  <sect2>
   <title>等羃のスクリプト</title>
   <para>
    フックスクリプトは<emphasis>何度も実行される可能性がある</emphasis>(Wagonのダイアログを行き来しているうちに、Wagonそのものが再起動したり、マイグレーションワークフロー内で一部のステップが複数回実行される可能性もある)ので、スクリプトはその事実に対処する必要があります(アクションを実行する必要があるのか、アクションはすでに実行済みなのか、単純な一時的なスタンプファイルを作成できるのか、そうでなければ複数回の実行を正しく解決できるのかを、最初に確認することができます)。
   </para>
  </sect2>

  <sect2>
   <title>サポートされているフックのリスト</title>
   <para>
    一部のフックはオプションです(以前の結果またはユーザ選択の値に依存しているため)。一部のフックは複数回呼び出されるので注意が必要です(たとえば、登録はマイグレーションの前後に呼び出されます)。次に、サポートされているフック(ステップ名)を実行順に並べたリストを示します。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_init</command>
     </term>
     <listitem>
      <para>
       最初に開始されます(注意: Wagonの再起動後にもう一度呼び出されます)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_welcome</command>
     </term>
     <term><command>after_welcome</command>
     </term>
     <listitem>
      <para>
       ［ようこそ］ダイアログが表示される前後に開始されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration_check</command>
     </term>
     <term><command>after_registration_check</command>
     </term>
     <listitem>
      <para>
       Wagonが登録状態をチェックします(一部の製品の登録の期限が切れていると、マイグレーションに失敗する場合があります)。すべてがOKの場合は何もダイアログが表示されず、Wagonによって自動的に次のステップに進みます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_custom_url</command>
     </term>
     <term><command>after_custom_url</command>
     </term>
     <listitem>
      <para>
       リポジトリマネージャが開始されます(オプション、パッチCDモードのみ)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_self_update</command>
     </term>
     <term><command>after_self_update</command>
     </term>
     <listitem>
      <para>
       Wagonのアップデートそのものの前後に呼び出されます(最新バージョンがマイグレーションに使用されていることを確認します)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_installing_migration_products</command>
     </term>
     <term><command>after_installing_migration_products</command>
     </term>
     <listitem>
      <para>
       マイグレーション製品のインストールの前後に呼び出されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_selecting_migration_source</command>
     </term>
     <term><command>after_selecting_migration_source</command>
     </term>
     <listitem>
      <para>
       Novell Customer Centerリポジトリ経由でマイグレートするのか、カスタムリポジトリを使用してマイグレートするのか、Wagonがユーザに尋ねます。次のステップはこのユーザ選択によって決まります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration</command>
     </term>
     <term><command>after_registration</command>
     </term>
     <listitem>
      <para>
       SUSEレジスタが実行されます(マイグレーションリポジトリを追加するため)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_repo_selection</command>
     </term>
     <term><command>after_repo_selection</command>
     </term>
     <listitem>
      <para>
       手動のリポジトリ管理。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_set_migration_repo</command>
     </term>
     <term><command>after_set_migration_repo</command>
     </term>
     <listitem>
      <para>
       マイグレーションリポジトリ(Novell Customer Centerの使用時は完全/最小マイグレーション)を選択するか、リポジトリ選択を更新します(カスタムリポジトリマイグレーション)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_package_migration</command>
     </term>
     <listitem>
      <para>
       パッケージのアップデートが開始される前、このステップの後に実際のマイグレーションが開始され、前の状態に自動的に戻ることはできなくなります(このフェーズで中止すると、システムに矛盾が発生し(半分アップグレードされた状態)、手動のロールバックが必要になります)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration</command>
     </term>
     <term><command>after_registration</command>
     </term>
     <listitem>
      <para>
       SUSEレジスタが実行されます(アップデートされた製品を登録するため)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_congratulate</command>
     </term>
     <term><command>after_congratulate</command>
     </term>
     <listitem>
      <para>
       マイグレーションが成功した結果、Wagonによって成功を示すダイアログが表示される前後。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_exit</command>
     </term>
     <listitem>
      <para>
       Wagonが終了する直前に呼び出されます(中止後や再起動時も含め、マイグレーションの結果に関係なく常に呼び出されます)。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>中止のフック</title>
   <para>
    ユーザがマイグレーションを中止したときに呼び出される、特別な中止のフックがあります。これらのフックはマイグレーションワークフロー内の任意のステップで呼び出すことができるので、実行順序は保証できません。他のフックの結果に依存している場合、スクリプトで現在の状態をチェックする必要があります。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_abort</command>
     </term>
     <listitem>
      <para>
       ユーザがマイグレーションの中止を確定しました。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_abort_rollback</command>
     </term>
     <term><command>after_abort_rollback</command>
     </term>
     <listitem>
      <para>
       ユーザが中止後にロールバックを確定しました(マイグレーション開始前にインストールされていた古い製品に戻ります)。これらのフックはbefore_abortの後に呼び出され、ユーザがロールバックを確定しない場合はスキップされます。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>再起動のフック</title>
   <para>
    これらのフックは、Wagonそのものが再起動されると常に呼び出されます。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_restart</command>
     </term>
     <listitem>
      <para>
       Wagonは終了し、もう一度開始されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>after_restart</command>
     </term>
     <listitem>
      <para>
       Wagonは再起動されており、マイグレーションワークフローの次のステップが実行されます。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>通常使用するフック</title>
   <para>
    フックのリストはかなり大きなものですが、その多くは特別な事例で意味をなすものです。通常の使用例では、次のようなフックが優先的に使用されます。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      システムをマイグレートする前(まだ前のバージョンを実行しているとき)に何らかのアクションを実行するには、<command>before_package_migration</command>フックを使用します。
     </para>
     <para>
      この時点では、マイグレーションの準備ができていて開始寸前であることは明確ですが、それ以前のすべてのステップで、マイグレーションを中止することが可能でした。

     </para>
    </listitem>
    <listitem>
     <para>
      システムのマイグレート後(システムはマイグレード後の新しいバージョンを実行しているが、何かまだアクティブになっていない機能があるとき(カーネルのアップデート後にリブートが必要だったり、サービスのアップデート後に再起動が必要な場合など))に何らかのアクションを実行するには、<command>before_congratulate</command>または<command>after_congratulate</command>フックを使用します。
     </para>
     <para>
      これは、<command>before_package_migration</command>フックによる一時的な結果を消去する場合にも使用できます。この時点で、マイグレーションは正常に終了しています。
     </para>
    </listitem>
    <listitem>
     <para>
      マイグレーションが中止された場合に変更を元に戻すには、事例に応じて、中止のフックのいずれかを使用します。中止のフックはいつでも呼び出すことができるので、元に戻す必要はないかもしれません(変更を実行するフックがまだ呼び出されていない可能性があります)。中止のフックでは、現在の状態をチェックする必要があります。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2>
   <title>廃止されたフック</title>
   <para>
    古いバージョンのWagonでは、2つのフックスクリプトのみがサポートされていました。<filename>/usr/lib/YaST2/bin/wagon_hook_init</filename>と<filename>/usr/lib/YaST2/bin/wagon_hook_finish</filename>です。問題は、フックとして実行できるスクリプトは1つだけで、フックを直接PRMパッケージに配置できないことでした。
   </para>
   <para>
    これらの古いフックスクリプトは、後方互換性のために新しいバージョンのWagonでもサポートされていますが、廃止されたフックの変わりに、新しいフックの<command>before_init</command>と<command>before_exit</command>を使用する必要があります。
   </para>
  </sect2>
 </sect1>
</chapter>
