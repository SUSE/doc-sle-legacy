<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="automated_upgrade.xml" id="cha-update-auto" os="sles">
 <title>SUSE Linux Enterprise 11 SP2から11 SP3への自動アップグレード</title>
 <para>
  SUSE Linux Enterprise 11 SP2からSUSE Linux Enterprise 11 SP3への大規模な無人アップグレードを行うには、以下の手順を使用します。適切なAutoYaSTプロファイルの作成には、いくつかの準備ステップが必要です。最終的に、AutoYaSTがアップグレードプロセスを実行します。
 </para>
 <sect1 id="sec-update-auto-prep-autoyast">
  <title>AutoYaSTプロファイルの準備</title>

  <para>
   自動アップグレード用AutoYaSTプロファイルでは、AutoYaSTインストールと同じファイル形式を使用します。<phrase os="sled;sles">AutoYaSTの詳細については、<xref linkend="cha-deployment-autoinst"/>および<xref linkend="book-autoyast"/>を参照してください。</phrase>
  </para>

  <para>
   ただし、理由は明白ですが、システムには、アップグレード時に設定しても意味のない部分(パーティション分割など)があります。一方、アップグレード固有のオプションは、AutoYaSTプロファイルによって設定すると有用です。
  </para>

  <sect2>
   <title>アップグレード</title>
   <para>
    アップグレードオプションでは、アップグレード時の依存関係ソルバの動作を定義します:
   </para>
<screen>&lt;upgrade&gt;
  &lt;only_installed_packages
    config:type="boolean"&gt;false&lt;/only_installed_packages&gt;
  &lt;stop_on_solver_conflict
    config:type="boolean"&gt;true&lt;/stop_on_solver_conflict&gt;
&lt;/upgrade&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>only_installed_packages</literal>
     </term>
     <listitem>
      <para>
       パッケージベースのアップグレード(同一製品の次のサービスパックへのアップグレードで推奨される方法)の場合は、<literal>true</literal>に設定します。パターンベースのアップグレード(SLES10からSLES11など、製品のバージョン間でのアップグレードで推奨される方法)の場合は、<literal>false</literal>に設定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>stop_on_solver_conflict</literal>
     </term>
     <listitem>
      <para>
       パッケージの依存関係を対話的に解決できなかった場合に提案を表示するかどうか定義します。これは、<literal>true</literal>に設定することをお勧めします。ただし、そのように設定しても、対話式プロセスになることがあり、その際には手動で矛盾を解決しなければなりません。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>ソフトウェアの選択</title>
   <para>
    ソフトウェアの選択オプションでは、リゾルバの結果に加えて、どのコンポーネントを選択するか、選択しないか定義します。
   </para>
<screen>&lt;software&gt;
  &lt;packages config:type="list"&gt;
    &lt;package&gt;autoyast2-installation&lt;/package&gt;
    &lt;package&gt;apparmor-profile-editor&lt;/package&gt;
  &lt;/packages&gt;
  &lt;patterns config:type="list"&gt;
    &lt;pattern&gt;base&lt;/pattern&gt;
  &lt;/patterns&gt;
  &lt;remove-packages config:type="list"/&gt;
  &lt;remove-patterns config:type="list"/&gt;
&lt;/software&gt;</screen>
   <para>
    パッケージの矛盾を解決して対話的操作の必要性をなくすには、パッケージやパターンの選択または非選択の設定が、特に重要です。いったんアップグレードが完了すると、新しく作成された<filename>autoupg_updated.xml</filename>ファイルには、これらのパッケージやパターンが含まれるだけでなく、他の任意の理由で選択または非選択に設定されたパッケージやパターンも含まれます。
   </para>
  </sect2>

  <sect2>
   <title>アップグレード前のバックアップ</title>
   <para>
    アップグレード前のバックアップオプションは、アップグレード提案における次の機能に一致します。
   </para>
<screen>&lt;backup&gt;
  &lt;sysconfig config:type="boolean"&gt;true&lt;/sysconfig&gt;
  &lt;modified config:type="boolean"&gt;true&lt;/modified&gt;
  &lt;remove_old config:type="boolean"&gt;false&lt;/remove_old&gt;
&lt;/backup&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>sysconfig</literal>
     </term>
     <listitem>
      <para>
       sysconfigをアップグレード前にバックアップするかどうか定義します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>modified</literal>
     </term>
     <listitem>
      <para>
       変更された設定ファイルをアップグレード前にバックアップするかどうか定義します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>remove_old</literal>
     </term>
     <listitem>
      <para>
       以前のアップグレードから古いバックアップを削除するかどうか定義します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 id="sec-update-auto-run">
  <title>自動アップグレードの実行</title>

  <para>
   自動アップグレードを開始するには、インストールメディアをブートし、そのメディアにAutoYaSTプロファイルを渡します。プロファイルをシステムに渡すには、次の2つの方法がありあます。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     AutoYaSTインストールの場合と同様に、プロファイルをカーネルのコマンドラインに渡します(<literal>autoupgrade=1</literal> <filename>autoyast=http://host/path/profile.xml</filename>パラメータを使用)。System zの場合は、次の方法しかありません。
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>autoupgrade=1</literal>パラメータをカーネルコマンドラインに渡します。アップグレードの開始前に、プロファイルを<filename>/root/autoupg.xml</filename>にコピーします。これ以上、カーネルパラメータを追加する必要はありません。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   後者のやり方では、異なるマシンの場合でも、そのマシンのファイルシステムに適切なプロファイルをコピーするだけで、単一のインストールカーネルコマンドラインを使用できます。
  </para>

  <para>
   マシンにインストールしているSUSE Linux Enterpriseシステムが1つだけで、パッケージの競合がなく、プロファイルをアップグレード提案で停止するように設定していない場合は、プロセス全体が非対話的になります。アップグレード提案を入力する場合は、そのアップグレードの設定を変更できます。
  </para>

  <para>
   アップグレードの終了後、YaSTは、<filename>/root/autoupg-updated.xml</filename>ファイルを作成します。このファイルには、提案で行われた適用済みソフトウェア選択の変更を反映したプロファイルが含まれています。このファイルは、特に、同じパッケージを選択したコンピュータを多数アップグレードする場合に有用です。このようにして、1つのコンピュータでの競合の解決を他のコンピュータに簡単に適用できます。その結果、これらの競合が自動的に解決され、アップグレード自体は非対話的になります。
  </para>

  <para>
   マシンに別のSUSE Linux Enterpriseシステムがインストールされている場合は、必ず、どれをアップグレードするか質問されます。アップグレードの対象をあらかじめ選択する方法はありません。
  </para>
 </sect1>
 <sect1 id="sec-update-auto-grub">
  <title>ブートしてアップグレードするためのGRUBメニューセクション</title>

  <para>
   システムをブートするもう1つの方法は、GRUBメニューに追加セクションを作成し(他のブートローダや他のアーキテクチャの場合も同様にして)、それに従ってインストールを開始することです。次の例では、GRUB内に<literal>(hd0,0)</literal>と呼ぶ別個の<filename>/boot</filename>パーティションが存在すると想定しています。
  </para>

<screen>title Upgrade
    root (hd0,0)
    kernel /upgrade/linux
    install=<replaceable>inst_source_url</replaceable> autoupgrade=1
    autoyast=<replaceable>autoyast_profile_url</replaceable> vga=0x314
    initrd /upgrade/initrd
  </screen>

  <para>
   上記の例では、インストールカーネルとインストール<systemitem>initrd</systemitem>が <filename>/boot/upgrade</filename>ディレクトリ内に存在しています。
  </para>

  <para>
   System zでは、パラメータをPARMファイルに追加する必要があり、AutoYaSTベースのインストールを実行する場合と同様に実行します。
  </para>
 </sect1>
 <sect1 id="sec-update-auto-2nd-stage">
  <title>アップグレードの第2段階</title>

  <para>
   デフォルトの自動アップグレードでは、アップグレードの第2段階で設定を変更することはありません。ただし、ネットワーク設定だけは例外です。ネットワーク設定は、AutoYaSTアップグレードプロファイルに保存されるように設定する必要があります。
  </para>

  <para>
   一部のシステム領域の設定を、アップグレード後に調整する必要がある場合(新しいサービスの設定など)、アップグレード用のAutoYaSTプロファイルに関連セクションを追加すると、選択したシステム領域の設定がアップグレード時に保存されます。
  </para>

  <warning>
   <title>AutoYaST提供の設定による既存設定の置換</title>
   <para>
    そのシステム領域の既存設定が、AutoYaSTの設定で置換されて、破壊されないように注意してください。
   </para>
  </warning>

  <para>
   通常、AutoYaSTプロファイルで提示されなければならない唯一の設定の調整は、SMT (Subscription Management Tool)またはNCC (Novell Customer Center)の使用によるシステムの登録です。これがないと、システムで更新リポジトリが取得されなくなり、後で再設定されない限り更新はできなくなります。
  </para>
 </sect1>
 <sect1 id="sec-update-auto-limitations">
  <title>制限事項とヒント</title>

  <para/>

  <sect2>
   <title>NetworkManagerと登録</title>
   <para>
    ネットワークデバイスとネットワーク接続の管理にNetworkManagerを使用している場合は、アップグレードの第2段階ではネットワーク接続を使用できません。したがって、システムは登録を実行できません。
   </para>
  </sect2>

  <sect2>
   <title>アップグレード設定のをクリーンアップ</title>
   <para>
    アップグレードプロセスを開始するために、システムで何かを変更した場合(たとえば、ブートローダのメニューへの新セクションの追加など)、アップグレードの完了後にその変更を削除することがあります。
   </para>
   <para>
    その場合は、ポストインストールスクリプトで自動的に実行できます。例については、<xref linkend="createprofile-scripts"/>を参照してください。GRUBの<filename>menu.lst</filename>をクリーンアップするサンプルスクリプトは、サンプルファイル<filename>autoupg.xml</filename>に含まれています。ただし、スクリプトが、自分の特定のセットアップに一致するかどうか、実際に必要なもの以上は削除しないかどうか、必ず確認してください。
   </para>
  </sect2>

  <sect2>
   <title>詳細情報</title>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Linuxrcマニュアル: <ulink url="http://en.opensuse.org/SDB:Linuxrc"/>
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
</chapter>
