<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect1
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="raid.xml" xml:id="sec-yast2-system-raid">
 <title>ソフトウェアRAID設定</title><indexterm> <primary>YaST</primary> <secondary>RAID</secondary></indexterm><indexterm> <primary>RAID</primary> <secondary>YaST</secondary></indexterm><indexterm> <primary>ソフトウェア RAID</primary> <see>RAID</see></indexterm>



 <para>
  RAID (Redundant Array of Independent Disks)の目的は、複数のハードディスクパーティションを1つの大きな<emphasis>仮想</emphasis>ハードディスクに統合して、パフォーマンスおよび/またはデータのセキュリティを最適化することです。大部分のRAIDコントローラは、SCSIプロトコルを使用します。これは、SCSIプロトコルがIDEプロトコルより効率的な方法で、より多くのハードディスクを制御できるからです。SCSIプロトコルは、パラレルコマンド処理用としても、より適切なプロトコルです。一方、IDEまたはSATAハードディスクをサポートしているRAIDコントローラもあります。ソフトウェアRAIDは、ハードウェアRAIDコントローラの追加購入することなく、RAIDシステムの利点を提供します。ただし、これにはいくらかのCPU時間を要し、高性能コンピュータには適さないメモリ要件があります。
 </para>

 <para>
  <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>を使用すると、数台のハードディスクを1つのソフトウェアRAIDシステムに統合できます。RAIDには、それぞれが異なる目標、利点、および属性をもついくつかのハードディスクを1つのRAIDシステムに結合するためのいくつかの戦略が含まれています。これらは通常、<emphasis>RAIDレベル</emphasis>と呼ばれます。
 </para>

 <para>
  一般的なRAIDレベルは次のとおりです。
 </para>

 <variablelist>
  <varlistentry>
   <term>RAID 0</term>
   <listitem>
    <para>
     このレベルでは、各ファイルのブロックが複数のディスクドライブに分散されるので、データアクセスのパフォーマンスが向上します。このレベルは、データのバックアップを提供しないため、実際にはRAIDではありませんが、<emphasis>RAID  0</emphasis>という名前は、このタイプのシステムに対して一般的に使用されています。RAID 0では、2つ以上のハードディスクが互いにプールします。パフォーマンスは向上しますが、たった1つのハードディスクに障害が発生しただけで、このRAIDシステムは破壊され、データは失われます。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>RAID 1</term>
   <listitem>
    <para>
     このレベルでは、データが他のハードディスクに一対一でコピーされるため、データに対する適切なセキュリティが提供されます。これは、<emphasis>ハードディスクミラーリング</emphasis>として知られています。一方のディスクが破壊された場合は、その内容のコピーを他方のディスクで利用できます。したがって、1つのディスク以外のすべてのディスクが損なわれても、データは保全されます。ただし、破損が検出されない場合は、その破損データが、損傷を受けていないディスクにミラーリングされることがありますこれによって、同一のデータ損失が発生する可能性があります。書き込みパフォーマンスは、単一ディスクアクセスを使用する場合より、コピー処理が遅くなります(10〜20パーセント低速)。ただし、読み取りアクセスは、通常の物理ハードディスクのどれよりもはるかに高速です。その理由は、重複データをパラレルスキャンできるからです。一般に、レベル 1では、読み取り転送速度が単一ディスクの2倍近くになりますが、書き込み転送速度は単一ディスクとほぼ同じです。
    </para>
   </listitem>
  </varlistentry>

  <varlistentry>
   <term>RAID 5</term>
   <listitem>
    <para>
     RAIDD 5は、パフォーマンスと冗長性の面で、レベル0とレベル1を最適に調整したものです。ハードディスクスペースは、使用されるディスク数から1を引いたものに等しくなります。データは、RAID 0の場合と同様に、ハードディスク間に配布されます。パーティションの1つで作成される<emphasis>パリティブロック</emphasis>は、セキュリティ上の理由で存在します。各パーティションはXORによって互いにリンクされているので、システム障害の場合に、内容が対応するパリティブロックによって再構築されます。RAIDD 5の場合、同時に複数のハードディスクが障害を起こすことはありません。1つのハードディスクに障害がある場合は、そのハードディスクをできるだけ早く交換して、データ消失の危険性をなくす必要があります。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>RAID 6</term>
   <listitem>
    <para>
     RAIDの信頼性を向上するには、RAID 6を使用できます。このレベルでは、2つのディスクが故障した場合でも、アレイを再構築できます。RAID 6では、少なくとも4つのアレイを実行する必要があります。ただし、この設定をソフトウェアRAIDとして実行する場合は、かなりのCPUとメモリを必要とします。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>RAID 10 (RAID 1+0)</term>
   <listitem>
    <para>
     このRAIDの実装では、RAID 0とRAID 1の機能を組み合わせています。まず、データが個々のディスクアレイにミラーリングされ、それらのアレイが新しいRAID 0タイプのアレイに挿入されます。各RAID 1サブアレイでは、1つのディスクが故障しても、データは損傷しません。RAID 10を実行するには、偶数台数のハードディスクを4台以上使用する必要があります。このタイプのRAID は、膨大な負荷の発生が予期されるデータベースアプリケーションに使用します。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>その他のRAIDレベル</term>
   <listitem>
    <para>
     その他のRAIDレベル(RAID 2、RAID 3、RAID 4、RAIDn、RAID 10、RAID 0+1、RAID 30、RAID 50など)も開発されていますが、その一部は、ハードウェアベンダによる専有権付き実装です。これらのレベルは、あまり広く使用されていないので、ここでの説明は省略します。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <section xml:id="sec-yast2-system-raid-conf">
  <title>YaSTによるソフトウェアRAID設定</title>
  <para>
   YaSTの<guimenu>RAID</guimenu>設定には、<xref linkend="sec-yast2-i-y2-part-expert"/>に説明があるYaSTエキスパートパーティショナからアクセスできます。このパーティション分割ツールを使用すると、既存のパーティションを編集および削除したり、ソフトウェアRAIDで使用される新規パーティションを作成できます。
  </para>
  <procedure>
   <step>
    <para>
     <guimenu>ハードディスク</guimenu>からハードディスクを選択します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>パーティション</guimenu>タブに変更します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>追加</guimenu>をクリックし、このディスクでのRAIDパーティションのサイズを入力します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>Do not Format the Partition</guimenu>を使用し、<guimenu>ファイルシステムID</guimenu>を<guimenu>0xFD Linux RAID</guimenu>に変更します。このパーティションはマウントしないでください。
    </para>
   </step>
   <step>
    <para>
     利用可能なディスク上で目的のすべての物理ボリュームを定義するまで、この手順を繰り返します。
    </para>
   </step>
  </procedure>
  <para>
   RAID 0およびRAID 1の場合、少なくとも2つのパーティションが必要です。RAID 1の場合、パーティションは2つだけです。RAID 5を使用する場合は3つ以上のパーティションが必要で、RAID 6およびRAID 10を使用するには4つ以上のパーティションが必要です。パーティションはすべて同じサイズとすることをお勧めします。ハードディスクのどれかに障害が発生した場合にデータを失うリスクを減らしたり(RAID 1、RAID 5)、RAID 0のパフォーマンスを最適化するには、RAIDパーティションを異なる複数のハードディスクに配置する必要があります。RAIDで使用するパーティションをすべて作成したら、<menuchoice><guimenu>RAID</guimenu><guimenu>Add RAID</guimenu></menuchoice>の順に選択して、RAIDの設定を開始します。
  </para>
  <para>
   次のダイアログでは、RAIDレベル0、5、6、10のどれかを選択します。次に、RAIDシステムで使用する<quote>Linux RAID</quote>タイプまたは<quote>Linuxネイティブ</quote>タイプどちらかのパーティションをすべて選択します。スワップパーティションまたはDOSパーティションは表示されません。
  </para>
  <tip>
   <para>
    追加したディスクの順序が重要であるRAIDタイプについては、個々のディスクに、文字AからEのいずれかでマークすることができます。<guimenu>分類</guimenu>ボタンをクリックし、ディスクを選択して<guimenu>クラスX</guimenu>ボタンのいずれかをクリックします。ここで、Xはディスクに割り当てる文字のことです。使用可能なすべてのディスクをこのように割当てて、<guimenu>OK</guimenu>を押して確定します。<guimenu>ソート済み</guimenu>または<guimenu>インタリーブ済み</guimenu>ボタンを使用して分類されたディスクを簡単にソートしたり、<guimenu>ファイルのパターン</guimenu>を使用してソートパターンを簡単に追加することができます。
   </para>
  </tip>
  <figure xml:id="fig-yast2-system-raid-conf">
   <title>RAIDパーティション</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_raid4.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_raid4.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   前に割り当てを解除したパーティションを、選択したRAIDボリュームに追加するには、そのパーティションをクリックしてから、<guimenu>追加</guimenu>をクリックします。すべてのパーティションをRAID用の予約パーティションとして割り当てます。すべてのパーティションを割り当てないと、パーティションのスペースが未使用のまま残ります。パーティションをすべて割り当てたら、<guimenu>次へ</guimenu>をクリックして、利用可能な<guimenu>RAID Options</guimenu>を選択します。
  </para>
  <para>
   最後のステップでは、使用するファイルシステムのほか、暗号化とRAIDボリュームのマウントポイントを設定します。<guimenu>完了</guimenu>をクリックして設定を完了した後、エキスパートパーティショナ内の<emphasis>RAID</emphasis>とマークされた<filename>/dev/md0</filename>デバイスと他のデバイスを観察してください。
  </para>
 </section>

 <section>
  <title>トラブルシューティング</title>
  <para>
   <filename>/proc/mdstats</filename>ファイルをチェックして、RAIDパーティションが破壊されているかどうかを調べます。システム障害が発生した場合は、Linuxシステムをシャットダウンして、問題のあるハードディスクを、同じ方法でパーティショニングされている新しいハードディスクに置き換えます。次に、システムを再起動して、<command>mdadm /dev/mdX --add /dev/sdX</command>コマンドを入力します。「X」を使用しているデバイス識別子に置き換えてください。これにより、ハードディスクがRAIDシステムに自動的に統合され、そのRAIDシステムが完全に再構築されます。
  </para>
  <para>
   再構築中もすべてのデータにアクセスできますが、RAIDが完全に再構築されるまでは、パフォーマンス上の問題が発生する可能性があります。
  </para>
 </section>





 <section>
  <title>詳細情報</title>
  <para>
   ソフトウェアRAIDの設定方法と詳細情報が、次のHOWTOにあります。
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <filename>/usr/share/doc/packages/mdadm/Software-RAID.HOWTO.html</filename>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="http://raid.wiki.kernel.org"/>
    </para>
   </listitem>
  </itemizedlist>
  <para>
   <link xlink:href="http://marc.info/?l=linux-raid"/>などのLinux RAIDメーリングリストがあります。
  </para>
 </section>
</section>
