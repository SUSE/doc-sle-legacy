<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE book
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<book xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="stor_admin.xml" revision="12/16/13" conformance="sles11,Novell,no,4,80" xml:lang="ja" xml:id="stor-admin"><title>ストレージ管理ガイド</title><titleabbrev>ストレージ管理ガイド</titleabbrev><info><productname>SUSE Linux Enterprise Server 11 SP3 </productname><date>2015 年5 月22 日</date><legalnotice xml:id="legalnotices">
  <title>保証と著作権</title>
  <para>Copyright © 2006–2013 Novell, Inc. and contributors.All rights reserved. </para>
  <para>この文書は、GNUフリー文書ライセンスのバージョン1.2または(オプションとして)バージョン1.3の条項に従って、複製、頒布、および/または改変が許可されています。ただし、この著作権表示およびライセンスは変更せずに記載すること。ライセンスバージョン1.2のコピーは、<quote>GNUフリー文書ライセンス</quote>セクションに含まれています。</para>
  <para>本書のすべての情報は、細心の注意を払って編集されています。しかし、このことは絶対に正確であることを保証するものではありません。Novell,Inc.、Suse Linux Products GmbH、著者、翻訳者のいずれも誤りまたはその結果に対して一切の責任を負いかねます。</para>
 </legalnotice><legalnotice xml:id="bw4uqnv">
  <title>商標</title>
  <simplelist>
   <member><link xlink:href="http://www.novell.com/company/legal/trademarks/tmlist.html">Novellの商標については、商標とサービスマークの一覧</link>を参照してください。</member><member>*LinuxはLinus Torvalds氏の登録商標です。他のすべての第三者の商標は、各商標権者が所有しています。</member><member>商標記号(®、™など) は、Novellの商標を示し、アスタリスク(*)は、サードパーティの商標を示します。</member>
  </simplelist>
 </legalnotice></info>


<preface xml:id="preface" xml:base="00_preface.xml"><title>このガイドについて</title><info/>
 
 <para>このガイドでは、SUSE Linux Enterprise Server 11 SP3 (Support Pack 3)サーバでストレージデバイスを管理する方法を説明します。</para>
 <bridgehead xml:id="audience">対象読者</bridgehead>
 <para>このガイドは、システム管理者を対象としています。</para>
 <bridgehead xml:id="usercomments">フィードバック</bridgehead>
 <para>本マニュアルおよびこの製品に含まれているその他のマニュアルについて、皆様のご意見やご要望をお寄せください。オンラインマニュアルの各ページの下部にあるユーザコメント機能を使用するかwww.novell.com/documentation/feedback.htmlにアクセスしてコメントを記入してください。</para>
 <bridgehead xml:id="docupdates">マニュアルの更新</bridgehead>
 <para>『<citetitle>SUSE Linux Enterprise Server 11ストレージ管理ガイド</citetitle>』の最新バージョンについては、<link xlink:href="http://www.suse.com/documentation/sles11">SUSE Linux Enterprise Server 11用SUSEマニュアルWebサイト</link>をご覧ください。</para>
 <bridgehead xml:id="additionaldoc">その他のマニュアル</bridgehead>
 <para>デバイスのパーティショニングと管理については、『<link xlink:href="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html"><citetitle>SUSE Linux Enterprise Server 11導入ガイド</citetitle></link>』の<link xlink:href="http://www.suse.com/documentation/sles11/book_sle_deployment/data/cha_advdisk.html"><quote>高度なディスクセットアップ</quote></link>を参照してください。</para>
</preface>

<chapter xml:id="filesystems" xml:lang="ja" xml:base="01_filesystems.xml"><title>Linuxファイルシステムの概要</title><info/>
 
 <para>SUSE Linux Enterprise Serverには、選択できる多数のさまざまなファイルシステム(Btrfs、Ext3、Ext2、ReiserFS、XFSなど)が付属しています。各ファイルシステムには、それぞれ独自の利点と欠点があります。 </para>
 <para>プロ級のハイパフォーマンスのセットアップには、可用性の高いストレージシステムが必要なことがあります。ハイパフォーマンスのクラスタリングシナリオの要件を満たすため、SUSE Linux Enterprise Serverでは、SLES HASI (High-Availability Storage Infrastructure)リリースにOCFS2 (Oracle Cluster File System 2)とDRBD (Distributed Replicated Block Device)を組み込んでいます。これらの高度なストレージシステムは、本書では扱いません。『<link xlink:href="http://www.suse.com/documentation/sle_ha/book_sleha/data/book_sleha.html"><citetitle>SUSE Linux Enterprise 11 SP3 High Availability Extension Guide</citetitle></link>』を参照してください。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec-filesystems-glossary" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-major" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-add" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-lfs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-stor-limits" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkbhpd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-info" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="sec-filesystems-glossary">
  <title>用語集</title>
  <variablelist>
   <varlistentry xml:id="bgchzar">
    <term>メタデータ(metadata)</term>
    <listitem>
     <para>ファイルシステムが内包するデータ構造です。これにより、すべてのオンディスクデータが正しく構成され、アクセス可能になります。本質的には、<quote>データに関するデータ</quote>です。ほとんどすべてのファイルシステムに独自のメタデータ構造があり、それが各ファイルシステムに異なるパフォーマンス特性が存在する理由の１つになっています。メタデータが破損しないよう維持するのは、非常に重要なことです。もし破損した場合、ファイルシステム内にあるすべてのデータがアクセス不能になる可能性があるからです。 </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="bgchzas">
    <term>inode</term>
    <listitem>
     <para>サイズ、リンク数、ファイルの内容を実際に格納しているディスクブロックへのポインタ、作成日時、変更日時、クセス日時など、ファイルに関する各種の情報を含むファイルシステムのデータ構造。 </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="bgchzat">
    <term>ジャーナル(journal)</term>
    <listitem>
     <para>ファイルシステムのジャーナルは、ファイルシステムがそのメタデータ内で行う変更を特定のログに記録するオンディスク構造です。ジャーナル機能は、システム起動時にファイルシステム全体をチェックする長い検索プロセスが不要なため、ファイルシステムの回復時間を大幅に短縮します。ただし、それはジャーナルが再現できる場合に限定されます。 </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 <section xml:id="sec-filesystems-major">
  <title>Linuxの主要なファイルシステム</title>
  <para>SUSE Linux Enterprise Serverでは、多様なファイルシステムを選択できます。このセクションでは、それらのファイルシステムの機能および利点の概要を説明します。 </para>
  <para>ただし、すべてのアプリケーションに最適なファイルシステムは存在しません。各ファイルシステムには特定の利点と欠点があり、それらを考慮する必要があります。最も高度なファイルシステムを選択する場合でも、適切なバックアップ戦略が必要です。 </para>
  <para>本項で使用される<emphasis>データの完全性</emphasis>および<emphasis>データの一貫性</emphasis>という用語は、ユーザスペースデータ(ユーザが使用するアプリケーションによりファイルに書き込まれるデータ)の一貫性を指す言葉ではありません。ユーザスペースのデータが一貫しているかどうかは、アプリケーション自体が管理する必要があります。 </para>
  <important>
   <para>このセクションで特に指定のない限り、パーティションおよびファイルシステムの設定または変更に必要なすべてのステップは、YaSTを使用して実行できます。 </para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-ext2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-ext3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-reiser" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-xfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkryet" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bwk8gda">
   <title>Btrfs</title>
   <para>Btrfsは、Chris Masonが開発したCOW(コピーオンライト)ファイルシステムです。このシステムは、Ohad Rodehが開発したCOWフレンドリーなBツリーに基づいています。Btrfsは、ロギングスタイルのファイルシステムです。このシステムでは、ブロックの変更をジャーナリングする代わりに、それらの変更を新しい場所に書き込んで、リンクインします。新しい変更は、最後の書き込みまで確定されません。 </para>
   <important>
    <para>Btrfsではファイルシステムのスナップショットを格納することができるため、標準のストレージ案の2倍のディスクスペースを確保しておくことが推奨されます。これは、YaSTパーティショナにより、ルートファイルシステムに対するBtrfsのストレージ案において、自動的に行われます。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15tkq5m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkq5n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5j" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5k" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5l" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5o" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5p" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="b15tkq5m">
    <title>主な機能</title>
    <para>Btrfsは、次のような耐障害性、修復、容易な管理機能を提供します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>書き込み可能なスナップショット。更新適用後に必要に応じてシステムを容易にロールバックしたり、ファイルをバックアップできます。 </para>
     </listitem>
     <listitem>
      <para>複数デバイスのサポート。ファイルシステムを拡大したり、縮小できます。この機能は、YaSTパーティショナの今後のリリースで利用可能となる予定です。</para>
     </listitem>
     <listitem>
      <para>圧縮機能。ストレージスペースを効率的に使用できます。 </para>
      <para>Btrfsのコマンドを使用して、透過圧縮を設定します。 Btrfsの圧縮および暗号化の機能は目下開発中であり、現在のところ<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>ではサポートされていません。</para>
     </listitem>
     <listitem>
      <para>メタデータとユーザデータ用のさまざまなRAIDレベル。</para>
     </listitem>
     <listitem>
      <para>メタデータとユーザデータ用のさまざまなチェックサム。エラー検出が向上します。</para>
     </listitem>
     <listitem>
      <para>Linux LVM (Logical Volume Manager)ストレージオブジェクトとの統合。</para>
     </listitem>
     <listitem>
      <para>SUSE Linux上でのYaSTパーティショナおよびAutoYaSTとの統合。</para>
     </listitem>
     <listitem>
      <para>既存のExt2、Ext3、およびExt4ファイルシステムからの、オフラインのマイグレーション 。</para>
     </listitem>
    </itemizedlist>
   </section>
   <section xml:id="b15tkq5n">
    <title>ブートローダのサポート</title>
    <para>Btrfs上の<filename>/boot</filename>に対するブートローダのサポートは、SUSE Linux Enterprise 12から利用可能となる予定です。</para>
   </section>
   <section xml:id="b15tkr5j">
    <title>Btrfsのサブボリューム</title>
    <para>BtrFSでは、割り当てられたスペースのプールにデフォルトのサブボリュームが作成されます。BtrFSでは、同じスペースプール内で個々のファイルシステムとして機能する追加サブボリュームを作成できます。サブボリュームの数は、プールに割り当てられたスペースによってのみ制限されます。</para>
    <para>Btrfsをルート(<filename>/</filename>)のファイルシステムに使用する場合は、YaSTパーティショナにより、Btrfsのサブボリュームとの使用のためのBtrfsファイルシステムが自動的に作成されます。いずれのサブディレクトリも、サブボリュームとして扱うことができます。たとえば、<xref linkend="b11qhfrl" xrefstyle="TableTitleOnPage"/>には、サブボリュームとして扱うことをが推奨されるサブディレクトリを示しています。これらのサブディレクトリには、記載の理由によりスナップショットするべきではないファイルが含まれているからです。</para>
    <table xml:id="b11qhfrl">
     <title>YaSTにおける、Btrfs用のデフォルトのサブボリュームの扱い</title>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="2381*"/>
     <colspec colnum="2" colname="2" colwidth="7620*"/>
      <thead>
       <row><!--id=bwk8pe0-->
        <entry>
         <para>パス</para>
        </entry>
        <entry>
         <para>サブボリュームとして扱う理由</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row><!--id=b11qhf62-->
        <entry>
         <para><filename>/opt</filename></para>
        </entry>
        <entry>
         <para>サードパーティのアドオンアプリケーションのソフトウェアパッケージを格納します。</para>
        </entry>
       </row>
       <row><!--id=b11qhf63-->
        <entry>
         <para><filename>/srv</filename></para>
        </entry>
        <entry>
         <para><filename>http</filename>ファイルと<filename>ftp</filename>ファイルを格納します。</para>
        </entry>
       </row>
       <row><!--id=b11qhf64-->
        <entry>
         <para><filename>/tmp</filename></para>
        </entry>
        <entry>
         <para>一時ファイルを格納します。</para>
        </entry>
       </row>
       <row><!--id=b11qhf65-->
        <entry>
         <para><filename>/var/crash</filename></para>
        </entry>
        <entry>
         <para>クラッシュしたカーネルのメモリダンプを格納します。</para>
        </entry>
       </row>
       <row><!--id=b11qhf66-->
        <entry>
         <para><filename>/var/log</filename></para>
        </entry>
        <entry>
         <para>システムおよびアプリケーションのログファイルを格納します。これはロールバックできません。</para>
        </entry>
       </row>
       <row><!--id=b11qhf67-->
        <entry>
         <para><filename>/var/run</filename></para>
        </entry>
        <entry>
         <para>ランタイム変数のデータを格納します。</para>
        </entry>
       </row>
       <row><!--id=b11qhf68-->
        <entry>
         <para><filename>/var/spool</filename></para>
        </entry>
        <entry>
         <para>プログラム、ユーザ、または管理者による処理を待っているデータ(ニュース、メール、プリンタのキューなど)を格納します。</para>
        </entry>
       </row>
       <row><!--id=b11qhf69-->
        <entry>
         <para><filename>/var/tmp</filename></para>
        </entry>
        <entry>
         <para>システムの再起動間で保存する一時ファイルまたは一時ディレクトリを格納します。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para>インストール後は、YaST Expert Partitionerを使用して、Btrfsサブボリュームの追加や削除が可能です。詳細については、『SUSE Linux Enterprise Server 11 SP3導入ガイド』の、<link xlink:href="https://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_yast2_i_y2_part_expert.html#yast2_btrfs_yast"><quote>YaSTを使用したBtrfsサブボリュームの管理</quote></link><link xlink:href="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html"><citetitle/></link>を参照してください。</para>
   </section>
   <section xml:id="b15tkr5k">
    <title>ルートファイルシステムのスナップショット</title>
    <para>Btrfsでは、SUSE Snapperのインフラストラクチャに書き込み可能なスナップショットが提供されており、これを使用して、更新プログラムの適用後に必要に応じてシステムをロールバックすることも、バックアップすることもできます。Snapperを使用すれば、スナップショットの作成や削除のほか、2つのスナップショットを比較してその相違を元に戻すこともできます。Btrfsをルート(<filename>/</filename>)ファイルシステムに使用した場合は、YaSTによりルートファイルシステムに対するスナップショットが自動的に有効化されます。 </para>
    <para>Snapperと、ZYpp (<filename>snapper-zypp-plugin</filename>）およびYaST (<filename>yast2-snapper</filename>)におけるその統合については、『SUSE Linux Enterprise Server 11 SP3管理ガイド』の<link xlink:href="http://www.suse.com/documentation/sles11/book_sle_admin/data/cha_snapper.html"><quote>Snapperを使用したスナップショット/ロールバック</quote></link><link xlink:href="http://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html"><citetitle/></link>を参照してください。 </para>
    <para>システムディスクがスナップショットでいっぱいにならないように、<filename>/etc/snapper/configs/root</filename>設定ファイルまたは他のマウントポイントで、Snapperクリーンアップのデフォルトをより制約された値に変更できます。Snapperでは、日次のcronジョブで実行された古いスナップショットをクリーンアップするために、3つのアルゴリズムが提供されています。クリーンアップ頻度は、マウントポイントのSnapper設定で定義されています。日次、月次、年次のクリーンアップのTIMELINE_LIMITパラメータ値を下げると、スナップショットの数と保持期間を減らせます。詳細については、『<link xlink:href="https://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html"><citetitle>SUSE Linux Enterprise Server 11 SP3管理ガイド</citetitle></link>』の<link xlink:href="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_snapper_config.html#sec_snapper_config_modify"><quote>設定ファイルの調整</quote></link>を参照してください。</para>
    <para>SUSEのSnapperプロジェクトについては、<link xlink:href="http://en.opensuse.org/Portal:Snapper">OpenSUSE.orgにあるSnapper Portal wiki</link>を参照してください。</para>
   </section>
   <section xml:id="b15tkr5l">
    <title>オンラインでのチェックと修復の機能</title>
    <para><command>scrub</command>を使用したチェックと修復の機能が、Btrfsのコマンドラインツールの一部として利用できます。ツリー構造が正しいことを前提として、データとメタデータの完全性を検証します。マウントしたファイルシステム上で、<command>scrub</command>を定期的に実行することができます。これは、通常の操作中にバックグラウンドプロセスとして実行されます。</para>
   </section>
   <section xml:id="b15tkr5m">
    <title>RAIDとMultipathのサポート</title>
    <para>YaSTパーティショナを使用して、Multiple Devices (MD)およびDevice Mapper (DM)のストレージ構成上でBtrfsを作成することができます。</para>
   </section>
   <section xml:id="b15tkr5n">
    <title>ExtファイルシステムからBtrfsへのマイグレーション</title>
    <para>既存のExtファイルシステム(Ext2、Ext3、またはExt4)から、Btrfsファイルシステムへデータボリュームをマイグレートすることができます。変換プロセスはオフラインで、デバイス上において行われます。ファイルシステムは、デバイス上の空き領域の15%以上を必要とします。 </para>
    <para>ExtファイルシステムをBtrfsに変換するには、ファイルシステムをオフラインにしてから、次のように入力します。</para>

<screen>
btrfs-convert &lt;<replaceable>device</replaceable>&gt;
</screen>

    <para>マイグレーションを、元のExtファイルシステムにロールバックするには、ファイルシステムをオフラインにしてから、次のように入力します。</para>

<screen>
btrfs-convert -r &lt;<replaceable>device</replaceable>&gt;
</screen>

    <important>
     <para>元のExtファイルシステムにロールバックする際、Btrfsへの変換後に追加したデータはすべて失われます。つまり、元のデータのみが、Extファイルシステムに逆変換されます。 </para>
    </important>
   </section>
   <section xml:id="b15tkr5o">
    <title>Btrfsの管理</title>
    <para>Btrfsは、YaSTパーティショナおよびAutoYaST内に統合されています。これはインストール時に利用可能で、ルートファイルシステム用のソリューションを設定することができます。インストール後に、YaSTパーティショナを使用して、Btrfsのボリュームの参照と管理を行うことができます。</para>
    <para>Btrfsの管理ツールは、<filename>btrfsprogs</filename>パッケージ内に用意されています。Btrfsコマンドの使用については、<command>btrfs(8)</command>、<command>btrfsck(8)</command>、<command>mkfs.btrfs(8)</command>、および<command>btrfsctl(8)</command> のマニュアルページを参照してください。Btrfsの機能については、<link xlink:href="http://btrfs.wiki.kernel.org"><citetitle>Btrfs wiki</citetitle></link>を参照してください。</para>
    <para><command>fsck.btrfs(8)</command>ツールは、SUSE Linux Enterpriseの更新リポジトリ内で近日中に利用可能となります。</para>
   </section>
   <section xml:id="b15tkr5p">
    <title>サブボリュームに対するBtrfsクォータのサポート</title>
    <para>Btrfs <systemitem>root</systemitem>ファイルシステムのサブボリューム<filename>/var/log</filename>、<filename>/var/crash</filename>および<filename>/var/cache</filename>が、通常の操作時に利用可能なディスクスペースのすべてを使用でき、システムに不具合が発生します。この状況を回避するため、SUSE Linux Enterpriseではサブボリュームに対するBtrfsクォータのサポートを提供するようになりました。詳細については、<filename>btrfs(8)</filename>のマニュアルページを参照してください。</para>
   </section>
  </section>
  <section xml:id="sec-filesystems-major-ext2">
   <title>Ext2</title>
   <para>Ext2の起源は、Linuxの歴史の初期にさかのぼります。その前身であったExtended File Systemは、1992年4月に実装され、Linux 0.96cに統合されました。Extended File Systemは多くの変更を加えられ、Ext2として数年にわたって、最も人気のあるLinuxファイルシステムになりました。その後、ジャーナルファイルシステムが作成され、回復時間が非常に短くなったため、Ext2の重要性は低下しました。 </para>
   <para>Ext2の利点に関する短い要約を読むと、かつて幅広く好まれ、そして今でも一部の分野で多くのLinuxユーザから好まれるLinuxファイルシステムである理由を理解するのに役立ちます。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bi6ymkx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzb1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bi6ymkx">
    <title>堅実性と速度</title>
    <para><quote>古くからある標準</quote>として、Ext2は過去に多くの改良がなされ、繰り返しテストされてきました。これが、Ext2がしばしば非常に堅実と評される理由かもしれません。ファイルシステムが正常にアンマウントできず、システムが機能停止した場合、e2fsckはファイルシステムのデータの分析を開始します。メタデータは一貫した状態に戻り、保留されていたファイルとデータブロックは、指定のディレクトリ(<filename>lost+found</filename>)に書き込まれます。ジャーナルファイルシステムとは対照的に、e2fsckは、最近変更されたわずかなメタデータだけではなく、ファイルシステム全体を分析します。この結果、ジャーナルファイルシステムがログデータだけをチェックするのに比べて、かなり長い時間を要します。ファイルシステムのサイズにもよりますが、この手順は30分またはそれ以上を要することがあります。したがって、高可用性を必要とするどのようなサーバでも、Ext2を選択することは望ましくありません。ただし、Ext2はジャーナルを維持せず、使用するメモリも非常にわずかであるため、他のファイルシステムよりも高速である場合があります。</para>
   </section>
   <section xml:id="bgchzb1">
    <title>容易なアップグレード性</title>
    <para>Ext3は、Ext2のコードをベースとし、Ext2のオンディスクフォーマットとメタデータフォーマットも共用するので、Ext2からExt3へのアップグレードは非常に容易です。 </para>
   </section>
  </section>
  <section xml:id="sec-filesystems-major-ext3">
   <title>Ext3</title>
   <para>Ext3は、Stephen Tweedieによって設計されました。他のすべての次世代ファイルシステムとは異なり、Ext3は完全に新しい設計理念に基づいているわけではありません。Ext3は、Ext2をベースとしています。これら2つのファイルシステムは、非常に似ています。Ext3ファイルシステムを、Ext2ファイルシステムの上に構築することも容易です。Ext2とExt3の最も重要な違いは、Ext3がジャーナルをサポートしていることです。要約すると、Ext3には、次の3つの主要な利点があります。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzb3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzb4" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="sec-filesystems-major-ext22ext3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bgchzb3">
    <title>Ext2からの容易で信頼性の高いアップグレード</title>
    <para>Ext2のコードは、Ext3が次世代ファイルシステムであることを明確に主張するための強力な土台になりました。Ext3では、Ext2の信頼性および堅実性がExt3で採用されたジャーナルファイルシステムの利点とうまく統合されています。ReiserFSまたはXFSのような他のファイルシステムへの移行はかなり手間がかかります(ファイルシステム全体のバックアップを作成し、移行先ファイルシステムを新規に作成する必要があります)が、それとは異なり、Ext3への移行は数分で完了します。ファイルシステム全体を新たに作成し直しても、それが完璧に動作するとは限らないので、Ext3への移行は非常に安全でもあります。ジャーナルファイルシステムへのアップグレードを必要とする既存のExt2システムの数を考慮に入れると、多くのシステム管理者にとってExt3が重要な選択肢となり得る理由が容易にわかります。Ext3からExt2へのダウングレードも、アップグレードと同じほど容易です。Ext3ファイルシステムのアンマウントを正常に行い、Ext2ファイルシステムとして再マウントするだけです。 </para>
   </section>
   <section xml:id="bgchzb4">
    <title>信頼性とパフォーマンス</title>
    <para>他のジャーナルファイルシステムは、<quote>メタデータのみ</quote>のジャーナルアプローチに従っています。つまり、メタデータは常に一貫した状態に保持されますが、ファイルシステムのデータ自体については、一貫性が自動的に保証されるわけではありません。Ext3は、メタデータとデータの両方に注意するよう設計されています。<quote>注意</quote>の度合いはカスタマイズできます。Ext3の<option>data=journal</option>モードを有効にした場合、最大の保護(データの完全性)を実現しますが、メタデータとデータの両方がジャーナル化されるので、システムの動作が遅くなります。比較的新しいアプローチは、<option>data=ordered</option>モードを使用することです。これは、データとメタデータ両方の完全性を保証しますが、ジャーナルを適用するのはメタデータのみです。ファイルシステムドライバは、1つのメタデータの更新に対応するすべてのデータブロックを収集します。これらのブロックは、メタデータの更新前にディスクに書き込まれます。その結果、パフォーマンスを犠牲にすることなく、メタデータとデータの両方に関する一貫性を達成できます。3番目のオプションは、<option>data=writeback</option>を使用することです。これは、対応するメタデータをジャーナルにコミットした後で、データをメインファイルシステムに書き込むことを可能にします。多くの場合、このオプションは、パフォーマンスの点で最善と考えられています。しかし、内部のファイルシステムの完全性が維持される一方で、クラッシュと回復を実施した後では、古いデータがファイル内に再登場させてしまう可能性があります。Ext3では、デフォルトとして、<option>data=ordered</option>オプションを使用します。 </para>
   </section>
   <section xml:id="sec-filesystems-major-ext22ext3">
    <title>Ext2ファイルシステムからExt3への変換</title>
    <para>Ext2ファイルシステムをExt3に変換するには、次の手順に従います。</para>
    <procedure xml:id="bgchzb5">
     <step xml:id="bgchzb6">
      <para>Ext3ジャーナルの作成には、<command>tune2fs -j</command>を<systemitem>root</systemitem>ユーザとして実行します。 </para>
      <para>この結果、デフォルトのパラメータを使用してExt3ジャーナルが作成されます。</para>
      <para>ジャーナルのサイズおよびジャーナルを常駐させるデバイスを指定するには、<command>tune2fs</command> <option>-J</option>とともに適切なジャーナルオプション<option>size=</option>および<option>device=</option>を指定して、実行します。<command>tune2fs</command>プログラムの詳細については、<command>tune2fs</command>のマニュアルページを参照してください。</para>
     </step>
     <step xml:id="bgchzb7">
      <para>ファイル<filename>/etc/fstab</filename>を<systemitem>root</systemitem>ユーザとして編集して、該当するパーティションに指定されているファイルシステムタイプを<literal>ext2</literal>から<literal>ext3</literal>に変更し、その変更内容を保存します。</para>
      <para>これにより、Ext3ファイルシステムが認識されるようになります。この変更結果は、次回の再起動後に有効になります。</para>
     </step>
     <step xml:id="bgchzb8">
      <para>Ext3パーティションとしてセットアップされたルートファイルシステムをブートするには、<literal>ext3</literal>と<literal>jbd</literal>の各モジュールを<filename>initrd</filename>に組み込みます。</para>
      <substeps performance="required">
       <step xml:id="bi6z1gc">
        <para><filename>/etc/sysconfig/kernel</filename>を<systemitem>root</systemitem>として編集し、<literal>ext3</literal>および<literal>jbd</literal>を<envar>INITRD_MODULES</envar>変数に追加し、最後に変更内容を保存します。</para>
       </step>
       <step xml:id="bi6z1rw">
        <para><command>mkinitrd</command>コマンドを実行します。 </para>
        <para>これにより新規のinitrdがビルドされ、すぐに使用できます。</para>
       </step>
      </substeps>
     </step>
     <step xml:id="bi6z29v">
      <para>システムを再起動します。</para>
     </step>
    </procedure>
   </section>
   <section xml:id="sec-fileystems-major-ext3inodesize">
    <title>Ext3ファイルシステムのinodeサイズとinode数</title>
    <para>inodeには、ファイルシステム内のファイルとそのブロック位置に関する情報が格納されます。拡張した属性とACLのためのスペースをinode内に確保するため、Ext3のデフォルトのinodeサイズは、SLES 10での128バイトから、SLES 11では256バイトに拡大されました。SLES 10と比較して、SLES 11上でExt3ファイルシステムを作成する際、同数のinodeに対する事前割り当てされたデフォルトのスペースの量は2倍になり、ファイルシステム内のファイルに対して使用可能なスペースは、その分少なくなっています。したがって、同数のinodeとファイルを収容するのに、SLES 10上のExt3ファイルシステムの場合より大きなパーティションを使用する必要があります。</para>
    <para>新規のExt3ファイルシステムを作成する際、inodeテーブル内のスペースは、作成可能なinodeの総数に対して事前に割り当てられています。バイト数/inode数の比率と、ファイルシステムのサイズによって、inode数の上限が決まります。ファイルシステムが作成されると、バイト数/inode数のバイト数の各スペースに対して、1つのinodeが作成されます。</para>

<screen role="compact2">
number of inodes = total size of the file system divided by the number of bytes per inode
</screen>

    <para>inodeの数によって、ファイルシステム内に保有できるファイルの数が決まります。つまり、各ファイルにつき1つのinodeです。inodeサイズの増大と、利用可能なスペースの縮小に対応するため、バイト数/inode数の比率のデフォルトが、SLES 10での8192バイトから、SLES 11では16384バイトに増えています。この2倍に増えた比率により、作成可能なファイルの数は、SLES 10上のExt3ファイルシステムで可能だった数の半分となります。</para>
    <important>
     <para>inodeの割り当て後は、inodeサイズやバイト数/inode数の比率の設定を変えることはできません。異なる設定のファイルシステムを再度作成するか、ファイルシステムを拡張しない限り、新規のinodeは設定できません。inodeの最大数を超えると、ファイルをいくつか削除するまで、ファイルシステム上に新規のファイルを作成することはできません。</para>
    </important>
    <para>新規のExt3ファイルシステムを作成する際に、inodeのスペース使用をコントロールするためのinodeサイズとバイト数/inode数の比率、およびファイルシステム上のファイル数の上限を指定することができます。ブロックサイズ、inodeサイズ、およびバイト数/inode数の比率が指定されない場合は、<filename>/etc/mked2fs.conf</filename>ファイル内のデフォルト値が適用されます。詳細については、<filename>mke2fs.conf(5)</filename>マニュアルページを参照してください。</para>
    <para>次のガイドラインを使用します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b14jepus">
       <title>inodeサイズ</title>
       <para>デフォルトのinodeサイズは256バイトです。2の累乗で、ブロックサイズ以下の128以上のバイト数の値を指定します(128、256、512など)。Ext3ファイルシステムで拡張属性またはACLを使用しない場合は、128バイトのみを使用してください。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b14jeput">
       <title>バイト数/inode数の比率:</title>
       <para>デフォルトのバイト数/inode数の比率は、16384バイトです。有効なバイト数/inode数の比率は、2の累乗で1024バイト以上(1024、2048、4096、8192、16384、32768など)です。この値は、ファイルシステムのブロックサイズより小さくはできません。なぜなら、ブロックサイズは、データを格納するために使用するスペースの最小チャンクだからです。Ext3ファイルシステムのデフォルトのブロックサイズは、4 KBです。 </para>
      </formalpara>
      <para>また、格納する必要があるファイルの数とサイズを、検討する必要があります。たとえば、ファイルシステムに多数の小さなファイルを持つことになる場合は、バイト数/inode数の比率を小さめに指定すれば、inodeの数を増やすことができます。ファイルシステムに非常に大きなファイルを入れる場合は、バイト数/inode数の比率を大きめに指定できますが、それによって許容されるinodeの数は減ります。 </para>
      <para>一般的に、inodeの数は、足りなくなるよりは多すぎる方が得策です。inodeの数が少な過ぎてファイルも非常に小さい場合、実際には空であってもディスク上のファイルの最大数に到達してしまいます。inodeの数が多すぎて、ファイルが非常に大きい場合は、空き領域があることが表示されたとしても、それを使うことができません。なぜなら、inode用に確保されたスペースに新規のファイルを作成することはできないからです。</para>
     </listitem>
    </itemizedlist>
    <para>Ext3ファイルシステムで拡張属性またはACLを使用しない場合は、ファイルシステムの作成時に、inodeサイズとして128バイト、バイト数/inode数の比率として8192バイトを指定して、SLES 10の動作を復元することができます。inodeサイズとバイト数/inode数の比率を設定するには、次のいずれかの方法を使用します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b14irnj5">
       <title>すべての新規Ext3ファイルのデフォルト設定を変更する:</title>
       <para>テキストエディタで、<filename>/etc/mke2fs.conf</filename>ファイルの<literal>defaults</literal>セクションを変更して、<literal>inode_size</literal>および<literal>inode_ratio</literal>を、希望するデフォルト値に設定します。その値が、すべての新規のExt3ファイルシステムに適用されます。たとえば、</para>
      </formalpara>

<screen>
blocksize = 4096
inode_size = 128
inode_ratio = 8192
</screen>

     </listitem>
     <listitem>
      <formalpara xml:id="b14irnj6">
       <title>コマンドラインで:</title>
       <para>Ext3ファイルシステムを作成する際に、inodeサイズ(<literal>-I 128</literal>)およびバイト数/inode数の比率(<literal>-i 8192</literal>)を、<command>mkfs.ext3(8)</command>コマンドまたは<command>mke2fs(8)</command>コマンドに渡します。たとえば、次のコマンドのいずれかを使用します:</para>
      </formalpara>

<screen>
mkfs.ext3 -b 4096 -i 8092 -I 128 /dev/sda2

mke2fs -t ext3 -b 4096 -i 8192 -I 128 /dev/sda2
</screen>

     </listitem>
     <listitem>
      <formalpara xml:id="b12dp9td">
       <title>YaSTを使用したインストール時に:</title>
       <para>インストール時に新規のExt3ファイルシステムを作成する際に、inodeサイズとバイト数/inode数の比率を渡します。YaST<guimenu>フォーマット設定のオプション</guimenu>にある<guimenu>パーティションの編集</guimenu>ページで、<guimenu>パーティションのフォーマット</guimenu><guimenu>Ext3</guimenu>を選択して、<guimenu>オプション</guimenu>をクリックします。<guimenu>ファイルシステムオプション</guimenu>ダイアログボックスで、<guimenu>ブロックサイズ(バイト単位)</guimenu>、<guimenu>inodeごとのバイト数</guimenu>、および<guimenu>iノードのサイズ</guimenu>ドロップダウンリストから、希望の値を選択します。</para>
      </formalpara>
      <para>たとえば、<guimenu>ブロックサイズ(バイト単位)</guimenu>ドロップダウンリストから4096を選択し、<guimenu>ブロックサイズ(バイト単位)</guimenu>ドロップダウンリストから8192を選択し、<guimenu>iノードのサイズ</guimenu>ドロップダウンリストから128を選択して、<guimenu>OK</guimenu>をクリックします。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="ext3_inode_yast_a.png" width="305pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
     <listitem>
      <formalpara xml:id="b12dpiab">
       <title>autoyastを使用したインストール時に:</title>
       <para>autoyastのプロファイルで、<literal>fs_options</literal>タグを使用して、<literal>opt_bytes_per_inode</literal>の比率の値を、-iに対して8192に、<literal>opt_inode_density</literal>の値を-Iに対して128に設定することができます。</para>
      </formalpara>

<screen>
&lt;partitioning config:type="list"&gt;
    &lt;drive&gt;
      &lt;device&gt;/dev/sda&lt;/device&gt;
      &lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext3&lt;/filesystem&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;fs_options&gt;
            &lt;opt_bytes_per_inode&gt;
              &lt;option_str&gt;-i&lt;/option_str&gt;
              &lt;option_value&gt;8192&lt;/option_value&gt;
            &lt;/opt_bytes_per_inode&gt;
            &lt;opt_inode_density&gt;
              &lt;option_str&gt;-I&lt;/option_str&gt;
              &lt;option_value&gt;128&lt;/option_value&gt;
            &lt;/opt_inode_density&gt;
          &lt;/fs_options&gt;
          &lt;mount&gt;/&lt;/mount&gt;
          &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
          &lt;partition_type&gt;primary&lt;/partition_type&gt;
          &lt;size&gt;25G&lt;/size&gt;
        &lt;/partition&gt;
</screen>

     </listitem>
    </itemizedlist>
    <para>SLES11のExt3パーティションには、SLES10で格納できるファイルの50%しか格納することができません。詳細については、<link xlink:href="http://www.novell.com/support/kb/doc.php?id=7009075"><citetitle>を参照してください。</citetitle>[技術情報文書7009075]</link></para>
   </section>
  </section>
  <section xml:id="sec-filesystems-major-reiser">
   <title>ReiserFS</title>
   <para>2.4カーネルリリースから公式に主要機能として採用されたReiserFSは、SUSE 6.4以降、2.2.x SUSEカーネルのカーネルパッチとして利用可能となりました。ReiserFSは、Hans ReiserとNamesys開発チームにより設計されました。ReiserFSは、Ext2に代わる強力な選択肢であることを実証してきました。ReiserFSの主要な利点としては、効率的なディスクスペース使用率、より良いディスクアクセスパフォーマンス、より高速なクラッシュリカバリ、およびデータジャーナリングの使用による信頼性の向上があります。</para>
   <important>
    <para>ReiserFSファイルシステムは、特にマイグレーション用として、SUSE Linux Enterprise Server 11のライフタイムの間、完全にサポートされます。SUSEでは、SUSE Linux Enterprise Server 12から、新しいReiserFSファイルシステムの作成をサポートしない予定です。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzav" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzaw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzax" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzay" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bgchzav">
    <title>より良いディスクスペース使用効率</title>
    <para>ReiserFSでは、すべてのデータが、B*-Tree(バランスドツリー)と呼ばれる構造で編成されています。このツリー構造は、より良いディスクスペース使用効率に貢献しています。小さなファイルは、B*-Treeのリーフノードに直接格納されるからです。そのようなファイルをどこか他の場所に格納して、ディスク上の実際の場所を指すポインタを維持するより優れています。それに加えて、ストレージ(記憶領域)は 1KBまたは 4KBのチャンク単位で割り当てられるのではなく、実際に必要なサイズの構成部分(エクステント)を割り当てられます。もう1つの利点は、inodeの動的割り当てに関係しています。これは、ファイルシステムの作成時にinodeの密度を指定する必要のある、Ext2のような従来のファイルシステムに比べて、ファイルシステムの柔軟性を高めます。 </para>
   </section>
   <section xml:id="bgchzaw">
    <title>より良いディスクアクセスパフォーマンス</title>
    <para>小規模なファイルでは、多くの場合、ファイルのデータと<quote>stat_data</quote> (inode)情報が互いに隣り合って保存されます。これらは1回のディスクI/O操作で読み取れるので、1回のディスクアクセスで、必要な情報すべてを取得できることを意味します。 </para>
   </section>
   <section xml:id="bgchzax">
    <title>高速なクラッシュ回復機能</title>
    <para>ジャーナルを使用して、メタデータに加えられた最新の変更結果を記録しているので、ファイルシステムが大規模な場合を含め、ファイルシステムを数秒でチェックできます。 </para>
   </section>
   <section xml:id="bgchzay">
    <title>データジャーナリングによる信頼性</title>
    <para>ReiserFSは、<xref linkend="sec-filesystems-major-ext3" xrefstyle="HeadingOnPage"/>に概略されているコンセプトに類似のデータジャーナリングおよびオーダードモードもサポートしています。デフォルトのモードは、<literal>data=ordered</literal>です。このモードでは、データとメタデータの完全性は保証されますが、メタデータのジャーナリングだけが行われます。 </para>
   </section>
  </section>
  <section xml:id="sec-filesystems-major-xfs">
   <title>XFS</title>
   <para>本来は、IRIX OS用のファイルシステムを意図してSGIがXFSの開発を開始したのは、1990年代初期です。XFSの開発動機は、ハイパフォーマンスの64ビットジャーナルファイルシステムの作成により、非常に厳しいコンピューティングの課題に対応することでした。XFSは大規模なファイルを操作する点で非常に優れていて、ハイエンドのハードウェアを適切に活用します。しかし、XFSには1つの欠点があります。ReiserFSの場合と同様、XFSではメタデータの完全性は重視されていますが、データの完全性はそれほどではありません。</para>
   <para>ただし、XFSの主要機能を一見すれば、XFSが、ハイエンドコンピューティングの分野で、他のジャーナリングファイルシステムの強力な競合相手となっている理由がわかります。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzba" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzbb" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzbc" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bgchzba">
    <title>アロケーショングループの採用による高いスケーラビリティ</title>
    <para>XFSファイルシステムの作成時に、ファイルシステムの基にあるブロックデバイスは、等しいサイズをもつ8つ以上の線形の領域に分割されます。これらを「<emphasis>アロケーショングループ</emphasis>」と呼びます。各アロケーショングループは、独自のinodeと空きディスクスペースを管理します。実用的には、アロケーショングループを、1つのファイルシステムの中にある複数のファイルシステムと見なすこともできます。アロケーショングループは互いに独立しているものではないため、複数のアロケーショングループをカーネルから同時にアドレス指定できるという特徴があります。この機能は、XFSの高いスケーラビリティに大きく貢献しています。独立性の高いアロケーショングループは、性質上、マルチプロセッサシステムのニーズに適しています。 </para>
   </section>
   <section xml:id="bgchzbb">
    <title>ディスクスペースの効率的な管理によるハイパフォーマンス</title>
    <para>空きスペースとinodeは、各アロケーショングループ内のB<superscript>+</superscript>-Treeによって処理されます。B<superscript>+</superscript>ツリーの採用は、XFSのパフォーマンスとスケーラビリティを大きく向上させています。XFSでは、プロセスを2分割して割り当てを処理する<emphasis>遅延割り当て</emphasis>を使用します。保留されているトランザクションはRAMの中に保存され、適切な量のスペースが確保されます。XFSは、この時点では、データを正確にはどこに(ファイルシステムのどのブロックに)格納するか決定していません。決定可能な最後の瞬間まで、この決定は遅延(先送り)されます。暫定的に使用される一時データは、ディスクに書き込まれません。XFSがデータの実際の保存場所を決定するまでに、その役割を終えているからです。このように、XFSは、書き込みのパフォーマンスを向上させ、ファイルシステムのフラグメンテーションを減少させます。遅延アロケーションは、他のファイルシステムより書き込みイベントの頻度を下げる結果をもたらすので、書き込み中にクラッシュが発生した場合、データ損失が深刻になる可能性が高くなります。 </para>
   </section>
   <section xml:id="bgchzbc">
    <title>事前割り当てによるファイルシステムの断片化の回避</title>
    <para>データをファイルシステムに書き込む前に、XFSはファイルが必要とする空きスペースを<emphasis>予約</emphasis>(プリアロケート、事前割り当て)します。したがって、ファイルシステムの断片化は大幅に減少します。ファイルの内容がファイルシステム全体に分散することがないので、パフォーマンスが向上します。 </para>
   </section>
  </section>
  <section xml:id="bwkryet">
   <title>ファイルシステムの機能比較</title>
   <para>SUSE Linux Enterprise Serverにおける主要オペレーティングシステムの機能の対照比較については、<link xlink:href="http://www.suse.com/products/server/technical-information/#FileSystem">ファイルシステムのサポートおよびサイズ</link>(<link xlink:href="http://www.suse.com/products/server/technical-information/">SUSE Linux Enterprise Server技術情報のWebサイト</link>に記載)を参照してください。</para>
  </section>
 </section>
 <section xml:id="sec-filesystems-add">
  <title>サポートされている他のファイルシステム</title>
  <para role="intro"><xref linkend="tab-dateisysteme" xrefstyle="TableXRef"/>は、Linuxがサポートしている他のいくつかのファイルシステムを要約したものです。これらは主に、他の種類のメディアや外部オペレーティングシステムとの互換性およびデータの相互交換を保証することを目的としてサポートされています。</para>
  <table xml:id="tab-dateisysteme">
   <title>Linux環境でのファイルシステムのタイプ</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="2381*"/>
   <colspec colnum="2" colname="2" colwidth="7620*"/>
    <thead>
     <row><!--id=bi6z95b-->
      <entry>
       <para>ファイルシステムのタイプ</para>
      </entry>
      <entry>
       <para>説明</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row><!--id=bwk81ba-->
      <entry>
       <para><systemitem>cramfs</systemitem></para>
      </entry>
      <entry>
       <para>Compressed ROM file system (圧縮ROMファイルシステム): ROM用の圧縮された読み込み専用ファイルシステムです。</para>
      </entry>
     </row>
     <row><!--id=bwk81bb-->
      <entry>
       <para><systemitem>hpfs</systemitem></para>
      </entry>
      <entry>
       <para>High Performance File System（ハイパフォーマンスファイルシステム） ：IBM OS/2の標準ファイルシステム。読み取り専用モードでのみサポートされます。</para>
      </entry>
     </row>
     <row><!--id=bwk81bc-->
      <entry>
       <para><systemitem>iso9660</systemitem></para>
      </entry>
      <entry>
       <para>CD-ROMの標準ファイルシステム。</para>
      </entry>
     </row>
     <row><!--id=bwk81bd-->
      <entry>
       <para><systemitem>minix</systemitem></para>
      </entry>
      <entry>
       <para>このファイルシステムは、オペレーティングシステムに関する学術的なプロジェクトを起源とするもので、Linuxで最初に使用されたファイルシステムです。現在では、フロッピーディスク用のファイルシステムとして使用されています。</para>
      </entry>
     </row>
     <row><!--id=bwk81be-->
      <entry>
       <para><systemitem>msdos</systemitem></para>
      </entry>
      <entry>
       <para><filename>fat</filename>、つまり当初はDOSで使用されていたファイルシステムであり、現在はさまざまなオペレーティングシステムで使用されています。</para>
      </entry>
     </row>
     
     
     <row><!--id=bwk81bg-->
      <entry>
       <para><systemitem>nfs</systemitem></para>
      </entry>
      <entry>
       <para>Network File System (ネットワークファイルシステム) ：ネットワーク内の任意のコンピュータにデータを格納でき、ネットワーク経由でアクセスを付与できます。</para>
      </entry>
     </row>
     <row><!--id=bwk81bh-->
      <entry>
       <para><systemitem>ntfs</systemitem></para>
      </entry>
      <entry>
       <para>Windows NT file system (NTファイルシステム) ：読み取り専用です。</para>
      </entry>
     </row>
     <row><!--id=bwk81bi-->
      <entry>
       <para><systemitem>smbfs</systemitem></para>
      </entry>
      <entry>
       <para>Server Message Block (サーバメッセージブロック): Windowsのような製品が、ネットワーク経由でのファイルアクセスを可能にする目的で採用しています。</para>
      </entry>
     </row>
     <row><!--id=bwk81bj-->
      <entry>
       <para><systemitem>sysv</systemitem></para>
      </entry>
      <entry>
       <para>SCO UNIX、Xenix、およびCoherent (PC用の商用UNIXシステム)が採用。</para>
      </entry>
     </row>
     <row><!--id=bwk81bk-->
      <entry>
       <para><systemitem>ufs</systemitem></para>
      </entry>
      <entry>
       <para>BSD、SunOS、およびNextStepで使用されています。読み取り専用モードでサポートされています。</para>
      </entry>
     </row>
     <row><!--id=bwk81bl-->
      <entry>
       <para><systemitem>umsdos</systemitem></para>
      </entry>
      <entry>
       <para>UNIX on MS-DOS(MS-DOS上のUNIX) ：標準<filename>fat</filename>ファイルシステムに適用され、特別なファイルを作成することにより、UNIX機能(パーミッション、リンク、長いファイル名)を実現します。</para>
      </entry>
     </row>
     <row><!--id=bwk81bm-->
      <entry>
       <para><systemitem>vfat</systemitem></para>
      </entry>
      <entry>
       <para>Virtual FAT:<literal>fat</literal>ファイルシステムを拡張したものです(長いファイル名をサポートします)。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </section>
 <section xml:id="sec-filesystems-lfs">
  <title>Linux環境での大規模ファイルサポート</title>
  <para>当初、Linuxは、最大ファイルサイズとして 2GiB (2<superscript>31</superscript>バイト)をサポートしていました。また、ファイルシステムに大規模ファイルサポートが付いていない限り、32ビットシステム上での最大ファイルサイズは2GiBです。 </para>
  <para>現在、弊社のすべての標準ファイルシステムでは、LFS (大規模ファイルサポート)を提供しています。LFSは、理論的には、2<superscript>63</superscript>バイトの最大ファイルサイズをサポートします。<xref linkend="tab-maxsize" xrefstyle="TableXRef"/>では、Linuxのファイルとファイルシステムの、現行のオンディスクフォーマットの制限事項を概説しています。表内の数字は、ファイルシステムで使用しているブロックサイズが、共通規格である4KiBであることを前提としています。異なるブロックサイズを使用すると結果は異なります。スパースブロックを使用している場合、<xref linkend="tab-maxsize" xrefstyle="TableXRef"/>に記載の最大ファイルサイズは、ファイルシステムの実際のサイズより大きいことがあります。 </para>
  <note>
   <para>このマニュアルでの換算式: 1024バイト = 1KiB、1024KiB  = 1MiB、1024MiB  = 1GiB、1024GiB = 1TiB、1024TiB = 1PiB、1024PiB = 1EiB（「<link xlink:href="http://physics.nist.gov/cuu/Units/binary.html"><citetitle>NIST: Prefixes for Binary Multiples</citetitle></link>」も参照してください)。</para>
  </note>
  <table xml:id="tab-maxsize">
   <title>ファイルおよびファイルシステムの最大サイズ(オンディスクフォーマット、4KiBブロックサイズ)</title>
   <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="3334*"/>
   <colspec colnum="2" colname="2" colwidth="3334*"/>
   <colspec colnum="3" colname="3" colwidth="3334*"/>
    <thead>
     <row><!--id=b12r1f2q-->
      <entry>
       <para>ファイルシステム(4KiBブロックサイズ)</para>
      </entry>
      <entry>
       <para>ファイルシステムの最大サイズ</para>
      </entry>
      <entry>
       <para>ファイルの最大サイズ</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row><!--id=b12r1f2r-->
      <entry>
       <para>Btrfs</para>
      </entry>
      <entry>
       <para>16EiB</para>
      </entry>
      <entry>
       <para>16EiB</para>
      </entry>
     </row>
     <row><!--id=b12r1f2s-->
      <entry>
       <para>Ext3</para>
      </entry>
      <entry>
       <para>16TiB</para>
      </entry>
      <entry>
       <para>2TiB</para>
      </entry>
     </row>
     <row><!--id=b12r1f2t-->
      <entry>
       <para>OCFS2 (High Availability Extensionで使用可能な、クラスタ認識のファイルシステム)</para>
      </entry>
      <entry>
       <para>16TiB</para>
      </entry>
      <entry>
       <para>1EiB</para>
      </entry>
     </row>
     <row><!--id=b12r1f2u-->
      <entry>
       <para>ReiserFS v3.6</para>
      </entry>
      <entry>
       <para>16TiB</para>
      </entry>
      <entry>
       <para>1EiB</para>
      </entry>
     </row>
     <row><!--id=b12r1f2v-->
      <entry>
       <para>XFS</para>
      </entry>
      <entry>
       <para>8EiB</para>
      </entry>
      <entry>
       <para>8EiB</para>
      </entry>
     </row>
     <row><!--id=b12r1f2w-->
      <entry>
       <para>NFSv2 (クライアント側)</para>
      </entry>
      <entry>
       <para>8EiB</para>
      </entry>
      <entry>
       <para>2GiB</para>
      </entry>
     </row>
     <row><!--id=b12r1f2x-->
      <entry>
       <para>NFSv3 (クライアント側)</para>
      </entry>
      <entry>
       <para>8EiB</para>
      </entry>
      <entry>
       <para>8EiB</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
  <important>
   <para><xref linkend="tab-maxsize" xrefstyle="TableXRef"/>は、ディスクフォーマット時の制限について説明しています。Linuxカーネルは、操作するファイルとファイルシステムのサイズについて、独自の制限を課しています。管理の初期設定には、次のオプションがあります。 </para>
   <variablelist>
    <varlistentry xml:id="bgchzc6">
     <term>ファイルサイズ</term>
     <listitem>
      <para>32ビットシステムでは、ファイルサイズが2TiB (2<superscript>41</superscript>バイト)を超えることはできません。 </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bgchzc7">
     <term>ファイルシステムのサイズ</term>
     <listitem>
      <para>ファイルシステムのサイズは、最大2<superscript>73</superscript>バイトまで可能です。しかし、この制限は、現在使用可能なハードウェアが到達可能な範囲を上回っています。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </important>
 </section>
 <section xml:id="sect-stor-limits">
  <title>Linuxのカーネルにおけるストレージの制限</title>
  <para><xref linkend="b12o27j6" xrefstyle="TableXRef"/>は、SUSE Linux Enterprise 11 Service Pack 3に関連したストレージに関するカーネルの制限をまとめています。 </para>
  <table xml:id="b12o27j6">
   <title>ストレージの制限</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="5001*"/>
   <colspec colnum="2" colname="2" colwidth="5001*"/>
    <thead>
     <row><!--id=b12o27j7-->
      <entry>
       <para>ストレージの機能</para>
      </entry>
      <entry>
       <para>制限</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row><!--id=b12o27j8-->
      <entry>
       <para>サポートされるLUNの最大数</para>
      </entry>
      <entry>
       <para>ターゲットあたり16384 LUN。</para>
      </entry>
     </row>
     <row><!--id=b12o27j9-->
      <entry>
       <para>単一LUNあたりのパスの最大数</para>
      </entry>
      <entry>
       <para>それ自体は無制限。それぞれのパスが、通常のLUNとして扱われます。</para>
       <para>実際の制限は、ターゲットあたりのLUNの数と、HBAあたりのターゲットの数(ファイバチャネルHBAの場合は16777215)により決まります。</para>
      </entry>
     </row>
     <row><!--id=b12o27ja-->
      <entry>
       <para>HBAの最大数</para>
      </entry>
      <entry>
       <para>無制限. 実際の制限は、システムのPCIスロットの量で決まります。</para>
      </entry>
     </row>
     <row><!--id=b12o27jb-->
      <entry>
       <para>オペレーティングシステムあたりの、デバイスマッパーマルチパス付きパスの最大数(合計)</para>
      </entry>
      <entry>
       <para>約1024。実際の数は、デバイス番号文字列の長さによります。これはマルチパスツール内のコンパイル時間によって変わり、この制限が問題となる場合は、引き上げることもできます。 </para>
      </entry>
     </row>
     <row><!--id=b12r1mnq-->
      <entry>
       <para>最大サイズ(ブロックデバイスごと)</para>
      </entry>
      <entry>
       <para>X86では、最大16TiB。</para>
       <para>x86_64、ia64、s390x、およびppc64では、最大8 EiB。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </section>
 <section xml:id="bwkbhpd">
  <title>YaST パーティショナによるデバイスの管理</title>
  <para>YaST パーティションを使用すると、ファイルシステムとRAIDデバイスを作成し、管理できます。『<link xlink:href="http://www.suse.com/documentation/sles11/book_sle_deployment/data/cha_advdisk.html"><quote>SUSE Linux Enterprise Server 11 SP3導入ガイド</quote></link>』の<link xlink:href="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html"><citetitle>「高度なディスクセットアップ」</citetitle></link>を参照してください。</para>
 </section>
 <section xml:id="sec-filesystems-info">
  <title>追加情報</title>
  <para>ここまでに説明した各ファイルシステムのプロジェクトには、独自のWebページがあります。そこで詳しいドキュメントとFAQ、さらにメーリングリストを参照することができます。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><link xlink:href="http://e2fsprogs.sourceforge.net/"><citetitle>E2fsprogs: Ext2/3/4 File System Utilities</citetitle></link></para>
   </listitem>
   <listitem>
    <para><link xlink:href="http://www.ibm.com/developerworks/linux/library/l-fs7/"><citetitle>Introducing Ext3</citetitle></link></para>
   </listitem>
   <listitem>
    <para><link xlink:href="http://oss.sgi.com/projects/xfs/"><citetitle>XFS: A High-Performance Journaling Filesytem</citetitle></link></para>
   </listitem>
   <listitem>
    <para><link xlink:href="http://oss.oracle.com/projects/ocfs2/"><citetitle>OCFS2 Project</citetitle></link></para>
   </listitem>
  </itemizedlist><?dbfo-need height="20em"?>


  <para>Linuxファイルシステムの総合的なマルチパートチュートリアルは、「<link xlink:href="https://www.ibm.com/developerworks/linux/library/l-fs/"><citetitle>Advanced File System Implementor’s Guide</citetitle></link>」にあるIBM developerWorksで見つけることができます。 </para>
  <para>ファイルシステム(Linuxファイルシステムに限らない)の詳しい比較については、「<link xlink:href="http://en.wikipedia.org/wiki/Comparison_of_file_systems#Comparison"><citetitle>ファイルシステム</citetitle>」のWikipediaプロジェクトを参照してください。</link> </para>
 </section>
</chapter>

<chapter xml:id="storwhatsnew" xml:lang="ja" xml:base="01_whatsnew.xml"><title>SLES 11のストレージの新機能</title><info/>
 
 <para>SUSE Linux Enterprise Server 11では、ここで示すように機能と動作が変更されました。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="new-sles11sp3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkb7my" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndgyod" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndgyoe" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="new-sles11sp3">
  <title>SLES 11 SP3の新機能</title>
  <para>SUSE Linux Enterprise Server 11 SP3リリースでは、バグの修正に加えて、この項に示すように機能と動作が変更されました。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b15ds08f" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08d" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08c" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08e" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b15ds08f">
   <title>Btrfsクォータ</title>
   <para><systemitem>root</systemitem>ファイルシステムでのサブボリュームに対するBtrfsクォータのサポートは、<command>btrfs(8)</command>コマンド内に追加されています。</para>
  </section>
  <section xml:id="b15ds08d">
   <title>iSCSI LIOターゲットサーバ</title>
   <para>YaSTが、iSCSI LIOターゲットサーバソフトウェアをサポートします。詳細については、<xref linkend="cha-iscsi-lio" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
  </section>
  <section xml:id="b15ds08c">
   <title>LinuxのソフトウェアRAID</title>
   <para>LinuxのソフトウェアRAIDには、次の機能強化が追加されました。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jy5sx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy5sy" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy5sz" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="b15jy5sx">
    <title>Intel RSTe+のサポート</title>
    <para>ソフトウェアRAIDでは、RAIDレベル0、1、4、5、6、10をサポートするようにIntel RSTe+ (Rapid Storage Technology Enterprise)プラットフォームが改善されました。</para>
   </section>
   <section xml:id="b15jy5sy">
    <title>LEDMONユーティリティ</title>
    <para>LEDMONユーティリティが、MDのソフトウェアRAID用のPCIe-SSDエンクロージャLEDをサポートします。詳細については、<xref linkend="cha-raids-lee" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
   </section>
   <section xml:id="b15jy5sz">
    <title>ソフトウェアRAIDにおけるデバイスの順番</title>
    <para>YaSTパーティショナ内の<guimenu>RAIDの追加</guimenu>ウィザードで、<guimenu>分類</guimenu>オプションによって、LinuxのソフトウェアRAID内の選択したデバイスが使用される順番を指定して、アレイの半分が1つのディスクサブシステム上に置かれ、アレイのもう半分が別のディスクサブシステム上に確実に置かれるようにすることが可能になりました。たとえば、1つのディスクサブシステムに障害が発生した場合、システムは2番目のディスクサブシステムから稼働し続けます。詳細については、<xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/>の<xref linkend="b14dtk77" xrefstyle="StepXRef"/>を参照してください。</para>
   </section>
  </section>
  <section xml:id="b15ds08g">
   <title>LVM2</title>
   <para>LVM2には、次の機能強化が追加されました。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jy33d" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy33e" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="b15jy33d">
    <title>シンプールおよびシンボリューム</title>
    <para>LVMの論理ボリュームは、シンプロビジョニングできます。詳細については、<xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b15jy6mq">
       <title>シンプール:</title>
       <para>この論理ボリュームは、シンボリューム用に予約された領域のプールです。シンボリュームでは、必要な領域をそのプールからオンデマンドで割り当てることができます。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b15jy6mr">
       <title>シンボリューム:</title>
       <para>ボリュームは疎ボリュームとして作成されます。このボリュームでは、必要な領域はシンプールからオンデマンドで割り当てられます。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </section>
   <section xml:id="b15jy33e">
    <title>シンスナップショット</title>
    <para>LVM論理ボリュームスナップショットは、シンプロビジョニングできます。サイズを指定しないでスナップショットを作成した場合は、シンプロビジョニングと想定されます。詳細については、<xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </section>
  </section>
  <section xml:id="b15ds08e">
   <title>マルチパスI/O</title>
   <para>マルチパスI/Oには、次の変更と機能強化が加えられました。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jxva2" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jxva1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jxva0" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="b15jxva2">
    <title>mpathpersist(8)</title>
    <para><command>mpathpersist(8)</command>は新しいユーティリティです。このユーティリティを使用して、デバイスマッパーマルチパスのデバイスでSCSIの永続的な予約を管理できます。詳細については、<xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </section>
   <section xml:id="b15jxva1">
    <title>multipath(8)</title>
    <para><command>multipath(8)</command>コマンドには、次の機能強化が追加されました。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para><literal>-r</literal>オプションを使用すると、デバイスマップのリロードを強制できます。</para>
     </listitem>
    </itemizedlist>
   </section>
   <section xml:id="b15jxva0">
    <title>/etc/multipath.conf</title>
    <para>Device Mapper - このマルチパスツールでは、<filename>/etc/multipath.conf</filename>ファイルに次の機能強化が追加されました。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b15jxy6m" role="intro">
       <title>udev_dir</title>
       <para/>
      </formalpara>
      <para><literal>udev_dir</literal>属性は廃止予定です。SLES 11 SP3にアップグレードした後は、<filename>/etc/multipath.conf</filename>ファイルの<literal>defaults</literal>セクションから次の行を削除できます。</para>

<screen>
udev_dir /dev
</screen>

     </listitem>
     <listitem>
      <formalpara xml:id="b15jxy6n" role="intro">
       <title>getuid_callout</title>
       <para/>
      </formalpara>
      <para><filename>/etc/multipath.conf</filename>ファイルの<literal>defaults</literal>セクションにある<literal>getuid_callout</literal>属性は廃止予定なので、<literal>uid_attribute</literal>パラメータに置き換えられました。このパラメータは、固有のパス識別子を提供するudev属性です。デフォルト値は<literal>ID_SERIAL</literal>です。</para>
      <para>SLES 11 SP3にアップグレードした後は、<filename>/etc/multipath.conf</filename>ファイルの<literal>defaults</literal>セクションで属性を変更できます。 </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para><literal>defaults</literal>セクションから次の行を削除してください。</para>

<screen>
  getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

       </listitem>
       <listitem>
        <para><literal>defaults</literal>セクションに次の行を追加します。</para>

<screen>
  uid_attribute "ID_SERIAL"
</screen>

       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <formalpara xml:id="b15jxy6o" role="intro">
       <title>path_selector</title>
       <para/>
      </formalpara>
      <para><filename>/etc/multipath.conf</filename>ファイルの<literal>defaults</literal>セクションで、<literal>path_selector</literal>属性のデフォルト値が「<literal>round-robin 0</literal>」から「<literal>service-time 0</literal>」に変更されました。<literal>service-time</literal>オプションは、このパスに残っているI/Oの量とその相対スループットに基づいて次のI/Oセットへのパスを選択します。 </para>
      <para>SLES 11 SP3にアップグレードした後は、<filename>/etc/multipath.conf</filename>ファイルの<literal>defaults</literal>セクションにある属性値を変更して、推奨されるデフォルトを使用できます。 </para>

<screen>
  path_selector "service-time 0"
</screen>

     </listitem>
     <listitem>
      <formalpara xml:id="b15jxy6p" role="intro">
       <title>user_friendly_names</title>
       <para/>
      </formalpara>
      <para><literal>user_friendly_names</literal>属性は、<literal>devices</literal>セクションおよび<literal>multipaths</literal>セクションで設定できます。</para>
     </listitem>
     <listitem>
      <formalpara xml:id="b15jxy6q" role="intro">
       <title>max_fds</title>
       <para/>
      </formalpara>
      <para role="intro"><literal>max_fds</literal>属性のデフォルト設定が、<literal>max</literal>に変更されました。これにより、マルチパスデーモンでのパスの監視時に、ファイル記述子をシステムで許可される数だけ開くことができます。 </para>
      <para role="intro">SLES 11 SP3にアップグレードした後は、<filename>/etc/multipath.conf</filename>ファイルの属性値を変更できます。 </para>

<screen>
max_fds "max"
</screen>

     </listitem>
     <listitem>
      <formalpara xml:id="b15jxy6r" role="intro">
       <title>reservation_key</title>
       <para/>
      </formalpara>
      <para role="intro"><filename>/etc/multipath.conf</filename>ファイルの<literal>defaults</literal>セクションまたは<literal>multipaths</literal>セクションでは、<literal>reservation_key</literal>属性を使用して、サービスアクション予約キーを割り当てることができます。この予約キーを<command>mpathpersist(8)</command>ユーティリティで使用することにより、デバイスマッパーマルチパスのデバイスの永続的な予約が管理可能になります。この属性はデフォルトでは使用されません。この属性が設定されていない場合、<command>multipathd</command>デーモンは、新しく検出されたパスまたは復元されたパスの永続的な予約があるかどうかを確認しません。 </para>

<screen>
reservation_key &lt;<replaceable>reservation key</replaceable>&gt;
</screen>

      <para>次に例を示します。</para>

<screen>
multipaths {
        multipath {
                          wwid   XXXXXXXXXXXXXXXX
                         alias      yellow
                         reservation_key  0x123abc
      }
}
</screen>

      <para> 永続的な予約の設定の詳細については、<xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
     </listitem>
     <listitem>
      <formalpara xml:id="b15jxy6s" role="intro">
       <title>hardware_handler</title>
       <para/>
      </formalpara>
      <para>DMマルチパスで使用できる、次の4つのSCSIハードウェアハンドラがSCSI層に追加されました。 </para>
      <simplelist>
       <member><filename>scsi_dh_alua</filename> </member> <member><filename>scsi_dh_rdac</filename> </member> <member><literal>scsi_dh_hp_sw</literal> </member> <member><literal>scsi_dh_emc</literal> </member>
      </simplelist>
      <para>これらのハンドラは、LinuxカーネルのSCSIディレクトリに作成されるモジュールです。これまでは、デバイスマッパー層のハードウェアハンドラを使用していました。</para>
      <para>これらのモジュールを<filename>initrd</filename>イメージに追加してから、<filename>/etc/multipath.conf</filename>ファイルでハードウェアハンドラタイプ<literal>alua</literal>、<literal>rdac</literal>、<literal>hp_sw</literal>、および<literal>emc</literal>として指定します。デバイスドライバを<filename>initrd</filename>イメージに追加する方法については、<xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
     </listitem>
    </itemizedlist>
   </section>
  </section>
 </section>
 <section xml:id="bwkb7my">
  <title>SLES 11 SP2の新機能</title>
  <para>SUSE Linux Enterprise Server 11 SP2リリースでは、バグの修正に加えて、この項に示すように機能と動作が変更されました。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>Btrfsファイルシステム。<xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </listitem>
   <listitem>
    <para>Open Fibre Channel over Ethernet<xref linkend="cha-fcoe" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
   </listitem>
   <listitem>
    <para>LVMストレージオブジェクトのタグ付け<xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </listitem>
   <listitem>
    <para>NFSv4 ACLのツール<xref linkend="nfsv4acls" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
   </listitem>
   <listitem>
    <para><command>mdadm resize</command>コマンドの<command>--assume-clean</command>オプション<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </listitem>
   <listitem>
    <para><filename>/etc/multipath.conf</filename>ファイルの<literal>defaults</literal>セクションにある<literal>default_getuid</literal>パラメータは廃止されたので、<literal>getuid_callout</literal>パラメータに置き換えられました。</para>
    <para>このパラメータの行は、</para>

<screen>
  default_getuid "/sbin/scsi_id -g -u -s /block/%n"
</screen>

    <para>次のように変更されました。</para>

<screen>
  getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="bndgyod">
  <title>SLES 11 SP1の新機能</title>
  <para>SUSE Linux Enterprise Server 11 SP1リリースでは、バグの修正に加えて、この項に示すように機能と動作が変更されました。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bnmqoyw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmr1a1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmqre5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmti6z" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtvr8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmrccr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmrfnk" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtwna" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmss2g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmszsy" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtqql" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bnmqoyw">
   <title>iSCSIターゲット情報の保存</title> 
   <para><guimenu>YaST</guimenu><guimenu>ネットワークサービス</guimenu><guimenu>iSCSIターゲット</guimenu> (<xref linkend="sec-inst-system-iscsi-target-yast"/>)機能に、<guimenu>保存</guimenu>オプションが追加され、iSCSIターゲット情報をエクスポートできるようになりました。これにより、リソースの利用者に情報を提供することが容易になりました。</para>
  </section>
  <section xml:id="bnmr1a1">
   <title>iSCSIイニシエータの認証パラメータの変更</title> 
   <para><guimenu>YaST</guimenu><guimenu>ネットワークサービス</guimenu><guimenu>iSCSI イニシエータ</guimenu> (<xref linkend="sec-inst-system-iscsi-target-yast"/>)機能で、ターゲットデバイスに接続するための認証パラメータを変更できます。以前は、認証情報を変更するには、エントリを削除して再作成する必要がありました。</para>
  </section>
  <section xml:id="bnmqre5">
   <title> MPIOデバイスの永続的な予約を許可</title> 
   <para>SCSIイニシエータは共有ストレージデバイス用にSCSI予約を発行することで、他のサーバのSCSIイニシエータがそのデバイスにアクセスできないようにします。この予約は、SCSI例外処理プロセスの一環として発生するSCSIリセット後も有効です。</para>
   <para>次は、SCSI予約が役立つ可能性があるシナリオの例です。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para> 単純なSAN環境では、永続的なSCSI予約により、あるサーバで使用中のLUNを別のサーバに追加してしまうといった管理者エラーを回避することができます。このエラーが発生すると、データが破壊される可能性があります。この種のエラーを防ぐには、通常SANゾーニングが使用されます。 </para>
    </listitem>
    <listitem>
     <para>フェールオーバーが設定された高可用性環境では、永続的なSCSI予約によって、他のサーバに予約されているSCSIデバイスに間違ったサーバが接続するのを防ぐことができます。</para>
    </listitem>
   </itemizedlist>
  </section>
  <section xml:id="bnmti6z">
   <title>MDADM 3.0.2</title> 
   <para>バグ修正と改良を利用するには、MDADM (Multiple Devices Administration)ユーティリティ(<command>mdadm</command>)の最新バージョンを使用します。</para>
  </section>
  <section xml:id="bnmtvr8">
   <title>MDRAID外部メタデータ用ブートローダサポート</title> 
   <para>MDADMユーティリティバージョン3.0の外部メタデータ機能を使用して、Intel Matrix Storage Technologyメタデータ形式で定義されたRAIDボリュームからオペレーティングシステムをインストールおよび実行するためのサポートが追加されました。これによって、DMRAID (Device Mapper RAID)インフラストラクチャから、MDRAID (Multiple Devices RAID)インフラストラクチャに機能が移動します。その結果、RAID 5実装がより成熟し、MDカーネルインフラストラクチャの機能セットがより広範になります。このため、Intel、DDF (一般的なRAIDディスクデータフォーマット)、およびネイティブMDのメタデータを含むすべてのメタデータフォーマットで共通のRAIDドライバを使用することができます。</para>
  </section>
  <section xml:id="bnmrccr">
   <title>MDRAID外部メタデータ用のYaSTのインストールとブートサポート</title> 
   <para> YaSTインストーラツールでは、RAID 0、1、10、5、および6用MDRAID外部メタデータのサポートが追加されました。インストーラは、RAIDアレイ、およびプラットフォームのRAID機能が有効かどうかを検出することができます。Intel Matrix Storage Manager用のプラットフォームBIOSでマルチパスのRAIDが有効になっていると、「DMRAID」、「MDRAID」(推奨)、または「なし」のオプションが提供されます。BIOSベースのRAIDアレイのアセンブルをサポートするように、<filename>initrd</filename>も変更されました。 </para>
  </section>
  <section xml:id="bnmrfnk">
   <title>ルートファイルシステムを含むMDRAIDアレイのシャットダウン機能の向上</title>  
   <para>すべてのMDRAIDアレイが削除済みとしてマーキングされるまで待機するように、シャットダウンスクリプトが変更されました。すべてのMDRAIDボリュームが書き込み操作を終えるまで、オペレーティングシステムのシャットダウンプロセスがダーティビットのクリアを待機するようになりました。 </para>
   <para>ルート(<filename>/</filename>)ファイルシステム(オペレーティングシステムとアプリケーションファイルを含むシステムボリューム)がソフトウェアRAIDアレイに常駐するかどうか検討できるように、起動スクリプト、シャットダウンスクリプト、および<command>initrd</command>に変更が加えられました。アレイのメタデータハンドラをシャットダウンプロセスの早期に開始して、シャットダウン中に最終的なルートファイルシステム環境を監視します。ハンドラは一般の<command>killall</command>イベントからは除外されます。このプロセスでは、書き込みを休止し、シャットダウンの終了時にアレイのメタデータのダーティビット（アレイの再同期が必要かどうかを示す）をクリアすることもできます。</para>
  </section>
  <section xml:id="bnmtwna">
   <title>iSCSIデバイス上のMD</title> 
   <para>YaSTインストーラで、iSCSIデバイス上でMDの設定が行えるようになりました。 </para>
   <para>ブート時にRAIDアレイが必要な場合は、iSCSIイニシエータソフトウェアを<filename>boot.md</filename>の前にロードし、iSCSIターゲットをRAID用の自動設定に使用できるようにします。</para>
   <para>新規インストール用に、Libstorageは<filename>/etc/mdadm.conf</filename>ファイルを作成し、<literal>AUTO -all</literal>の行を追加します。更新中は、行は追加されません。<filename>/etc/mdadm.conf</filename>にこの行が含まれている場合は、 </para>

<screen>
AUTO -all
</screen>

   <para><filename>/etc/mdadm.conf</filename>に明記されていない限り、RAIDは自動アセンブルされません。</para>
  </section>
  <section xml:id="bnmss2g">
   <title>MD-SGPIO</title> 
   <para>MD-SGPIOユーティリティは、<command>sysfs(2)</command>によってRAIDアレイを監視するスタンドアロンアプリケーションです。イベントによって、ストレージスシステムの筐体、またはドライブベイの各スロットに関連しているLEDライトの点滅を制御するLEDの変更要求がトリガされます。次の2種類のLEDシステムをサポートしています。 </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>2-LEDシステム(動作LED、状態LED)</para>
    </listitem>
    <listitem>
     <para>3 LEDシステム(動作LED、配置LED、障害LED)</para>
    </listitem>
   </itemizedlist>
  </section>
  <section xml:id="bnmszsy">
   <title>LVM 2ミラーのサイズ変更 </title> 
   <para>論理ボリュームのサイズ変更に使用されるコマンド<command>lvresize</command>、<command>lvextend</command>、および<command>lvreduce</command>が、LVM 2ミラーのサイズを変更できるようになりました。以前は、これらのコマンドは、論理ボリュームがミラーの場合にエラーを報告していました。 </para>
  </section>
  <section xml:id="bnmtqql">
   <title>IBMサーバ上のアダプタ用ストレージドライバの更新</title> 
   <para>次のストレージドライバを利用可能な最新バージョンに更新することで、IBMサーバのストレージアダプタをサポートします。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>Adaptec: <filename>aacraid</filename>、<filename>aic94xx</filename></para>
    </listitem>
    <listitem>
     <para>Emulex: <filename>lpfc</filename></para>
    </listitem>
    <listitem>
     <para>LSI: <filename>mptas</filename>、<filename>megaraid_sas</filename></para>
     <para><filename>mptsas</filename>ドライバがネイティブEEH (Enhanced Error Handler)の回復をサポートするようになりました。これは、電源プラットフォームをご利用のお客様の入出力デバイスにとって主要な機能です。 </para>
    </listitem>
    <listitem>
     <para>qLogic: <filename>qla2xxx</filename>、<filename>qla3xxx</filename>、<filename>qla4xxx</filename></para>
    </listitem>
   </itemizedlist>
  </section>
 </section>
 <section xml:id="bndgyoe">
  <title>SLES 11の新機能</title>
  <para>このセクションで示す機能および動作の変更は、SUSE Linux Enterprise Server 11リリース用です。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bi72tak" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bi72zf2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12xr11r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu3u2m" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu3v96" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bin8klb" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="binagtl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="binahn3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bin9wm3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmqiv07" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy1edt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bn4yxd1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bvc111p" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bi72tak">
   <title>EVMS2の廃止予定</title>
   <para>EVMS2 (Enterprise Volume Management Systems)ストレージ管理ソリューションは、廃止されます。すべてのEVMS管理モジュールが、SUSE Linux Enterprise Server 11パッケージから削除されました。システムをアップグレードすると、ご利用になっている、システム以外のEVMS管理デバイスがLinux Volume Manager 2 (LVM2)によって自動認識され、管理されます。詳細については、「<link xlink:href="http://www.novell.com/linux/volumemanagement/strategy.html"><citetitle>SUSE Linux Enterpriseのストレージとボリューム管理の進化</citetitle></link>」を参照してください。</para>
   <para>EVMS管理のシステムデバイス(ルート(<filename>/</filename>)、<filename>/boot</filename>、または<filename>swap</filename>を含むすべてのデバイス)がある場合、サーバを再起動してアップグレードする前に、SLES 10サーバで次の準備作業を行ってください。</para>
   <procedure xml:id="b176hy1d">
    <step xml:id="b176hy1e">
     <para>/etc/fstabファイルで、ブートディスクとスワップディスクのパスをデフォルトの<filename>/dev/system/sys_lx</filename>ディレクトリに変更します。</para>
     <substeps performance="required">
      <step xml:id="b176hy1f">
       <para><filename>swap</filename>パーティションとルート(<filename>/</filename>)パーティションのパスから<filename>/evms/lvm2</filename>を削除します。</para>
      </step>
      <step xml:id="b176hy1g">
       <para><filename>/boot</filename>パーティションのパスから<filename>/evms</filename>を削除します。</para>
      </step>
     </substeps>
    </step>
    <step xml:id="b176hy1h">
     <para><filename>/boot/grub/menu.lst</filename>ファイルで、パスから<filename>/evms/lvm2</filename>を削除します。 </para>
    </step>
    <step xml:id="b176hy1i">
     <para><filename>/etc/sysconfig/bootloader</filename>ファイルで、ブートデバイスのパスが<filename>/dev</filename>ディレクトリであることを確認します。</para>
    </step>
    <step xml:id="b176hy1j">
     <para><filename>boot.lvm</filename>と<filename>boot.md</filename>が有効化されていることを確認します。</para>
     <substeps performance="required">
      <step xml:id="b176hy1k">
       <para>YaSTで、<guimenu>システム</guimenu><guimenu>Runlevel Editor (ランレベルエディタ)</guimenu><guimenu>エキスパートモード</guimenu>の順にクリックします。</para>
      </step>
      <step xml:id="b176hy1l">
       <para><filename>boot.lvm</filename>を選択します。</para>
      </step>
      <step xml:id="b176hy1m">
       <para><guimenu>Set/Reset (設定/リセット)</guimenu><guimenu>Enable the Service (サービスを有効にする)</guimenu>の順にクリックします。</para>
      </step>
      <step xml:id="b176hy1n">
       <para><filename>boot.md</filename>を選択します。</para>
      </step>
      <step xml:id="b176hy1o">
       <para><guimenu>Set/Reset (設定/リセット)</guimenu><guimenu>Enable the Service (サービスを有効にする)</guimenu>の順にクリックします。</para>
      </step>
      <step xml:id="b176hy1p">
       <para><guimenu>完了</guimenu>をクリックしてから、<guimenu>はい</guimenu>をクリックします。</para>
      </step>
     </substeps>
    </step>
    <step xml:id="b176hy1q">
     <para>再起動してアップグレードを開始します。 </para>
    </step>
   </procedure>
   <para>SUSE Linux Enterprise Server 10上でのEVMS2の管理についての詳細については、『<link xlink:href="http://www.novell.com/documentation/sles10/stor_admin/data/bookinfo.html"><citetitle>SUSE Linux Enterprise Server 10 SP3: ストレージ管理ガイド</citetitle></link>』を参照してください。</para>
  </section>
  <section xml:id="bi72zf2">
   <title>デフォルトファイルシステムとしてのExt3</title>
   <para>Ext3ファイルシステムは、インストール時およびファイルシステムの作成時にYaSTツールで推奨されるデフォルトファイルシステムとして、ReiserFSに置き換わっています。ただし、ReiserFSもまだサポートされています。詳細については、「<citetitle>SUSE Linux Enterprise 11技術仕様</citetitle>」Webページの「<link xlink:href="http://www.novell.com/linux/techspecs.html?tab=2"><citetitle>File System Support</citetitle></link>」を参照してください。</para>
  </section>
  <section xml:id="b12xr11r">
   <title>Ext3用にデフォルトのinodeサイズを増大</title>
   <para>Ext3ファイルシステムのファイルに対する拡張属性およびACL用のスペースを確保するため、Ext3に対するデフォルト  のinodeサイズが、SLES  10での 256バイトから、SLES11では256バイトに増えました。詳細については、<xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/>を参照してください。</para>
  </section>
  <section xml:id="biu3u2m">
   <title>JFSファイルシステムの廃止予定</title>
   <para>JFSファイルシステムのサポートが終了しました。JFSユーティリティが配布から削除されました。</para>
  </section>
  <section xml:id="biu3v96">
   <title>OCFS2ファイルシステムを高可用性リリースに追加</title>
   <para>SUSE Linux Enterprise High Availability Extensionの一部として、OCFS2ファイルシステムが完全にサポートされるようになりました。</para>
  </section>
  <section xml:id="bin8klb">
   <title>/dev/disk/by-nameの廃止予定</title>
   <para>SUSE Linux Enterprise Server 11パッケージでは、<filename>/dev/disk/by-name</filename>パスが廃止予定です。 </para>
  </section>
  <section xml:id="binagtl">
   <title>/dev/disk/by-idディレクトリで継続的に有効なデバイス名</title>
   <para>SUSE Linux Enterprise Server 11では、デフォルトのマルチパスセットアップは<command>udev</command>を使用して、マルチパス処理の開始時に<filename>/dev/disk/by-id</filename>ディレクトリ内の既存のシンボリックリンクを上書きします。マルチパス処理開始前のシンボリックリンクは、SCSIデバイスをその<filename>scsi-xxx</filename>名でポイントします。マルチパス処理実行中のシンボリックリンクは、SCSIデバイスをその<filename>dm-uuid-xxx</filename>名でポイントします。これにより、マルチパス処理が開始したかどうかに関わりなく、<filename>/dev/disk/by-id</filename>パス内のシンボリックリンクは、継続的に同じデバイスをポイントすることができます。自動的に正しいデバイスを指すので、設定ファイル(<filename>lvm.conf</filename>や<filename>md.conf</filename>)を変更する必要はありません。</para>
   <para>このような動作変更が他の機能に及ぼす影響の詳細については、次のセクションを参照してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="binahn3" xrefstyle="SectTitleOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bin9wm3" xrefstyle="SectTitleOnPage"/></para>
    </listitem>
   </itemizedlist>
  </section>
  <section xml:id="binahn3">
   <title>マルチパスデバイスのフィルタ</title>
   <para><filename>/dev/disk/by-name</filename>ディレクトリの廃止によって(<xref linkend="bin8klb" xrefstyle="SectTitleOnPage"/>)、設定ファイル内のマルチパスデバイスのフィルタ設定方法に影響を及ぼします。<filename>/etc/lvm/lvm.conf</filename>ファイルでマルチパスデバイスフィルタに<filename>/dev/disk/by-name</filename>デバイス名パスを使用していた場合は、<filename>/dev/disk/by-id</filename>パスを使用するようにファイルを変更する必要があります。<filename>by-id</filename>パスを使用するフィルタの設定では、次の点に注意してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><filename>/dev/disk/by-id/scsi-*</filename>デバイス名は継続的に有効で、この目的のために作成されました。</para>
    </listitem>
    <listitem>
     <para>フィルタに<filename>/dev/disk/by-id/dm-*</filename>という名前は使用しないでください。これらはデバイスマッパーデバイスへのシンボリックリンクで、<filename>pvscan</filename>コマンドに対して重複したPVを報告することになります。名前が<filename>LVM-pvuuid</filename>から<filename>dm-uuid</filename>に変更され、再度<filename>LVM-pvuuid</filename>に戻るように見えます。</para>
    </listitem>
   </itemizedlist>
   <para>フィルタの設定については、<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
  </section>
  <section xml:id="bin9wm3">
   <title>マルチパスデバイスのユーザフレンドリな名前</title>
   <para><filename>/dev/disk/by-id</filename>ディレクトリ(<xref linkend="binagtl" xrefstyle="SectTitleOnPage"/>)でのマルチパスデバイス名の処理方法の変更により、デバイスの2つの名前が異なっているため、ユーザフレンドリな名前の設定に影響を及ぼします。マルチパス処理の設定後は、デバイスマッパー名だけをスキャンするように、設定ファイルを変更する必要があります。</para>
   <para>たとえば、マルチパスデバイス名を使用してスキャンするように、<filename>lvm.conf</filename>ファイルを変更する必要があります。そのためには、<filename>/dev/disk/by-id/dm-uuid-.*-mpath-.*</filename>パスを、<filename>/dev/disk/by-id</filename>の代わりに指定します。</para>
  </section>
  <section xml:id="bmqiv07">
   <title>マルチパスのための高度な入出力負荷バランスオプション</title>
   <para>次の高度な入出力負荷バランスオプションは、ラウンドロビンに加えて、デバイスマッパーマルチパスにも使用きます。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>Least-pending(最小保留)</para>
    </listitem>
    <listitem>
     <para>Length-load-balancing(長さによる負荷分散)</para>
    </listitem>
    <listitem>
     <para>Service-time(サービス時間)</para>
    </listitem>
   </itemizedlist>
   <para>詳細については、<xref linkend="beg263n" xrefstyle="HeadingOnPage"/>の<xref linkend="b122sbgu" xrefstyle="RefNoPage"/>を参照してください。</para>
  </section>
  <section xml:id="bmy1edt">
   <title>マルチパスツールコールアウトの場所の変更</title>
   <para>デバイスマッパーマルチパスツールの<filename>mpath_*</filename> prio_calloutsが、<filename>/lib/libmultipath/lib*</filename>の共有ライブラリに移動されました。共有ライブラリを使用することで、デーモンの起動時、コールアウトがメモリにロードされます。これによって、すべてのパスがダウンするというシステムデッドロックのシナリオを回避することができます。このシナリオでは、プログラムをディスクからロードしなければなりませんが、この時点ではそのディスクが利用できない場合があります。</para>
  </section>
  <section xml:id="bn4yxd1">
   <title>mkinitrd -fオプションのmpathからmultipathへの変更</title>
   <para>デバイスマッパーマルチパスサービスを<filename>initrd</filename>に追加するオプションが、<literal>-f mpath</literal>から<literal>-f multipath</literal>に変更になりました。 </para>
   <para>新しい<filename>initrd</filename>を作成するためのコマンドは、次のようになりました。</para>

<screen>
mkinitrd -f multipath
</screen>

  </section>
  <section xml:id="bvc111p">
   <title>MPIOパスグループ化ポリシーのデフォルト設定として、マルチバスからフェールオーバーへの変更</title>
   <para><filename>/etc/multipath.conf </filename>ファイルにある<literal>path_grouping_policy</literal>のデフォルト設定が<literal>multibus</literal>から<literal>failover</literal>に変更されました。 </para>
   <para>path_grouping_policyの設定方法については、<xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
  </section>
 </section>
</chapter>

<chapter xml:id="storplan" xml:lang="ja" xml:base="01_planning.xml"><title>ストレージソリューションのプラニング</title><info/>
 
 <para>ニーズを最適に満たすには、ストレージの要件と、ストレージスペースの効果的な管理および分割の方法を考慮する必要があります。この項の情報を使用すると、SUSE® Linux Enterprise Server 11サーバでファイルシステムのストレージをどのように展開するか計画することができます。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi72kf0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72p1s" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72o4h" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72q5v" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi739fa" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="bi72kf0">
  <title>デバイスのパーティショニング</title>
  <para>YaST Expert Partitionerの使用については、『<citetitle>SUSE Linux Enterprise Server 11 Installation and Administration Guide</citetitle>』の<quote>Using the YaST Partitioner</quote>)を参照してください。</para>
 </section>
 <section xml:id="bi72p1s">
  <title>マルチパスのサポート</title>
  <para>Linuxは、サーバ/ストレージデバイス間の耐障害性接続を実現するため、複数のI/Oパスの使用をサポートしています。Linuxのマルチパスサポートは、デフォルトでは無効になっています。ストレージサブシステムのベンダから提供されるマルチパスソリューションを使用する場合は、別途、Linuxマルチパスを設定する必要はありません。</para>
 </section>
 <section xml:id="bi72o4h">
  <title>ソフトウェアRAIDのサポート</title>
  <para>Linuxは、ハードウェアRAIDデバイスおよびソフトウェアRAIDデバイスをサポートします。ハードウェアRAIDデバイスを使用する場合は、ソフトウェアRAIDデバイスは不要です。ただし、同じサーバでハードウェアRAIDデバイスとソフトウェアRAIDデバイスの両方を使用できます。</para>
  <para>ソフトウェアRAIDデバイスが最大限のパフォーマンスを発揮するには、それぞれのRAIDパーティションを別々の物理デバイスからとる必要があります。ソフトウェアRAID 1デバイスの場合、ミラーリングされたパーティションは、ディスクを共有できません。</para>
 </section>
 <section xml:id="bi72q5v">
  <title>ファイルシステムのスナップショット</title>
  <para>Linuxは、ファイルシステムのスナップショットをサポートします。</para>
 </section>
 <section xml:id="bi739fa">
  <title>バックアップとアーカイブのサポート</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="biu2e2j" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu2e2k" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="biu2e2j">
   <title>オープンソースバックアップ</title>
   <para>Linuxでデータのバックアップを行うためのオープンソースツールには、<command>tar</command>、<command>cpio</command>、および<command>rsync</command>が含まれています。詳細については、これらのツールのマニュアルページを参照してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>PAX: POSIXファイルシステムアーカイバ。標準的なアーカイブ(バックアップ)ファイルの最も一般的なフォーマットである<command>cpio</command>および<command>tar</command>の2つをサポートしています。詳細については、のマニュアルページを参照してください。</para>
    </listitem>
    <listitem>
     <para>Amanda: The Advanced Maryland Automatic Network Disk Archiver。<link xlink:href="http://www.amanda.org/">www.amanda.org</link>を参照してください。</para>
    </listitem>
   </itemizedlist>
  </section>
  <section xml:id="biu2e2k">
   <title>商用バックアップとアンチウィルスのサポート</title>
   <para>Novell OES (Open Enterprise Server) 2 for Linuxには、SLES (SUSE Linux Enterprise Server) 10が組み込まれています。OES 2をサポートするウィルス対策/バックアップのソフトウェアベンダは、SLES 10もサポートします。スケジュールされたSLES 11のサポートについては、該当するベンダのWebサイトをご覧ください。 </para>
   <para>可能なバックアップおよびウィルス対策のソフトウェアベンダの現行リストについては、『<link xlink:href="http://www.novell.com/products/openenterpriseserver/partners_communities.html"><citetitle>Novell Open Enterprise Server Partner Support: Backup and Antivirus Support</citetitle></link>』を参照してください。このリストは、四半期ごとに更新されます。</para>
  </section>
 </section>
</chapter>

<chapter xml:id="lvm" xml:lang="ja" xml:base="02_lvm.xml"><title>LVMの設定</title><info/>
 
 <para>本項では、LVM(Logical Volume Manager)の原理と多くの状況で役立つ基本機能を簡単に説明します。YaST LVMの設定は、YaST Expert Partitionerからアクセスできます。このパーティショニングツールにより、既存のパーティションを編集、および削除できます。また、LVMで使用する新規パーティションを作成することもできます。</para>
 <warning>
  <para>LVMを使用することでデータ損失などの危険性が増加する恐れがあります。この危険性にはアプリケーションのクラッシュ、電源障害、誤ったコマンドなども含まれます。LVMまたはボリュームの再設定を実施する前にデータを保存してください。バックアップなしでは作業を実行しないでください。 </para>
 </warning>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec-yast2-system-lvm-explanation" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi706ct" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8b" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvm-activate-vgs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgpqe2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgqpfy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuz4lz" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgpmw3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgob84" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="btx9jxu" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="sec-yast2-system-lvm-explanation">
  <title>論理ボリュームマネージャ(LVM)の理解</title>
  <para>LVMは、複数のファイルシステムにハードディスクスペースを柔軟に分散することができます。LVMが開発された理由は、インストール中に初期パーティショニングが終了した後でのみ、ハードディスクスペースのセグメンテーションを変更するニーズが発生する可能性があるためです。稼動中のシステムでパーティションを変更することは困難なので、LVMは必要に応じて論理ボリューム(LV)を作成できるメモリスペースの仮想プール(ボリュームグループ(VG))を提供します。オペレーティングシステムは物理パーティションの代わりにこれらのLVにアクセスします。ボリュームグループは2つ以上のディスクにまたがることができます。したがって、複数のディスクまたはそれらの一部で1つのVGを構成できます。この方法で、LVMは物理ディスクスペースから一種の抽象化を行います。この抽象化により、物理パーティショニングを使用する場合よりはるかに簡単で安全な方法でセグメンテーションを変更できます。 </para>
  <para role="intro"><xref linkend="bo1t1qx" xrefstyle="FigureXRef"/>では物理パーティショニング(左)とLVM区分(右)を比較しています。左側は、1つのディスクが割り当てられたマウントポイント(MP)をもつ3つの物理パーティション(PART)に分かれています。これによりオペレーティングシステムはそれぞれのパーティションにアクセスできます。右側では2つのディスクがそれぞれ3つの物理パーティションに分かれています。2つのLVMボリュームグループ(VG 1およびVG 2)が定義されています。VG 1には、DISK 1からのパーティションが2つ、DISK 2からのパーティションが1つ含まれます。VG 2には、DISK 2からの残りの2パーティションが含まれます。 </para>
  <figure pgwide="0" xml:id="bo1t1qx">
   <title>物理パーティショニング対LVM</title>
   <mediaobject>
    <imageobject role="fo">
    <imagedata fileref="lvm.png" width="445pt" format="eps"/></imageobject>
    <imageobject role="html">
    <imagedata fileref="lvm.png" width="445pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>LVMでは、ボリュームグループに組み込まれた物理ディスクをPV (物理ボリューム)と呼びます。<xref linkend="bo1t1qx" xrefstyle="FigureXRef"/>のボリュームグループ内には、4つの論理ボリューム(LV 1からLV 4)が定義されています。これらのボリュームは、関連付けられたマウントポイントを介してオペレーティングシステムに使用されます。別の論理ボリュームとの境界とパーティションの境界を並べることはできません。この例ではLV 1およびLV 2の間に境界があります。 </para>
  <para>LVMの機能: </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>複数のハードディスクまたはパーティションを大きな論理ボリュームにまとめることができます。 </para>
   </listitem>
   <listitem>
    <para>提供された設定が適切であれば、LV(<filename>/usr</filename>など)は空きスペースがなくなったときに拡張することができます。 </para>
   </listitem>
   <listitem>
    <para>LVMを使用することで、実行中のシステムにハードディスクまたはLVを追加できます。ただし、こうしたディスクやLVを追加するには、ホットスワップ可能なハードウェアが必要になります。 </para>
   </listitem>
   <listitem>
    <para>複数の物理ボリューム上に論理ボリュームのデータストリームを割り当てる<emphasis>ストライピングモード</emphasis>を有効にすることもできます。これらの物理ボリュームが別のディスクに存在する場合、RAID 0と同様に読み込みおよび書き込みのパフォーマンスを向上できます。 </para>
   </listitem>
   <listitem>
    <para>スナップショット機能は稼動中のシステムで一貫性のある(特にサーバ)バックアップを取得できます。 </para>
   </listitem>
  </itemizedlist>
  <para>これらの機能とともにLVMを使用することは、頻繁に使用されるホームPCや小規模サーバではそれだけでも意義があります。データベース、音楽アーカイブ、またはユーザディレクトリのように増え続けるデータストックがある場合は、LVMが特に役に立ちます。LVMを使用すると、物理ハードディスクより大きなファイルシステムの作成が可能になります。LVMのもう1つの利点は最大256個のLVを追加できることです。ただし、LVMでの作業は従来のパーティションでの作業とは異なることに留意してください。 </para>
  <para>カーネルバージョン2.6から開始して、LVMバージョン2を利用することができます。これはLVMの前バージョンとの下方互換になり、これまでのボリュームグループを管理できるようにします。新しいボリュームグループを作成する場合は、新しいフォーマットまたは下方互換バージョンのどちらを使用するか決定します。LVM 2にはいずれのカーネルパッチも必要ありません。これは、カーネル2.6に統合されているデバイスマッパーを活用しています。このカーネルはLVMバージョン2のみをサポートしています。そのため、このセクションでLVMと書かれている場合、それはLVMバージョン2を指しています。 </para>
  <para>YaSTパーティショナの使用によって、新規および既存のLVMストレージオブジェクトを管理できます。LVMの設定に関する指示や詳細情報については、公式の<link xlink:href="http://tldp.org/HOWTO/LVM-HOWTO/"><citetitle>LVM HOWTO</citetitle></link>を参照してください。 </para>
  <important>
   <para>LVMの構成後にマルチパスのサポートを追加する場合は、<filename>/etc/lvm/lvm.conf</filename>ファイルを修正し、<filename>/dev/disk/by-id</filename>ディレクトリ内のマルチパスデバイス名のみをスキャンするようにして(<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>に記載するとおり)、 サーバを再起動します。</para>
  </important>
 </section>
 <section xml:id="bi706ct">
  <title>LVMパーティションの作成</title>
  <para>ディスクごとに、<literal>0x8E Linux LVM</literal>として、LVM用に使用したい空き領域をパーティション分割します。1つのデバイスに1つ以上のLVMパーティションを作成できます。デバイス上のパーティションがすべてLVMパーティションである必要はありません。 </para>
  <para>ボリュームグループ機能を使用すると、1つ以上のLVMパーティションをボリュームグループと呼ばれるスペースの論理プールにまとめ、そのボリュームグループ内のスペースから1つ以上の論理ボリュームを作成できます。</para>
  <para>YaSTパーティショナでは、LVMパーティションを作成するときには、デスク上の空き領域しか使用できません。単一のLVMパーティションにデスク全体を使用したいが、ディスク上に他のパーティションがすでに存在する場合は、まず、既存のパーティションすべてを削除してスペースを解放しないと、そのスペースをLVMパーティションで使用することができません。 </para>
  <warning>
   <para>パーティションを削除すると、パーティション内のすべてのデータが破棄されます。 </para>
  </warning>
  <procedure xml:id="bq2fjmu">
   <step xml:id="bq2fjmv">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="bq2fk0j">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgn1yt">
    <para>(オプション)1つ以上の既存パーティションを削除し、そのスペースを解放して、作成するLVMパーティションに使用できるようにします。</para>
    <para>詳細については、<xref linkend="brgob84" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </step>
   <step xml:id="bq2fk9e">
    <para>［パーティション］ページで、<guimenu>追加</guimenu>をクリックします。</para>
   </step>
   <step xml:id="brgodov">
    <para><guimenu>新しいパーティションの種類</guimenu>の下で、<guimenu>プライマリパーティション</guimenu>または<guimenu>拡張パーティション</guimenu>を選択して、<guimenu>次へ</guimenu>をクリックします。</para>
   </step>
   <step xml:id="brgoefx">
    <para role="intro"><guimenu>新しいパーティションのサイズ</guimenu>を指定して、<guimenu>次へ</guimenu>をクリックします。</para>
    <informaltable>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row><!--id=brgpexh-->
        <entry>
          <informalfigure>
           <mediaobject>
            <imageobject>
             <imagedata fileref="yast2_lvm2_a.png" width="151pt" format="png"/>
            </imageobject>
           </mediaobject>
          </informalfigure>
        </entry>
        <entry>
         <itemizedlist mark="bullet" spacing="normal">
          <listitem>
           <formalpara xml:id="brgof07">
            <title>最大サイズ:</title>
            <para>ディスク上の使用可能な空き領域をすべて使用します。</para>
           </formalpara>
          </listitem>
          <listitem>
           <formalpara xml:id="brgooyf">
            <title>Custom Size (カスタムサイズ):</title>
            <para>ディスク上の使用可能な空きスペース量を上限とするサイズを指定します。</para>
           </formalpara>
          </listitem>
          <listitem>
           <formalpara xml:id="brgooyg">
            <title>カスタム領域:</title>
            <para>ディスク上の使用可能な空き領域の開始シリンダーと終了シリンダーを指定します。</para>
           </formalpara>
          </listitem>
         </itemizedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step xml:id="brgpahi">
    <para role="intro">パーティションフォーマットの設定:</para>
    <informaltable>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row><!--id=brgpi5z-->
        <entry>
          <informalfigure>
           <mediaobject>
            <imageobject>
             <imagedata fileref="yast2_lvm3_a.png" width="139pt" format="png"/>
            </imageobject>
           </mediaobject>
          </informalfigure>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para><guimenu>フォーマットのオプション</guimenu>の下で、<guimenu>フォーマットしない</guimenu>を選択します。</para>
          </listitem>
          <listitem>
           <para><guimenu>ファイルシステムのID</guimenu>ドロップダウンリストから、パーティションのIDとして<guimenu>0x8E Linux LVM</guimenu>を選択します。</para>
          </listitem>
          <listitem>
           <para><guimenu>マウントのオプション</guimenu>の下で、<guimenu>パーティションをマウントしない</guimenu>を選択します。</para>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step xml:id="brgosll">
    <para><guimenu>完了</guimenu>をクリックします。</para>
    <para><guimenu>次へ</guimenu>と<guimenu>完了</guimenu>をクリックしてパーティショナを終了するまで、パーティションは実際に作成されません。</para>
   </step>
   <step xml:id="bq2fkxr">
    <para>追加したいLinux LVMパーティションごとに、<xref linkend="bq2fk9e" xrefstyle="StepXRef"/>から<xref linkend="brgosll" xrefstyle="StepXRef"/>まで繰り返します。 </para>
   </step>
   <step xml:id="brgouy6">
    <para><guimenu>次へ</guimenu>をクリックし、新しいLinux LVMパーティションが一覧されることを確認してから、<guimenu>完了</guimenu>をクリックしてパーティショナを終了します。</para>
   </step>
   <step xml:id="bq2fl52">
    <para>(オプション)<xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/>の説明に従って、ボリュームグループの設定を続行します。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bgchx8a">
  <title>ボリュームグループの作成</title>
  <para>LVMボリュームグループは、Linux LVMパーティションをスペースの論理プールにします。グループ内の使用可能なスペースから論理ボリュームを作成できます。グループ内のLinux LVMパーティションは、同じディスクに存在することも、さまざまなディスクに存在することも可能です。同じディスクまたはさまざまなディスクからLVMパーティションを追加することにより、グループのサイズを拡張できます。LVM用に予約されているパーティションをすべて1つのボリュームグループに割り当ててください。すべてのパーティションを割り当てないと、パーティションのスペースが未使用のまま残ります。</para>
  <procedure xml:id="brgncwg">
   <step xml:id="brgnjca">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="brgnjcb">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgncwh">
    <para>左のパネルで、<guimenu>ボリューム管理</guimenu>をクリックします。</para>
    <para>既存のボリュームグループのリストが右のパネルに表示されます。</para>
   </step>
   <step xml:id="brgnd6f">
    <para role="intro">［ボリューム管理］ページの左下で、<guimenu>ボリュームグループの追加</guimenu>をクリックします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm4_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="brgndwo">
    <para><guimenu>ボリュームグループ名</guimenu>を指定します。</para>
    <para>インストール時にボリュームグループを作成している場合は、SUSE Linux Enterprise Serverのシステムファイルを含むボリュームグループに対して<literal>system</literal>という名前が示唆されます。</para>
   </step>
   <step xml:id="brgnght">
    <para><guimenu>PEサイズ</guimenu>を指定します。</para>
    <para><guimenu>PEサイズ</guimenu>は、ボリュームグループの物理ブロックのサイズを定義します。ボリュームグループにある全ディスクスペースはこの物理ブロックサイズ内で使用されます。値の範囲は、2の累乗で1KBから16GBまでです。通常、この値は4MBに設定されます。 </para>
    <para>LVM1では、LVごとに65534エクステントまでしかサポートしないので、4MBの物理エクステントで最大LVサイズとして256GBが可能でした。LVM2では、物理エクステントの数に制限がありません。エクステントが多くても、論理ボリュームに対するI/Oパフォーマンスに影響しませんが、LVMツールの動作が遅くなります。</para>
    <important>
     <para>1つのボリュームグループに異なるサイズの物理エクステントを混在させないでください。初期設定後はエクステントを変更しないでください。</para>
    </important>
   </step>
   <step xml:id="brgnhd9">
    <para><guimenu>利用可能な物理ボリューム</guimenu>リストで、このボリュームグループに含めたいLinux LVMパーティションを選択し、<guimenu>追加</guimenu>をクリックして、それらのパーティションを<guimenu>選択した物理ボリューム</guimenu>リストに移動します。</para>
   </step>
   <step xml:id="brgnihe">
    <para><guimenu>完了</guimenu>をクリックします。</para>
    <para><guimenu>ボリュームグループ</guimenu>リストに新しいグループが表示されます。</para>
   </step>
   <step xml:id="brgnk9f">
    <para>［ボリューム管理］ページで、<guimenu>次へ</guimenu>をクリックし、新しいグループが一覧されることを確認してから、<guimenu>完了</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bgchx8b">
  <title>物理ボリュームの設定</title>
  <para role="intro">Linux LVMパーティションは、ボリュームグループに割り当てられると、「物理ボリューム」と呼ばれるようになります。 </para>
  <figure pgwide="0" xml:id="fig-yast2-lvm5">
   <title>ホームという名前のボリュームグループ内の物理ボリューム</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_lvm5_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>既存のボリュームグループに物理ボリュームを追加するには:</para>
  <procedure xml:id="brgq6lc">
   <step xml:id="brgq6ld">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="brgq6le">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgq6lf">
    <para>左のパネルで、［ボリューム管理］を選択し、グループのリストを展開します。</para>
   </step>
   <step xml:id="brgq6lg">
    <para>［ボリューム管理］の下でボリュームグループを選択し、<guimenu>概要</guimenu>タブをクリックします。</para>
   </step>
   <step xml:id="brgq6lh">
    <para role="intro">ページ下部にある<guimenu>サイズ変更</guimenu>をクリックします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="brgq6li">
    <para><guimenu>利用可能な物理ボリューム</guimenu>リストから物理ボリューム(LVMパーティション)を選択し、［追加］をクリックしてそのボリュームを<guimenu>選択した物理ボリューム</guimenu>リストに移動します。</para>
   </step>
   <step xml:id="brgq6lj">
    <para><guimenu>完了</guimenu>をクリックします。</para>
   </step>
   <step xml:id="brgq6lk">
    <para><guimenu>次へ</guimenu>をクリックし、変更が一覧されることを確認してから、<guimenu>完了</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bgchx8c">
  <title>物理ボリュームの設定</title>
  <para>物理ボリュームでボリュームグループが満たされたら、［論理ボリューム］ダイアログボックス(<xref linkend="fig-yast2-lvm6" xrefstyle="FigureXRef"/>参照)を使用して、オペレーティングシステムで使用される論理ボリュームを定義および管理します。このダイアログには、そのボリュームグループのすべての論理ボリュームが一覧されます。<guimenu>追加</guimenu>、<guimenu>編集</guimenu>、および<guimenu>削除</guimenu>の各オプションを使用して、論理ボリュームを管理できます。各ボリュームグループに少なくとも1つの論理ボリュームを割り当ててください。ボリュームグループ内の空き領域を使い果たすまで、必要に応じて新しい論理ボリュームを作成できます。 </para>
  <para>SLES 11 SP3から、LVM論理ボリュームはシンプロビジョニング可能になっています。シンプロビジョニングを使用すると、利用可能な空き領域を超えるサイズの論理ボリュームを作成できます。任意の数のシンボリューム用に予約した未使用領域が含まれるシンプールを作成します。シンボリュームは疎ボリュームとして作成され、必要に応じてシンプールから領域が割り当てられます。ストレージ領域をコスト効果の高い方法で割り当てなければならなくなった場合、シンプールを動的に拡張できます。</para>
  <important>
   <para>クラスタでシンプロビジョニングボリュームを使用するには、クラスタを使用するシンプールとシンボリュームを1つのクラスタリソースで管理する必要があります。これにより、シンボリュームとシンプールを常に同じノードに排他的にマウントできます。</para>
  </important>
  <figure pgwide="0" xml:id="fig-yast2-lvm6">
   <title>論理ボリューム管理</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_lvm6_a.png" width="339pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>さらに、複数の物理ボリュームにまたがる論理ボリュームにデータストリームを分配すること(ストライピング)も可能です。これらの物理ボリュームが別のハードディスクに存在する場合、この性質により、読み込みおよび書込みのパフォーマンスが向上します(RAID 0など)。ただし、<literal>n</literal>ストライブでLVをストライピングする場合、LVが必要とするハードディスクスペースが物理ボリューム<literal>n</literal>個に等しく配分されている場合にのみ、ストライプが正しく作成されます。たとえば、使用可能な物理ボリュームが2つだけの場合は、3つのストライプをもつ論理ボリュームは設定できません。 </para>
  <procedure xml:id="brgq5hr">
   <step xml:id="brgq6ll">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="brgq6lm">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgq6ln">
    <para>左のパネルで、［ボリューム管理］を選択して展開し、ボリュームグループのリストを表示します。</para>
   </step>
   <step xml:id="brgq6lo">
    <para>［ボリューム管理］の下でボリュームグループを選択し、<guimenu>論理ボリューム</guimenu>タブをクリックします。</para>
   </step>
   <step xml:id="brgq5hs">
    <para>左下で、<guimenu>追加</guimenu>をクリックして［論理ボリュームの追加］ダイアログボックスを開きます。</para>
   </step>
   <step xml:id="brgq8gl">
    <para role="intro">論理ボリュームの<guimenu>名前</guimenu>を指定し、<guimenu>次へ</guimenu>をクリックします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm9_a.png" width="137pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b15cmz3e">
    <para>LVMボリュームのタイプを指定します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b15cmz3f">
       <title>通常のボリューム:</title>
       <para>(デフォルト)ボリュームの領域は直ちに割り当てられます。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b15cmz3g">
       <title>シンプール:</title>
       <para>この論理ボリュームは、シンボリューム用に予約された領域のプールです。シンボリュームでは、必要な領域をそのプールからオンデマンドで割り当てることができます。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b15cmz3h">
       <title>シンボリューム:</title>
       <para>ボリュームは疎ボリュームとして作成されます。このボリュームでは、必要な領域はシンプールからオンデマンドで割り当てられます。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm9a_a.png" width="137pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="brgqd13">
    <para role="intro">ボリュームのサイズと、複数ストライプを使用するかどうかを指定します。</para>
    <informaltable>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row><!--id=brgqgrg-->
        <entry>
          <informalfigure>
           <mediaobject>
            <imageobject>
             <imagedata fileref="yast2_lvm10_a.png" width="137pt" format="png"/>
            </imageobject>
           </mediaobject>
          </informalfigure>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para>使用可能な最大サイズまでの論理ボリュームサイズを指定します。</para>
           <para>現在のボリュームグループ内の空き領域の量が<guimenu>最大サイズ</guimenu>オプションの横に表示されます。</para>
          </listitem>
          <listitem>
           <para>ストライプの数を指定します。</para>
           <warning>
            <para>YaSTには、現時点でストライピングの観点からエントリの正確性を確認する機会はありません。何か間違いがあった場合、それが明らかになるのはLVMがディスクに実装された後です。 </para>
           </warning>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step xml:id="brgqevk">
    <para>論理ボリュームのフォーマットオプションを指定します。</para>
    <informaltable>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row><!--id=brgqevl-->
        <entry>
          <informalfigure>
           <mediaobject>
            <imageobject>
             <imagedata fileref="yast2_lvm11_a.png" width="134pt" format="png"
             />
            </imageobject>
           </mediaobject>
          </informalfigure>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para><guimenu>フォーマットのオプション</guimenu>の下で、<guimenu>パーティションをフォーマットする</guimenu>を選択し、次に、<guimenu>ファイルシステム</guimenu>ドロップダウンリストからフォーマットのタイプ(Ext3など)を選択します。 </para>
          </listitem>
          <listitem>
           <para><guimenu>マウントのオプション</guimenu>の下で、<guimenu>パーティションをマウントする</guimenu>を選択してから、マウントポイントを選択します。</para>
           <para>この論理ボリューム上に格納されたファイルは、インストールしたシステム上の該当するマウントポイントで検出することができます。</para>
          </listitem>
          <listitem>
           <para><guimenu>Fstabオプション</guimenu>をクリックして、このボリュームの特別なマウントオプションを追加します。</para>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step xml:id="brgqmpf">
    <para><guimenu>完了</guimenu>をクリックします。</para>
   </step>
   <step xml:id="brgqn20">
    <para><guimenu>次へ</guimenu>をクリックし、変更が一覧されることを確認してから、<guimenu>完了</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="lvm-activate-vgs">
  <title>非ルートLVMボリュームグループの自動アクティブ化</title>
  <para>非ルートLVMボリュームグループのアクティブ化の動作は、<literal>/etc/sysconfig/lvm</literal>ファイル内のパラメータ設定により制御されます。</para>
  <para>デフォルトでは、非ルートLVMボリュームグループは、<filename>/etc/rc.d/boot.lvm</filename>によって、<literal>/etc/sysconfig/lvm</literal>ファイル内の<literal>LVM_VGS_ACTIVATED_ON_BOOT</literal>パラメータの設定にしたがって、システムの再起動時に自動的にアクティブになります。このパラメータにより、システムの再起動時にすべてのボリュームグループをアクティブにすることも、または指定した非ルートLVMボリュームグループのみをアクティブにすることもできます。</para>
  <para>システムの再起動時にすべての非ルートLVMボリュームグループをアクティブにするには、<filename>/etc/sysconfig/lvm</filename>ファイル内の<literal>LVM_VGS_ACTIVATED_ON_BOOT</literal>パラメータが空である(<literal>""</literal>)ことを確認します。これがデフォルトの設定です。ほぼすべての標準的なLVMのインストールでは、安全に空にしておくことができます。</para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="" 
</screen>

  <para>指定した非ルートLVMボリュームグループのみをシステムの再起動時にアクティブにするには、ボリュームグループの名前を<literal>LVM_VGS_ACTIVATED_ON_BOOT</literal>パラメータに対する値として、次のように指定します。</para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="vg1" 
</screen>

  <para>デフォルトでは、新たに検出されたLVMボリュームグループは、自動的にはアクティブになりません。<literal>LVM_ACTIVATED_ON_DISCOVERED</literal>パラメータは、<filename>/etc/sysconfig/lvm</filename>ファイル内で次のコマンドにより非アクティブとなります。</para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="disable"
</screen>

  <para><literal>LVM_ACTIVATED_ON_DISCOVERED</literal>パラメータを次のように設定して、新たに検出されたLVMボリュームグループをudevルールを介してアクティブにすることができます。</para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="enable"
</screen>

 </section>
 <section xml:id="lvmtagging">
  <title>LVM2ストレージオブジェクトのタグ付け</title>
  <para role="intro">タグは、ストレージオブジェクトのメタデータに割り当てられる順序付けのないキーワードまたは用語です。タグを使用すると、順序付けのないタグのリストをLVMストレージオブジェクトのメタデータに添付することによって、それらのオブジェクトのコレクションを有用になるように分類できます。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bwkc8pi" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkc1zg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkc1ta" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkepmz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkdms3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkdqfz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bwkc8pi">
   <title>LVM2タグの使用</title>
   <para role="intro">LVM2ストレージオブジェクトにタグを付けたら、それらのタグをコマンドで使用して、次のタスクを達成できます。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>特定のタグの有無に応じて、処理するLVMオブジェクトを選択します。</para>
    </listitem>
    <listitem>
     <para>設定ファイル内でタグを使用することにより、サーバ上でアクティブにするボリュームグループと論理ボリュームを制御します。</para>
    </listitem>
    <listitem>
     <para>コマンド内でタグを指定することにより、グローバル設定ファイルの設定を上書きします。</para>
    </listitem>
   </itemizedlist>
   <para>コマンドラインでLVMオブジェクトを参照する代わりに、タグを使用して、次の項目を受け入れることができます。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>オブジェクトのリスト</para>
    </listitem>
    <listitem>
     <para>単一のオブジェクト(タグが単一オブジェクトに展開する限り)</para>
    </listitem>
   </itemizedlist>
   <para>オブジェクト名をタグで置き換えることは、一部ではサポートされていません。引数の展開後、リスト内の重複引数は、重複引数を削除し、各引数の最初のインスタンスを保留することによって解決されます。</para>
   <para>引数のタイプが曖昧になる可能性がある場合は、タグの前にアットマーク(@)文字を付けてください(たとえば、<literal>@mytag</literal>)。それ以外の接頭辞<quote>@</quote>の使用はオプションです。</para>
  </section>
  <section xml:id="bwkc1zg">
   <title>LVM2タグの作成要件</title>
   <para role="intro">LVMでタグを使用する場合は、以下の要件を考慮してください。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkc4lx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkc75c" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bwkc4lx">
    <title>サポートされている文字</title>
    <para>LVMタグのワードには、ASCII 大文字A～Z、小文字a～z、数字0～9、下線(_)、プラス(+)、ハイフン(-)、およびピリオド(.)を含めることができます。ワードをハイフンで始めることはできません。最大128文字まで入力できます。</para>
   </section>
   <section xml:id="bwkc75c">
    <title>サポートされているストレージオブジェクト</title>
    <para>タグ付けできるのは、LVM2の物理ボリューム、ボリュームグループ、論理ボリューム、および論理ボリュームセグメントです。PVタグは、そのボリュームグループのメタデータに保存されます。ボリュームグループを削除すると、孤立した物理ボリューム内のタグも削除されます。スナップショットにはタグを付けられませんが、元のオブジェクトはタグ付けできます。</para>
    <para>LVM1オブジェクトは、そのディスクフォーマットがタグをサポートしていないので、タグ付けできません。</para>
   </section>
  </section>
  <section xml:id="bwkc1ta">
   <title>コマンドラインでのタグ構文</title>
   <variablelist>
    <varlistentry xml:id="bwkddun">
     <term>--addtag &lt;<replaceable>タグ_情報</replaceable>&gt;</term>
     <listitem>
      <para>LVM2ストレージオブジェクトにタグを追加(つまり、<emphasis>タグ付け</emphasis>)します。</para>
      <formalpara xml:id="bwkdj1p">
       <title>例</title>
       <para/>
      </formalpara>

<screen>
vgchange --addtag @db1 vg1
</screen>

     </listitem>
    </varlistentry>
    <varlistentry xml:id="bwkdh2t">
     <term>--deltag &lt;<replaceable>タグ_情報</replaceable>&gt;</term>
     <listitem>
      <para>LVM2ストレージオブジェクトからタグを削除(つまり、<emphasis>タグ解除</emphasis>)します。</para>
      <formalpara xml:id="bwkdjin">
       <title>例</title>
       <para/>
      </formalpara>

<screen>
vgchange --deltag @db1 vg1
</screen>

     </listitem>
    </varlistentry>
    <varlistentry xml:id="bwkdh2u">
     <term>--tag &lt;<replaceable>タグ_情報</replaceable>&gt;</term>
     <listitem>
      <para>アクティブまたは非アクティブにするボリュームグループまたは論理ボリュームのリストを絞り込むために使用するタグを指定します。</para>
      <formalpara xml:id="bwkdg98">
       <title>例</title>
       <para/>
      </formalpara>
      <para>次のコマンドを入力すると、指定のタグに一致するタグをもつボリュームがアクティブになります。</para>

<screen>
lvchange -ay --tag @db1 vg1/vol2
</screen>

     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="bwkepmz">
   <title>設定ファイル構文</title>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkcqoj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkeuio" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkcwqd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bwkcqoj">
    <title>lvm.confファイルでホスト名タグを有効にする</title>
    <para>次のコードを <filename>/etc/lvm/lvm.conf</filename>ファイルに追加することにより、<filename>/etc/lvm/lvm_&lt;<replaceable>ホスト名</replaceable>&gt;.conf</filename>ファイルでホストに個別に定義されているホストタグを有効にします。</para>

<screen>
tags {
   # Enable hostname tags
   hosttags = 1
}
</screen>

    <para>ホストの<filename>/etc/lvm/lvm_&lt;<replaceable>ホスト名</replaceable>&gt;.conf</filename>ファイルにアクティベーションコードを入力します。<xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/>を参照してください。</para>
   </section>
   <section xml:id="bwkeuio">
    <title>lvm.confファイルのホスト名タグを定義する</title>

<screen>
tags {

   tag1 { }
      # Tag does not require a match to be set.

   tag2 {
      # If no exact match, tag is not set.
      host_list = [ "hostname1", "hostname2" ]
   }
}
</screen>

   </section>
   <section xml:id="bwkctd3">
    <title>アクティベーションを定義する</title>
    <para><filename>/etc/lvm/lvm.conf</filename>ファイルを変更すると、タグに基づいてLVM論理ボリュームをアクティブにできます。 </para>
    <para>テキストエディタで、次のコードをファイルに追加します。</para>

<screen>
  activation {
      volume_list = [ "vg1/lvol0", "@database" ]
  }
</screen>

    <para><literal>@database</literal>をご使用のタグで置き換えます。ホストに設定されているすべてのタグにタグを一致させるには、<literal>"@*"</literal>を使用します。 </para>
    <para>アクティベーションコマンドは、ボリュームグループと論理ボリュームのメタデータで設定されている<replaceable>ボリュームグループ名</replaceable>、<replaceable>ボリュームグループ名/論理グループ名</replaceable>、または@<replaceable>タグ</replaceable>と照合を行います。ボリュームグループまたは論理グループは、メタデータタグが一致する場合のみアクティブになります。一致しない場合のデフォルトは、アクティブにしないことです。</para>
    <para><literal>volume_list</literal>が存在せず、ホストにタグが定義されていると、ホストタグがメタデータタグに一致する場合のみボリュームグループまたは論理グループがアクティブになります。</para>
    <para><literal>volume_list</literal>が存在せず、ホストにタグが定義されていないと、アクティベーションが実行されます。</para>
   </section>
   <section xml:id="bwkcwqd">
    <title>複数のホスト名設定ファイルでアクティベーションを定義する</title>
    <para><filename>lvm.conf</filename>ファイルでホストタグが有効になっている場合、 ホストの設定ファイル(<filename>/etc/lvm/lvm_&lt;<replaceable>ホスト_タグ</replaceable>&gt;.conf</filename>)でアクティベーションコードを使用できます。たとえば、サーバの<filename>/etc/lvm/</filename>フォルダに、2つの設定ファイルがあるとします。</para>
    <simplelist>
     <member><filename>lvm.conf</filename></member> <member><filename>lvm_&lt;<replaceable>ホスト_タグ</replaceable>&gt;.conf</filename></member>
    </simplelist>
    <para>スタートアップ時に、<filename>/etc/lvm/lvm.conf</filename>ファイルがロードされ、ファイル内のすべてのタグ設定が処理されます。ホストタグが定義されていた場合は、関連の<filename>/etc/lvm/lvm_&lt;<replaceable>ホスト_タグ</replaceable>&gt;.conf</filename>ファイルがロードされます。特定の設定ファイルエントリが検索される場合は、まず、ホストタグファイルが検索されてから、<filename>lvm.conf</filename>ファイルが検索され、最初の一致で検索が停止します。<filename>lvm_&lt;<replaceable>ホスト_タグ</replaceable>&gt;.conf</filename>ファイル内では、タグの設定順序と逆の順序が使用されます。これによって、最後に設定されたタグのファイルが最初に検索されます。ホストタグファイルで新しいタグが設定されると、追加の設定ファイルがロードされます。 </para>
   </section>
  </section>
  <section xml:id="bwkdms3">
   <title>クラスタで簡単なアクティベーション制御にタグを使用する</title>
   <para>簡単なアクティベーション制御は、<filename>/etc/lvm/lvm.conf</filename>ファイルで<literal>hostname_tags</literal>オプションを有効にすることでセットアップできます。これがグローバル設定になるように、同じファイルをクラスタ内のすべてのコンピュータで使用します。 </para>
   <procedure xml:id="bwkel6y">
    <step xml:id="bwkel6z">
     <para>テキストエディタで、次のコードを<filename>/etc/lvm/lvm.conf</filename>ファイルに追加します。</para>

<screen>
tags {
   hostname_tags = 1
}
</screen>

    </step>
    <step xml:id="bwkelf9">
     <para>ファイルをクラスタ内のすべてのホストに複製します。</para>
    </step>
    <step xml:id="bwkelow">
     <para>クラスタ内の任意のコンピュータから、<filename>vg1/lvol2</filename>をアクティブにするコンピュータのリストに<literal>db1</literal>を追加します。</para>

<screen>
lvchange --addtag @db1 vg1/lvol2
</screen>

    </step>
    <step xml:id="bwkelx8">
     <para><filename>db1</filename>サーバで、次のコードを入力してvg1/lvol2をアクティブにします。</para>

<screen>
lvchange -ay vg1/vol2
</screen>

    </step>
   </procedure>
  </section>
  <section xml:id="bwkdqfz">
   <title>タグを使用して、クラスタ内の好みのホストでアクティブにする</title>
   <para>本項の例では、次のようなアクティベーションを行う2つの方法を示します。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>ボリュームグループ<filename>vg1</filename>をデータベースホスト<filename>db1</filename>および<filename>db2</filename>でのみアクティブにします。</para>
    </listitem>
    <listitem>
     <para>ボリュームグループ<filename>vg2</filename>をファイルサーバホスト<filename>fs1</filename>のみでアクティブにします。</para>
    </listitem>
    <listitem>
     <para>ファイルサーバのバックアップホスト <filename>fsb1</filename>では、最初は何もアクティブにせず、ファイルサーバのホスト <filename>fs1</filename>に置き換わる準備をします。</para>
    </listitem>
   </itemizedlist>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkdsty" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkdtdw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bwkdsty">
    <title>オプション1:一元化された管理とホスト間で複製された設定</title>
    <para>次のソリューションでは、単一の設定ファイルを複数のホスト間で複製します。</para>
    <procedure xml:id="bwkdvwj">
     <step xml:id="bwkdvwk">
      <para><literal>@database</literal>タグをボリュームグループ<filename>vg1</filename>のメタデータに追加します。端末コンソールで、次のコマンドを入力します。</para>

<screen>
vgchange --addtag @database vg1
</screen>

     </step>
     <step xml:id="bwke0dt">
      <para><literal>@fileserver</literal>タグをボリュームグループ<filename>vg2</filename>のメタデータに追加します。端末コンソールで、次のコマンドを入力します。</para>

<screen>
vgchange --addtag @fileserver vg2
</screen>

     </step>
     <step xml:id="bwke0du">
      <para>テキストエディタで、次のコードを使用して<filename> /etc/lvm/lvm.conf</filename>を変更することにより、<literal>@database</literal>、<literal>@fileserver</literal>、<literal>@fileserverbackup</literal>の各タグを定義します。</para>

<screen>
tags {
   database {
      host_list = [ "db1", "db2" ]
   }
   fileserver {
      host_list = [ "fs1" ]
   }
   fileserverbackup {
      host_list = [ "fsb1" ]
   }
}

activation {
   # Activate only if host has a tag that matches a metadata tag
   volume_list = [ "@*" ]
}
</screen>

     </step>
     <step xml:id="bwke0dv">
      <para>変更した<filename> /etc/lvm/lvm.conf</filename>ファイルを4つのホスト(<filename>db1</filename>、<filename>db2</filename>、<filename>fs1</filename>、および<filename>fsb1</filename>)に複製します。</para>
     </step>
     <step xml:id="bwke2yh">
      <para>ファイルサーバホストが故障した場合は、次のコマンドを任意のモードで端末コンソールから入力することにより、<filename>fsb1</filename>上で<filename>vg2</filename>を起動できます。</para>

<screen>
vgchange --addtag @fileserverbackup vg2
vgchange -ay vg2
</screen>

     </step>
    </procedure>
   </section>
   <section xml:id="bwkdtdw">
    <title>オプション2:ローカライズされた管理と設定</title>
    <para>次のソリューションでは、各ホストがアクティブにするボリュームのクラスに関する情報をローカルに保持します。</para>
    <procedure xml:id="bwke3z3">
     <step xml:id="bwke8yi">
      <para role="intro"><literal>@database</literal>タグをボリュームグループ<filename>vg1</filename>のメタデータに追加します。端末コンソールで、次のコマンドを入力します。</para>

<screen>
vgchange --addtag @database vg1
</screen>

     </step>
     <step xml:id="bwke8yj">
      <para><literal>@fileserver</literal>タグをボリュームグループ<filename>vg2</filename>のメタデータに追加します。端末コンソールで、次のコマンドを入力します。</para>

<screen>
vgchange --addtag @fileserver vg2
</screen>

     </step>
     <step xml:id="bwke8yk">
      <para><filename>/etc/lvm/lvm.conf</filename>ファイルでホストタグを有効にします。</para>
      <substeps performance="required">
       <step xml:id="bwke8dm">
        <para>テキストエディタで、次のコードを使用して<filename>/etc/lvm/lvm.conf</filename>ファイルを変更することにより、ホストタグ設定ファイルを有効にします。</para>

<screen>
tags {
   hosttags = 1
}
</screen>

       </step>
       <step xml:id="bwke8dn">
        <para>変更した<filename> /etc/lvm/lvm.conf</filename>ファイルを4つのホスト(<filename>db1</filename>、<filename>db2</filename>、<filename>fs1</filename>、および<filename>fsb1</filename>)に複製します。</para>
       </step>
      </substeps>
     </step>
     <step xml:id="bwke7w8">
      <para>ホスト<filename>db1</filename>で、データベースホスト<filename>db1</filename>のアクティベーション設定ファイルを作成します。テキストエディタで、<filename>a /etc/lvm/lvm_db1.conf</filename>ファイルを作成し、次のコードを追加します。</para>

<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>

     </step>
     <step xml:id="bwkeef1">
      <para>ホスト<filename>db2</filename>で、データベースホスト<filename>db2</filename>のアクティベーション設定ファイルを作成します。テキストエディタで、<filename>a /etc/lvm/lvm_db2.conf</filename>ファイルを作成し、次のコードを追加します。</para>

<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>

     </step>
     <step xml:id="bwkeef2">
      <para>ホストfs1で、ファイルサーバホスト<filename>fs1</filename>のアクティベーション設定ファイルを作成します。テキストエディタで、<filename>a /etc/lvm/lvm_fs1.conf</filename>ファイルを作成し、次のコードを追加します。</para>

<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>

     </step>
     <step xml:id="bwkeef3">
      <para>ファイルサーバホスト<filename>fs1</filename>が故障した場合は、スペアのファイルサーバホストfsb1をファイルサーバとして起動します。</para>
      <substeps performance="required">
       <step xml:id="bwkeef4">
        <para>ホスト<filename>fsb1</filename>で、ホスト<filename>fsb1</filename>のアクティベーション設定ファイルを作成します。テキストエディタで、<filename>a /etc/lvm/lvm_fsb1.conf</filename>ファイルを作成し、次のコードを追加します。</para>

<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>

       </step>
       <step xml:id="bwkeef5">
        <para>端末コンソールで、次のコマンドの1つを入力します。</para>

<screen>
vgchange -ay vg2

vgchange -ay @fileserver
</screen>

       </step>
      </substeps>
     </step>
    </procedure>
   </section>
  </section>
 </section>
 <section xml:id="brgpqe2">
  <title>ボリュームグループのサイズ変更</title>
  <para role="intro">Linux LVMのパーティションをボリュームグループに追加/削除することにより、ボリュームグループのサイズを拡大/縮小できます。</para>
  <warning>
   <para>論理ボリュームにより使用中のパーティションを削除すると、データが失われることがあります。</para>
  </warning>
  <procedure xml:id="brgpt5w">
   <step xml:id="brgpt5x">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="brgpt5y">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgpt5z">
    <para>左のパネルで、［ボリューム管理］を選択して展開し、ボリュームグループのリストを表示します。</para>
   </step>
   <step xml:id="brgpt60">
    <para>［ボリューム管理］の下でボリュームグループを選択し、<guimenu>概要</guimenu>タブをクリックします。</para>
   </step>
   <step xml:id="brgpt61">
    <para role="intro">ページ下部にある<guimenu>サイズ変更</guimenu>をクリックします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="brgptkf">
    <para>次のいずれかの操作を行います。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="brgpw44">
       <title>追加:</title>
       <para>1つまたは複数の物理ボリューム(LVMパーティション)を<guimenu>利用可能な物理ボリューム</guimenu>リストから<guimenu>選択した物理ボリューム</guimenu>リストに移動することにより、ボリュームグループのサイズを拡張します。 </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="brgpxfv">
       <title>削除:</title>
       <para>1つまたは複数の物理ボリューム(LVMパーティション)を<guimenu>選択した物理ボリューム</guimenu>リストから<guimenu>利用可能な物理ボリューム</guimenu>リストに移動することにより、ボリュームグループのサイズを縮小します。 </para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step xml:id="brgptf8">
    <para><guimenu>完了</guimenu>をクリックします。</para>
   </step>
   <step xml:id="brgpt62">
    <para><guimenu>次へ</guimenu>をクリックし、変更が一覧されることを確認してから、<guimenu>完了</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="brgqpfy">
  <title>YaSTによる論理ボリュームのサイズ変更</title>
  <procedure xml:id="brgqpvs">
   <step xml:id="brgqsmd">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="brgqsme">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgqsmf">
    <para>左のパネルで、［ボリューム管理］を選択して展開し、ボリュームグループのリストを表示します。</para>
   </step>
   <step xml:id="brgqsmg">
    <para>［ボリューム管理］の下でボリュームグループを選択し、<guimenu>論理ボリューム</guimenu>タブをクリックします。</para>
   </step>
   <step xml:id="brgqsmh">
    <para>ページ下部で、<guimenu>サイズ変更</guimenu>をクリックして［論理ボリュームのサイズ変更］ダイアログボックスを開きます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm12_a.png" width="244pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="brgqpvt">
    <para>スライダを使用して、論理ボリュームのサイズを拡大/縮小します。</para>
    <warning>
     <para>データを含む論理ボリュームのサイズを縮小すると、データが破損することがあります。</para>
    </warning>
   </step>
   <step xml:id="brgqueh">
    <para><guimenu>OK</guimenu>をクリックします。</para>
   </step>
   <step xml:id="brgqulm">
    <para><guimenu>次へ</guimenu>をクリックし、変更が一覧されることを確認してから、<guimenu>完了</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="biuz4lz">
  <title>コマンドによる論理ボリュームのサイズ変更</title>
  <para>論理ボリュームのサイズ変更には、コマンド<command>lvresize</command>、<command>lvextend</command>、および<command>lvreduce</command>が使用されます。構文とオプションについては、これらの各コマンドのマニュアルページを参照してください。</para>
  <para>YaSTパーティショナでも、論理ボリュームのサイズを増やすことができます。YaSTでは<command>parted(8)</command>を使用してパーティションサイズを増やします。 </para>
  <para>LVを拡大するには、VG上に十分な未使用スペースがなければなりません。 </para>
  <para>LVは使用中に拡大または縮小できますが、LV上のファイルシステムについてはこれが不可能な場合があります。LVを拡大、縮小しても、そのボリューム内のファイルシステムのサイズは自動的に変更されません。後でファイルシステムを拡大するには、別のコマンドを使用する必要があります。ファイルシステムのサイズ変更の詳細については、<xref linkend="biuymaa" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
  <para>必ず正しいシーケンスを使用するようにしてください。 </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>LVを拡大する場合は、ファイルシステムを拡大する前にLVを拡大する必要があります。</para>
   </listitem>
   <listitem>
    <para>LVを縮小する場合は、LVを縮小する前にファイルシステムを縮小する必要があります。</para>
   </listitem>
  </itemizedlist>
  <para>論理ボリュームのサイズを拡張するには:</para>
  <procedure xml:id="biuz4s4">
   <step xml:id="biuz7nu">
    <para>端末コンソールを開き、<systemitem>root</systemitem>ユーザとしてログインします。</para>
   </step>
   <step xml:id="biuz81p">
    <para>仮想マシン(Xen VMなど)用に提供されているファイルシステムが論理ボリュームに含まれている場合は、VMをシャットダウンします。</para>
   </step>
   <step xml:id="biuz7ph">
    <para>論理ボリューム上のファイルシステムのマウントを解除します。</para>
   </step>
   <step xml:id="biuz4s5">
    <para>端末コンソールのプロンプトに対して、次のコマンドを入力し、論理ボリュームのサイズを拡大します。</para>

<screen>
lvextend -L +<replaceable>size</replaceable> <replaceable>/dev/vgname/lvname</replaceable>
</screen>

    <para><replaceable>size</replaceable>の場合は、10GBのように、論理ボリュームに追加したい容量を指定してください。<filename><replaceable>/dev/vgname/lvname</replaceable></filename>を、<filename>/dev/vg1/v1</filename>などの論理ボリュームへのLinuxパスに入れ替えます。次に例を示します。</para>

<screen>
lvextend -L +10GB /dev/vg1/v1<replaceable/>
</screen>

   </step>
  </procedure>
  <para>たとえば、LVをLV上の(マウント済みでアクティブな)ReiserFSで10GB拡張するには:</para>

<screen>
lvextend −L +10G <replaceable>/dev/vgname/lvname</replaceable>
resize_reiserfs −s +10GB −f <replaceable>/dev/vg−name/lv−name</replaceable>
</screen>

  <para>たとえば、LVをLV上のReiserFSで5GB縮小するには:</para>

<screen>
umount <replaceable>/mountpoint−of−LV</replaceable>
resize_reiserfs −s −5GB <replaceable>/dev/vgname/lvname</replaceable>
lvreduce <replaceable>/dev/vgname/lvname</replaceable>
mount <replaceable>/dev/vgname/lvname</replaceable> <replaceable>/mountpoint−of−LV</replaceable>
</screen>

 </section>
 <section xml:id="brgpmw3">
  <title>ボリュームグループの削除</title>
  <warning>
   <para>ボリュームグループを削除すると、グループの各メンバーパーティションに含まれているデータがすべて破棄されます。 </para>
  </warning>
  <procedure xml:id="brgppd6">
   <step xml:id="brgppd7">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="brgppd8">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgppd9">
    <para>左のパネルで、［ボリューム管理］を選択し、グループのリストを展開します。</para>
   </step>
   <step xml:id="brgpos4">
    <para>［ボリューム管理］の下でボリュームグループを選択し、<guimenu>概要</guimenu>タブをクリックします。</para>
   </step>
   <step xml:id="brgpos5">
    <para>ページ下部で、<guimenu>削除</guimenu>をクリックし、次に、<guimenu>はい</guimenu>をクリックして削除を確認します。</para>
   </step>
   <step xml:id="brgpos6">
    <para><guimenu>次へ</guimenu>をクリックし、削除したボリュームグループが一覧されることを確認してから(削除は赤いフォントで示されます)、<guimenu>完了</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="brgob84">
  <title>LVMパーティション(物理ボリューム)の削除</title>
  <warning>
   <para>パーティションを削除すると、パーティション内のすべてのデータが破棄されます。 </para>
  </warning>
  <procedure xml:id="brgobbw">
   <step xml:id="brgobki">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="brgobkj">
    <para>YaST内で、<guimenu>ディスクの分割</guimenu>を開きます。</para>
   </step>
   <step xml:id="brgobuj">
    <para>If the Linux LVMパーティションがボリュームグループのメンバーとして使用中の場合は、ボリュームグループからパーティションを削除するか、またはボリュームグループを削除します (<xref linkend="brgpmw3"/>)。</para>
   </step>
   <step xml:id="brgobkk">
    <para>YaSTパーティショナで、<guimenu>ハードディスク</guimenu>の下でデバイス(<filename>sdc</filename>など)を選択す。</para>
   </step>
   <step xml:id="brgobkl">
    <para>［パーティション］ページで、削除したいパーティションを選択して<guimenu>削除</guimenu>をクリックし、<guimenu>はい</guimenu>で削除を確認します。</para>
   </step>
   <step xml:id="brgobkm">
    <para><guimenu>次へ</guimenu>をクリックし、削除したパーティションが一覧されることを確認してから(削除は赤いフォントで示されます)、<guimenu>完了</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="btx9jxu">
  <title>LVMコマンドの使用</title>
  <para>LVMコマンドの使用の詳細については、<xref linkend="btx8b05" xrefstyle="TableXRef"/>で説明されている各コマンドのマニュアルページを参照してください。<systemitem>root</systemitem>ユーザとしてコマンドを実行します。</para>
  <table xml:id="btx8b05">
   <title>LVMコマンド</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="5001*"/>
   <colspec colnum="2" colname="2" colwidth="5001*"/>
    <thead>
     <row><!--id=btx8b06-->
      <entry>
       <para>コマンド</para>
      </entry>
      <entry>
       <para>説明</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row><!--id=btx8b07-->
      <entry>

<screen>
pvcreate <replaceable>&lt;device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>LVLMで物理ボリュームとして使用できるようにデバイス(<filename>/dev/sdb</filename>など)を初期化します。</para>
      </entry>
     </row>
     <row><!--id=btx8yob-->
      <entry>

<screen>
pvdisplay &lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>LVM物理ボリュームに関する情報(現在、論理ボリュームで使用中かどうかなど)を表示します。</para>
      </entry>
     </row>
     <row><!--id=btx8b08-->
      <entry>

<screen>
vgcreate -c y &lt;<replaceable>vg_name&gt;</replaceable> &lt;<replaceable>dev1</replaceable>&gt; [<replaceable>dev2</replaceable>...]
</screen>
</entry>
      <entry>
       <para>指定した1つ以上のデバイスでクラスタ化ボリュームグループを作成します。</para>
      </entry>
     </row>
     <row><!--id=btx8b09-->
      <entry>

<screen>
vgchange -a [ey | n] &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>ボリュームグループおよびその論理ボリュームを入出力用にアクティブ(<literal>-a ey</literal>)または非アクティブ(<literal>-a n</literal>)にします。</para>
       <important>
        <para>クラスタノード上のボリュームグループを排他的にアクティブにするには、<literal>ey</literal>オプションを使用してください。ロードスクリプトではこのオプションがデフォルトで使用されます。</para>
       </important>
      </entry>
     </row>
     <row><!--id=btx8lez-->
      <entry>

<screen>
vgremove &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>ボリュームグループを削除します。このコマンドを使用する前に、論理ボリュームを削除してボリュームグループを非アクティブにしてください。</para>
      </entry>
     </row>
     <row><!--id=btx8b0a-->
      <entry>

<screen>
vgdisplay &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>指定したボリュームグループに関する情報を表示します。</para>
       <para>ボリュームグループの合計物理エクステントを確認するには、次のように入力します。</para>

<screen>
vgdisplay vg_name | grep "Total PE"
</screen>

      </entry>
     </row>
     <row><!--id=b15cnuq5-->
      <entry>

<screen>
lvcreate -L <replaceable>size</replaceable> -n &lt;<replaceable>lv_name</replaceable>&gt; &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>指定したサイズの論理ボリュームを作成します。</para>
      </entry>
     </row>
     <row><!--id=btx8b0b-->
      <entry>

<screen>
lvcreate -L &lt;size&gt; &lt;-T|--thinpool&gt; &lt;<replaceable>vg_name/thin_pool_name</replaceable>&gt;

lvcreate -virtualsize &lt;size&gt; &lt;-T|--thin&gt; 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;

lvcreate -L &lt;size&gt; -T 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; 
-virtualsize &lt;size&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;


</screen>
</entry>
      <entry>
       <para>指定したサイズのシン論理ボリュームまたはシンプールを作成します。</para>
       <para>シンプール、シン論理ボリューム、またはその両方を作成します。オプションの引数(--size)を指定すると、シンプール論理ボリュームが作成されます。オプションの引数(--virtualsize)を指定すると、所定のシンプールボリュームからシン論理ボリュームが作成されます。両方の引数を指定すると、このプールを使用してシンプールとシンボリュームが両方とも作成されます。</para>
      </entry>
     </row>
     <row><!--id=b15cmns0-->
      <entry>

<screen>
lvcreate -s [-L <replaceable>size</replaceable>] -n <replaceable>&lt;snap_volume</replaceable>&gt; <replaceable>&lt;source_volume_path</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>指定した論理ボリュームに対してスナップショットボリュームを作成します。サイズオプション(-L、--size)を指定しなかった場合、スナップショットはシンスナップショットとして作成されます。</para>
      </entry>
     </row>
     <row><!--id=btx8b0c-->
      <entry>

<screen>
lvremove&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para><filename>/dev/vg_name/lv_name</filename>などの論理ボリュームを削除します。</para>
       <para>このコマンドを使用する前に、<command>umount</command>コマンドで論理ボリュームをマウント解除して閉じてください。</para>
      </entry>
     </row>
     <row><!--id=b15cmns1-->
      <entry>

<screen>
lvremove <replaceable>snap_volume_path</replaceable>
</screen>
</entry>
      <entry>
       <para>スナップショットボリュームを削除します。</para>
      </entry>
     </row>
     <row><!--id=b15cmns2-->
      <entry>

<screen role="compact2">
lvconvert --merge  [-b] [-i &lt;<replaceable>seconds</replaceable>&gt;] [&lt;<replaceable>snap_volume_path</replaceable>&gt;[...&lt;snapN&gt;]|@&lt;<replaceable>volume_tag</replaceable>&gt;]
</screen>
</entry>
      <entry>
       <para>スナップショットデータを元のボリュームに戻します(ロールバックまたはマージします)。</para>
      </entry>
     </row>
     <row><!--id=btx8b0d-->
      <entry>

<screen>
vgextend <replaceable>&lt;vg_name&gt;</replaceable>&lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>指定した物理ボリュームを既存のボリュームグループに追加します。</para>
      </entry>
     </row>
     <row><!--id=btx8b0e-->
      <entry>

<screen>
vgreduce <replaceable>&lt;vg_name</replaceable>&gt; &lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>指定した物理ボリュームを既存のボリュームグループから削除します。 </para>
       <important>
        <para>物理ボリュームが論理ボリュームによって使用中でないことを確認してください。使用中の場合は、<command>pvmove</command>コマンドを使用してデータを別の物理ボリュームに移動する必要があります。</para>
       </important>
      </entry>
     </row>
     <row><!--id=btx8b0f-->
      <entry>

<screen>
lvextend -L <replaceable>size</replaceable>&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>指定した論理ボリュームのサイズを拡張します。その後、新たに使用可能になった領域を利用できるようにするため、ファイルシステムを拡張する必要もあります。</para>
      </entry>
     </row>
     <row><!--id=btx8b0g-->
      <entry>

<screen>
lvreduce -L <replaceable>size</replaceable> <replaceable>&lt;/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>指定した論理ボリュームのサイズを縮小します。 </para>
       <important>
        <para>ボリュームを縮小する前に、まずファイルシステムのサイズを縮小してください。そうしないと、データを失うリスクがあります。</para>
       </important>
      </entry>
     </row>
     <row><!--id=b11lxo1l-->
      <entry>

<screen>
lvrename <replaceable>&lt;/dev/vg_name/old_lv_name</replaceable>&gt; <replaceable>&lt;/dev/vg_name/new_lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>ボリュームグループの既存のLVM論理ボリュームの名前を新しいボリューム名に変更します。ボリュームグループの名前は変更されません。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </section>
</chapter>

<chapter xml:id="biuymaa" xml:lang="ja" xml:base="02_fs_resize.xml"><title>ファイルシステムのサイズ変更</title><info/>
 
 <para>データのボリュームを増やす必要がある場合は、そのファイルシステムに割り当てられた容量を増やす必要があるかもしれません。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="biuynjy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt5y" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt64" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt6a" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt6g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="biuynjy">
  <title>サイズ変更のガイドライン</title>
  <para>パーティションまたはファイルシステムのサイズ変更には、データを失う可能性をはらむリスクが伴います。 </para>
  <warning>
   <para>データの喪失を避けるには、データを必ずバックアップしてから、サイズ変更タスクを開始します。</para>
  </warning>
  <para>ファイルシステムのサイズを変更する場合は、次のガイドラインに従ってください。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="biuytzx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biuyupz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biuyw0v" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="biuytzx">
   <title>サイズ変更をサポートしているファイルシステム</title>
   <para>ボリュームに使用可能な容量を増やせるようにするには、ファイルシステムがサイズ変更をサポートしている必要があります。SUSE® Linux Enterprise Server 2では、ファイルシステムExt2、Ext3、Ext4、およびReiserFSに対して、ファイルシステムのサイズ変更ユーティリティを使用できます。このユーティリティは、次のようにサイズの増減をサポートします。</para>
   <table xml:id="b8qqe0i">
    <title>ファイルシステムサイズ変更のサポート</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="2500*"/>
    <colspec colnum="3" colname="3" colwidth="2500*"/>
    <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row><!--id=b8qqedo-->
       <entry>
        <para>ファイルシステム</para>
       </entry>
       <entry>
        <para>ユーティリティ</para>
       </entry>
       <entry>
        <para>サイズを増加(拡大)</para>
       </entry>
       <entry>
        <para>サイズの削減(縮小)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bxuadqe-->
       <entry>
        <para>Ext2</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>オフラインのみ</para>
       </entry>
       <entry>
        <para>オフラインのみ</para>
       </entry>
      </row>
      <row><!--id=bxuadqf-->
       <entry>
        <para>Ext3</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>オンラインまたはオフライン</para>
       </entry>
       <entry>
        <para>オフラインのみ</para>
       </entry>
      </row>
      <row><!--id=bxuacq3-->
       <entry>
        <para>Ext4</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>オフラインのみ</para>
       </entry>
       <entry>
        <para>オフラインのみ</para>
       </entry>
      </row>
      <row><!--id=b8qqedr-->
       <entry>
        <para>ReiserFS</para>
       </entry>
       <entry>
        <para>resize_reiserfs</para>
       </entry>
       <entry>
        <para>オンラインまたはオフライン</para>
       </entry>
       <entry>
        <para>オフラインのみ</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </section>
  <section xml:id="biuyupz">
   <title>ファイルシステムのサイズの増加</title>
   <para>デバイス上で使用可能な最大容量までファイルシステムを拡大することも、正確なサイズを指定することもできます。ファイルシステムのサイズを拡大する前に、必ずデバイス、または論理ボリュームのサイズを拡大しておいてください。</para>
   <para>ファイルシステムに正確なサイズを指定する場合は、その新しいサイズが次の条件を満たすかどうかを必ず確認してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新しいサイズは、既存データのサイズより大きくなければなりません。さもないと、データが失われます。 </para>
    </listitem>
    <listitem>
     <para>ファイルシステムのサイズは使用可能な容量より大きくできないので、新しいサイズは、現在のデバイスサイズ以下でなければなりません。</para>
    </listitem>
   </itemizedlist>
  </section>
  <section xml:id="biuyw0v">
   <title>ファイルシステムのサイズの削減</title>
   <para>デバイス上のファイルシステムのサイズを削減する際には、新しいサイズが次の条件を満たすかどうかを必ず確認してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新しいサイズは、既存データのサイズより大きくなければなりません。さもないと、データが失われます。 </para>
    </listitem>
    <listitem>
     <para>ファイルシステムのサイズは使用可能な容量より大きくできないので、新しいサイズは、現在のデバイスサイズ以下でなければなりません。</para>
    </listitem>
   </itemizedlist>
   <para>ファイルシステムが保存されている論理ボリュームのサイズを削減する場合は、デバイス、または論理ボリュームのサイズを削減しようとする前に、必ずファイルシステムのサイズを削減しておきます。</para>
  </section>
 </section>
 <section xml:id="biuzt5y">
  <title>Ext2、Ext3、またはExt4ファイルシステムのサイズの増加</title>
  <para>Ext2、Ext3、およびExt4ファイルシステムのサイズは、ファイルシステムをマウントする際に<command>resize2fs</command>コマンドを使用して増加できます。Ext3ファイルシステムのサイズは、ファイルシステムをアンマウントする際に<command>resizefs</command>コマンドを使用しても増加できます。</para>
  <procedure xml:id="biuzt5z">
   <step xml:id="biuzt60">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
   </step>
   <step xml:id="bxuagy1">
    <para>ファイルシステムがExt2またはExt4である場合は、そのファイルシステムをアンマウントする必要があります。Ext3ファイルシステムは、マウントまたはアンマウントできます。</para>
   </step>
   <step xml:id="biuzt61">
    <para>次の方法の1つで、ファイルシステムのサイズを増加します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>ファイルシステムのサイズを<filename>/dev/sda1</filename>と呼ばれるデバイスの、利用可能な最大サイズまで拡大するには、次のように入力します。</para>

<screen>
resize2fs /dev/sda1
</screen>

      <para>sizeパラメータを指定しない場合、サイズはパーティションのサイズにデフォルト設定されます。</para>
     </listitem>
     <listitem>
      <para>ファイルシステムを特定のサイズに拡張するには、次のコマンドを入力します。 </para>

<screen>
resize2fs /dev/sda1 <replaceable>size</replaceable>
</screen>

      <para><replaceable>size</replaceable>パラメータは、要求されたファイルシステムの新サイズを指定します。単位を指定しない場合のsizeパラメータの単位は、ファイルシステムのブロックサイズです。オプションとして、sizeパラメータの後ろに、次の単位指定子の1つを付けることができます。sは512バイトのセクタ、Kはキロバイト(1キロバイトは1024バイト)、Mはメガバイト、Gはギガバイトを表します。</para>
     </listitem>
    </itemizedlist>
    <para>サイズ変更が完了するまで待って、続行します。</para>
   </step>
   <step xml:id="biuzt62">
    <para>ファイルシステムがマウントされていない場合は、この時点で、ファイルシステムをマウントします。 </para>
    <para>たとえば、Ext2ファイルシステムを、<filename>/dev/sda1</filename>という名前のデバイスに、マウントポイント<filename>/home</filename>でマウントするには、次のように入力します。</para>

<screen>
mount -t ext2 /dev/sda1 /home
</screen>

   </step>
   <step xml:id="biuzt63">
    <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

    <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="biuzt64">
  <title>Reiserファイルシステムのサイズの増加</title>
  <para>ReiserFSファイルシステムのサイズは、マウント中またはアンマウント中のいずれでも拡大することができます。</para>
  <procedure xml:id="biuzt65">
   <step xml:id="biuzt66">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
   </step>
   <step xml:id="biuzt67">
    <para><filename>/dev/sda2</filename>と呼ばれるデバイスのファイルシステムのサイズを拡大するには、次のいずれかの方法を使用します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>ファイルシステムのサイズをデバイスの使用可能な最大サイズまで拡張するには、次のように入力します。</para>

<screen>
resize_reiserfs /dev/sda2
</screen>

      <para>サイズを指定しないと、ボリュームはパーティションのフルサイズまで拡張されます。 </para>
     </listitem>
     <listitem>
      <para>ファイルシステムを特定のサイズに拡張するには、次のコマンドを入力します。</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/sda2
</screen>

      <para><replaceable>size</replaceable>を目的のサイズ(バイト単位)で置き換えます。50000K(キロバイト)、250M(メガバイト)、2G (ギガバイト)など、値の単位を指定することもできます。代わりに、プラス(+)記号を値の前に付けることにより、現在のサイズに対する増加を指定することもできます。たとえば、次のコマンドは、<filename>/dev/sda2</filename>上のファイルシステムのサイズを500MB分増加します。</para>

<screen>
resize_reiserfs -s +500M /dev/sda2
</screen>

     </listitem>
    </itemizedlist>
    <para>サイズ変更が完了するまで待って、続行します。</para>
   </step>
   <step xml:id="biuzt68">
    <para>ファイルシステムがマウントされていない場合は、この時点で、ファイルシステムをマウントします。 </para>
    <para>たとえば、ReiserFSファイルシステムを、デバイス<filename>/dev/sda2</filename>に、マウントポイント<filename>/home</filename>でマウントするには、次のように入力します。</para>

<screen>
mount -t reiserfs /dev/sda2 /home
</screen>

   </step>
   <step xml:id="biuzt69">
    <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

    <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="biuzt6a">
  <title>Ext2またはExt3ファイルシステムのサイズの削減</title>
  <para>ボリュームがマウントされていないときは、Ext2、Ext3、またはExt4ファイルシステムのサイズを縮小できます。</para>
  <procedure xml:id="biuzt6b">
   <step xml:id="biuzt6c">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
   </step>
   <step xml:id="bt5yjdr">
    <para>ファイルシステムをマウント解除します。</para>
   </step>
   <step xml:id="biuzt6d">
    <para><filename>/dev/sda1</filename>などのデバイスのファイルシステムのサイズを削減するには、次のコマンドを入力します。</para>

<screen>
resize2fs /dev/sda1 &lt;size&gt;
</screen>

    <para><replaceable>size</replaceable>を、目的のサイズを表す整数値(キロバイト単位)で置き換えます(1キロバイトは1024バイト)。</para>
    <para>サイズ変更が完了するまで待って、続行します。</para>
   </step>
   <step xml:id="biuzt6e">
    <para>ファイルシステムをマウントします。たとえば、Ext2ファイルシステムを、<filename>/dev/sda1</filename>という名前のデバイスに、マウントポイント<filename>/home</filename>でマウントするには、次のように入力します。</para>

<screen>
mount -t ext2 /dev/md0 /home
</screen>

   </step>
   <step xml:id="biuzt6f">
    <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

    <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="biuzt6g">
  <title>Reiserファイルシステムのサイズの削減</title>
  <para>Reiserファイルシステムは、ボリュームがアンマウントされている場合のみ、サイズを削減することができます。 </para>
  <procedure xml:id="biuzt6h">
   <step xml:id="biuzt6i">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
   </step>
   <step xml:id="biuzt6j">
    <para>次のコマンドを入力して、デバイスをアンマウントします。</para>

<screen>
umount /mnt/point
</screen>

    <para>サイズを削減するパーティションにシステムファイル(ルート<filename>/</filename>ボリュームなど)が含まれていると、ブート可能なCDまたはフロッピーからブートする場合のみ、アンマウントが可能です。</para>
   </step>
   <step xml:id="biuzt6k">
    <para><filename>/dev/sda1</filename>という名前のデバイスのファイルシステムのサイズを削減するには、次のコマンドを入力します。</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/sda2
</screen>

    <para><replaceable>size</replaceable>を目的のサイズ(バイト単位)で置き換えます。50000K(キロバイト)、250M(メガバイト)、2G (ギガバイト)など、値の単位を指定することもできます。代わりに、マイナス(-)記号を値の前に付けて、現在のサイズに対する削減分を指定することもできます。たとえば、次のコマンドは、<filename>/dev/md0</filename>上のファイルシステムのサイズを 500 MB分減少させます。</para>

<screen>
resize_reiserfs -s -500M /dev/sda2
</screen>

    <para>サイズ変更が完了するまで待って、続行します。</para>
   </step>
   <step xml:id="biuzt6l">
    <para>次のコマンドで、ファイルシステムをマウントします。 </para>

<screen>
mount -t reiserfs /dev/sda2 /mnt/point
</screen>

   </step>
   <step xml:id="biuzt6m">
    <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

    <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
   </step>
  </procedure>
 </section>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" xml:id="uuid" xml:lang="ja" revision="03/15/10" xml:base="03_uuid.xml"><title>UUIDによるデバイスのマウント</title><info/>
 
 <para>このセクションでは、オプションとして、デバイス名の代わりにUUIDを使用して、ブートローダファイルと<filename>/etc/fstab</filename>ファイルでファイルシステムのデバイスを識別する方法について説明します。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="udev" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="understanduuid" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidbootx86" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidbootia64" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidmoreinfo" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="udev">
  <title>udevによるデバイスの命名</title>
  <para>Linux 2.6以降のカーネルでは、<command>udev</command>によって、永続的なデバイス名を使用した<filename>/dev</filename>ディレクトリのユーザスペースソリューションが提供されます。システムに対してデバイスを追加または削除する場合は、ホットプラグシステムの一部として<command>udev</command>が実行されます。</para>
  <para>ルールのリストが特定デバイス属性との比較に使用されます。<command>udev</command>ルールのインフラストラクチャ(<filename>/etc/udev/rules.d</filename>ディレクトリで定義)は、すべてのディスクデバイスに、それらの認識順序や当該デバイスに使用される接続に関わらず、安定した名前を提供します。<command>udev</command>ツールは、カーネルが作成するすべての該当ブロックデバイスを調べ、一定のバス、ドライブタイプ、またはファイルシステムに基づいて、ネーミングルールを適用します。<command>udev</command>用の独自ルールを定義する方法については、「<link xlink:href="http://reactivated.net/writing_udev_rules.html"><citetitle>Writing udev Rules</citetitle></link>」を参照してください。 </para>
  <para>動的なカーネル提供のデバイスノード名に加えて、<command>udev</command>は、<filename>/dev/disk</filename>ディレクトリ内のデバイスをポイントする永続的なシンボリックリンクのクラスを保持します。このディレクトリは、さらに、<filename>by-id</filename>、<filename>by-label</filename>、<filename>by-path</filename>、および<filename>by-uuid</filename>の各サブディレクトリに分類されます。 </para>
  <note>
   <para><command>udev</command>以外のプログラム(LVMや<command>md</command>など)も、UUIDを生成することがありますが、それらのUUIDは<filename>/dev/disk</filename>にリストされません。</para>
  </note>
 </section>
 <section xml:id="understanduuid">
  <title>UUIDの理解</title>
  <para>UUID (Universally Unique Identifier)は、ファイルシステムの128ビットの番号であり、ローカルシステムと他のシステム全体に渡る固有な識別子です。UUIDは、システムハードウェア情報とタイムスタンプをそのシードの一部として、ランダムに生成されます。UUIDは、通常、デバイスに固有なタグを付けるために使用されます。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="usinguuid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="findinguuid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="usinguuid">
   <title>UUIDによるファイルシステムデバイスのアセンブルまたは有効化</title>
   <para>UUIDは、常に、パーティションに対して固有であり、表示の順序またはマウントの場所に依存しません。特定のSANデバイスがサーバに接続されると、システムパーティションが名前変更され、最後のデバイスに移動されます。たとえば、ルート(<filename>/</filename>)がインストール時に<filename>/dev/sda1</filename>に割り当てられている場合は、SANの接続後に<filename>/dev/sdg1</filename>に割り当てられることがあります。この問題を回避する1つの方法は、ブートデバイスのブートローダファイルと<filename>/etc/fstab</filename>ファイルでUUIDを使用することです。 </para>
   <para>製造業者がドライブに割り当てたデバイスIDは、デバイスをどこにマウントしても変更されないので、常に、ブート時に検出できます。UUIDは、ファイルシステムのプロパティであり、ドライブを再フォーマットすれば変更できます。ブートローダファイルでは、通常、デバイスの場所(<filename>/dev/sda1</filename>など）を指定して、デバイスをシステムブート時にマウントします。ブートローダは、デバイスのUUIDと管理者指定のボリュームラベルによってもデバイスをマウントできます。ただし、ラベルとファイルの場所を使用する場合は、パーティションのマウント時にラベル名を変更できません。 </para>
   <para>UUIDは、ソフトウェアRAIDデバイスのアセンブルと起動の基準として使用できます。RAIDが作成されると、<command>md</command>ドライバは、デバイスのUUIDを生成し、その値を<filename>md</filename>スーパーブロックに保存します。 </para>
  </section>
  <section xml:id="findinguuid">
   <title>ファイルシステムデバイスのUUIDの見つけ方</title>
   <para>どのブロックデバイスのUUIDも、<filename>/dev/disk/by-uuid</filename>ディレクトリ内で見つけることができます。たとえば、次のようなUUIDがあります。</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a 
</screen>

  </section>
 </section>
 <section xml:id="uuidbootx86">
  <title>ブートローダと/etc/fstabファイルでのUUIDの使用(x86の場合)</title>
  <para>インストール後、オプションとして、次の手順に従って、x86システムのブートローダファイルと<filename>/etc/fstab</filename>ファイルでシステムデバイスのUUIDを設定できます。</para>
  <para>プロシージャを開始する前に、<filename>/boot/grub/menu.1st</filename>ファイルと<filename>/etc/fstab</filename>ファイルのコピーをとってください。</para>
  <procedure xml:id="b4pdcrj">
   <step xml:id="b4pdcrk">
    <para>SANデバイスの接続なしで、SUSE Linux Enterprise Server for x86をインストールします。</para>
   </step>
   <step xml:id="b4pde5j">
    <para>インストール後、システムをブートします。</para>
   </step>
   <step xml:id="b4pdeci">
    <para><systemitem>root</systemitem>ユーザまたはそれと同等の権限で、端末コンソールを開きます。</para>
   </step>
   <step xml:id="b4pdejm">
    <para><filename>/dev/disk/by-uuid</filename>ディレクトリにナビゲートして、<filename>/boot</filename>、<filename>/root</filename>、および<filename>swap</filename>をインストールしたデバイスのUUIDを見つけます。</para>
    <substeps performance="required">
     <step xml:id="b4pdgjc">
      <para>端末コンソールのプロンプトで、次のように入力します。 </para>

<screen>
cd /dev/disk/by-uuid
</screen>

     </step>
     <step xml:id="b4pdhde">
      <para>次を入力して、すべてのパーティションをリストします。</para>

<screen>
ll
</screen>

     </step>
     <step xml:id="b4pdhy7">
      <para>次のようなUUIDを見つけます。</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>

     </step>
    </substeps>
   </step>
   <step xml:id="b4pdk3y">
    <para>YaSTでブートローダオプションを使用するか、またはテキストエディタを使用して、<filename>/boot/grub/menu.1st</filename>ファイルを編集します。 </para>
    <para>たとえば、次のように変更します。</para>

<screen>
kernel /boot/vmlinuz root=/dev/sda1
</screen>

    <para>変更先:</para>

<screen>
kernel /boot/vmlinuz root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>

    <important>
     <para>間違えた場合は、SAN接続なしでサーバをブートし、参考として<filename>/boot/grub/menu.1st</filename>ファイルのバックアップコピーを使用してエラーを修正できます。</para>
    </important>
    <para>YaSTでブートローダオプションを使用する場合は、値を変更すると、ブートローダファイルに重複行が追加されるという欠陥があります。エディタを使用して、次の重複行を削除します。</para>

<screen>
color white/blue black/light-gray
</screen>


<screen>
default 0
</screen>


<screen>
timeout 8
</screen>


<screen>
gfxmenu (sd0,1)/boot/message
</screen>

    <para>YaSTで、ルート(<filename>/</filename>)デバイスをマウントする方法(UUIDを使用する、ラベルを使用するなど)を変更する際には、ブートローダの設定を再保存して、変更内容をブートローダに対して有効にする必要があります。</para>
   </step>
   <step xml:id="b4pdl03">
    <para><systemitem>root</systemitem>ユーザまたはそれと同等の権限で、次のいずれかを実行してUUIDを<filename>/etc/fstab</filename>ファイルに入力します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para><systemitem>root</systemitem>ユーザとしてYaSTを起動し、<menuchoice> <guimenu>システム</guimenu><guimenu>パーティショナ</guimenu></menuchoice>と選択し、目的のデバイスを選択して、<guimenu>Fstabオプション</guimenu>変更します。</para>
     </listitem>
     <listitem>
      <para><filename>/etc/fstab</filename>ファイルを編集して、システムデバイスのエントリを場所からUUIDに変更します。</para>
      <para>たとえば、ルート(<filename>/</filename>)ボリュームのデバイスパスが<filename>/dev/sda1</filename>で、そのUUIDが<filename>e014e482-1c2d-4d09-84ec-61b3aefde77a</filename>の場合、次のように行エントリを変更します。 </para>

<screen>
/dev/sda1   /            reiserfs   acl,user_xattr        1 1
</screen>

      <para>変更先:</para>

<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1 
</screen>

      <important>
       <para>ファイル内に、不要な文字やスペースが残っていないようにしてください。</para>
      </important>
     </listitem>
    </itemizedlist>
   </step>
  </procedure>
 </section>
 <section xml:id="uuidbootia64">
  <title>ブートローダと/etc/fstabファイルでのUUIDの使用(IA64の場合)</title>
  <para>インストール後、次のプロシージャに従って、IA64システムのブートローダファイルと<filename>/etc/fstab</filename>ファイルにシステムデバイスのUUIDを設定します。IA64はEFI BIOSを使用します。ファイルシステムの環境設定ファイルは、<filename>/boot/efi/SuSE/elilo.conf</filename>であり、<filename>/etc/fstab</filename>ではありません。</para>
  <para>プロシージャを開始する前に、<filename>/boot/efi/SuSE/elilo.conf</filename>ファイルのコピーをとります。</para>
  <procedure xml:id="b4pec1b">
   <step xml:id="b4pec1c">
    <para>SANデバイスを接続せずに、SUSE Linux Enterprise Server for IA64をインストールします。</para>
   </step>
   <step xml:id="b4pec1d">
    <para>インストール後、システムをブートします。</para>
   </step>
   <step xml:id="b4pec1e">
    <para><systemitem>root</systemitem>ユーザまたはそれと同等の権限で、端末コンソールを開きます。</para>
   </step>
   <step xml:id="b4pec1f">
    <para><filename>/dev/disk/by-uuid</filename>ディレクトリにナビゲートして、<filename>/boot</filename>、<filename>/root</filename>、および<filename>swap</filename>をインストールしたデバイスのUUIDを見つけます。</para>
    <substeps performance="required">
     <step xml:id="b4pec1h">
      <para>端末コンソールのプロンプトで、次のように入力します。 </para>

<screen>
cd /dev/disk/by-uuid
</screen>

     </step>
     <step xml:id="b4pec1i">
      <para>次を入力して、すべてのパーティションをリストします。</para>

<screen>
ll
</screen>

     </step>
     <step xml:id="b4pec1j">
      <para>次のようなUUIDを見つけます。</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>

     </step>
    </substeps>
   </step>
   <step xml:id="b4pec1k">
    <para>YaSTでブートローダオプションを使用して、ブートローダファイルを編集します。 </para>
    <para>たとえば、次のように変更します。</para>

<screen>
root=/dev/sda1
</screen>

    <para>変更先:</para>

<screen>
root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>

   </step>
   <step xml:id="b4pec1l">
    <para><filename>/boot/efi/SuSE/elilo.conf</filename>ファイルを編集して、システムデバイスのエントリを場所からUUIDに変更します。</para>
    <para>たとえば、次のように変更します。</para>

<screen>
/dev/sda1   /   reiserfs   acl,user_xattr        1 1
</screen>

    <para>変更先:</para>

<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1
</screen>

    <important>
     <para>ファイル内に、不要な文字やスペースが残っていないようにしてください。</para>
    </important>
   </step>
  </procedure>
 </section>
 <section xml:id="uuidmoreinfo">
  <title>追加情報</title>
  <para><command>udev(8)</command>によるデバイス管理の詳細については、『<citetitle>SUSE® Linux Enterprise Server 11 Administration Guide</citetitle>』の<link xlink:href="http://www.suse.com/documentation/sles11/book_sle_admin/data/cha_udev.html"><quote>Dynamic Kernel Device Management with udev</quote></link>を参照してください。</para>
  <para><command>udev(8)</command>コマンドの詳細については、そのマニュアルページを参照してください。端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
man 8 udev
</screen>

 </section>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" xml:id="multipathing" xml:lang="ja" revision="03/15/10" xml:base="04_mpio.xml"><title>デバイスのマルチパスI/Oの管理</title><info/>
 
 <para>このセクションでは、サーバ/ブロックストレージデバイス間のマルチパスのフェールオーバーおよびパスの負荷分散を管理する方法について説明します。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="mpioovw" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="be5rvii" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiotools" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiosysconf" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostart" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bkj8n9w" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="scandev" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostatus" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioerrormgmt" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostall" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpirk" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpionext" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="mpioovw">
  <title>マルチパスI/Oの理解</title>
  <para>マルチパス処理とは、サーバのホストバスアダプタおよびデバイスのストレージコントローラ間で、複数の物理パスをまたいで、同じ物理または論理ブロックストレージデバイスと通信するサーバの機能です。これは、通常、FC (Fibre Channel)環境またはiSCSI SAN環境で行われます。複数のチャネルが使用可能な際には、内蔵ストレージとのマルチ接続も可能です。 </para>
  <para>Linuxマルチ処理は、接続に耐障害性を与え、アクティブな接続全体.に負荷を分散します。マルチパス処理が設定および実行されていると、自動的に、デバイス接続の障害が特定され、I/Oが代替の接続に再経路指定されます。 </para>
  <para>接続に関しては、多くのトラブルが欠陥のあるアダプタ、ケーブル、またはコントローラが原因で発生します。デバイスにマルチパスI/Oを設定すると、マルチパスドライバがデバイス間のアクティブな接続を監視します。マルチパスドライバは、アクティブなパスのI/Oエラーを検出すると、トラフィックをデバイスの指定セカンダリパスにフェールオーバーします。該当するパスが正常に戻ると、そのパスに制御を戻すことができます。</para>
 </section>
 <section xml:id="be5rvii">
  <title>マルチパス処理のプラニング</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpioovwguide" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122uvel" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingmdadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14ff9rs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bleqcv0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="be5rs3a" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="be5ruyr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="mpioovwguide">
   <title>マルチパス処理のガイドライン</title>
   <para>マルチパスI/Oソリューションのプラニング時には、このセクションのガイドラインに従ってください。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg2qyg" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2qpf" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2qgh" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2q2x" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pi0" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pdq" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pdr" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="beg2qyg">
    <title>前提条件</title>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>マルチパス処理は、デバイスレベルで管理されます。 </para>
     </listitem>
     <listitem>
      <para>マルチパス処理対象のデバイスに使用するストレージアレイで、マルチパス処理がサポートされている必要があります。詳細については、<xref linkend="be5ruyr" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
     </listitem>
     <listitem>
      <para>サーバのホストバスアダプタおよびブロックストレージデバイスのバスコントローラ間に複数の物理パスが存在している場合のみ、マルチパス処理を設定する必要があります。論理デバイスのマルチパスは、サーバの見地から設定します。 </para>
     </listitem>
    </itemizedlist>
   </section>
   <section xml:id="beg2qpf">
    <title>ベンダ提供のマルチパスソリューション</title>
    <para>一部のストレージアレイについては、アレイの物理および論理デバイスのマルチパス処理を管理するための独自のマルチパス処理ソフトウェアがベンダから提供されます。この場合は、ベンダの指示に従って、それらのデバイスのマルチ処理を設定してください。</para>
   </section>
   <section xml:id="beg2qgh">
    <title>ディスク管理タスク</title>
    <para>マルチパスをもつ物理デバイスまたは論理デバイスのマルチパス処理を設定する前に、まず、次のようにディスク管理タスクを実行してください。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>サードパーティーツールで、物理ディスクを小さな論理ディスクに切り分けます。</para>
     </listitem>
     <listitem>
      <para>サードパーティーツールで、物理ディスクまたは論理ディスクをパーティションに分割します。稼働中のシステムでパーティションを変更した場合は、DM-MP(Device Mapper Multipath: デバイスマッパーマルチパス)モジュールによるそれら変更の自動的な検出や反映は行われません。DM-MPIOは再初期化する必要があり、それには、通常、再起動が必要です。</para>
     </listitem>
     <listitem>
      <para>サードパーティーのSANアレイ管理ツールを使用して、ハードウェアRAIDデバイスを作成および設定します。</para>
     </listitem>
     <listitem>
      <para>サードパーティーのSANアレイ管理ツールを使用して、LUNなどの論理デバイスを作成します。所定のアレイにサポートされている論理デバイスタイプは、アレイベンダによって異なります。</para>
     </listitem>
    </itemizedlist>
   </section>
   <section xml:id="beg2q2x">
    <title>ソフトウェアRAID</title>
    <para>LinuxのソフトウェアRAIDの管理ソフトウェアは、マルチパス処理の上で実行されます。複数のI/Oパスを持ち、ソフトウェアRAIDで使用予定の各デバイスは、まず、マルチパス処理用に設定してから、ソフトウェアRAIDデバイスとして作成する必要があります。マルチパスデバイスは自動検出できません。ソフトウェアRAIDは、その下で実行されているマルチパス処理管理を認識しません。</para>
    <para>既存のソフトウェアRAID用のマルチパス処理の設定については、<xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </section>
   <section xml:id="beg2pi0">
    <title>高可用性ソリューション</title>
    <para>ストレージリソースのクラスタリング用の高可用性ソリューションは、各ノード上でマルチパス処理サービスをベースとして実行されます。各ノード上の<filename>/etc/multipath.conf</filename>ファイル内の構成設定が、クラスタ全体で同一であるようにしてください。 </para>
    <para>以下を行って、マルチパスデバイスがすべてのデバイス間で同じ名前であるようにしてください。 </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>UUIDと別名を使用して、マルチパスデバイスの名前が、クラスタ内のすべてのノードで同一となるようにします。別名は、すべてのノードにわたって一意である必要があります。<filename>/etc/multipath.conf </filename>ファイルを、ノードからクラスタ内の他のすべてのノードの<filename>/etc/</filename>ディレクトリにコピーします。</para>
     </listitem>
     <listitem>
      <para>マルチパスがマップされたデバイスを使用する場合は、<filename>dm-uuid*</filename>名または別名を<filename>/dev/disk/by-id</filename>ディレクトリ内で指定し、デバイスの固定パスインスタンスは指定しないようにします。詳細については、<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
     </listitem>
     <listitem>
      <para><literal>user_friendly_names</literal>構成オプションを、無効にしないよう設定します。ユーザフレンドリ名はノードに固有ですが、クラスタ内のすべてのノードにおいてデバイスに同じユーザフレンドリ名が割り当てられてはいない可能性があります。 </para>
      <para>以下の操作により、システム定義のユーザフレンドリ名を、クラスタ内のすべてのノードについて同一にすることができます。</para>
      <orderedlist spacing="normal">
       <listitem>
        <para>1つのノード上の<filename>/etc/multipath.conf</filename>ファイル内で、 </para>
        <orderedlist spacing="normal">
         <listitem>
          <para><literal>user_friendly_names</literal>構成オプションをyesに設定して有効にします。 </para>
          <para>マルチパスは、<filename>/var/lib/multipath/bindings</filename>ファイルを使用して、<filename>/dev/mapper </filename>ディレクトリ内で<filename>mpath&lt;<replaceable>n</replaceable>&gt;</filename>の形式で、デバイスに永続的かつ一意の名前を割り当てます。 </para>
         </listitem>
         <listitem>
          <para>(オプション) <literal>bindings</literal>ファイルに対して別の場所を指定するには、<literal>/etc/multipath.conf</literal>ファイルの<literal>defaults</literal>セクションにある、<filename>bindings_file</filename>オプションを設定します。 </para>
          <para>デフォルトの場所は、<filename>/var/lib/multipath/bindings</filename>です。</para>
         </listitem>
        </orderedlist>
       </listitem>
       <listitem>
        <para>ノード上のマルチパスデバイスをすべて設定します。</para>
       </listitem>
       <listitem>
        <para><filename>/etc/multipath.conf </filename>ファイルを、ノードからクラスタ内の他のすべてのノードの<filename>/etc/</filename>ディレクトリにコピーします。</para>
       </listitem>
       <listitem>
        <para><filename>bindings</filename>ファイルを、ノードから、クラスタ内の他のすべてのノード上の<filename>bindings_file</filename>パスにコピーします。 </para>
       </listitem>
      </orderedlist>
     </listitem>
    </itemizedlist>
    <para>LAN上のデバイスをミラーリングするDRBD (Distributed Replicated Block Device)高可用性ソリューションは、マルチパス処理をベースとして実行されます。複数のI/Oパスを持ち、DRDBソリューションで使用予定のデバイスごとに、マルチパス処理用デバイスを設定してから、DRBDを設定する必要があります。</para>
   </section>
   <section xml:id="beg2pdq">
    <title>ボリュームマネージャ</title>
    <para>LVM2やクラスタ化したLVM2などのボリュームマネージャは、マルチパス処理をベースとして実行されます。LVM2またはcLVM2を使用してセグメントマネージャおよびそのファイルシステムを作成するには、その前に、デバイスのマルチパス処理を設定する必要があります。詳細については、<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </section>
   <section xml:id="beg2pdr">
    <title>仮想化環境</title>
    <para>仮想化環境でマルチパス処理を使用する場合、マルチパス処理は、ホストサーバ環境で制御されます。デバイスのマルチパス処理を設定してから、デバイスを仮想ゲストマシンに割り当ててください。</para>
   </section>
  </section>
  <section xml:id="b122uvel">
   <title>multipath-tools-0.4.9におけるPRIO設定</title>
   <para>SLES 11 SP2では、マルチパスツールを0.4.8から0.4.9にアップグレードしています。PRIO構文が一部変更されているため、<filename>/etc/multipath.conf</filename>ファイルを適宜マニュアルで修正して、新たな構文に準拠するようにする必要があります。</para>
   <para><literal>/etc/multipath.conf</literal>ファイル内の<filename>prio</filename>キーワードが、<filename>multipath-tools-0.4.9</filename>では変更されています。<literal>prio</literal>行で、Prioritizerが指定されます。Prioritizerが引数を必要とする場合、その引数は2行目の<literal>prio_args</literal>キーワードで指定します。これまでは、Prioritizerとその引数は、<literal>prio</literal>行に含まれていました。</para>
   <para>マルチパスツール0.4.9以降では、<literal>/etc/multipath.conf</literal>ファイルの<literal>defaults{}</literal>または<literal>devices{}</literal>セクションの<filename>prio</filename>設定を使用します。キーワード<literal>prio</literal>が、<literal>multipath{)</literal>セクションの個別の<literal>multipaths</literal>定義に指定された場合は、暗黙のうちに無視されます。SLES 11 SP1用のマルチパスツール0.4.8以前では、<literal>multipath{)</literal>セクションの個別の<literal>multipaths</literal>定義内のprio設定で、<literal>defaults{}</literal>または<literal>devices{}</literal>セクションの<literal>prio</literal>設定を上書きすることができました。</para>
  </section>
  <section xml:id="mpiousingdev">
   <title>マルチパスデバイスでのWWID、ユーザフレンドリ名、および別名の使用</title>
   <para role="intro">マルチパスデバイスは、そのWWID、ユーザフレンドリ名、またはそれに割り当てた別名で一意に識別されます。<filename>/dev/sdn</filename>および<filename>/dev/dm-n</filename>の形式のデバイスノード名は、再起動の際に変わる可能性があり、毎回異なるデバイスに割り当てられることになります。デバイスのWWID、ユーザフレンドリ名、および別名は、再起動の際にも変わることなく、デバイスの識別には望ましい方法です。</para>
   <para>LUNディレクトリ全体を使用する場合は(たとえばSAN機能を使用してストレージのパーティションを行っている場合など)、<filename>mkfs</filename>、<command>fstab</command>、ご使用のアプリケーションなどに、<command>/dev/disk/by-id/xxx</command>という名前を使用することができます。パーティションで分割されたデバイスは、デバイス名の後ろに<filename>_part&lt;n&gt;</filename>が付加されます(<filename>/dev/disk/by-id/xxx_part1</filename>など)。</para>
   <para><filename>/dev/disk/by-id</filename>ディレクトリでは、マルチパスのマップ処理がなされたデバイスは、<filename>dm-uuid*</filename>名または別名(<filename>/etc/multipath.conf</filename>ファイル内で別名を割り当てている場合)で表されます。 <filename>scsi-</filename>および<filename>wwn-</filename>のデバイス名は、そのデバイスへの物理的パスを表します。 </para>
   <important>
    <para>マルチパスがマップされたデバイスを使用する場合は、<filename>dm-uuid*</filename>名または別名を<filename>/dev/disk/by-id</filename>ディレクトリ内で指定し、デバイスの固定パスインスタンスは指定しないようにします。</para>
   </important>
   <para><filename>/etc/multipath.conf</filename>ファイル内でデバイスの別名を定義する場合は、必ず各デバイスのWWID (<filename>3600508e0000000009e6baa6f609e7908</filename>など)を使用し、そのWWNは使用しないようにしてください。WWNは、デバイスIDの最初の文字を<filename>0x</filename>で置き換えます(<filename>0x600508e0000000009e6baa6f609e7908</filename>など)。 </para>
   <para>マルチパスデバイスでのユーザフレンドリ名および別名の使用の詳細については、<xref linkend="mpionames" xrefstyle="HeadingOnPage"/>を参照してください。</para>
  </section>
  <section xml:id="mpiousinglvm">
   <title>マルチパスデバイスでのLVM2の使用</title>
   <para><filename>lvm.conf</filename>用の設定ファイルが、固定のパス名ではなく、必ずマルチパスデバイス名をポイントするようにします。これは、<filename>boot.multipath</filename>が有効になっていて、<filename>boot.lvm</filename>以前にロードされていれば、自動的に行われます。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b13iv5ro" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b13iv6p5" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b13iv6p6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="b13iv5ro">
    <title>/etc/lvm/lvm.confファイルでのマルチパスデバイスフィルタの追加</title>
    <para>LVM2は、デフォルトでは、マルチパスデバイスを認識しません。LVM2が物理ボリュームとしてマルチパスデバイスを認識するようにするには、<filename>/etc/lvm/lvm.conf</filename>を修正して、マルチパスのI/O階層でマルチパスデバイスをスキャンするようにする必要があります。 </para>
    <para>マルチパスフィルタを追加すると、LVMは、SAN (/dev/sd*)への個別パスを表す生デバイスノードへの物理的パスをスキャンして使用することができません。マルチパス処理の設定後、必ず、LVMが、デバイス(<filename>/dev/disk/by-id/dm-uuid-.*-mpath-</filename>)のデバイスマッパー名だけをスキャンするようにフィルタパスを指定します。</para>
    <para><filename>/etc/lvm/lvm.conf</filename>を変更してマルチパスを使用するには次の手順に従います。</para>
    <procedure xml:id="bg89qbw">
     <step xml:id="bg89qbx">
      <para><filename>/etc/lvm/lvm.conf</filename>ファイルをテキストエディタで開きます。</para>
      <para><filename>/etc/lvm/lvm.conf</filename>が存在しない場合は、次のコマンドを端末コンソールのプロンプトで入力することによって、現在のLVM設定に基づいた設定ファイルを作成できます。</para>

<screen>
lvm dumpconfig &gt; /etc/lvm/lvm.conf
</screen>

     </step>
     <step xml:id="bg89qku">
      <para><filename>/etc/lvm/lvm.conf</filename>にある<literal>filter</literal>エントリと<literal>types</literal>エントリを、次のように変更します。 </para>

<screen>
filter = [ "a|/dev/disk/by-id/.*|", "r|.*|" ]
types = [ "device-mapper", 1 ]
</screen>

      <para>このように設定すると、LVM2はby-idパスだけをスキャンし、それ以外のすべてのパスを拒否します。 </para>
      <para>ユーザフレンドリ名を使用している場合は、マルチパス処理の設定後に、デバイスマッパー名だけがスキャンされるようにフィルタパスを指定します。次のようにフィルタパスを指定すると、マルチパスデバイス上のパーティションのみが許容されます。</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*-mpath-.*|", "r|.*|" ]
</screen>

      <para>デバイスマッパー名に対して生ディスクとパーティションの両方を許容する場合は、<filename>mpath</filename>の前にハイフン(-)を付けずに、次のように指定します。</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*mpath-.*|", "r|.*|" ]
</screen>

     </step>
     <step xml:id="bg89rst">
      <para>非マルチパスデバイスでもLVM2を使用する場合は、<literal>filter</literal>エントリと<literal>types</literal>エントリに必要な調整を加えて、ご使用の設定に合わせます。さもないと、<filename>lvm.conf</filename>ファイルをマルチパス向けに変更後、<command>pvscan</command>で他のLVMデバイスが認識できなくなります。 </para>
      <para>LVMを使用して設定されたデバイスだけをLVMキャッシュに含めるので、filterでどの非マルチパスデバイスを含めるかについて詳細に指定できる必要があります。</para>
      <para>たとえば、ローカルディスクが<filename>/dev/sda</filename>、すべてのSANデバイスが<filename>/dev/sdb</filename>とそれ以上の場合、次のようにfilterでローカルパスとマルチパスを指定します。</para>

<screen>
filter = [ "a|/dev/sda.*|", "a|/dev/disk/by-id/.*|", "r|.*|" ]
types = [ "device-mapper", 253 ]
</screen>

     </step>
     <step xml:id="bg89rib">
      <para>ファイルを保存します。</para>
     </step>
     <step xml:id="bg89zhw">
      <para>dm-multipathを<filename>/etc/sysconfig/kernel:INITRD_MODULES</filename>に追加します。</para>
     </step>
     <step xml:id="bg8aqrw">
      <para>新しい<filename>initrd</filename>を作成して、デバイスマッパーマルチパスのサービスが変更後の設定でロードされるようにします。<command>mkinitrd</command>の実行が必要なのは、ルート(/)デバイスまたはその一部(<filename>/var</filename>、<filename>/etc</filename>、<filename>/log</filename>など)がSAN上にあり、マルチパスのブートが必要な場合のみです。</para>
      <para>端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
mkinitrd -f multipath
</screen>

     </step>
     <step xml:id="bg89rnr">
      <para>サーバを再起動して、変更内容を適用します。</para>
     </step>
    </procedure>
   </section>
   <section xml:id="b13iv6p5">
    <title>boot.multipathの有効化</title>
    <para>マルチパスのマップが正しく構築されるよう、マルチパスは、LVMの前にロードされる必要があります。  LVMの後にマルチパスをロードすると、マルチパスデバイスに対するデバイスマップが不完全になる可能性があります。なぜなら、LVMによりデバイスがロックされ、 MPIOが正しくマップを作成できないからです。 </para>
    <para>システムデバイスがMPIOやLVMを使用しないローカルなデバイスである場合は、<filename>boot.multipath</filename>と<filename>boot.lvm</filename>の両方を無効にできます。サーバの起動後、LVMを起動する前にマニュアルでマルチパスを起動し、<command>pvscan</command>コマンドを実行してLVMオブジェクトを認識することができます。</para>
   </section>
   <section xml:id="b13iv6p6">
    <title>LVMデバイスに対するMPIOマッピングのトラブルシューティング</title>
    <para>LVMプロセスを開始するには、タイミングが重要です。MPIOのマッピングを行う前にLVMを起動した場合、LVMは、そのマルチパスではなくデバイスに対する固定パスを使用する可能性があります。デバイスは機能するため、その固定パスが失敗となるまで、デバイスのMPIOマップが不完全であることに気が付かないかもしれません。この問題は、<filename>boot.multipath</filename>を有効にして、<xref linkend="b13iv5ro" xrefstyle="HeadingOnPage"/>に記載する指示に従うことで、防ぐことができます。 </para>
    <para>マッピングの問題に関するトラブルシューティングを行うには、<command>dmsetup</command>を使用して、それぞれのマルチパスデバイスに、予定数のパスが存在するかどうかチェックすることができます。<systemitem>root</systemitem>ユーザとして、コマンドプロンプトに次のように入力します。</para>

<screen>
dmsetup ls --tree
</screen>

    <para>以下のサンプルの応答では、最初のデバイスに4つのパスがあります。2番目のデバイスでは、パスは1つだけです。3番目のデバイスには、2つのパスがあります。アクティブなパスとパッシブなパスの区別は、このツールでは報告されません。</para>

<screen>
  vg910-lv00 (253:23)
    └─ 360a980006465576657346d4b6c593362 (253:10)
      |- (65:96)
      |- (8:128)
      |- (8:240)
      └─ (8:16)
  vg00-lv08 (253:9)
    └─ (8:3)
  system_vg-data_lv (253:1)
    └─36006016088d014007e0d0d2213ecdf11 (253:0)
      ├─ (8:32)
      └─ (8:48)
</screen>

    <para>不完全なマッピングの場合は通常、返されるパスの数が非常に少なく、メジャー番号の253が表示されません。たとえば、3番目のデバイスでマッピングが不完全な場合を、下に示します。</para>

<screen>
  system_vg-data_lv (8:31)
     └─ (8:32)
</screen>

   </section>
  </section>
  <section xml:id="mpiousingmdadm">
   <title>マルチパスデバイスでのmdadmの使用</title>
   <para><command>mdadm</command>ツールでは、デバイスのノードパスではなく、IDでデバイスにアクセスする必要があります。したがって、<systemitem>/etc/mdadm.conf</systemitem>ファイル内の<filename>DEVICE</filename>を次のように設定して、マルチパスの設定後に、デバイスマッパー名のみがスキャンされるようにする必要があります。</para>

<screen>
DEVICE /dev/disk/by-id/dm-uuid-.*mpath-.*
</screen>

   <para>ユーザフレンドリ名またはマルチパスの別名を使用している場合は、次のようにパスを指定します。</para>

<screen>
DEVICE /dev/disk/by-id/dm-name-.*
</screen>

  </section>
  <section xml:id="b14ff9rs">
   <title>NetAppデバイスでのマルチパスの使用</title>
   <para>NetAppデバイスでマルチパスを使用する場合は、<filename>/etc/multipath.conf</filename>ファイルで次の設定を行うことを推奨します。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>NetAppデバイスに対してグローバルに、次のパラメータにデフォルト値を設定する。</para>

<screen>
max_fds max

queue_without_daemon no
</screen>

    </listitem>
    <listitem>
     <para>ハードウェアテーブル内で、NetAppデバイスに対する次のパラメータにデフォルト値を設定する。</para>

<screen>
dev_loss_tmo infinity

fast_io_fail_tmo 5

features "3 queue_if_no_path pg_init_retries 50"
</screen>

    </listitem>
   </itemizedlist>
  </section>
  <section xml:id="bleqcv0">
   <title>マルチパスデバイスでの--noflushの使用</title>
   <para>マルチパスデバイス上で実行する場合は、オプション<literal>--noflush</literal>を必ず使用する必要があります。 </para>
   <para>たとえば、テーブルのリロードを行うスクリプトでは、マルチパストポロジ情報が必要なので、再開時に<literal>--noflush</literal>オプションを使用して、残っているI/Oがフラッシュされないようにします。</para>

<screen>
load
resume --noflush
</screen>

  </section>
  <section xml:id="bok8cn1">
   <title>ルートデバイスがマルチパスの場合のSANタイムアウト設定</title> 
   <para>マルチパスデバイスにルート(<filename>/</filename>)があるシステムは、すべてのパスに障害が発生し、それらのパスがシステムから削除されると、停止することがあります。これは、ストレージサブシステム(ファイバチャネルストレージアレイなど)から<literal>dev_loss_tmo</literal>タイムアウトを受信するからです。 </para>
   <para>システムデバイスがマルチパスを使用して設定され、マルチパスの<literal>no_path_retry</literal>設定がアクティブな場合は、ストレージサブシステムの<literal>dev_loss_tmo</literal>設定を適宜変更して、すべてのパスがダウンするシナリオでデバイスが削除されないようにする必要があります。<literal>dev_loss_tmo</literal>値をマルチパスの<literal>no_path_retry</literal>設定以上にすることを強くお勧めします。</para>
   <para>ストレージサブシステムの<literal>dev_los_tmo</literal>の推奨設定は、次のとおりです。</para>

<screen>
&lt;dev_loss_tmo&gt; = &lt;no_path_retry&gt; * &lt;polling_interval&gt;
</screen>

   <para>マルチパス値については、次の定義が適用されます。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><literal>no_path_retry</literal>は、パスが失われたとみなされて入出力のキューイングが停止されるまでのマルチパス入出力の再試行数です。 </para>
    </listitem>
    <listitem>
     <para><literal>polling_interval</literal>は、パッチチェックの間隔(秒単位)です。</para>
    </listitem>
   </itemizedlist>
   <para>これらの各マルチパス値は、<filename>/etc/multipath.conf</filename>環境設定ファイルから設定する必要があります。詳細については、<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
  </section>
  <section xml:id="mpiousingpart">
   <title>マルチパスデバイスのパーティショニング</title>
   <para>アップグレード中は、マルチパスデバイスのパーティション方法の動作変更によって、設定に影響を及ぼすことがあります。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="binawqz" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="binazqd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="binazxj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="binawqz">
    <title>SUSE Linux Enterprise Server 11</title>
    <para>SUSE Linux Enterprise Server 11では、デフォルトのマルチパスセットアップは<command>udev</command>を使用して、マルチパス処理の開始時に<filename>/dev/disk/by-id</filename>ディレクトリ内の既存のシンボリックリンクを上書きします。マルチパス処理開始前のシンボリックリンクは、SCSIデバイスをその<filename>scsi-xxx</filename>名でポイントします。マルチパス処理実行中のシンボリックリンクは、SCSIデバイスをその<filename>dm-uuid-xxx</filename>名でポイントします。これによって、マルチパス処理が開始したかどうかに関わりなく、<filename>/dev/disk/by-id</filename>パス内のシンボリックリンクは、継続的に同じデバイスをポイントします。 </para>
    <para><filename>lvm.conf</filename>および<filename>md.conf</filename>に対する環境設定ファイルが、必ずマルチパスデバイスの名前をポイントするようにします。これは、<filename>boot.multipath</filename>が有効になっていて、<filename>boot.lvm</filename>および<filename>boot.md</filename>以前にロードされていれば、自動的に行われます。そうなっていない場合は、LVMおよびMDの環境設定ファイルにマルチパスデバイスに対する固定パスが含まれている可能性があり、マルチパスデバイス名を使用するためにこれらを修正する必要があります。LVM2およびcLVMについては、<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>を参照してください。ソフトウェアRAIDについては、<xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </section>
   <section xml:id="binazqd">
    <title>SUSE Linux Enterprise Server 10</title>
    <para>SUSE Linux Enterprise Server 10では、<filename>kpartx</filename>ソフトウェアを<filename>/etc/init.d/boot.multipath</filename>で使用することで、再起動なしで、任意の新しく作成されたパーティションの環境設定ファイル<filename>multipath.conf</filename>の<filename>/dev/dm-*</filename>行にシンボリックリンクが追加されます。これにより、<filename>udevd</filename>がトリガされて、<filename>/dev/disk/by-*</filename>にシンボリックリンクを書き込みます。主なメリットは、サーバの再起動なしで、新しいパラメータで<filename>kpartx</filename>を呼び出せることです。</para>
   </section>
   <section xml:id="binazxj">
    <title>SUSE Linux Enterprise Server 9</title>
    <para>SUSE Linux Enterprise Server 9では、マルチパスI/Oデバイス自体をパーティショニングすることはできません。ベースになる物理デバイスが既にパーティショニングされている場合、マルチパスI/Oデバイスはそれらのパーティションを反映し、レイヤが<filename>/dev/disk/by-id/&lt;name&gt;p1 ... pN</filename>デバイスを提供するので、マルチパスI/Oレイヤを介してパーティションにアクセスできます。結果として、マルチパスI/Oの有効化の前にデバイスをパーティション分割する必要があります。実行中のシステムのパーティション分割を変更した場合、これらの変更は、DM-MPIOでは自動的な検出および反映はされません。デバイスは、再初期化する必要があり、その際には、通常、再起動が必要です。 </para>
   </section>
  </section>
  <section xml:id="be5rs3a">
   <title>マルチパスI/O用にサポートされているアーキテクチャ</title>
   <para>マルチパス処理のドライバおよびツールは、サポートされている7つのプロセッサアーキテクチャ(IA32、AMD64/EM64T、IPF/IA64、32ビットと64ビットのp-Series、31ビットと64ビットのz-Series)をすべてサポートします。</para>
  </section>
  <section xml:id="be5ruyr">
   <title>マルチパス処理用にサポートされているストレージアレイ</title>
   <para>マルチパス処理のドライバおよび ツールは、大半のストレージアレイをサポートします。マルチパスデバイスを格納するストレージアレイは、マルチパス処理用のドライバとツールを使用するために、マルチパス処理をサポートする必要があります。一部のストレージアレイベンダは、独自のマルチパス処理管理ツールを提供しています。ベンダのハードウェアマニュアルを参照して、どのような設定が必要か判別してください。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="be5s8ae">
    <title>マルチパス処理用に自動検出されるストレージアレイ</title>
    <para><filename>multipath-tools</filename>パッケージは、次のようなトレージアレイを自動的に検出します。</para>
    <simplelist>
     <member>3PARdata VV</member> <member>AIX NVDISK</member> <member>AIX VDASD</member> <member>APPLE Xserve RAID</member> <member>COMPELNT Compellent Vol</member> <member>COMPAQ/HP HSV101、HSV111、HSV200、HSV210、HSV300、HSV400、HSV 450</member> <member>COMPAQ/HP MSA、HSV</member> <member>COMPAQ/HP MSA VOLUME</member> <member>DataCore SANmelody</member> <member>DDN SAN DataDirector</member> <member>DEC HSG80</member> <member>DELL MD3000</member> <member>DELL MD3000i</member> <member>DELL MD32xx</member> <member>DELL MD32xxi</member> <member>DGC</member> <member>EMC Clariion</member> <member>EMC Invista</member> <member>EMC SYMMETRIX</member> <member>EUROLOGC FC2502</member> <member>FSC CentricStor</member> <member>FUJITSU ETERNUS_DX、DXL、DX400、DX8000</member> <member>HITACHI DF</member> <member>HITACHI/HP OPEN</member> <member>HP A6189A</member> <member>HP HSVX700</member> <member>HP LOGICAL VOLUME</member> <member>HP MSA2012fc、MSA 2212fc、MSA2012i</member> <member>HP MSA2012sa、MSA2312 fc/i/sa、MCA2324 fc/i/sa、MSA2000s VOLUME</member> <member>HP P2000 G3 FC|P2000G3 FC/iSCSI|P2000 G3 SAS|P2000 G3 iSCSI</member> <member>IBM 1722-600</member> <member>IBM 1724</member> <member>IBM 1726</member> <member>IBM 1742</member> <member>IBM 1745、1746</member> <member>IBM 1750500</member> <member>IBM 1814</member> <member>IBM 1815</member> <member>IBM 1818</member> <member>IBM 1820N00</member> <member>IBM 2105800</member> <member>IBM 2105F20</member> <member>IBM 2107900</member> <member>IBM 2145</member> <member>IBM 2810XIV</member> <member>IBM 3303 NVDISK</member> <member>IBM 3526</member> <member>IBM 3542</member> <member>IBM IPR</member> <member>IBM Nseries</member> <member>IBM ProFibre 4000R</member> <member>IBM S/390 DASD ECKD</member> <member>IBM S/390 DASD FBA</member> <member>Intel Multi-Flex</member> <member>LSI/ENGENIO INF-01-00</member> <member>NEC DISK ARRAY</member> <member>NETAPP LUN</member> <member>NEXENTA COMSTAR</member> <member>Pillar Axiom</member> <member>PIVOT3 RAIGE VOLUME</member> <member>SGI IS</member> <member>SGI TP9100、TP 9300</member> <member>SGI TP9400、TP9500</member> <member>STK FLEXLINE 380</member> <member>STK OPENstorage D280</member> <member>SUN CSM200_R</member> <member>SUN LCSM100_[IEFS]</member> <member>SUN STK6580、STK6780</member> <member>SUN StorEdge 3510、T4</member> <member>SUN SUN_6180</member>
    </simplelist>
    <para>ただし、他のほとんどのストレージアレイも有効です。ストレージアレイが自動的に検出されると、マルチパス処理のデフォルト設定が適用されます。デフォルト以外の設定を使用したい場合は、手動で<filename>/etc/multipath.conf</filename>ファイルを作成および設定する必要があります。詳細については、<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
    <para>IBM zSeriesデバイスをマルチパス処理でテストした結果、<literal>dev_loss_tmo</literal>パラメータを90秒に、<literal>fast_io_fail_tmo</literal>パラメータを5秒に設定する必要があることがわかりました。zSeriesデバイスをご使用の場合は、手動で<filename>/etc/multipath.conf</filename>ファイルの作成と設定を行い、値を指定する必要があります。詳細については、<xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/>を参照してください。</para>
    <para>自動検出されないハードウェアについては、<filename>/etc/multipath.conf</filename>ファイルの<literal>devices</literal>セクションに環境設定の適切なエントリが必要です。この場合は、手動で、環境設定ファイルを作成し、設定する必要があります。詳細については、<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
    <para>次の点に留意してください。 </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>自動検出されたすべてのストレージアレイがSUSE Linux Enterprise Serverでテスト済みというわけではありません。詳細については、<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>を参照してください。</para>
     </listitem>
     <listitem>
      <para>一部のストレージアレイでは、特定のハードウェアハンドラが必要なことがあります。ハードウェアハンドラは、パスグループの切り替え時とI/Oエラーの処理時に、ハードウェア固有のアクションを実行するカーネルモジュールです。詳細については、<xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/>を参照してください。</para>
     </listitem>
     <listitem>
      <para><filename>/etc/multipath.conf</filename>ファイルの変更後、<command>mkinitrd</command>を実行してシステム上にINITRDを作成し、次に、再起動で変更内容を有効にする必要があります。</para>
     </listitem>
    </itemizedlist>
   </section>
   <section xml:id="mpiosuphw">
    <title>マルチパス処理サポートについてテスト済みのストレージアレイ</title>
    <para>次のストレージアレイは、SUSE Linux Enterprise Serverでテスト済みです。:</para>
    <simplelist>
     <member>EMC</member> <member>Hitachi</member> <member>Hewlett-Packard/Compaq</member> <member>IBM</member> <member>NetApp</member> <member>SGI</member>
    </simplelist>
    <para>他のベンダのストレージアレイもほとんど機能するはずです。該当するベンダのマニュアルを参照してください。<filename>multipath-tools</filename>パッケージによって認識されるデフォルトストレージアレイのリストについては、<xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/>を参照してください。</para>
   </section>
   <section xml:id="be5s6p6">
    <title>特定のハードウェアハンドラを必要とするストレージアレイ</title>
    <para>あるパスから他のパスにフェイルオーバーするには特別なコマンドが必要なストレージアレイ、または非標準の特別なエラー処理が必要なストレージアレイには、より拡張されたサポートが必要なことがあります。したがって、デバイスマッパーマルチパスサービスには、ハードウェアハンドラ用フックがあります。たとえば、そのようなEMC CLARiiON CXファミリアレイ用ハンドラが1つ、既に提供されています。 </para>
    <important>
     <para>ハードウェアベンダのマニュアルを参照して、そのハードウェアハンドラをデバイスマッパーマルチパス用にインストールする必要があるかどうか判別してください。</para>
    </important>
    <para><command>multipath -t</command>コマンドは、特定のハードウェアハンドラで特別な処理を必要とするストレージアレイの内部テーブルを表示します。ただし、表示されるリストは、サポートされているアレイの包括的なリストではありません。特別な処理を必要とし、<filename>multipath-tools</filename>の開発者がツールの開発中にアクセスしたアレイだけがリストされます。</para>
    <important>
     <para>真のアクティブ/アクティブマルチパスサポートをもつアレイは、特別な処理を必要としないので、<command>multipath -t</command>コマンドでは表示されません。 </para>
    </important>
    <para>また、<command>multipath -t</command>テーブルでリストされている場合でも、必ずしも、その特定ハードウェアでSUSE Linux Enterprise Serverがテスト済みということではありません。テスト済みのストレージアレイのリストについては、<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>を参照してください。</para>
   </section>
  </section>
 </section>
 <section xml:id="mpiotools">
  <title>マルチパス管理ツール</title>
  <para>SUSE Linux Enterprise Server 10以降のマルチパス処理サポートは、Linux 2.6カーネルのデバイスマッパーマルチパスモジュールと<systemitem>multipath-tools</systemitem>ユーザスペースパッケージに基づいています。MDADM (Multiple Devices Administration)ユーティリティ(<command>mdadm</command>)を使用すると、マルチパスデバイスの状態を表示できます。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpiotoolsdm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiotoolsmpt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiotoolsmdadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="beep4ms" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="mpiotoolsdm">
   <title>デバイスマッパーマルチパスモジュール</title>
   <para>デバイスマッパーマルチパス(DM-MP)モジュールは、Linuxにマルチパス処理機能を提供します。DM-MPIOは、SUSE Linux Enterprise Server 11でのマルチパス処理の推奨ソリューションです。DM-MPIOは、NovellおよびSUSEによって完全にサポートされている製品に付属する唯一のマルチパス処理オプションです。 </para>
   <para>DM-MPIOは、多様なセットアップでマルチパス処理サブシステムを自動設定します。デバイスごとに最大8個のパスの設定がサポートされています。アクティブ/パッシブ(1つのパスがアクティブで、他のパスがパッシブ)またはアクティブ/アクティブ(ラウンドロビン方式の負荷分散で全パスがアクティブ)の構成がサポートされています。 </para>
   <para>DM-MPIOフレームワークは、2つの方法で拡張できます。 </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>特定のハードウェアハンドラの使用詳細については、<xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/>を参照してください。</para>
    </listitem>
    <listitem>
     <para>ラウンドロビンアルゴリズムより高度な負荷分散アルゴリズムの使用</para>
    </listitem>
   </itemizedlist>
   <para>DM-MPIOのユーザスペースコンポーネントにより、自動的なパスの検出とグループ化のほか、自動的なパスの再テストが実行されるので、障害が発生したパスは、正常に戻ると、自動的に復帰します。これにより、管理者の手間を最低限に抑えることができます。</para>
   <para>DM-MPIOは、デバイス自体の障害ではなく、デバイスへのパスの障害からシステムを保護します。アクティブなパスの1つが失われると(たとえば、ネットワークアダプタが破損する、光ファイバケーブルが外れるなど)、残りのパスにI/Oをリダイレクトします。アクティブ/パッシブ構成の場合は、パスがパッシブパスの1つにフェールオーバーします。ラウンドロビン式負荷分散構成を使用している場合は、トラフィックの負荷が残りの正常なパス全体に分散されます。すべてのアクティブパスに障害が起きた場合は、アクティブでないセカンダリパスが有効になり、約30秒の遅延でフェールオーバーが開始されます。</para>
   <para>ディスクアレイに複数のストレージプロセッサがある場合は、アクセスしたいLUNを所有するストレージプロセッサにSANスイッチが接続していることを必ず確認してください。ほとんどのディスクアレイでは、すべてのLUNが両方のストレージプロセッサに属しているので、両方の接続がアクティブです。 </para>
   <note>
    <para>一部のディスクアレイでは、ストレージアレイがストレージプロセッサを介してトラフィックを管理するので、一度に1つのストレージプロセッサだけが提示されます。1つのプロセッサがアクティブとなり、もう1つのプロセッサは障害が発生するまでパッシブとなります。間違ったストレージプロセッサ(パッシブなパスをもつプロセッサ)に接続している場合は、予期されたLUNが表示されなかったり、それらのLUNが表示されてもアクセスしようとするとエラーが発生することがあります。 </para>
   </note>
   <table xml:id="b567ef1">
    <title>ストレージアレイのマルチパスI/O機能</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2857*"/>
    <colspec colnum="2" colname="2" colwidth="7144*"/>
     <thead>
      <row><!--id=b567fx1-->
       <entry>
        <para>ストレージアレイの機能</para>
       </entry>
       <entry>
        <para>説明</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b567fx2-->
       <entry>
        <para>アクティブ/パッシブコントローラ</para>
       </entry>
       <entry>
        <para>1つのコントローラはアクティブで、すべてのLUNに対応します。2つ目のコントローラは、スタンバイとして機能します。2つ目のコントローラは、オペレーティングシステムが冗長なパスを認識するように、マルチパスコンポーネントに対するLUNの提示も行います。プライマリコントローラに障害が発生した場合は、セカンダリコントローラが引き継ぎ、すべてのLUNに対応します。</para>
        <para>一部のアレイでは、LUNをさまざまなコントローラに割り当てることができます。所定のLUNは、そのアクティブコントローラとなる1つのコントローラに割り当てられます。一度に、1つのコントローラが所定のLUNのディスクI/Oを行い、2つ目のコントローラがそのLUNのスタンバイコントローラとなります。2つ目のコントローラは、パスの提示もしますが、ディスクI/Oは行えません。そのLUNを使用するサーバは、LUNの割り当て先のコントローラに接続します。LUNのセットに対するプライマリコントローラに障害が発生すると、セカンダリコントローラが引き継ぎ、すべてのLUNに対応します。</para>
       </entry>
      </row>
      <row><!--id=b567fx3-->
       <entry>
        <para>アクティブ/パッシブコントローラ</para>
       </entry>
       <entry>
        <para>両方のコントローラがすべてのLUNの負荷を共有し、任意の所定のLUNのディスクI/Oを処理できます。1つのコントローラに障害が発生すると、2つ目のコントローラが自動的にすべてのトラフィックを処理します。</para>
       </entry>
      </row>
      <row><!--id=b567fx4-->
       <entry>
        <para>負荷分散</para>
       </entry>
       <entry>
        <para>デバイスマッパーマルチパスドライバは、自動的に、すべてのアクティブパス全体にトラフィックの負荷を分散します。</para>
       </entry>
      </row>
      <row><!--id=b567fx6-->
       <entry>
        <para>コントローラのフェールオーバー</para>
       </entry>
       <entry>
        <para>アクティブなコントローラがパッシブなコントローラにフェールオーバーすると、デバイスマッパーマルチパスドライバがホスト/スタンバイ間のパスを自動的に有効にし、それらをプライマリパスにします。 </para>
       </entry>
      </row>
      <row><!--id=b567fx5-->
       <entry>
        <para>ブート/ルートデバイスのサポート</para>
       </entry>
       <entry>
        <para>マルチパス処理は、SUSE Linux Enterprise Server 10以降のルート(<filename>/</filename>)デバイスに対してサポートされます。ホストサーバは、ブートデバイス用の、現在アクティブなコントローラおよびストレージプロセッサに接続する必要があります。</para>
        <para>マルチパス処理は、SUSE Linux Enterprise Server 11以降の<filename>/boot</filename>デバイスに対してサポートされています。 </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>デバイスマッパーマルチパスは、マルチパスデバイスの各パスを個別のSCSIデバイスとして検出します。SCSIデバイス名は、<filename>/dev/sd<replaceable>N</replaceable></filename>の形式をとります。ここで、<filename><replaceable>N</replaceable></filename>は、デバイスに対して自動生成される文字であり、aで始まり、デバイスの生成に応じてシーケンシャルに発行されます(<filename>/dev/sda</filename>、<filename>/dev/sdb</filename>など)。デバイス数が26を超えると、文字が2つ使用され、<filename>/dev/sdz</filename>の次のデバイスは<filename>/dev/sdaa、その次は</filename>、その次は<filename>/dev/sdab</filename>と続きます。</para>
   <para>複数のパスが自動的に検出されない場合は、それらを<filename>/etc/multipath.conf</filename>ファイルで手動設定できます。<filename>multipath.conf</filename>ファイルは、システム管理者によって作成および設定されるまで存在しません。詳細については、<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
  </section>
  <section xml:id="mpiotoolsmpt">
   <title>マルチパスI/O管理ツール</title>
   <para><command>multipath-tools</command>ユーザスペースパッケージは、自動的にパスを検出し、グループ化します。このパッケージは、自動的にパスの定期テストを行うので、障害が発生したパスは、正常に戻ると、自動的に復帰します。これにより、管理者の手間を最低限に抑えることができます。</para>
   <table xml:id="b59pxng">
    <title>multipath-toolsパッケージに含まれるツール</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2857*"/>
    <colspec colnum="2" colname="2" colwidth="7144*"/>
     <thead>
      <row><!--id=b59q186-->
       <entry>
        <para>ツール</para>
       </entry>
       <entry>
        <para>説明</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b59q187-->
       <entry>
        <para>multipath</para>
       </entry>
       <entry>
        <para>システムをスキャンしてマルチパスデバイスを検出し、アセンブルします。</para>
       </entry>
      </row>
      <row><!--id=b59q188-->
       <entry>
        <para>multipathd</para>
       </entry>
       <entry>
        <para>mapsイベントを待機し、<command>multipath</command>を実行します。</para>
       </entry>
      </row>
      <row><!--id=b59q189-->
       <entry>
        <para>devmap-name</para>
       </entry>
       <entry>
        <para>デバイスマップ(devmap)のための<command>udev</command>に意味のあるデバイス名を与えます。</para>
       </entry>
      </row>
      <row><!--id=b59q18a-->
       <entry>
        <para>kpartx</para>
       </entry>
       <entry>
        <para>マルチパスデバイス上のパーティションにリニアdevmapをマップします。これにより、デバイス上のパーティションのマルチパスモニタリングを作成することが可能になります。</para>
       </entry>
      </row>
      <row><!--id=b15jwqx6-->
       <entry>
        <para>mpathpersist</para>
       </entry>
       <entry>
        <para>デバイスマッパーマルチパスのデバイスで、SCSIの永続的な予約を管理します。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>パッケージのファイルリストは、サーバのアーキテクチャによって異なることがあります。multipath-toolsパッケージに含まれたファイルのリストについては、<link xlink:href="http://www.novell.com/products/server/techspecs.html?tab=1">「<citetitle>SUSE Linux Enterprise Server Technical Specifications</citetitle>」&gt;「<citetitle>Package Descriptions </citetitle>」Webページ</link>にアクセスし、目的のアーキテクチャを見つけ、<guimenu>パッケージを名前でソート</guimenu>を選択し、次に、<quote>multipath-tools</quote>で検索して、そのアーキテクチャのパッケージリストを見つけます。</para>
   <para>コマンドオプション<command>rpm -ql</command>または<command>rpm -qpl</command>を使用してパッケージ自体をクエリすることによって、RPMファイルのファイルリストを判別することもできます。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>インストールしたパッケージをクエリするには、次のコマンドを入力します。</para>

<screen>
rpm -ql &lt;<replaceable>package_name</replaceable>&gt;
</screen>

    </listitem>
    <listitem>
     <para>インストールしていないパッケージをクエリするには、次のコマンドを入力します。</para>

<screen>
rpm -qpl &lt;<replaceable>URL_or_path_to_package</replaceable>&gt;
</screen>

    </listitem>
   </itemizedlist>
   <para><filename>multipath-tools</filename>パッケージがインストールされているかどうか確認するには、次の操作を行います。</para>
   <procedure xml:id="bcmre1m">
    <step xml:id="bcmre1n">
     <para>端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
rpm -q multipath-tools
</screen>

     <para>パッケージがインストールされている場合は、パッケージ名を繰り返し、バージョン情報を示す応答メッセージが表示されます。</para>

<screen>
multipath-tools-04.7-34.23
</screen>

     <para>パッケージがインストールされていない場合は、次の応答メッセージが表示されます。</para>

<screen>
package multipath-tools is not installed
</screen>

    </step>
   </procedure>
  </section>
  <section xml:id="mpiotoolsmdadm">
   <title>マルチパスデバイスへのMDADMの使用</title>
   <para>デフォルトのデバイスハンドラはUdevであり、デバイスは、デバイスノード名ではなく、Worldwide IDによって、システムに自動的に認識されます。これによって、環境設定ファイル(<filename>mdadm.conf</filename>と<filename>lvm.conf)</filename>がマルチパスデバイスを正しく認識しないという、MDADMおよびLVMの旧リリースにあった問題が解決します。 </para>
   <para>LVM2の場合のようにmdadmでは、デバイスノードパスではなく、IDによってデバイスをアクセスする必要があります。したがって、<filename>/etc/mdadm.conf</filename>内の<systemitem>DEVICE</systemitem>エントリを次のように設定してください。 </para>

<screen>
DEVICE /dev/disk/by-id/*
</screen>

   <para>ユーザフレンドリな名前を使用している場合は、次のようにパスを指定し、マルチパス処理の設定後に、デバイスマッパー名だけがスキャンされるようにします。</para>

<screen>
DEVICE /dev/disk/by-id/dm-uuid-.*-mpath-.*
</screen>

   <para>MDADMのインストールを確認するには、次を行います。</para>
   <procedure xml:id="bcmrfp3">
    <step xml:id="bcmrfp4">
     <para>端末コンソールのプロンプトで、次のコマンドを入力し、<filename>mdadm</filename>パッケージがインストールされているかどうか確認します。</para>

<screen>
rpm -q mdadm
</screen>

     <para>パッケージがインストールされている場合は、パッケージ名を繰り返し、バージョン情報を示す応答メッセージが表示されます。次に例を示します。</para>

<screen>
mdadm-2.6-0.11
</screen>

     <para>パッケージがインストールされていない場合は、次の応答メッセージが表示されます。</para>

<screen>
package mdadm is not installed
</screen>

    </step>
   </procedure>
   <para><filename>/etc/lvm/lvm.conf </filename>ファイルの変更方法については、<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
  </section>
  <section xml:id="beep4ms">
   <title>Linux multipath(8)コマンド</title>
   <para>マルチパスデバイスを設定し、管理するには、<command>multipath(8)</command>コマンドを使用します。</para>
   <para><command>multipath(8)</command>コマンドの一般構文:</para>

<screen>
multipath [-v verbosity_level] [-b bindings_file] [-d] [-h|-l|-ll|-f|-F|-B|-c|-q|-r|-w|-W] [-p failover|multibus|group_by_serial|group_by_prio|group_by_node_name] [<replaceable>devicename</replaceable>]
</screen>

   <bridgehead xml:id="b15drtkg">オプション</bridgehead>
   <variablelist>
    <varlistentry xml:id="b15drtkh">
     <term>-v verbosity_level</term>
     <listitem>
      <para>すべてのパスとマルチパスをプリントします。</para>
      <variablelist>
       <varlistentry xml:id="b15drtki">
        <term>0</term>
        <listitem>
         <para>出力はありません。</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15drtkj">
        <term>1</term>
        <listitem>
         <para>作成または更新したマルチパスの名前のみをプリントします。<command>kpartx</command>などの他のツールへのフィード用として使用されます。</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15drtkk">
        <term>2+</term>
        <listitem>
         <para>検出したパス、マルチパス、デバイスマップなど、すべての情報をプリントします。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkl">
     <term>-h</term>
     <listitem>
      <para>使用テキストをプリントします。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkm">
     <term>-d</term>
     <listitem>
      <para>ドライ実行。デバイスマップの作成や更新は行いません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkn">
     <term>-l</term>
     <listitem>
      <para><filename>sysfs</filename>やデバイスマッパーからフェッチした情報に基づいて、現在のマルチパストポロジを表示します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtko">
     <term>-ll</term>
     <listitem>
      <para>すべての使用可能な情報(sysfs、デバイスマッパー、パスチェッカなど)から現在のマルチパストポロジを表示します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkp">
     <term>-f</term>
     <listitem>
      <para>未使用の場合、パラメータとして指定したマルチパスデバイスマップをフラッシュします。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkq">
     <term>-F</term>
     <listitem>
      <para>未使用のマルチパスデバイスのマップをすべてフラッシュします。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkr">
     <term>-t</term>
     <listitem>
      <para>内部のハードウェアテーブルを<filename>stdout</filename>にプリントします。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtks">
     <term>-r</term>
     <listitem>
      <para>デバイスマップの再ロードを強制します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkt">
     <term>-B</term>
     <listitem>
      <para>バインディングファイルを読み込み専用として処理します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtku">
     <term>-b bindings_file</term>
     <listitem>
      <para>user_friendly_namesバインディングファイルの場所を設定します。デフォルトは<filename>/etc/multipath/bindings</filename>です。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkv">
     <term>-c</term>
     <listitem>
      <para>ブロックデバイスをマルチパスデバイスのパスにする必要があるかどうかをチェックします。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkw">
     <term>-q</term>
     <listitem>
      <para><filename>multipathd</filename>が実行中でない場合、<literal>queue_if_no_path</literal>を指定したデバイステーブルを許可します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtkx">
     <term>-w</term>
     <listitem>
      <para>WWIDファイルから、指定したデバイスのWWIDを削除します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drtky">
     <term>-W</term>
     <listitem>
      <para>現在のマルチパスデバイスのみを含めるようにWWIDファイルをリセットします。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drv6f">
     <term>-p policy</term>
     <listitem>
      <para>新しいマップでの指定したポリシーの使用を強制します。既存のマップは変更されません。</para>
      <variablelist>
       <varlistentry xml:id="b15drv6g">
        <term>failover (フェールオーバー)</term>
        <listitem>
         <para>優先度グループごとに1つのパス</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15drv6h">
        <term>multibus</term>
        <listitem>
         <para>1つの優先度グループ内にすべてのパス</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15drv6i">
        <term>group_by_serial</term>
        <listitem>
         <para>シリアルごとに1つの優先度グループ。</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15drv6j">
        <term>group_by_prio</term>
        <listitem>
         <para>優先度値ごとに1つの優先度グループ。優先度は、コールアウトプログラムで決定されます。それらのプログラムは、グローバル、コントローラごと、またはマルチパスごとのオプションとして環境設定ファイルで指定されます。</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15drv6k">
        <term>group_by_node_name</term>
        <listitem>
         <para>ターゲットノード名ごとに1つの優先度グループターゲットノード名は<filename>/sys/class/fc_transport/target*/node_name</filename>にフェッチされます。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15drx1o">
     <term>device_name</term>
     <listitem>
      <para>指定したデバイスのデバイスマップのみを更新します。<filename>/dev/sdb</filename>などのデバイスパス、<literal><replaceable>major</replaceable>:<replaceable>minor</replaceable></literal>フォーマット、またはマルチパスマップ名として名前を指定します。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead xml:id="beep4mt">一般的な例</bridgehead>
   <variablelist>
    <varlistentry xml:id="bomamxl">
     <term>multipath</term>
     <listitem>
      <para>すべてのマルチパスデバイスを設定します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomalct">
     <term>multipath <replaceable>devicename</replaceable></term>
     <listitem>
      <para>特定のマルチパスデバイスを設定します。</para>
      <para><replaceable>devicename</replaceable>を、<filename>/dev/sdb</filename> (udevにより$DEVNAME変数で表示)またはmajor:minor形式などのデバイスノード名で置き換えます。<literal/>デバイス名は、マルチパスマップ名でも構いません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomamxm">
     <term>multipath -f</term>
     <listitem>
      <para>マルチパスマップとそのデバイスにマップされたパーティションを選択的に抑制します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomamxn">
     <term>multipath -d</term>
     <listitem>
      <para>ドライ実行。可能性のあるマルチパスデバイスを表示しますが、デバイスの作成やデバイスマップの更新は行いません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomamxo">
     <term>multipath -v2 -d</term>
     <listitem>
      <para>ドライ実行で可能性のあるマルチパスデバイスのマルチパスマップ情報を表示します。-v2オプションを使用すると、ローカルディスクのみが表示されます。この冗長レベルでは、kpartxなどの他のツールへのフィード用としてのみ、作成または更新したマルチパスの名前をプリントします。 </para>
      <para>デバイスがすでに存在し、変更がない場合には、出力はありません。設定されているマルチパスデバイスのステータスを見るには、<command>multipath -ll</command>を使用します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomaqc3">
     <term>multipath -v2 <replaceable>devicename</replaceable></term>
     <listitem>
      <para>特定の可能性のあるマルチパスデバイスを設定し、そのマルチパスマップ情報を表示します。この冗長レベルでは、<command>kpartx</command>などの他のツールへのフィード用として、作成または更新したマルチパスの名前だけをプリントします。 </para>
      <para>デバイスがすでに存在し、変更がない場合には、出力はありません。設定されているマルチパスデバイスのステータスを見るには、<command>multipath -ll</command>を使用します。</para>
      <para><replaceable>devicename</replaceable>を、<filename>/dev/sdb</filename><command/> (udevにより$DEVNAME変数で表示)またはmajor:minor形式などのデバイスノード名で置き換えます。<literal/>デバイス名は、マルチパスマップ名でも構いません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomaqc4">
     <term>multipath -v3</term>
     <listitem>
      <para>可能性のあるマルチパスデバイスを設定し、それらのマルチパスマップ情報を表示します。この冗長レベルでは、すべての検出されたパス、マルチパス、およびデバイスマップがプリントされます。wwidおよびデバイスノードの両方でブラックリスト化されたデバイスが表示されます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomaqc5">
     <term>multipath -v3 <replaceable>devicename</replaceable></term>
     <listitem>
      <para>特定の可能性のあるマルチパスデバイスを設定し、それらの情報を表示します。-v3オプションを使用すると、フルパスリストが表示されます。この冗長レベルでは、すべての検出されたパス、マルチパス、およびデバイスマップがプリントされます。wwidおよびデバイスノードの両方でブラックリスト化されたデバイスが表示されます。</para>
      <para><replaceable>devicename</replaceable>を、<filename>/dev/sdb</filename><command/> (udevにより$DEVNAME変数で表示)またはmajor:minor形式などのデバイスノード名で置き換えます。<literal/>デバイス名は、マルチパスマップ名でも構いません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomaqc6">
     <term>multipath -ll</term>
     <listitem>
      <para>すべてのマルチパスデバイスの状態を表示します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomasgg">
     <term>multipath -ll <replaceable>devicename</replaceable></term>
     <listitem>
      <para>指定されたマルチパスデバイスのステータスを表示します。</para>
      <para><replaceable>devicename</replaceable>を、<filename>/dev/sdb</filename><command/> (udevにより$DEVNAME変数で表示)またはmajor:minor形式などのデバイスノード名で置き換えます。<literal/>デバイス名は、マルチパスマップ名でも構いません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomaqc7">
     <term>multipath -F</term>
     <listitem>
      <para>すべての未使用のマルチパスデバイスマップをフラッシュします。これによって、マルチパスが解消したり、デバイスが削除されることはありません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomasgh">
     <term>multipath -F <replaceable>devicename</replaceable></term>
     <listitem>
      <para>指定されたマルチパスデバイスの未使用のマルチパスデバイスマップをフラッシュします。これによって、マルチパスが解消したり、デバイスが削除されることはありません。</para>
      <para><replaceable>devicename</replaceable>を、<filename>/dev/sdb</filename><command/> (udevにより$DEVNAME変数で表示)またはmajor:minor形式などのデバイスノード名で置き換えます。<literal/>デバイス名は、マルチパスマップ名でも構いません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bomasgi">
     <term>multipath -p [ failover | multibus | group_by_serial | group_by_prio | group_by_node_name ]</term>
     <listitem>
      <para><xref linkend="beg177b" xrefstyle="TableXRef"/>に説明されているグループポリシーオプションの1つを指定することにより、グループポリシーを設定します。</para>
      <table xml:id="beg177b">
       <title>multipath -pコマンドのグループポリシーオプション</title>
       <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="2684*"/>
       <colspec colnum="2" colname="2" colwidth="7319*"/>
        <thead>
         <row><!--id=beep4mu-->
          <entry>
           <para>ポリシーオプション</para>
          </entry>
          <entry>
           <para>説明</para>
          </entry>
         </row>
        </thead>
        <tbody>
         <row><!--id=beep4mv-->
          <entry>
           <para>failover (フェールオーバー)</para>
          </entry>
          <entry>
           <para>(デフォルト)優先度グループごとに1つのパス一度に使用できるスパスは1つだけです。</para>
          </entry>
         </row>
         <row><!--id=beep4mw-->
          <entry>
           <para>multibus</para>
          </entry>
          <entry>
           <para>1つの優先度グループ内にすべてのパス</para>
          </entry>
         </row>
         <row><!--id=beep4mx-->
          <entry>
           <para>group_by_serial</para>
          </entry>
          <entry>
           <para>検出されたSCSIシリアル番号(コントローラノードの全世界規模の番号)ごとに1つの優先度グループ</para>
          </entry>
         </row>
         <row><!--id=beep4my-->
          <entry>
           <para>group_by_prio</para>
          </entry>
          <entry>
           <para>パス優先度値ごとに1つの優先度グループ同じ優先度のパスは同じ優先度グループに属します。優先度は、コールアウトプログラムで決定されます。それらのプログラムは、グローバル、コントローラごと、またはマルチパスごとのオプションとして<filename>/etc/multipath.conf</filename>環境設定ファイルで指定されます。</para>
          </entry>
         </row>
         <row><!--id=beep4mz-->
          <entry>
           <para>group_by_node_name</para>
          </entry>
          <entry>
           <para>ターゲットノード名ごとに1つの優先度グループターゲットノード名は、<filename>/sys/class/fc_transport/target*/node_name</filename>にフェッチされます。</para>
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="b15jw320">
   <title>Linux mpathpersist(8)ユーティリティ</title>
   <para><command>mpathpersist(8)</command>ユーティリティを使用して、デバイスマッパーマルチパスのデバイスでSCSIの永続的な予約を管理できます。 </para>
   <para><command>mpathpersist(8)</command>コマンドの一般構文:</para>

<screen>
mpathpersist [options] [device]
</screen>

   <para>このユーティリティを<filename>/etc/multipath.conf</filename>ファイルのサービスアクション予約キー(<literal>reservation_key</literal>属性)と共に使用して、SCSIデバイスの永続的な予約を設定します。この属性はデフォルトでは使用されません。この属性が設定されていない場合、<command>multipathd</command>デーモンは、新しく検出されたパスまたは復元されたパスの永続的な予約があるかどうかを確認しません。 </para>

<screen>
reservation_key &lt;<replaceable>reservation key</replaceable>&gt;
</screen>

   <para>この属性は<literal>defaults</literal>セクションまたは<literal>multipaths</literal>セクションに追加できます。次に例を示します。</para>

<screen>
multipaths {
        multipath {
                          wwid   XXXXXXXXXXXXXXXX
                         alias      yellow
                         reservation_key  0x123abc
      }
}
</screen>

   <para>永続的な管理の対象にするすべてのマルチパスデバイスに対して<literal>reservation_key</literal>パラメータを設定し、<command>multipathd</command>デーモンを再起動します。設定後、mpathpersistコマンドで予約キーを指定できます。</para>
   <bridgehead xml:id="b15jw321">オプション</bridgehead>
   <variablelist>
    <varlistentry xml:id="b15jwii5">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>コマンドの使用情報を出力して終了します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwii6">
     <term>-d &lt;<replaceable>device</replaceable>&gt;</term>
     <term>--device=&lt;<replaceable>device</replaceable>&gt;</term>
     <listitem>
      <para>デバイスをクエリまたは変更します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwii7">
     <term>-H</term>
     <term>--hex</term>
     <listitem>
      <para>出力応答を16進数で表示します。 </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwii8">
     <term>-X &lt;tids&gt;</term>
     <term>--transportID=&lt;tids&gt;</term>
     <listitem>
      <para>トランスポートIDは、さまざまな形式で記述できます。 </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jw322">
     <term>-v &lt;<replaceable>level</replaceable>&gt;</term>
     <term>--verbose &lt;<replaceable>level</replaceable>&gt;</term>
     <listitem>
      <para>詳細レベルを指定します。</para>
      <variablelist>
       <varlistentry xml:id="b15jw323">
        <term>0</term>
        <listitem>
         <para>重要なメッセージおよびエラーメッセージ</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15jw324">
        <term>1</term>
        <listitem>
         <para>警告メッセージ。</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15jw325">
        <term>2</term>
        <listitem>
         <para>情報メッセージ。</para>
        </listitem>
       </varlistentry>
       <varlistentry xml:id="b15jw326">
        <term>3</term>
        <listitem>
         <para>トレースが有効化された情報メッセージ</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead xml:id="b15jwii9">PR Inのオプション</bridgehead>
   <variablelist>
    <varlistentry xml:id="b15jwiie">
     <term>-i</term>
     <term>--での</term>
     <listitem>
      <para>PR Inコマンドを要求します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwiih">
     <term>-k</term>
     <term>--read-keys</term>
     <listitem>
      <para>PR In:キーを読み込みます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwiim">
     <term>-s</term>
     <term>--read-status</term>
     <listitem>
      <para>PR In:完全ステータスを読み込みます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwiin">
     <term>-r</term>
     <term>--read-reservation</term>
     <listitem>
      <para>PR In:予約を読み込みます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwiir">
     <term>-c</term>
     <term>--report-capabilities</term>
     <listitem>
      <para>PR In:機能を報告します。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead xml:id="b15jwiiz">PR Outのオプション</bridgehead>
   <variablelist>
    <varlistentry xml:id="b15jwij0">
     <term>-o</term>
     <term>--out</term>
     <listitem>
      <para>PR Outコマンドを要求します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij1">
     <term>-c</term>
     <term>--クリア</term>
     <listitem>
      <para>PR Out:消去します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij2">
     <term>-Z</term>
     <term>--param-aptpl</term>
     <listitem>
      <para>PR Outパラメータ<literal>APTPL</literal>。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij3">
     <term>-S SARK</term>
     <term>--param-sark=SARK</term>
     <listitem>
      <para>16進数のPR Outパラメータであるサービスアクション予約キー(SARK)。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij4">
     <term>-P</term>
     <term>--preempt</term>
     <listitem>
      <para>PR Out:強制排除します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij5">
     <term>-A</term>
     <term>--preempt-abort</term>
     <listitem>
      <para>PR Out:強制排除して中止します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij6">
     <term>-T &lt;<replaceable>type</replaceable>&gt;</term>
     <term>--prout-type=&lt;<replaceable>type</replaceable>&gt;</term>
     <listitem>
      <para>PR Outコマンドタイプ。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij7">
     <term>-G</term>
     <term>--登録</term>
     <listitem>
      <para>PR Out:登録します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij8">
     <term>-I</term>
     <term>--register-ignore</term>
     <listitem>
      <para>PR Out:登録して無視します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwij9">
     <term>-L</term>
     <term>--release</term>
     <listitem>
      <para>PR Out:解放します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b15jwija">
     <term>-R</term>
     <term>--予約</term>
     <listitem>
      <para>PR Out:予約します。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead xml:id="b15jwmcx">例</bridgehead>
   <para><filename>/dev/mapper/mpath9</filename>デバイスのサービスアクション予約キーを登録します。</para>

<screen role="compact2">
mpathpersist --out --register --param-sark=123abc --prout-type=5 -d /dev/mapper/mpath9
</screen>

   <para><filename>/dev/mapper/mpath9</filename>デバイスのサービスアクション予約キーを読み込みます。</para>

<screen role="compact2">
mpathpersisst -i -k -d /dev/mapper/mpath9
</screen>

   <para><filename>/dev/mapper/mpath9</filename>デバイスのサービスアクション予約キーを予約します。</para>

<screen role="compact2">
mpathpersist --out --reserve --param-sark=123abc --prout-type=8 -d /dev/mapper/mpath9
</screen>

   <para><filename>/dev/mapper/mpath9</filename>デバイスの予約状態を読み込みます。</para>

<screen role="compact2">
mpathpersist -i -s -d /dev/mapper/mpath9
</screen>

  </section>
 </section>
 <section xml:id="mpiosysconf">
  <title>マルチパス処理用システムの設定</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpiosysconfsandevs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiosysconfpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpioboot" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="mpiosysconfsandevs">
   <title>マルチパス処理用SANデバイスの準備</title>
   <para>SANデバイスのマルチパスI/Oを設定する前に、必要に応じて、次のようにSANデバイスを準備してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>ベンダのツールで、SANデバイスを設定し、ゾーン化します。</para>
    </listitem>
    <listitem>
     <para>ベンダのツールで、ストレージアレイ上のホストLUNのパーミッションを設定します。</para>
    </listitem>
    <listitem>
     <para>Linux HBAドライバモジュールをインストールします。モジュールがインストールされると、ドライバがHBAを自動的にスキャンして、ホスト用のパーミッションをもつSANデバイスを検出します。それらのSANデバイスは、以降の設定のため、ホストに提示されます。</para>
     <note>
      <para>ご使用のHBAドライバのネイティブマルチパス処理が有効化していないことを確認してください。</para>
     </note>
     <para>詳細については、ベンダの特定マニュアルを参照してください。</para>
    </listitem>
    <listitem>
     <para>ドライバモジュールがロードされたら、特定アレイのLUNまたはパーティションに割り当てられたデバイスノードを検出します。</para>
    </listitem>
    <listitem>
     <para>SANデバイスがサーバ上でルートデバイスとして使用される場合は、<xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/>に示されているように、デバイスのタイムアウト設定を変更します。</para>
    </listitem>
   </itemizedlist>
   <para>HBAドライバがLUNを認識しない場合は、<command>lsscsi</command>を使用して、SCSIデバイスがオペレーティングシステムによって正しく認識されているかどうかチェックできます。LUNがHBAドライバによって認識されない場合は、SANのゾーン化セットアップをチェックします。特に、LUNのマスキングがアクティブであるかどうか、LUNがサーバに正しく割り当てられているかどうかをチェックしてください。</para>
   <para>LUNがHBAドライバによって認識されても、対応するブロックデバイスが存在しない場合は、カーネルパラメータを追加して、SCSIデバイスのスキャン動作を変更する必要があります(LUNが連続的に番号付けされていないことを示すなど)。<link xlink:href="http://support.novell.com/">Novellサポートナレッジベースにある<citetitle>TID 3955167: Troubleshooting SCSI (LUN) Scanning Issues</citetitle></link>を参照してください。</para>
  </section>
  <section xml:id="mpiosysconfpart">
   <title>マルチパスデバイスのパーティショニング</title>
   <para>複数のパスをもつパーティショニングデバイスは、推奨できませんが、サポートされています。<command>kpartx</command>ツールを使用すると、再起動なしでマルチパスデバイスにパーティションを作成できます。マルチパス処理の設定前に、YaSTのパーティショナ機能またはサードパーティーのパーティショニングツールの使用により、デバイスをパーティショニングすることもできます。</para>
   <para>マルチパスデバイスはデバイスマッパーデバイスです。コマンドラインツール(parted、kpartx、fdiskなど)を使用してデバイスマッパーデバイスを変更することはできますが、他の層を更新するために必要なudevイベントが生成されるとは限りません。デバイスマッパーデバイスをパーティション化した後、マルチパスマップをチェックして、デバイスマッパーデバイスがマップされていることを確認する必要があります。デバイスが見つからない場合は、マルチパスデバイスを再マップするかサーバを再起動すると、マルチパスマップにある新しいパーティションをすべて検出できます。</para>
   <para>マルチパスデバイス上にあるパーティションのデバイスマッパーデバイスは、独立したデバイスと同じではありません。デバイス全体を使用するLVM論理ボリュームを作成する場合、パーティションが含まれないデバイスを指定する必要があります。マルチパスパーティションをLVM論理ボリュームのターゲットデバイスとして設定すると、LVMは、ベースを成す物理デバイスがパーティション化されていると認識し、作成に失敗します。SANデバイスを再分割する必要がある場合、SANデバイス上のLUNを分割し、各LUNを別個のマルチパスデバイスとしてサーバに認識させることができます。</para>
  </section>
  <section xml:id="mpiosysconfsvr">
   <title>initrdでデバイスドライバをマルチパス処理用に設定する </title>
   <para><literal>initrd</literal>で、マルチパスI/Oデバイスの接続先コントローラのデバイスドライバを自動的にロードするには、サーバを手動で設定する必要があります。それには、必要なドライバモジュールを変数INITRD_MODULES(<filename>/etc/sysconfig/kernel</filename>ファイル内)に追加する必要があります。 </para>
   <para>たとえば、システムに<filename>cciss</filename>ドライバでアクセスされるRAIDコントローラがあり、qla2xxxドライバでアクセスされるQlogicコントローラにマルチパスデバイスが接続されている場合は、次のようなエントリになります。 </para>

<screen>
   INITRD_MODULES="cciss"
</screen>

   <para>QLogicドライバは、起動時に自動的にはロードされないので、ここで追加します。 </para>

<screen>
   INITRD_MODULES="cciss qla23xx"
</screen>

   <para><filename>/etc/sysconfig/kernel</filename>の変更後は、システム上で<literal>INITRD</literal>を再作成し(<command>mkinitrd</command>コマンド使用)、次に、再起動して変更内容を有効にする必要があります。</para>
   <para>ブートマネージャとしてLILOを使う場合は、<command>/sbin/lilo</command>コマンドでLILOを再インストールします。GRUBを使っている場合は、何も操作する必要はありません。 </para>
   <para>SUSE Linux Enterprise Server 11 SP3以降、DMマルチパスで使用できる、次の4つのSCSIハードウェアハンドラがSCSI層に追加されました。 </para>
   <simplelist>
    <member><filename>scsi_dh_alua</filename> </member> <member><filename>scsi_dh_rdac</filename> </member> <member><literal>scsi_dh_hp_sw</literal> </member> <member><literal>scsi_dh_emc</literal> </member>
   </simplelist>
   <para>これらのモジュールを<filename>initrd</filename>イメージに追加してから、<filename>/etc/multipath.conf</filename>ファイルでハードウェアハンドラタイプ<literal>alua</literal>、<literal>rdac</literal>、<literal>hp_sw</literal>、および<literal>emc</literal>として指定します。たとえば、デバイス定義に対して次のいずれかの行を追加します。</para>

<screen>
hardware_handler "1 alua"

hardware_handler "1 rdac"

hardware_handler "1 hp_sw"

hardware_handler "1 emc"
</screen>

   <para><filename>initrd</filename>イメージにモジュールを組み込むには:</para>
   <procedure xml:id="b15dscl4">
    <step xml:id="b15dscl5">
     <para>これらのデバイスハンドラモジュールを<filename>/etc/sysconfig/kernel</filename>のINITRD_MODULES変数に追加します。</para>
    </step>
    <step xml:id="b15dscl6">
     <para>新しい<filename>initrd</filename>を作成します。</para>

<screen>
mkinitrd -k /boot/vmlinux-&lt;<replaceable>flavour</replaceable>&gt; \
-i /boot/initrd-&lt;<replaceable>flavour</replaceable>&gt;-scsi-dh \
-M /boot/System.map-&lt;<replaceable>flavour</replaceable>&gt;
</screen>

    </step>
    <step xml:id="b15dscl7">
     <para>ブート環境設定ファイル(<filename>grub.conf</filename>、<filename>lilo.conf</filename>、<filename>yaboot.conf</filename>)を新しく作成した<filename>initrd</filename>で更新します。</para>
    </step>
    <step xml:id="b15dscl8">
     <para>サーバを再起動します。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="mpioboot">
   <title>ブートシーケンスへのmultipathdの追加</title>
   <para>このセクションに示すどちらかの方法を使用して、マルチパスI/Oサービス(<command>multipathd</command>)をブートシーケンスに追加します。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b5c8qi6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b5c8qtj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="b5c8qi6">
    <title>YaSTを使用してmultipathdを追加する</title>
    <procedure xml:id="b5997ck">
     <step xml:id="b5997cl">
      <para>YaSTで内で、<guimenu>システム</guimenu><guimenu>システムサービス(ランレベル)</guimenu><guimenu>簡易モード</guimenu>の順にクリックします。</para>
     </step>
     <step xml:id="b5997cm">
      <para><guimenu>multipathd</guimenu>を選択してから、<guimenu>Enable(有効)</guimenu>をクリックします。 </para>
     </step>
     <step xml:id="b5997cn">
      <para><guimenu>OK</guimenu>をクリックして、サービスの開始メッセージを確認します。</para>
     </step>
     <step xml:id="b5997co">
      <para><guimenu>完了</guimenu>をクリックしてから、<guimenu>はい</guimenu>をクリックします。</para>
      <para>変更内容は、サーバが再起動するまで有効にはなりません。 </para>
     </step>
    </procedure>
   </section>
   <section xml:id="b5c8qtj">
    <title>コマンドラインを使用してmultipathdを追加する</title>
    <procedure xml:id="b5c8qz1">
     <step xml:id="b5c8qz2">
      <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
     </step>
     <step xml:id="b5c8r4x">
      <para>端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
insserv multipathd
</screen>

     </step>
    </procedure>
   </section>
  </section>
 </section>
 <section xml:id="mpiostart">
  <title>マルチパスI/Oサービスの有効化と機動</title>
  <para>マルチパスサービスを有効にし、再起動時に起動するには:</para>
  <procedure xml:id="b7jqkxe">
   <step xml:id="b7jqkxg">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
   </step>
   <step xml:id="b7jqkxh">
    <para>端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
chkconfig multipathd on
</screen>


<screen>
chkconfig boot.multipath on
</screen>

   </step>
  </procedure>
  <para>boot.multipathサービスがシステムブートで自動的に開始しない場合は、次の手順に従って、手動でサービスを開始します。</para>
  <procedure xml:id="b5c8s8w">
   <step xml:id="b5c8s8x">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
   </step>
   <step xml:id="b5c8sla">
    <para>&lt;Enter&gt;</para>

<screen>
/etc/init.d/boot.multipath start
</screen>


<screen>
/etc/init.d/multipathd start
</screen>

   </step>
  </procedure>
 </section>
 <section xml:id="bbillhs">
  <title>/etc/multipath.conf Fileの作成または修正</title>
  <para><filename>/etc/multipath.conf</filename>ファイルは、作成しない限り、存在しません。マルチパスの設定ファイルを作成して設定をパーソナライズしない限り、<command>multipathd</command>デーモンの実行時にデフォルトのマルチパスデバイス設定が自動的に適用されます。<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.synthetic</filename>ファイルには、マルチパス設定の指針となるサンプルファイル <filename>/etc/multipath.conf</filename>が含まれています。 </para>
  <para><filename>/etc/multipath.conf</filename>ファイルの作成または修正を行った場合、ファイルを保存する際に変更が自動的には適用されません。これにより、変更をコミットする前に、それを検証するためのドライ実行を行う時間がとれます。修正した設定で問題なければ、実行中のマルチパスのデーモンに対するマルチパスマップを更新して使用するか、システムの再起動時など、multipathdデーモンの次回起動時に、変更が適用されます。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="beenynn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122wjjt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiohwsupconf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbj8y2r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="beenynn">
   <title>/etc/multipath.confファイルの作成</title>
   <para><filename>/etc/multipath.conf</filename>ファイルが存在しない場合は、次のように、例をコピーしてファイルを作成していください。</para>
   <procedure xml:id="bbillht">
    <step xml:id="bbillhu">
     <para>端末コンソールで、<systemitem>root</systemitem>ユーザとしてログインします。</para>
    </step>
    <step xml:id="bbillhv">
     <para>次のコマンドを入力して(すべて1行で)、テンプレートをコピーします。</para>

<screen>
cp /usr/share/doc/packages/multipath-tools/multipath.conf.synthetic /etc/multipath.conf
</screen>

    </step>
    <step xml:id="bcmqvq2">
     <para><filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename>ファイルを、システムのマルチパス処理の設定方法を決定する参考として使用します。</para>
    </step>
    <step xml:id="bcmqx5z">
     <para>SAN用の適切な<command>device</command>エントリがあることを確認します。大半のベンダは、<command>device</command>セクションの正しいセットアップに関するマニュアルを提供しています。 </para>
     <para><filename>/etc/multipath.conf</filename>ファイルでは、異なるSANには異なる<command>device</command>セクションが必要です。自動的に検出されるストレージサブシステムを使用する場合(<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>参照)、そのデバイスのデフォルトエントリを使用できます。<filename>/etc/multipath.conf</filename>ファイルをさらに設定する必要はありません。 </para>
    </step>
    <step xml:id="bcmqweh">
     <para>ファイルを保存します。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="b122wjjt">
   <title>/etc/multipath.confファイルのセクション</title>
   <para><filename>/etc/multipath.conf</filename>ファイルは、以下のセクションで構成されています。属性とそれらのオプションに関する詳しいコメントの付いたテンプレートについては、<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename>を参照してください。</para>
   <variablelist>
    <varlistentry xml:id="b122vffx">
     <term>defaults</term>
     <listitem>
      <para>マルチパスI/0の全般的デフォルト設定。これらの値は、適切なデバイスセクションまたはマルチパスセクションで値が指定されていない場合に使用されます。詳細については、<xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b12donk3">
     <term>blacklist</term>
     <listitem>
      <para>マルチパスの候補ではないとして破棄するデバイス名の一覧。デバイスは、そのデバイスノード名(<literal>devnode</literal>)、そのWWID (<literal>wwid</literal>)、またはそのベンダまたは製品文字列(<literal>device</literal>)によって識別できます。詳細については、<xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
      <para>通常、非マルチパスデバイス(<filename>cciss</filename>、<filename>fd</filename>、<filename>hd</filename>、<filename>md</filename>、<filename>dm</filename>、<filename>sr</filename>、<filename>scd</filename>、<filename>st</filename>、<filename>ram</filename>、<filename>raw</filename>、<filename>loop</filename>など)は無視します。</para>
      <formalpara xml:id="b122sbge" role="intro">
       <title>値</title>
       <para/>
      </formalpara>
      <para>例については、<xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/>を参照してください。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b12doufy">
     <term>blacklist_exceptions</term>
     <listitem>
      <para>ブラックリストに記載されている場合でもマルチパスの候補として扱うデバイスのデバイス名の一覧。デバイスは、そのデバイスノード名(<literal>devnode</literal>)、そのWWID (<literal>wwid</literal>)、またはそのベンダまたは製品文字列(<literal>device</literal>)によって識別できます。対象のデバイスを指定するには、ブラックリストで使用したのと同じキーワードを使用する必要があります。たとえば、ブラックリスト内のデバイスにdevnodeキーワードを使用している場合は、devnodeキーワードを使用して、ブラックリスト例外にあるデバイスの一部を除外します。<literal>devnode</literal>キーワードを使用し、それらの一部のデバイスを<literal>wwid</literal>キーワードを使用して除外することで、デバイスをブラックリストに入れることはできません。</para>
      <formalpara xml:id="b122sbgg" role="intro">
       <title>値</title>
       <para/>
      </formalpara>
      <para>例として、<xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/>および<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename>ファイルを参照してください。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b122vffy">
     <term>multipaths</term>
     <listitem>
      <para>個々のマルチパスデバイスの設定を指定します。個別設定をサポートしていない設定を除き、これらの値により、設定ファイルの<literal>defaults</literal>および<literal>devices</literal>セクションで指定された値が上書きされます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b122vh2i">
     <term>devices</term>
     <listitem>
      <para>個々のストレージコントローラの設定を指定します。これらの値により、設定ファイル内の<filename>defaults</filename>セクションで指定された値が上書きされます。デフォルトではサポートされていないストレージアレイを使用している場合は、<literal>devices</literal>サブセクションを作成して、そのデフォルト設定を指定することができます。これらの値は、個々のマルチパスデバイスの設定により上書きが可能です(キーワードでそれが許可されていれば)。</para>
      <para>詳細については、次のリンクを参照してください。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
       </listitem>
       <listitem>
        <para><xref linkend="bkj8n9w" xrefstyle="SectTitleOnPage"/></para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="mpiohwsupconf">
   <title>etc/multipath.confファイルでのマルチパスセットアップの確認</title>
   <para><filename>/etc/multipath.conf</filename>ファイルの作成または修正を行った場合、ファイルを保存する際に変更が自動的には適用されません。セットアップの<quote>ドライ実行</quote>を行って、マルチパスのマップを更新する前に、マルチパスセットアップを確認することができます。</para>
   <para>サーバのコマンドプロンプトで、次のように入力します。</para>

<screen>
<command>multipath -v2 -d</command>
</screen>

   <para>このコマンドによりデバイスがスキャンされ、変更をコミットしたときにセットアップがどのようになるかが表示されます。<filename>/etc/multipath.conf</filename>ファイルを修正してドライ実行を行う際に、変更前の(またはデフォルトの)マルチパス設定で、<filename>multipathd</filename>デーモンがすでに実行されていることを前提とします。変更内容に問題がなければ、<xref linkend="bbj8y2r" xrefstyle="HeadingOnPage"/>に進みます。</para>
   <para>出力の例を以下に示します。 </para>

<screen>
26353900f02796769
[size=127 GB]
[features="0"]
[hwhandler="1    emc"] 
</screen>


<screen>
\_ round-robin 0 [first]
  \_ 1:0:1:2 sdav 66:240  [ready ]
  \_ 0:0:1:2 sdr  65:16   [ready ]
</screen>


<screen>
\_ round-robin 0 
  \_ 1:0:0:2 sdag 66:0    [ready ]
  \_ 0:0:0:2 sdc   8:32   [ready ] 
</screen>

   <para>パスは、優先度グループでグループ化されます。一度に1つの優先度グループだけがアクティブに使用されます。アクティブ/アクティブ構成をモデル化するには、すべてのパスを同じグループにします。アクティブ/パッシブ構成をモデル化する場合は、並行してアクティブにしないパスを複数の別の優先度グループに振り分けます。これは、通常、デバイス検出時に自動的に行われます。 </para>
   <para>出力として、順序、グループ内でのI/O負荷の分散に使用されるスケジュールポリシー、および各優先度グループのパスが表示されます。また、各パスに対して、その物理アドレス(ホスト:バス:ターゲット:LUN)、デバイスノード名、メジャー:マイナー番号、および状態が表示されます。 </para>
   <para>ドライ実行で冗長レベルの-v3を使用することによって、すべての検出されたパス、マルチパス、およびデバイスマップを表示できます。WWIDおよびデバイスノードの両方でブラックリスト化されたデバイスが表示されます。</para>

<screen>
multipath -v3 d
</screen>

   <para role="intro">2つのQlogic HBAをXiotech Magnitude 3000 SANに接続した64ビットSLES 11 SP2サーバでの-v3出力の例を、次に示します。例を短くするため、複数エントリの一部は省略されています。</para>

<screen role="compact2">
dm-22: device node name blacklisted
&lt; content omitted &gt;
loop7: device node name blacklisted
&lt; content omitted &gt;
md0: device node name blacklisted
&lt; content omitted &gt;
dm-0: device node name blacklisted
sdf: not found in pathvec
sdf: mask = 0x1f
sdf: dev_t = 8:80
sdf: size = 105005056
sdf: subsystem = scsi
sdf: vendor = XIOtech
sdf: product = Magnitude 3D
sdf: rev = 3.00
sdf: h:b:t:l = 1:0:0:2
sdf: tgt_node_name = 0x202100d0b2028da
sdf: serial = 000028DA0014
sdf: getuid= "/lib/udev/scsi_id --whitelisted --device=/dev/%n" (config file default)
sdf: uid = 200d0b2da28001400 (callout)
sdf: prio = const (config file default)
sdf: const prio = 1
&lt; content omitted &gt;
ram15: device node name blacklisted
&lt; content omitted &gt;
===== paths list =====
uuid              hcil    dev dev_t pri dm_st  chk_st  vend/prod/rev
200d0b2da28001400 1:0:0:2 sdf 8:80  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 1:0:0:1 sde 8:64  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 1:0:0:0 sdd 8:48  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28001400 0:0:0:2 sdc 8:32  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 0:0:0:1 sdb 8:16  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 0:0:0:0 sda 8:0   1   [undef][undef] XIOtech,Magnitude 3D
params = 0 0 2 1 round-robin 0 1 1 8:80 1000 round-robin 0 1 1 8:32 1000
status = 2 0 0 0 2 1 A 0 1 0 8:80 A 0 E 0 1 0 8:32 A 0
sdf: mask = 0x4
sdf: path checker = directio (config file default)
directio: starting new request
directio: async io getevents returns 1 (errno=Success)
directio: io finished 4096/0
sdf: state = 2
&lt; content omitted &gt;
</screen>

  </section>
  <section xml:id="bbj8y2r">
   <title>/etc/multipath.confファイルの変更を適用したマルチパスマップの更新</title>
   <para><filename>/etc/multipath.conf</filename>ファイルに対する変更は、<command>multipathd</command>の実行中は有効になりません。変更を行ったら、ファイルを保存して閉じ、次のように、変更内容を適用してマルチパスマップを更新してください。</para>
   <procedure xml:id="bbj8ync">
    <step xml:id="bbj8ynd">
     <para><command>multipathd</command>サービスを停止します。</para>
    </step>
    <step xml:id="bbj8zk2">
     <para>次のコマンドの入力で、古いmultipathバインディングをクリアします。</para>

<screen>
/sbin/multipath -F
</screen>

    </step>
    <step xml:id="bbj91hd">
     <para>次のコマンドの入力で、新しいmultipathバインディングを作成します。</para>

<screen>
/sbin/multipath -v2 -l
</screen>

    </step>
    <step xml:id="bbj8zu9">
     <para><command>multipathd</command>サービスを開始します。</para>
    </step>
    <step xml:id="bi0ay0m">
     <para><command>mkinitrd</command>を実行して、システム上に<filename>initrd</filename>イメージを再作成し、再起動して変更内容を有効にします。</para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="bbj68de">
  <title>ポーリング、待ち行列、およびフェールバック用のデフォルトポリシーの設定</title>
  <para>マルチパスI/Oの最終目標は、ストレージシステムとサーバ間のコネクティビティ耐障害性を提供することです。望ましいデフォルトの動作は、サーバがスタンダロンのサーバか、高可用性クラスタ内のノードかにより、異なります。 </para>
  <para>スタンドアロンサーバに対してマルチパスI/Oを構成する際は、<literal>no_path_retry</literal>の設定により、サーバのオペレーティングシステムを、I/Oエラーの受信から可能な限り保護することができます。この設定により、メッセージはマルチパスのフェールオーバーが発生するまで待ち行列に入れられ、正常な接続が保たれます。</para>
  <para>高可用性クラスタ内のノードに対してマルチパスI/Oを構成する際は、マルチパスI/Oに障害が発生した場合に、マルチパスのフェールオーバーが解決されるのを待つのではなく、リソースのフェールオーバーをトリガするために、マルチパスが報告を行うようにしたいと考えます。クラスタ環境では、<literal>no_path_retry</literal>設定を、ストレージシステムへの接続が失われた場合に、クラスタノードがクラスタ検証プロセスに関連するI/Oエラー(ハートビート許容値の50%を推奨)を受信するように変更する必要があります。また、パスの障害によるリソースのピンポンを避けるため、マルチパスI/Oのフェールバックは、マニュアルに設定した方がよいでしょう。</para>
  <para><filename>/etc/multipath.conf</filename>ファイルには、ポーリング、待ち行列、およびフェールバックのデフォルト動作を指定できる<command>defaults</command>セクションが含まれています。<command>device</command>セクションで、フィールドが別途指定されていない場合は、そのSAN構成にデフォルト設定が適用されます。</para>
  <para role="intro">デフォルト設定では、以下のようにコンパイルされています。パーソナライズした<filename>/etc/multipath.conf</filename>ファイルを作成して構成することでこれらの値を上書きしない限り、この設定が使用されます。</para>

<screen>
defaults {
  verbosity 2
#  udev_dir is deprecated in SLES 11 SP3
#  udev_dir              /dev
  polling_interval      5
#  path_selector default value is service-time in SLES 11 SP3
#  path_selector         "round-robin 0"
  path selector         "service-time 0"
  path_grouping_policy  failover
#  getuid_callout is deprecated in SLES 11 SP3 and replaced with uid_attribute
#  getuid_callout        "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
#  uid_attribute is new in SLES 11 SP3
  uid_attribute         "ID_SERIAL"
  prio                  "const"
  prio_args             ""
  features              "0"
  path_checker          "directio"
  alias_prefix          "mpath"
  rr_min_io_rq          1
  max_fds               "max"
  rr_weight             "uniform"
  queue_without_daemon  "yes"
  flush_on_last_del     "no"
  user_friendly_names   "no"
  fast_io_fail_tmo      5
  bindings_file         "/etc/multipath/bindings"
  wwids_file            "/etc/multipath/wwids"
  log_checker_err       "always"
  retain_attached_hw_handler  "no"
  detect_prio           "no"
  failback              "manual"
  no_path_retry         "fail"
  }
</screen>

  <para>ポーリング、待ち行列、およびフェールバックの詳細については、<xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/>に記載のパラメータを参照してください。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b122w0sa" xrefstyle="HeadingOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122sbgo" xrefstyle="HeadingOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122sbgh" xrefstyle="HeadingOnPage"/></para>
   </listitem>
  </itemizedlist>
  <para><literal>defaults</literal>セクションで設定を変更した場合、その変更内容は、マルチパスマップを更新するまで、またはmultipathdデーモンを再起動するまで(システムの再起動など)適用されません。</para>
 </section>
 <section xml:id="bbj5x7z">
  <title>非マルチパスデバイスのブラックリスト化</title>
  <para><filename>/etc/multipath.conf</filename>ファイルには、<command>blacklist</command>セクションがあり、このセクションにすべての非マルチパスデバイスがリストされます。WWID (<literal>wwid</literal>キーワード)、デバイス名(<literal>devnode</literal>キーワード)、またはデバイスタイプ(<literal>device</literal>セクション)を使用してデバイスをブラックリスト化できます。<literal>blacklist_exceptions</literal>セクションを使って、<literal>blacklist</literal>セクションで使用している正規表現によってブラックリスト化された特定のデバイスに対してマルチパスを有効にすることもできます。 </para>
  <para>通常、非マルチパスデバイス(<filename>cciss</filename>、<filename>fd</filename>、<filename>hd</filename>、<filename>md</filename>、<filename>dm</filename>、<filename>sr</filename>、<filename>scd</filename>、<filename>st</filename>、<filename>ram</filename>、<filename>raw</filename>、<filename>loop</filename>など)は無視します。たとえば、ローカルのIDEハードドライブやフロッピードライブには通常、複数のパスはありません。<command>multipath</command>で単一パスデバイスを無視する場合は、それらのデバイスを<command>blacklist</command>セクションに記述します。 </para>
  <note>
   <para>キーワード<literal>devnode_blacklist</literal>は廃止され、キーワード<literal>blacklist</literal>に代わりました。</para>
  </note>
  <para>たとえば、<filename>cciss</filename>ドライバからローカルデバイスとすべてのアレイを、multipathによる管理から外してブラックリストに載せるには、<command>blacklist</command>セクションを次のように指定します。</para>

<screen>
blacklist {
      wwid "26353900f02796769"
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
      devnode "^hd[a-z][0-9]*"
      devnode "^cciss.c[0-9]d[0-9].*"
}
</screen>

  <para>アレイ全体でなく、ドライバからのパーティションだけをブラックリスト化することもできます。たとえば、次の正規表現を使用すると、アレイ全体ではなく、<filename>cciss</filename>ドライバからのパーティションだけをブラックリスト化できます。</para>

<screen>
blacklist {
      devnode "^cciss.c[0-9]d[0-9]*[p[0-9]*]"
}
</screen>

  <para>特定のデバイスタイプをブラックリスト化するには、ブラックリストに<literal>device</literal>セクションを追加して、キーワード<literal>vendor</literal>および<literal>product</literal>を使用します。</para>

<screen>
blacklist {
      device {
           vendor  "DELL"
           product "*"
       }
}
</screen>

  <para><literal>blacklist_exceptions</literal>セクションを使って、<literal>blacklist</literal>セクションで使用している正規表現によってブラックリスト化された特定のデバイスに対してマルチパスを有効にできます。WWID (<literal>wwid</literal>キーワード)、デバイス名(<literal>devnode</literal>キーワード)、またはデバイスタイプ(<literal>device</literal>セクション)を使用して例外を追加します。例外は、対応するデバイスをブラックリスト化したときと同じ方法で指定する必要があります。つまり、<literal>wwid</literal>例外は<literal>wwid</literal>ブラックリストに適用され、<literal>devnode</literal>例外は<literal>devnode</literal>ブラックリストに適用され、デバイスタイプ例外はデバイスタイプブラックリストに適用されます。</para>
  <para>たとえば、同じベンダのデバイスタイプが複数ある場合、目的のデバイスタイプに対してマルチパスを有効にできます。そのベンダのデバイスタイプすべてを<literal>blacklist</literal>セクションに記述してブラックリスト化してから、<literal>blacklist_exceptions</literal>セクションに<literal>device</literal>セクションを追加し、目的のデバイスタイプに対してマルチパスを有効にします。</para>

<screen>
blacklist {
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
      device {
           vendor  "DELL"
           product "*"
       }
}

blacklist_exceptions {
      device {
           vendor  "DELL"
           product "MD3220i"
       }
}
</screen>

  <para>blacklist_exceptionsを使用して、特定のデバイスに対してのみマルチパスを有効にすることもできます。次に例を示します。</para>

<screen>
blacklist {
      wwid "*"
}

blacklist_exceptions {
        wwid "3600d0230000000000e13955cc3751234"
        wwid "3600d0230000000000e13955cc3751235"
}
</screen>

  <para><filename>/etc/multipath.conf</filename>ファイルの変更後、<command>mkinitrd</command>を実行してシステム上にINITRDを作成し、次に、サーバを再起動して変更内容を有効にします。<filename/> </para>
  <para>その後は、<command>multipath -ll</command>コマンドの発行時に、ローカルデバイスがマルチパスマップに一覧されなくなります。</para>
 </section>
 <section xml:id="mpionames">
  <title>ユーザフレンドリ名または別名の設定</title>
  <para role="intro">マルチパスデバイスは、そのWWID、ユーザフレンドリな名前、またはそれに割り当てた別名で識別されます。始める前に、「<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/>」の要件をレビューしてください。</para>
  <important>
   <para><filename>/dev/sdn</filename>および<filename>/dev/dm-n</filename>形式のデバイスノード名は、再起動時に変更される可能性があるので、マルチパスデバイスは、そのWWIDで参照することを推奨します。また、WWIDにマップされたユーザフレンドリ名または別名を、再起動時においてもデバイスを一意に識別するために使用することもできます。</para>
  </important>
  <para><xref linkend="bq7xokx" xrefstyle="TableXRef"/>では、 <filename>/etc/multipath.conf</filename>ファイル内のデバイスに使用できるデバイス名のタイプについて説明しています。<filename>multipath.conf</filename>設定の例については、<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.synthetic</filename>ファイルを参照してください。 </para>
  <table xml:id="bq7xokx">
   <title>マルチパスデバイス名のタイプの比較</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="1667*"/>
   <colspec colnum="2" colname="2" colwidth="8334*"/>
    <thead>
     <row><!--id=bq7xoky-->
      <entry>
       <para>名前のタイプ</para>
      </entry>
      <entry>
       <para>説明</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row><!--id=bq7xokz-->
      <entry>
       <para>WWID (デフォルト)</para>
      </entry>
      <entry>
       <para>シリアルWWID (Worldwide Identifier)は、グローバルに固有または非変更であることを保証されたマルチパスデバイスの識別子です。マルチパス処理で使用されるデフォルト名は、<filename>/dev/disk/by-id</filename>ディレクトリにある論理ユニットのIDです。たとえば、WWIDが<literal>3600508e0000000009e6baa6f609e7908</literal>のデバイスは、<filename>/dev/disk/by-id/scsi-3600508e0000000009e6baa6f609e7908</filename>と記載されています。</para>
      </entry>
     </row>
     <row><!--id=bq7xol0-->
      <entry>
       <para>ユーザフレンドリ</para>
      </entry>
      <entry>
       <para><filename>/dev/mapper</filename>ディレクトリ内のデバイスマッパーマルチパスのデバイス名は、論理ユニットのIDも参照します。これらのマルチパスデバイス名は、<filename>/dev/mapper/mpath&lt;<replaceable>n</replaceable>&gt;</filename>形式を使用するユーザフレンドリな名前です(たとえば、<filename>/dev/mapper/mpath0</filename>)。これらの名前は、<filename>/var/lib/multipath/bindings</filename>ファイルを使用してUUIDとユーザフレンドリな名前の関連付けを追跡するので、固有かつ永続的です。 </para>
      </entry>
     </row>
     <row><!--id=bq7xol1-->
      <entry>
       <para>別名</para>
      </entry>
      <entry>
       <para>別名は、グローバルに固有な名前であり、管理者がマルチパスデバイスに提供します。別名は、WWIDとユーザフレンドリな<filename>/dev/mapper/mpathN</filename>名に優先します。</para>
       <para>user_friendly_nameを使用している場合は、別名をmpathN形式に設定しないでください。mpathN形式にすると、自動的に割り当てられたユーザフレンドリ名と競合し、デバイスノードが正しくなくなる可能性があります。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
  <para><filename>/etc/multipath.conf</filename>ファイルのグローバルマルチパスオプション<literal>user_friendly_names</literal>は、マルチパスデバイスのユーザフレンドリ名の使用を有効または無効にするために使用されます。このオプションが「no」(デフォルト)に設定されている場合、マルチパスはデバイス名としてWWIDを使用します。このオプションが「yes」に設定されている場合は、<filename>/var/lib/multipath/bindings</filename>ファイルが使用されて、<filename>mpath&lt;<replaceable>n</replaceable>&gt;</filename>形式の永続的で固有の名前が、<filename>/dev/mapper</filename>ディレクトリ内でデバイスに割り当てられます。<literal>/etc/multipath.conf</literal>ファイルの<literal>bindings file</literal>オプションを使用すると、<filename>bindings</filename>ファイルに代替の場所を指定できます。 </para>
  <para><filename>/etc/multipath.conf</filename>ファイルのグローバルマルチパスオプション<literal>alias</literal>は、デバイスに名前を明示的に割り当てるために使用されます。別名がマルチパスデバイスに設定されている場合は、WWIDまたはユーザフレンドリ名の代わりにその別名が使用されます。</para>
  <para><literal>user_friendly_names</literal>オプションの使用は、以下の状況では問題を引き起こす可能性があります。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <formalpara xml:id="bq7wtcr" role="intro">
     <title>ルートデバイスでマルチパスを使用している場合:</title>
     <para>システムルートデバイスでマルチパスを使用中に、<literal>user_friendly_names</literal>オプションを使用する場合は、 option, the user-friendly settings in the <filename>/var/lib/multipath/bindings</filename>ファイルのユーザフレンドリ設定が<filename>initrd</filename>に組み込まれます。デバイスの追加や削除などで、後でストレージのセットアップを変更した場合は、<filename>initrd</filename>内のバインディング設定と<filename>/var/lib/multipath/bindings</filename>内のバインディング設定に不一致が生じます。</para>
    </formalpara>
    <warning>
     <para><filename>initrd</filename>と<filename>/var/lib/multipath/bindings</filename>のバインディングが不一致だと、デバイスに間違ったマウントポイントが割り当てられることがあり、その場合は、ファイルシステムが破損し、データが失われます。</para>
    </warning>
    <para>この問題を回避するには、システムルートデバイスにデフォルトのWWID設定を使用することを推奨します。システムのルートデバイスには、別名を使用してはなりません。デバイス名が異なることがあるため、別名を使用すると、カーネルのコマンドラインを通じてマルチパス処理をシームレスにスイッチオフすることができなくなります。</para>
   </listitem>
   <listitem>
    <formalpara xml:id="bq7uui0">
     <title>別のパーティションから/varをマウントする場合:</title>
     <para><literal>user_friendly_names</literal>設定ファイルのデフォルトの格納場所は、<filename>/var/lib/multipath/bindings</filename>です。<filename>/var</filename>データがシステムルートデバイス上になく、このデータを別のパーティションからマウントする場合は、マルチパス処理のセットアップ時に<filename>bindings</filename>ファイルを利用できません。</para>
    </formalpara>
    <para><filename>/var/lib/multipath/bindings</filename>ファイルをシステムルートデバイスで使用し、マルチパスで検出できるようにしてください。これは、たとえば、次の手順で実行できます。</para>
    <orderedlist spacing="normal">
     <listitem>
      <para><filename>/var/lib/multipath/bindings</filename>ファイルを<filename>/etc/multipath/bindings</filename>に移動します。</para>
     </listitem>
     <listitem>
      <para>この新しい場所に、/<filename>etc/multipath.conf</filename>の<literal>defaults</literal>セクションにある<literal>bindings_file</literal>オプションを設定します。次に例を示します。</para>

<screen>
defaults {
               user_friendly_names yes
               bindings_file "/etc/multipath/bindings"
}
</screen>

     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <formalpara xml:id="bq7wpfj" role="intro">
     <title>マルチパスがinitrdに含まれている場合:</title>
     <para>システムルートデバイスがマルチパス上にない場合でも、マルチパスが<filename>initrd</filename>に含まれることがあります。これは、たとえば、システムルートデバイスがLVM上にある場合に起こります。<literal>user_friendly_names</literal>オプションを使用し、マルチパスが<filename>initrd</filename>内にある場合は、パラメータ<command>multipath=off</command>でブートして問題を回避してください。</para>
    </formalpara>
    <para>これにより、システムブート中は、<filename>initrd</filename>内でのみマルチパスが無効になります。システムブート後は、ブートスクリプト<filename>boot.multipath</filename>および<filename>multipathd</filename>によって、マルチパス処理をアクティブにすることができます。</para>
   </listitem>
  </itemizedlist>
  <para>ユーザフレンドリな名前を有効にするか、別名を指定する場合:</para>
  <procedure xml:id="b7jqnux">
   <step xml:id="b7jqqgl">
    <para>端末コンソールで、<systemitem>root</systemitem>ユーザとしてログインします。</para>
   </step>
   <step xml:id="b7jqp5o">
    <para><filename>/etc/multipath.conf</filename>ファイルをテキストエディタで開きます。</para>
   </step>
   <step xml:id="bq7y78q">
    <para role="intro">(オプション)<filename>/var/lib/multipath/bindings</filename>ファイルの場所を変更します。 </para>
    <para>代替パスは、マルチパスが代替パスを見つけることができるシステムルートデバイス上に存在する必要があります。 </para>
    <substeps performance="required">
     <step xml:id="bq7y96x">
      <para><filename>/var/lib/multipath/bindings</filename>ファイルを<filename>/etc/multipath/bindings</filename>に移動します。</para>
     </step>
     <step xml:id="bq7y96y">
      <para>この新しい場所に、/<filename>etc/multipath.conf</filename>の<literal>defaults</literal>セクションにある<literal>bindings_file</literal>オプションを設定します。次に例を示します。</para>

<screen>
defaults {
               user_friendly_names yes
               bindings_file "/etc/multipath/bindings"
}
</screen>

     </step>
    </substeps>
   </step>
   <step xml:id="b7jqp5q">
    <para>(オプション、非推奨)ユーザフレンドリ名の有効にする:</para>
    <substeps performance="required">
     <step xml:id="bq7xauk">
      <para><literal>defaults</literal>セクションとその閉じ括弧を非コメント化します。</para>
     </step>
     <step xml:id="bq7xb1y">
      <para><literal>user_friendly_names</literal>オプションを非コメント化し、次に、その値をNoからYesに変更します。</para>
      <para>次に例を示します。</para>

<screen>
## Use user friendly names, instead of using WWIDs as names.
defaults {
  user_friendly_names yes
}
</screen>

     </step>
    </substeps>
   </step>
   <step xml:id="b7jrp3u">
    <para role="intro">(オプション)<command>alias</command>オプション(<command>multipath</command>セクションにある)を使用して、独自のデバイス名を指定します。</para>
    <para role="intro">次に例を示します。</para>

<screen>
## Use alias names, instead of using WWIDs as names.
multipaths {
       multipath {
               wwid           36006048000028350131253594d303030
               alias             blue1
       }
       multipath {
               wwid           36006048000028350131253594d303041
               alias             blue2
       }
       multipath {
               wwid           36006048000028350131253594d303145
               alias             yellow1
       }
       multipath {
               wwid           36006048000028350131253594d303334
               alias             yellow2
       }
}
</screen>

   </step>
   <step xml:id="b7jqp5r">
    <para>変更内容を保存し、ファイルを閉じます。</para>
    <para>変更内容は、マルチパスマップを更新するまで、またはmultipathdデーモンの再起動時(システムの再起動時など)まで、適用されません。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bkj8n9w">
  <title>zSeriesデバイスのデフォルト設定の設定</title>
  <para>IBM zSeriesデバイスをマルチパス処理でテストした結果、dev_loss_tmoパラメータを90秒に、fast_io_fail_tmoパラメータを5秒に設定する必要があることわかりました。zSeriesデバイスをご使用の場合は、<filename>/etc/multipath.conf</filename>ファイルを変更して、値を次のように指定します。</para>

<screen>
defaults {
       dev_loss_tmo 90
       fast_io_fail_tmo 5
}
</screen>

  <para>dev_loss_tmoパラメータは、マルチパスリンクに不良のマーキングがされるまでの秒数を設定します。パスに障害が発生したら、そのパスの現在のI/Oが失敗します。デフォルト値は使用するデバイスドライバによって異なります。0～600秒の値の範囲が有効です。ドライバの内部タイムアウトを使用するには、ゼロ(0)または600より大きい値に設定します。</para>
  <para>fast_io_fail_tmoパラメータは、リンク障害を検出した場合に、I/Oが失敗するまでの待機時間を設定します。ドライバに到達したI/Oは失敗します。ブロックしたキューにI/Oがある場合は、I/Oはdev_loss_tmoで指定された時間が経過するまでは失敗せず、キューのブロックが解除されます。</para>
  <para><filename>/etc/multipath.conf</filename>ファイルを変更した場合、その変更内容は、マルチパスマップを更新するまで、またはmultipathdデーモンを再起動するまで(システムの再起動など)適用されません。</para>
 </section>
 <section xml:id="bbi89rh">
  <title>パスフェールオーバーのポリシーと優先度の設定</title>
  <para>Linuxホスト内で、ストレージコントローラへのパスが複数ある場合は、各パスが別個のブロックデバイスとして表示され、その結果、1つのLUNに複数のブロックデバイスが存在することになります。デバイスマッパーマルチパスサービスは、同じLUN IDをもつ複数のパスワードを検出し、そのIDで新しいマルチパスデバイスを作成します。たとえば、1つの非ゾーン化されたファイバチャネルのスイッチを介して2つのポートでストレージコントローラに接続した2つのHBAをもつホストは、4つのブロックデバイスを認識します(<filename>/dev/sda</filename>、<filename>/dev/sdb</filename>、<filename>/dev/sdc</filename>、<filename>/dev/sdd</filename>)。デバイスマッパーマルチパスサービスは、1つのブロックデバイス<filename>/dev/mpath/mpath1</filename>を作成します。このデバイスは、既に示した4つのブロックデバイスを介してI/Oを再経路指定します。</para>
  <para>このセクションでは、フェールオーバーのポリシーを指定し、パスの優先順位を設定する方法について説明します。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="beep0mu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi89xy" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbj87iv" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi8acn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi8els" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="beep0mu">
   <title>パスのフェールオーバーポリシーの設定</title>
   <para><command>multipath</command>コマンドを-pオプション付きで使用して、パスフェールオーバーポリシーを設定します。</para>

<screen>
multipath <replaceable>devicename</replaceable> -p <replaceable>policy</replaceable> 
</screen>

   <para role="intro">次のポリシーオプションの1つで、<replaceable>policy</replaceable>を置き換えます。</para>
   <table xml:id="beg1vn7">
    <title>multipath -pコマンドのグループポリシーオプション</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2381*"/>
    <colspec colnum="2" colname="2" colwidth="7620*"/>
     <thead>
      <row><!--id=beg1vn8-->
       <entry>
        <para>ポリシーオプション</para>
       </entry>
       <entry>
        <para>説明</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=beg1vn9-->
       <entry>
        <para>failover (フェールオーバー)</para>
       </entry>
       <entry>
        <para>(デフォルト)優先度グループごとに1つのパス</para>
       </entry>
      </row>
      <row><!--id=beg1vna-->
       <entry>
        <para>multibus</para>
       </entry>
       <entry>
        <para>1つの優先度グループ内にすべてのパス</para>
       </entry>
      </row>
      <row><!--id=beg1vnb-->
       <entry>
        <para>group_by_serial</para>
       </entry>
       <entry>
        <para>検出されたシリアル番号ごとに1つの優先度グループ</para>
       </entry>
      </row>
      <row><!--id=beg1vnc-->
       <entry>
        <para>group_by_prio</para>
       </entry>
       <entry>
        <para>パス優先度値ごとに1つの優先度グループ優先度は、コールアウトプログラムで決定されます。それらのプログラムは、グローバル、コントローラごと、またはマルチパスごとのオプションとして<filename>/etc/multipath.conf</filename>環境設定ファイルで指定されます。</para>
       </entry>
      </row>
      <row><!--id=beg1vnd-->
       <entry>
        <para>group_by_node_name</para>
       </entry>
       <entry>
        <para>ターゲットノード名ごとに1つの優先度グループターゲットノード 名は、<filename> /sys/class/fc_transport/target*/node_name</filename>にフェッチされます。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </section>
  <section xml:id="bbi89xy">
   <title>フェールオーバーポリシーの設定</title>
   <para>デバイスのフェールオーバーポリシーは、手動で、<filename>/etc/multipath.conf</filename>ファイルに入力する必要があります。すべての設定とオプションの例は、<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename>ファイルにあります。</para>
   <para><filename>/etc/multipath.conf</filename>ファイルを修正した場合、ファイルを保存する際に変更が自動的には適用されません。詳細については、<xref linkend="mpiohwsupconf" xrefstyle="SectTitleOnPage"/>および<xref linkend="bbj8y2r" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8jjc" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8jjd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8g9x" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="beg263n">
    <title>優先度グループと属性の理解</title>
    <para><emphasis>優先度グループ</emphasis>は、同じ物理LUNに属するパスのコレクションです。デフォルトでは、I/Oは、グループ内のすべてのパス全体にラウンドロビン方式で配分されます。<command>multipath</command>コマンドは、SANのpath_grouping_policy設定に基づいてそのSANの各LUNごとに、自動的に優先度グループを作成します。<literal/><command>multipath</command>コマンドは、グループ内のパス数にグループの優先度を掛け合わせて、どのグループがプライマリか決定します。計算された値が最も高いグループがプライマリグループです。プライマリグループ内のすべてのパスが失敗すると、次に値の高い優先度グループがアクティブになります。 </para>
    <para><emphasis>パス優先度</emphasis>は、パスに割り当てられた整数値です。優先度は、値が高いほど高くなります。パスごとに優先度を割り当てるには、外部プログラムが使用されます。所定のデバイスに関して、同じ優先度のパスが同じ優先度グループに属します。</para>
    <para>SLES 11 SP2用マルチパスツール 2以降では、<literal>/etc/multipath.conf</literal>ファイルの<literal>defaults{}</literal>または<literal>devices{}</literal>セクションの<filename>prio</filename>設定を使用します。キーワード<literal>prio</literal>が、<literal>multipath{)</literal>セクションの個別の<literal>multipaths</literal>定義に指定された場合は、暗黙のうちに無視されます。SLES 11 SP1用のマルチパスツール0.4.8以前では、<literal>multipath{)</literal>セクションの個別の<literal>multipaths</literal>定義内のprio設定で、<literal>defaults{}</literal>または<literal>devices{}</literal>セクションの<literal>prio</literal>設定を上書きすることができました。</para>
    <para><literal>/etc/multipath.conf</literal>ファイル内の<filename>prio</filename>キーワードが、<filename>multipath-tools-0.4.9</filename>では変更されています。<literal>prio</literal>行で、Prioritizerが指定されます。Prioritizerが引数を必要とする場合、その引数は2行目の<literal>prio_args</literal>キーワードで指定します。これまでは、Prioritizerとその引数は、<literal>prio</literal>行に含まれていました。</para>
    <bridgehead xml:id="b15gvvaa">デフォルトセクションまたはデバイスセクションのprio設定</bridgehead>
    <variablelist>
     <varlistentry xml:id="b122w59j">
      <term>prio</term>
      <listitem>
       <para>パス優先度の値を取得するために呼び出すPrioritizerプログラムを指定します。加重は、障害の発生時に使用する次のパスグループを決定するため、それぞれのパスグループに対して合計されます。</para>
       <para>指定したPrioritizerで引数が必要な場合は、<literal>prio_args</literal>キーワードを使用して、引数を指定します。</para>
       <formalpara xml:id="b122w59k" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <para><literal>prio_</literal>キーワードを指定しない場合は、すべてのパスが同等になりますデフォルトの設定は「const」で、<literal>prio_args</literal>の設定には値がありません。</para>

<screen>
prio      "const"
prio_args ""
</screen>

       <para>Prioritizerのプログラム例には、以下のものがあります。</para>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2907*"/>
        <colspec colnum="2" colname="2" colwidth="7096*"/>
         <thead>
          <row><!--id=b122xdcu-->
           <entry>
            <para>Prioritizerプログラム</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122xdcv-->
           <entry>
            <para>alua</para>
           </entry>
           <entry>
            <para>SCSI-3 ALUA設定に基づいてパス優先度を生成します。 </para>
           </entry>
          </row>
          <row><!--id=b122xdcw-->
           <entry>
            <para>const</para>
           </entry>
           <entry>
            <para>すべてのパスに同じ優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122xdcx-->
           <entry>
            <para>emc</para>
           </entry>
           <entry>
            <para>EMCアレイのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122xdcy-->
           <entry>
            <para>hdc</para>
           </entry>
           <entry>
            <para>Hitachi HDS Modularストレージアレイのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122xdcz-->
           <entry>
            <para>hp_sw</para>
           </entry>
           <entry>
            <para>アクティブ/スタンバイモードのCompaq/HPコントローラのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122xdd0-->
           <entry>
            <para>ontap</para>
           </entry>
           <entry>
            <para>NetAppアレイのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122xdd1-->
           <entry>
            <para>random</para>
           </entry>
           <entry>
            <para>パスごとにランダムな優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122xdd2-->
           <entry>
            <para>rdac</para>
           </entry>
           <entry>
            <para>LSI/Engenio RDACコントローラのパスの優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122xdd3-->
           <entry>
            <para>weightedpath</para>
           </entry>
           <entry>
            <para><literal>prio_args</literal>に対する引数内で指定した加重値に基づいて、パス優先度を生成します。たとえば</para>

<screen>
&lt;hbtl|devname&gt; &lt;<replaceable>regex1</replaceable>&gt; &lt;<replaceable>prio1</replaceable>&gt; &lt;<replaceable>regex2</replaceable>&gt; &lt;<replaceable>prio2</replaceable>&gt;...
</screen>

            <para><literal>hbtl regex</literal>の引数形式では、SCSI <literal>H:B:T:L</literal>表記法(<literal>1:0:.:.</literal> および<literal>*:0:0:.</literal>など)を、加重値とともに使用します。ここで、H、B、T、Lはそれぞれ、デバイスのホスト、バス、ターゲット、およびLUN IDを示します。たとえば、</para>

<screen>
prio "weightedpath"
prio_args "hbtl 1:.:.:. 2 4:.:.:. 4"
</screen>

            <para>devname regexの引数形式では、デバイスノード名を、各ノードに対する加重値とともに使用します。たとえば、</para>

<screen>
prio "weightedpath"
prio_args "devname sda 50 sde 10 sdc 50 sdf 10"
</screen>

           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122w59l">
      <term>prio_args</term>
      <listitem>
       <para>引数を必要とする指定したPrioritizerプログラムに対する引数を指定します。ほとんどの<literal>prio</literal>プログラムでは、引数は不要です。</para>
       <formalpara xml:id="b122w59m" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <para>デフォルト値はありません。値は、<literal>prio</literal>の設定と、Prioritizerが引数を必要とするかどうかによります。</para>

<screen>
prio      "const"
prio_args ""
</screen>

      </listitem>
     </varlistentry>
    </variablelist>
    <bridgehead xml:id="b15gvvab">マルチパス属性</bridgehead>
    <para>デバイスに対するマルチパスI/Oの動作を制御するには、マルチパス属性を使用します。すべてのマルチパスデバイスに対して、デフォルトとして属性を指定できます。また、あるマルチパスデバイスにのみ適用する属性を、そのデバイス用のエントリを、マルチパス設定ファイルの<literal>multipaths</literal>セクションで作成することで、指定することもできます。</para>
    <variablelist>
     <varlistentry xml:id="b122sbg9">
      <term>user_friendly_names</term>
      <listitem>
       <para>WWID(world-wide ID)を使用するか、または<filename>/var/lib/multipath/bindings</filename>ファイルを使用して永続的で固有な別名を<filename>/dev/mapper/mpathN</filename>形式のマルチパスデバイスに割り当てるか指定します。</para>
       <para>このオプションは、<literal>devices</literal>セクションおよび<literal>multipaths</literal>セクションで使用できます。</para>
       <formalpara xml:id="b122sbga" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122skbh-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122skbi-->
           <entry>
            <para>no</para>
           </entry>
           <entry>
            <para>(デフォルト) <filename>/dev/disk/by-id/</filename>に示されたWWIDを使用します。</para>
           </entry>
          </row>
          <row><!--id=b122skbj-->
           <entry>
            <para>yes</para>
           </entry>
           <entry>
            <para>実際のIDの代わりに、マルチパスデバイスのエイリアスとして、ユーザフレンドリな名前を自動生成します。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgh">
      <term>failback (フェールバック)</term>
      <listitem>
       <para>エラーになったパスの回復を監視するかどうか指定し、パスサービス回復後のグループのフェールバックのタイミングを示します。</para>
       <para>エラーになったパスは、回復すると、この設定に基づいてマルチパス対応パスのリストに戻されます。multipathは、優先度グループを評価し、プライマリパスの優先度がセカンダリパスのそれを超えると、アクティブな優先度グループを変更します。 </para>
       <formalpara xml:id="b122sbgi" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122sm95-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122sm96-->
           <entry>
            <para>manual</para>
           </entry>
           <entry>
            <para>デフォルト。エラーになったパスの回復は監視されません。管理者が<command>multipath</command>コマンドを実行して、有効なパスと優先度グループを更新します。</para>
           </entry>
          </row>
          <row><!--id=b122sm97-->
           <entry>
            <para>immediate</para>
           </entry>
           <entry>
            <para>パスが回復したら、ただちにパスを有効にします。</para>
           </entry>
          </row>
          <row><!--id=b122sm98-->
           <entry>
            <para>n</para>
           </entry>
           <entry>
            <para>パスが回復したら、<replaceable>n</replaceable>秒後にパスを有効にします。0より大きい整数値を指定してください。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>クラスタ環境内のマルチパスに対するフェールバックの設定は、マルチパスのフェールオーバーのピンポンを避けるため、「manual」にすることを推奨します。</para>

<screen>
failback "manual"
</screen>

       <important>
        <para>フェールバックの設定については、ストレージシステムのベンダに確認するようにしてください。ストレージシステムが異なれば、必要な設定も異なります。</para>
       </important>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgm">
      <term>getuid_callout</term>
      <listitem>
       <para>固有のパス識別子を取得するためのコールのデフォルトプログラムと引数を指定します。場所を、絶対Linuxパスで指定します。</para>
       <para>この属性はSLES 11 SP3で廃止予定なので、<literal>uid_attribute</literal> (<xref linkend="b15gvth2"/>)に置き換えられました。</para>
       <formalpara xml:id="b122sbgn" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <para>デフォルトの場所と引数は、</para>

<screen>
/lib/udev/scsi_id -g -u -s
</screen>

       <para>例:</para>

<screen>
getuid_callout "/lib/udev/scsi_id -g -u -d /dev/%n"

getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgo">
      <term>no_path_retry</term>
      <listitem>
       <para>パスの障害時に使用する動作を指定します。</para>
       <formalpara xml:id="b122sbgp" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122sr39-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122sr3a-->
           <entry>
            <para>n</para>
           </entry>
           <entry>
            <para><command>multipath</command>コマンドで待ち行列が停止し、パスがエラーになるまでの再試行数を指定します。0より大きい整数値を指定してください。</para>
            <para>クラスタでは、「0」を指定して、待ち行列を回避し、リソースのフェールオーバーを許可することができます。</para>
           </entry>
          </row>
          <row><!--id=b122sr3b-->
           <entry>
            <para>fail</para>
           </entry>
           <entry>
            <para>即時失敗(待ち行列なし)を指定します。</para>
           </entry>
          </row>
          <row><!--id=b122sr3c-->
           <entry>
            <para>queue</para>
           </entry>
           <entry>
            <para>待ち行列を停止しません(パスが復帰するまで永久に待機します)。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>クラスタでの作業では、<filename>/etc/multipath.conf</filename>ファイルの再試行設定を、「fail」または「0」にすることを推奨します。これにより、ストレージへの接続が失われた場合に、リソースのフェールオーバーが起こります。そうしないと、メッセージの待ち行列とリソースのフェールオーバーが行えません。 </para>

<screen>
no_path_retry "fail"
no_path_retry "0"
</screen>

       <important>
        <para>再試行設定については、ストレージシステムのベンダに確認するようにしてください。ストレージシステムが異なれば、必要な設定も異なります。</para>
       </important>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgs">
      <term>path_checker</term>
      <listitem>
       <para role="intro">パスの状態を判別します。</para>
       <formalpara xml:id="b122sbgt" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122swb1-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122swb2-->
           <entry>
            <para>directio</para>
           </entry>
           <entry>
            <para>(<filename>multipath-tools</filename>バージョン0.4.8以降でのデフォルト)。直接I/Oをもつ最初のセクタを読み込みます。DASDデバイスの場合、有用です。<filename>/var/log/messages</filename>に障害メッセージをログ記録します。</para>
           </entry>
          </row>
          <row><!--id=b122swb3-->
           <entry>
            <para>readsector0</para>
           </entry>
           <entry>
            <para>(<filename>multipath-tools</filename>バージョン0.4.7以前でのデフォルト。廃止予定なので<literal>directio</literal>に置き換えられました)。デバイスの最初のセクタを読み込みます。<filename>/var/log/messages</filename>に障害メッセージをログ記録します。</para>
           </entry>
          </row>
          <row><!--id=b122swb4-->
           <entry>
            <para>tur</para>
           </entry>
           <entry>
            <para>デバイスに対するSCSIテストユニットレディコマンドを発行します。これはLUNによってサポートされている場合の推奨設定です。このコマンドは、障害時に、<filename>/var/log/messages</filename>にメッセージを出力しません。</para>
           </entry>
          </row>
          <row><!--id=b122swb5-->
           <entry>
            <para><replaceable>custom_vendor_value</replaceable></para>
           </entry>
           <entry>
            <para>一部のSANベンダは、カスタムオプションとしてpath_checkerを提供しています。</para>
            <itemizedlist mark="bullet" spacing="normal">
             <listitem>
              <formalpara xml:id="b122w9oz">
               <title>cciss_tur:</title>
               <para>HP Smart Storage Arrayへのパスの状態をチェックします。</para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara xml:id="b122swb6">
               <title>emc_clariion:</title>
               <para>EMC ClariionのEVPDページ0xC0をクエリしてパスの状態を判別します。</para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara xml:id="b122swb7">
               <title>hp_sw:</title>
               <para>Active/StandbyファームウェアをもつHPストレージアレイのパスの状態(アップ、ダウン、またはゴースト)をチェックします。 </para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara xml:id="b122swb8">
               <title>rdac:</title>
               <para>LSI/Engenio RDACストレージコントローラのパスｍｐ状態をチェックします。</para>
              </formalpara>
             </listitem>
            </itemizedlist>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgq">
      <term>path_grouping_policy</term>
      <listitem>
       <para role="intro">所定のコントローラがホストとなるマルチパスデバイスのパスグループ化ポリシーを指定します。</para>
       <formalpara xml:id="b122sbgr" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122swaq-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122swar-->
           <entry>
            <para>failover (フェールオーバー)</para>
           </entry>
           <entry>
            <para>(デフォルト)一度に1つのパスだけ使用されるように、優先度グループごとに1つのパスが割り当てられます。</para>
           </entry>
          </row>
          <row><!--id=b122swas-->
           <entry>
            <para>multibus</para>
           </entry>
           <entry>
            <para>すべての有効なパスが1つの優先度グループに含まれます。トラフィックが、グループ内のアクティブなパスすべてに渡って負荷分散されます。</para>
           </entry>
          </row>
          <row><!--id=b122swat-->
           <entry>
            <para>group_by_prio</para>
           </entry>
           <entry>
            <para>パス優先度値ごとに、1つの優先度グループが存在します。同じ優先度のパスは同じ優先度グループに属します。優先度は外部プログラムによって割り当てられます。</para>
           </entry>
          </row>
          <row><!--id=b122swau-->
           <entry>
            <para>group_by_serial</para>
           </entry>
           <entry>
            <para>パスがSCSIターゲットシリアル番号(コントローラノードのWWN)でグループ化されます。</para>
           </entry>
          </row>
          <row><!--id=b122swav-->
           <entry>
            <para>group_by_node_name</para>
           </entry>
           <entry>
            <para>ターゲットノード名ごとに1つの優先度グループが割り当てられます。ターゲットノード名は<filename>/sys/class/fc_transport/target*/node_name</filename>にフェッチされます。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgu">
      <term>path_selector</term>
      <listitem>
       <para role="intro">負荷分散に使用するパスセレクタアルゴリズムを指定します。</para>
       <formalpara xml:id="b122sbgv" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122t3po-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122t3pp-->
           <entry>
            <para>round-robin 0</para>
           </entry>
           <entry>
            <para>(SLES 11 SP2以前でのデフォルト)優先度グループ内のすべてのアクティブパスに渡るトラフィックの分散に使用される負荷分散アルゴリズム。</para>
           </entry>
          </row>
          <row><!--id=b122t3pr-->
           <entry>
            <para>queue-length 0</para>
           </entry>
           <entry>
            <para>least-pendingオプションと同様に、パス上で実行中のI/Oの数に基づく、動的負荷分散装置。</para>
           </entry>
          </row>
          <row><!--id=b122t3ps-->
           <entry>
            <para>service-time 0</para>
           </entry>
           <entry>
            <para>(SLES 11 SP3以降でのデフォルト)遅延に従って、パス上のI/Oを調整するサービス時間に基づく負荷分散装置。 </para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgw">
      <term>pg_timeout</term>
      <listitem>
       <para>パスグループのタイムアウト処理を指定します。</para>
       <formalpara xml:id="b122sbgx" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <para>なし(内部デフォルト)</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122w0sa">
      <term>polling_interval</term>
      <listitem>
       <para>1つのパスチェックサイクルの終了から次回のパスチェックサイクルの開始までの時間を、秒単位で指定します。</para>
       <formalpara xml:id="b122w0sb" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <para>0より大きい整数値を指定してください。デフォルト値は5です。polling_intervalの設定については、ストレージシステムのベンダに確認するようにしてください。ストレージシステムが異なれば、必要な設定も異なります。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbgy">
      <term>prio_callout</term>
      <listitem>
       <para>マルチパスマップのレイアウトを決定するプログラムと引数を指定します。</para>
       <para>マルチパスのprio_calloutsプログラムは、<filename>/lib/libmultipath/lib*</filename>内の共有ライブラリ内にあります。共有ライブラリを使用することで、デーモンの起動時、コールアウトプログラムがメモリにロードされます。 </para>
       <para><command>multipath</command>コマンドでクエリされると、指定のmpath_prio_*コールアウトプログラムがマルチパスレイアウト全体との関係で所定のパスの優先度を返します。 </para>
       <para>この属性がgroup_by_prioのpath_grouping_policyとともに使用されると、同じ優先度をもつすべてのパスが1つのマルチパスグループにグループ化されます。総計の優先度が最も高いグループがアクティブグループになります。</para>
       <para>グループ内のすべてのパスが失敗すると、総計の優先度が次に高いグループがアクティブになります。さらに、フェールオーバーコマンド(ハードウェアハンドラにより決定)がターゲットに送信されることもあります。</para>
       <para>mpath_prio_*プログラムとして、指定のセットアップ用にベンダまたは管理者が作成したカスタムスクリプトを使用することも可能です。</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>コマンドライン内の<literal>%n</literal>は、<filename>/dev</filename>ディレクトリ内のデバイス名に展開します。 </para>
        </listitem>
        <listitem>
         <para>コマンドライン内の<literal>%b</literal>は、<replaceable>/dev</replaceable>ディレクトリ内の<filename>major:minor</filename>形式のデバイス番号に展開します。</para>
        </listitem>
        <listitem>
         <para>コマンドライン内の<literal>%d</literal>は、<filename>/dev/disk/by-id</filename>ディレクトリ内のデバイスIDに展開します。</para>
        </listitem>
       </itemizedlist>
       <para>デバイスがホットプラグ可能な場合は、<literal>%n</literal>の代わりに<literal>%d</literal>フラグを使用してください。これにより、デバイスが利用可能になった時点と<command>udev</command>がデバイスノード を作成した時点の間に短い時間間隔があるという問題が解決されます。</para>
       <formalpara xml:id="b122sbgz" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122tqh2-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122tqh3-->
           <entry>
            <para>(値なし)</para>
           </entry>
           <entry>
            <para><literal>prio_callout</literal>属性を使用しない場合は、すべてのパスが同等になりますこれがデフォルトの設定です。</para>
           </entry>
          </row>
          <row><!--id=b122tqh4-->
           <entry>
            <para>/bin/true</para>
           </entry>
           <entry>
            <para>group_by_prioを使用しない場合は、これを指定します。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para><command>prioritizer</command>プログラムは、<command>multipath</command>コマンドによってクエリされると、パス優先度を生成します。プログラム名は、<filename>mpath_prio_</filename>で開始し、後に使用するデバイスタイプまたは負荷分散の方法が続きます。現在の優先度プログラムには、次のものがあります。</para>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="3539*"/>
        <colspec colnum="2" colname="2" colwidth="6464*"/>
         <thead>
          <row><!--id=b122tml8-->
           <entry>
            <para>Prioritizerプログラム</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122tml9-->
           <entry>
            <para>mpath_prio_alua %n</para>
           </entry>
           <entry>
            <para>SCSI-3 ALUA設定に基づいてパス優先度を生成します。 </para>
           </entry>
          </row>
          <row><!--id=b122tmla-->
           <entry>
            <para>mpath_prio_balance_units</para>
           </entry>
           <entry>
            <para>すべてのパスに同じ優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122tp25-->
           <entry>
            <para>mpath_prio_emc %n</para>
           </entry>
           <entry>
            <para>EMCアレイのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122tp26-->
           <entry>
            <para>mpath_prio_hds_modular %b</para>
           </entry>
           <entry>
            <para>Hitachi HDS Modularストレージアレイのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122tp27-->
           <entry>
            <para>mpath_prio_hp_sw %n</para>
           </entry>
           <entry>
            <para>アクティブ/スタンバイモードのCompaq/HPコントローラのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122tp28-->
           <entry>
            <para>mpath_prio_netapp %n</para>
           </entry>
           <entry>
            <para>NetAppアレイのパス優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122tp29-->
           <entry>
            <para>mpath_prio_random %n</para>
           </entry>
           <entry>
            <para>パスごとにランダムな優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122tp2a-->
           <entry>
            <para>mpath_prio_rdac %n</para>
           </entry>
           <entry>
            <para>LSI/Engenio RDACコントローラのパスの優先度を生成します。</para>
           </entry>
          </row>
          <row><!--id=b122tp2b-->
           <entry>
            <para>mpath_prio_tpc %n</para>
           </entry>
           <entry>
            <para>オプションとして、ベンダまたは管理者が作成したスクリプトを使用できます。このスクリプトは、各パスの優先度を指定するファイルから優先度を取得します。</para>
           </entry>
          </row>
          <row><!--id=b122tp2c-->
           <entry>
            <para>mpath_prio_spec.sh %n</para>
           </entry>
           <entry>
            <para>ユーザ作成スクリプトのパスを提供します。このスクリプトにより、2つ目のデータファイルに含まれた情報に基づくマルチパス処理の優先度が生成されます。（このパスとファイル名は、例として提供されています。ご使用のスクリプトの場所を指定してください)。このスクリプトは、ベンダまたは管理者が作成できます。スクリプトのターゲットファイルは、すべてのマルチパスデバイスの各パスを識別し、パスごとに優先度を指定します。例については、<xref linkend="bbj87iv" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbh0">
      <term>rr_min_io</term>
      <listitem>
       <para><literal>path_selector</literal>設定の指定のアルゴリズムで決定される同じパスグループ内の次のパスに切り替わる前に、パスに経路指定されるI/Oトランザクションの数を指定します。</para>
       <para>rr_min_io属性は、カーネル2.6.31以前でのみ使用します。SLES 11 SP2では廃止になり、<literal>rr_min_io_rq</literal>属性に置き換えられました。</para>
       <formalpara xml:id="b122sbh1" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <para>0より大きい整数値を指定してください。デフォルト値は「1000」です。</para>

<screen>
rr_min_io "1000"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbh2">
      <term>rr_min_io_rq</term>
      <listitem>
       <para role="intro">現在のパスグループ内の次のパスに切り替える前に、リクエストベースのデバイス-マッパー-マルチパスを使用して、あるパスへルートするI/Oリクエストの回数を指定します。 </para>
       <para>この属性は、SLES 11 SP2以降を実行しているシステムで利用できます。rr_min_io属性に代わるものです。</para>
       <formalpara xml:id="b122sbh3" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <para>0より大きい整数値を指定してください。デフォルト値は「1」です。</para>

<screen>
rr_min_io_rq "1"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry xml:id="b122sbh4">
      <term>rr_weight</term>
      <listitem>
       <para role="intro">パスの重み付けの方法を指定します。</para>
       <formalpara xml:id="b122sbh5" role="intro">
        <title>値</title>
        <para/>
       </formalpara>
       <informaltable>
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row><!--id=b122tlbj-->
           <entry>
            <para>値</para>
           </entry>
           <entry>
            <para>説明</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row><!--id=b122tlbk-->
           <entry>
            <para>uniform</para>
           </entry>
           <entry>
            <para>(デフォルト)すべてのパスが同じラウンドロビン方式の重み付けを持ちます。</para>
           </entry>
          </row>
          <row><!--id=b122tlbl-->
           <entry>
            <para>priorities</para>
           </entry>
           <entry>
            <para>各パスの重み付けが、rr_min_io_rqの設定(またはカーネル2.6.31以降ではrr_min_io設定)によって決まります。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b15gvth2">
      <term>uid_attribute</term>
      <listitem>
       <para>固有のパス識別子を提供するudev属性。デフォルト値は<literal>ID_SERIAL</literal>です。</para>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="bbi8jjc">
    <title>ラウンドロビン式負荷分散の設定</title>
    <para>すべてのパスがアクティブです。一定の秒数または一定数のI/Oトランザクションの後で、シーケンスの次のオープンパスに移動するように、I/Oを設定します。</para>
   </section>
   <section xml:id="bbi8jjd">
    <title>単一パスフェールオーバーの設定</title>
    <para>優先度が最も高い（最も低い値の)単一パスがトランザクションに対してアクティブになります。他のパスは、フェールオーバーに使用できますが、フェールオーバーの発生までは使用されません。 </para>
   </section>
   <section xml:id="bbi8g9x">
    <title>ラウンドロビン式負荷分散用I/Oパスのグループ化</title>
    <para>同じ優先度をもつ複数のパスがアクティブグループを形成します。そのグループのすべてのパスがエラーになると、デバイスが優先度の次に高いグループにフェールオーバーします。グループのすべてのパスが、ラウンドロビン方式の負荷分散で、トラフィックロードを共有します。</para>
   </section>
  </section>
  <section xml:id="bbj87iv">
   <title>スクリプトの使用によるパス優先度の設定</title>
   <para>デバイスマッパーマルチパス(DM-MPIO)と対話することにより、<command>prio_callout</command>設定のリソースとしての設定時にLUNへのパスの優先度を提供するスクリプトを作成できます。 </para>
   <para>まず、各デバイスの情報と各パスに割り当てたい優先度値をリストするテキストファイルを設定します。たとえば、ファイルを<filename>/usr/local/etc/primary-paths</filename>と指定します。次の形式で、パスごとに1行入力します。</para>

<screen>
host_wwpn target_wwpn scsi_id priority_value
</screen>

   <para>デバイス上の各パスの優先度を返します。変数FILE_PRIMARY_PATHSが各デバイスの適切なデータ(host wwpn、target wwpn、scsi_id、priority value)を含む実際のファイルに解決するようにします。 </para>
   <para>1つのLUNに8つのパスが対応する場合、<filename>primary-paths</filename>ファイルの内容が、次のようになることがあります。</para>

<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:0 sdb 3600a0b8000122c6d00000000453174fc 50
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:1 sdc 3600a0b80000fd6320000000045317563 2
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:2 sdd 3600a0b8000122c6d0000000345317524 50
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:3 sde 3600a0b80000fd6320000000245317593 2
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:0 sdi 3600a0b8000122c6d00000000453174fc 5
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:1 sdj 3600a0b80000fd6320000000045317563 51
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:2 sdk 3600a0b8000122c6d0000000345317524 5
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:3 sdl 3600a0b80000fd6320000000245317593 51
</screen>

   <para><xref linkend="b122sbgy" xrefstyle="HeadingOnPage"/>に示された例を続行するには、<filename>/usr/local/sbin/path_prio.sh</filename>という名前のスクリプトを作成します。パスとファイル名は任意に指定できます。スクリプトは、次の処理を実行します。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>multipathからのクエリ時に、<filename>/usr/local/etc/primary-paths</filename>ファイルからデバイスとそのパスをグレップ検索します。</para>
    </listitem>
    <listitem>
     <para>multipathに戻り、ファイル内のそのエントリの最後のカラムにある優先度値を使用します。</para>
    </listitem>
   </itemizedlist>
  </section>
  <section xml:id="bbi8acn">
   <title>ALUAの設定 (mpath_prio_alua)</title>
   <para><command>mpath_prio_alua(8)</command>コマンドは、Linux <command>multipath(8)</command>コマンドの優先度コールアウトとして使用されます。このコマンドが返す番号をDM-MPIOが使用して、同じ優先度をもつSCSIデバイスをグループ化します。このパス優先度ツールは、ALUA (Asynchronous Logical Unit Access)をベースとしています。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg2eyu" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2e1m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbj46qo" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbj4fvf" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="beg2eyu">
    <title>構文</title>

<screen>
mpath_prio_alua [-d <replaceable>directory</replaceable>] [-h] [-v] [-V] <replaceable>device</replaceable> [<replaceable>device</replaceable>...] 
</screen>

   </section>
   <section xml:id="beg2e1m">
    <title>必要条件</title>
    <para>SCSIデバイス.</para>
   </section>
   <section xml:id="bbj46qo">
    <title>オプション</title>
    <variablelist>
     <varlistentry xml:id="bbj46v3">
      <term>-d<replaceable>ディレクトリ</replaceable></term>
      <listitem>
       <para>デバイスノード名の一覧を見つけることのできるLinuxディレクトリパスを指定します。デフォルトディレクトリは、<filename>/dev</filename>です。このオプションを使用する際には、管理するデバイスのデバイスノード名(<filename>sda</filename>など)だけを指定します。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bbj4am6">
      <term>-h</term>
      <listitem>
       <para>このコマンドのヘルプを表示して、終了します。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bbj4am7">
      <term>-v</term>
      <listitem>
       <para>詳細出力をオンにして、読みやすい形式でステータスを表示します。指定のデバッガーが属するポートグループやその現在の状態に関する情報が表示されます。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bbj4am8">
      <term>-V</term>
      <listitem>
       <para>このツールのバージョン情報を表示して、終了します。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bbj4c17">
      <term><replaceable>device</replaceable> [<replaceable>device</replaceable>...] </term>
      <listitem>
       <para>管理するSCSIデバイス(または複数のデバイス)を指定します。ターゲットポートグループの報告コマンド(<command>sg_rtpg(8)</command>)をサポートするSCSIデバイスを指定してください。デバイスノード名には、次の形式の1つを使用します。</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>完全なLinuxディレクトリパス(<filename>/dev/sda</filename>など)-dオプションとは併用しないでください。</para>
        </listitem>
        <listitem>
         <para>デバイスノード名のみ(<filename>sda</filename>など)。-dオプションの使用で、ディレクトリパスを指定します。</para>
        </listitem>
        <listitem>
         <para>スペース無しでコロンで区切ったデバイスのメジャーおよびマイナー番号(<filename>8:0</filename>など)この形式を使用すると、<filename>/dev</filename>ディレクトリに、<filename>tmpdev-&lt;major&gt;:&lt;minor&gt;-&lt;pid&gt;</filename>形式の名前で、一時デバイスノードが作成されます。(たとえば、<filename>/dev/tmpdev-8:0-&lt;pid&gt;</filename>)。</para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="bbj4fvf">
    <title>戻り値</title>
    <para>成功すると、0値とグループの優先度値が返ります。<xref linkend="bbilsw8" xrefstyle="TableXRef"/>は、<command>mpath_prio_alua</command>コマンドが返す優先度値を示しています。 </para>
    <table xml:id="bbilsw8">
     <title>デバイスマッパーマルチパスのALUA優先度</title>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="2381*"/>
     <colspec colnum="2" colname="2" colwidth="7620*"/>
      <thead>
       <row><!--id=bbiltgc-->
        <entry>
         <para>優先度値</para>
        </entry>
        <entry>
         <para>説明</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row><!--id=bbiltgd-->
        <entry>
         <para>50</para>
        </entry>
        <entry>
         <para>デバイスはアクティブで最適化されたグループに属します。</para>
        </entry>
       </row>
       <row><!--id=bbiltge-->
        <entry>
         <para>10</para>
        </entry>
        <entry>
         <para>デバイスは、アクティブだが最適化されていないグループに属します。</para>
        </entry>
       </row>
       <row><!--id=bbj4j3r-->
        <entry>
         <para>1</para>
        </entry>
        <entry>
         <para>デバイスはスタンバイグループに属します。</para>
        </entry>
       </row>
       <row><!--id=bbiltgf-->
        <entry>
         <para>0</para>
        </entry>
        <entry>
         <para>他のすべてのグループ。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para><command>multipath</command>コマンドでの処理方法により、値の間隔は大きくとられています。multipathコマンドは、グループ内のパス数とグループの優先度の値を掛け合わせた結果の値が最も高いグループを選択します。たとえば、非最適化パスグループが6つのパスをもち(6 x 10 = 60)、最適化パスグループが1つのパスをもつ(1 x 50 = 50)場合は、非最適化グループが一番高い値をもつので、multipathは、非最適化グループを選択します。デバイスに対するトラフィックは、グループ内の6つのパスすべてを、ラウンドロビン方式で使用します。</para>
    <para>エラーが発生すると、コマンドの失敗原因を示す、1〜5の値が返ります。詳細については、<command>mpath_prio_alua</command>のマニュアルページを参照してください。</para>
   </section>
  </section>
  <section xml:id="bbi8els">
   <title>ターゲットパスグループの報告</title>
   <para>SCSIターゲットポートグループの報告(<command>sg_rtpg(8)</command>)コマンドを使用します。詳細については、<command>sg_rtpg(8)</command>のマニュアルページを参照してください。</para>
  </section>
 </section>
 <section xml:id="mpioroot">
  <title>ルートデバイスのマルチパスI/Oの設定</title>
  <para>SUSE Linux Enterprise Server 11では、DM-MPIO (デバイスマッパーマルチパスI/O)が使用可能であり、<filename>/boot</filename>と<filename>/root</filename>に対してサポートされています。また、YaSTインストーラ内のYaSTパーティショナは、インストール中のマルチパスの有効化をサポートします。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bp27t6u" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bomc64f" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bomc64g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bp27t6u">
   <title>インストール時にマルチパスI/Oを有効にする</title>
   <para>オペレーティングシステムをマルチパスデバイスにインストールしたい場合は、マルチパスソフトウェアがインストール時に実行されている必要があります。multipathdデーモンは、システムのインストール時に自動的にアクティブになりません。このデーモンは、YaSTパーティショナの<guimenu>マルチパスの設定</guimenu>オプションを使用することによって起動できます。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bomcrff" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bomc64e" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bomcrff">
    <title>アクティブ/アクティブマルチパスストレージLUNでインストール時にマルチパスI/Oを有効にする</title>
    <procedure xml:id="bomcrfg">
     <step xml:id="bomcrfh">
      <para>YaSTインストール設定ページでのインストール時に、<guimenu>パーティション分割</guimenu>をクリックして、YaSTパーティショナを開きます。</para>
     </step>
     <step xml:id="bomcrfi">
      <para><guimenu>カスタムパーティション - エキスパート用</guimenu>を選択します。</para>
     </step>
     <step xml:id="bomcrfj">
      <para><guimenu>ハードディスク</guimenu>メインアイコンを選択し、<guimenu>設定</guimenu>ボタンをクリックし、最後に、<guimenu>マルチパスの設定</guimenu>を選択します。</para>
     </step>
     <step xml:id="bomcrfk">
      <para role="intro">multipathを起動します。</para>
      <para>YaSTがディスクの再スキャンを開始し、利用可能なマルチパスデバイスを表示します(<filename>/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</filename>など)。これが、以降の処理すべての対象デバイスになります。 </para>
     </step>
     <step xml:id="bomcrfl">
      <para><guimenu>次へ</guimenu>をクリックして、インストールを続行します。</para>
     </step>
    </procedure>
   </section>
   <section xml:id="bomc64e">
    <title>アクティブ/パッシブマルチパスストレージLUNでインストール時にマルチパスI/Oを有効にする</title>
    <para>multipathdデーモンは、システムのインストール時に自動的にアクティブになりません。このデーモンは、YaSTパーティショナの<guimenu>マルチパスの設定</guimenu>オプションを使用することによって起動できます。 </para>
    <para>アクティブ/パッシブマルチパスストレージLUNに対するインストール時にマルチパスI/Oを有効にするには:</para>
    <procedure xml:id="bomc6el">
     <step xml:id="bomc6em">
      <para>YaSTインストール設定ページでのインストール時に、<guimenu>パーティション分割</guimenu>をクリックして、YaSTパーティショナを開きます。</para>
     </step>
     <step xml:id="bomc7xx">
      <para><guimenu>カスタムパーティション - エキスパート用</guimenu>を選択します。</para>
     </step>
     <step xml:id="bomc83f">
      <para><guimenu>ハードディスク</guimenu>メインアイコンを選択し、<guimenu>設定</guimenu>ボタンをクリックし、最後に、<guimenu>マルチパスの設定</guimenu>を選択します。</para>
     </step>
     <step xml:id="bomc8h8">
      <para>multipathを起動します。</para>
      <para>YaSTがディスクの再スキャンを開始し、利用可能なマルチパスデバイスを表示します(<filename>/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</filename>など)。これが、以降の処理すべての対象デバイスになります。デバイスのパスとUUIDを書き留めてください。後で必要になります。 </para>
     </step>
     <step xml:id="bomcatl">
      <para><guimenu>次へ</guimenu>をクリックして、インストールを続行します。</para>
     </step>
     <step xml:id="bomca3n">
      <para>すべての設定が完了し、インストールが終了すると、YaSTは、ブートローダ情報の書き込みを開始し、システム再起動のカウントダウンを表示します。<guimenu>中止</guimenu>をクリックしてカウンタを中止し、&lt;CTRL&gt; + &lt;ALT&gt; + &lt;F5&gt;を押してコンソールにアクセスします。</para>
     </step>
     <step xml:id="bomcamo">
      <para>コンソールを使用して、<filename>/boot/grub/device.map</filename>ファイルの<filename>hd0</filename>エントリにパッシブパスが入力されているかどうか判別します。</para>
      <para>これは、インストールではアクティブパスとパッシブパスが区別されないので必要です。</para>
      <substeps performance="required">
       <step xml:id="bomcby2">
        <para role="intro">次のように入力して、ルートデバイスを<filename>/mnt</filename>にマウントします。</para>

<screen>
mount /dev/disk/by-id/&lt;<replaceable>UUID</replaceable>&gt;_part2 /mnt
</screen>

        <para role="intro">例えば、次のように入力して、すべてのフォントについてアンチエイリアスを無効にします。</para>

<screen>
mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt
</screen>

       </step>
       <step xml:id="bomcfm2">
        <para role="intro">次のように入力して、ブートデバイスを<filename>/mnt/boot</filename>にマウントします。</para>

<screen>
mount /dev/disk/by-id/&lt;<replaceable>UUID</replaceable>&gt;_part1 /mnt/boot
</screen>

        <para role="intro">例えば、次のように入力して、すべてのフォントについてアンチエイリアスを無効にします。 </para>

<screen>
mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt/boot
</screen>

       </step>
       <step xml:id="bomcg7c">
        <para>次のように入力して、<filename>/mnt/boot/grub/device.map</filename>ファイルを開きます。</para>

<screen>
less /mnt/boot/grub/device.map
</screen>

       </step>
       <step xml:id="bomcg05">
        <para><filename>/mnt/boot/grub/device.map</filename>ファイルで<filename>hd0</filename>エントリがパッシブパスをポイントしているかどうか判別し、次のいずれかを実行します。</para>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <formalpara xml:id="bomchix">
           <title>アクティブパス:</title>
           <para>アクションは不要です。<xref linkend="bomc8jz" xrefstyle="StepXRef"/>をスキップして、<xref linkend="bomcboo" xrefstyle="StepXRef"/>に進みます。</para>
          </formalpara>
         </listitem>
         <listitem>
          <formalpara xml:id="bomciib">
           <title>パッシブパス:</title>
           <para>設定を変更し、ブートローダを再インストールする必要があります。<xref linkend="bomc8jz" xrefstyle="StepXRef"/>に進みます。</para>
          </formalpara>
         </listitem>
        </itemizedlist>
       </step>
      </substeps>
     </step>
     <step xml:id="bomc8jz">
      <para role="intro">hd0エントリがパッシブパスをポイントする場合は、設定を変更し、ブートローダを再インストールします。</para>
      <substeps performance="required">
       <step xml:id="bomcmd6">
        <para role="intro">コンソールのコンソールプロンプトで、次のコマンドを入力します。</para>

<screen>
mount -o bind /dev /mnt/dev

mount -o bind /sys /mnt/sys

mount -o bind /proc /mnt/proc

chroot

</screen>

       </step>
       <step xml:id="bomclu7">
        <para role="intro">コンソールで、<command>multipath -ll</command>を実行し、その出力をチェックして、アクティブパスを見つけます。 </para>
        <para>パッシブパスには<literal>ghost</literal>フラグが付いています。</para>
       </step>
       <step xml:id="bomcmwr">
        <para><filename>/mnt/boot/grub/device.map</filename>ファイルで<literal>hd0</literal>エントリをアクティブパスに変更し、変更内容を保存し、ファイルを閉じます。</para>
       </step>
       <step xml:id="bomcndj">
        <para role="intro">MBRからのブートが選択されていた場合、<filename>/etc/grub.conf</filename>は次のようになります。</para>

<screen>
setup --stage2=/boot/grub/stage2 (hd0) (hd0,0)
quit
</screen>

       </step>
       <step xml:id="bomcoe1">
        <para role="intro">次のコマンドを入力して、ブートローダを再インストールします。</para>

<screen>
grub &lt; /etc/grub.conf
</screen>

       </step>
       <step xml:id="bomcol7">
        <para role="intro">次のコマンドを入力します。</para>

<screen>
exit

umount /mnt/*

umount /mnt
</screen>

       </step>
      </substeps>
     </step>
     <step xml:id="bomcboo">
      <para>&lt;CTRL&gt; + &lt;ALT&gt; + &lt;F7&gt;を押して、YaSTグラフィック環境に戻ります。 </para>
     </step>
     <step xml:id="bomcjfg">
      <para><guimenu>OK</guimenu>をクリックして、インストールを再起動します。</para>
     </step>
    </procedure>
   </section>
  </section>
  <section xml:id="bomc64f">
   <title>既存ルートデバイス用マルチパスI/Oの有効化</title>
   <procedure xml:id="b7cjqvq">
    <step xml:id="b7cjqvr">
     <para>Linuxをインストールし、1つだけパスをアクティブにします。このパスは、パーティショナで<filename>by-id</filename>シンボリックリンクがリストされるパスがお勧めです。</para>
    </step>
    <step xml:id="b7cjrle">
     <para>インストール時に使用した<filename>/disk//disk/by-id</filename>パスを使用してデバイスをマウントします。</para>
    </step>
    <step xml:id="b7cjs32">
     <para>インストール後、<command>dm-multipath</command>を<filename>/etc/sysconfig/kernel:INITRD_MODULES</filename>に追加します。</para>
    </step>
    <step xml:id="bky5jc7">
     <para>System Zの場合、mkinitrdの実行前に、<filename>/etc/zipl.conf</filename>ファイルを編集して<filename>zipl.conf</filename>内のby-path情報を、/<filename>etc/fstab</filename>で使用されたby-id情報に変更します。 </para>
    </step>
    <step xml:id="b7cjsl3">
     <para><command>/sbin/mkinitrd</command>を再実行して、<filename>initrd</filename>イメージを更新します。</para>
    </step>
    <step xml:id="bky5j1x">
     <para>System Zの場合は、<command>mkinitrd</command>の実行後、<command>zipl</command>を実行します。</para>
    </step>
    <step xml:id="b7cjuv4">
     <para>サーバを再起動します。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="bomc64g">
   <title>ルートデバイスのマルチパスI/Oの無効化</title>
   <procedure xml:id="b7jqdde">
    <step xml:id="b7jqddf">
     <para><literal>multipath=off</literal>をカーネルコマンドラインに追加します。</para>
     <para>これは、ルートデバイスだけに影響します。他のすべてのデバイスは影響されません。</para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="mpioraid">
  <title>既存ソフトウェアRAID用マルチパスI/Oの設定</title>
  <para>理想的には、デバイスのマルチパス処理を設定してから、それらのデバイスをソフトウェアRAIDデバイスのコンポーネントとして使用してください。ソフトウェアRAIDデバイスの作成後にマルチパス処理を追加した場合は、再起動時に<command>multipath</command>サービスの後でDM-MPIOサービスが開始することがあります。その場合は、マルチパス処理がRAIDに使用できないように見えます。本項の手順を使用すると、すでに存在しているソフトウェアRAIDに対してマルチパス処理を実行できます。 </para>
  <para>たとえば、次のような場合は、ソフトウェアRAID内のデバイスにマルチパス処理を設定する必要があることがあります。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>新規インストールまたはアップグレード時にパーティショニング設定の一部として、新しいソフトウェアRAIDを作成する場合</para>
   </listitem>
   <listitem>
    <para>マルチパス処理用に設定しなかったデバイスをメンバーデバイスまたはスペアとしてソフトウェアRAIDで使用する場合</para>
   </listitem>
   <listitem>
    <para>新しいHBAアダプタをサーバに追加するか、またはSAN内でストレージサブシステムを拡張することで、システムを大きくする場合 </para>
   </listitem>
  </itemizedlist>
  <note>
   <para>以降の説明では、ソフトウェアRAIDデバイスを<filename>/dev/mapper/mpath0&gt;</filename>(カーネルによって認識されるデバイス名)と想定しています。<filename>/etc/multipath.conf</filename>ファイルで、ユーザフレンドリ名を有効にしている(<xref linkend="mpionames" xrefstyle="HeadingOnPage"/>に記載)ことを想定しています。 </para>
   <para>ソフトウェアRAIDのデバイス名の指定は、必ず変更してください。</para>
  </note>
  <procedure xml:id="b59pkd5">
   <step xml:id="b59qv1e">
    <para role="intro">端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
    <para>特に指示のない限り、この端末を使用して、以降のステップでコマンドを入力します。</para>
   </step>
   <step xml:id="b59qezr">
    <para>ソフトウェアRAIDデバイスが現在マウントされているか、または実行中の場合、デバイスごとに次のコマンドを入力して、デバイスをマウント解除し、停止します。</para>

<screen>
umount /dev/mapper/mpath0
</screen>


<screen>
mdadm --misc --stop /dev/mapper/mpath0
</screen>

   </step>
   <step xml:id="b59q95b">
    <para>次のように入力して、<command>boot.md</command>サービスを停止します。</para>

<screen>
/etc/init.d/boot.md stop
</screen>

   </step>
   <step xml:id="b59qeuu">
    <para>以降のコマンドで、<filename>boot.multipath</filename>サービスおよび<filename>multipathd</filename>サービスを開始します。</para>

<screen>
/etc/init.d/boot.multipath start
</screen>


<screen>
/etc/init.s/multipathd start
</screen>

   </step>
   <step xml:id="b59qp65">
    <para>マルチパス処理サービスの開始後、ソフトウェアRAIDのコンポーネントデバイスが<filename>/dev/disk/by-id</filename>ディレクトリにリストされているかどうか確認します。次のいずれかの操作を行います。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b59qrp7">
       <title>デバイスがリストされている:</title>
       <para>デバイス名に、デバイスマッパーマルチパスのデバイス名(<filename>/dev/dm-1</filename>など)へのシンボリックリンクがあるはずです。 </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b59qrx0">
       <title>デバイスがリストされていない:</title>
       <para>デバイスをフラッシュし、再検出することで、マルチパスサービスにデバイスを認識させます。 </para>
      </formalpara>
      <para>この操作を行うには、次のコマンドを入力します。</para>

<screen>
multipath -F
</screen>


<screen>
multipath -v0
</screen>

      <para>これで、デバイスが<filename>/dev/disk/by-id</filename>内にリストされ、デバイスマッパーマルチパスのデバイス名へのシンボリックリンクを持ちます。次に例を示します。</para>

<screen>
lrwxrwxrwx 1 root root 10 2011-01-06 11:42 dm-uuid-mpath-36006016088d014007e0d0d2213ecdf11 -&gt; ../../dm-1
</screen>

     </listitem>
    </itemizedlist>
   </step>
   <step xml:id="b59qtrw">
    <para>次のように入力して、<filename>boot.md</filename>サービスとRAIDデバイスを再起動します。 </para>

<screen>
/etc/init.d/boot.md start
</screen>

   </step>
   <step xml:id="b59qu7z">
    <para>次のように入力して、ソフトウェアRAIDの状態をチェックします。</para>

<screen>
mdadm --detail /dev/mapper/mpath0
</screen>

    <para>RAIDのコンポーネントデバイスは、そのデバイスマッパーマルチパスのデバイス名(<filename>/dev/disk/by-id</filename>ディレクトリにデバイスのシンボリックリンクとしてリストされている）と一致する必要があります。</para>
   </step>
   <step xml:id="b59r62x">
    <para>新しい<filename>initrd</filename>を作成して、デバイスマッパーマルチパスのサービスが再起動時にRAIDサービスの前にロードされるようにしてください。<command>mkinitrd</command>の実行が必要なのは、ルート(/)デバイスまたはその一部(<filename>/var</filename>、<filename>/etc</filename>、<filename>/log</filename>など)がSAN上にあり、マルチパスのブートが必要な場合のみです。</para>
    <para>以下を入力してください。</para>

<screen>
mkinitrd -f multipath
</screen>

   </step>
   <step xml:id="b59rekg">
    <para>サーバを再起動して、これらのポストインストール構成の設定を適用します。</para>
   </step>
   <step xml:id="b59rf4m">
    <para>RAIDステータスをチェックして、ソフトウェアRAIDアレイが、マルチパスデバイスの上に正しく示されることを確認します。以下を入力してください。</para>

<screen>
mdadm --detail /dev/mapper/mpath0
</screen>

    <para>次に例を示します。</para>
    <simplelist>
     <member><literal>Number Major Minor RaidDevice State</literal></member> <member> <literal>0 253 0 0 active sync /dev/dm-0</literal></member> <member> <literal>1 253 1 1 active sync /dev/dm-1</literal></member> <member> <literal>2 253 2 2 active sync /dev/dm-2</literal></member>
    </simplelist>
   </step>
  </procedure>
 </section>
 <section xml:id="scandev">
  <title>新規デバイスのスキャン(再起動なし)</title>
  <para>ご使用のシステムがマルチパス処理用に設定されており、後からSANにストレージを追加する必要がある場合は、<command>rescan-scsi-bus.sh</command>スクリプトを使用して新しいデバイスをスキャンすることができます。デフォルトでは、このスクリプトは典型的なLUN範囲ですべてのHBAをスキャンします。 </para>
  <warning>
   <para>EMC PowerPath環境では、SCSIバスをスキャンする場合に、オペレーティングシステムに付属する<filename>rescan-scsi-bus.sh</filename>ユーティリティまたはHBAベンダスクリプトを使用しないでください。ファイルシステムが破損する可能性を避けるため、EMCでは、Linux用EMC PowerPathのベンダマニュアルに記載されている手順に従うよう求めています。</para>
  </warning>
  <bridgehead xml:id="boimjzp">構文</bridgehead>

<screen>
rescan-scsi-bus.sh [options] [host [host ...]]
</screen>

  <para>コマンドラインでホストを指定するか(廃止予定)、<literal>--hosts=LIST</literal>オプション(推奨)を使用することができます。</para>
  <bridgehead xml:id="boimk55">オプション</bridgehead>
  <para>ほとんどのストレージサブシステムでは、このスクリプトはオプションを指定しなくても正常に実行されます。ただし、特殊な場合は<command>rescan-scsi-bus.sh</command>スクリプトに対して、次のいずれかのパラメータを使用する必要があります。</para>
  <informaltable>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="2381*"/>
   <colspec colnum="2" colname="2" colwidth="7620*"/>
    <thead>
     <row><!--id=boiml8l-->
      <entry>
       <para>オプション</para>
      </entry>
      <entry>
       <para>説明</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row><!--id=boiml8m-->
      <entry>

<screen>
-l
</screen>
</entry>
      <entry>
       <para>LUN 0～7のスキャンを起動。[デフォルト: 0]</para>
      </entry>
     </row>
     <row><!--id=boiml8n-->
      <entry>

<screen>
-L NUM
</screen>
</entry>
      <entry>
       <para>LUN 0～NUMのスキャンを起動。[デフォルト: 0]</para>
      </entry>
     </row>
     <row><!--id=boiml8o-->
      <entry>

<screen>
-w
</screen>
</entry>
      <entry>
       <para>ターゲットデバイスIDが0～15をスキャンします。［デフォルト: 0～7］</para>
      </entry>
     </row>
     <row><!--id=boimoae-->
      <entry>

<screen>
-c
</screen>
</entry>
      <entry>
       <para>チャネル0または1のスキャンを有効にします。[デフォルト: 0]</para>
      </entry>
     </row>
     <row><!--id=boimoaf-->
      <entry>

<screen>
-r
--remove
</screen>
</entry>
      <entry>
       <para>デバイスの削除を有効にします。［デフォルト:無効］</para>
      </entry>
     </row>
     <row><!--id=boimoag-->
      <entry>

<screen>
-i
--issueLip
</screen>
</entry>
      <entry>
       <para>ファイバチャネルLIPのリセットを発行します。［デフォルト:無効］</para>
      </entry>
     </row>
     <row><!--id=boimoah-->
      <entry>

<screen>
--forcerescan
</screen>
</entry>
      <entry>
       <para>既存デバイスを再度スキャンします。</para>
      </entry>
     </row>
     <row><!--id=boimoai-->
      <entry>

<screen>
--forceremove
</screen>
</entry>
      <entry>
       <para>各デバイスを削除し、再度追加します。 </para>
       <warning>
        <para>このオプションは危険なので、注意して使用してください。</para>
       </warning>
      </entry>
     </row>
     <row><!--id=boimoaj-->
      <entry>

<screen>
--nooptscan
</screen>
</entry>
      <entry>
       <para>0が検出できない場合は、LUNの検索を中止しないでください。</para>
      </entry>
     </row>
     <row><!--id=boj5t9m-->
      <entry>

<screen>
--color
</screen>
</entry>
      <entry>
       <para>色付きのプレフィクス、OLD/NEW/DELを使用します。</para>
      </entry>
     </row>
     <row><!--id=boj5t9n-->
      <entry>

<screen>
--hosts=LIST
</screen>
</entry>
      <entry>
       <para>LIST内のホストだけをスキャンします。ここでLISTは、単一の値と範囲をカンマで区切ったリストです。スペースは使用できません。</para>

<screen>
--hosts=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row><!--id=boj5t9o-->
      <entry>

<screen>
--channels=LIST
</screen>
</entry>
      <entry>
       <para>LIST内のチャネルだけをスキャンします。ここでLISTは、単一の値と範囲をカンマで区切ったリストです。スペースは使用できません。 </para>

<screen>
--channels=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row><!--id=boj5t9p-->
      <entry>

<screen>
--ids=LIST
</screen>
</entry>
      <entry>
       <para>LIST内のターゲットIDだけをスキャンします。ここでLISTは、単一の値と範囲をカンマで区切ったリストです。スペースは使用できません。 </para>

<screen>
--ids=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row><!--id=boimoak-->
      <entry>

<screen>
--luns=LIST
</screen>
</entry>
      <entry>
       <para>LIST内のLUNだけをスキャンします。ここでLISTは、単一の値と範囲をカンマで区切ったリストです。スペースは使用できません。</para>

<screen>
--luns=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <bridgehead xml:id="boj5xxj">手順</bridgehead>
  <para>次のプロシージャを使用して、システムを再起動せずに、デバイスをスキャンして、マルチパス処理に使用できるようにします。 </para>
  <procedure xml:id="b59rt6j">
   <step xml:id="b59rt6k">
    <para>ストレージサブシステムで、ベンダのツールを使用してデバイスを割り当て、そのアクセス制御設定を更新して、Linuxシステムが新しいストレージをアクセスできるようにします。詳細については、ベンダのマニュアルを参照してください。</para>
   </step>
   <step xml:id="b59rw69">
    <para>すべてのターゲットをスキャンしてホストの有無を調べ、LinuxカーネルのSCSIサブシステムのミドルレイヤに新しいデバイスを認識させます。端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
rescan-scsi-bus.sh [options]
</screen>

   </step>
   <step xml:id="b8ru7x3">
    <para>システムログ<filename>/var/log/messages</filename>ファイル)をチェックしてスキャニングの進行状況を調べます。端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
tail -30 /var/log/messages
</screen>

    <para>このコマンドは、ログの最後の30行を表示します。次に例を示します。</para>

<screen>
# tail -30 /var/log/messages
. . .
Feb 14 01:03 kernel: SCSI device sde: 81920000
Feb 14 01:03 kernel: SCSI device sdf: 81920000
Feb 14 01:03 multipathd: sde: path checker registered
Feb 14 01:03 multipathd: sdf: path checker registered
Feb 14 01:03 multipathd: mpath4: event checker started
Feb 14 01:03 multipathd: mpath5: event checker started
Feb 14 01:03:multipathd: mpath4: remaining active paths: 1
Feb 14 01:03 multipathd: mpath5: remaining active paths: 1
</screen>

   </step>
   <step xml:id="b8ruapd">
    <para><xref linkend="b59rw69" xrefstyle="StepXRef"/>から<xref linkend="b8ru7x3" xrefstyle="StepXRef"/>まで繰り返し、新しいデバイスに接続しているLinuxシステム上の他のHBAアダプタを介して、パスを追加します。</para>
   </step>
   <step xml:id="b59ryjx">
    <para><command>multipath</command>コマンドを実行して、DM-MPIO設定用のデバイスを認識します。端末コンソールのプロンプトで、次のように入力します。 </para>

<screen>
multipath
</screen>

    <para>これで、新しいデバイスをマルチパス処理用に設定できます。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="be48i9g">
  <title>パーティショニングされた新規デバイスのスキャン(再起動なし)</title>
  <para role="intro">本項の例を使用して、新たに追加したマルチパスLUNを再起動なしで検出します。</para>
  <warning>
   <para>EMC PowerPath環境では、SCSIバスをスキャンする場合に、オペレーティングシステムに付属する<filename>rescan-scsi-bus.sh</filename>ユーティリティまたはHBAベンダスクリプトを使用しないでください。ファイルシステムが破損する可能性を避けるため、EMCでは、Linux用EMC PowerPathのベンダマニュアルに記載されている手順に従うよう求めています。</para>
  </warning>
  <procedure xml:id="befqdst">
   <step xml:id="befqdsu">
    <para>端末コンソールを開き、<systemitem>root</systemitem>ユーザとしてログインします。</para>
   </step>
   <step xml:id="boj61wx">
    <para>すべてのターゲットをスキャンしてホストの有無を調べ、LinuxカーネルのSCSIサブシステムのミドルレイヤに新しいデバイスを認識させます。端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
rescan-scsi-bus.sh [options]
</screen>

    <para><filename>rescan-scsi-bus-sh</filename>スクリプトの構文とオプション情報の詳細については、<xref linkend="scandev" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </step>
   <step xml:id="befqeer">
    <para>次のように入力して、デバイスが認識されていること(リンクに新しいタイムスタンプが付いているかどうかなど)を確認します。</para>

<screen>
ls -lrt /dev/dm-*
</screen>

    <para>次のように入力して、<filename>/dev/disk/by-id</filename>内のデバイスを確認することもできます。</para>

<screen>
ls -l /dev/disk/by-id/
</screen>

   </step>
   <step xml:id="befqfh9">
    <para>次のように入力して、新しいデバイスがログに表示されることを確認します。</para>

<screen>
tail -33 /var/log/messages
</screen>

   </step>
   <step xml:id="befqhvc">
    <para>テキストエディタで、デバイスの新しいエイリアス定義を<filename>/etc/multipath.conf</filename>ファイルに追加します(<filename>data_vol3</filename>など)。 </para>
    <para>たとえば、UUIDが<filename>36006016088d014006e98a7a94a85db11</filename>であれば、次の変更を行います。</para>

<screen>
defaults {
     user_friendly_names   yes
  }
multipaths {  
     multipath {      
          wwid    36006016088d014006e98a7a94a85db11      
          alias  data_vol3      
          }
  }
</screen>

   </step>
   <step xml:id="befqj91">
    <para>次の入力で、デバイスのパーティションテーブルを作成します。</para>

<screen>
fdisk /dev/disk/by-id/dm-uuid-mpath-&lt;UUID&gt;
</screen>

    <para>UUIDをデバイスのWWID(<filename>36006016088d014006e98a7a94a85db11</filename>など)で置き換えます。</para>
   </step>
   <step xml:id="befqjhp">
    <para>次のように入力して、udevをトリガします。</para>

<screen>
echo 'add' &gt; /sys/block/&lt;<replaceable>dm_device</replaceable>&gt;/uevent
</screen>

    <para>たとえば、<filename>dm-8</filename>上のパーティションに対して、デバイスマッパーデバイスを生成するには、次のように入力します。</para>

<screen>
echo 'add' &gt; /sys/block/dm-8/uevent
</screen>

   </step>
   <step xml:id="befqkj8">
    <para>次のコマンドを入力して、新しいパーティションのファイルシステムおよびラベルを作成します。</para>

<screen>
mke2fs -j /dev/disk/by-id/dm-uuid-mpath-&lt;<replaceable>UUID_partN</replaceable>&gt;
tune2fs -L <replaceable>data_vol3</replaceable> /dev/disk/by-id/dm-uuid-&lt;<replaceable>UUID_partN</replaceable>&gt;
</screen>

    <para><filename>UUID_part1</filename>を、実際のUUIDおよびパーティション番号(36006016088d014006e98a7a94a85db11_part1など)で置き換えます。</para>
   </step>
   <step xml:id="befqljm">
    <para>次の入力で、DM-MPIOを再起動して、エイリアスを読み込ませます。</para>

<screen>
/etc/init.d/multipathd restart
</screen>

   </step>
   <step xml:id="befqmbi">
    <para role="intro">次の入力で、デバイスが<command>multipathd</command>によって認識されていることを確認します。</para>

<screen>
multipath -ll
</screen>

   </step>
   <step xml:id="befqmno">
    <para>テキストエディタで、<filename>/etc/fstab</filename>ファイルにマウントエントリを追加します。 </para>
    <para>この時点では、<xref linkend="befqhvc" xrefstyle="StepXRef"/>で作成したエイリアスは、まだ、<filename>/dev/disk/by-label</filename>ディレクトリにあります。マウントエントリを<filename>/dev/dm-9</filename>パスに追加した後、次回の再起動の前に、マウントエントリを次のように変更します。 </para>

<screen>
LABEL=data_vol3
</screen>

   </step>
   <step xml:id="befqr98">
    <para>次のように入力して、マウントポイントとして使用するディレクトリを作成し、デバイスをマウントします。</para>

<screen>
md <replaceable>/data_vol3</replaceable>
</screen>


<screen>
mount <replaceable>/data_vol3</replaceable>
</screen>

   </step>
  </procedure>
 </section>
 <section xml:id="mpiostatus">
  <title>マルチパスI/Oステータスの表示</title>
  <para>マルチパスI/Oのステータスをクエリすると、マルチパスマップの現在のステータスが出力されます。 </para>
  <para><command>multipath -l</command>オプションを使用すると、パスチェッカが最後に実行された時点での現行パスステータスが表示されます。ただし、パスチェッカは実行されません。 </para>
  <para><command>multipath -ll</command>オプションを使用すると、パスチェッカが実行され、パス情報が更新され、最後に、現在のステータス情報が表示されます。このオプションは、常に、パスステータスの最新情報を表示します。</para>
  <procedure xml:id="b8ruq0c">
   <step xml:id="b8ruq0d">
    <para>端末コンソールのプロンプトで、次のように入力します。</para>

<screen>
multipath -ll
</screen>

    <para>各マルチパスデバイスの情報が表示されます。次に例を示します。</para>

<screen>
3600601607cf30e00184589a37a31d911
[size=127 GB][features="0"][hwhandler="1 emc"]
</screen>


<screen>
\_ round-robin 0 [active][first]
  \_ 1:0:1:2 sdav 66:240  [ready ][active]
  \_ 0:0:1:2 sdr  65:16   [ready ][active]
</screen>


<screen>
\_ round-robin 0 [enabled]
  \_ 1:0:0:2 sdag 66:0    [ready ][active]
  \_ 0:0:0:2 sdc  8:32    [ready ][active]
</screen>

   </step>
  </procedure>
  <para>デバイスごとに、デバイスのID、サイズ、機能、およびハードウェアハンドラが表示されます。</para>
  <para>デバイスへのパスは、自動的に、デバイス検出時に優先度グループとしてグループ化されます。一度に1つの優先度グループだけがアクティブになります。アクティブ/アクティブ構成の場合、すべてのパスが同じグループに属します。アクティブ/パッシブ構成の場合、パッシブパスは別個の優先度グループに属しれます。 </para>
  <para>グループごとに、次の情報が表示されます。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>ラウンドロビン方式など、グループ内でのI/O負荷の分散に使用されるスケジューリングポリシー</para>
   </listitem>
   <listitem>
    <para>グループがアクティブか、無効か、または有効か</para>
   </listitem>
   <listitem>
    <para>最初の(優先度の最も高い)グループかどうか</para>
   </listitem>
   <listitem>
    <para>グループ内に含まれるパス</para>
   </listitem>
  </itemizedlist>
  <para>パスごとに、次の情報が表示されます。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><replaceable>host:bus:target:lun</replaceable>としての物理アドレス(1:0:1:2など)</para>
   </listitem>
   <listitem>
    <para>デバイスノード 名(<filename>sda</filename>など)</para>
   </listitem>
   <listitem>
    <para>メジャー/マイナー番号</para>
   </listitem>
   <listitem>
    <para>デバイスのステータス</para>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="mpioerrormgmt">
  <title>エラーになったI/Oの管理</title>
  <para>queue_if_no_pathを有効にすることで、すべてのパスで同時に障害が発生した場合は、I/Oをキューに登録するように、マルチパス処理を設定する必要があるかもしれません。設定しておかないと、すべてのパスに障害が発生するとI/Oもすぐに失敗してしまいます。ドライバ、HBA、またはファブリックにスプリアスエラーが発生したというシナリオでは、それらのエラーですべてのパスが失われるI/Oをすべて待ち行列に入れ、エラーを上方にプロパゲートしないように、DM-MPIOを設定してください。 </para>
  <para>マルチパスデバイスをクラスタで使用する場合は、queue_if_no_pathを無効にすることができます。これにより、I/Oがキューに入る代わりに、パスがエラーになり、そのI/Oエラーがエスカレートしてクラスタリソースのフェールオーバーを引き起こします。</para>
  <para>ただし、queue_if_no_pathを有効にすると、パスが回復しない限り、I/Oがいつまでもキューに留まることになるので、<command>multipathd</command>が実行中であり、シナリオに有効なことを必ず確認してください。確認しておかないと、再起動するまで、またはキューの代わりに手動でフェールオーバーに戻すまで、影響を受けたマルチパスデバイスでI/Oが無限に停止する可能性があります。</para>
  <para>シナリオをテストするには:</para>
  <procedure xml:id="b5c8xoe">
   <step xml:id="b7jqv1b">
    <para>端末コンソールで、<systemitem>root</systemitem>ユーザとしてログインします。 </para>
   </step>
   <step xml:id="b7jqw8e">
    <para>次の入力で、デバイスI/Oに関して、フェールオーバーの代わりに待ち行列処理をアクティブにします。</para>

<screen>
dmsetup message <replaceable>device_ID</replaceable> 0 queue_if_no_path
</screen>

    <para><replaceable>device_ID</replaceable>を実際のデバイスのIDに置き換えます。値0はセクタを表し、セクタ情報が必要でないときに使用されます。 </para>
    <para>たとえば、次のように入力します。</para>

<screen>
dmsetup message 3600601607cf30e00184589a37a31d911 0 queue_if_no_path
</screen>

   </step>
   <step xml:id="b7jqwaz">
    <para>次の入力で、デバイスI/Oのフェールオーバーに戻ります。</para>

<screen>
dmsetup message <replaceable>device_ID</replaceable> 0 fail_if_no_path
</screen>

    <para>このコマンドにより、ただちに、待ち行列に入ったすべてのI/Oがエラーになります。</para>
    <para><replaceable>device_ID</replaceable>を実際のデバイスのIDに置き換えます。たとえば、次のように入力します。</para>

<screen>
dmsetup message 3600601607cf30e00184589a37a31d911 0 fail_if_no_path
</screen>

   </step>
  </procedure>
  <para>待ち行列内のI/Oをすべてのパスがエラーになるシナリオ用に設定するには:</para>
  <procedure xml:id="b7jqzyt">
   <step xml:id="b7jr0j0">
    <para>端末コンソールで、<systemitem>root</systemitem>ユーザとしてログインします。 </para>
   </step>
   <step xml:id="b5c9aza">
    <para><filename>/etc/multipath.conf</filename>ファイルをテキストエディタで開きます。</para>
   </step>
   <step xml:id="b5c99rh">
    <para>defaultsセクションとその閉じ括弧を非コメント化した後、次のように<literal>default_features</literal>設定を追加します。</para>

<screen>
defaults {
  default_features "1 queue_if_no_path"
}
</screen>

   </step>
   <step xml:id="bi0b03b">
    <para><filename>/etc/multipath.conf</filename>ファイルの変更後、<command>mkinitrd</command>を実行してシステム上にINITRDを作成し、次に、再起動で変更内容を有効にします。<filename/></para>
   </step>
   <step xml:id="b7jr4r4">
    <para>デバイスI/Oのフェールオーバーに戻る準備ができたら、次のように入力します。</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 fail_if_no_path
</screen>

    <para><replaceable>mapname</replaceable>を該当デバイスのマップされたエイリアス名またはデバイスIDに置き換えます。値0はセクタを表し、セクタ情報が必要でないときに使用されます。 </para>
    <para>このコマンドにより、待ち行列で待機中のすべてのI/Oがエラーとなり、エラーが呼び出し側アプリケーションにプロパゲートします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="mpiostall">
  <title>停止したI/Oの解決</title>
  <para>すべてパスが同時にエラーとなり、I/Oが待ち行列に入って停止している場合は、次のプロシージャを実行します。</para>
  <procedure xml:id="b7jlq1g">
   <step xml:id="b7jlq1h">
    <para>端末コンソールのプロンプトで、次のコマンドを入力します。</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 fail_if_no_path
</screen>

    <para><literal><replaceable>mapname</replaceable></literal>をデバイスの正しいデバイスIDまたはマップされたエイリアス名で置き換えます。値0はセクタを表し、セクタ情報が必要でないときに使用されます。 </para>
    <para>このコマンドにより、待ち行列で待機中のすべてのI/Oがエラーとなり、エラーが呼び出し側アプリケーションにプロパゲートします。 </para>
   </step>
   <step xml:id="b7jlq74">
    <para>端末コンソールのプロンプトで、次のコマンドを入力して、待ち行列を再度アクティブにします。</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 queue_if_no_path
</screen>

   </step>
  </procedure>
 </section>
 <section xml:id="bpjpirk">
  <title>MPIOのトラブルシューティング</title>
  <para>本項では、MPIOに関するいくつかの既知の問題と、考えられる解決手段について説明します。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b11qkzgw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122uxzr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b11qkzgx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b11qkzgw">
   <title>マルチパス0.4.9への更新後に、個別デバイスのprio設定が失敗する</title>
   <para>SLES 11 SP2用マルチパスツール 2以降では、<literal>/etc/multipath.conf</literal>ファイルの<literal>defaults{}</literal>または<literal>devices{}</literal>セクションの<filename>prio</filename>設定を使用します。キーワード<literal>prio</literal>が、<literal>multipath{)</literal>セクションの個別の<literal>multipaths</literal>定義に指定された場合は、暗黙のうちに無視されます。</para>
   <para>SLES 11 SP1用のマルチパスツール0.4.8以前では、<literal>multipath{)</literal>セクションの個別の<literal>multipaths</literal>定義内のprio設定で、<literal>defaults{}</literal>または<literal>devices{}</literal>セクションの<literal>prio</literal>設定を上書きすることができました。</para>
  </section>
  <section xml:id="b122uxzr">
   <title>multipath-tools-0.4.9への更新後に、引数を伴うprio設定が失敗する</title>
   <para><filename>multipath-tools-0.4.8</filename>から<filename>multipath-tools-0.4.9</filename>に更新すると、引数を必要とするPrioritizerの場合、<literal>/etc/multipath.conf</literal>ファイル内の<filename>prio</filename>設定が壊れます。multipath-tools-0.4.9では、Prioritizerの指定には<literal>prio</literal>キーワードが使われ、引数を必要とするPrioritizerの指定には、<literal>prio_args</literal>キーワードが使われます。これまでは、Prioritizerとその引数はいずれも、同じ<literal>prio</literal>行で指定していました。</para>
   <para>たとえば、multipath-tools-0.4.8では、次の行を使用してPrioritizerとその引数を同じ行で指定していました。</para>

<screen>
prio "weightedpath hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"
</screen>

   <para role="intro"><command>multipath-tools-0.4.9</command>への更新後は、このコマンドを使用するとエラーとなります。メッセージの例を以下に示します。</para>

<screen>
&lt;Month day hh:mm:ss&gt; | Prioritizer 'weightedpath hbtl [1,3]:.:.+:.+ 260
[0,2]:.:.+:.+ 20' not found in /lib64/multipath
</screen>

   <para>この問題を解決するには、テキストエディタで、<literal>/etc/multipath.conf</literal>ファイル内の<filename>prio</filename>行を変更します。2つの行を作成して、<filename>prio</filename>行にPrioritizerを指定し、その下の<filename>prio_args</filename>行にPrioritizerの引数を指定します。</para>

<screen>
prio "weightedpath"
prio_args "hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"
</screen>

  </section>
  <section xml:id="b11qkzgx">
   <title>技術情報ドキュメント</title>
   <para>SUSE Linux Enterprise ServerのマルチパスI/Oの問題のトラブルシューティングについては、Novellサポートナレッジベースにある、次のTID (技術情報ドキュメント)を参照してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><link xlink:href="http://www.novell.com/support/kb/doc.php?id=3231766"><citetitle>Troubleshooting SLES Multipathing (MPIO) Problems (TID 3231766)</citetitle></link></para>
    </listitem>
    <listitem>
     <para><link xlink:href="http://www.novell.com/support/kb/doc.php?id=3029706"><citetitle>DM MPIO Device Blacklisting Not Honored in multipath.conf (TID3029706)</citetitle></link></para>
    </listitem>
    <listitem>
     <para><link xlink:href="http://www.novell.com/support/kb/doc.php?id=3955167"><citetitle>Troubleshooting SCSI (LUN) Scanning Issues (TID 3955167)</citetitle></link></para>
    </listitem>
    <listitem>
     <para><link xlink:href="http://www.novell.com/support/kb/doc.php?id=7007498"><citetitle>Using LVM on Multipath (DM MPIO) Devices</citetitle></link></para>
    </listitem>
   </itemizedlist>
  </section>
 </section>
 <section xml:id="mpionext">
  <title>次に行う作業</title>
  <para>ソフトウェアRAIDを使用したい場合は、デバイス上でファイルシステムを作成してから、ソフトウェアRAIDの作成と設定をしてください。詳細については、次のリンクを参照してください。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidyast" xrefstyle="ChapTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadm" xrefstyle="ChapTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
 </section>
</chapter>

<chapter xml:id="raidyast" xml:lang="ja" xml:base="05_raid.xml"><?dbfo-need height="10em"?><title>ソフトウェアRAIDの設定</title><info/>
 
 <para>RAID (Redundant Array of Independent Disks)の目的は、複数のハードディスクパーティションを1つの大きい仮想ハードディスクに結合し、パフォーマンスとデータのセキュリティを最適化することです。ほとんどのRAIDコントローラはSCSIプロトコルを使用します。これは、IDEプロトコルも効率的な方法で多数のハードディスクのアドレスを指定でき、コマンドのパラレル処理に適しているからです。一方、IDEまたはSATAハードディスクをサポートしているRAIDコントローラもあります。ソフトウェアRAIDは、ハードウェアRAIDコントローラ購入による追加コストなしで、RAIDシステムの利点を提供します。ただし、これにはいくらかのCPU時間を要し、高性能なコンピュータには適さないメモリ要件があります。 </para>
 <important>
  <para>ソフトウェアRAIDは、OCFS2などのクラスタ化されたファイルシステムの下ではサポートされません。これはRAIDが同時起動をサポートしないためです。OCFS2にRAIDを使用したい場合は、RAIDをストレージサブシステムに処理させる必要があります。</para>
 </important>
 <para>SUSE Linux Enterpriseには、いくつかのハードディスクを1つのソフトウェアRAIDシステムに統合するオプションがあります。RAIDには、それぞれが異なる目標、利点、および属性をもついくつかのハードディスクを1つのRAIDシステムに結合するためのいくつかの戦略が含まれています。これらは通常、<emphasis>RAIDレベル</emphasis>と呼ばれます。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi70wwi" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-yast2-system-raid-yast" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchysg" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchysh" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="bi70wwi">
  <title>RAIDレベルの理解</title>
  <para>本項では、通常のRAIDレベル(0、1、2、3、4、5)とネストしたRAIDレベルについて説明します。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bgchysa" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysb" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchyse" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bgchysa">
   <title>RAID 0</title>
   <para>このレベルでは、各ファイルのブロックが複数のディスクドライブに分散されるので、データアクセスのパフォーマンスが向上します。このレベルはデータのバックアップを提供しないため、実際にはRAIDではありませんが、この種のシステムでは<emphasis>RAID  0</emphasis>という名前が一般的です。RAID 0では、2つ以上のハードディスクが互いにプールします。高いパフォーマンスが得られます。ただし、1つのハードディスクに障害が発生しただけで、RAIDシステムが破壊され、データは失われます。 </para>
  </section>
  <section xml:id="bgchysb">
   <title>RAID 1</title>
   <para>このレベルでは、データが他のハードディスクに一対一でコピーされるため、データに対する適切なセキュリティが提供されます。これは、<emphasis>ハードディスクミラーリング</emphasis>として知られています。ディスクが破壊された場合は、ディスクの内容のコピーをミラー先のもう1つのディスクで利用できます。したがって、1つのディスク以外のすべてのディスクが損なわれても、データを保全できます。ただし、損傷が検出されない場合は、正しいディスクに損傷したデータがミラーリングされる可能性があり、その場合はデータが壊れます。単一ディスクアクセスの使用時と比較すると、コピープロセスで書き込みのパフォーマンスが若干低下しますが(10～ 20%遅くなる)、読み取りアクセスは、通常の物理ハードディスクのどれと比べても、著しく高速です。これは、データが複製されているので、それらを並行してスキャンできるためです。RAID 1では、一般に、読み取りトランザクションの速度が単一ディスクのほぼ2倍、書き込みトランザクションの速度が単一ディスクと同じです。 </para>
  </section>
  <section xml:id="bgchysc">
   <title>RAID 2およびRAID 3</title>
   <para>これらは、一般的なRAID実装ではありません。レベル2では、データは、ブロックレベルではなく、ビットレベルでストライプ化されます。レベル3は、専用パリティディスクによってバイトレベルのストライプ化を提供しますが、複数の要求を同時にサービスすることはできません。両レベルとも、まれにしか使用されません。 </para>
  </section>
  <section xml:id="bgchysd">
   <title>RAID 4</title>
   <para>レベル4は、専用パリティディスクと結合されたレベル0と同様に、ブロックレベルのストライプ化を提供します。データディスクがエラーになると、パリティデータで置き換え用のディスクが作成されます。ただし、パリティディスクは、書き込みアクセスにボトルネックを生成する可能性があります。にもかかわらず、レベル4は時々使用されます。 </para>
  </section>
  <section xml:id="bgchyse">
   <title>RAID 5</title>
   <para>RAIDD 5は、レベル0とレベル1の間をパフォーマンスおよび冗長性の面で調整して、最適化したものです。ハードディスクスペースは、使用されるディスク数から1を引いたものに等しくなります。データは、RAIDD 0の場合のようにハードディスク間で分散されます。パーティションの1つで作成された<emphasis>パリティブロック</emphasis>があるのは、セキュリティ上の理由からです。各パーティションはXORによって互いにリンクされているので、システム障害の場合に、内容が対応するパリティブロックによって再構築されます。RAIDD 5の場合、同時に複数のハードディスクが障害を起こすことはありません。1つのハードディスクに障害がある場合は、そのハードディスクをできるだけ早く交換して、データ消失の危険性をなくす必要があります。 </para>
  </section>
  <section xml:id="bgchysf">
   <title>ネストしたRAIDレベル</title>
   <para>他にもいくつかのRAIDレベルが開発されています(RAIDn、RAID 10、RAID 0+1、RAID 30、RAID 50など)。それらの一部は、ハードウェアベンダによって作成された専有インプリメンテーションです。これらのレベルは、あまり広く使用されてはいないので、ここでの説明は省略します。 </para>
  </section>
 </section>
 <section xml:id="sec-yast2-system-raid-yast">
  <title>YaSTによるソフトウェアRAID設定</title>
  <para>YaSTソフトRAID設定には、YaST Expert Partitionerからアクセスできます。このパーティション設定ツールを使用すると、既存のパーティションを編集および削除したり、ソフトウェアRAIDで使用する新規パーティションを作成できます。 </para>
  <para>RAIDパーティションを作成するには、まず、<menuchoice> <guimenu>作成</guimenu><guimenu>Do not format(フォーマットしない)</guimenu></menuchoice>の順にクリックし、次に、<guimenu>0xFD Linux RAID</guimenu>を選択します。RAID 0およびRAID 1の場合、少なくとも2つのパーティションが必要です。RAID 1の場合、パーティションは2つだけです。RAID 5を使用する場合、少なくとも3つのパーティションが必要です。各セグメントは最小サイズのパーティションと同量のスペースしか提供できないので、同じサイズのパーティションだけを使用するようお勧めします。RAIDパーティションを異なるハードディスクに保存すると、 1つが損傷した場合のデータ消失のリスクが削減され(RAID 1と5)、またRAID  0のパフォーマンスを最適化できます。RAIDで使用するすべてのパーティションを作成したら、<menuchoice><guimenu>RAID</guimenu><guimenu>Create RAID (RAIDの作成)</guimenu></menuchoice>の順にクリックして、RAID設定を開始します。 </para>
  <para>ウィザードの次のページで、RAIDレベルを0、1、5のうちから選び、<guimenu>次へ</guimenu>をクリックします。次のダイアログ(<xref linkend="fig-yast2-raid2" xrefstyle="FigureXRef"/>参照)では、<guimenu>Linux RAID</guimenu>または<guimenu>Linuxネイティブ</guimenu>のどちらかのタイプのすべてのパーティションがリストされます。スワップパーティションまたはDOSパーティションは表示されません。パーティションがRAIDボリュームにすでに割り当てられている場合は、RAIDデバイスの名前(たとえば<filename>/dev/md0</filename>)がリストに表示されます。割り当てられていないパーティションは、<quote>--</quote>で示されます。 </para>
  <figure pgwide="0" xml:id="fig-yast2-raid2">
   <title>RAIDパーティション</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_raid2_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>割り当て解除済みのパーティションを選択したRAIDボリュームに追加するには、まず、そのパーティションを選択して、<guimenu>追加</guimenu>をクリックします。この時点で、選択したパーティションの横に、RAIDデバイスの名前が表示されます。すべてのパーティションをRAID用の予約パーティションとして割り当てます。すべてのパーティションを割り当てないと、パーティションのスペースが未使用のまま残ります。すべてのパーティションを割り当てたら、<guimenu>次へ</guimenu>をクリックして、設定ダイアログに進みます。このダイアログではパフォーマンスを微調整できます(<xref linkend="fig-yast2-raid3" xrefstyle="FigureXRef"/>を参照)。 </para>
  <figure pgwide="0" xml:id="fig-yast2-raid3">
   <title>ファイルシステム設定</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_raid3_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>従来のパーティションの場合と同様の設定以外だけでなく、暗号化とRAIDボリュームのマウントポイントを使用するように、ファイルシステムを設定します。<guimenu>完了</guimenu>で設定を完了した後、Expert Partitionerで、<emphasis>RAID</emphasis>と指定されている<filename>/dev/md0</filename>などのデバイスを参照してください。 </para>
 </section>
 <section xml:id="bgchysg">
  <title>ソフトウェアRAIDのトラブルシューティング</title>
  <para><filename>/proc/mdstat</filename>ファイルをチェックして、RAIDパーティションが破損しているかどうかを調べます。システム障害が発生した場合は、Linuxシステムをシャットダウンして、問題のあるハードディスクを、同じ方法でパーティショニングされている新しいハードディスクに置き換えます。次に、システムを再起動して、<command>mdadm /dev/mdX --add /dev/sdX</command>コマンドを入力します。<literal>「X」を特定のデバイス識別子に置き換えてください。</literal>これにより、ハードディスクがRAIDシステムに自動的に統合され、そのRAIDシステムが完全に再構築されます。 </para>
  <para>再構築中もすべてのデータにアクセスできますが、RAIDが完全に再構築されるまでは、パフォーマンスに問題が発生する場合があります。 </para>
 </section>


 <section xml:id="bgchysh">
  <title>詳細情報</title>
  <para>ソフトウェアRAIDの設定方法と詳細情報が、次のHOWTOにあります。 </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><link xlink:href="https://raid.wiki.kernel.org/index.php/Linux_Raid"><citetitle>Linux RAID wiki</citetitle></link></para>
   </listitem>
   <listitem>
    <para><citetitle>The Software RAID HOWTO</citetitle>(<filename>/usr/share/doc/packages/mdadm/Software-RAID.HOWTO.html</filename>ファイル)</para>
   </listitem>
  </itemizedlist>
  <para>「<link xlink:href="http://marc.info/?l=linux-raid"><citetitle/>linux-raid</link>」などのLinux RAIDメーリングリストもあります。</para>
 </section>
</chapter>

<chapter xml:id="raidroot" xml:lang="ja" xml:base="05_raid_root.xml"><title>ルートパーティション用のソフトウェアRAID1の設定</title><info/>
 
 <para>SUSE Linux Enterprise Server 11では、Device Mapper RAIDツールがYaSTパーティショナに統合されています。インストール時にパーティショナを使用して、ルート(<filename>/</filename>)パーティションを含むシステムデバイス用にソフトウェアRAID1を作成することができます。<filename>/boot</filename>パーティションは、MD RAID1とは別のデバイス上に作成する必要があります。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi9d2lj" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9dppp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9dnnt" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="bi9d2lj">
  <title>ルートパーティション用のソフトウェアRAID1デバイスを使用するための前提条件</title>
  <para>設定が次の要件を満たしていることを確認してください。</para>
  <itemizedlist mark="box" spacing="normal">
   <listitem>
    <para>RAID1のミラーリングデバイスを作成するため、2つのハードドライブが必要です。ハードドライブは類似のサイズで構成する必要があります。RAIDは小さい方のドライブのサイズを採用します。ブロックストレージデバイスには、ローカル(マシンに内蔵、または直結されたもの)、ファイバチャネルストレージサブシステム、またはiSCSIストレージサブシステムを自由に組み合わせることができます。 </para>
   </listitem>
   <listitem>
    <para><filename>/boot </filename>パーティション用に使用する、3つ目のデバイスが必要です。 ブートデバイスは、ローカルのデバイスである必要があります。</para>
   </listitem>
   <listitem>
    <para>ハードウェアRAIDデバイスを使用している場合は、その上でソフトウェアRAIDを実行しようとしないでください。</para>
   </listitem>
   <listitem>
    <para>iSCSIターゲットデバイスをご使用の場合は、RAIDデバイスを作成する前にiSCSIイニシエータサポートを有効にする必要があります。</para>
   </listitem>
   <listitem>
    <para>ご使用のストレージサブシステムが、ソフトウェアRAIDを使用する予定の直結されたローカルデバイス、ファイバチャネル、またはiSCSIデバイスとサーバの間で複数のI/Oパスを提供している場合は、RAIDデバイスを作成する前に、マルチパスサポートを有効にしなければなりません。</para>
   </listitem>
  </itemizedlist>
 </section>
 <section xml:id="bi9dppp">
  <title>インストール時にiSCSIイニシエータサポートを有効にする</title>
  <para>ルート(/)パーティションに使用する予定のiSCSIターゲットデバイスがある場合は、ソフトウェアRAID1デバイスを作成する前に、iSCSIイニシエータソフトウェアを有効にして、これらのデバイスを使用可能にしなければなりません。</para>
  <procedure xml:id="bi9dppq">
   <step xml:id="bi9dppr">
    <para>［インストールの設定］ページが表示されるまで、SUSE Linux Enterprise 11のYaSTのインストールを行います。</para>
   </step>
   <step xml:id="bi9dpps">
    <para><guimenu>パーティション分割</guimenu>をクリックして、［ハードディスクの準備］ページを開き、<guimenu>カスタムパーティション(エキスパート用)</guimenu>をクリックし、次に<guimenu>次へ</guimenu>をクリックします。</para>
   </step>
   <step xml:id="bi9dppt">
    <para>［エキスパートパーティショナ］のページで、<guimenu>システムビュー</guimenu>パネルの<guimenu>ハードディスク</guimenu>を展開し、デフォルトの提案内容を表示します。</para>
   </step>
   <step xml:id="bi9dppu">
    <para><guimenu>ハードディスク</guimenu>ページで、<guimenu>設定</guimenu>、<guimenu>iSCSIの設定</guimenu>を選択し、次にiSCSIイニシエータの設定を続行するかどうかのプロンプトが表示されたら<guimenu>続ける</guimenu>をクリックします。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bi9dnnt">
  <title>インストール時にマルチパスI/Oのサポートを有効にする</title>
  <para>ルート(/)パーティション用に使用する予定のデバイスへの複数のI/Oパスがある場合は、ソフトウェアRAID1デバイスを作成する前にマルチパスサポートを有効にする必要があります。</para>
  <procedure xml:id="bi9dnnu">
   <step xml:id="bi9dnnv">
    <para>［インストールの設定］ページが表示されるまで、SUSE Linux Enterprise 11のYaSTのインストールを行います。</para>
   </step>
   <step xml:id="bi9dnnw">
    <para><guimenu>パーティション分割</guimenu>をクリックして、［ハードディスクの準備］ページを開き、<guimenu>カスタムパーティション(エキスパート用)</guimenu>をクリックし、次に<guimenu>次へ</guimenu>をクリックします。</para>
   </step>
   <step xml:id="bi9dnnx">
    <para>［エキスパートパーティショナ］のページで、<guimenu>システムビュー</guimenu>パネルの<guimenu>ハードディスク</guimenu>を展開し、デフォルトの提案内容を表示します。</para>
   </step>
   <step xml:id="bi9dnny">
    <para><guimenu>ハードディスク</guimenu>ページで、<guimenu>設定</guimenu>、<guimenu>マルチパスの設定</guimenu>を選択し、次にマルチパスの起動を確認するプロンプトが表示されたら、<guimenu>はい</guimenu>をクリックします。 </para>
    <para>これによってデバイスが再度スキャンされ、複数のパスが展開されるので、ハードディスクのリストに各デバイスが重複して掲載されることはありません。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bi9d19d">
  <title>ルート(/)パーティション用のソフトウェアRAID1デバイスの作成</title>
  <procedure xml:id="bi9d207">
   <step xml:id="bi9d208">
    <para>［インストールの設定］ページが表示されるまで、SUSE Linux Enterprise 11のYaSTのインストールを行います。</para>
   </step>
   <step xml:id="bi9dfe6">
    <para><guimenu>パーティション分割</guimenu>をクリックして、［ハードディスクの準備］ページを開き、<guimenu>カスタムパーティション(エキスパート用)</guimenu>をクリックし、次に<guimenu>次へ</guimenu>をクリックします。</para>
   </step>
   <step xml:id="bi9dgrg">
    <para>［エキスパートパーティショナ］ページで、<guimenu>システムビュー</guimenu>パネルの<guimenu>ハードディスク</guimenu>を展開し、デフォルトの提案内容を表示し、提案されているパーティションを選択して、<guimenu>削除</guimenu>をクリックします。</para>
   </step>
   <step xml:id="b13za1ue">
    <para><filename>/boot</filename>パーティションを作成します。</para>
    <substeps performance="required">
     <step xml:id="b13za3rl">
      <para>［エキスパートパーティショナ］ページの<guimenu>ハードディスク</guimenu>で、/bootパーティションに使用するデバイスを選択し、次に<guimenu>ハードディスクパーティション</guimenu>タブの<guimenu>追加</guimenu>をクリックします。</para>
     </step>
     <step xml:id="b13za3rm">
      <para><guimenu>新しいパーティションの種類</guimenu>で、<guimenu>プライマリパーティション</guimenu>を選択し、次に<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
     <step xml:id="b13za3rn">
      <para><guimenu>新しいパーティションのサイズ</guimenu>で、使用するサイズを指定し、次に<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
     <step xml:id="b13za3ro">
      <para><guimenu>フォーマットオプション</guimenu>で、<guimenu>フォーマットパーティション</guimenu>を選択して、次にドロップダウンリストから好みのファイルシステム(Ext2や Ext3など)を選択します。</para>
     </step>
     <step xml:id="b13za3rp">
      <para><guimenu>マウントオプション</guimenu>で、<guimenu>パーティションをマウントする</guimenu>を選択し、次にドロップダウンリストから<guimenu>/boot</guimenu>を選択します。</para>
     </step>
     <step xml:id="b13za3rq">
      <para><guimenu>完了</guimenu>をクリックします。</para>
     </step>
    </substeps>
   </step>
   <step xml:id="bi9drnn">
    <para>スワップパーティションを作成します。</para>
    <substeps performance="required">
     <step xml:id="bi9dq0p">
      <para>［エキスパートパーティショナ］ページの<guimenu>ハードディスク</guimenu>で、スワップパーティションに使用するデバイスを選択し、次に<guimenu>ハードディスクパーティション</guimenu>タブの<guimenu>追加</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9drt8">
      <para><guimenu>新しいパーティションの種類</guimenu>で、<guimenu>プライマリパーティション</guimenu>を選択し、次に<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9drz9">
      <para><guimenu>新しいパーティションのサイズ</guimenu>で、使用するサイズを指定し、次に<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9dt2p">
      <para><guimenu>フォーマットオプション</guimenu>で<guimenu>パーティションをフォーマットする</guimenu>を選択し、次にドロップダウンリストから<guimenu>スワップ</guimenu>を選択します。</para>
     </step>
     <step xml:id="bi9dtld">
      <para><guimenu>マウントオプション</guimenu>で、<guimenu>パーティションをマウントする</guimenu>を選択し、次にドロップダウンリストから<guimenu>スワップ</guimenu>を選択します。</para>
     </step>
     <step xml:id="bi9du9n">
      <para><guimenu>完了</guimenu>をクリックします。</para>
     </step>
    </substeps>
   </step>
   <step xml:id="bi9dv06">
    <para>ソフトウェアRAID1に使用する各デバイスの<guimenu>1xFD Linux RAID</guimenu>フォーマットを設定します。</para>
    <substeps performance="required">
     <step xml:id="bi9dx99">
      <para>［エキスパートパーティショナ］ページの<guimenu>ハードディスク</guimenu>で、RAID1で使用するデバイスを選択し、次に<guimenu>ハードディスクパーティション</guimenu>タブの<guimenu>追加</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9dx9a">
      <para><guimenu>新しいパーティションの種類</guimenu>で、<guimenu>プライマリパーティション</guimenu>を選択し、次に<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9dx9b">
      <para><guimenu>新しいパーティションのズサイズ</guimenu>で、最大サイズの使用を指定し、次に<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9dx9c">
      <para><guimenu>フォーマットオプション</guimenu>で、<guimenu>パーティションをフォーマットしない</guimenu>を選択し、次にドロップダウンリストから<guimenu>0xFD Linux RAID</guimenu>を選択します。</para>
     </step>
     <step xml:id="bi9dx9d">
      <para><guimenu>マウントオプション</guimenu>で、<guimenu>パーティションをマウントしない</guimenu>を選択します。</para>
     </step>
     <step xml:id="bi9dx9e">
      <para><guimenu>完了</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9dy2u">
      <para>ソフトウェアRAIDで使用する各デバイスに、<xref linkend="bi9dx99" xrefstyle="StepXRef"/>から<xref linkend="bi9dx9e" xrefstyle="StepXRef"/>を繰り返し実行します。1.</para>
     </step>
    </substeps>
   </step>
   <step xml:id="bi9e4kt">
    <para>RAIDデバイスを作成します。</para>
    <substeps performance="required">
     <step xml:id="bi9djfy">
      <para><guimenu>システムビュー</guimenu>パネルで、<guimenu>RAID</guimenu>を選択し、次に［RAID］ページで<guimenu>RAIDの追加</guimenu>をクリックします。</para>
      <para><xref linkend="bi9dv06" xrefstyle="StepXRef"/>で作成したデバイスが<guimenu>使用可能なデバイス</guimenu>の一覧に表示されます。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install_a.png" width="213pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step xml:id="bi9dzpu">
      <para><guimenu>RAIDタイプ</guimenu>で、<guimenu>RAID 1 (ミラーリング)</guimenu>を選択します。</para>
     </step>
     <step xml:id="bi9e26m">
      <para><guimenu>使用可能なデバイス</guimenu>パネルで、RAIDに使用するデバイスを選択し、次に<guimenu>追加</guimenu>をクリックして、<guimenu>選択したデバイス</guimenu>パネルにデバイスを移動します。</para>
      <para>RAID1用のデバイスを、2つ以上指定します。</para>
      <para>ここでは一例として、RAID 1に2つのデバイスを選択します。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install2_a.png" width="218pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step xml:id="bi9e393">
      <para><guimenu>次へ</guimenu>をクリックします。</para>
     </step>
     <step xml:id="bi9e3nr">
      <para><guimenu>RAIDオプション</guimenu>で、ドロップダウンリストからチャンクサイズを選択します。</para>
      <para> RAID 1(ミラーリング)のデフォルトチャンクサイズは4KBです。</para>
      <para>使用可能なチャンクサイズは、4KB、8KB、16KB、32KB、64KB、128KB、256KB、512KB、1MB、2MB、または4MBです。</para>
     </step>
     <step xml:id="bi9e530">
      <para><guimenu>フォーマットのオプション</guimenu>で、<guimenu>パーティションをフォーマットする</guimenu>を選択し、次に<guimenu>ファイルシステム</guimenu>ドロップダウンリストからファイルシステムの種類(Ext3など)を選択します。</para>
     </step>
     <step xml:id="bi9e97s">
      <para><guimenu>マウントオプション</guimenu>で、<guimenu>パーティションをマウントする</guimenu>を選択し、次に<guimenu>マウントポイント</guimenu>ドロップダウンリストから、 <filename>/ </filename>を選択します。</para>
     </step>
     <step xml:id="bi9e9uc">
      <para><guimenu>完了</guimenu>をクリックします。</para>
      <para>ソフトウェアRAIDデバイスはデバイスマッパーによって管理され、デバイスを<filename>/dev/md0</filename>パスの下に作成します。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install3_a.png" width="213pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
    </substeps>
   </step>
   <step xml:id="bi9ec68">
    <para>［エキスパートパーティショナ］ページで、<guimenu>受諾</guimenu>をクリックします。</para>
    <para>［インストールの設定］ページの<guimenu>パーティション分割</guimenu>の下に新しい提案内容が表示されます。</para>
    <para>たとえば、次のセットアップが表示されます。 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="raid_yast_install4_a.png" width="129pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="bi9eh7a">
    <para>インストールを続行します。</para>
    <para>サーバを再起動するたびに、デバイスマッパーが起動時に開始し、ソフトウェアRAIDが自動的に認識され、ルート(/)パーティション上のオペレーティングシステムを開始することができます。</para>
   </step>
  </procedure>
 </section>
</chapter>

<chapter conformance="sles11,Novell,yes,,80" xml:id="raidmdadm" xml:lang="ja" revision="01/23/09" xml:base="05_raid10.xml"><title>mdadmによるソフトウェアRAID 6および10の管理</title><info/>
 
 <para>このセクションでは、複数デバイス管理(<command>mdadm(8)</command>)ツールで、ソフトウェア RAID 6および10のデバイスを作成する方法を説明します。<filename>mdadm</filename>を使用すると、RAID 0、1、4、および5も作成できます。<command>mdadm</command>ツールは、レガシープログラム<command>mdtools</command>および<command>raidtools</command>の機能を提供します。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="raidmdadmr6" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmr10nest" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmr10cpx" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmdegraded" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="raidmdadmr6">
  <title>RAID 6の作成</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr6ovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr6create" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="raidmdadmr6ovw">
   <title>RAID 6の理解</title>
   <para>RAID 6は、本来、RAID 5の拡張であり、2つ目の独立した分散パリティスキーム(デュアルパリティ)の使用により、耐障害性をさらに追加します。データ回復プロセスで、2つのハードディスクドライブに障害が発生しても、システムは稼動し続け、データが失われることはありません。</para>
   <para>RAID 6は、複数の同時ドライブエラーに耐えることで、非常に高いデータ 耐障害性を提供します。RAID 6は、データを失うことなく、2つのデバイスの喪失を処理します。したがって、N個のドライブのデータを保存するには、N+2個のドライブが必要です。その結果、最低限4個のデバイスが必要となります。</para>
   <para>通常モードおよび単一ディスク障害モードでは、RAID 5と比べ、RAID 6のパフォーマンスは若干低いですが、同程度です。デュアルディスク障害モードでは、RAID 6は非常に低速です。 </para>
   <table xml:id="b8i9zn7">
    <title>RAID 5とRAID 6の比較</title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row><!--id=b8ihegi-->
       <entry>
        <para>機能</para>
       </entry>
       <entry>
        <para>RAID 5</para>
       </entry>
       <entry>
        <para>RAID 6</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b8ihegj-->
       <entry>
        <para>デバイスの数</para>
       </entry>
       <entry>
        <para>N+1(最小限3個)</para>
       </entry>
       <entry>
        <para>N+2(最小限4個)</para>
       </entry>
      </row>
      <row><!--id=b8ihegk-->
       <entry>
        <para>パリティ</para>
       </entry>
       <entry>
        <para>分散型、シングル</para>
       </entry>
       <entry>
        <para>分散型、デュアル</para>
       </entry>
      </row>
      <row><!--id=b8ihegl-->
       <entry>
        <para>パフォーマンス</para>
       </entry>
       <entry>
        <para>書き込みおよび再構築に中程度の影響</para>
       </entry>
       <entry>
        <para>シーケンシャルな書き込みでは、RAID 5より影響大</para>
       </entry>
      </row>
      <row><!--id=b8ihegm-->
       <entry>
        <para>耐障害性</para>
       </entry>
       <entry>
        <para>1つのコンポーネントデバイスの障害</para>
       </entry>
       <entry>
        <para>2つのコンポーネントデバイスの障害</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </section>
  <section xml:id="raidmdadmr6create">
   <title>RAID 6の作成</title>
   <para>このセクションのプロシージャでは、RAID 6デバイス<filename>/dev/md0</filename>を4つのデバイスで作成します(<filename>/dev/sda1</filename>、<filename>/dev/sdb1</filename>、<filename>/dev/sdc1</filename>、<filename>/dev/sdd1</filename>)。必ず、プロシージャを変更して、実際のデバイスノードを使用するようにしてください。</para>
   <procedure xml:id="b8ihegn">
    <step xml:id="b8ihego">
     <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
    </step>
    <step xml:id="b8ihegp">
     <para>RAID 6デバイスを作成します。コマンドプロンプトで、次のように入力します </para>

<screen>
mdadm --create /dev/md0 --run --level=raid6 --chunk=128 --raid-devices=4 /dev/sdb1 /dev/sdc1 /dev/sdc1 /dev/sdd1
</screen>

     <para>デフォルトのチャンクサイズは 64KBです。</para>
    </step>
    <step xml:id="b8ihegq">
     <para>Create a file system on the RAID 6デバイス<filename>/dev/md0</filename>上でファイルシステム(Reiserファイルシステムなど)を作成します。たとえば、コマンドプロンプトで、次のように入力します。</para>

<screen>
mkfs.reiserfs /dev/md0
</screen>

     <para>これとは別のファイルシステムを使用したい場合は、コマンドを変更します。</para>
    </step>
    <step xml:id="b8ihegr">
     <para><filename>/etc/mdadm.conf</filename>ファイルを編集して、コンポーネントデバイスとRAIDデバイス <filename>/dev/md0</filename>のエントリを追加します。</para>
    </step>
    <step xml:id="b8ihegs">
     <para><filename>/etc/fstab</filename>ファイルを編集して、RAID 6デバイス <filename>/dev/md0</filename>のエントリを追加します。 </para>
    </step>
    <step xml:id="b8ihegt">
     <para>サーバを再起動します。</para>
     <para>RAID 6デバイスが<filename>/local</filename>にマウントされます。</para>
    </step>
    <step xml:id="b8ihegu">
     <para>RAIDアレイにホットスペアを追加します(オプション)。たとえば、コマンドプロンプトで、次のように入力します。</para>

<screen>
mdadm /dev/md0 -a /dev/sde1
</screen>

    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="raidmdadmr10nest">
  <title>mdadmによるネストしたRAID 10デバイスの作成</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr10nestovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10nest1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10nest2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="raidmdadmr10nestovw">
   <title>ネストしたRAIDデバイスの理解</title>
   <para>ネストしたRAIDデバイスは、物理ディスクを使用する代わりに、その基本エレメントとして別のRAIDアレイを使用するRAIDアレイで構成されます。この構成の目的は、RAIDのパフォーマンスと耐障害性を向上することです。 </para>
   <para>Linuxは、RAID 1 (ミラーリング)アレイとRAID 0 (ストライピング)アレイのネストをサポートします。一般に、この組み合わせは、RAID 10と呼ばれます。ネストの順序を区別するため、このマニュアルでは、次の用語を使用します。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <formalpara xml:id="b8ghlom">
      <title>RAID 1+0:</title>
      <para>まず、RAID 1（ミラー）アレイが構築され、次に、それらのアレイが組み合わされてRAID 0 (ストライプ)アレイを構成します。 </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara xml:id="b8gzg7q">
      <title>RAID 0+1:</title>
      <para>まず、RAID 0（ストライプ）アレイが構築され、次に、それらのアレイが組み合わされてRAID 1(ミラー)アレイを構成します。 </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <para>次の表では、RAID 10ネスティングの欠点と利点を、1+0対0+1という形式で説明します。使用するストレージオブジェクトは、それぞれが専用のI/Oをもつ別々のディスクに常駐すると想定しています。</para>
   <table xml:id="b57a7uv">
    <title>ネストしたRAIDレベル</title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="1191*"/>
    <colspec colnum="2" colname="2" colwidth="1905*"/>
    <colspec colnum="3" colname="3" colwidth="6906*"/>
     <thead>
      <row><!--id=b57a7uw-->
       <entry>
        <para>RAIDレベル</para>
       </entry>
       <entry>
        <para>説明</para>
       </entry>
       <entry>
        <para>パフォーマンスと耐障害性</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b57a7uz-->
       <entry>
        <para>10 (1+0)</para>
       </entry>
       <entry>
        <para>RAID 1(ミラー)アレイで構築されたRAID (ストライプ)</para>
       </entry>
       <entry>
        <para>RAID 1+0は、高レベルのI/Oパフォーマンス、データ冗長性、およびディスク耐障害性を提供します。RAIDの各メンバーデバイスは個々にミラーリングされるので、エラーになったディスクのミラー先が異なる限り、複数ディスクの障害を許容し、データを使用することができます。 </para>
        <para>オプションとして、ベースをなすミラーリングされたアレイごとにスペアを設定したり、すべてのミラーに対するスペアグループに対応するスペアを設定できます。 </para>
       </entry>
      </row>
      <row><!--id=b57a7uy-->
       <entry>
        <para>10 (0+1)</para>
       </entry>
       <entry>
        <para>RAID 0(ストライプ)アレイで構築されたRAID 1(ミラー) </para>
       </entry>
       <entry>
        <para>RAID 0+1は、高レベルのI/Oパフォーマンスとデータ冗長性を提供しますが、耐障害性が1+0より若干低くなります。ミラーの一方のサイドで複数のディスクがエラーになると、もう一方のミラーが使用可能になります。ただし、ミラーの両サイドで同時にディスクが失われると、すべてのデータが喪失します。</para>
        <para>このソリューションは1+0ソリューションより耐障害性が低いですが、別のサイトで保守を実行したり、ミラーを保持する必要がある場合、ミラーのサイド全体をオフラインにしても、完全に機能するストレージデバイスを保持することができます。また、2つのサイト間の接続が失われた場合は、どちらかのサイトがもう一方のサイトから独立して稼動します。ミラーリングされたセグメントをストライプする場合はこうなりません。ミラーが低レベルで管理されているからです。 </para>
        <para>デバイスがエラーになると、RAID 0には耐障害性がないので、そのサイドのミラーがエラーになります。新しいRAID 0を作成して、エラーになったサイドに置き換え、次に、ミラーを再同期してください。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </section>
  <section xml:id="raidmdadmr10nest1">
   <title>mdadmによるネストしたRAID 10 (1+0)デバイスの作成</title>
   <para>ネストしたRAID 1+0は、2つ以上のRAID 1(ミラー)デバイスを作成し、それらのRAID 1デバイスをRAID 0のコンポーネントデバイスとして使用することで構築します。</para>
   <important>
    <para>デバイスに対する複数の接続を管理する必要がある場合は、マルチパスI/Oを設定してから、RAIDデバイスを設定する必要があります。詳細については、<xref linkend="multipathing" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
   </important>
   <para>本項の手順では、次の表に示すデバイス名を使用します。それらのデバイス名は、必ず、ご使用のデバイスの名前で変更してください。</para>
   <table xml:id="b6670cx">
    <title>ネスティングでRAID 10(1+0)を作成するシナリオ </title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row><!--id=b6670cy-->
       <entry>
        <para>rawデバイス</para>
       </entry>
       <entry>
        <para>RAID 1(ミラー)</para>
       </entry>
       <entry>
        <para>RAID 1+0(ストライピングミラー)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b8o7og9-->
       <entry>
        <simplelist>
         <member><filename>/dev/sdb1</filename></member> <member><filename>/dev/sdc1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry morerows="1">
        <para/>
        <para><filename>/dev/md2</filename></para>
       </entry>
      </row>
      <row><!--id=b8o7ogb-->
       <entry>
        <simplelist>
         <member><filename>/dev/sdd1</filename></member> <member><filename>/dev/sde1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure xml:id="b6670d3">
    <step xml:id="b6670d4">
     <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
    </step>
    <step xml:id="b6670d5">
     <para>RAID 1デバイスごとに2つの異なるデバイスを使用して、2つのソフトウェアRAID 1デバイスを作成します。コマンドプロンプトで、次の2つのコマンドを入力します。</para>

<screen>
mdadm --create /dev/md0 --run --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1
</screen>


<screen>
mdadm --create /dev/md1 --run --level=1 --raid-devices=2 /dev/sdd1 /dev/sde1
</screen>

    </step>
    <step xml:id="b6670d6">
     <para>ネストしたRAID 1+0デバイスを作成します。コマンドプロンプトで、<xref linkend="b6670d5" xrefstyle="StepXRef"/>で作成したソフトウェアRAID 1デバイスを使用して、次のコマンドを入力します。</para>

<screen>
mdadm --create /dev/md2 --run --level=0 --chunk=64 --raid-devices=2 /dev/md0 /dev/md1
</screen>

     <para>デフォルトのチャンクサイズは 64KBです。 </para>
    </step>
    <step xml:id="b6670d7">
     <para>RAID 1+0デバイス<filename>/dev/md2</filename>上で、Reiser(reiserfs)などのファイルシステムを作成します。たとえば、コマンドプロンプトで、次のように入力します。</para>

<screen>
mkfs.reiserfs /dev/md2
</screen>

     <para>これとは別のファイルシステムを使用したい場合は、コマンドを変更します。</para>
    </step>
    <step xml:id="b6670d8">
     <para><filename>/etc/mdadm.conf</filename>ファイルを編集して、コンポーネントデバイスとRAIDデバイス<filename>/dev/md2</filename>のエントリを追加します。</para>
    </step>
    <step xml:id="b6670d9">
     <para><filename>/etc/fstab</filename>ファイルを編集して、RAID 1+0デバイス <filename>/dev/md2</filename>のエントリを追加します。 </para>
    </step>
    <step xml:id="b6670da">
     <para>サーバを再起動します。</para>
     <para>RAID 1+0デバイスが<filename>/local</filename>にマウントされます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="raidmdadmr10nest2">
   <title>mdadmによるネストしたRAID 10 (0+1)デバイスの作成</title>
   <para>ネストしたRAID 0+1は、2個から4個のRAID 0(ストライプ)デバイスで構築され、それらのRAID 0デバイスをミラーリングしてRAID 1のコンポーネントデバイスとします。 </para>
   <important>
    <para>デバイスに対する複数の接続を管理する必要がある場合は、マルチパスI/Oを設定してから、RAIDデバイスを設定する必要があります。詳細については、<xref linkend="multipathing" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
   </important>
   <para>この構成では、RAID 0がデバイスの喪失に耐えられないので、ベースのRAID 0デバイスにスペアデバイスを指定できません。デバイスがミラーの1つのサイドでエラーになった場合は、置き換え用のRAID 0デバイスを作成して、ミラーに追加します。 </para>
   <para>本項の手順では、次の表に示すデバイス名を使用します。それらのデバイス名は、必ず、ご使用のデバイスの名前で変更してください。</para>
   <table xml:id="b8gzg7s">
    <title>ネストによるRAID 10 (0+1)作成のシナリオ </title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row><!--id=b8gzg7t-->
       <entry>
        <para>rawデバイス</para>
       </entry>
       <entry>
        <para>RAID 0 (ストライプ)</para>
       </entry>
       <entry>
        <para>RAID 0+1 (ミラー化ストライピング)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bi71dhe-->
       <entry>
        <simplelist>
         <member><filename>/dev/sdb1</filename></member> <member><filename>/dev/sdc1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry morerows="1">
        <para/>
        <para><filename>/dev/md2</filename></para>
       </entry>
      </row>
      <row><!--id=bi71dhf-->
       <entry>
        <simplelist>
         <member><filename>/dev/sdd1</filename></member> <member><filename>/dev/sde1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure xml:id="b8gzg7y">
    <step xml:id="b8gzg7z">
     <para>端末コンソールを開いて、rootユーザまたは同等の権限で、ログインします。</para>
    </step>
    <step xml:id="b8gzg80">
     <para>RAID 0デバイスごとに2つの異なるデバイスを使用して、2つのソフトウェアRAID 0デバイスを作成します。コマンドプロンプトで、次の2つのコマンドを入力します。</para>

<screen>
mdadm --create /dev/md0 --run --level=0 --chunk=64 --raid-devices=2 /dev/sdb1 /dev/sdc1
</screen>


<screen>
mdadm --create /dev/md1 --run --level=0 --chunk=64 --raid-devices=2 /dev/sdd1 /dev/sde1
</screen>

     <para>デフォルトのチャンクサイズは 64KBです。</para>
    </step>
    <step xml:id="b8gzg81">
     <para>ネストしたRAID 0+1デバイスの作成コマンドプロンプトで、<xref linkend="b8gzg80" xrefstyle="StepXRef"/>で作成したソフトウェアRAID 0デバイスを使用して、次のコマンドを入力します。</para>

<screen>
mdadm --create /dev/md2 --run --level=1 --raid-devices=2 /dev/md0 /dev/md1
</screen>

    </step>
    <step xml:id="b8gzg82">
     <para>RAID 0+1デバイス<filename>/dev/md2</filename>上で、Reiser(reiserfs)などのファイルシステムを作成します。たとえば、コマンドプロンプトで、次のように入力します。</para>

<screen>
mkfs.reiserfs /dev/md2
</screen>

     <para>これとは別のファイルシステムを使用したい場合は、コマンドを変更します。</para>
    </step>
    <step xml:id="b8gzg83">
     <para><filename>/etc/mdadm.conf</filename>ファイルを編集して、コンポーネントデバイスとRAIDデバイス<filename>/dev/md2</filename>のエントリを追加します。</para>
    </step>
    <step xml:id="b8gzg84">
     <para><filename>/etc/fstab</filename>ファイルを編集して、RAID 0+1デバイス<filename>/dev/md2</filename>のエントリを追加します。 </para>
    </step>
    <step xml:id="b8gzg85">
     <para>サーバを再起動します。</para>
     <para>RAID 0+1デバイスが<filename>/local</filename>にマウントされます。</para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="raidmdadmr10cpx">
  <title>コンプレックスRAID 10の作成</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10cpxcreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="raidmdadmr10cpxovw">
   <title>コンプレックスRAID10の理解</title>
   <para><command>mdadm</command>では、RAID10レベルで、RAID 0(ストライピング)とRAID 1(ミラーリング)の両方の機能を組み合わせた単一の複雑なソフトウェアRAIDが作成されます。すべてのデータブロックの複数のコピーが、ストライピングの規則に従って、複数のドライブ上に配置されます。コンポーネントデバイスは、すべて同じサイズにする必要があります。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b8ghyxy" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cym9j" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cym15" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cyneb" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cynnk" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="byz81ho" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="b8ghyxy">
    <title>コンプレックスRAID10とネストしたRAID 10 (1+0)の比較</title>
    <para role="intro">コンプレックスRAID は、ネストしたRAID 10 (1+0)と目的は同じですが、次の点で異なります。</para>
    <table xml:id="b8ghz5p">
     <title>コンプレックスRAID 10対ネストしたRAID 10</title>
     <tgroup cols="3">
     <colspec colnum="1" colname="1" colwidth="3334*"/>
     <colspec colnum="2" colname="2" colwidth="3334*"/>
     <colspec colnum="3" colname="3" colwidth="3334*"/>
      <thead>
       <row><!--id=b8gzgca-->
        <entry>
         <para>機能</para>
        </entry>
        <entry>
         <para>コンプレックスRAID10</para>
        </entry>
        <entry>
         <para>ネストしたRAID 10(1+0)</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row><!--id=b8gzgcb-->
        <entry>
         <para>デバイスの数</para>
        </entry>
        <entry>
         <para>偶数個または奇数個のコンポーネントデバイス</para>
        </entry>
        <entry>
         <para>偶数個のコンポーネントデバイス</para>
        </entry>
       </row>
       <row><!--id=b8gzgcc-->
        <entry>
         <para>コンポーネントデバイス</para>
        </entry>
        <entry>
         <para>単一のRAIDデバイスとして管理されます。</para>
        </entry>
        <entry>
         <para>ネストしたRAIDデバイスとして管理されます。 </para>
        </entry>
       </row>
       <row><!--id=b8gzgcd-->
        <entry>
         <para>ストライピング</para>
        </entry>
        <entry>
         <para>ストライピングは、コンポーネントデバイス上にnearレイアウトまたはfarレイアウトを生じます。 </para>
         <para>farレイアウトでは、RAID 1ペアの数でなく、ドライブ数で増減するシーケンシャルな読み込みスループットを提供します。</para>
        </entry>
        <entry>
         <para>ストライピングは、連続的に、すべてのコンポーネントデバイスをまたぎます。</para>
        </entry>
       </row>
       <row><!--id=b8gzgce-->
        <entry>
         <para>データの複数コピー</para>
        </entry>
        <entry>
         <para>2からアレイ内のデバイス数まで</para>
        </entry>
        <entry>
         <para>ミラーリングされたセグメントごとにコピー</para>
        </entry>
       </row>
       <row><!--id=b8gzgcf-->
        <entry>
         <para>ホットスペアデバイス</para>
        </entry>
        <entry>
         <para>単一スペアですべてのコンポーネントデバイスに対応できます。</para>
        </entry>
        <entry>
         <para>ベースをなすミラーリングされたアレイごとにスペアを設定したり、すべてのミラーに対応するスペアグループに対するスペアを設定できます。 </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </section>
   <section xml:id="b7cym9j">
    <title>コンプレックスRAID10のレプリカ数</title>
    <para>コンプレックスRAID10アレイの設定時に、データブロックごとに必要なレプリカ数を指定する必要があります。デフォルトのレプリカ数は2ですが、2からアレイ内のデバイス数まで可能です。 </para>
   </section>
   <section xml:id="b7cym15">
    <title>コンプレックスRAID10のデバイス数</title>
    <para>少なくとも、指定のレプリカ数と同数のコンポーネントデバイスを使用する必要があります。ただし、RAID10アレイのコンポーネントデバイス数は各データブロックのレプリカ数の倍数である必要はありません。有効なストレージサイズは、デバイス数をレプリカ数で割った数です。</para>
    <para>たとえば、5個のコンポーネントデバイスで作成したアレイに2つのレプリカを指定した場合は、各ブロックのコピーが2つの異なるデバイスに保存されます。したがって、すべてのデータの1コピーの有効なストレージサイズは、5/2(つまり、コンポーネントデバイスのサイズの2.5倍)となります。</para>
   </section>
   <section xml:id="b7cyneb">
    <title>nearレイアウト</title>
    <para>nearレイアウトでは、異なるコンポーネントデバイス上で、データブロックのコピーが互いに接近してストライプされます。つまり、あるデータブロックの複数のコピーが異なるデバイス内で同様にオフセットされます。nearは、RAID10のデフォルトレイアウトです。たとえば、奇数個のコンポーネントデバイスとデータの2コピーを使用する場合は、一部のコピーが、1チャンク分、デバイス内を前進します。 </para>
    <para><command>mdadm</command> RAID 10のnearレイアウトは、半数のドライブ上のRAID 0と同様の読み書きパフォーマンスを提供します。 </para>
    <para role="intro">偶数個のディスクと2つのレプリカを使用したnearレイアウト</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    0    1    1
  2    2    3    3
  4    4    5    5
  6    6    7    7
  8    8    9    9
</screen>

    <para>奇数個のディスクと2つのレプリカを使用したnearレイアウト</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    0    1    1    2
  2    3    3    4    4
  5    5    6    6    7
  7    8    8    9    9
  10   10   11   11   12
</screen>

   </section>
   <section xml:id="b7cynnk">
    <title>farレイアウト</title>
    <para>farレイアウトは、すべてのドライブの前半部分にデータをストライプし、次に、2つ目のデータコピーをすべてのドライブの後半部分にストライプして、ブロックのすべてのコピーが異なるドライブに配置されるようにします。値の2つ目のセットは、コンポーネントドライブの中ほどから開始します。</para>
    <para>farレイアウトでは、<command>mdadm</command> RAID10の読み込みパフォーマンスは、すべてのドライブを使用したRAID 0と同様ですが、書き込みパフォーマンスは、ドライブヘッドのシーク回数が増えるので、RAID 0よりかなり遅くなります。このレイアウトは、 読み込み専用ファイルサーバなどの、読み込み集約型操作に最適です。 </para>
    <para>raid10の書き込み速度は、付近のレイアウトを使用しているraid1やraid0などの他のミラーリングRAIDの種類と同等です。これは、ファイルシステムのエレベータが生の書き込みよりも効率のよい書き込みのスケジュールを行うためです。Raid10をfarレイアウトで使用する方法は、ミラーリングによる書き込みアプリケーションに適しています。</para>
    <para role="intro">偶数個のディスクと2つのレプリカを使用したfarレイアウト</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    1    2    3
  4    5    6    7       
  . . .
  3    0    1    2
  7    4    5    6
</screen>

    <para role="intro">奇数個のディスクと2つのレプリカを使用したfarレイアウト</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  5    6    7    8    9
  . . .
  4    0    1    2    3
  9    5    6    7    8
</screen>

   </section>
   <section xml:id="byz81ho">
    <title>offsetレイアウト</title>
    <para>offsetレイアウトでは、あるチャンクの複数のコピーが連続したドライブ上で連続したオフセットにレイアウトされるよう、ストライプが複製されます。実際は、それぞれのストライプが複製され、コピーが1つのデバイスでオフセットされます。これにより、適度な大きさのチャンクサイズを使用している場合は、farレイアウトと同様の読み込み特性が得られますが、書き込みのシーク回数は少なくなります。 </para>
    <para role="intro">偶数個のディスクと2つのレプリカを使用したoffsetレイアウト</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    1    2    3
  3    0    1    2       
  4    5    6    7
  7    4    5    6
  8    9   10   11
 11    8    9   10
</screen>

    <para role="intro">奇数個のディスクと2つのレプリカを使用したoffsetレイアウト</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  4    0    1    2    3
  5    6    7    8    9
  9    5    6    7    8
 10   11   12   13   14
 14   10   11   12   13                
</screen>

   </section>
  </section>
  <section xml:id="raidmdadmr10cpxcreate">
   <title>mdadmによるコンプレックスRAID 10の作成</title>
   <para><command>mdadm</command>のRAID10オプションでは、ネストなしのRAID 10デバイスが作成されます。RAID10については、<xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   <para>このセクションのプロシージャでは、次のテーブルに示すデバイス名を使用します。それらのデバイス名は、必ず、ご使用のデバイスの名前で変更してください。</para>
   <table xml:id="b667706">
    <title>mdadm RAID10オプションでRAID 10を作成するシナリオ </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b667707-->
       <entry>
        <para>rawデバイス</para>
       </entry>
       <entry>
        <para>RAID10(near/farストライピングスキーム)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b667708-->
       <entry>
        <para><filename>/dev/sdf1</filename></para>
        <para><filename>/dev/sdg1</filename></para>
        <para><filename>/dev/sdh1</filename></para>
        <para><filename>/dev/sdi1</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/md3</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure xml:id="b66770c">
    <step xml:id="b667c10">
     <para>YaSTで、RAIDで使用したいデバイス(<filename>/dev/sdf1</filename>、<filename>/dev/sdg1</filename>、<filename>/dev/sdh1</filename>、<filename>/dev/sdi1</filename>など)に0xFD Linux RAIDパーティションを作成します。</para>
    </step>
    <step xml:id="b66770d">
     <para>端末コンソールを開いて、rootユーザまたは同等の権限で、ログインします。</para>
    </step>
    <step xml:id="b66770e">
     <para>RAID 10 コマンドを作成します。コマンドプロンプトで、次のように入力します(すべて同じ行)。</para>

<screen>
mdadm --create /dev/md3 --run --level=10 --chunk=4 --raid-devices=4 /dev/sdf1 /dev/sdg1 /dev/sdh1 /dev/sdi1
</screen>

    </step>
    <step xml:id="b66770g">
     <para>RAID 10デバイス <filename>/dev/md3</filename>上にReiserファイルシステムを作成します。コマンドプロンプトで、次のように入力します</para>

<screen>
mkfs.reiserfs /dev/md3
</screen>

    </step>
    <step xml:id="b66770h">
     <para><filename>/etc/mdadm.conf</filename>ファイルを編集して、コンポーネントデバイスとRAIDデバイス<filename>/dev/md3</filename>のエントリを追加します。次に例を示します。</para>

<screen>
DEVICE /dev/md3
</screen>

    </step>
    <step xml:id="b66770i">
     <para><filename>/etc/fstab</filename>ファイルを編集して、RAID 10デバイス <filename>/dev/md3</filename>のエントリを追加します。 </para>
    </step>
    <step xml:id="b66770j">
     <para>サーバを再起動します。</para>
     <para>RAID 10デバイスが<filename>/raid10</filename>にマウントされます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="b14drcbo">
   <title>YaSTパーティショナ付きコンプレックスRAID 10の作成  </title>
   <procedure xml:id="b14dtk6s">
    <step xml:id="b14dtk6t">
     <para><systemitem>root</systemitem>ユーザとしてYaSTを起動して、パーティショナを開きます。</para>
    </step>
    <step xml:id="b14dtk6u">
     <para><guimenu>ハードディスク</guimenu>を選択して、利用可能なディスク(sdab、sdc、sdd、sdeなど)を確認します。</para>
    </step>
    <step xml:id="b14dtk6v">
     <para>ソフトウェアRAIDで使用する予定の各ディスクについて、RAIDパーティションをデバイス上に作成します。それぞれのパーティションは、同じサイズである必要があります。RAID 10デバイスに対して、以下を行う必要があります。 </para>
     <substeps performance="required">
      <step xml:id="b14dtk6w">
       <para><guimenu>ハードディスク</guimenu>で、デバイスを選択し、次に右側のパネルで<guimenu>パーティション</guimenu>を選択します。</para>
      </step>
      <step xml:id="b14dtk6x">
       <para><guimenu>追加</guimenu>をクリックして、<guimenu>パーティションを追加</guimenu>ウィザードを開きます。</para>
      </step>
      <step xml:id="b14dtk6y">
       <para><guimenu>新しいパーティションの種類</guimenu>で、<guimenu>プライマリパーティション</guimenu>を選択し、次に<guimenu>次へ</guimenu>をクリックします。</para>
      </step>
      <step xml:id="b14dtk6z">
       <para><guimenu>新しいパーティションのサイズ</guimenu>で、このディスク上のRAIDパーティションの希望のサイズを指定し、次に<guimenu>次へ</guimenu>をクリックします。</para>
      </step>
      <step xml:id="b14dtk70">
       <para><guimenu>フォーマットオプション</guimenu>で、<guimenu>パーティションをフォーマットしない</guimenu>を選択し、次に<guimenu>ファイルシステムID</guimenu>ドロップダウンリストから<guimenu>0xFD Linux RAID</guimenu>を選択します。</para>
      </step>
      <step xml:id="b14dtk71">
       <para><guimenu>マウントオプション</guimenu>で、<guimenu>パーティションマウントしない</guimenu>を選択し、次に<guimenu>完了</guimenu>をクリックします。</para>
      </step>
      <step xml:id="b14dtk72">
       <para>上記の手順を、RAID 10デバイスで使用する予定のディスク上のRAIDパーティションを定義し終わるまで、繰り返します。</para>
      </step>
     </substeps>
    </step>
    <step xml:id="b14dtk73">
     <para>RAID 10デバイスを作成します。</para>
     <substeps performance="required">
      <step xml:id="b14dtk74">
       <para><guimenu>RAID</guimenu>を選択し、次に右側のパネルで<guimenu>RAIDを追加</guimenu>を選択して、<guimenu>RAIDの追加</guimenu>ウィザードを開きます。</para>
      </step>
      <step xml:id="b14dtk75">
       <para><guimenu>RAIDタイプ</guimenu>で、<guimenu>RAID 10 (ミラーリングおよびストライピング)</guimenu>を選択します。</para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="raid10_a.png" width="302pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step xml:id="b14dtk76">
       <para><guimenu>利用可能なデバイス</guimenu>リストで、希望のLinux RAIDパーティションを選択し、次に<guimenu>追加</guimenu>をクリックして、それらを<guimenu>選択したデバイス</guimenu>リストに移動します。</para>
      </step>
      <step xml:id="b14dtk77">
       <para>(オプション)<guimenu>Classify</guimenu>をクリックして、RAIDアレイ内でのディスクの好みの順番を指定します。</para>
       <para>追加したディスクの順番が重要となるRAIDタイプの場合は、アレイの半分が1つのディスクサブシステムに、もう半分が別のディスクサブシステムに置かれるよう、デバイスが使用される順番を指定することができます。たとえば、1つのディスクサブシステムに障害が発生した場合、システムは2番目のディスクサブシステムから稼働し続けます。</para>
       <substeps performance="required">
        <step xml:id="b14dutul">
         <para>各ディスクを順番に選択して、<guimenu>Class X</guimenu>ボタンのいずれかをクリックします。ここで、Xは、そのディスクに割り当てる文字です。用意されているクラスはA、B、C、DおよびEですが、多くの場合必要なクラスはそれより少ないです(たとえばAとBのみ)。 このようにして、すべての利用可能なRAIDディスクを割り当てます。 </para>
         <para>複数の を選択するには、CtrlキーまたはShiftキーを押します。選択したデバイスを右クリックして、コンテキストメニューから適切なクラスを選択することもできます。</para>
        </step>
        <step xml:id="b14dutum">
         <para>次のソートオプションのいずれかを選択して、デバイスの順序を指定します。</para>
         <formalpara xml:id="b14dutun">
          <title>Sorted:</title>
          <para>クラスAのすべてのデバイスを、クラスBのすべてのデバイスより前に、というように並べます。例: <literal>AABBCC</literal>。</para>
         </formalpara>
         <formalpara xml:id="b14dutuo">
          <title>Interleaved:</title>
          <para>クラスAの最初のデバイス、次にクラスBの最初のデバイス、次にデバイスが割り当てられたすべての後続のクラスの順に、デバイスを並べます。次にクラスAの2番目のデバイス、クラスBの2番目のデバイス、というように続きます。クラスを持たないデバイスはすべて、デバイスリストの最後に並べられます。例: <literal>ABCABC</literal>。</para>
         </formalpara>
         <formalpara xml:id="b14dutup">
          <title>Pattern File:</title>
          <para>それぞれが正規表現とクラス名である、複数の行を含む既存のファイルを選択します(<literal>"sda.* A"</literal>)。その正規表現に合致するすべてのデバイスが、その行に指定されたクラスに割り当てられます。正規表現は、カーネル名(<filename>/dev/sda1</filename>)、udevパス名(<filename>/dev/disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0-part1</filename>)、次にudev ID (/dev/disk/by-id/ata-ST3500418AS_9VMN8X8L-part1)に対して照合されます。デバイスの名前が、2つ以上の正規表現に合致する場合は、最初に合致したものでクラスが決定されます。</para>
         </formalpara>
        </step>
        <step xml:id="b14dutuq">
         <para>ダイアログボックスの下で、<guimenu>OK</guimenu>をクリックして、順番を確定します。</para>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject>
           <imagedata fileref="raid10_classify_a.png" width="292pt" format="png"/></imageobject>
          </mediaobject>
         </informalfigure>
        </step>
       </substeps>
      </step>
      <step xml:id="b14dttix">
       <para><guimenu>次へ</guimenu>をクリックします。</para>
      </step>
      <step xml:id="b14dttiy">
       <para><guimenu>RAIDオプション</guimenu>で、<guimenu>チャンクサイズ</guimenu>と<guimenu>パリティアルゴリズム</guimenu>を指定し、次に<guimenu>次へ</guimenu>をクリックします。</para>
       <para>RAID 10の場合、パリティオプションは、n (near)、f (far)、およびo (offset)です。数字は、必要となる各データブロックのレプリカの数を示します。2がデフォルトの設定です。詳細については、<xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
      </step>
      <step xml:id="b14dttiz">
       <para>ファイルシステムとマウントオプションをRAIDデバイスに追加して、<guimenu>完了</guimenu>をクリックします。</para>
      </step>
     </substeps>
    </step>
    <step xml:id="b14dttj0">
     <para role="intro"><guimenu>RAID</guimenu>を選択し、新たに作成されたRAIDデバイスを選択してから、<guimenu>使用するデバイス</guimenu>をクリックして、そのパーティションを確認します。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="raid10_useddevs_a.png" width="302pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="b14dtw8j">
     <para><guimenu>次へ</guimenu>をクリックします。</para>
    </step>
    <step xml:id="b14dtw8k">
     <para>変更する内容を確認して、<guimenu>完了</guimenu>をクリックすると、RAIDが作成されます。</para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="raidmdadmdegraded">
  <title>ディグレードアレイの作成</title>
  <para role="intro">ディグレードアレイは、一部のデバイスが欠けたアレイです。ディグレードアレイは、RAID 1、RAID 4、RAID 5、およびRAID 6に対してのみサポートされています。これらのRAIDタイプは、その耐障害性機能として、一部のデバイスの欠落に耐えるように設計されています。通常、デバイスに障害が発生すると、ディグレードアレイが生成されます。ディグレードアレイは、意図的に作成するすることもできます。 </para>
  <informaltable>
   <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="3334*"/>
   <colspec colnum="2" colname="2" colwidth="3334*"/>
   <colspec colnum="3" colname="3" colwidth="3334*"/>
    <thead>
     <row><!--id=b8gzm1p-->
      <entry>
       <para>RAIDの種類</para>
      </entry>
      <entry>
       <para>許容可能な欠落スロット数</para>
      </entry>
      <entry/>
     </row>
    </thead>
    <tbody>
     <row><!--id=b8gzm1q-->
      <entry>
       <para>RAID 1</para>
      </entry>
      <entry>
       <para>1つ以外の全スロット</para>
      </entry>
      <entry/>
     </row>
     <row><!--id=b8gzm1r-->
      <entry>
       <para>RAID 4</para>
      </entry>
      <entry>
       <para>1スロット</para>
      </entry>
      <entry/>
     </row>
     <row><!--id=b8h0rww-->
      <entry>
       <para>RAID 5</para>
      </entry>
      <entry>
       <para>1スロット</para>
      </entry>
      <entry/>
     </row>
     <row><!--id=b8gzm1s-->
      <entry>
       <para>RAID 6</para>
      </entry>
      <entry>
       <para>1個または2個のスロット</para>
      </entry>
      <entry/>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>一部のデバイスが欠落したディグレードアレイを作成するには、単に、デバイス名の代わりに<literal>missing</literal>というワードを指定します。この指定により、<command>mdadm</command>は、アレイ内の対応するスロットを空のまま残します。 </para>
  <para>RAID 5アレイの作成時に、<command>mdadm</command>によって、余分なスペアドライブをもつディグレードアレイが自動的に作成されます。これは、一般に、ディグレードアレイ内にスペアを構築した方が、ディグレードアレイではないが正常でないアレイ上でパリティを再同期するより高速なためです。この機能は、<literal>--force</literal>オプションで無効にできます。</para>
  <para>RAIDを作成したいが、使用するデバイスの1つに既にデータが入っている場合は、ディグレードアレイを作成すると便利なことがあります。その場合は、他のデバイスでディグレードアレイを作成し、その使用中のデバイスからのデータをディグレードモードで実行中のRAIDにコピーし、デバイスをRAIDに追加して、RAIDの再構築まで待機すると、データがすべてのデバイスに行き渡ります。このプロセスの例を、次のプロシージャで示します。</para>
  <procedure xml:id="b8h2aqj">
   <step xml:id="b8h2aqk">
    <para>ディグレードRAID 1デバイス<filename>/dev/md0</filename>を単一ドライブ<filename>/dev/sd1</filename>で作成します。コマンドプロンプトで、次のように入力してください。</para>

<screen>
mdadm --create /dev/md0 -l 1 -n 2 /dev/sda1 missing
</screen>

    <para>追加先のデバイスは、追加するデバイスと同じか、またはそれ以上のサイズをもつ必要があります。</para>
   </step>
   <step xml:id="b8h2atq">
    <para>ミラーに追加したいデバイスに、RAIDアレイに移動したいデータが含まれている場合は、この時点で、そのデータを、ディグレードモードで実行中のRAIDアレイにコピーします。</para>
   </step>
   <step xml:id="b8h2avw">
    <para>デバイスをミラーに追加します。たとえば、add <filename>/dev/sdb1</filename>をRAIDに追加するには、コマンドプロンプトで、次のように入力します。</para>

<screen>
mdadm /dev/md0 -a /dev/sdb1
</screen>

    <para>一度に1つのデバイスのみ追加できます。カーネルがミラーを構築し、完全にオンラインにした後、別のミラーを追加できます。 </para>
   </step>
   <step xml:id="b8h2ayp">
    <para>構築の進捗状況を監視するには、コマンドプロンプトで、次のように入力します。</para>

<screen>
cat /proc/mdstat
</screen>

    <para>毎秒更新されている間に再構築の進捗を確認するには、次のように入力します。</para>

<screen>
watch -n 1 cat /proc/mdstat 
</screen>

   </step>
  </procedure>
 </section>
</chapter>

<chapter conformance="sles11,Novell,no,,80" xml:id="raidresize" xml:lang="ja" revision="02/22/07" xml:base="05_raid_resize.xml"><title>mdadmによるソフトウェアRAIDアレイのサイズ変更</title><info/>
 
 <para>本項では、ソフトウェアRAID 1、4、5、または6のデバイスのサイズを複数デバイス管理(<command>mdadm(8)</command>)ツールで増減する方法について説明します。 </para>
 <warning>
  <para>このセクションに示されたタスクを開始する前に、すべてのデータに有効なバックアップがあることを確認してください。 </para>
 </warning>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="resizeincr" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="resizedecr" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="resizeunderstand">
  <title>サイズ変更プロセスの理解</title>
  <para>既存のソフトウェアRAIDデバイスのサイズ変更には、各コンポーネントパーティションが提供するスペースの増減が必要です。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b8ppjxz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b8pr3ol" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b8ppjxz">
   <title>ソフトウェアRAIDサイズ変更のガイドライン </title>
   <para><command>mdadm(8)</command>ツールは、ソフトウェアRAIDレベル1、4、5、および6に対してだけサイズ変更をサポートします。これらのRAIDレベルには耐障害性があるので、一度に1つづつ、サイズ変更するコンポーネントパーティションを削除できます。原則として、RAIDパーティションのホットリサイズが可能ですが、その場合は、データの保全に特に注意する必要があります。 </para>
   <para>デバイス上の使用可能スペースで変更内容を利用するために、RAIDに常駐するファイルシステムもサイズ変更できる必要があります。SUSE® Linux Enterprise Server 11では、ファイルシステムExt2、Ext3、およびReiserFSに対して、ファイルシステムのサイズ変更ユーティリティを使用できます。このユーティリティは、次のようにサイズの増減をサポートします。</para>
   <table xml:id="biuzuno">
    <title>ファイルシステムサイズ変更のサポート</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="2500*"/>
    <colspec colnum="3" colname="3" colwidth="2500*"/>
    <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row><!--id=biuzunp-->
       <entry>
        <para>ファイルシステム</para>
       </entry>
       <entry>
        <para>ユーティリティ</para>
       </entry>
       <entry>
        <para>サイズを増加</para>
       </entry>
       <entry>
        <para>サイズを減少</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=biuzunq-->
       <entry>
        <para>Ext2またはExt3</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>はい(ただし、オフラインのみ)</para>
       </entry>
       <entry>
        <para>はい(ただし、オフラインのみ)</para>
       </entry>
      </row>
      <row><!--id=biuzunr-->
       <entry>
        <para>ReiserFS</para>
       </entry>
       <entry>
        <para>resize_reiserfs</para>
       </entry>
       <entry>
        <para>はい(オンラインまたはオフライン)</para>
       </entry>
       <entry>
        <para>はい(ただし、オフラインのみ)</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>パーティションまたはファイルシステムのサイズ変更には、データを失う可能性をはらむリスクが伴います。 </para>
   <warning>
    <para>データの喪失を避けるには、データを必ずバックアップしてから、サイズ変更タスクを開始します。</para>
   </warning>
  </section>
  <section xml:id="b8pr3ol">
   <title>タスクの概要</title>
   <para>RAIDのサイズ変更には、次のようなタスクがあります。タスクの実行順序は、サイズを増加するか、減少するかによって異なります。 </para>
   <table xml:id="b8ppko3">
    <title>RAIDのサイズ変更に必要なタスク</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
    <colspec colnum="3" colname="3" colwidth="1250*"/>
    <colspec colnum="4" colname="4" colwidth="1250*"/>
     <thead>
      <row><!--id=b8pps5o-->
       <entry>
        <para>仕事</para>
       </entry>
       <entry>
        <para>説明</para>
       </entry>
       <entry>
        <para>サイズを増大させる場合の順序</para>
       </entry>
       <entry>
        <para>サイズを減少させる場合の順序</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b8pps5p-->
       <entry>
        <para>各コンポーネントパーティションのサイズを変更します。</para>
        <para/>
       </entry>
       <entry>
        <para>各コンポーネントパーティションのアクティブなサイズを増加または減少します。一度に1つのコンポーネントパーティションだけを削除し、そのサイズを変更してから、パーティションをRAIDに戻します。</para>
       </entry>
       <entry>
        <para>1</para>
       </entry>
       <entry>
        <para>2</para>
       </entry>
      </row>
      <row><!--id=b8pps5q-->
       <entry>
        <para>ソフトウェアRAID自体をサイズ変更します。</para>
       </entry>
       <entry>
        <para>RAIDは、ベースのコンポーネントパーティションの増減を自動的には認識しません。したがって、RAIDに新しいサイズを知らせる必要があります。</para>
       </entry>
       <entry>
        <para>2</para>
       </entry>
       <entry>
        <para>3</para>
       </entry>
      </row>
      <row><!--id=b8pps5r-->
       <entry>
        <para>ファイルシステムのサイズを変更します。</para>
       </entry>
       <entry>
        <para>RAIDに常駐するファイルシステムをサイズ変更する必要があります。これは、サイズ変更のツールを提供するファイルシステムの場合のみ可能です（Ext2、Ext3、ReiserFSなど)。</para>
       </entry>
       <entry>
        <para>3</para>
       </entry>
       <entry>
        <para>1</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para/>
  </section>
 </section>
 <section xml:id="resizeincr">
  <title>ソフトウェアRAIDのサイズの増加</title>
  <para>始める前に、<xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/>のガイドラインをレビューしてください。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="resizeincrpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="resizeincrpart">
   <title>コンポーネントパーティションのサイズの増加</title>
   <para>RAID 1、4、5、または6のサイズを増加するには、本項の手順を適用します。RAID内のコンポーネントパーティションごとに、RAIDからパーティションを削除し、そのサイズを変更し、パーティションをRAIDに戻し、RAIDが安定するまで待機してから続行します。パーティションが削除されている間、RAIDはディグレードモードで動作し、ディスクの 耐障害性がまったくないか、または低下しています。複数の同時ディスク障害を許容できるRAIDの場合でも、一度に2つ以上のパーティションを削除しないでください。</para>
   <warning>
    <para>RAIDに、ディスクの耐障害性がないか、単に一貫性がない場合、パーティションのどれかを削除すると、データが失われます。パーティションの削除は注意深く行い、必ず、データのバックアップをとってください。 </para>
   </warning>
   <para>このセクションのプロシージャでは、次のテーブルに示すデバイス名を使用します。これらの名前は変更して、必ずご使用のデバイスの名前を使用してください。</para>
   <table xml:id="b8prrn8">
    <title>コンポーネントパーティションのサイズを増加するシナリオ </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b8pry2e-->
       <entry>
        <para>RAIDデバイス</para>
       </entry>
       <entry>
        <para>コンポーネントパーティション</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b8pry2f-->
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/sda1</filename></para>
        <para><filename>/dev/sdb1</filename></para>
        <para><filename>/dev/sdc1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>RAID用コンポーネントパーティションのサイズを増加するには:</para>
   <procedure xml:id="b8pp3av">
    <step xml:id="b8progi">
     <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
    </step>
    <step xml:id="b8pp3aw">
     <para>次のように入力して、RAIDアレイが一貫性を保っており、同期されていることを確認します。 </para>

<screen>
cat /proc/mdstat
</screen>

     <para>このコマンドの出力によって、RAIDアレイがまだ同期中とわかる場合は、同期化の完了まで待って、続行してください。 </para>
    </step>
    <step xml:id="b8pp3ax">
     <para>コンポーネントパーティションの1つをRAIDアレイから削除します。たとえば、次のように入力して、<filename>/dev/sda1</filename>を削除します。 </para>

<screen>
mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1
</screen>

     <para>成功するためには、failとremoveの両方のアクションが行われる必要があります。 </para>
    </step>
    <step xml:id="b8pp3ay">
     <para>次のオプションの1つを実行して、<xref linkend="b8pp3ax" xrefstyle="StepXRef"/>で削除したパーティションのサイズを増加します。</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para><command>fdisk(8)</command>、<command>cfdisk(8)</command>、<command>parted(8)</command>などのディスクパーティショナを使用して、パーティションのサイズを増加します。通常は、このオプションが選択されます。</para>
      </listitem>
      <listitem>
       <para>パーティションの常駐ディスクを、容量のより大きいデバイスに置き換えます。 </para>
       <para>このオプションは、元ディスクの他のファイルシステムがシステムによりアクセスされない場合だけ選択できます。置き換え用デバイスをRAIDに追加すると、元のデバイスにあったデータをすべて再構築しなければならないので、データの同期にはるかに長い時間がかかります。</para>
      </listitem>
     </itemizedlist>
    </step>
    <step xml:id="b8pp3az">
     <para>パーティションをRAIDアレイに再追加します。たとえば、次のように入力して、<filename>/dev/sda1</filename>を追加します。 </para>

<screen>
mdadm -a /dev/md0 /dev/sda1
</screen>

     <para>RAIDが同期され、一貫性をもつまで待機してから、次のパーティションの処理に進みます。</para>
    </step>
    <step xml:id="b8ps27a">
     <para>アレイ内の残りのコンポーネントデバイスごとに、<xref linkend="b8pp3aw" xrefstyle="StepXRef"/>から<xref linkend="b8pp3az" xrefstyle="StepXRef"/>まで繰り返します。正しいコンポーネントパーティションに対して、必ずコマンドを変更してください。</para>
    </step>
    <step xml:id="b8ps2tp">
     <para>カーネルがRAIDのパーティションテーブルを再読み込みできないというメッセージが表示されたら、すべてのパーティションのサイズ変更後にコンピュータを再起動して、パーティションテーブルの更新を強制する必要があります。</para>
    </step>
    <step xml:id="b8q915s">
     <para><xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>に進みます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="resizeincrraid">
   <title>RAIDアレイのサイズの増加</title>
   <para>RAID内の各コンポーネントパーティションのサイズ変更後(<xref linkend="resizeincrpart" xrefstyle="SectTitleOnPage"/>参照)も、新しい使用可能スペースの認識を強制するまで、RAIDアレイの設定では、元のアレイサイズが使用され続けます。RAIDアレイのサイズを指定したり、使用可能な最大スペースを使用できます。 </para>
   <para>本項の手順では、RAIDデバイスのデバイス名として <filename>//dev/md0</filename>を使用しています。この名前は変更して、必ずご使用のデバイスの名前を使用してください。</para>
   <procedure xml:id="b8pp3b0">
    <step xml:id="b8psa0o">
     <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
    </step>
    <step xml:id="b8pp3b1">
     <para>次のように入力して、アレイのサイズとアレイに認識されるデバイスサイズをチェックします。</para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step xml:id="b8psbwk">
     <para>次のいずれかの操作を行います。</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>次のように入力して、アレイサイズを使用可能な最大サイズまで増加します。 </para>

<screen>
mdadm --grow /dev/md0 -z max
</screen>

      </listitem>
     </itemizedlist>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>次のように入力して、アレイサイズを使用可能な最大サイズまで増加します。 </para>

<screen>
mdadm --grow /dev/md0 -z max --assume-clean
</screen>

       <para>アレイは、デバイスに追加されたスペースを利用しますが、このスペースは同期されません。これがRAID1に推奨される理由は、同期が不要だからです。メンバーデバイスに追加されたスペースが事前にゼロ化されていれば、他のRAIDレベルに有用なことがあります。</para>
      </listitem>
     </itemizedlist>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>次のように入力して、アレイサイズを指定の値まで増加します。 </para>

<screen>
mdadm --grow /dev/md0 -z <replaceable>size</replaceable>
</screen>

       <para><replaceable>size</replaceable>を、キロバイト(1キロバイトは1024バイト)単位で目的のサイズを表す整数値で置き換えます。 </para>
      </listitem>
     </itemizedlist>
    </step>
    <step xml:id="b8pp3b3">
     <para>次のように入力して、アレイのサイズとアレイに認識されるデバイスサイズを再チェックします。 </para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step xml:id="b8psgk9">
     <para>次のいずれかの操作を行います。 </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>アレイのサイズ変更が成功していたら、<xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/>を続行します。</para>
      </listitem>
      <listitem>
       <para>アレイが予期どおりにサイズ変更されていない場合は、いったん再起動してから、このプロシージャを再試行する必要があります。 </para>
      </listitem>
     </itemizedlist>
    </step>
   </procedure>
  </section>
  <section xml:id="resizeincrfs">
   <title>ファイルシステムのサイズの増加</title>
   <para>アレイサイズの増加後は (<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>参照)、ファイルシステムのサイズ変更ができます。 </para>
   <para>ファイルシステムのサイズを使用可能な最大スペースまで増加したり、正確なサイズを指定できます。ファイルシステムに正確なサイズを指定する場合は、その新しいサイズが次の条件を満たすかどうかを必ず確認してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新しいサイズは、既存データのサイズより大きくなければなりません。さもないと、データが失われます。 </para>
    </listitem>
    <listitem>
     <para>ファイルシステムのサイズは使用可能なスペースより大きくできないので、新しいサイズは、現在のRAIDサイズ以下でなければなりません。</para>
    </listitem>
   </itemizedlist>
   <section xml:id="b8uks1t">
    <title>Ext2またはExt3</title>
    <para>Ext2とExt3のファイルシステムは、<command>resize2fs</command>コマンドでマウントまたはアンマウントする際にサイズ変更できます。</para>
    <procedure xml:id="b8uksb5">
     <step xml:id="b8uksb6">
      <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
     </step>
     <step xml:id="b8uksjw">
      <para>次の方法の1つで、ファイルシステムのサイズを増加します。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>ファイルシステムのサイズを、<filename>/dev/md0</filename>と呼ばれるソフトウェアRAIDデバイスの最大使用可能サイズまで拡張するには、次のコマンドを入力します。</para>

<screen>
resize2fs /dev/md0
</screen>

        <para>sizeパラメータを指定しない場合、サイズはパーティションのサイズにデフォルト設定されます。</para>
       </listitem>
       <listitem>
        <para>ファイルシステムを特定のサイズに拡張するには、次のコマンドを入力します。 </para>

<screen>
resize2fs /dev/md0 <replaceable>size</replaceable>
</screen>

        <para><replaceable>size</replaceable>パラメータは、要求されたファイルシステムの新サイズを指定します。単位を指定しない場合のsizeパラメータの単位は、ファイルシステムのブロックサイズです。オプションとして、sizeパラメータの後ろに、次の単位指定子の1つを付けることができます。sは512バイトのセクタ、Kはキロバイト(1キロバイトは1024バイト)、Mはメガバイト、Gはギガバイトを表します。</para>
       </listitem>
      </itemizedlist>
      <para>サイズ変更が完了するまで待って、続行します。</para>
     </step>
     <step xml:id="b8ule4k">
      <para>ファイルシステムがマウントされていない場合は、この時点で、ファイルシステムをマウントします。 </para>
      <para>たとえば、Ext2ファイルシステムを、<filename>/dev/md0</filename>という名前のRAIDに、マウントポイント<filename>/raid</filename>でマウントするには、次のように入力します。</para>

<screen>
mount -t ext2 /dev/md0 /raid
</screen>

     </step>
     <step xml:id="b8ul4ag">
      <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

      <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
     </step>
    </procedure>
   </section>
   <section xml:id="b8ul8fq">
    <title>ReiserFS</title>
    <para>Ext2およびExt3と同様に、ReiserFSファイルシステムは、マウントまたはアンマウント時にサイズを増加できます。サイズ変更は、RAIDアレイのブロックデバイス上で行われます。</para>
    <procedure xml:id="b8ul8cv">
     <step xml:id="b8ul8cw">
      <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
     </step>
     <step xml:id="b8ul8cx">
      <para><filename>/dev/md0</filename>と呼ばれるソフトウェアRAIDデバイスのファイルシステムのサイズを、次の方法の1つを使用して変更します。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>ファイルシステムのサイズをデバイスの使用可能な最大サイズまで拡張するには、次のように入力します。</para>

<screen>
resize_reiserfs /dev/md0
</screen>

        <para>サイズを指定しないと、ボリュームはパーティションのフルサイズまで拡張されます。 </para>
       </listitem>
       <listitem>
        <para>ファイルシステムを特定のサイズに拡張するには、次のコマンドを入力します。</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/md0
</screen>

        <para><replaceable>size</replaceable>を目的のサイズ(バイト単位)で置き換えます。50000K(キロバイト)、250M(メガバイト)、2G (ギガバイト)など、値の単位を指定することもできます。代わりに、プラス(+)記号を値の前に付けることにより、現在のサイズに対する増加を指定することもできます。たとえば、次のコマンドは、<filename>/dev/md0</filename>上のファイルシステムのサイズを500 MB分増加します。</para>

<screen>
resize_reiserfs -s +500M /dev/md0
</screen>

       </listitem>
      </itemizedlist>
      <para>サイズ変更が完了するまで待って、続行します。</para>
     </step>
     <step xml:id="b8ulei7">
      <para>ファイルシステムがマウントされていない場合は、この時点で、ファイルシステムをマウントします。 </para>
      <para>たとえば、ReiserFSファイルシステムを、<filename>/dev/md0</filename>というRAIDに、マウントポイント<filename>/raid</filename>でマウントするには、次のように入力します。</para>

<screen>
mount -t reiserfs /dev/md0 /raid
</screen>

     </step>
     <step xml:id="b8ul8cy">
      <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

      <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
     </step>
    </procedure>
   </section>
  </section>
 </section>
 <section xml:id="resizedecr">
  <title>ソフトウェアRAIDのサイズの削減</title>
  <para>始める前に、<xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/>のガイドラインをレビューしてください。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="resizedecrfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizedecrpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="resizedecrfs">
   <title>ファイルシステムのサイズの削減</title>
   <para>RAIDデバイス上のファイルシステムのサイズを削減する際には、新しいサイズが次の条件を満たすかどうかを必ず確認してください。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新しいサイズは、既存データのサイズより大きくなければなりません。さもないと、データが失われます。 </para>
    </listitem>
    <listitem>
     <para>ファイルシステムのサイズは使用可能なスペースより大きくできないので、新しいサイズは、現在のRAIDサイズ以下でなければなりません。</para>
    </listitem>
   </itemizedlist>
   <para>SUSE Linux Enterprise Serverでは、Ext2、Ext3、およびReiserFSが、ファイルシステムのサイズを縮小するユーティリティを提供します。以降の該当するプロシージャを使用して、ファイルシステムのサイズを減少させてください。</para>
   <para>このセクションのプロシージャでは、RAIDデバイスのデバイス名として <filename>//dev/md0</filename>を使用しています。コマンドを変更して、必ずご使用のデバイスの名前を使用してください。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bznzca1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bznzca8" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bznzca1">
    <title>Ext2またはExt3</title>
    <para>Ext2とExt3のファイルシステムは、マウントまたはアンマウント時にサイズ変更できます。 </para>
    <procedure xml:id="bznzca2">
     <step xml:id="bznzca3">
      <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
     </step>
     <step xml:id="bznzca4">
      <para>RAID上のファイルシステムのサイズを減少させるには、次のコマンドを入力します。</para>

<screen>
resize2fs /dev/md0 &lt;size&gt;
</screen>

      <para><replaceable>size</replaceable>を、目的のサイズを表す整数値(キロバイト単位)で置き換えます(1キロバイトは1024バイト)。</para>
      <para>サイズ変更が完了するまで待って、続行します。</para>
     </step>
     <step xml:id="bznzca5">
      <para>ファイルシステムがマウントされていない場合は、この時点で、ファイルシステムをマウントします。たとえば、Ext2ファイルシステムを、<filename>/dev/md0</filename>という名前のRAIDに、マウントポイント<filename>/raid</filename>でマウントするには、次のように入力します。</para>

<screen>
mount -t ext2 /dev/md0 /raid
</screen>

     </step>
     <step xml:id="bznzca6">
      <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

      <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
     </step>
     <step xml:id="bznzca7">
      <para><xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>に進みます。</para>
     </step>
    </procedure>
   </section>
   <section xml:id="bznzca8">
    <title>ReiserFS</title>
    <para>ReiserFSファイルシステムのサイズは、ボリュームがアンマウントされる場合のみ、減少させることができます。 </para>
    <procedure xml:id="bznzca9">
     <step xml:id="bznzcaa">
      <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
     </step>
     <step xml:id="bznzcab">
      <para>次のコマンドを入力して、デバイスをアンマウントします。</para>

<screen>
umount /mnt/point
</screen>

      <para>サイズを削減するパーティションにシステムファイル(ルート<filename>/</filename>ボリュームなど)が含まれていると、ブート可能なCDまたはフロッピーからブートする場合のみ、アンマウントが可能です。</para>
     </step>
     <step xml:id="bznzcac">
      <para><filename>/dev/md0</filename>と呼ばれるソフトウェアRAIDデバイス上のファイルシステムのサイズを減らすには、次のように入力します。</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/md0
</screen>

      <para><replaceable>size</replaceable>を目的のサイズ(バイト単位)で置き換えます。50000K(キロバイト)、250M(メガバイト)、2G (ギガバイト)など、値の単位を指定することもできます。代わりに、マイナス(-)記号を値の前に付けて、現在のサイズに対する削減分を指定することもできます。たとえば、次のコマンドは、<filename>/dev/md0</filename>上のファイルシステムのサイズを 500 MB分減少させます。</para>

<screen>
resize_reiserfs -s -500M /dev/md0
</screen>

      <para>サイズ変更が完了するまで待って、続行します。</para>
     </step>
     <step xml:id="bznzcad">
      <para>次のコマンドで、ファイルシステムをマウントします。 </para>

<screen>
mount -t reiserfs /dev/md0 /mnt/point
</screen>

     </step>
     <step xml:id="bznzcae">
      <para>次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。</para>

<screen>
df -h
</screen>

      <para>ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステムで使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。</para>
     </step>
     <step xml:id="bznzcaf">
      <para><xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>に進みます。</para>
     </step>
    </procedure>
   </section>
  </section>
  <section xml:id="resizedecrraid">
   <title>RAIDアレイサイズの削減</title>
   <para>ファイルシステムのサイズ変更後、RAIDアレイ設定では、利用可能スペースを縮小するよう強制するまで、元のアレイサイズを使い続けます。RAIDが、削減したセグメントサイズを使用するようにするには、<command>mdadm --grow</command>モードを使用します。それを行うには、-zオプションを使用して、RAID内の各デバイスが使用するスペースの量を、キロバイトで指定する必要があります。このサイズは、チャンクサイズの倍数である必要があり、RAIDのスーパーブロックをデバイスに書き込むためのスペースとして、約128KBを残しておかなければなりません。 </para>
   <para>このセクションのプロシージャでは、RAIDデバイスのデバイス名として <filename>//dev/md0</filename>を使用しています。コマンドを変更して、必ずご使用のデバイスの名前を使用してください。</para>
   <procedure xml:id="bznzcau">
    <step xml:id="bznzcav">
     <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
    </step>
    <step xml:id="bznzcaw">
     <para>次のように入力して、アレイのサイズとアレイに認識されるデバイスサイズをチェックします。</para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step xml:id="bznzcax">
     <para>次のコマンドで、アレイのデバイスサイズを指定の値まで減少させます。 </para>

<screen>
mdadm --grow /dev/md0 -z <replaceable>&lt;size</replaceable>&gt;
</screen>

     <para><replaceable>size</replaceable>を、目的のサイズを表す整数値(キロバイト単位)で置き換えます(1キロバイトは1024バイト)。 </para>
     <para>たとえば、次のコマンドでは、各RAIDデバイスのセグメントサイズを約40 GBに設定し、チャンクサイズは64 KBです。これには、RAIDのスーパーブロック用の128 KBが含まれます。</para>

<screen>
mdadm --grow /dev/md2 -z 41943168
</screen>

    </step>
    <step xml:id="bznzcay">
     <para>次のように入力して、アレイのサイズとアレイに認識されるデバイスサイズを再チェックします。 </para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step xml:id="bznzcaz">
     <para>次のいずれかの操作を行います。 </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>アレイのサイズ変更が成功していたら、<xref linkend="resizedecrpart" xrefstyle="SectTitleOnPage"/>を続行します。</para>
      </listitem>
      <listitem>
       <para>アレイが予期どおりにサイズ変更されていない場合は、いったん再起動してから、このプロシージャを再試行する必要があります。 </para>
      </listitem>
     </itemizedlist>
    </step>
   </procedure>
  </section>
  <section xml:id="resizedecrpart">
   <title>コンポーネントパーティションのサイズの削減</title>
   <para>RAID内の各デバイスで使用されるセグメントサイズの削減後、各コンポーネントパーティション内の残りのスペースは、そのRAIDでは使われません。パーティションを現在のサイズのまま残して将来のRAIDの拡大に備えることも、今は使用しないそのスペースを利用することもできます。</para>
   <para>そのスペースを利用するには、コンポーネントパーティションを1つずつ削減します。コンポーネントパーティションごとに、そのパーティションをRAIDから削除し、パーティションサイズを縮小し、パーティションをRAIDに戻したら、RAIDが安定するまで待機します。メタデータに備えるには、<xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>でRAIDに対して指定したサイズより、若干大きなサイズを指定する必要があります。</para>
   <para>パーティションが削除されている間、RAIDはディグレードモードで動作し、ディスクの 耐障害性がまったくないか、または低下しています。複数の同時ディスクエラーに耐えるRAIDの場合でも、一度に2つ以上のコンポーネントパーティションを削除しないでください。</para>
   <warning>
    <para>RAIDに、ディスクの耐障害性がないか、単に一貫性がない場合、パーティションのどれかを削除すると、データが失われます。パーティションの削除は注意深く行い、必ず、データのバックアップをとってください。 </para>
   </warning>
   <para>このセクションのプロシージャでは、次のテーブルに示すデバイス名を使用します。これらのコマンドは変更して、必ずご使用のデバイスの名前を使用してください。</para>
   <table xml:id="bznzcah">
    <title>コンポーネントパーティションのサイズを増加するシナリオ </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=bznzcai-->
       <entry>
        <para>RAIDデバイス</para>
       </entry>
       <entry>
        <para>コンポーネントパーティション</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bznzcaj-->
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/sda1</filename></para>
        <para><filename>/dev/sdb1</filename></para>
        <para><filename>/dev/sdc1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>RAID用コンポーネントパーティションのサイズを削減するには:</para>
   <procedure xml:id="bznzcak">
    <step xml:id="bznzcal">
     <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザまたは同等の権限でログインします。</para>
    </step>
    <step xml:id="bznzcam">
     <para>次のように入力して、RAIDアレイが一貫性を保っており、同期されていることを確認します。 </para>

<screen>
cat /proc/mdstat
</screen>

     <para>このコマンドの出力によって、RAIDアレイがまだ同期中とわかる場合は、同期化の完了まで待って、続行してください。 </para>
    </step>
    <step xml:id="bznzcan">
     <para>コンポーネントパーティションの1つをRAIDアレイから削除します。たとえば、次のように入力して、<filename>/dev/sda1</filename>を削除します。 </para>

<screen>
mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1
</screen>

     <para>成功するためには、failとremoveの両方のアクションが行われる必要があります。 </para>
    </step>
    <step xml:id="bznzcao">
     <para><xref linkend="b8pp3ax" xrefstyle="StepXRef"/>で削除したパーティションのサイズを、セグメントサイズに設定したサイズより若干小さいサイズに減らします。このサイズは、チャンクサイズの倍数であり、RAIDのスーパーブロック用に128 KBを確保する必要があります。<command>fdisk</command>、<command>cfdisk</command>、 <command>parted</command>などのディスクパーティショナを使用して、パーティションのサイズを縮小します。</para>
    </step>
    <step xml:id="bznzcap">
     <para>パーティションをRAIDアレイに再追加します。たとえば、次のように入力して、<filename>/dev/sda1</filename>を追加します。 </para>

<screen>
mdadm -a /dev/md0 /dev/sda1
</screen>

     <para>RAIDが同期され、一貫性をもつまで待機してから、次のパーティションの処理に進みます。</para>
    </step>
    <step xml:id="bznzcaq">
     <para>アレイ内の残りのコンポーネントデバイスごとに、<xref linkend="b8pp3aw" xrefstyle="StepXRef"/>から<xref linkend="b8pp3az" xrefstyle="StepXRef"/>まで繰り返します。正しいコンポーネントパーティションに対して、必ずコマンドを変更してください。</para>
    </step>
    <step xml:id="bznzcar">
     <para>カーネルがRAIDのパーティションテーブルを再読み込みできないというメッセージが表示されたら、すべてのパーティションのサイズ変更後にコンピュータを再起動する必要があります。</para>
    </step>
    <step xml:id="bzo0b0b">
     <para>(オプション) RAIDとファイルシステムのサイズを拡大して、現在は小さめのコンポーネントパーティション内のスペースの最大量を利用するには、次のようにします。</para>
     <substeps performance="required">
      <step xml:id="bznzcas">
       <para>RAIDのサイズを拡大して、縮小したサイズのコンポーネントパーティション内で現在利用可能なスペースの最大量を利用します。</para>

<screen>
mdadm --grow /dev/md0 -z max
</screen>

      </step>
      <step xml:id="bzo00hx">
       <para>ファイルシステムのサイズを拡大して、新たにサイズ変更したRAID内の利用可能なスペースをすべて利用します。詳細については、<xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </section>
 </section>
</chapter>

<chapter xml:id="cha-raids-lee" xml:lang="ja" xml:base="05_raid_led.xml"><title>MDソフトウェアRAID用のストレージエンクロージャLEDユーティリティ</title><info/>
 
 <para>ストレージエンクロージャLEDモニタリングユーティリティ(<command>ledmon(8)</command>)およびLEDコントロール(<command>ledctl(8)</command>)ユーティリティは、多様なインタフェースおよびプロトコルを使用してストレージエンクロージャLEDを制御する、Linuxのユーザスペースアプリケーションです。その主たる用途は、mdadmユーティリティで作成されたLinux MDソフトウェアのRAIDデバイスの状態を視覚化することです。ledmonデーモンがドライブアレイの状態を監視し、ドライブLEDの状態を更新します。ledctlを使用して、指定したデバイスに対するLEDパターンを設定できます。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="b14fewb2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14fewb3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5li" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5lj" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5lk" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14feg6m" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="b14fewb2">
  <title>サポートされているLED管理プロトコル</title>
  <para>これらのLEDユーティリティでは、SGPIO (Serial General Purpose Input/Output)仕様(Small Form Factor (SFF) 8485)およびSCSI Enclosure Services (SES) 2プロトコルを使用して、LEDを制御します。SGPIO用のSFF-8489仕様のInternational Blinking Pattern Interpretation (IBPI)パターンを実装します。IBPIは、SGPIO規格がバックプレーン上のドライブやスロットの状態としてどのように解釈されるか、またバックプレーンがLEDでどのように状態を視覚化すべきかを定義します。 </para>
  <para>一部のストレージエンクロージャでは、SFF-8489仕様に厳格に準拠していないものがあります。エンクロージャプロセッサがIBPIパターンを受け入れていても、LEDの点滅はSFF-8489仕様に従っていない、あるいはプロセッサが限られた数のIBPIパターンしかサポートしていない場合があります。 </para>
  <para>LED管理(AHCI)およびSAF-TEプロトコルは、<command>ledmon</command>および<command>ledctl</command>ユーティリティではサポートされていません。</para>
 </section>
 <section xml:id="b14fewb3">
  <title>サポートされているストレージエンクロージャシステム</title>
  <para><command>ledmon</command>および<command>ledctl</command>アプリケーションは、インテルAHCIコントローラやインテルSASコントローラなどの、インテルのストレージコントローラで機能することが検証されています。SUSE Linux Enterprise Server 11 SP3からは、MDソフトウェアのRAIDボリュームの一部であるPCIe-SSDデバイスの、ストレージエンクロージャ状態(OK、Fail、Rebuilding)用LEDを制御するための、PCIe-SSD (ソリッドステートディスク)エンクロージャLEDもサポートされています。これらのアプリケーションは、他のベンダのIBPI準拠のストレージコントローラ(特にSAS/SCSIコントローラ)でも機能するはずですが、他のベンダのコントローラはテストされていません。</para>
 </section>
 <section xml:id="b13jg5li">
  <title>ストレージエンクロージャLED監視サービス(ledmon(8))</title>
  <para><command>ledmon</command>アプリケーションは、MDソフトウェアRAIDデバイスの状態またはストレージエンクロージャまたはドライブベイ内のブロックデバイスの状態をコンスタントに監視する、デーモンプロセスです。一度に実行しているデーモンのインスタンスは、1つのみである必要があります。<command>ledmon</command>アプリケーションは、インテルのエンクロージャLEDユーティリティの一部です。 </para>
  <para>状態は、ストレージアレイエンクロージャまたはドライブベイ内の、各スロットに関連付けられたLED上で視覚化されます。このアプリケーションは、すべてのソフトウェアRAIDデバイスを監視し、その状態を視覚化します。選択したソフトウェアRAIDボリュームのみを監視する方法は、備わっていません。</para>
  <para><command>ledmon</command>アプリケーションでは、2種類のLEDシステム、すなわち、2LEDシステム(Activity LEDとStatus LED)と、3LEDシステム(Activity LED、Locate LED、およびFail LED)をサポートしています。このツールには、LEDへのアクセスの際に最高の優先度が与えられています。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14fbg00" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfkj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfkq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfku" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b14fbg00">
   <title>構文</title>

<screen>
ledmon [options]
</screen>

   <para><systemitem>root</systemitem>ユーザまたは<systemitem>root</systemitem>権限を持つユーザとして、コマンドを発行します。</para>
  </section>
  <section xml:id="b14fbfkj">
   <title>オプション</title>
   <variablelist>
    <varlistentry xml:id="b14fbfkk">
     <term>-c</term>
     <term>--confg=path</term>
     <listitem>
      <para>ローカルの環境設定ファイルへのパスを設定します。このオプションを指定すると、グローバルの環境設定ファイルとユーザの環境設定ファイルは、無効になります。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbfkl">
     <term>-l</term>
     <term>--log=path</term>
     <listitem>
      <para>ローカルのログファイルへのパスを設定します。このユーザ定義ファイルを指定すると、グローバルログファイル<filename>/var/log/ledmon.log</filename>は使用されません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbfkm">
     <term>-t</term>
     <term>--interval=seconds</term>
     <listitem>
      <para><filename>sysfs</filename>のスキャン間の時間間隔を設定します。値は秒単位です。最小値は5秒です。最大値の指定はありません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbfkn">
     <term>&lt;--quiet|--error|--warning|--info|--debug|--all&gt;</term>
     <listitem>
      <para>詳細レベルを指定します。このレベルオプションは、情報なしから、ほとんどの情報までの順番で指定されます。ロギングを行わない場合は、--quietオプションを使用します。すべてをログする場合は、--allオプションを使用します。2つ以上の詳細オプションを指定した場合は、コマンド内の最後のオプションが適用されます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbfko">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>コマンド情報をコンソールに印刷して、終了します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbfkp">
     <term>-v</term>
     <term>--version</term>
     <listitem>
      <para><command>ledmon</command>のバージョンとライセンスに関する情報を表示して、終了します。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="b14fbfkq">
   <title>ファイル</title>
   <variablelist>
    <varlistentry xml:id="b14fbfkr">
     <term>/var/log/ledmon.log</term>
     <listitem>
      <para>グローバルログファイルで、<command>ledmon</command>アプリケーションで使用します。ユーザ定義のファイルへのロギングを強制するには、<literal>-l</literal>オプションを使用します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbfks">
     <term>~/.ledctl</term>
     <listitem>
      <para>ユーザ環境設定ファイルで、<command>ledmon</command>とすべての<command>ledctl</command>アプリケーションインスタンス間で共有されます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbfkt">
     <term>/etc/ledcfg.conf</term>
     <listitem>
      <para>グローバル環境設定ファイルで、<command>ledmon</command>とすべての<command>ledctl</command>アプリケーションインスタンス間で共有されます。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="b14fbfku">
   <title>既知の問題</title>
   <para><command>ledmon</command>デーモンは、SFF-8489仕様のPFA (Predicted Failure Analysis)状態は認識しません。したがって、PFAパターンは視覚化されません。 </para>
  </section>
 </section>
 <section xml:id="b13jg5lj">
  <title>ストレージエンクロージャLED制御アプリケーション(ledctl(8))</title>
  <para>エンクロージャLEDアプリケーション(<command>ledctl(8)</command>)は、ストレージエンクロージャまたはドライブベイの各スロットに関連付けられたLEDを制御する、ユーザスペースアプリケーションです。<command>ledctl</command>アプリケーションは、インテルのエンクロージャLEDユーティリティの一部です。 </para>
  <para>このコマンドを発行すると、指定したデバイスのLEDが指定したパターンに設定され、それ以外のLEDはすべてオフになります。   ユーザは、このアプリケーションを使用するには、ルート権限を持っている必要があります。<command>ledmon</command>アプリケーションはLEDへのアクセスに際して最高の優先度を持っているため、<command>ledmon</command>を実行中の場合は、ledctlで設定した一部のパターンが有効にならないことがあります(Locateパターン以外)。</para>
  <para><command>ledctl</command>アプリケーションでは、2種類のLEDシステム、すなわち、2LEDシステム(Activity LEDとStatus LED)と、3LEDシステム(Activity LED、Locate LED、およびFail LED)をサポートしています。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14fbijh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbj24" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcdo6" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fck4r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fck4s" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcmzl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcrjc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b14fbijh">
   <title>構文</title>

<screen>
ledctl [options] <replaceable>pattern_name</replaceable>=list_of_devices 
</screen>

   <para><systemitem>root</systemitem>ユーザまたは<systemitem>root</systemitem>権限を持つユーザとして、コマンドを発行します。</para>
  </section>
  <section xml:id="b14fbj24">
   <title>パターン名</title>
   <para><command>ledctl</command>アプリケーションでは、SFF-8489仕様に従い、<guimenu>pattern_name</guimenu>引数に次の名前を使用できます。</para>
   <variablelist>
    <varlistentry xml:id="b14fbl2q">
     <term>locate</term>
     <listitem>
      <para>指定したデバイスまたはからのスロットに関連付けられたLocate LEDを点灯します。この状態は、スロットまたはドライブの識別に使用されます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fbxbj">
     <term>locate_off</term>
     <listitem>
      <para>指定したデバイスまたはからのスロットに関連付けられたLocate LEDを消灯します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc0mu">
     <term>normal</term>
     <listitem>
      <para>指定したデバイスに関連付けられたStatus LED、Failure LED、およびLocate LEDを消灯します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc0mv">
     <term>off</term>
     <listitem>
      <para>指定したデバイスに関連付けられたStatus LEDとFailure LEDのみを消灯します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc0mw">
     <term>ica</term>
     <term>degraded</term>
     <listitem>
      <para><literal>In a Critical Array</literal>パターンを視覚化します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc1ii">
     <term>rebuild</term>
     <term>rebuild_p</term>
     <listitem>
      <para><literal>Rebuild</literal>パターンを視覚化します。互換性とレガシーの理由から、両方のrebuild状態をサポートしています。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc1ij">
     <term>ifa</term>
     <term>failed_array</term>
     <listitem>
      <para><literal>In a Failed Array</literal>パターンを視覚化します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc1ik">
     <term>hotspare</term>
     <listitem>
      <para><literal>Hotspare</literal>パターンを視覚化します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc2n0">
     <term>pfa</term>
     <listitem>
      <para><literal>Predicted Failure Analysis</literal>パターンを視覚化します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fc2n1">
     <term>failure</term>
     <term>disk_failed</term>
     <listitem>
      <para><literal>Failure</literal>パターンを視覚化します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdno">
     <term>ses_abort</term>
     <listitem>
      <para>SES-2 R/R ABORT</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnp">
     <term>ses_rebuild</term>
     <listitem>
      <para>SES-2 REBUILD/REMAP</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnq">
     <term>ses_ifa</term>
     <listitem>
      <para>SES-2 IN FAILED ARRAY</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnr">
     <term>ses_ica</term>
     <listitem>
      <para>SES-2 IN CRITICAL ARRAY</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdns">
     <term>ses_cons_check</term>
     <listitem>
      <para>SES-2 CONS CHECK</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnt">
     <term>ses_hotspare</term>
     <listitem>
      <para>SES-2 HOTSPARE</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnu">
     <term>ses_rsvd_dev</term>
     <listitem>
      <para>SES-2 RSVD DEVICE</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnv">
     <term>ses_ok</term>
     <listitem>
      <para>SES-2 OK</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnw">
     <term>ses_ident</term>
     <listitem>
      <para>SES-2 IDENT</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnx">
     <term>ses_rm</term>
     <listitem>
      <para>SES-2 REMOVE</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdny">
     <term>ses_insert</term>
     <listitem>
      <para>SES-2 INSERT</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdnz">
     <term>ses_missing</term>
     <listitem>
      <para>SES-2 MISSING</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdo0">
     <term>ses_dnr</term>
     <listitem>
      <para>SES-2 DO NOT REMOVE</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdo1">
     <term>ses_active</term>
     <listitem>
      <para>SES-2 ACTIVE</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdo2">
     <term>ses_enable_bb</term>
     <listitem>
      <para>SES-2 ENABLE BYP B</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdo3">
     <term>ses_enable_ba</term>
     <listitem>
      <para>SES-2 ENABLE BYP A</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdo4">
     <term>ses_devoff</term>
     <listitem>
      <para>SES-2 DEVICE OFF</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcdo5">
     <term>ses_fault</term>
     <listitem>
      <para>SES-2 FAULT</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="b14fcdo6">
   <title>パターンの変換</title>
   <para>非SES-2のパターンがエンクロージャ内のデバイスに送信されると、そのパターンは、<xref linkend="b14fcdo7" xrefstyle="TableXRef"/>に示すように、SCSI Enclosure Services (SES) 2のパターンに自動的に変換されます。</para>
   <table xml:id="b14fcdo7">
    <title>非SES-2パターンとSES-2パターン間での変換</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b14fcdo8-->
       <entry>
        <para>非SES-2のパターン</para>
       </entry>
       <entry>
        <para>SES-2のパターン</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b14fcdo9-->
       <entry>
        <para>locate</para>
       </entry>
       <entry>
        <para>ses_ident</para>
       </entry>
      </row>
      <row><!--id=b14fcdoa-->
       <entry>
        <para>locate_off</para>
       </entry>
       <entry>
        <para>ses_ident</para>
       </entry>
      </row>
      <row><!--id=b14fcdob-->
       <entry>
        <para>normal</para>
       </entry>
       <entry>
        <para>ses_ok</para>
       </entry>
      </row>
      <row><!--id=b14fcdoc-->
       <entry>
        <para>off</para>
       </entry>
       <entry>
        <para>ses_ok</para>
       </entry>
      </row>
      <row><!--id=b14fcdod-->
       <entry>
        <para>ica</para>
       </entry>
       <entry>
        <para>ses_ica</para>
       </entry>
      </row>
      <row><!--id=b14fcdoe-->
       <entry>
        <para>degraded</para>
       </entry>
       <entry>
        <para>ses_ica</para>
       </entry>
      </row>
      <row><!--id=b14fcdof-->
       <entry>
        <para>rebuild</para>
       </entry>
       <entry>
        <para>ses_rebuild</para>
       </entry>
      </row>
      <row><!--id=b14fcdog-->
       <entry>
        <para>rebuild_p</para>
       </entry>
       <entry>
        <para>ses_rebuild</para>
       </entry>
      </row>
      <row><!--id=b14fcdoh-->
       <entry>
        <para>ifa</para>
       </entry>
       <entry>
        <para>ses_ifa</para>
       </entry>
      </row>
      <row><!--id=b14fcdoi-->
       <entry>
        <para>failed_array</para>
       </entry>
       <entry>
        <para>ses_ifa</para>
       </entry>
      </row>
      <row><!--id=b14fcdoj-->
       <entry>
        <para>hotspare</para>
       </entry>
       <entry>
        <para>ses_hotspare</para>
       </entry>
      </row>
      <row><!--id=b14fcdok-->
       <entry>
        <para>pfa</para>
       </entry>
       <entry>
        <para>ses_rsvd_dev</para>
       </entry>
      </row>
      <row><!--id=b14fcdol-->
       <entry>
        <para>failure</para>
       </entry>
       <entry>
        <para>ses_fault</para>
       </entry>
      </row>
      <row><!--id=b14fcdom-->
       <entry>
        <para>disk_failed</para>
       </entry>
       <entry>
        <para>ses_fault</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </section>
  <section xml:id="b14fck4r">
   <title>デバイスのリスト</title>
   <para><command>ledctl</command>コマンドを発行すると、指定したデバイスのLEDが指定したパターンに設定され、それ以外のLEDはすべてオフになります。   デバイスのリストは、次の2つの形式のいずれかで提供できます。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>スペースなしのカンマで区切られたデバイスのリスト</para>
    </listitem>
    <listitem>
     <para>デバイスがスペースで区切られた波括弧内のリスト</para>
    </listitem>
   </itemizedlist>
   <para>同じコマンド内で複数のパターンを指定すると、各パターンに対するデバイスリストで、同一または異なるフォーマットを使用できます。2つのリスト形式を示す例は、<xref linkend="b14fcrjc" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   <para>デバイスは、<filename>/dev</filename>ディレクトリまたは<filename>/sys/block</filename>ディレクトリ内のファイルへのパスです。パスにより、ブロックデバイス、MDソフトウェアRAIDデバイス、またはコンテナデバイスを識別できます。ソフトウェアRAIDデバイスまたはコンテナデバイスの場合、報告されたLEDの状態は、 関連付けられたブロックデバイスのすべてに対して設定されます。</para>
   <para>list_of_devicesにリストされているデバイスのLEDは、特定のパターンのpattern_nameに設定され、それ以外のすべてのLEDは消灯されます。 </para>
  </section>
  <section xml:id="b14fck4s">
   <title>オプション</title>
   <variablelist>
    <varlistentry xml:id="b14fck4t">
     <term>-c</term>
     <term>--confg=path</term>
     <listitem>
      <para>ローカルの環境設定ファイルへのパスを設定します。このオプションを指定すると、グローバルの環境設定ファイルとユーザの環境設定ファイルは、無効になります。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fck4u">
     <term>-l</term>
     <term>--log=path</term>
     <listitem>
      <para>ローカルのログファイルへのパスを設定します。このユーザ定義ファイルを指定すると、グローバルログファイル<filename>/var/log/ledmon.log</filename>は使用されません。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fck4v">
     <term>--quiet</term>
     <listitem>
      <para><filename>stdout</filename>または<filename>stderr</filename>に送信されるすべてのメッセージをオフにします。メッセージは、ローカルファイルおよび<filename>syslog</filename>ファシリティには引き続きログされます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fck4w">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>コマンド情報をコンソールに印刷して、終了します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fck4x">
     <term>-v</term>
     <term>--version</term>
     <listitem>
      <para><command>ledctl</command>のバージョンとライセンスに関する情報を表示して、終了します。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="b14fcmzl">
   <title>ファイル</title>
   <variablelist>
    <varlistentry xml:id="b14fcmzm">
     <term>/var/log/ledctl.log</term>
     <listitem>
      <para>グローバルログファイルで、<command>ledctl</command>アプリケーションのすべてのインスタンスで使用します。ユーザ定義のファイルへのロギングを強制するには、<literal>-l</literal>オプションを使用します。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcmzn">
     <term>~/.ledctl</term>
     <listitem>
      <para>ユーザ環境設定ファイルで、<command>ledmon</command>とすべての<command>ledctl</command>アプリケーションインスタンス間で共有されます。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="b14fcmzo">
     <term>/etc/ledcfg.conf</term>
     <listitem>
      <para>グローバル環境設定ファイルで、<command>ledmon</command>とすべての<command>ledctl</command>アプリケーションインスタンス間で共有されます。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
  <section xml:id="b14fcrjc">
   <title>例</title>
   <para>単一のブロックデバイスを見つけるには</para>

<screen>
ledctl locate=/dev/sda
</screen>

   <para>単一のブロックデバイスのLocate LEDｋを消灯するには</para>

<screen>
ledctl locate_off=/dev/sda
</screen>

   <para>MDソフトウェアRAIDデバイスのディスクを見つけて、そのブロックデバイスの2つに同時にrebuildパターンを設定するには</para>

<screen>
ledctl locate=/dev/md127 rebuild={ /sys/block/sd[a-b] }
</screen>

   <para>指定したデバイスに対するStatus LEDとFailure LEDを消灯するには</para>

<screen>
ledctl off={ /dev/sda /dev/sdb }
</screen>

   <para>3つのブロックデバイスを見つけるには</para>

<screen>
ledctl locate=/dev/sda,/dev/sdb,/dev/sdc

ledctl locate={ /dev/sda /dev/sdb /dev/sdc }
</screen>

  </section>
 </section>
 <section xml:id="b13jg5lk">
  <title>エンクロージャLEDユーティリティ設定ファイル(ledctl.conf(5))</title>
  <para><filename>ledctl.conf</filename>ファイルが、インテルエンクロージャLEDユーティリティ用の設定ファイルです。これらのユーティリティは、現時点では設定ファイルは使用しません。ファイルの名前と場所は、機能向上のために予約されています。 </para>
 </section>
 <section xml:id="b14feg6m">
  <title>追加情報</title>
  <para>LEDのパターンおよび監視ツールに関する詳細は、次のリソースを参照してください。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><link xlink:href="http://ledmon.sourceforge.net/">Sourceforge.net上のLEDMONオープンソースプロジェクト</link></para>
   </listitem>
   <listitem>
    <para><link xlink:href="ftp://ftp.seagate.com/sff/SFF-8485.PDF">SGPIO仕様SFF-8485</link></para>
   </listitem>
   <listitem>
    <para><link xlink:href="ftp://ftp.seagate.com/sff/SFF-8489.PDF">IBPI仕様SFF-8489</link></para>
   </listitem>
  </itemizedlist>
 </section>
</chapter>

<chapter xml:id="isns" xml:lang="ja" xml:base="06_isns.xml"><title>Linux用iSNS</title><info/>
 
 <para>ストレージエリアネットワーク(SAN)には、複数のネットワークにまたがる多数のディスクドライブを使用できます。これによって、デバイス検出とデバイスの所有権の判定が難しくなります。iSCSIイニシエータはSANのストレージリソースを識別し、どれにアクセスできるか判定できる必要があります。 </para>
 <para>Internet Storage Name Service (iSNS)は、TCP/IPネットワーク上のiSCSIデバイスの自動化された検出、管理、および設定を容易にする、標準ベースのサービスです。iSNSでは、ファイバチャネルネットワークと同等の知的なストレージの検出および管理のサービスを提供します。</para>
 <important>
  <para>iSNSは安全な社内ネットワークだけで使用してください。</para>
 </important>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec-isns-overview" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-iscsi-setup" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchyh0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi0bdwd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi0cewc" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchyhq" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="sec-isns-overview">
  <title>iSNSのしくみ</title>
  <para>iSCSIイニシエータがiSCSIターゲットを検出するには、ネットワークのどのデバイスがストレージリソースで、アクセスするにはどのIPアドレスが必要かを特定する必要があります。iSNSサーバへクエリすると、iSCSIターゲットとイニシエータがアクセス許可をもつIPアドレスのリストが返されます。 </para>
  <para>iSNSを使用してiSNS検出ドメインと検出ドメインセットを作成します。次に、iSCSIターゲットとイニシエータを検出ドメインにグループ化またはまとめて、検出ドメインを検出ドメインセットにグループ化します。多くのストレージノードを複数のドメインに振り分けることで、各ホストの検出プロセスをiSNSで登録された最適なターゲットのサブセットに限定でき、これによって、不要な検出を削減し、各ホストが検出関係の確立に費やす時間を制限することで、ストレージネットワークの規模を調整できるようになります。このようにして、ディスカバリ対象のターゲットとイニシエータの数を制御し、簡略化できます。 </para>
  <figure pgwide="0" xml:id="bcna0wb">
   <title>iSNS検出ドメインと検出ドメインセット</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="isns_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>iSCSIターゲットとiSCSIイニシエータは両方とも、iSNSクライアントを使用して、iSNSプロトコルによるiSNSサーバとのトランザクションを開始します。iSCSIターゲットとiSCSIイニシエータは、次にデバイス属性情報を共通検出ドメインに登録し、その他の登録されたクライアント情報をダウンロードし、検出ドメインで発生したイベントの非同期通知を受け取ります。 </para>
  <para>iSNSサーバは、iSNSプロトコルクエリとiSNSクライアントがiSNSプロトコルを使用して作成した要求に応答します。iSNSサーバはiSNSプロトコル状態変更通知を開始し、登録要求から送られてきた適切に認証された情報をiSNSデータベースに保存します。 </para>
  <para>Linux向けiSNSには、次のようなメリットがあります。 </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>ネットワーク接続させたストレージ資産の登録、検出、管理に役立つ情報を提供する。 </para>
   </listitem>
   <listitem>
    <para>DNSインフラストラクチャと統合する。 </para>
   </listitem>
   <listitem>
    <para>iSCSIストレージの登録、検出、管理を統合する。 </para>
   </listitem>
   <listitem>
    <para>ストレージ管理の実装が簡素化される。 </para>
   </listitem>
   <listitem>
    <para>その他のディスカバリ方法よりもスケーラビリティが向上する。 </para>
   </listitem>
  </itemizedlist>
  <para>次のシナリオは、iSNSのメリットについて具体的に説明したものです。 </para>
  <para>100個のiSCSIイニシエータと100個のiSCSIターゲットが会社にあるとします。設定によっては、すべてのiSCSIイニシエータが100個のiSCSIターゲットを検出して接続しようとする可能性があります。このため、検出や接続が困難になる場合があります。イニシエータとターゲットをいくつかの検出ドメインにグループ化することで、ある部門のiSCSIイニシエータが別の部門のiSCSIターゲットを検出しないようにできます。その結果、特定部門のiSCSIイニシエータは、その部門の検出ドメインに属するiSCSIターゲットしか検出しません。 </para>
 </section>
 <section xml:id="sec-iscsi-setup">
  <title>Linux用iSNSサーバのインストール</title>
  <para>SLES 10 SP2以降のバージョンには、Linux用iSCSIサーバが含まれていますが、このサーバは、デフォルトでは、インストールも設定もされません。したがって、iSNSパッケージモジュール (<filename>isns</filename>モジュールおよび<filename>yast2-isns</filename>モジュール)をインストールし、iSNSサービスを設定する必要があります。 </para>
  <note>
   <para>iSNSは、iSCSIターゲットまたはiSCSIイニシエータのソフトウェアがインストールされる同じサーバにインストールできます。ただし、iSCSIターゲットソフトウェアとiSCSIイニシエータソフトウェアの両方を同じサーバにインストールすることはできません。 </para>
  </note>
  <para>Linux向けiSNSをインストールするには、次の手順に従います。 </para>
  <procedure xml:id="bgchygw">
   <step xml:id="bgchygx">
    <para>YaSTを起動して、<guimenu/><guimenu>ネットワークサービスiSNSサーバ</guimenu>を選択します。</para>
   </step>
   <step xml:id="bi0bpeh">
    <para><filename>isns</filename>パッケージのインストールを促されたら、 <guimenu>Install（インストール）</guimenu>をクリックします。</para>
   </step>
   <step xml:id="bi0bq1e">
    <para>インストールの指示に従って、SUSE Linux Enterprise Server 11のインストールディスクを挿入します。</para>
    <para role="intro">インストールが完了すると、iSNSサービスの設定ダイアログボックスが、自動的に、<guimenu>サービス</guimenu>タブを開いた状態で表示されます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="isns_config_a.png" width="307pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="bi0bxbd">
    <para><guimenu>iSNSサーバのアドレス</guimenu>で、iSNSサーバのDNS名またはIPアドレスを指定します。</para>
   </step>
   <step xml:id="bgchygy">
    <para><guimenu>Service Start(サービスの開始)</guimenu>で、次のオプションの1つを選択します。 </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="bi0c15l">
       <title>ブート時:</title>
       <para>iSNSサービスは、サーバの起動時に自動的に開始します。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="bi0c69a">
       <title>手動(デフォルト):</title>
       <para>サービスを開始するには、iSNSのインストール先サーバのサーバコンソールで、<command>rcisns start</command>または<command>/etc/init.d/isns start</command>を入力する必要があります。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step xml:id="bi0c2ei">
    <para>次のファイアウォール設定を指定します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="bi0c69b">
       <title>Open Port in Firewall(ファイアウォールのポートを開く):</title>
       <para>このチェックボックスを選択して、ファイアウォールを開き、リモートコンピュータからサービスにアクセスできるようにします。ファイアウォールのポートは、デフォルトでは閉じています。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="bi0c69c">
       <title>ファイアウォールの詳細:</title>
       <para>ファイアウォールのポートを開いた場合、デフォルトでは、ポートがすべてのネットワークインタフェースで開きます。ポートを開くインタフェースを選択するには、<guimenu>Firewall Details(ファイアウォールの詳細)</guimenu>をクリックし、使用するネットワークインタフェースを選択し、次に、<guimenu>OK</guimenu>をクリックします。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step xml:id="bgchygz">
    <para><guimenu>完了</guimenu>をクリックして、設定を適用し、インストールを完了します。 </para>
   </step>
   <step xml:id="bi0c7d1">
    <para><xref linkend="bgchyh0" xrefstyle="SectTitleOnPage"/>に進みます。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bgchyh0">
  <title>iSNS検出ドメインの設定</title>
  <para>iSCSIイニシエータおよびターゲットでiSNSサービスを使用するには、これらが検出ドメインに属している必要があります。 </para>
  <important>
   <para>iSNS検出ドメインを設定するには、iSNSサービスがインストール済みで、実行されている必要があります。詳細については、<xref linkend="bi0bdwd" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="sec-isns-ddcreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-isns-ddscreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-isns-ddadd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-isns-ddsadd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="sec-isns-ddcreate">
   <title>iSNS検出ドメインの作成</title>
   <para>iSNSサービスをインストールすると、<guimenu>デフォルトDD</guimenu>というデフォルトの検出ドメインが自動的に作成されます。iSNSを使用するように設定されている既存のiSCSIターゲットとイニシエータは、デフォルト検出ドメインに自動的に追加されます。 </para>
   <para>新しい検出ドメインを作成するには、次の手順に従います。 </para>
   <procedure xml:id="bgchyh5">
    <step xml:id="bgchyh6">
     <para>YaSTを起動して、<guimenu>ネットワークサービス</guimenu>の下で<guimenu>iSNSサーバ</guimenu>を選択します。 </para>
    </step>
    <step xml:id="bgchyh7">
     <para><guimenu>検出ドメイン</guimenu>タブをクリックします。 </para>
     <para><guimenu>検出ドメイン</guimenu>の領域にすべての検出ドメインがリストされます。新しい検出ドメインを作成したり、既存のドメインを削除できます。ドメインを削除すると、そのドメインからメンバーが削除されますが、iSCSIノードメンバーは削除されません。</para>
     <para><guimenu>検出ドメインメンバー</guimenu>の領域に、選択した検出ドメインに割り当てられているすべてのiSCSIノードがリストされます。別の検出ドメインを選択すると、その検出ドメインからのメンバーで、リストが更新されます。選択した検出ドメインからiSCSIノード を追加したり、削除できます。iSCSIノード を削除すると、そのノードは、ドメインから削除されますが、iSCSIノード自体は削除されません。</para>
     <para>iSCSIノード を作成すると、未登録のノード を検出ドメインのメンバーとして追加できます。iSCSIイニシエータまたはiSCSIターゲットがこのノード を登録すると、このノード は、このドメインの一部となります。 </para>
     <para role="intro">iSCSIイニシエータが検出要求を発行すると、iSNSサービスは同じ検出ドメイン内のメンバーであるすべてのiSCSIノードターゲットを返します。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_discdomains_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="bi0cku8">
     <para><guimenu>検出ドメインの作成</guimenu>ボタンをクリックします。 </para>
     <para>既存の検出ドメインを選択して<guimenu>削除</guimenu>ボタンをクリックして、その検出ドメインを削除できます。 </para>
    </step>
    <step xml:id="bgchyh8">
     <para>作成している検出ドメインの名前を指定して、<guimenu>OK</guimenu>をクリックします。 </para>
    </step>
    <step xml:id="bi71u1v">
     <para><xref linkend="sec-isns-ddscreate" xrefstyle="SectTitleOnPage"/>に進みます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-isns-ddscreate">
   <title>iSNS検出ドメインセットの作成</title>
   <para>検出ドメインは検出ドメインセットに属している必要があります。検出ドメインを作成してこの検出ドメインにノードを追加できますが、これはアクティブではないため、iSNSサービスは検出ドメインを検出ドメインセットに追加するまで機能しません。iSNSをインストールすると、<guimenu>デフォルトDDS</guimenu>というデフォルトの検出ドメインセットが自動的に作成され、デフォルトの検出ドメインは自動的にこのドメインセットに追加されます。 </para>
   <para>検出ドメインセットを作成するには、次の手順に従います。 </para>
   <procedure xml:id="bgchyh9">
    <step xml:id="bgchyha">
     <para>YaSTを起動して、<guimenu>ネットワークサービス</guimenu>の下で<guimenu>iSNSサーバ</guimenu>を選択します。 </para>
    </step>
    <step xml:id="bi0cs2c">
     <para><guimenu>検出ドメインセット</guimenu>タブをクリックします。 </para>
     <para><guimenu>検出ドメインセット</guimenu>領域に、すべての検出ドメインセットがリストされます。検出ドメインをアクティブでするには、その検出ドメインを検出ドメインセットのメンバーでする必要があります。</para>
     <para>iSNSデータベースでは、検出ドメインセットは検出ドメインを包含し、検出ドメインはiSCSIノードメンバーを包含します。 </para>
     <para><guimenu>検出ドメインセットのメンバー</guimenu>領域に、選択した検出ドメインセットに割り当てられているすべての検出ドメインがリストされます。別の検出ドメインセットを選択すると、その検出ドメインセットからのメンバーで、リストが更新されます。選択した検出ドメインセットから検出ドメインを追加したり、削除できます。検出ドメインを削除すると、その検出ドメインは、検出ドメインセットから削除されますが、検出ドメイン自体は削除されません。</para>
     <para>検出ドメインをセットに追加すると、まだ登録されていないiSNS検出ドメインを、検出ドメインセットのメンバーとして追加できます。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_discdomainsets_a.png" width="422pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="bgchyhb">
     <para><guimenu>検出ドメインセットの作成</guimenu>ボタンをクリックします。 </para>
     <para>既存の検出ドメインセットを選択して<guimenu>削除</guimenu>ボタンをクリックして、その検出ドメインセットを削除できます。 </para>
    </step>
    <step xml:id="bgchyhc">
     <para>作成している検出ドメインセットの名前を指定して、<guimenu>OK</guimenu>をクリックします。</para>
    </step>
    <step xml:id="bi71u8j">
     <para><xref linkend="sec-isns-ddadd" xrefstyle="SectTitleOnPage"/>に進みます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-isns-ddadd">
   <title>iSCSIノードの検出ドメインへの追加</title>
   <procedure xml:id="bgchyhd">
    <step xml:id="bgchyhe">
     <para>YaSTを起動して、<guimenu>ネットワークサービス</guimenu>の下で<guimenu>iSNSサーバ</guimenu>を選択します。 </para>
    </step>
    <step xml:id="bi0csq8">
     <para><guimenu>iSCSIノード</guimenu>タブをクリックします。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_iscsinodes_a.png" width="422pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="bgchyhf">
     <para>ノード のリストをレビューして、iSNSサービスを使用させたい iSCSIターゲットおよびイニシエータがリストされていることを確認します。 </para>
     <para>iSCSIターゲットまたはイニシエータが一覧にない場合、ノード上のiSCSIサービスを再起動する必要があります。これは、<command>rcopen-iscsi restart</command>コマンドを実行してイニシエータを再起動するか、または<command>rciscsitarget restart</command>コマンドでターゲットを再起動して実行します。 </para>
     <para>iSCSIノードを選択して<guimenu>削除</guimenu>ボタンをクリックして、そのノードをiSNSデータベースから削除できます。iSCSIノードをもう使用しない場合や名前を変更した場合に有効です。 </para>
     <para>iSCSI環境設定ファイルのiSNSの部分を削除したりコメント化していない限り、iSCSIノードは、iSCSIサービスの再開始時またはサーバの再起動時に、リスト(iSNSデータベース)に自動的に追加されます。 </para>
    </step>
    <step xml:id="bgchyhg">
     <para><guimenu>検出ドメイン</guimenu>タブをクリックして該当する検出ドメインを選択し、<guimenu>メンバーの表示</guimenu>ボタンをクリックします。 </para>
    </step>
    <step xml:id="bgchyhh">
     <para><guimenu>Add existing iSCSI Node</guimenu>をクリックしてドメインに追加するノードを選択し、<guimenu>ノードの追加</guimenu>をクリックします。 </para>
    </step>
    <step xml:id="bgchyhi">
     <para>検出ドメインに追加するノードの数だけ<xref linkend="bgchyho" xrefstyle="StepXRef"/>を繰り返し、ノードの追加が終了したら<guimenu>完了</guimenu>をクリックします。 </para>
     <para>iSCSIノードは複数の検出ドメインに属すことができます。 </para>
    </step>
    <step xml:id="bi71uie">
     <para><xref linkend="sec-isns-ddsadd" xrefstyle="SectTitleOnPage"/>に進みます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-isns-ddsadd">
   <title>検出ドメインの検出ドメインセットへの追加</title>
   <procedure xml:id="bgchyhj">
    <step xml:id="bgchyhk">
     <para>YaSTを起動して、<guimenu>ネットワークサービス</guimenu>の下で<guimenu>iSNSサーバ</guimenu>を選択します。 </para>
    </step>
    <step xml:id="bgchyhl">
     <para><guimenu>検出ドメインセット</guimenu>タブをクリックします。 </para>
    </step>
    <step xml:id="bgchyhm">
     <para><guimenu>Create Discovery Domain Set</guimenu>を選択して、新しいセットを検出ドメインセットのリストに追加します。 </para>
    </step>
    <step xml:id="bgchyhn">
     <para>変更する検出ドメインを選択します。 </para>
    </step>
    <step xml:id="bgchyho">
     <para><guimenu>検出ドメインの追加</guimenu>をクリックして検出ドメインセットに追加する検出ドメインを選択し、<guimenu>検出ドメインの追加</guimenu>をクリックします。 </para>
    </step>
    <step xml:id="bgchyhp">
     <para>検出ドメインセットに追加する検出ドメインについて最後のステップを繰り返して、<guimenu>完了</guimenu>をクリックします。 </para>
     <para>検出ドメインは複数の検出ドメインセットに属すことができます。 </para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="bi0bdwd">
  <title>iSNSの起動</title>
  <para>iSNSは、インストール先のサーバで起動する必要があります。端末コンソールで、<systemitem>root</systemitem>ユーザとして、次のコマンドの1つを入力します。</para>

<screen>
<command>rcisns start</command> 
</screen>


<screen>
<command>/etc/init.d/isns start</command>
</screen>

  <para>iSNSでは、<command>stop</command>、<command>status</command>、<command>restart</command>の各オプションも使用できます。</para>
  <para>iSNSはサーバの再起動時に自動的に起動するように設定することもできます。 </para>
  <procedure xml:id="bgchyh1">
   <step xml:id="bgchyh2">
    <para>YaSTを起動して、<guimenu>ネットワークサービス</guimenu>の下で<guimenu>iSNSサーバ</guimenu>を選択します。 </para>
   </step>
   <step xml:id="bgchyh3">
    <para><guimenu>サービス</guimenu>タブを選択して、iSNSサーバのIPアドレスを指定して、<guimenu>SaveAddress</guimenu>を選択します。 </para>
   </step>
   <step xml:id="bgchyh4">
    <para>画面の<guimenu>サービスの開始</guimenu>セクションで、<guimenu>ブート時</guimenu>を選択します。 </para>
    <para>iSNSサーバを手動で起動することもできます。この場合、<command>rcisns start</command>コマンドを使用して、サーバを再起動するときにサービスを毎回起動する必要があります。 </para>
   </step>
  </procedure>
 </section>
 <section xml:id="bi0cewc">
  <title>iSNSの停止</title>
  <para>iSNSは、それが実行中のサーバで停止させる必要があります。端末コンソールで、<systemitem>root</systemitem>ユーザとして、次のコマンドの1つを入力します。</para>

<screen>
<command>rcisns stop</command> 
</screen>


<screen>
<command>/etc/init.d/isns stop</command> 
</screen>

 </section>
 <section xml:id="bgchyhq">
  <title>詳細情報</title>
  <para>詳細については、「<link xlink:href="http://sourceforge.net/projects/linuxisns/"><citetitle>Linux iSNS for iSCSI project</citetitle></link>」を参照してください。プロジェクトの電子メールリストは、「<link xlink:href="http://sourceforge.net/mailarchive/forum.php?forum_name=linuxisns-discussion"><citetitle>Linux iSNS - Discussion</citetitle></link>」に掲載されています。 </para>
  <para>iSNSの一般情報は、「<link xlink:href="http://www.ietf.org/rfc/rfc4171"><citetitle>RFC 4171: Internet Storage Name Service</citetitle></link>」に記載されています。 </para>
 </section>
</chapter>

<chapter xml:id="cha-inst-system-iscsi" xml:lang="ja" xml:base="06_iscsi.xml"><title>IPネットワークの大容量記憶域 - iSCSI </title><info/>
 
 <para>サーバの運用、またはコンピュータセンターの重要なタスクの1つには、サーバシステムに対してハードディスクスペースを提供することがあります。この用途には、多くの場合、ファイバチャネルが使用されます。iSCSI(Internet SCSI)ソリューションは、ファイバチャネルに対する低コストの代替であり、コモディティサーバおよびEthernetネットワーキング装置を活用することができます。Linux iSCSIは、iSCSIイニシエータおよびiSCSIターゲットのソフトウェアの提供により、Linuxサーバを中央ストレージシステムに接続します。</para>
 <figure pgwide="0" xml:id="bo1n90f">
  <title>iSNSサーバによるiSCSI SAN</title>
  <mediaobject>
   <imageobject role="fo">
   <imagedata fileref="iscsi_san_a.png" width="445pt" format="eps"/></imageobject>
   <imageobject role="html">
   <imagedata fileref="iscsi_san_a.png" width="445pt" format="png"/></imageobject>
  </mediaobject>
 </figure>
 <para>iSCSIは、ストレージネットワーキングプロトコルであり、ブロックストレージデバイスとサーバ間のTCP/IPネットワーク上でSCSIパケットのデータ転送を容易にします。iSCSIターゲットソフトウェアは、ターゲットサーバ上で実行され、論理ユニットをiSCSIターゲットデバイスとして定義します。iSCSIイニシエータソフトウェアは異なるサーバ上で実行され、ターゲットデバイスに接続して、そのサーバ上でストレージデバイスを使用できるようにします。 </para>
 <important>
  <para>iSCSIターゲットソフトウェアとiSCSIイニシエータソフトウェアを、運用環境内の同じサーバ上で実行することはできません。</para>
 </important>
 <para>iSCSIターゲットサーバおよびイニシエータサーバは、LAN内のIPレベルでSCSIパケットを送信して通信します。イニシエータサーバ上のアプリケーションがiSCSIターゲットデバイスに対する照会を開始すると、オペレーティングシステムが必要なSCSIコマンドを発行します。するとSCSIコマンドが、<emphasis>iSCSIイニシエータ</emphasis>と呼ばれるソフトウェアによってIPパケットに組み込まれ、必要に応じて暗号化されます。パケットは社内IPネットワークで、<emphasis>iSCSIターゲット</emphasis>と呼ばれるiSCSIリモートステーションに転送されます。 </para>
 <para>多くのストレージソリューションが、iSCSIによるアクセス手段を提供しています。また、LinuxサーバにiSCSIターゲットの役割をさせることもできます。この場合、Linuxサーバをファイルシステムサービス用に最適化しておくことが重要です。iSCSIターゲットはLinux内のブロックデバイスにアクセスします。したがってRAIDソリューションを使用することでディスク容量を増やし、メモリも増量してデータキャッシングを向上させることができます。RAIDの詳細については、<xref linkend="raidyast" xrefstyle="ChapTitleOnPage"/>も参照してください。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bj4rqa5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-target" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-initiator" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkrqdd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-ts" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-initiator-info" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="bj4rqa5">
  <title>iSCSIターゲットおよびイニシエータのインストール</title>
  <para>YaSTにはiSCSIターゲットとiSCSIイニシエータソフトウェアのエントリが含まれていますが、パッケージはデフォルトではインストールされません。 </para>
  <important>
   <para>iSCSIターゲットソフトウェアとiSCSIイニシエータソフトウェアを、運用環境内の同じサーバ上で実行することはできません。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bj4rsgl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bj4rrj9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bj4rsgl">
   <title>iSCSIターゲットソフトウェアのインストール</title>
   <para>iSCSIターゲットデバイスを作成したいサーバに、iSCSIターゲットソフトウェアをインストールします。</para>
   <procedure xml:id="bj4rsgm">
    <step xml:id="bj4rsgn">
     <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
    </step>
    <step xml:id="bj4rsgo">
     <para><guimenu>ネットワークサービス</guimenu><guimenu>iSCSI ターゲット</guimenu>を選択します。</para>
    </step>
    <step xml:id="bj4rsma">
     <para><filename>iscsitarget</filename>パッケージのインストールを促されたら、<guimenu>インストール</guimenu>をクリックします。</para>
    </step>
    <step xml:id="bj4rsz7">
     <para>画面上のインストール指示に従って、必要に応じてインストールメディアを提供します。</para>
     <para>インストールが完了したら、［iSCSIターゲットの概要］ページで<guimenu>サービス</guimenu>タブを選択した状態で、YaSTが開きます。</para>
    </step>
    <step xml:id="bj58wf8">
     <para><xref linkend="sec-inst-system-iscsi-target" xrefstyle="SectTitleOnPage"/>に進みます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="bj4rrj9">
   <title>iSCSIイニシエータソフトウェアのインストール</title>
   <para>iSCSIサーバ上に設定したターゲットデバイスにアクセスしたい各サーバに、iSCSIイニシエータソフトウェアをインストールします。 </para>
   <procedure xml:id="bj4rqhd">
    <step xml:id="bj4rqhe">
     <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
    </step>
    <step xml:id="bj4rqsk">
     <para><guimenu>ネットワークサービス</guimenu><guimenu>iSCSIイニシエータ</guimenu>を選択します。</para>
    </step>
    <step xml:id="bj4rsth">
     <para><filename>open-iscsi</filename>パッケージのインストールを促されたら、<guimenu>インストール</guimenu>をクリックします。</para>
    </step>
    <step xml:id="bj4rt8u">
     <para>画面上のインストール指示に従って、必要に応じてインストールメディアを提供します。</para>
     <para>インストールが完了したら、［iSCSIイニシエータの概要］ページで<guimenu>サービス</guimenu>タブを選択した状態で、YaSTが開きます。</para>
    </step>
    <step xml:id="bj4saer">
     <para><xref linkend="sec-inst-system-iscsi-initiator" xrefstyle="SectTitleOnPage"/>に進みます。</para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="sec-inst-system-iscsi-target">
  <title>iSCSIターゲットのセットアップ</title>
  <para>SUSE® Linux Enterprise Serverには、Ardis iSCSIターゲットから進化したオープンソースのiSCSIターゲットソリューションが付属しています。基本的な設定はYaSTを使って行えますが、iSCSIの機能をフル活用するには、手動で設定を行う必要があります。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bj5erpx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-target-yast" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-target-manual" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-target-ietadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bj5erpx">
   <title>ストレージスペースの準備</title>
   <para>iSCSIターゲットの設定により、既存のブロックデバイスをiSCSIイニシエータにエクスポートします。YaSTのパーティショナを使用して、またはコマンドラインからパーティション分割を行うことで、未フォーマットのパーティションやデバイスを設定し、ターゲットデバイスで使用するストレージスペースを準備する必要があります。iSCSI LIO ターゲットは、Linux、Linux LVM、またはLinux RAIDファイルシステムIDで未フォーマットのパーティションを使用できます。 </para>
   <important>
    <para>iSCSIターゲットとして使用するデバイスやパーティションを設定したら、ローカルパス経由で直接アクセスしないでください。作成時にはマウントポイントは指定しないでください。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bj5rdlu" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bj5py87" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bj5rdlu">
    <title>デバイスのパーティショニング</title>
    <procedure xml:id="bj5expw">
     <step xml:id="bj5expx">
      <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
     </step>
     <step xml:id="bj5f8l7">
      <para><guimenu>システム</guimenu><guimenu>パーティショナ</guimenu>を選択します。</para>
     </step>
     <step xml:id="bj5f902">
      <para>パーティショナの使用に関する警告に対して<guimenu>はい</guimenu>を選択して続行します。</para>
     </step>
     <step xml:id="bj5f9hl">
      <para><guimenu>追加</guimenu>をクリックしてパーティションを作成しますが、フォーマットやマウントは行いません。 </para>
      <substeps performance="required">
       <step xml:id="bj5fl5y">
        <para><guimenu>プライマリパーティション</guimenu>を選択し、<guimenu>次へ</guimenu>をクリックします。</para>
       </step>
       <step xml:id="bj5fld1">
        <para>使用する容量を指定して、<guimenu>次へ</guimenu>をクリックします。</para>
       </step>
       <step xml:id="bj5flp9">
        <para><guimenu>フォーマットしない</guimenu>を選択し、ファイルシステムIDの種類を指定します。</para>
        <para>iSCSIターゲットは、Linux、Linux LVM、またはLinux RAIDファイルシステムIDで未フォーマットのパーティションを使用できます。</para>
       </step>
       <step xml:id="bj5flz6">
        <para><guimenu>マウントしない</guimenu>を選択します。</para>
       </step>
       <step xml:id="bj5fm1h">
        <para><guimenu>完了</guimenu>をクリックします。</para>
       </step>
      </substeps>
     </step>
     <step xml:id="bj5fjxr">
      <para>後でiSCSI LUNとして使用したい各エリアに対して、<xref linkend="bj5f9hl" xrefstyle="StepXRef"/>を繰り返し実行します。</para>
     </step>
     <step xml:id="bj5fm9v">
      <para><guimenu>受諾</guimenu>をクリックして変更を保存し、YaSTを閉じます。</para>
     </step>
    </procedure>
   </section>
   <section xml:id="bj5py87">
    <title>仮想環境でのデバイスのパーティション分割</title>
    <para>XenゲストサーバをiSCSIターゲットサーバとして使用することができます。iSCSIストレージデバイスに使用するストレージスペースをゲストの仮想マシンに割り当て、ゲスト環境内の仮想ディスクとしてそのスペースにアクセスします。各仮想ディスクは、ディスク全体、パーティション、ボリュームなどの物理ブロックデバイスでも、Xenホストサーバ上の大規模な物理ディスク上の単一イメージファイルが仮想ディスクになっている、ファイルバックディスクイメージのいずれでも可能です。最適なパフォーマンスを得るためには、物理ディスクまたはパーティションから各仮想ディスクを作成してください。ゲストの仮想マシンに仮想ディスクを設定したら、ゲストサーバを起動し、物理サーバの場合と同じ方法で、新しいブランクの仮想ディスクをiSCSIターゲットデバイスとして設定します。 </para>
    <para>ファイルバックディスクイメージがXenホストサーバ上に作成され、Xenゲストサーバに割り当てられます。デフォルトでは、Xenはファイルバックディスクイメージを<filename>/var/lib/xen/images/<replaceable>vm_name</replaceable></filename>ディレクトリに保存します。ここで<filename><replaceable>vm_name</replaceable></filename>は仮想マシンの名前です。</para>
    <para>たとえば、サイズが4GBの<filename>/var/lib/xen/images/vm_one/xen--0</filename>ディスクイメージを作成する場合は、まず、ディレクトリが存在することを確認し、次に、イメージ自体を作成します。</para>
    <procedure xml:id="bj5q7wn">
     <step xml:id="bj5q7wo">
      <para>ホストサーバに<systemitem>root</systemitem>ユーザとしてログインします。</para>
     </step>
     <step xml:id="bj5q4xg">
      <para>端末コンソールプロンプトで次のコマンドを入力します。</para>

<screen>
mkdir -p /var/lib/xen/images/vm_one
dd if=/dev/zero of=/var/lib/xen/images/vm_one/xen-0 seek=1M bs=4096 count=1
</screen>

     </step>
     <step xml:id="bj5q56y">
      <para>Xen設定ファイルで、ファイルシステムイメージをゲスト仮想マシンに割り当てます。</para>
     </step>
     <step xml:id="bj5q81p">
      <para>ゲストサーバに<systemitem>root</systemitem>ユーザとしてログインし、YaSTを使用して<xref linkend="bj5rdlu" xrefstyle="HeadingOnPage"/>の手順で仮想ブロックデバイスを設定します。</para>
     </step>
    </procedure>
   </section>
  </section>
  <section xml:id="sec-inst-system-iscsi-target-yast">
   <title>YaSTを使ったiSCSIターゲットの作成</title>
   <para>
    iSCSIターゲットを設定するには、YaSTの<guimenu>iSCSIターゲット</guimenu>モジュールを起動します(コマンド<command>yast2 iscsi-server</command>)。設定項目は、3つのタブに分かれています。<guimenu>Service</guimenu>タブでは、実行モードとファイアウォールの設定を行います。リモートコンピュータからiSCSIターゲットにアクセスする場合は、<guimenu>ファイアウォールでポートを開く</guimenu>を選択します。iSNSサーバが検出およびアクセス制御を管理する場合は、<guimenu>iSNSアクセス管理</guimenu>を有効にして、iSNSサーバのIPアドレスを入力します。ホスト名やDNSは使用できません。IPアドレスを使用する必要があります。 iSNSの詳細は、<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>を参照してください。
   </para>
   <para>
    <guimenu>Global</guimenu>タブでは、iSCSIサーバの設定を行います。ここで設定する認証方法は、サービスの検出に使用します。ターゲットにアクセスする場合のものではありません。ディスカバリへのアクセスを制限しない場合は、<guimenu>No Authentication</guimenu>を選択します。
   </para>
   <para>
    認証が必要な場合、2つの検討事項があります。<guimenu/>「incoming認証」では、イニシエータに、iSCSIターゲット上でディスカバリを実行するパーミッションがあることを証明するよう求めます。<guimenu/>「outgoing認証」では、iSCSIターゲットに、自らが目的のターゲットであることを証明するよう求めます。そのため、iSCSIターゲットもユーザ名とパスワードを使用できます。認証の詳細は、<link xlink:href="http://www.ietf.org/rfc/rfc3720.txt"><citetitle>RFC 3720</citetitle></link>を参照してください。
   </para>
   <para>
    ターゲットは、<guimenu>Targets</guimenu>タブで定義します。新しいiSCSIターゲットを作成するには、<guimenu>追加</guimenu>をクリックします。最初のダイアログボックスでは、エクスポートするデバイスに関する情報を指定します。 </para>
   <variablelist>
    <varlistentry xml:id="bgchy7j">
     <term>ターゲット</term>
     <listitem>
      <para role="intro"><guimenu>Target</guimenu>行には、以下のような固定形式の構文を指定します。 </para>

<screen>
iqn.yyyy-mm.&lt;reversed domain name&gt;:<replaceable>unique_id</replaceable>
</screen>

      <para>この行は常に「iqn」から始まります。「yyyy-mm」の部分には、このターゲットをアクティブにする日付を指定します。命名規則の詳細については、<link xlink:href="http://www.ietf.org/rfc/rfc3722.txt"><citetitle>RFC 3722</citetitle></link>を参照してください。</para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bgchy7k">
     <term>Identifier</term>
     <listitem>
      <para><guimenu>Identifier</guimenu>は、自由に指定することができます。ただし、システムを体系的に管理するためにも、一定のスキーマを使用するようにしてください。 </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bgchy7l">
     <term>LUN</term>
     <listitem>
      <para>ターゲットに複数のLUNを割り当てることができます。そのためには、<guimenu>ターゲット</guimenu>タブでターゲットを選択し、<guimenu>編集</guimenu>をクリックします。次に、既存ターゲットに新しいLUNを追加します。 </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="bgchy7m">
     <term>パス</term>
     <listitem>
      <para>エクスポートするブロックデバイス、またはファイルシステムイメージのパスを追加します。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>次のメニューでは、ターゲットへのアクセス制限を設定します。ここの設定は、ディスカバリの認証設定とほとんど変わりありません。この場合、少なくとも着信認証を設定する必要があります。 </para>
   <para>新しいターゲットの設定を完了するには、<guimenu>次へ</guimenu>をクリックします。<guimenu>Target</guimenu>タブの概要ページが表示されます。変更内容を有効にするには、<guimenu>完了</guimenu>をクリックします。</para>
   <para>ターゲットデバイスを作成するには:</para>
   <procedure xml:id="bj5fomq">
    <step xml:id="bj5fomr">
     <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
    </step>
    <step xml:id="bj5foms">
     <para><guimenu>ネットワークサービス</guimenu><guimenu>iSCSI ターゲット</guimenu>を選択します。</para>
     <para role="intro">［iSCSIターゲットの概要］ページで<guimenu>サービス</guimenu>タブを選択した状態で、YaSTが開きます。.</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="iscsi_target_service_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="bj5fomv">
     <para><guimenu>サービスの開始</guimenu>領域で、次のいずれかを選択します。</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara xml:id="bj5fomw">
        <title>起動時:</title>
        <para>その後の再起動時には、イニシエータサービスが自動的に開始します。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara xml:id="bj5fomx">
        <title> 手動(デフォルト):</title>
        <para>サービスを手動で開始します。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </step>
    <step xml:id="bj5fomy">
     <para>ターゲットアドバタイジングにiSNSを使用する場合は、<guimenu>iSNSアクセス制御</guimenu>チェックボックスを選択し、IPアドレスを入力します。</para>
    </step>
    <step xml:id="bj5fydf">
     <para>必要に応じて、ファイアウォールポートを開き、リモートコンピュータからサーバへのアクセスを許可します。</para>
     <substeps performance="required">
      <step xml:id="bj5fomz">
       <para><guimenu>ファイアウォールでポートを開く</guimenu>チェックボックスを選択します。</para>
      </step>
      <step xml:id="bj5fon0">
       <para><guimenu>ファイアウォールの詳細</guimenu>をクリックして、ポートを開くネットワークインタフェースを指定し、ネットワークインタフェースの横のチェックボックスをオンにして有効にし、<guimenu>OK</guimenu>をクリックして設定を受け入れます。</para>
      </step>
     </substeps>
    </step>
    <step xml:id="bj5fon1">
     <para>このサーバで設定したターゲットデバイスへの接続に認証が必要な場合は、<guimenu>グローバル</guimenu>タブを選択し、<guimenu>認証なし</guimenu>の選択を解除して、送受信の認証に必要な資格情報を指定します。</para>
     <para role="intro">デフォルトでは<guimenu>認証なし</guimenu>のオプションが有効になっています。設定をより安全にするには、着信、発信、または着信と発信の両方に認証を指定できます。ユーザ名とパスワードのペアを<guimenu>受信認証</guimenu>の一覧に追加することで、受信認証の資格情報を複数セット指定することもできます。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="iscsi_target_global_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="bj5fon2">
     <para>iSCSIターゲットデバイスを指定します。</para>
     <substeps performance="required">
      <step xml:id="bj5fon3">
       <para><guimenu>ターゲット</guimenu>タブを選択します。</para>
      </step>
      <step xml:id="bj5fzxo">
       <para>まだそうしていない場合は、一覧からサンプルのiSCSIターゲットを選択して削除し、<guimenu>続ける</guimenu>をクリックして削除を確認します。</para>
      </step>
      <step xml:id="bj5fon4">
       <para><guimenu>追加</guimenu>をクリックして、新しいiSCSIターゲットを追加します。</para>
       <para>iSCSIターゲットによって自動的に未フォーマットのパーティションやブロックデバイスが提示され、［ターゲット］および［イニシエータ］フィールドに情報が入力されます。 </para>
      </step>
      <step xml:id="bj5g2b7">
       <para>これを受諾することも、別なスペースを選択することもできます。 </para>
       <para><guimenu>追加</guimenu>をクリックして、そのLUNに割り当てるセクタを指定することで、スペースをさらに分割して、デバイス上にLUNを作成することもできます。これらのLUNに追加のオプションが必要な場合は、<guimenu>エキスパート設定</guimenu>を選択します。</para>
      </step>
      <step xml:id="bj5g2n0">
       <para>Click <guimenu>Next</guimenu></para>
      </step>
      <step xml:id="bj5g45h">
       <para>作成する各iSCSIターゲットデバイスに対して、<xref linkend="bj5fon4" xrefstyle="StepXRef"/>から<xref linkend="bj5g2n0" xrefstyle="StepXRef"/>を繰り返し実行します。</para>
      </step>
      <step xml:id="bojud2n">
       <para>(オプション)<guimenu>サービス</guimenu>タブで<guimenu>保存</guimenu>をクリックして、設定したiSCSIターゲットの情報をファイルにエクスポートします。</para>
       <para>こうしておくと、後でこの情報をリソースの利用者に簡単に提供することができます。</para>
      </step>
      <step xml:id="bj5fon5">
       <para><guimenu>完了</guimenu>をクリックしてデバイスを作成し、<guimenu>はい</guimenu>をクリックしてiSCSIソフトウェアスタックをリスタートします。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-inst-system-iscsi-target-manual">
   <title>iSCSIターゲットの手動設定</title>
   <para>iSCSIターゲットを設定するには、<filename>/etc/ietd.conf</filename>を編集します。このファイル中の、最初の<emphasis>Target</emphasis>宣言より前にあるすべてのパラメータは、ファイルのグローバルパラメータになります。この部分にある認証情報は、グローバルパラメータではありません。iSCSIターゲットの検出に用いられます。 </para>
   <para>iSNSサーバにアクセスできる場合は、まず、ファイルを、このサーバについてターゲットに通知するように設定する必要があります。iSNSサーバのアドレスは、必ず、IPアドレスで指定する必要があります。iSNSサーバのDNS名を指定することはできません。この機能の設定は、次のようになります。 </para>

<screen>
iSNSServer 192.168.1.111
iSNSAccessControl no
</screen>

   <para>この設定では、iSCSIターゲットが<literal>iSNS</literal>サーバでそれ自体を登録し、ディスカバリのイニシエータとなります。iSNSの詳細は、<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>を参照してください。iSNSディスカバリのためのアクセス制御はサポートされていません。<literal>［iSNSアクセス管理］を［いいえ］</literal>のままにします。 </para>
   <para>すべての直接iSCSI認証は、双方向で行うことができます。iSCSIターゲットがiSCSIイニシエータに認証を要求するには、<option>IncomingUser</option>を使用します。このオプションは、複数回追加できます。iSCSIイニシエータも、iSCSIターゲットに認証を要求することができます。この場合は、<option>OutgoingUser</option>を使用します。どちらの場合も、構文は同じです。 </para>

<screen>
IncomingUser &lt;username&gt; &lt;password&gt;
OutgoingUser &lt;username&gt; &lt;password&gt;
</screen>

   <para>認証後は、1つまたは複数のターゲット定義を指定します。定義する各ターゲットについて、<literal>Target</literal>セクションを追加します。このセクションは、常に<literal>Target</literal>識別子で始まり、その後に論理ユニット番号の定義が続きます。 </para>

<screen>
Target iqn.yyyy-mm.&lt;reversed domain name&gt;[:identifier]
          Lun 0 Path=/dev/mapper/system-v3
          Lun 1 Path=/dev/hda4
          Lun 2 Path=/var/lib/xen/images/xen-1,Type=fileio
</screen>

   <para><literal>Target</literal>行では、<literal>yyyy-mm</literal>にターゲットを有効にする日付を指定し、<literal>identifier</literal>に任意の識別子を指定できます。命名規則の詳細については、<link xlink:href="http://www.ietf.org/rfc/rfc3722.txt"><citetitle>RFC 3722</citetitle></link>を参照してください。この例では、3つの異なるブロックデバイスをエクスポートしています。最初のブロックデバイスは論理ボリューム(<xref linkend="lvm" xrefstyle="ChapTitleOnPage"/>も参照)、2番目はIDEパーティション、3番目はローカルファイルシステムで使用可能なイメージです。これらはすべてiSCSIイニシエータへのブロックデバイスのようになります。 </para>
   <para>iSCSIターゲットを有効にする前に、<option>Lun</option>定義の後に、最低1つの<option>IncomingUser</option>を追加してください。このパラメータは、このターゲットの使用に対する認証を指定します。 </para>
   <para>変更内容を有効にするには、<command>rcopen-iscsi</command> <option>restart</option>コマンドを実行して、iscsitargetデーモンを再起動します。<filename>/proc</filename>ファイルシステムで、設定内容を確認してください。 </para>

<screen>
cat /proc/net/iet/volume
tid:1 name:iqn.2006-02.com.example.iserv:systems
        lun:0 state:0 iotype:fileio path:/dev/mapper/system-v3
        lun:1 state:0 iotype:fileio path:/dev/hda4
        lun:2 state:0 iotype:fileio path:/var/lib/xen/images/xen-1
</screen>

   <para>ここで説明しているほかにも、iSCSIターゲットの動作を制御するさまざまなオプションがあります。詳細については、<filename>ietd.conf</filename>のマニュアルページを参照してください。 </para>
   <para>/proc<filename>ファイルシステムには、アクティブなセッションも表示されます。</filename>接続されている各イニシエータに対応するエントリが、<filename>/proc/net/iet/session</filename>に追加されます。 </para>

<screen>
cat /proc/net/iet/session
tid:1 name:iqn.2006-02.com.example.iserv:system-v3
   sid:562949957419520 initiator:iqn.2005-11.de.suse:cn=rome.example.com,01.9ff842f5645
      cid:0 ip:192.168.178.42 state:active hd:none dd:none
   sid:281474980708864 initiator:iqn.2006-02.de.suse:01.6f7259c88b70
      cid:0 ip:192.168.178.72 state:active hd:none dd:none
</screen>

  </section>
  <section xml:id="sec-inst-system-iscsi-target-ietadm">
   <title>ietadmを使ったオンラインターゲットの設定</title>
   <para>iSCSIターゲットの設定の変更が必要な場合は、必ず、ターゲットを再起動して、設定ファイルで行った変更を有効にする必要があります。ただし、この作業を行うと、アクティブなセッションがすべて中断されます。この問題を回避するには、環境設定ファイルの<filename>/etc/ietd.conf</filename>を変更すると同時に、ietadm管理ユーティリティを使って現在の設定も変更してください。 </para>
   <para>LUNを指定した新しいiSCSIターゲットを作成するには、まず設定ファイルを更新します。追加するエントリの例を以下に示します。 </para>

<screen>
Target iqn.2006-02.com.example.iserv:system2
          Lun 0 Path=/dev/mapper/system-swap2
          IncomingUser joe secret
</screen>

   <para>この設定を手動で行うには、次の手順に従ってください。 </para>
   <procedure xml:id="bgchy7n">
    <step xml:id="bgchy7o">
     <para><command>ietadm --op new --tid=2 --params Name=iqn.2006-02.com.example.iserv:system2</command>コマンドを実行して、新しいターゲットを作成します。 </para>
    </step>
    <step xml:id="bgchy7p">
     <para><command>ietadm --op new --tid=2 --lun=0 --params Path=/dev/mapper/system-swap2</command>コマンドを実行して、LUNを追加します。 </para>
    </step>
    <step xml:id="bgchy7q">
     <para><command>ietadm --op new --tid=2 --user --params=IncomingUser=joe,Password=secret</command>コマンドを実行して、このターゲットにユーザ名とパスワードを設定します。 </para>
    </step>
    <step xml:id="bgchy7r">
     <para><command>cat /proc/net/iet/volume</command>コマンドを実行して、設定内容を確認します。 </para>
    </step>
   </procedure>
   <para>アクティブな接続を削除することもできます。まず、<command>cat /proc/net/iet/session</command>コマンドを実行して、アクティブな接続を表示します。たとえば、次のように表示されます。 </para>

<screen>
cat /proc/net/iet/session
tid:1 name:iqn.2006-03.com.example.iserv:system
        sid:281474980708864 initiator:iqn.1996-04.com.example:01.82725735af5
                cid:0 ip:192.168.178.72 state:active hd:none dd:none
</screen>

   <para>セッションIDが 281474980708864のセッションを削除する場合は、<command>ietadm --op delete --tid=1 --sid=281474980708864 --cid=0</command>コマンドを実行します。このコマンドを実行すると、クライアントシステムからデバイスにアクセスできなくなるため、このデバイスにアクセスしているデバイスがハングアップする可能性があることに注意してください。 </para>
   <para>ietadmを使って、さまざまな環境設定パラメータを変更することもできます。グローバル変数を一覧表示する場合は、<command>ietadm --op show --tid=1 --sid=0</command>コマンドを実行します。次のような実行結果が表示されます。 </para>

<screen>
InitialR2T=Yes
ImmediateData=Yes
MaxConnections=1
MaxRecvDataSegmentLength=8192
MaxXmitDataSegmentLength=8192
MaxBurstLength=262144
FirstBurstLength=65536
DefaultTime2Wait=2
DefaultTime2Retain=20
MaxOutstandingR2T=1
DataPDUInOrder=Yes
DataSequenceInOrder=Yes
ErrorRecoveryLevel=0
HeaderDigest=None
DataDigest=None
OFMarker=No
IFMarker=No
OFMarkInt=Reject
IFMarkInt=Reject
</screen>

   <para>これらのパラメータは、すべて容易に変更できます。たとえば、最大接続数を2に変更する場合は、=2を実行します。</para>

<screen>
ietadm --op update --tid=1 --params=MaxConnections=2. 
</screen>

   <para><filename>/etc/ietd.conf</filename>ファイルでは、このパラメータに対応する行が<option>MaxConnections 2</option>のように指定されています。 </para>
   <warning>
    <para><command>ietadm</command>ユーティリティによる変更は、システムに対して永久的なものではありません。これらの変更は、<filename>/etc/ietd.conf</filename>環境設定ファイルに追加しない限り、次の再起動で失われます。ネットワークでのiSCSIの利用方法によっては、これによって重大な問題が発生する可能性があります。 </para>
   </warning>
   <para><command>ietadm</command>ユーティリティには、他にも使用可能なオプションがあります。<command>ietadm -h</command>を使用して、概要をつかんでください。また、省略形も利用できます。省略形には、ターゲットID (tid)、セッションID (sid)、および接続ID (cid)などがあります。これらの情報は、<filename>/proc/net/iet/session</filename>にもあります。 </para>
  </section>
 </section>
 <section xml:id="sec-inst-system-iscsi-initiator">
  <title>iSCSIイニシエータの設定</title>
  <para>任意のiSCSIターゲットに接続するには、iSCSIイニシエータ(iSCSIクライアントとも呼ぶ)を使用できます。これは、<xref linkend="sec-inst-system-iscsi-target" xrefstyle="SectTitleOnPage"/>で説明されているターゲットソリューションだけに限りません。iSCSIイニシエータの設定には、利用可能なiSCSIターゲットの検出と、iSCSIセッションの設定という2つの主要ステップがあります。どちらの設定も、YaSTを使って行うことができます。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-initiator-yast" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-initiator-manual" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-iscsi-database" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="sec-inst-system-iscsi-initiator-yast">
   <title>YaSTを使ったiSCSIイニシエータの設定</title>
   <para>YaSTの［iSCSIイニシエータの概要］が3つのタブに分割されます。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <formalpara xml:id="bkob6lr">
      <title>サービス:</title>
      <para><guimenu>サービス</guimenu>タブでは、ブート時にiSCSIイニシエータを有効にできます。固有の<guimenu>イニシエータ名</guimenu>とディスカバリに使用するiSNSサーバも設定できます。iSNSのデフォルトポートは3205です。 </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara xml:id="bkob6ls">
      <title>接続したターゲット:</title>
      <para><guimenu>Connected Targets</guimenu>タブには、現在接続しているiSCSIターゲットの概要が表示されます。このタブにも、<guimenu>検出されたターゲット</guimenu>タブのように、システムに新しいターゲットを追加するオプションが用意されています。 </para>
     </formalpara>
     <para>このページでは、ターゲットデバイスを選択して、各iSCSIターゲットデバイスの起動時の設定を切り替えることができます。</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara xml:id="bkob6lt">
        <title>自動:</title>
        <para>このオプションは、iSCSIサービス自体の起動時に接続するiSCSIターゲットに使用されます。これが通常の設定です。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara xml:id="bkob6lu">
        <title>Onboot(起動時):</title>
        <para>このオプションは、起動時、つまりルート(<filename>/</filename>)がiSCSI上にある場合に接続するiSCSIターゲットに使用します。したがって、iSCSIターゲットデバイスはサーバの起動時にinitrdによって評価されます。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </listitem>
    <listitem>
     <formalpara xml:id="bkob6lv">
      <title>検出されたターゲット:</title>
      <para><guimenu>検出されたターゲット</guimenu>では、ネットワーク内のiSCSIターゲットを手動で検出することができます。 </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bkob990" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkobick" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkob8pj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkob9pj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bkob990">
    <title>iSCSIイニシエータの設定</title>
    <procedure xml:id="bj5fon6">
     <step xml:id="bj5fon7">
      <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
     </step>
     <step xml:id="bj5fon8">
      <para><guimenu>ネットワークサービス</guimenu><guimenu>iSCSIイニシエータ</guimenu>の順に選択します(<command>yast2 iscsi-client</command>も使用できます)。</para>
      <para role="intro">［iSCSIイニシエータの概要］ページで<guimenu>サービス</guimenu>タブが選択された状態で、YaSTが開きます。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="iscsi_init_service_a.png" width="307pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step xml:id="bj5fonb">
      <para><guimenu>サービスの開始</guimenu>領域で、次のいずれかを選択します。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara xml:id="bj5fonc">
         <title>起動時:</title>
         <para>その後の再起動時には、イニシエータサービスが自動的に開始します。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara xml:id="bj5fond">
         <title> 手動(デフォルト):</title>
         <para>サービスを手動で開始します。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step xml:id="bj5fone">
      <para><guimenu>イニシエータ名</guimenu>を指定、または確認します。</para>
      <para>このサーバ上のiSCSIイニシエータに、正しい形式のiSCSI修飾名(IQN)を指定します。イニシエータ名はネットワーク全体で固有のものでなければなりません。IQNは次の一般的なフォーマットを使用します。</para>

<screen>
iqn.yyyy-mm.com.mycompany:n1:n2
</screen>

      <para>ここでn1とn2はアルファベットか数字です。次に例を示します。</para>

<screen>
iqn.1996-04.de.suse:01:9c83a3e15f64
</screen>

      <para><guimenu>イニシエータ名</guimenu>には、サーバ上の<filename>/etc/iscsi/initiatorname.iscsi</filename>ファイルから対応する値が自動的に入力されます。</para>
      <para>
       サーバがiBFT(iSCSI Boot Firmware Table)をサポートしている場合は、<guimenu>イニシエータ名</guimenu>にはIBFT内の対応する値が入力され、このインタフェースではイニシエータ名を変更できません。代わりにBIOSセットアップを使用して変更してください。iBFTは、サーバのiSCSIターゲットとイニシエータの説明を含む、iSCSIの起動プロセスに便利な各パラメータを含んだ情報ブロックです。</para>
     </step>
     <step xml:id="bj5fonf">
      <para>次のいずれかの方法を使用して、ネットワーク上のiSCSIターゲットを検出します。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara xml:id="bj5fong">
         <title>iSNS:</title>
         <para>iSNS (Internet Storage Name Service)を使用してiSCSIターゲットを検出するには、続いて<xref linkend="bkobick" xrefstyle="HeadingOnPage"/>を実行します。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara xml:id="bj5fonh">
         <title>検出されたターゲット:</title>
         <para>iSCSIターゲットデバイスを手動で検出するには、続いて<xref linkend="bkob8pj" xrefstyle="HeadingOnPage"/>を実行します。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
    </procedure>
   </section>
   <section xml:id="bkobick">
    <title>iSNSによるiSCSIターゲットの検出</title>
    <para>このオプションを使用する前に、ご使用の環境内でiSNSサーバをインストールし、設定しておく必要があります。詳細については、<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>を参照してください。</para>
    <procedure xml:id="bkobiky">
     <step xml:id="bkobikz">
      <para>YaSTで<guimenu>iSCSIイニシエータ</guimenu>を選択し、次に<guimenu>サービス</guimenu>タブを選択します。 </para>
     </step>
     <step xml:id="bkobjno">
      <para>iSNSサーバのIPアドレスとポートを指定します。 </para>
      <para>デフォルトのポートは3205です。</para>
     </step>
     <step xml:id="bkobl8n">
      <para>［iSCSIイニシエータの概要］ページで、<guimenu>完了</guimenu>をクリックして変更内容を保存、および適用します。</para>
     </step>
    </procedure>
   </section>
   <section xml:id="bkob8pj">
    <title>iSCSIターゲットの手動検出</title>
    <para>iSCSIイニシエータを設定しているサーバからアクセスする各iSCSIターゲットサーバについて、次の手順を繰り返し実行します。</para>
    <procedure xml:id="bgchy7s">
     <step xml:id="bgchy7t">
      <para>YaSTで<guimenu>iSCSIイニシエータ</guimenu>を選択し、次に<guimenu>検出されたターゲット</guimenu>タブを選択します。 </para>
     </step>
     <step xml:id="bkobfda">
      <para><guimenu>検出</guimenu>をクリックして［iSCSIイニシエータの検出］ダイアログボックスを開きます。 </para>
     </step>
     <step xml:id="bgchy7u">
      <para>IPアドレスを入力し、必要に応じてポートを変更します。IPv6アドレスはサポートされています。</para>
      <para>デフォルトポートは3260です。</para>
     </step>
     <step xml:id="bgchy7v">
      <para>認証が必要な場合は、<guimenu>認証なし</guimenu>の選択を解除して、<guimenu>受信</guimenu>または<guimenu>送信</guimenu>認証用の資格情報を指定します。 </para>
     </step>
     <step xml:id="bgchy7w">
      <para><guimenu>次へ</guimenu>をクリックして、検出を開始し、iSCSIターゲットサーバに接続します。</para>
     </step>
     <step xml:id="bi728ck">
      <para>資格情報が必要な場合は、検出成功後、<guimenu>ログイン</guimenu>を使用してターゲットを有効化します。 </para>
      <para>指定したiSCSIターゲットを使用するための、認証資格情報の提供を促されます。 </para>
     </step>
     <step xml:id="bi727ln">
      <para><guimenu>次へ</guimenu>をクリックして、設定を完了します </para>
      <para>作業が正常に完了すると、<guimenu>Connected Targets</guimenu>にターゲットが表示されます。 </para>
      <para>これで、仮想iSCSIデバイスを利用できるようになりました。 </para>
     </step>
     <step xml:id="bkobeht">
      <para>［iSCSIイニシエータの概要］ページで、<guimenu>完了</guimenu>をクリックして変更内容を保存、および適用します。</para>
     </step>
     <step xml:id="bi728cl">
      <para><command>lsscsi</command>コマンドを使用すると、iSCSIターゲットデバイスのローカルデバイスパスを検出することができます。</para>

<screen>
lsscsi
[1:0:0:0]   disk    IET      VIRTUAL-DISK     0     /dev/sda
</screen>

     </step>
    </procedure>
   </section>
   <section xml:id="bkob9pj">
    <title>iSCSIターゲットデバイスの起動設定</title>
    <procedure xml:id="bkobg1r">
     <step xml:id="bkobg1s">
      <para>YaSTで、<guimenu>iSCSIイニシエータ</guimenu>を選択し、次に<guimenu>接続したターゲット</guimenu>タブを選択して、現在サーバに接続されているiSCSIターゲットデバイスの一覧を表示することができます。 </para>
     </step>
     <step xml:id="bkobg1t">
      <para>管理するiSCSIターゲットデバイスを選択します。 </para>
     </step>
     <step xml:id="bkobg1u">
      <para><guimenu>起動の切り替え</guimenu>をクリックして設定を変更します。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara xml:id="bkobg1v">
         <title>自動:</title>
         <para>このオプションは、iSCSIサービス自体の起動時に接続するiSCSIターゲットに使用されます。これが通常の設定です。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara xml:id="bkobg1w">
         <title>Onboot(起動時):</title>
         <para>このオプションは、起動時、つまりルート(<filename>/</filename>)がiSCSI上にある場合に接続するiSCSIターゲットに使用します。したがって、iSCSIターゲットデバイスはサーバの起動時にinitrdによって評価されます。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step xml:id="bkobg1x">
      <para><guimenu>完了</guimenu>をクリックして、変更を保存、および適用します。 </para>
     </step>
    </procedure>
   </section>
  </section>
  <section xml:id="sec-inst-system-iscsi-initiator-manual">
   <title>手動によるiSCSIイニシエータの設定</title>
   <para>iSCSI接続の検出や設定を行うには、iscsidが稼働していなければなりません。初めて検出(ディスカバリ)を実行する場合、iSCSIイニシエータの内部データベースが、<filename>/var/lib/open-iscsi</filename>ディレクトリに作成されます。 </para>
   <para>ディスカバリがパスワードにより保護されている場合は、iscsidに認証情報を渡します。最初にディスカバリを実行する時には内部データベースが存在していないため、現時点でこれは使用できません。かわりに、<filename>/etc/iscsid.conf</filename>設定ファイルを編集して、情報を指定する必要があります。パスワード情報をiscsidに渡すには、<filename>/etc/iscsid.conf</filename>ファイルの最後に、次の行を追加します。 </para>

<screen>
discovery.sendtargets.auth.authmethod = CHAP
discovery.sendtargets.auth.username = &lt;username&gt;
discovery.sendtargets.auth.password = &lt;password&gt;
</screen>

   <para>ディスカバリは、受け取ったすべての値を内部データベースに保存します。また、検出したターゲットをすべて表示します。次のコマンドで、このディスカバリを実行します。  </para>

<screen>
iscsiadm <option>-m discovery --type=st --portal=&lt;targetip&gt;</option>
</screen>

   <para>次のように出力されます。 </para>

<screen>
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems
</screen>

   <para><literal>iSNS</literal>サーバで使用できるターゲットを検出するには、次のコマンドを使用します。</para>

<screen>
iscsiadm --mode discovery --type isns --portal &lt;targetip&gt; 
</screen>

   <para>iSCSIターゲットに定義されている各ターゲットが、それぞれ1行に表示されます。保存されたデータの詳細については、<xref linkend="sec-iscsi-database" xrefstyle="SectTitleOnPage"/>を参照してください。 </para>
   <para>iscsiadm<command>コマンドの</command> <option>--login</option>オプションを使用すると、必要なすべてのデバイスが作成されます。 </para>

<screen>
iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems --login
</screen>

   <para>lsscsi<command>コマンドを実行すると、新しく生成されたデバイスが表示されます。これらのデバイスをマウントして、アクセスできるようになりました。</command> </para>
  </section>
  <section xml:id="sec-iscsi-database">
   <title>iSCSIクライアントデータベース</title>
   <para>iSCSIイニシエータが検出した情報は、<filename>/var/lib/open-iscsi</filename>に格納されている2つのデータベースファイルに保管されます。1つは、ディスカバリが検出したターゲット用のデータベースで、もう1つは検出したノード用のデータベースです。データベースにアクセスする場合、まずデータをディスカバリ用データベースから取得するのか、またはノードデータベースから取得するのかを指定する必要があります。指定するには、<option>iscsiadm</option>コマンドの<option>-m discovery</option>または<command>-m node</command>パラメータを使用します。iscsiadm<command>コマンドに、どちらかのパラメータを指定して実行すると、そのデータベースに保管されているレコードの概要が表示されます。</command> </para>

<screen>
iscsiadm -m discovery
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems
</screen>

   <para>この例のターゲット名は<literal>iqn.2006-02.com.example.iserv:systems</literal>です。このデータセットに関連する操作を行う場合に、この名前が必要になります。ID <literal>iqn.2006-02.com.example.iserv:systems</literal>のデータレコードのコンテンツを調べるには、次のコマンドを使用します。 </para>

<screen>
iscsiadm -m node --targetname iqn.2006-02.com.example.iserv:systems
node.name = iqn.2006-02.com.example.iserv:systems
node.transport_name = tcp
node.tpgt = 1
node.active_conn = 1
node.startup = manual
node.session.initial_cmdsn = 0
node.session.reopen_max = 32
node.session.auth.authmethod = CHAP
node.session.auth.username = joe
node.session.auth.password = ********
node.session.auth.username_in = &lt;empty&gt;
node.session.auth.password_in = &lt;empty&gt;
node.session.timeo.replacement_timeout = 0
node.session.err_timeo.abort_timeout = 10
node.session.err_timeo.reset_timeout = 30
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
....
</screen>

   <para>これらの変数の値を変更する場合は、<command>iscsiadm</command>コマンドで<option>update</option>オプションを使用します。たとえば、初期化時にiscidをiSCSIターゲットにログインさせる場合は、値に<option>automatic</option>と<option>node.startup</option>を設定します。 </para>

<screen role="compact2">
iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems -p ip:port --op=update --name=node.startup --value=automatic
</screen>

   <para><literal>delete</literal>で、古くなったデータセットを削除します。ターゲット<literal>iqn.2006-02.com.example.iserv:systems</literal>が有効なレコードでなくなった場合は、次のコマンドでこのレコードを削除してください。</para>

<screen>
<command>iscsiadm</command> <option>-m node -n iqn.2006-02.com.example.iserv:systems -p ip:port --op=delete</option>
</screen>

   <important>
    <para>このオプションでは、確認のメッセージを表示せずかにレコードを削除するため、使用する際には細心の注意を払うようにしてください。 </para>
   </important>
   <para>検出したすべてのターゲットのリストを取得するには、<command>iscsiadm -m node</command>コマンドを実行します。</para>
  </section>
 </section>
 <section xml:id="bwkrqdd">
  <title>インストール時のiSCSIディスクの使用</title>
  <para>iSCSI対応のファームウェアを使用している場合は、i386、x86_64、およびppc64アーキテクチャ上のiSCSIディスクからの起動がサポートされています。 </para>
  <para>インストール時にiSCSIディスクそ使用するには、次のパラメータをブートオプション行に追加する必要があります。 </para>

<screen>
withiscsi=1
</screen>

  <para>インストール中に、インストールプロセスで使用するiSCSIディスクをシステムに接続するオプションが記載された、追加の画面が表示されます。</para>
 </section>
 <section xml:id="sec-inst-system-iscsi-ts">
  <title>iSCSIのトラブルシューティング</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="nofail" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bp5cdib" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bpjp8x0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7p6z" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="nofail">
   <title>ホットプラグでiSCSIターゲットをマウントできない</title>
   <para>SLES 10では、iSCSIターゲットをマウントするため、<filename>/etc/fstab</filename>ファイルで<literal>hotplug</literal>オプションをデバイスに追加できました。次に例を示します。</para>

<screen>
/dev/disk/by-uuid-blah /oracle/db   ext3       hotplug,rw            0 2
</screen>

   <para>SLES 11では、<literal>hotplug</literal>オプションは機能しません。代わりに、<literal>nofail</literal>オプションを使用してください。次に例を示します。</para>

<screen>
/dev/sdb1   /mnt/mountpoint   ext3   acl,user,nofail   0 0
</screen>

   <para>『<link xlink:href="http://www.novell.com/support/php/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=7004427"><citetitle>TID 7004427: /etc/fstab entry does not mount iSCSI device on boot up </citetitle></link>』を参照してください。</para>
  </section>
  <section xml:id="bp5cdib">
   <title>iSCSIトラフィックのデータパッケージがドロップされる</title>
   <para>ファイアウォールは、ビジーになるとパケットをドロップすることがあります。SUSEファイアウォールのデフォルトは、3分後にパケットをドロップすることです。iSCSIトラフィックのパケットがドロップされていることが分かった場合は、ファイアウォールがビジーになったとき、パケットをドロップする代わりにキューに入れるように、SUSEファイアウォールを設定することができます。 </para>
  </section>
  <section xml:id="bpjp8x0">
   <title>LVMでiSCSIボリュームを使用する</title>
   <para>iSCSIターゲットでLVMを使用する際には、この項のトラブルシューティングのヒントを使用してください。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bpkq3ci" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bpkpzuj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <section xml:id="bpkq3ci">
    <title>ブート時にiSCSIイニシエータの検出が行われることを確認する</title>
    <para>iSCSIイニシエータをセットアップする際には、udevがブート時にiSCSIデバイスを検出し、LVMによるそれらのデバイスの使用をセットアップできるように、ブート時の検出を有効にしてください。</para>
   </section>
   <section xml:id="bpkpzuj">
    <title>iSCSIターゲットの検出がブート時に起きることを確認する</title>
    <para>SLES 11の<filename>udev</filename>では、デバイスのデフォルトセットアップを提供することを思い出してください。デバイスを作成するすべてのアプリケーションに、ブート時に実行されるランレベル設定があることを確認してください。<command>udev</command>がシステムのスタートアップ時にそれらを認識し、デバイスを割り当てることができます。アプリケーションまたはサービスが後まで起動しない場合は、<command>udev</command>がブート時のように自動的にデバイスを作成することはありません。 </para>
    <para><guimenu>YaST</guimenu>でLVM2とiSCSIのランレベル設定を確認するには、<guimenu>システム</guimenu><guimenu>システムサービス(ランレベル)</guimenu><guimenu>エキスパートモード</guimenu>の順に選択します。次のサービスをブート時に有効にします(B)。</para>
    <simplelist>
     <member>boot.lvm</member> <member>boot.open-iscsi</member> <member>open-iscsi</member>
    </simplelist>
   </section>
  </section>
  <section xml:id="bwk7p6z">
   <title>設定ファイルが手動に設定されていると、iSCSIターゲットがマウントされる</title>
   <para>Open-iSCSIは、<filename>/etc/iscsi/iscsid.conf</filename>ファイルで<literal>node.startup</literal>オプションが手動に設定されている場合でも、設定ファイルを手動で変更すれば、起動時にターゲットをマウントできます。</para>
   <para><filename>/etc/iscsi/nodes/&lt;<replaceable>ターゲット_名</replaceable>&gt;/&lt;<replaceable>ip_アドレス</replaceable>,<replaceable>ポート</replaceable>&gt;/default</filename>ファイルを確認してください。このファイルには、<filename>/etc/iscsi/iscsid.conf</filename>ファイルを上書きする<literal>node.startup</literal>設定が含まれています。YaSTインターフェイスを使用してマウントオプションを手動に設定すると、 <filename>/etc/iscsi/nodes/&lt;<replaceable>ターゲット_名</replaceable>&gt;/&lt;<replaceable>ip_アドレス</replaceable>,<replaceable>ポート</replaceable>&gt;/default </filename>ファイルでも<literal>node.startup = manual</literal>が設定されます。</para>
  </section>
 </section>
 <section xml:id="sec-inst-system-iscsi-initiator-info">
  <title>追加情報</title>
  <para>iSCSIプロトコルは、数年に渡って利用されています。そのため、iSCSIとSANソリューションの比較、ベンチマークテスト、ハードウェアソリューションの解説など、さまざまなレビューや参考資料が発表または公開されています。open-iscsiの詳細に関する代表的なサイトを以下に示します。 </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><link xlink:href="http://www.open-iscsi.org/"><citetitle>Open-iSCSI Project</citetitle></link></para>
   </listitem>
   <listitem>
    <para><link xlink:href="http://www.novell.com/coolsolutions/appnote/15394.html"><citetitle>AppNote: iFolder on Open Enterprise Server Linux Cluster using iSCSI</citetitle></link></para>
   </listitem>
  </itemizedlist>
  <para>このほか、オンラインマニュアルも利用できます。i<command>scsiadm</command>、<command>iscsid</command>、<filename>ietd.conf</filename>および<command>ietd</command>の各マニュアルページのほか、環境設定ファイルのサンプル<filename> /etc/iscsid.conf</filename>も参照してください。 </para>
 </section>
</chapter>

<chapter xml:id="cha-iscsi-lio" xml:lang="ja" xml:base="06_iscsi_lio.xml"><title>IP ネットワークの大容量記憶域: iSCSI LIOターゲットサーバ</title><info/>
 
 <para>LIO (linux-iscsi.org)は、Linux用の標準のオープンソースマルチプロトコルSCSIターゲットです。LIOは、Linuxカーネルのバージョン2.6.38以降において、Linuxにおける標準の統一ストレージターゲットとして、STGT (SCSI Target)フレームワークにとって代わりました。YaSTは、SUSE Linux Enterprise Server 11 SP3以降で、iSCSI LIOターゲットサーバソフトウェアをサポートしています。 </para>
 <para>この項では、YaSTを使用してiSCSI LIOターゲットサーバを構成し、iSCSI LIOのターゲットデバイスを設定する方法について説明します。任意のiSCSIイニシエータソフトウェアを使用して、ターゲットデバイスにアクセスすることができます。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sect-iscsi-lio-install" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-service" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-discovery" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-storage" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-targetgp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-edit" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-delete" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13g8i2g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12iqi8o" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="sect-iscsi-lio-install">
  <title>iSCSI LIOターゲットサーバソフトウェアのインストール</title>
  <para>YaSTソフトウェア管理ツールを使用して、iSCSI LIOターゲットサーバソフトウェアを、SUSE Linux Enterprise Server 11 SP3サーバ上でiSCSI LIOターゲットデバイスを作成したい場所にインストールします。</para>
  <procedure xml:id="b12jepdi">
   <step xml:id="b12jepdj">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="b12jepdk">
    <para><guimenu>ソフトウェア</guimenu><guimenu>ソフトウェア管理</guimenu>の順に選択します。</para>
   </step>
   <step xml:id="b12jepdl">
    <para><guimenu>検索</guimenu>を選択し、<literal>lio</literal>と入力して、<guimenu>検索</guimenu>をクリックします。</para>
   </step>
   <step xml:id="b12jepdm">
    <para>iSCSI LIOターゲットサーバのパッケージを選択します。</para>
    <informaltable>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="4091*"/>
     <colspec colnum="2" colname="2" colwidth="5912*"/>
      <thead>
       <row><!--id=b12gs3f1-->
        <entry>
         <para>iSCSI LIOターゲットサーバのパッケージ</para>
        </entry>
        <entry>
         <para>説明</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row><!--id=b12gs3f2-->
        <entry>
         <para><filename>yast2-iscsi-lio-server</filename></para>
        </entry>
        <entry>
         <para>iSCSI LIOターゲットデバイスの設定用に、YaST内にGUIインタフェースを提供します。</para>
        </entry>
       </row>
       <row><!--id=b12gs3f3-->
        <entry>
         <para><filename>lio-utils</filename></para>
        </entry>
        <entry>
         <para><filename>yast2-iscsi-lio-server</filename>が使用する、iSCSI LIOターゲットデバイスの設定および制御用のAPIを提供します。</para>
        </entry>
       </row>
       <row><!--id=b12gs3f4-->
        <entry>
         <para><filename>lio-mibs</filename></para>
        </entry>
        <entry>
         <para>Net-SNMPエージェントのダイナミックロードモジュール(<filename>dlmod</filename>)機能を使用して、iSCSI LIOターゲットデバイスのSNMP (Simple Network Management Protocol)モニタリングを提供します。SNMP v1、v2c、およびv3に対応しています。環境設定ファイルは、<filename>/etc/snmp/snmpd.conf</filename>です。</para>
         <para><filename>lio-mibs</filename>ソフトウェアは、<filename>perl-SNMP</filename>および<filename>net-snmp</filename>パッケージを使用します。</para>
         <para>Net-SNMPの詳細については、オープンソースの<link xlink:href="http://www.net-snmp.org/">Net-SNMP Project</link>を参照してください。</para>
        </entry>
       </row>
       <row><!--id=b12gs3f5-->
        <entry>
         <para><filename>lio</filename>-utils-debuginfo</para>
        </entry>
        <entry>
         <para><filename>lio-utils</filename>パッケージ用のデバッグ情報を提供します。このパッケージは、<filename>lio-utils</filename>用のアプリケーションの開発またはデバッグの際に仕様できます。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step xml:id="b12r0abb">
    <para>ダイアログボックスの右下部にある<guimenu>承諾</guimenu>をクリックして、選択したパッケージをインストールします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_install_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12jepdn">
    <para role="intro">自動変更を承認するかどうを尋ねるメッセージが表示されたら、<guimenu>続行</guimenu>をクリックして、<filename>lio-utils</filename>, <filename>perl-SNMP</filename>, および<filename>net-snmp</filename>パッケージに対するiSCSI LIOターゲットサーバの依存性を承諾します。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_install_changes_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12jepdo">
    <para role="intro">YaSTを終了して再起動し、<guimenu>ネットワークサービス</guimenu>をクリックして、<guimenu> iSCSI LIOターゲット</guimenu>オプションがメニューにあることを確認します。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast_option_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12jepdp">
    <para><xref linkend="sect-iscsi-lio-service" xrefstyle="SectTitleOnPage"/>に進みます。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="sect-iscsi-lio-service">
  <title>iSCSI LIOターゲットサービスの開始</title>
  <para>iSCSI LIOターゲットサービスは、マニュアルで開始するようデフォルトで設定されています。同サービスを、システムの再起動時に自動的に開始するよう設定できます。サーバでファイアウォールを使用していて、iSCSI LIOターゲットをほかのコンピュータでも利用可能としたい場合は、ターゲットへのアクセスに使用する各アダプタ用に、ファイアウォール内のポートを開放する必要があります。TCPポート3260が、iSCSIプロトコル用のポート番号です。これは、IANA (Internet Assigned Numbers Authority)により定義されています。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jbaln" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jbalo" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b12jbbfh">
   <title>iSCSI LIO起動の初期設定</title>
   <para>iSCSI LIOターゲットサーバサービスの設定:</para>
   <procedure xml:id="b12jauce">
    <step xml:id="b13n0ujo">
     <para><systemitem>root</systemitem>ユーザとしてiSCSI LIOターゲットサーバにログインして、端末コンソールを起動します。</para>
    </step>
    <step xml:id="b13n0ujp">
     <para><filename>/etc/init.d/target</filename>デーモンが実行中であることを確認します。コマンドプロンプトで、次のように入力します</para>

<screen>
/etc/init.d/target start
</screen>

     <para>コマンドから、デーモンが起動した、またはデーモンがすでに実行中であることを確認するメッセージが返されます。</para>
    </step>
    <step xml:id="b12jaucf">
     <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
    </step>
    <step xml:id="b12jaucg">
     <para>YaSTコントロールセンターで、<guimenu>ネットワークサービス</guimenu>を選択して、次に<guimenu>iSCSI LIOターゲット</guimenu>を選択します。</para>
     <para><quote>lio</quote>を検索してから、<guimenu>iSCSI LIOターゲット</guimenu>を選択することもできます。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="b12jauch">
     <para role="intro">[iSCSI LIOターゲット概要]ダイアログボックスで、<guimenu>サービス</guimenu>タブを選択します。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_service_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="b12jauci">
     <para role="intro"><guimenu>サービスを開始</guimenu>で、iSCSI LIOターゲットサービスの開始方法を指定します。 </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara xml:id="b12jaucj">
        <title>ブート時:</title>
        <para>サービスは、サーバの再起動時に自動的に開始します。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara xml:id="b12jauck">
        <title>手動:</title>
        <para>(デフォルト)サーバの再起動後、マニュアルでサービスを開始する必要があります。ターゲットデバイスは、サービスを開始するまで利用できません。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </step>
    <step xml:id="b12jaucl">
     <para>サーバでファイアウォールを使用していて、iSCSI LIOターゲットをほかのコンピュータでも利用可能としたい場合は、ターゲットへのアクセスに使用する各アダプタインタフェース用に、ファイアウォール内のポートを開放します。 </para>
     <para>ファイアウォール設定は、デフォルトでは無効になっています。この設定は、サーバ上にファイアウォールを展開しない限り不要です。デフォルトのポート番号は3260です。このポートがネットワークインタフェースのすべてに対してクローズしている場合、iSCSI LIOターゲットはほかのコンピュータでは利用できません。</para>
     <substeps performance="required">
      <step xml:id="b12jaucm">
       <para><guimenu>サービス</guimenu>タブで、<guimenu>ファイアウォールのポートを開く</guimenu>チェックボックスをオンにして、ファイアウォール 設定を有効にします。</para>
      </step>
      <step xml:id="b12jaucn">
       <para><guimenu>ファイアウォールの詳細</guimenu>をクリックして、使用するネットワークインタフェースを確認または設定します。</para>
       <para>すべての利用可能なネットワークインタフェースが一覧表示され、デフォルトではすべてが選択されています。</para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="lio_firewall_ports_a.png" width="250pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step xml:id="b12jauco">
       <para>各インタフェースについて、それに対するポートを開くか閉じるかを指定します。</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <formalpara xml:id="b12jaucp">
          <title>開く:</title>
          <para>ポートを開くには、インタフェースのチェックボックスをオンにします。<guimenu>すべて選択</guimenu>をクリックして、インタフェースのすべてでポートを開くこともできます。 </para>
         </formalpara>
        </listitem>
        <listitem>
         <formalpara xml:id="b12jaucq">
          <title>閉じる:</title>
          <para>ポートを閉じるには、インタフェースのチェックボックスを選択解除します。<guimenu>すべて選択解除</guimenu>をクリックして、インタフェースのすべてでポートを閉じることもできます。 </para>
         </formalpara>
        </listitem>
       </itemizedlist>
      </step>
      <step xml:id="b12jaucr">
       <para><guimenu>OK</guimenu>をクリックして、変更内容を保存して適用します。 </para>
      </step>
      <step xml:id="b12r0it6">
       <para>設定の確認を求めるメッセージが表示されたら、<guimenu>はい</guimenu>をクリックして先に進むか、<guimenu>いいえ</guimenu>をクリックして、ダイアログボックスに戻って必要な変更を行います。</para>
      </step>
     </substeps>
    </step>
    <step xml:id="b12jb97x">
     <para><guimenu>完了</guimenu>をクリックして、iSCSI LIOターゲットサービスの設定を保存して適します。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="b12jbaln">
   <title>iSCSI LIOターゲットおよびコマンドラインのマニュアルでの開始</title>
   <procedure xml:id="b12gboje">
    <step xml:id="b13n0ujq">
     <para><systemitem>root</systemitem>ユーザとしてログインし、端末コンソールを起動します。</para>
    </step>
    <step xml:id="b13n0ujr">
     <para>コマンドプロンプトで、次のように入力します</para>

<screen>
/etc/init.d/target start
</screen>

     <para>コマンドから、デーモンが起動した、またはデーモンがすでに実行中であることを確認するメッセージが返されます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="b12jbalo">
   <title>YaSTでのiSCSI LIOターゲットのマニュアルでの開始</title>
   <procedure xml:id="b12gblm7">
    <step xml:id="b12gblm8">
     <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
    </step>
    <step xml:id="b12gblm9">
     <para>YaSTコントロールセンターで、<guimenu>システム</guimenu>を選択して、次に<guimenu>システムサービス(Runlevel)</guimenu>を選択します。</para>
    </step>
    <step xml:id="b12gblma">
     <para>[YaSTシステムサービス]ダイアログボックスで、<guimenu>エキスパートモード</guimenu>を選択し、次にサービスのリストから<guimenu>target</guimenu> (<guimenu>TCM/ConfigFS and LIO-Target</guimenu>)を選択します。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_runlevel_a.png" width="300pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="b12gbmn5">
     <para>右下で、<guimenu>開始/中止/更新</guimenu><guimenu>今すぐ開始</guimenu>を選択します。</para>
    </step>
    <step xml:id="b12jbalp">
     <para><guimenu>OK</guimenu>をクリックします。</para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="sect-iscsi-lio-discovery">
  <title>iSCSI LIOターゲットおよびクライアントのディスカバリに対する認証の設定  </title>
  <para>iSCSI LIOターゲットサーバソフトウェアは、PPP-CHAP (Point-to-Point Protocol Challenge Handshake Authentication Protocol)をサポートしています。これは、<link xlink:href="http://www.ietf.org/rfc/rfc1994.txt"><citetitle>Internet Engineering Task Force (IETF) RFC 1994</citetitle></link>で定義されている、3方向の認証方法です。iSCSI LIOターゲットサーバはこの認証方法を、ターゲット上のファイルへのアクセスにではなく、iSCSI LIOのターゲットとクライアントのディスカバリ用に使用します。ディスカバリへのアクセスを制限しない場合は、<guimenu>認証なし</guimenu>を選択します。デフォルトでは<guimenu>認証なし</guimenu>のオプションが有効になっています。ディスカバリに対する認証を有効にしない場合、その設定は、すべてのiSCSI LIOターゲットグループに適用されます。</para>
  <important>
   <para>運用環境では、ターゲットおよびクライアントのディスカバリに認証を使用することを推奨します。</para>
  </important>
  <para>よりセキュアな設定に対する認証が必要な場合は、incoming認証、outgoing認証またはその両方を使用できます。 <guimenu>incoming認証</guimenu>では、iSCSIイニシエータに、iSCSI LIOターゲット上でディスカバリを実行するパーミッションがあることを証明するよう求めます。イニシエータは、incomingのユーザ名とパスワードを入力する必要があります。<guimenu>outgoing認証</guimenu>では、iSCSI LIOターゲットに、自らが目的のターゲットであることをイニシエータに対して証明するよう求めます。iSCSI LIOターゲットは、outgoingのユーザ名とパスワードを、iSCSIイニシエータに提供する必要があります。ユーザ名とパスワードの組み合わせは、incomingとoutgoingディスカバリで異なっても構いません。 </para>
  <para>iSCSI LIOターゲットに対して認証の初期設定を行うには</para>
  <procedure xml:id="b12g8sjw">
   <step xml:id="b13n0ujs">
    <para><systemitem>root</systemitem>ユーザとしてiSCSI LIOターゲットサーバにログインして、端末コンソールを起動します。</para>
   </step>
   <step xml:id="b13n0ujt">
    <para><filename>/etc/init.d/target</filename>デーモンが実行中であることを確認します。コマンドプロンプトで、次のように入力します</para>

<screen>
/etc/init.d/target start
</screen>

    <para>コマンドから、デーモンが起動した、またはデーモンがすでに実行中であることを確認するメッセージが返されます。</para>
   </step>
   <step xml:id="b12g8sjx">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="b12g8sjy">
    <para>YaSTコントロールセンターで、<guimenu>ネットワークサービス</guimenu>を選択して、次に<guimenu>iSCSI LIOターゲット</guimenu>を選択します。</para>
    <para><quote>lio</quote>を検索してから、<guimenu>iSCSI LIOターゲット</guimenu>を選択することもできます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12g9s76">
    <para>[iSCSI LIOターゲット概要]ダイアログボックスで、<guimenu>グローバル</guimenu>タブを選択して、認証の設定を行います。認証設定は、デフォルトでは無効になっています。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_global_noauth_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12jco93">
    <para>iSCSI LIOターゲットに対して認証を求めるかどうかを指定します。 </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b12jcrm7">
       <title>認証を無効にする:</title>
       <para>(デフォルト)このサーバ上のディスカバリに対してincomingとoutgoingの認証を無効にするには、<guimenu>認証なし</guimenu>チェックボックスをオンにします。このサーバ上のすべてのiSCSI LIOターゲットは、同じネットワーク上のどのiSCSIイニシエータクライアントによっても検出することができます。このサーバは、ディスカバリに対する認証を必要としない、同じネットワーク上のどのiSCSIイニシエータクライアントも検出することができます。<xref linkend="b12r1015" xrefstyle="StepXRef"/>をスキップして<xref linkend="b12gb2ux" xrefstyle="StepXRef"/>に進みます。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b12jcrm8">
       <title>認証を有効にする:</title>
       <para><guimenu>認証なし</guimenu>チェックボックスを、選択解除します。<guimenu>incoming認証</guimenu>と<guimenu>outgoing認証</guimenu>の両方のチェックボックスが自動的にオンになります。<xref linkend="b12r1015" xrefstyle="StepXRef"/>に進みます。</para>
      </formalpara>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_global_in_out_auth_a.png" width="250pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </itemizedlist>
   </step>
   <step xml:id="b12r1015">
    <para role="intro">incomingディスカバリ、outgoingディスカバリ、またはその両方に必要な認証資格情報を設定します。ユーザ名とパスワードの組み合わせは、incomingとoutgoingディスカバリで異なっても構いません。 </para>
    <substeps performance="required">
     <step xml:id="b12jcw2u">
      <para>次のいずれかを行って、incoming認証を設定します。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara xml:id="b12r0xyn">
         <title>incoming認証を無効にする: </title>
         <para><guimenu>incoming認証</guimenu>チェックボックスを、選択解除します。このサーバ上のすべてのiSCSI LIOターゲットは、同じネットワーク上のどのiSCSIイニシエータクライアントによっても検出することができます。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara xml:id="b12r0xyo">
         <title>incoming認証を有効にする: </title>
         <para><guimenu>incoming認証</guimenu>チェックボックスをオンにして、iSCSI LIOターゲットのincomingディスカバリに使用する、既存のユーザ名とパスワードの組み合わせを指定します。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step xml:id="b12jcw2x">
      <para>次のいずれかを行って、outgoing認証を設定します。 </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara xml:id="b12r0xyp">
         <title>outgoing認証を無効にする: </title>
         <para><guimenu>outgoing認証</guimenu>チェックボックスを、選択解除します。このサーバは、ディスカバリに対する認証を必要としない、同じネットワーク上のどのiSCSIイニシエータクライアントも検出することができます。 </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara xml:id="b12r0xyq">
         <title>outgoing認証を有効にする: </title>
         <para><guimenu>outgoing認証</guimenu>チェックボックスをオンにして、iSCSIイニシエータクライアントのoutgoingディスカバリに使用する、既存のユーザ名とパスワードの組み合わせを指定します。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
    </substeps>
   </step>
   <step xml:id="b12gb2ux">
    <para><guimenu>完了</guimenu>をクリックして、設定を保存して適用します。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="sect-iscsi-lio-storage">
  <title>ストレージスペースの準備</title>
  <para>iSCSI LIOターゲットの設定により、既存のブロックデバイスをiSCSIイニシエータにエクスポートします。未フォーマットのパーティションまたはデバイスをサーバ上に設定して、ターゲットデバイスで使用するストレージスペースを準備する必要があります。iSCSI LIO ターゲットは、Linux、Linux LVM、またはLinux RAIDファイルシステムIDで未フォーマットのパーティションを使用できます。 </para>
  <important>
   <para>iSCSIターゲットとして使用するデバイスやパーティションを設定したら、ローカルパス経由で直接アクセスしないでください。作成時にはマウントポイントは指定しないでください。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12jcw6s" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jcw75" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b12jcw6s">
   <title>デバイスのパーティショニング</title>
   <procedure xml:id="b12jcw6t">
    <step xml:id="b12jcw6u">
     <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
    </step>
    <step xml:id="b12jcw6v">
     <para>YaSTで、<guimenu>システム</guimenu><guimenu>パーティショナ</guimenu>を選択します。</para>
    </step>
    <step xml:id="b12jcw6w">
     <para>パーティショナの使用に関する警告に対して<guimenu>はい</guimenu>を選択して続行します。</para>
    </step>
    <step xml:id="b12jcw6x">
     <para>[パーティション]ページの下部で、<guimenu>追加</guimenu>をクリックしてパーティションを作成します。ただしフォーマットはせず、マウントもしないでください。 </para>
     <substeps performance="required">
      <step xml:id="b12o0qiv">
       <para>[エキスパートパーティショナ]ページで、<guimenu>ハードディスク</guimenu>を選択して、設定したいディスクのリーフノード名(<filename>sdc</filename>など)を選択します。</para>
      </step>
      <step xml:id="b12jcw6y">
       <para><guimenu>プライマリパーティション</guimenu>を選択し、<guimenu>次へ</guimenu>をクリックします。</para>
      </step>
      <step xml:id="b12jcw6z">
       <para>使用する容量を指定して、<guimenu>次へ</guimenu>をクリックします。</para>
      </step>
      <step xml:id="b12jcw70">
       <para><guimenu>フォーマットオプション</guimenu>で、<guimenu>フォーマットしない</guimenu>を選択して、ドロップダウンリストからファイルシステムのIDタイプを選択します。</para>
       <para>iSCSI LIO ターゲットは、Linux (0x83)、Linux LVM (0x8E)、またはLinux RAID (0xFD)ファイルシステムIDで未フォーマットのパーティションを使用できます。 </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="lio_disk_format_a.png" width="250pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step xml:id="b12jcw71">
       <para><guimenu>マウントのオプション</guimenu>で、<guimenu>マウントしない</guimenu>を選択します。</para>
      </step>
      <step xml:id="b12jcw72">
       <para><guimenu>完了</guimenu>をクリックします。</para>
      </step>
     </substeps>
    </step>
    <step xml:id="b12jcw73">
     <para><xref linkend="bj5f9hl" xrefstyle="StepXRef"/>を繰り返して、後でiSCSI LIOターゲットとして使用したい領域に、未フォーマットのパーティションを作成します。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_disk_format_multi_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step xml:id="b12jcw74">
     <para><guimenu>次へ</guimenu><guimenu>完了</guimenu>をクリックして変更を保存し、YaSTを閉じます。</para>
    </step>
   </procedure>
  </section>
  <section xml:id="b12jcw75">
   <title>仮想環境でのデバイスのパーティション分割</title>
   <para>仮想マシンのゲストサーバを、iSCSI LIOターゲットサーバとして使用できます。この項では、Xen仮想マシンにパーティションを割り当てる方法を説明します。また、SUSE Linux Enterprise Server 11 SP2以降でサポートされている、その他の仮想環境も使用できます。</para>
   <para>Xen仮想環境で、iSCSI LIOターゲットデバイスに使用するストレージスペースをゲストの仮想マシンに割り当て、ゲスト環境内の仮想ディスクとしてそのスペースにアクセスします。各仮想ディスクは、ディスク全体、パーティション、ボリュームなどの物理ブロックデバイスでも、Xenホストサーバ上の大規模な物理ディスク上の単一イメージファイルが仮想ディスクになっている、ファイルバックディスクイメージのいずれでも可能です。最適なパフォーマンスを得るためには、物理ディスクまたはパーティションから各仮想ディスクを作成してください。ゲストの仮想マシンに仮想ディスクを設定したら、ゲストサーバを起動し、物理サーバの場合と同じ方法で、新しいブランクの仮想ディスクをiSCSIターゲットデバイスとして設定します。 </para>
   <para>ファイルバックディスクイメージがXenホストサーバ上に作成され、Xenゲストサーバに割り当てられます。デフォルトでは、Xenはファイルバックディスクイメージを<filename>/var/lib/xen/images/<replaceable>vm_name</replaceable></filename>ディレクトリに保存します。ここで<filename><replaceable>vm_name</replaceable></filename>は仮想マシンの名前です。</para>
   <para>たとえば、サイズが4GBの<filename>/var/lib/xen/images/vm_one/xen--0</filename>ディスクイメージを作成する場合は、まず、ディレクトリが存在することを確認し、次に、イメージ自体を作成します。</para>
   <procedure xml:id="b12jcw76">
    <step xml:id="b12jcw77">
     <para>ホストサーバに<systemitem>root</systemitem>ユーザとしてログインします。</para>
    </step>
    <step xml:id="b12jcw78">
     <para>端末コンソールプロンプトで次のコマンドを入力します。:</para>

<screen>
mkdir -p /var/lib/xen/images/vm_one
dd if=/dev/zero of=/var/lib/xen/images/vm_one/xen-0 seek=1M bs=4096 count=1
</screen>

    </step>
    <step xml:id="b12jcw79">
     <para>Xen設定ファイルで、ファイルシステムイメージをゲスト仮想マシンに割り当てます。</para>
    </step>
    <step xml:id="b12jcw7a">
     <para>ゲストサーバに<systemitem>root</systemitem>ユーザとしてログインし、YaSTを使用して<xref linkend="b12jcw6s" xrefstyle="HeadingOnPage"/>の手順で仮想ブロックデバイスを設定します。</para>
    </step>
   </procedure>
  </section>
 </section>
 <section xml:id="sect-iscsi-lio-targetgp">
  <title>iSCSI LIOターゲットグループの設定</title>
  <para>YaSTを使用して、iSCSI LIOターゲットデバイスを設定することができます。YaSTでは、<command>lio-utils</command>ソフトウェアにより提供されるAPIを使用します。iSCSI LIO ターゲットは、Linux、Linux LVM、またはLinux RAIDファイルシステムIDで未フォーマットのパーティションを使用できます。</para>
  <important>
   <para>始める前に、<xref linkend="sect-iscsi-lio-storage" xrefstyle="SectTitleOnPage"/>に記載しているように、iSCSI LIOターゲットとして使用する未フォーマットのパーティションを作成してください。</para>
  </important>
  <procedure xml:id="b12jbfdv">
   <step xml:id="b13n0uju">
    <para><systemitem>root</systemitem>ユーザとしてiSCSI LIOターゲットサーバにログインして、端末コンソールを起動します。</para>
   </step>
   <step xml:id="b13n0ujv">
    <para><filename>/etc/init.d/target</filename>デーモンが実行中であることを確認します。コマンドプロンプトで、次のように入力します</para>

<screen>
/etc/init.d/target start
</screen>

    <para>コマンドから、デーモンが起動した、またはデーモンがすでに実行中であることを確認するメッセージが返されます。</para>
   </step>
   <step xml:id="b12jbfdw">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="b12jbfdx">
    <para>YaSTコントロールセンターで、<guimenu>ネットワークサービス</guimenu>を選択して、次に<guimenu>iSCSI LIOターゲット</guimenu>を選択します。</para>
    <para><quote>lio</quote>を検索してから、<guimenu>iSCSI LIOターゲット</guimenu>を選択することもできます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12jbfdy">
    <para>[iSCSI LIOターゲット概要]ダイアログボックスで、<guimenu>ターゲット</guimenu>タブを選択して、ターゲットの設定を行います。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_targets_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12jdln1">
    <para role="intro"><guimenu>追加</guimenu>をクリックして、新しいiSCSI LIOのターゲットグループとデバイスを定義します。</para>
    <para role="intro">iSCSI LIOターゲットソフトウェアにより、<guimenu>ターゲット</guimenu>、<guimenu>識別子</guimenu>、<guimenu>ポータルグループ</guimenu>、<guimenu>IPアドレス</guimenu>、および<guimenu>ポート番号</guimenu>の各フィールドが自動的に記入されます。<guimenu>認証を使用する</guimenu>が、デフォルトで選択されています。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_add_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <substeps performance="required">
     <step xml:id="b12jdzge">
      <para>複数のネットワークインタフェースがある場合は、IPアドレスのドロップダウンリストを使って、このターゲットグループ用に使用するネットワークインタフェースのIPアドレスを選択します。</para>
     </step>
     <step xml:id="b12jdzgf">
      <para>このターゲットグループに対してクライアント認証を求めたい場合は、<guimenu>認証を使用する</guimenu>を選択します。</para>
      <important>
       <para>運用環境では、認証を求めることが推奨されます。</para>
      </important>
     </step>
     <step xml:id="b12je5o1">
      <para><guimenu>追加</guimenu>をクリックして、ブラウズしてデバイスまたはパーティションを選択し、名前を指定してから、<guimenu>OK</guimenu>をクリックします。</para>
      <para>0から始まるLUN番号が自動的に作成されます。フィールドを空にしておくと、名前が自動的に生成されます。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_target_addnew_a.png" width="91pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step xml:id="b12jebk1">
      <para>(オプション)<xref linkend="b12jdzge" xrefstyle="StepXRef"/>から<xref linkend="b12je5o1" xrefstyle="StepXRef"/>までを繰り返し、このターゲットグループにさらにターゲットを追加します。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_target_list_a.png" width="250pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step xml:id="b12jeipi">
      <para>目的のターゲットがすべてグループに追加されたら、<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
    </substeps>
   </step>
   <step xml:id="b12jeipj">
    <para>[iSCSIターゲットクライアントセットアップの変更]ページで、ターゲットグループ内のLUNへのアクセスを許可されるクライアントに関する情報を設定します。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_client_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <para>ターゲットグループに対して1つ以上のクライアントを指定すると、<guimenu>LUNを編集</guimenu>、<guimenu>認証を編集</guimenu>、<guimenu>削除</guimenu>、および<guimenu>コピー</guimenu>の各ボタンが有効になります。<guimenu>追加</guimenu>または<guimenu>コピー</guimenu>を使用して、ターゲットグループにさらにクライアントを追加できます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_client_options_a.png" width="200pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="b12mh6xo">
       <title>追加:</title>
       <para>選択したiSCSI LIOターゲットグループに、新たなクライアントのエントリを追加します。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b12mgggu">
       <title>LUNを編集:</title>
       <para>iSCSI LIOターゲットグループ内のどのLUNが、選択したクライアントにマップするかを設定します。割り当てられたターゲットのそれぞれを、任意のクライアントLUNにマップすることができます。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b12mgggv">
       <title>認証を編集:</title>
       <para>選択したクライアントに対する好みの認証方法を設定します。認証なしを指定することも、incoming認証、outgoing認証、またはその両方を設定することもできます。 </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b12mgggw">
       <title>削除:</title>
       <para>選択したクライアントのエントリを、ターゲットグループに割り当てられたクライアントの一覧から削除します。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="b12mgggx">
       <title>コピー:</title>
       <para>同じLUNのマッピングと認証設定を持つ新たなクライアントのエントリを、選択したクライアントのエントリとして追加します。これにより、容易に同じ共有LUNを、クラスタ内の各ノードに順々に割り当てることができます。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <substeps performance="required">
     <step xml:id="b12mdr9g">
      <para><guimenu>追加</guimenu>をクリックして、クライアント名を指定し、<guimenu>TPGからLUNをインポート</guimenu>チェックボックスを選択または選択解除してから、<guimenu>OK</guimenu>をクリックして設定を保存します。 </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client1_new_a.png" width="200pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step xml:id="b12mdr9h">
      <para>クライアントのエントリを選択して、<guimenu>LUNを編集</guimenu>をクリックし、LUNのマッピングを変更してiSCSI LIOターゲットグループ内のどのLUNを選択したクライアントに割り当てるかを指定して、<guimenu>OK</guimenu>をクリックして変更内容を保存します。 </para>
      <para>iSCSI LIOターゲットグループが複数のLUNで構成されている場合は、1つまたは複数のLUNを、選択したクライアントに割り当てることができます。デフォルトでは、グループ内の利用可能なLUNのそれぞれが、クライアントLUNに割り当てられます。 </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client3_edit_lun_a.png" width="107pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
      <para>LUNの割り当てを変更するには、次の操作の1つ以上を実行します。 </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara xml:id="b12mhta3">
         <title>追加:</title>
         <para><guimenu>追加</guimenu>をクリックして新しい<guimenu>クライアントLUN</guimenu>のエントリを作成し、<guimenu>変更</guimenu>ドロップダウンリストを使用して、それにターゲットLUNをマップします。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun4_add_a.png" width="107pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <formalpara xml:id="b12mhta4" role="intro">
         <title>削除:</title>
         <para><guimenu>クライアントLUN</guimenu>のエントリを選択して、<guimenu>削除</guimenu>をクリックしてターゲットLUNのマッピングを削除します。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun3_delete_a.png" width="106pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <formalpara xml:id="b12mhta5">
         <title>変更:</title>
         <para><guimenu>クライアントLUN</guimenu>のエントリを選択し、<guimenu>変更</guimenu>ドロップダウンリストを使用して、それにマップするターゲットLUNを選択します。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun2_change_a.png" width="108pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
      </itemizedlist>
      <para>一般的な割り当のプランには、次のようなものがあります。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>1台のサーバが、クライアントとして登録されています。ターゲットグループ内のLUNがすべて、それに割り当てられています。</para>
        <para>このグループ化戦略を使用して、特定のサーバに対して、iSCSI SANストレージを論理的にグループ化することができます。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <para role="intro">複数の独立したサーバが、クライアントとして登録されています。1つまたは複数のターゲットLUNが、それぞれのサーバに割り当てられています。それぞれのLUNは、1台のサーバのみに割り当てられています。 </para>
        <para>このグループ化戦略を使用して、データセンター内の特定の部門またはサービスのカテゴリに対して、iSCSI SANストレージを論理的にグループ化することができます。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list3_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <para>クラスタの各ノードが、クライアントとして登録されています。共有のターゲットLUNがすべて、各ノードに割り当てられています。すべてのノードがデバイスに接続されていますが、ほとんどのファイルシステムに対して、クラスタソフトウェアによってデバイスによるアクセスがロックされ、一度に1つのノード上にのみデバイスがマウントされます。共有ファイルシステム(OCFS2など)では、複数のノードが同時に同じファイル構造をマウントし、読み込みおよび書き込みアクセスを持つ同じファイルを開くことが可能です。</para>
        <para>このグループ化戦略を使用して、特定のサーバクラスタに対して、iSCSI SANストレージを論理的にグループ化することができます。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list2_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
      </itemizedlist>
     </step>
     <step xml:id="b12mdr9i">
      <para>クライアントのエントリを選択して、<guimenu>認証を編集</guimenu>をクリックし、クライアントに対する認証設定を指定して、<guimenu>OK</guimenu>をクリックして設定を保存します。</para>
      <para><guimenu>認証なし</guimenu>とすることも、<guimenu>incoming認証</guimenu>、<guimenu>outgoing認証</guimenu>、またはその両方を設定することもできます。各クライアントに対して指定できるユーザ名とパスワードの組み合わせは、1つだけです。クライアントに対するincoming認証とoutgoing認証の資格情報は、異なっても構いません。資格情報は、クライアントごとに異なっても構いません。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client4_edit_auth2_inout_a.png" width="200pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step xml:id="b12mdr9j">
      <para>このターゲットグループにアクセスできる各iSCSIクライアントについて、<xref linkend="b12mdr9g" xrefstyle="StepXRef"/>から<xref linkend="b12mdr9i" xrefstyle="StepXRef"/>を繰り返します。</para>
     </step>
     <step xml:id="b12mdr9k">
      <para> クライアントの割り当てを設定し終わったら、<guimenu>次へ</guimenu>をクリックします。</para>
     </step>
    </substeps>
   </step>
   <step xml:id="b12jbfdz">
    <para><guimenu>完了</guimenu>をクリックして、設定を保存して適用します。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_targets_group_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
  </procedure>
 </section>
 <section xml:id="sect-iscsi-lio-edit">
  <title>iSCSI LIOターゲットグループの変更</title>
  <para>以下のようにして、iSCSI LIOターゲットグループに変更を加えることができます。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>ターゲットLUNデバイスをターゲットグループに追加または削除する    </para>
   </listitem>
   <listitem>
    <para>ターゲットグループに対してクライアントを追加または削除する  </para>
   </listitem>
   <listitem>
    <para>ターゲットグループのクライアントに対して、クライアントLUNからターゲットLUNへのマッピングを変更する</para>
   </listitem>
   <listitem>
    <para>クライアント認証(incoming、outgoing、または両方)用のユーザ名とパスワードの資格情報を変更する</para>
   </listitem>
  </itemizedlist>
  <para>iSCSI LIOターゲットグループに対する設定を確認または変更するには:</para>
  <procedure xml:id="b12o1qa2">
   <step xml:id="b13n0ujw">
    <para><systemitem>root</systemitem>ユーザとしてiSCSI LIOターゲットサーバにログインして、端末コンソールを起動します。</para>
   </step>
   <step xml:id="b13n0ujx">
    <para><filename>/etc/init.d/target</filename>デーモンが実行中であることを確認します。コマンドプロンプトで、次のように入力します</para>

<screen>
/etc/init.d/target start
</screen>

    <para>コマンドから、デーモンが起動した、またはデーモンがすでに実行中であることを確認するメッセージが返されます。</para>
   </step>
   <step xml:id="b12o1qa3">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="b12o1qa4">
    <para role="intro">YaSTコントロールセンターで、<guimenu>ネットワークサービス</guimenu>を選択して、次に<guimenu>iSCSI LIOターゲット</guimenu>を選択します。</para>
    <para role="intro"><quote>lio</quote>を検索してから、<guimenu>iSCSI LIOターゲット</guimenu>を選択することもできます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12o1qa5">
    <para role="intro">[iSCSI LIOターゲット概要]ダイアログボックスで、<guimenu>ターゲット</guimenu>タブを選択して、ターゲットグループの一覧を表示します。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12o1qa6">
    <para role="intro">変更するiSCSI LIOターゲットグループを選択して、<guimenu>編集</guimenu>をクリックします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_edit_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12o1qa7">
    <para>[iSCSIターゲットLUNのセットアップを変更]ページで、ターゲットグループにLUNを追加し、LUNの割り当てを編集するか、またはターゲットLUNをグループから削除します。すべてグループに目的の変更が行われたら、<guimenu>次へ</guimenu>をクリックします。</para>
    <para>オプションについては、<xref linkend="b12jdln1" xrefstyle="StepXRef"/>の<xref linkend="sect-iscsi-lio-targetgp" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </step>
   <step xml:id="b12o1qad">
    <para>[iSCSIターゲットクライアントセットアップの変更]ページで、ターゲットグループ内のLUNへのアクセスを許可されるクライアントに関する情報を設定します。すべてグループに目的の変更が行われたら、<guimenu>次へ</guimenu>をクリックします。</para>
    <para>オプションについては、<xref linkend="b12jeipj" xrefstyle="StepXRef"/>の<xref linkend="sect-iscsi-lio-targetgp" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
   </step>
   <step xml:id="b12o1qar">
    <para><guimenu>完了</guimenu>をクリックして、設定を保存して適用します。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="sect-iscsi-lio-delete">
  <title>iSCSI LIOターゲットグループの削除</title>
  <para>iSCSI LIOターゲットグループを削除すると、グループの定義と、クライアントに対する関連のセットアップ(LUNのマッピングや認証資格情報を含む)が削除されます。パーティション上のデータは破棄されません。クライアントに再度アクセス権を付与するには、ターゲットLUNを別のまたは新規のターゲットグループに割り当てて、それらに対するクライアントアクセスを設定します。</para>
  <procedure xml:id="b12o1fhc">
   <step xml:id="b13n0ury">
    <para><systemitem>root</systemitem>ユーザとしてiSCSI LIOターゲットサーバにログインして、端末コンソールを起動します。</para>
   </step>
   <step xml:id="b13n0urz">
    <para><filename>/etc/init.d/target</filename>デーモンが実行中であることを確認します。コマンドプロンプトで、次のように入力します</para>

<screen>
/etc/init.d/target start
</screen>

    <para>コマンドから、デーモンが起動した、またはデーモンがすでに実行中であることを確認するメッセージが返されます。</para>
   </step>
   <step xml:id="b12o1fhd">
    <para>YaSTを、<systemitem>root</systemitem>ユーザとして起動します。</para>
   </step>
   <step xml:id="b12o1fhe">
    <para>YaSTコントロールセンターで、<guimenu>ネットワークサービス</guimenu>を選択して、次に<guimenu>iSCSI LIOターゲット</guimenu>を選択します。</para>
    <para><quote>lio</quote>を検索してから、<guimenu>iSCSI LIOターゲット</guimenu>を選択することもできます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12o1fhf">
    <para>[iSCSI LIOターゲット概要]ダイアログボックスで、<guimenu>ターゲット</guimenu>タブを選択して、設定済みターゲットグループの一覧を表示します。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12o1fhg">
    <para role="intro">削除するiSCSI LIOターゲットグループを選択して、<guimenu>削除</guimenu>をクリックします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="b12o1iuu">
    <para>確認のメッセージが表示されたら、<guimenu>続行</guimenu>をクリックして削除を確認するか、<guimenu>キャンセル</guimenu>をクリックしてキャンセルします。</para>
   </step>
   <step xml:id="b12o1fi0">
    <para><guimenu>完了</guimenu>をクリックして、設定を保存して適用します。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="b13g8i2g">
  <title>iSCSI LIOターゲットサーバのトラブルシューティング</title>
  <para>この項では、iSCSI LIOターゲットサーバに関するいくつかの既知の問題と、考えられる解決策について説明します。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13g8i2h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g8r6r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b13g8i2h">
   <title>ターゲットLUNのセットアップ時のポータルエラー </title>
   <para>iSCSI LIOターゲットグループの追加または編集を行う際に、次のエラーが発生する:</para>

<screen>
Problem setting network portal &lt;ip_address&gt;:3260
</screen>

   <para><filename>/var/log/YasT2/y2log</filename>ログファイルに、次のエラーが含まれている:</para>

<screen>
find: `/sys/kernel/config/target/iscsi': No such file or directory
</screen>

   <para>この問題は、iSCSI LIOターゲットサーバソフトウェアがその時点で実行中ではない場合に発生します。この問題を解決するには、YaSTを終了して、コマンドラインでマニュアルでiSCSI LIOを起動し、再試行します。</para>
   <procedure xml:id="b13g8i2i">
    <step xml:id="b13g8i2j">
     <para><systemitem>root</systemitem>ユーザとして、端末コンソールを開きます。</para>
    </step>
    <step xml:id="b13g8i2k">
     <para>コマンドプロンプトで、次のように入力します</para>

<screen>
/etc/init.d/target start
</screen>

    </step>
   </procedure>
   <para role="intro">次のように入力して、<command>configfs</command>、<command>iscsi_target_mod</command>、および<command>target_core_mod</command>がロードされているかどうかチェックすることもできます。サンプルの応答を示しています。</para>

<screen>
<command>lsmod | grep iscsi</command>

  iscsi_target_mod      295015  0
  target_core_mod       346745  4
  iscsi_target_mod,target_core_pscsi,target_core_iblock,target_core_file
  configfs               35817  3 iscsi_target_mod,target_core_mod
  scsi_mod              231620  16
  iscsi_target_mod,target_core_pscsi,target_core_mod,sg,sr_mod,mptctl,sd_mod,
  scsi_dh_rdac,scsi_dh_emc,scsi_dh_alua,scsi_dh_hp_sw,scsi_dh,libata,mptspi,
  mptscsih,scsi_transport_spi
</screen>

  </section>
  <section xml:id="b13g8r6r">
   <title>iSCSI LIOターゲットが他のコンピュータで表示されない</title>
   <para>ターゲットサーバでファイアウォールを使用している場合は、他のコンピュータでiSCSI LIOターゲットを表示できるようにするために使用するiSCSIポートを開く必要があります。詳細については、<xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/>の<xref linkend="b12jaucl" xrefstyle="StepXRef"/>を参照してください。</para>
  </section>
 </section>
 <section xml:id="b12iqi8o">
  <title>iSCSI LIOターゲットの用語</title>
  <variablelist>
   <varlistentry xml:id="b12iqi8p">
    <term>backstore</term>
    <listitem>
     <para>iSCSIのエンドポイントの基礎となる実際のストレージを提供する、物理的ストレージオブジェクト。 </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12ir33x">
    <term>CDB (command descriptor block)</term>
    <listitem>
     <para>SCSIコマンドの標準フォーマット CDBは一般的に6、10、または12バイトの長さですが、16バイトまたは可変長でも構いません。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8q">
    <term>CHAP (Challenge Handshake Authentication Protocol)</term>
    <listitem>
     <para>ポイントツーポイントプロトコル(PPP)の認証方法で、あるコンピュータのアイデンティティを別のコンピュータに対して確認するために使用します。Link Control Protocol (LCP)によって2台のコンピュータが接続され、CHAPメソッドがネゴシエートされた後、認証者はランダムなチャレンジをピアに送信します。ピアは、チャレンジおよび秘密鍵に依存した、暗号学的にハッシュされたレスポンスを発行します。認証者は、ハッシュされたレスポンスを、予想されるハッシュ値の自身の計算に対して検証し、認証を了承するか、接続を終了します。CHAPは、<link xlink:href="http://www.ietf.org">Internet Engineering Task Force (IETF)</link> RFC 1994で定義されました。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8r">
    <term>CID (接続識別子)</term>
    <listitem>
     <para>イニシエータが生成する16ビットの番号で、2つのiSCSIデバイス間の接続を、一意に識別するもの。この番号は、ログインフェーズの間に提示されます。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8s">
    <term>エンドポイント</term>
    <listitem>
     <para> iSCSIターゲット名とiSCSI TPG (IQN + Tag)の組み合わせ</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8t">
    <term>EUI (extended unique identifier)</term>
    <listitem>
     <para>世界中のあらゆるデバイスを一意に識別する、64ビットの番号。フォーマットは、会社ごとに一意である24ビットと、その会社が自社の各デバイスに割り当てる40ビットで構成されます。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8u">
    <term>イニシエータ</term>
    <listitem>
     <para>SCSIセッションの開始エンド。通常は、コンピュータなどの制御デバイス。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8v">
    <term>IPS (Internet Protocol storage)</term>
    <listitem>
     <para>IPプロトコルを使用してストレージネットワーク内のデータを移動する、プロトコルまたはデバイスのクラス。FCIP (Fibre Channel over Internet Protocol)、iFCP (Internet Fibre Channel Protocol)、およびiSCSI (Internet SCSI)は、すべてIPSプロトコルの例です。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8w">
    <term>IQN (iSCSI qualified name)</term>
    <listitem>
     <para>世界中のあらゆるデバイスを一意に識別する、iSCSIの名前形式(たとえば: <filename>iqn.5886.com.acme.tapedrive.sn‐a12345678</filename>)。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8x">
    <term>ISID (initiator session identifier)</term>
    <listitem>
     <para> イニシエータが生成する48ビットの番号で、イニシエータとターゲット間のセッションを一意に識別するもの。この値はログインプロセスの間に作成され、ログインPDUとともにターゲットに送られます。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8y">
    <term>MCS (multiple connections per session)</term>
    <listitem>
     <para>iSCSI仕様の一部で、イニシエータとターゲット間での複数のTCP/IP接続を可能にするもの。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqi8z">
    <term>MPIO (multipath I/O)</term>
    <listitem>
     <para>サーバとストレージ間でデータが複数の冗長パスをとることができるメソッド。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqu8e">
    <term>ネットワークポータル</term>
    <listitem>
     <para>iSCSIエンドポイントと、IPアドレスプラスTCP (Transmission Control Protocol)ポートの組み合わせ。TCPポート3260が、iSCSIプロトコル用のポート番号です。これは、IANA (Internet Assigned Numbers Authority)により定義されています。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqu8f">
    <term>SAM (SCSI architectural model)</term>
    <listitem>
     <para>SCSIの動作を一般的な表記で記載した文書で、異なる種類のデバイスがさまざまなメディア上で通信することを可能にするもの。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqu8g">
    <term>ターゲット</term>
    <listitem>
     <para>SCSIセッションの受信側で、通常はディスクドライブ、テープドライブ、スキャナなどのデバイス。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12iqu8h">
    <term>ターゲットグループ(TG)</term>
    <listitem>
     <para>ビューの作成時にすべて同じ扱いを受ける、SCSIターゲットポートのリスト。ビューを作成することで、LUN (論理ユニット番号)のマッピングが容易になります。それぞれのビューエントリが、ターゲットグループ、ホストグループ、およびLUNを指定します。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12ir33y">
    <term>ターゲットポート</term>
    <listitem>
     <para>iSCSIエンドポイントと、1つ以上のLUNの組み合わせ。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12ir33z">
    <term>ターゲットポートグループ(TPG)</term>
    <listitem>
     <para>IPアドレスとTCPポート番号のリストで、特定のiSCSIターゲットがどのインタフェースから受信するかを決定するもの。</para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="b12ir340">
    <term>ターゲットセッション識別子(TSID)</term>
    <listitem>
     <para>ターゲットが生成する 16ビットの番号で、イニシエータとターゲット間のセッションを一意に識別するもの。この値はログインプロセスの間に作成され、ログインレスポンスPDU(プロトコルデータユニット)とともにイニシエータに送られます。</para>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" xml:id="cha-fcoe" xml:lang="ja" revision="02/01/12" xml:base="06_fcoe.xml"><title>Fibre Channel Storage over Ethernet Networks: FCoE</title><info/>
 
 <para>多くの企業のデータセンターが、そのLANおよびデータトラフィックをEthernetに依存し、またそのストレージインフラストラクチャをファイバチャネルに依存しています。Open Fibre Channel over Ethernet (FCoE)イニシエータソフトウェアは、Ethernetアダプタが付いたサーバが、Ethernetネットワーク上でファイバチャネルストレージに接続できるようにします。このコネクティビティはこれまで、ファイバチャネルファブリック上にファイバチャネルアダプタを有するシステム用に、独占的に確保されていました。FCoEテクノロジは、ネットワークコンバージェンスを支援することで、データセンター内の複雑性を減らします。これにより、ファイバチャネルストレージへの既存の投資を無駄にすることなく、ネットワーク管理を簡素化することができます。 </para>
 <figure pgwide="0" xml:id="bwkfm8v">
  <title>Open Fibre Channel over Ethernet SAN</title>
  <mediaobject>
   <imageobject role="fo">
   <imagedata fileref="fcoe_san_a.png" width="445pt" format="eps"/></imageobject>
   <imageobject role="html">
   <imagedata fileref="fcoe_san_a.png" width="445pt" format="png"/></imageobject>
  </mediaobject>
 </figure>
 <para>Open-FCoEでは、ホストバスアダプタ上の専有のハードウェアではなく、ホストでファイバチャネルのプロトコルを実行することができます。対象としているのは10 Gbps (ギガバイト/秒)のEthernetアダプタですが、PAUSEフレームに対応したすべてのEthernetアダプタで使用可能です。イニシエータソフトウェアにより、ファイバチャネルプロトコルの処理モジュールと、Ethernetベースのトランスポートモジュールが提供されます。Open-FCoEモジュールは、SCSI用の低レベルドライバの役割を果たします。Open-FCoEトランスポートは、<command>net_device</command>を使用してパケットの送受信を行います。DCB(データセンターブリッジング)ドライバにより、FCoE向けのサービスの質が提供されます。 </para>
 <para>FCoEは、ファイバチャネルフレームを変えずに、ファイバチャネルのプロトコルトラフィックをEthernet接続上で動かす、カプセル化プロトコルです。これにより、ネットワークセキュリティとトラフィック管理インフラストラクチャが、ファイバチャネルにおけるのと同じようにFCoEでも機能することができます。</para>
 <para>以下の条件が当てはまる企業では、Open-FCoEの導入を選択してもよいでしょう。 </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>すでにファイバチャネルストレージシステムがあり、ファイバチャネルのスキルと知識を持つ管理者がいる。</para>
  </listitem>
  <listitem>
   <para>ネットワーク内に、10 GbpsのEthernetを展開している。</para>
  </listitem>
 </itemizedlist>
 <para>この項では、ネットワークにFCoEを設定する方法を説明します。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bxurl07" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycsjf0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxyqov2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuri58" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuptlv" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycscw6" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycscw7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuqb00" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="bxurl07">
  <title>FCoEおよびYaSTのFCoEクライアントのインストール</title>
  <para>サーバへの接続用のスイッチでFCoEを有効にすることで、ストレージインフラストラクチャ内にFCoEディスクを設定することができます。SUSE Linux Enterprise Serverオペレーティングシステムのインストール時にFCoEディスクが利用可能であれば、FCoEイニシエータソフトウェアが、その時点で自動的にインストールされます。 </para>
  <para>FCoEイニシエータソフトウェアとYaST FCoEクライアントソフトウェアがインストールされていない場合は、次のプロシージャを使用して、既存のシステムにマニュアルでインストールします。</para>
  <procedure xml:id="bxurln0">
   <step xml:id="byd2977">
    <para>サーバに<systemitem>root</systemitem>ユーザとしてログインします。</para>
   </step>
   <step xml:id="bxurln1">
    <para>YaSTで、<guimenu>ソフトウェア</guimenu><guimenu>ソフトウェア管理</guimenu>を選択します。</para>
   </step>
   <step xml:id="bxurlrs">
    <para>次のFCoEパッケージを検索して選択します。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>open-fcoe</para>
     </listitem>
     <listitem>
      <para>yast2-fcoe-client</para>
     </listitem>
    </itemizedlist>
    <para role="intro">たとえば、<guimenu>検索</guimenu>フィールドに<literal>fcoe</literal>を入力して、<guimenu>検索</guimenu>をクリックしてソフトウェアパッケージを見つけてから、インストールしたい各ソフトウェアパッケージの横にあるチェックボックスをオンにします。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_install2_a.png" width="241pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="bxurni7">
    <para><guimenu>承諾</guimenu>をクリックし、次に<guimenu>続行</guimenu>をクリックして自動変更を承諾します。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bycsjf0">
  <title>インストール時におけるFCoEインタフェースの設定</title>
  <para>SUSE Linux Enterprise Server向けのYaSTのインストールでは、サーバとファイバチャネルストレージインフラストラクチャ間の接続用のスイッチでFCoEが有効になっていれば、オペレーティングシステムのインストール時にFCoEディスクの設定を行うことができます。一部のシステムBIOSタイプでは、FCoEディスクを自動的に検出することができ、そのディスクをYaSTのインストールソフトウェアに報告します。ただし、FCoEディスクの自動検出は、すべてのBIOSのタイプでサポートされているわけではありません。その場合、インストールの開始時に次の<command>withfcoe</command>オプションをカーネルのコマンドラインに追加することで、自動検出を有効にすることができます。</para>

<screen>
withfcoe=1
</screen>

  <para role="intro">FCoEディスクが検出されると、YaSTのインストールでは、同時にFCoEを設定するオプションがあります。[ディスクアクティベーション]ページで、<guimenu>FCoEインタフェースの設定</guimenu>を選択して、FCoEの設定にアクセスします。FCoEインタフェースの設定については、<xref linkend="bxyqov2" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
  <informalfigure pgwide="0">
   <mediaobject>
    <imageobject>
    <imagedata fileref="fcoe_inst_disk_activation_a.png" width="253pt" format="png"/></imageobject>
   </mediaobject>
  </informalfigure>
 </section>
 <section xml:id="bxyqov2">
  <title>YaSTを使用したFCoEサービスの管理</title>
  <para>YaST FCoEクライアント設定オプションを使用して、お使いのファイバチャネルストレージインフラストラクチャ内のFCoEディスク用のFCoEインタフェースの作成、設定、および削除ができます。このオプションを使用するには、FCoEイニシエータサービス(<filename>fcoemon</filename>デーモン)およびLink Layer Discovery Protocolエージェントデーモン(<command>lldpad</command>)がインストールされて実行中であり、FCoE接続が、FCoE対応のスイッチで有効になっている必要があります。</para>
  <procedure xml:id="bxyqpcm">
   <step xml:id="bxyqpcn">
    <para><systemitem>root</systemitem>ユーザとしてログインし、YaSTを起動します。</para>
   </step>
   <step xml:id="bxyqpl8">
    <para>YaSTで、<guimenu>ネットワークサービス</guimenu><guimenu>FCoEクライアントの設定</guimenu>と選択します。 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_yast2_a.png" width="191pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <para>[Fibre Channel over Ethernet Configuration]ダイアログボックスには、次の3つのタブがあります。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para><guimenu>サービス</guimenu></para>
     </listitem>
     <listitem>
      <para><guimenu>インタフェース</guimenu></para>
     </listitem>
     <listitem>
      <para><guimenu>環境設定</guimenu></para>
     </listitem>
    </itemizedlist>
   </step>
   <step xml:id="bycsvr4">
    <para role="intro"><guimenu>サービス</guimenu>タブで、FCoEサービスとLldpad (Link Layer Discovery Protocolエージェントデーモン)サービスの開始時刻を確認し、必要に応じて変更します。 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_services_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="bycssp2" role="intro">
       <title>FCoEサービスの開始:</title>
       <para>Fibre Channel over Ethernetサービスの<command>fcoemon</command>デーモンを、サーバの起動時に開始するか、マニュアルで開始するかを指定します。このデーモンは、FCoEインタフェースを制御して、<command>lldpad</command>デーモンとの接続を確立します。値は、<guimenu>起動時</guimenu>(デフォルト)または<guimenu>マニュアル</guimenu>です。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="bycsvr5" role="intro">
       <title>Lldpadサービスの開始:</title>
       <para>Link Layer Discovery Protocolエージェント<command>lldpad</command>デーモンを、サーバの起動時に開始するか、マニュアルで開始するかを指定します。<command>lldpad</command>デーモンは、データセンターブリッジング機能およびFCoEインタフェースの設定について、<command>fcoemon</command>デーモンに情報を送ります。値は、<guimenu>起動時</guimenu>(デフォルト)または<guimenu>マニュアル</guimenu>です。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>設定を変更した場合は、<guimenu>OK</guimenu>をクリックして変更内容を保存して適用します。</para>
   </step>
   <step xml:id="bycsxr4">
    <para><guimenu>インタフェース</guimenu>タブで、サーバ上で検出されたすべてのネットワークアダプタに関する情報(VLANおよびFCoEの設定に関する情報を含む)を確認します。また、FCoE VLANインタフェースの作成や既存のFCoEインタフェース設定の変更、FCoEインタフェースの削除もできます。</para>
    <formalpara xml:id="byct84b" role="intro">
     <title>FCoE情報の参照</title>
     <para/>
    </formalpara>
    <para role="intro"><guimenu>FCoEインタフェース</guimenu>テーブルには、各アダプタに関する次の情報が表示されます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_notconfig_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="byd3h1o" role="intro">
       <title>デバイス名:</title>
       <para><filename>eth4</filename>などのアダプタ名を示します。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="byd3hdt">
       <title>モデル:</title>
       <para>アダプタのモデル情報を示します。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="byd3l6i" role="intro">
       <title>FCoE VLANインタフェース</title>
       <para/>
      </formalpara>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara xml:id="byd3nbb">
         <title>インタフェース名:</title>
         <para>インタフェースに名前が割り当てられている(<filename>eth4.200</filename>など)場合は、スイッチでFCoEが利用可能であり、FCoEインタフェースがアダプタに対してアクティブになっています。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara xml:id="byd3o01">
         <title>未設定:</title>
         <para>状態が<guimenu>未設定</guimenu>である場合は、スイッチでFCoEが有効になっていますが、FCoEインタフェースはアダプタに対してアクティブになっていません。アダプタでインタフェースを有効にするには、アダプタを選択して、<guimenu>FCoE VLANインタフェースを作成</guimenu>をクリックします。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara xml:id="byd3ohg">
         <title>使用不可:</title>
         <para>状態が<guimenu>使用不可</guimenu>である場合は、FCoEがスイッチ上のその接続に対して有効になっていないため、そのアダプタではFCoEは使えません。 </para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <formalpara xml:id="byd3mds">
       <title>FCoEの有効化:</title>
       <para>アダプタ接続に対して、スイッチでFCoEを有効にするかどうかを指定します。(<guimenu>はい</guimenu>または<guimenu>いいえ</guimenu>)</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="byd3pvk">
       <title>DCBが必要:</title>
       <para>アダプタでデータセンターブリッジングが必要かどうかを指定します。(<guimenu>はい</guimenu>または<guimenu>いいえ</guimenu>)</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="byd3qba">
       <title>Auto VLAN:</title>
       <para>アダプタでVLAN設定を有効にするかどうかを指定します。(<guimenu>はい</guimenu>または<guimenu>いいえ</guimenu>)</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="byd3r0o">
       <title>DCB対応:</title>
       <para>アダプタがデータセンターブリッジングをサポートするかどうかを指定します。(<guimenu>はい</guimenu>または<guimenu>いいえ</guimenu>)</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <formalpara xml:id="byct8zr" role="intro">
     <title>FCoE設定を変更</title>
     <para/>
    </formalpara>
    <para role="intro">FCoE VLANインタフェースを選択して、ページの下部にある<guimenu>設定を変更</guimenu>をクリックして、[FCoE設定を変更]ダイアログボックスを開きます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_modify_config_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="byctmy6">
       <title>FCoEの有効化:</title>
       <para>アダプタに対してFCoEインスタンスの作成を有効または無効にします。値は、<guimenu>はい</guimenu>または<guimenu>いいえ</guimenu>です。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="byctn94">
       <title>DCBが必要:</title>
       <para>データセンターブリッジングがアダプタに必要かどうかを指定します。値は、<guimenu>はい</guimenu>(デフォルト)または<guimenu>いいえ</guimenu>です。DCBは通常、必要です。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="byctn95">
       <title>Auto VLAN:</title>
       <para><filename>fcoemon</filename>デーモンでVLANインタフェースを作成するかどうかを指定します。値は、<guimenu>はい</guimenu>または<guimenu>いいえ</guimenu>です。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>設定を変更した場合は、<guimenu>次へ</guimenu>をクリックして変更内容を保存して適用します。設定は、<filename>/etc/fcoe/eth<replaceable>X</replaceable></filename>ファイルに書き込まれます。<command>fcoemon</command>デーモンにより、同デーモンが初期化された時に、各FCoEインタフェースに対して環境設定ファイルが読み込まれます。すべてのFCoEインタフェースに対してファイルがあります。 </para>
    <formalpara xml:id="byctarx" role="intro">
     <title>FCoE VLANインタフェースを作成</title>
     <para/>
    </formalpara>
    <para role="intro">FCoEが有効になっていてもまだ構成されていないアダプタを選択して、<guimenu>はい</guimenu>をクリックして、FCoEインタフェースを構成します。割り当てられたインタフェース名(<filename>eth5.200</filename>など)が一覧に表示されます。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_create_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <formalpara xml:id="byct8zs" role="intro">
     <title>FCoEインタフェースを削除</title>
     <para/>
    </formalpara>
    <para role="intro">削除したいFCoEインタフェースを選択して、ページの下部にある<guimenu>インタフェースを削除</guimenu>をクリックし、<guimenu>続行</guimenu>をクリックして確定します。FCoEインタフェースの値が、<guimenu>未構成</guimenu>に変わります。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_remove_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step xml:id="bxyqqb9">
    <para role="intro"><guimenu>設定</guimenu>タブで、FCoEシステムサービスの全般設定を確認または変更します。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_configtab_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara xml:id="bycsz4d" role="intro">
       <title>デバッグ:</title>
       <para>FCoEのサービススクリプトおよび<command>fcoemon</command>デーモンからの、デバッグのメッセージを有効または無効にします。値は、<guimenu>はい</guimenu>または<guimenu/>いいえ](デフォルト)です。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara xml:id="bycsz4e" role="intro">
       <title>syslogを使用:</title>
       <para>メッセージをシステムログ(<filename>/var/log/syslog</filename>)に送信するかどうかを指定します。値は、<guimenu>はい</guimenu>(デフォルト)または<guimenu>いいえ</guimenu>です。(データは、<filename>/var/log/messages</filename>にログされます。)</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>設定を変更した場合は、<guimenu>OK</guimenu>をクリックして変更内容を保存して適用します。設定は、<filename>/etc/fcoe/config</filename>ファイルに書き込まれます。</para>
   </step>
   <step xml:id="bxyqr8g">
    <para><guimenu>OK</guimenu>をクリックして、変更内容を保存して適用します。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="bxuri58">
  <title>コマンドを使用したFCoEの設定</title>
  <procedure xml:id="bxupm0j">
   <step xml:id="bxupo5v">
    <para><systemitem>root</systemitem>ユーザとしてサーバにログインして、端末コンソールを起動します。</para>
   </step>
   <step xml:id="bxupmnl">
    <para>YaSTを使用して、Ethernetネットワークインタフェースカード(<filename>eth2</filename>など)を設定します。</para>
   </step>
   <step xml:id="bxuslhx">
    <para>Link Layer Discovery Protocolエージェントデーモン(<command>lldpad</command>)を起動します。</para>

<screen>
rclldpad start
</screen>

   </step>
   <step xml:id="bxupmpk">
    <para role="intro">お使いのEthernetアダプタ上で、データセンターブリッジングを有効にします<filename/>。</para>

<screen>
dcbtool sc eth2 dcb on
  Version:       2
  Command:       Set Config
  Feature:       DCB State
  Port:          eth2
  Status:        Successful
</screen>

   </step>
   <step xml:id="bynkhpe">
    <para>Priority Flow Control (PFC)設定を、データセンターブリッジングに対して有効にします。</para>

<screen>
dcbtool sc eth&lt;x&gt; pfc e:1 a:1 w:1
</screen>

    <para>引数の設定値は次のとおりです。</para>
    <variablelist>
     <varlistentry xml:id="bynkj1s">
      <term>e:&lt;0|1&gt;</term>
      <listitem>
       <para>機能の有効化を制御します。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bynkjej">
      <term>a:&lt;0|1&gt;</term>
      <listitem>
       <para>機能を、データセンターブリッジング交換プロトコルを介してピアにアドバタイズするかどうかを制御します。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bynkjy8">
      <term>w:&lt;0|1&gt;</term>
      <listitem>
       <para> 機能が、ピアから受け取った内容に基づいてその運用設定を積極的に変更するかどうかを制御します。 </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step xml:id="bxuppth">
    <para>データセンターブリッジングを有効にして、FCoEに対するスイッチの優先度設定を受け入れます。</para>

<screen>
dcbtool sc eth2 app:fcoe e:1
  Version:       2
  Command:       Set Config
  Feature:       Application FCoE
  Port:          eth2
  Status:        Successful
</screen>

   </step>
   <step xml:id="bxupsun">
    <para>デフォルトのFCoE環境設定ファイルを、<filename>/etc/fcoe/cfg-eth2</filename>にコピーします。</para>

<screen>
cp /etc/fcoe/cfg-ethx /etc/fcoe/cfg-eth2

</screen>

   </step>
   <step xml:id="bxupsnh">
    <para>FCoEイニシエータサービスを開始します。</para>

<screen>
rcfcoe start
  Starting FCoE initiator service
</screen>

   </step>
   <step xml:id="bxuslzn">
    <para>Link Layer Discovery Protocolエージェントデーモン(<command>lldpad</command>)およびFCoEイニシエータサービスを、起動時に開始するよう設定します。</para>

<screen>
chkconfig boot.lldpad on

chkconfig boot.fcoe on
</screen>

   </step>
  </procedure>
 </section>
 <section xml:id="bxuptlv">
  <title>FCoE管理ツールを使用したFCoEインスタンスの管理</title>
  <para><command>fcoeadm</command>ユーティリティは、Open-FCoEプロジェクト用の、Fibre Channel over Ethernet (FCoE)管理ツールです。これを使用して、所定のネットワークインタフェースのFCoEインスタンスの作成、破棄、およびリセットを行うことができます。<command>fcoeadm</command>ユーティリティは、ソケットインタフェースを通じて、実行中の<command>fcoemon</command>プロセスにコマンドを送ります。<command>fcoemon</command>の詳細については、<command>fcoemon(8)</command>マニュアルページを参照してください。</para>
  <para><command>fcoeadm</command>ユーティリティを使用して、以下に関してFCoEインスタンスにクエリを行うことができます。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>インタフェース</para>
   </listitem>
   <listitem>
    <para>ターゲットLUN</para>
   </listitem>
   <listitem>
    <para>ポートの統計データ</para>
   </listitem>
  </itemizedlist>
  <para> <command>fcoeadm</command>ユーティリティは、<filename>fcoe-utils</filename>パッケージの一部です。<link xlink:href="http://open-fcoe.org/">Open-FCoEプロジェクト</link>により保守管理されています。</para>
  <variablelist>
   <varlistentry xml:id="bxuq220">
    <term>構文</term>
    <listitem>
     <para>Fiber Channel over Ethernet Administrationバージョン1.0.12.</para>

<screen>
fcoeadm
  [-c|--create] [&lt;ethX&gt;]
  [-d|--destroy] [&lt;ethX&gt;]
  [-r|--reset] [&lt;ethX&gt;]
  [-S|--Scan] [&lt;ethX&gt;]
  [-i|--interface] [&lt;ethX&gt;]
  [-t|--target] [&lt;ethX&gt;]
  [-l|--lun] [&lt;ethX&gt;]
  [-s|--stats &lt;ethX&gt;] [&lt;interval&gt;]
  [-v|--version]
  [-h|--help]
</screen>

    </listitem>
   </varlistentry>
   <varlistentry xml:id="bxus2zv">
    <term>オプション</term>
    <listitem>
     <variablelist>
      <varlistentry xml:id="bxus360">
       <term><literal>-c</literal></term>
       <term><literal>--create &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>指定したネットワークインタフェースに基づいてFCoEインスタンスを作成します。<command>fcoemon</command>設定ファイルがOpen-FCoEサービスデーモンインタフェース(<filename>/etc/fcoe/cfg-ethx</filename>、<command>fcoemon(8)</command>マニュアルページを参照)に対して存在しない場合、作成したFCoEインスタンスはデータセンターブリッジングを必要としません。</para>
        <formalpara xml:id="bycrwhb">
         <title>例:</title>
         <para>FCoEインスタンスを<filename>eth2.101</filename>上に作成する:</para>
        </formalpara>

<screen>
fcoeadm -c eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxus6nh">
       <term><literal>-d</literal></term>
       <term><literal>--destroy &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>指定したネットワークインタフェース上のFCoEインスタンスを破棄します。これによって、<command>fipvlan</command>で作成されたFCoEインスタンスが破棄されることはありません。</para>
        <formalpara xml:id="bycrz5k">
         <title>例:</title>
         <para>FCoEインスタンス上の<filename>eth2.101</filename>を破棄する:</para>
        </formalpara>

<screen>
fcoeadm -d eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxusdp0">
       <term><literal>-h</literal></term>
       <term><literal>--help</literal></term>
       <listitem>
        <para><command>fcoeadm</command>コマンドの使用に関するメッセージを表示します。</para>
       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxusaym">
       <term><literal>-i</literal></term>
       <term><literal>--interface [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>指定したネットワークインタフェース上のFCoEインスタンスに関する情報を表示します。ネットワークインタフェースを指定しない場合は、すべてのFCoEインスタンスに関する情報を表示します。</para>
        <formalpara xml:id="bycrz5l">
         <title>例</title>
         <para/>
        </formalpara>
        <para>FCoEインスタンスが作成されているアダプタとそのポートのすべてに関する情報を表示する:</para>

<screen>
fcoeadm -i
</screen>

        <para>インタフェース<filename>eth3</filename>上のFCoEインスタンスすべてに関する情報を表示する:</para>

<screen>
fcoeadm -i eth3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxusayp">
       <term><literal>-l</literal></term>
       <term><literal>--lun [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>指定したネットワークインタフェース上のFCoEインスタンスに関連付けられた、検出されたSCSI LUNに関する詳細情報を表示します。ネットワークインタフェースを指定しない場合は、すべてのFCoEインスタンスからのSCSI LUNに関する情報を表示します。</para>
        <formalpara xml:id="bycs78a" role="intro">
         <title>例</title>
         <para/>
        </formalpara>
        <para role="intro">すべてのFCoE接続上で検出されたLUNのすべてに関する詳細情報を表示する:</para>

<screen>
fcoeadm -l
</screen>

        <para><filename>eth3.101</filename>など、特定の接続上で検出されたLUNのすべてに関する情報を表示する:</para>

<screen>
fcoeadm -l eth3.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxus75n">
       <term><literal>-r</literal></term>
       <term><literal>--reset &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>指定したネットワークインタフェース上のFCoEインスタンスをリセットします。これによって、<command>fipvlan</command>で作成されたFCoEインスタンスがリセットされることはありません。</para>
        <formalpara xml:id="bycrz5m">
         <title>例:</title>
         <para><filename>eth2.101</filename>上のFCoEインスタンスをリセットする:</para>
        </formalpara>

<screen>
fcoeadm -r eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxuscy5">
       <term><literal>-s</literal></term>
       <term><literal>--stats &lt;eth<replaceable>X</replaceable>&gt; [interval]</literal></term>
       <listitem>
        <para>指定したネットワークインタフェース上のFCoEインスタンスの統計情報(FC4統計情報を含む)を表示します。一定の時間間隔で1行ずつ表示します。間隔の値を、0より大きい整数で指定します。間隔の値は、秒単位での間隔の経過時間です。間隔を指定しない場合、デフォルトの間隔は1秒です。</para>
        <formalpara xml:id="bycs78b">
         <title>例:</title>
         <para/>
        </formalpara>
        <para>FCoEインスタンスを持つ特定の<filename>eth3</filename>ポートに関する統計情報を表示できます。統計情報は、時間間隔ごとに1行ずつ表示されます。このコマンドでは、デフォルトの間隔である1秒は指定していません。</para>

<screen>
fcoeadm -s eth3
</screen>

        <para>FCoEインスタンスを持つ特定の<filename>eth3</filename>ポートに関する統計情報を、3秒間隔で表示する場合。統計情報は、時間間隔ごとに1行ずつ表示されます。 </para>

<screen>
fcoeadm -s eth3 3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxusayn">
       <term><literal>-S</literal></term>
       <term><literal>--Scan &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>指定したネットワークインタフェースに対する新規のターゲットとLUNを再スキャンします。これによって、同じポート上で作成されたNPIV (N_Port ID Virtualization)インスタンスが再スキャンされることはなく、また <command>fipvlan</command>により作成されたFCoEインスタンスが再スキャンされることもありません。</para>
       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxusayo">
       <term><literal>-t</literal></term>
       <term><literal>--target [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>指定したネットワークインタフェース上のFCoEインスタンスに関連付けられた、検出されたターゲットに関する情報を表示します。ネットワークインタフェースを指定しない場合は、すべてのFCoEインスタンスからの検出されたターゲットに関する情報を表示します。</para>
        <formalpara xml:id="bycs3pt">
         <title>例</title>
         <para/>
        </formalpara>
        <para>FCoEインスタンスを持つポートのすべてからの、検出されたターゲットのすべてに関する情報を表示できます。ターゲットは、異なるアダプタカード上のものであることもあります。検出された各ターゲットの後ろに、関連付けられたLUNが列記されます。</para>

<screen>
fcoeadm -t
</screen>

        <para>FCoEインスタンスを持つ所定の<filename>eth3</filename>ポートからの、検出されたターゲットのすべてに関する情報を表示できます。検出された各ターゲットの後ろに、関連付けられたLUNが列記されます。</para>

<screen>
fcoeadm -t eth3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry xml:id="bxusdp1">
       <term><literal>-v</literal></term>
       <term><literal>--version</literal></term>
       <listitem>
        <para><command>fcoeadm</command>コマンドのバージョンを表示します。</para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="bxupx3p">
    <term>FCoEの応答例</term>
    <listitem>
     <variablelist>
      <varlistentry xml:id="bxupyie">
       <term>FC-IDノード/ポート番号に対するFCoEイニシエータの状態を表示</term>
       <listitem>

<screen role="screenshot">
fcoeadm -i eth0.201
  Description:      82599EB 10-Gigabit SFI/SFP+ Network Connection 
  Revision:         01
  Manufacturer:     Intel Corporation 
  Serial Number:    001B219B258C 
  Driver:           ixgbe 3.3.8-k2 
  Number of Ports:  1      

      Symbolic Name:     fcoe v0.1 over eth0.201     
      OS Device Name:    host8     
      Node Name:         0x1000001B219B258E     
      Port Name:         0x2000001B219B258E     
      FabricName:        0x2001000573D38141     
      Speed:             10 Gbit     
      Supported Speed:   10 Gbit     
      MaxFrameSize:      2112     
      FC-ID (Port ID):   0x790003     
      State:             Online
</screen>
</listitem>
      </varlistentry>
      <varlistentry xml:id="bxuq45l">
       <term>FC-IDノード/ポート番号に対するFCoEターゲットを表示</term>
       <listitem>

<screen role="screenshot">
fcoeadm -t eth0.201  
  Interface:        eth0.201 
  Roles:            FCP Target 
  Node Name:        0x200000D0231B5C72 
  Port Name:        0x210000D0231B5C72 
  Target ID:        0 
  MaxFrameSize:     2048 
  OS Device Name:   rport-8:0-7 
  FC-ID (Port ID):  0x79000C 
  State:            Online  

LUN ID  Device Name   Capacity   Block Size  Description 
------  -----------  ----------  ----------  ----------------------------     
    40  /dev/sdqi     792.84 GB      512     IFT DS S24F-R2840-4 (rev 386C)
    72  /dev/sdpk     650.00 GB      512     IFT DS S24F-R2840-4 (rev 386C)
   168  /dev/sdgy       1.30 TB      512     IFT DS S24F-R2840-4 (rev 386C)
</screen>
</listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 <section xml:id="bycscw6">
  <title>FCoEイニシエータディスク用のパーティションの設定</title>
  <para role="intro"><command>fdisk(8)</command>コマンドを使用して、FCoEイニシエータディスク用のパーティションを設定できます。</para>

<screen role="screenshot">
fdisk /dev/sdc
  Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel.
  Building a new DOS disklabel with disk identifier 0xfc691889.
  Changes will remain in memory only, until you decide to write them.
  After that, of course, the previous content won’t be recoverable.

  Warning: Invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

  Command (n for help): n
  Command action
     e    extended
     p    primary partition (1-4)

  p
     Partition number (1-4): 4
     First cylinder (1-1017, default 1): 
       Using default value 1
     Last cylinder, *cylinders or *size(K,M,G) (1-1017, default 1017):
       Using default value 1017

  Command (n for help): w
     The partition table has been altered!

     Calling loctl() to re-read partition table.
     Syncing disks.
</screen>

 </section>
 <section xml:id="bycscw7">
  <title>FCoEイニシエータディスクでのファイルシステムの作成</title>
  <para><command>mkfs(8)</command>コマンドを使用して、FCoEイニシエータディスクにファイルシステムを作成できます。</para>

<screen role="screenshot">
mkfs /dev/sdc
  mke2fs 1.41.9 (22-Aug-2011)
  /dev/sdc is entire device, not just one partition!
  Proceed anyway? (y, n) y
  Filesystem label=
  OS type: Linux
  Block size=4096 (log-2)
  262144 inodes, 1048576 blocks
  52428 blocks (5.00%) reserved for the super user
  First data block=0
  Maximum filesystem blocks=1073741824
  32 block groups
  32768 blocks per group, 32768 fragments per group
  8192 inodes per group
  Superblock backups stored on blocks:
          32768, 98304, 163840, 229376, 294912, 819200, 804736

  Writing inode tables: done
  Writing superblocks and filesystem accounting information: done

  This filesystem will be automatically checked every 27 mounts or
  180 days, whichever comes first. Use tune2fs -c or -i to override.
</screen>

 </section>
 <section xml:id="bxuqb00">
  <title>追加情報</title>
  <para>詳細については、以下のマニュアルを参照してください。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>Open-FCoEのサービスデーモンについては、<command>fcoemon(8)</command>マニュアルページを参照してください。</para>
   </listitem>
   <listitem>
    <para>Open-FCoEの管理ツールについては、<command>fcoeadm(8)</command>マニュアルページを参照してください。</para>
   </listitem>
   <listitem>
    <para>データセンターブリッジング設定ツールについては、<command>dcbtool(8)</command>マニュアルページを参照してください。</para>
   </listitem>
   <listitem>
    <para>Link Layer Discovery Protocolエージェントデーモンについては、<filename>lldpad(8)</filename>マニュアルページを参照してください。</para>
   </listitem>
   <listitem>
    <para><link xlink:href="http://www.open-fcoe.org/open-fcoe/wiki/quickstart"><citetitle>Open Fibre Channel over Ethernet Quick Start</citetitle></link>。</para>
   </listitem>
  </itemizedlist>
 </section>
</chapter>

<chapter xml:id="snapshots" xml:lang="ja" xml:base="07_snapshots.xml"><title>LVMボリュームスナップショット</title><info/>
 
 <para>LVM (Logical Volume Manager)論理ボリュームスナップショットはコピーオンライント技術の1つで、既存のボリュームのデータブロックに対する変更を監視し、いずれかのブロックに書き込みが行われると、スナップショット時のブロックの値がスナップショットボリュームにコピーされます。こうすることで、スナップショットボリュームが削除されるまで、データのその時点のコピーが保存されます。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi7xb8b" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biu259x" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi7uzm8" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="snapshot-xen-host" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvconvert-merge" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="bi7xb8b">
  <title>ボリュームスナップショットの理解</title>
  <para>ファイルシステムのスナップショットには、スナップショットの作成後に変更されたソース論理ボリュームのメタデータとデータブロックが含まれています。スナップショットを介してデータにアクセスすると、ソース論理ボリュームのその時点のコピーが表示されます。バックアップ媒体からデータを復元したり、変更されたデータを上書きする必要はありません。 </para>
  <important>
   <para>スナップショットのライフタイム中は、スナップショットを先にマウントしないと、ソース論理ボリュームをマウントできません。</para>
  </important>
  <para>LVMボリュームスナップショットでは、ファイルシステムのその時点のビューからバックアップを作成できます。スナップショットは瞬時に作成され、削除するまで保存されます。ボリューム自体はユーザが引き続き利用できるようにしながら、スナップショットからファイルシステムのバックアップを作成できます。当初のスナップショットには、スナップショットに関するメタデータが含まれていますが、ソース論理ボリュームの実際のデータは含まれていません。スナップショットはコピーオンライト技術を使用して、オリジナルデータブロックのデータ変更を検出します。スナップショットをとった際に保存されていた値をスナップショットボリューム内のブロックにコピーし、ソースブロックに新しいデータを保存することができます。ソース論理ボリュームで元の値から変更されるブロックが増えると、スナップショットのサイズが増えます。 </para>
  <para>スナップショットのサイズを決定する際には、ソース論理ボリュームに対して予想されるデータ変更量、およびスナップショットの保存期間を考慮する必要があります。スナップショットボリュームに割り当てるスペースの量は、ソース論理ボリュームのサイズ、スナップショットの保持予定期間、およびスナップショットのライフタイム中に変更が予期されるデータブロックの数によって異なります。スナップショットボリュームは、作成後のサイズ変更はできません。目安として、元の論理ボリュームの約10%のサイズで、スナップショットボリュームを作成してください。スナップショットの削除前に、ソース論理ボリューム内のすべてのブロックが1回以上変更されると予期される場合は、スナップボリュームのサイズを、少なくともソース論理ボリュームサイズにそのボリュームに関するメタデータ用スペースを加えたサイズにする必要があります。データ変更が頻繁でないか、またはライフタイムが十分短いと予期される場合、必要なスペースは少なくなります。</para>
  <para>LVM2では、スナップショットはデフォルトで読み書き可能です。データをスナップショットに直接書き込む際は、そのブロックは例外テーブルで使用中とマークされ、ソース論理ボリュームからのコピーは行われません。スナップショットボリュームをマウントし、そのスナップショットボリュームにデータを直接書き込むことによって、アプリケーションの変更をテストできます。スナップショットをマウント解除してスナップショットを削除し、ソース論理ボリュームを再マウントするだけで、変更を簡単に破棄できます。 </para>
  <para>仮想ゲスト環境では、物理サーバの場合と同様に、サーバのディスク上に作成するLVM論理ボリュームに対してスナップショット機能を使用できます。</para>
  <para>仮想ホスト環境では、スナップショット機能を使用して、仮想マシンのストレージバックエンドをバックアップしたり、仮想マシンイメージに対する変更(パッチやアップグレードなど)を、ソース論理ボリュームを変更せずにテストしたりできます。仮想マシンは、仮想ディスクファイルの使用ではなく、ストレージバックエンドとして、LVM論理ボリュームを使用する必要があります。LVM論理ボリュームをマウントし、ファイルに格納されたディスクとして仮想マシンイメージを保存するために使用できます。また、そのLVM論理ボリュームを物理ディスクとして割り当てて、ブロックデバイスとして書き込むことができます。</para>
  <para>SLES 11 SP3から、LVM論理ボリュームスナップショットはシンプロビジョニング可能になっています。サイズを指定しないでスナップショットを作成した場合は、シンプロビジョニングと想定されます。スナップショットは、シンプールから必要な領域を使用するシンボリュームとして作成されます。シンスナップショットボリュームは、他のシンボリュームと同じ特性を持ちます。ボリュームは個別にアクティブ化、拡張、名前変更、および削除でき、そのスナップショットを作成することもできます。</para>
  <important>
   <para>クラスタでシンプロビジョニングスナップショットを使用するには、ソース論理ボリュームとそのスナップショットを1つのクラスタリソースで管理する必要があります。これにより、ボリュームとそのスナップショットを常に同じノードに排他的にマウントできます。</para>
  </important>
  <para>スナップショットが不要になったら、必ず、システムからスナップショットを削除してください。ソース論理ボリュームでデータブロックが変化していくのに応じて、スナップショットは最終的に満杯になります。スナップショットは満杯になると使用不可になるので、ソース論理ボリュームの再マウントができなくなります。</para>
  <para>ソース論理ボリュームのスナップショットを複数作成している場合、スナップショットの削除は、最後に作成したものを最初に削除するという順番で行います。</para>
 </section>
 <section xml:id="bi7uttc">
  <title>LVMによるLinuxスナップショットの作成</title>
  <para>LVM (Logical Volume Manager)は、ファイルシステムのスナップショットの作成に使用できます。 </para>
  <procedure xml:id="bi7wb4p">
   <step xml:id="bi7wb4q">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザとしてログインし、次のように入力します。</para>

<screen>
lvcreate -s [-L <replaceable>&lt;size</replaceable>&gt;] -n <replaceable>snap_volume</replaceable> <replaceable>source_volume_path</replaceable>
</screen>

    <para>サイズを指定しない場合、スナップショットはシンスナップショットとして作成されます。</para>
    <para>次に例を示します。</para>

<screen>
lvcreate -s -L 1G -n linux01-snap /dev/lvm/linux01
</screen>

    <para>スナップショットが<filename>/dev/lvm/linux01-snap</filename>ボリュームとして作成されます。</para>
   </step>
  </procedure>
 </section>
 <section xml:id="biu259x">
  <title>スナップショットの監視</title>
  <procedure xml:id="biu25qe">
   <step xml:id="biu25qf">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザとしてログインし、次のように入力します。</para>

<screen>
lvdisplay <replaceable>snap_volume</replaceable>
</screen>

    <para>次に例を示します。</para>

<screen>
lvdisplay /dev/vg01/linux01-snap

--- Logical volume ---
  LV Name                /dev/lvm/linux01
  VG Name                vg01
  LV UUID                QHVJYh-PR3s-A4SG-s4Aa-MyWN-Ra7a-HL47KL
  LV Write Access        read/write
  LV snapshot status     active destination for /dev/lvm/linux01
  LV Status              available
  # open                 0
  LV Size                80.00 GB
  Current LE             1024
  COW-table size         8.00 GB
  COW-table LE           512
  Allocated to snapshot  30%
  Snapshot chunk size    8.00 KB
  Segments               1
  Allocation             inherit
  Read ahead sectors     0
  Block device           254:5
</screen>

   </step>
  </procedure>
 </section>
 <section xml:id="bi7uzm8">
  <title>Linuxスナップショットの削除</title>
  <procedure xml:id="bi7x85s">
   <step xml:id="bi7x85t">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザとしてログインし、次のように入力します。</para>

<screen>
lvremove <replaceable>snap_volume_path</replaceable>
</screen>

    <para>次に例を示します。</para>

<screen>
lvremove /dev/lvmvg/linux01-snap
</screen>

   </step>
  </procedure>
 </section>
 <section xml:id="snapshot-xen-host">
  <title>仮想ホスト上の仮想マシンに対するスナップショットの使用</title>
  <para>仮想マシンのバックエンドストレージにLVM論理ボリュームを使用すると、基礎となるデバイスを柔軟に管理でき、ストレージオブジェクトの移動、スナップショットの作成、データのバックアップなどの操作を容易に行うことができるようになります。LVM論理ボリュームをマウントし、ファイルに格納されたディスクとして仮想マシンイメージを保存するために使用できます。また、そのLVM論理ボリュームを物理ディスクとして割り当てて、ブロックデバイスとして書き込むことができます。LVM論理ボリューム上に仮想ディスクイメージを作成してから、LVMのスナップショットを作成できます。 </para>
  <para>スナップショットの読み込み/書き込み機能を利用して、1つの仮想マシンのインスタンスを複数作成できます。この場合、変更は、仮想マシンの特定のインスタンスのスナップショットに対して行われます。LVM論理ボリューム上に仮想ディスクイメージを作成してソース論理ボリュームのスナップショットを作成し、仮想マシンの特定のインスタンスのスナップショットを変更できます。ソース論理ボリュームのスナップショットをもう1つ作成して、仮想マシンの別のインスタンス用に変更できます。複数の仮想マシンインスタンスのデータの大部分は、ソース論理ボリューム上のイメージと共に存在します。</para>
  <para>スナップショットの読み込み/書き込み機能を利用すると、仮想ディスクイメージを維持したまま、ゲスト環境でパッチやアップグレードをテストすることもできます。そのイメージが含まれるLVMボリュームのスナップショットを作成し、そのスナップショットの場所で仮想マシンを実行します。ソース論理ボリュームは変更されず、そのマシンに対する変更はすべてスナップショットに書き込まれます。仮想マシンイメージのソース論理ボリュームに戻るには、仮想マシンの電源をオフにした後、ソース論理ボリュームからスナップショットを削除します。もう一度やり直すには、スナップショットを再作成してマウントしてから、スナップショットイメージ上で仮想マシンを再起動します。 </para>
  <important>
   <para>次の手順では、ファイルに格納された仮想ディスクイメージとXenハイパーバイザを使用します。本項の手順は、KVMなど、SUSE Linuxプラットフォーム上で動作する他のハイパーバイザに適用できます。</para>
  </important>
  <para>スナップショットボリュームからファイルに格納された仮想マシンイメージを実行するには:</para>
  <procedure xml:id="b17cn63v">
   <step xml:id="b17cnkv7">
    <para>ファイルに格納された仮想マシンイメージが含まれるソース論理ボリュームがマウントされていることを確認します(たとえば、マウントポイント<filename>/var/lib/xen/images/&lt;<replaceable>イメージ名</replaceable>&gt;</filename>)。 </para>
   </step>
   <step xml:id="b17cn63w">
    <para>予想される差分を保存するのに十分な領域があるLVM論理ボリュームのスナップショットを作成します。 </para>

<screen>
lvcreate -s -L 20G -n myvm-snap /dev/lvmvg/myvm
</screen>

    <para>サイズを指定しない場合、スナップショットはシンスナップショットとして作成されます。</para>
   </step>
   <step xml:id="b17cn8re">
    <para>スナップショットボリュームをマウントするマウントポイントを作成します。</para>

<screen>
mkdir -p /mnt/xen/vm/myvm-snap
</screen>

   </step>
   <step xml:id="b17cn8rf">
    <para role="intro">作成したマウントポイントにスナップショットボリュームをマウントします。</para>

<screen>
mount -t auto /dev/lvmvg/myvm-snap /mnt/xen/vm/myvm-snap
</screen>

   </step>
   <step xml:id="b17cnd0k">
    <para>テキストエディタで、ソース仮想マシンの設定ファイルをコピーし、マウントしたスナップショットボリューム上の、ファイルに格納されたイメージファイルを指すようにパスを変更し、ファイルを<filename>/etc/xen/myvm-snap.cfg</filename>などの名前で保存します。</para>
   </step>
   <step xml:id="b17cnd0l">
    <para>仮想マシンのマウント済みスナップショットボリュームを使用して、仮想マシンを起動します。</para>

<screen>
xm create -c /etc/xen/myvm-snap.cfg
</screen>

   </step>
   <step xml:id="b17cnd0m">
    <para>(オプション)スナップショットを削除して、ソース論理ボリューム上の変更されていない仮想マシンイメージを使用します。</para>

<screen>
unmount /mnt/xenvms/myvm-snap
lvremove -f /dev/lvmvg/mylvm-snap
</screen>

   </step>
   <step xml:id="b17cnd0n">
    <para>(オプション)このプロセスを必要なだけ繰り返します。 </para>
   </step>
  </procedure>
 </section>
 <section xml:id="lvconvert-merge">
  <title>スナップショットをソース論理ボリュームとマージして変更を元に戻すか、前の状態にロールバックする</title>
  <para>スナップショットは、ボリューム上のデータを前の状態にロールバックまたは復元する必要がある場合に役立ちます。たとえば、管理者の手違いがあった場合、またはパッケージのインストールやアップグレードが失敗したり望む内容と違ったりした場合、データ変更を元に戻さなければならないことがあります。 </para>
  <para><command>lvconvert --merge</command>コマンドを使用して、LVM論理ボリュームの変更を元に戻すことができます。マージは次のように開始されます。</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>ソース論理ボリュームとスナップショットボリュームが両方とも開かれていない場合、マージはすぐに開始されます。 </para>
   </listitem>
   <listitem>
    <para>ソース論理ボリュームまたはスナップショットボリュームが開かれていない場合、初めてソース論理ボリュームまたはスナップショットボリュームのどちらかがアクティブになって両方が閉じられた時点でマージが開始されます。 </para>
   </listitem>
   <listitem>
    <para><systemitem>root</systemitem>ファイルシステムのように、閉じることができないソース論理ボリュームの場合、次にサーバが再起動されてソース論理ボリュームがアクティブになるときまで、マージは延期されます。 </para>
   </listitem>
   <listitem>
    <para>ソース論理ボリュームに仮想マシンイメージが含まれる場合、仮想マシンをシャットダウンしてソース論理ボリュームとスナップショットボリュームを(この順序でマウント解除することによって)非アクティブにした後、mergeコマンドを発行する必要があります。マージ完了時に、ソース論理ボリュームが自動的に再マウントされてスナップショットボリュームは削除されるので、マージ完了後まで仮想マシンを再起動しないでください。マージが完了した後、生成された論理ボリュームを仮想マシンで使用します。</para>
   </listitem>
  </itemizedlist>
  <para>マージが開始されると、サーバ再起動後もマージは自動的に続行され、これはマージが完了するまで続きます。マージの進行中は、マージ中のソース論理ボリュームの新しいスナップショットを作成することはできません。 </para>
  <para>マージの進行中は、ソース論理ボリュームに対する読み込みまたは書き込みは、マージ中のスナップショットに透過的にリダイレクトされます。これにより、ユーザは直接、スナップショット作成時のデータを表示したり、そのデータにアクセスしたりできます。マージが完了するまで待つ必要はありません。 </para>
  <para>マージが完了すると、ソース論理ボリュームにはスナップショット作成時と同じデータと、マージ開始後に行われたデータ変更がすべて含まれます。生成された論理ボリュームの名前、マイナー番号、およびUUIDは、ソース論理ボリュームと同じです。ソース論理ボリュームは自動的に再マウントされ、スナップショットボリュームは削除されます。</para>
  <procedure xml:id="b15cjobl">
   <step xml:id="b15cjobm">
    <para>端末コンソールを開いて、<systemitem>root</systemitem>ユーザとしてログインし、次のように入力します。</para>

<screen role="compact2">
lvconvert --merge  [-b] [-i &lt;<replaceable>seconds</replaceable>&gt;] [&lt;<replaceable>snap_volume_path</replaceable>&gt;[...&lt;snapN&gt;]|@&lt;<replaceable>volume_tag</replaceable>&gt;]
</screen>

    <para>コマンドラインで1つ以上のスナップショットを指定できます。または、複数のソース論理ボリュームに同じボリュームタグを設定し、「<literal>@&lt;<replaceable>ボリュームタグ</replaceable>&gt;</literal>」と指定することもできます。タグ付きボリュームのスナップショットは、それぞれのソース論理ボリュームにマージされます。タグ付き論理ボリュームについては、<xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
    <para>次のオプションがあります。</para>
    <variablelist>
     <varlistentry xml:id="b15ck6lb">
      <term>-b</term>
      <term>--background</term>
      <listitem>
       <para>デーモンをバックグラウンドで実行します。これにより、指定した複数のスナップショットのマージを同時に並行して実行できます。</para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="b15ck6lc">
      <term>-i</term>
      <term>--interval &lt;<replaceable>seconds</replaceable>&gt;</term>
      <listitem>
       <para>進行状況を定期的にパーセント値でレポートします。間隔を秒単位で指定します。</para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>このコマンドの詳細については、<command>lvconvert(8)</command>のマニュアルページを参照してください。</para>
    <para>次に例を示します。</para>

<screen>
lvconvert --merge /dev/lvmvg/linux01-snap
</screen>

    <para>このコマンドは、<filename>/dev/lvmvg/linux01-snap</filename>をそのソース論理ボリュームにマージします。 </para>

<screen>
lvconvert --merge @mytag
</screen>

    <para><filename>lvol1</filename>、<filename>lvol2</filename>、および<filename>lvol3</filename>すべてにタグ<literal>mytag</literal>が付いている場合、各スナップショットは対応するソース論理ボリュームに順番にマージされます。すなわち、<filename>lvol1</filename>、<filename>lvol2</filename>、<filename>lvol3</filename>の順にマージされます。<literal>--background</literal>オプションが指定されている場合、各タグ付きソース論理ボリュームのスナップショットは同時に並行してマージされます。 </para>
   </step>
   <step xml:id="b15clkwi">
    <para>(オプション)ソース論理ボリュームとスナップショットが両方とも開いていて、閉じることができる場合、手動でソース論理ボリュームを非アクティブにしてからアクティブにすることによって、すぐにマージを開始できます。</para>

<screen>
umount &lt;<replaceable>original_volume</replaceable>&gt;
lvchange -an &lt;<replaceable>original_volume</replaceable>&gt;
lvchange -ay &lt;<replaceable>original_volume</replaceable>&gt;
mount &lt;<replaceable>original_volume</replaceable>&gt; &lt;<replaceable>mount_point</replaceable>&gt;
</screen>

    <para>次に例を示します。</para>

<screen>
umount /dev/lvmvg/lvol01
lvchange -an /dev/lvmvg/lvol01
lvchange -ay /dev/lvmvg/lvol01
mount /dev/lvmvg/lvol01 /mnt/lvol01
</screen>

   </step>
   <step xml:id="b15clm73">
    <para>(オプション)ソース論理ボリュームとスナップショットボリュームが両方とも開いていて、ソース論理ボリュームを閉じることができない場合(<systemitem>root</systemitem>ファイルシステムなど)、サーバを再起動してソース論理ボリュームをマウントすることによって、再起動後すぐにマージを開始できます。</para>
   </step>
  </procedure>
 </section>
</chapter>

<chapter xml:id="nfsv4acls" xml:lang="ja" xml:base="08a_nfsv4_acls.xml"><title>NFSv4上でのアクセス制御リストの管理</title><info/>
 
 <para>Linuxには、簡単なuser/group/otherの読み込み、書き込み、および実行(<literal>rwx</literal>)の各フラグ以上のACL (アクセス制御リスト)の標準は1つもありません。よりきめ細かな制御のオプションの1つに<citetitle>Draft POSIX ACL</citetitle>があります。ただし、これらのACLは、POSIXによって正式に標準化されたことはありません。もう1つは、NFSv4ネットワークファイルシステムの一部として設計されたNFSv4 ACLです。NFSv4 ACLは、Linux上のPOSIXシステムとMicrosoft Windows上のWIN32システム間に適切な互換性を提供することを目的としています。</para>
 <para>NFSv4 ACLは、Draft POSIX ACLを正しく実装できるほど十分ではないので、NFSv4クライアントへのACLアクセスのマッピングは試みられていません(<command>setfacl</command>の使用など)。</para>
 <para>NFSv4の使用時は、Draft POSIX ACLはエミュレーションでさえ使用できず、NFSv4 ACLを直接使用する必要があります。つまり、<command>setfacl</command>をNFSv3で動作させながら、NFSv4で動作させることはできません。NFSv4 ACLをNFSv4ファイルシステムで使用できるようにするため、SUSE Linux Enterprise Serverでは、次のファイルを含む<filename>nfs4-acl-tools</filename>パッケージを提供しています。</para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para><filename>nfs4-getfacl</filename></para>
  </listitem>
  <listitem>
   <para><filename>nfs4-setfacl</filename></para>
  </listitem>
  <listitem>
   <para><filename>nfs4-editacl</filename></para>
  </listitem>
 </itemizedlist>
 <para>これらのファイルは、NFSv4 ACLのチェックと変更について<command>getfacl</command>および<command>setfacl</command>と大体同様に動作します。これらのコマンドは、NFSサーバ上のファイルシステムがNFSv4 ACLのフルサポートを提供する場合のみ有効です。サーバによって課される制限は、クライアントで実行されているこれらのプログラムに影響を与え、ACE (Access Control Entries)の一部の特定の組み合わせが不可能なことがあります。</para>
 <para>エクスポート元のNFSサーバにNFSボリュームをローカルにマウントすることはサポートされていません。</para>
 <bridgehead xml:id="bxut1i2">追加情報</bridgehead>
 <para>詳細については、Linux-nfs.org Webサイト<link xlink:href="http://wiki.linux-nfs.org/wiki/index.php/ACLs#Introduction_to_NFSv4_ACLs"/>の<quote>Introduction to NFSv4 ACLs</quote>を参照してください。</para>
</chapter>

<chapter xml:id="trbl" xml:lang="ja" xml:base="08_troubleshooting.xml"><title>ストレージに関する問題のトラブルシュート</title><info/>
 
 <para>このセクションでは、デバイス、ソフトウェア、RAID、マルチパス I/O、およびボリュームの既知の問題に対処する方法について説明します。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="trblmpioboot" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="trbl-btrfs-volfull" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpklm" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpgil" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjphka" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="ts-iscsi-lio" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="trblmpioboot">
  <title>DM-MPIOはブートパーティションに使用できますか?</title>
  <para>DM-MPIO (Device Mapper Multipath I/O)は、SUSE Linux Enterprise Server 10 Support Pack 1から、ブートパーティション用にサポートされています。詳細については、<xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
 </section>
 <section xml:id="trbl-btrfs-volfull">
  <title>Btrfsエラー: デバイスに空き領域がない </title>
  <para>Btrfsファイルシステムを使用しているルート(<filename>/</filename>)パーティションにデータを書き込めなくなります。<quote><literal>No space left on device</literal></quote>というエラーが表示されます。</para>
  <para>考えられる原因とこの問題の回避策については、この後の各項を参照してください。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b15tk0m4" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15tk0m7" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b15tk0m4">
   <title>Snapperスナップショットによるディスク容量の使用</title>
   <para>BtrfsファイルシステムでSnapperが動作している場合、<quote><literal>No space left on device</literal></quote>が表示される問題は、通常は、システム上にスナップショットとして保存されているデータが多すぎるために発生します。</para>
   <para>Snapperからいくつかのスナップショットを削除することはできますが、スナップショットはすぐには削除されないので、必要な容量が解放されない可能性があります。 </para>
   <para>Snapperからファイルを削除するには:</para>
   <procedure xml:id="b15q34ft">
    <step xml:id="b15tk0m5">
     <para><systemitem>root</systemitem>ユーザとしてログインし、端末コンソールを起動します。</para>
    </step>
    <step xml:id="b15tk9ch">
     <para>システムが起動するだけの十分なディスク容量を再確保します。</para>
     <substeps performance="required">
      <step xml:id="b15tk0m6">
       <para>コマンドプロンプトで、次のように入力します</para>

<screen>
btrfs filesystem show
</screen>


<screen>
Label: none uuid: 40123456-cb2c-4678-8b3d-d014d1c78c78
 Total devices 1 FS bytes used 20.00GB
 devid 1 size 20.00GB used 20.00GB path /dev/sda3
</screen>

      </step>
      <step xml:id="b15q34fu">
       <para>次のように入力します。</para>

<screen>
btrfs fi balance start &lt;<replaceable>/mountpoint</replaceable>&gt; -dusage=5
</screen>

       <para>このコマンドは、データを空またはほぼ空のデータチャンクに再配置して、その容量を回収し、メタデータに再割り当てしようとします。この処理にはしばらくかかります(1TBで数時間)が、処理中もシステムは使用可能です。 </para>
      </step>
     </substeps>
    </step>
    <step xml:id="b15q34fv">
     <para>Snapperのスナップショットを一覧にします。次のように入力します。</para>

<screen>
snapper -c root list
</screen>

    </step>
    <step xml:id="b15q34fw">
     <para role="intro">Snapperから1つ以上のスナップショットを削除します。次のように入力します。</para>

<screen>
snapper -c root delete #
</screen>

     <para>必ず最も古いスナップショットを最初に削除してください。古いスナップショットほど、多くの容量を使用します。 </para>
    </step>
   </procedure>
   <para>この問題を回避するために、<filename>/etc/snapper/configs/root</filename>設定ファイルまたは他のマウントポイントで、Snapperクリーンアップのデフォルトをより制約された値に変更できます。Snapperには、古いスナップショットのクリーンアップアルゴリズムが3種類あります。このアルゴリズムは、日次のcronジョブとして実行されます。クリーンアップ頻度は、マウントポイントのSnapper設定で定義されています。日次、月次、年次のクリーンアップのTIMELINE_LIMITパラメータ値を下げると、スナップショットの数と保持期間を減らせます。詳細については、『<link xlink:href="https://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html"><citetitle>SUSE Linux Enterprise Server 11 SP3管理ガイド</citetitle></link>』の<link xlink:href="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_snapper_config.html#sec_snapper_config_modify"><quote>設定ファイルの調整</quote></link>を参照してください。</para>
   <para>ファイルシステムディスクでBtrfsとSnapperを使用する場合、標準のストレージ案の2倍のディスク容量を確保しておくことが推奨されます。YaSTパーティショナは、ルートファイルシステムでBtrfsを使用する場合のストレージ案として、自動的に標準の2倍のディスク容量を提案します。</para>
  </section>
  <section xml:id="b15tk0m7">
   <title>ログ、クラッシュ、およびキャッシュのファイルによるディスク容量の使用 </title>
   <para>システムディスクがデータでいっぱいになりつつある場合、<filename>/var/log</filename>、<filename>/var/crash</filename>、および<filename>/var/cache</filename>からファイルを削除する方法があります。</para>
   <para>Btrfs <systemitem>root</systemitem>ファイルシステムのサブボリューム<filename>/var/log</filename>、<filename>/var/crash</filename>および<filename>/var/cache</filename>が、通常の操作時に利用可能なディスクスペースのすべてを使用でき、システムに不具合が発生します。この状況を回避するため、SUSE Linux Enterprise 11 SP3ではサブボリュームに対するBtrfsクォータのサポートを提供するようになりました。詳細については、<filename>btrfs(8)</filename>のマニュアルページを参照してください。</para>
  </section>
 </section>
 <section xml:id="bpjpklm">
  <title>マルチパスI/Oの問題</title>
  <para><xref linkend="bpjpirk" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
 </section>
 <section xml:id="bpjpgil">
  <title>ソフトウェアRAIDの問題</title>
  <para><xref linkend="bgchysg" xrefstyle="AppTitleOnPage"/>を参照してください。</para>
 </section>
 <section xml:id="bpjphka">
  <title>iSCSIの問題</title>
  <para><xref linkend="sec-inst-system-iscsi-ts" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
 </section>
 <section xml:id="ts-iscsi-lio">
  <title>iSCSI LIOターゲットの問題</title>
  <para><xref linkend="b13g8i2g" xrefstyle="SectTitleOnPage"/>を参照してください。</para>
 </section>
</chapter>

<appendix conformance="sles11,Novell,no,0,80" xml:id="common-legal" revision="01/01/03" xml:base="appendix_common_legal.xml"><title>GNU利用許諾契約書</title><info/>
 
 <para>この付録には、GNU一般公衆利用許諾契約書バージョン2とGNUフリー文書利用許諾契約書バージョン1.2が含まれています。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="common-gplv2-i" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="gfdl-i" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="common-gplv2-i" role="legal" xml:base="common_gplv2_i.xml">
  <title>GNU一般公開使用許諾</title>
  <para>第2版、1991年6月 </para>
  <para>Copyright (C) 1989, 1991 Free Software Foundation, Inc. 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA </para>
  <para>この使用許諾書を一字一句そのままの複製および頒布することは許可されますが、変更は許可されません。 </para>
  <section xml:id="gplv2-preamble">
   <title>前文</title>
   <para>ほとんどのソフトウェアの使用許諾は、共有や変更が自由にできないようになっています。対照的に、GNU一般公衆利用許諾契約書(GPL)は、フリー\'83\'5cフトウェアの共有や変更の自由を保証するように、つまり、フリー\'83\'5cフトウェアがそのすべてのユーザに対してフリーであることを保証するように考えられています。このGPLは、フリーソフトウェア財団の大半のソフトウェア、および作者がGPLを行使することにした他のプログラムに適用されます。(フリーソフトウェア財団の他の一部のソフトウェアは、かわりにGNU劣等一般公衆利用許諾契約書(LGPL)の適用を受けています)。また、LGPLをユーザのプログラムに適用することができます。 </para>
   <para>フリーソフトウェアというのは、無償であるということではなく、自由であるということを指します。一般公開使用許諾は、利用者がフリー\'83\'5cフトウェアの複製物を間違いなく自由に頒布できるように考えられています(しかも、利用者が、希望に応じてこのようなサービスの対価も自由に設定できるようになっています)。また、必要に応じた\'83\'5cースコードの受領または入手、フリー\'83\'5cフトウェアの変更、あるいは新たなフリープログラムでのその部分的な流用が確実に行えるようになっています。さらに、利用者はこうした作業を実行できることが確実にわかるようになっています。 </para>
   <para>利用者の権利を保護するには、利用者にこうした権利を与えないようにすることや、利用者に権利の放棄を求めることを禁止するように制限を加える必要があります。このような制限のため、フリーソフトウェアの複製物を頒布する場合やソフトウェアを改変する場合には一定の責任が生じます。 </para>
   <para>たとえば、フリープログラムの複製物を頒布する場合は、無料または有料にかかわらず、自分のすべての権利を受領者に与える必要があります。また、受領者が確実にソースコードを受領するか、または入手できるようにする必要もあります。さらに、受領者に自分の権利を把握させるために、次の条項を受領者に示す必要があります。 </para>
   <para>利用者の権利の保護は、2つの手順で行われます。(1)ソフトウェアを著作権で保護します。次に、(2)利用者にソフトウェアの複製、頒布、改変を行うための法的な許可を与える本使用許諾を提供します。 </para>
   <para>また、作者やソフトウェアの保護のために、このフリーソフトウェアには保証がないことを皆に確実に理解させたいと考えています。ソフトウェアが第三者によって改変されたり頒布されても、その受領者はオリジナル版を入手したわけではないため、第三者にもたらされた問題によってオリジナルの作者の評判が損なわれるものではないことも受領者に理解させる必要があります。 </para>
   <para>最後に、フリープログラムは、絶えずソフトウェア特許の脅威を受けています。そこで、フリープログラムの再頒布元が特許使用許諾を個々に取得してプログラムを事実上独占するという危険を回避したいと考えています。このようなことを防ぐために、特許を誰でも自由に利用できるように利用許諾を与える必要があるか、まったく利用許諾を与える必要がないかを明確にしました。 </para>
   <para>複製、頒布、改変の正確な条項は、この後に示します。 </para>
  </section><?dbfo-need height="20em"?>


  <section xml:id="gplv2-terms">
   <title>GNU一般公衆利用許諾契約書(GPL)の複製、頒布、改変に関する条項</title>
   <formalpara xml:id="bw4vaov">
    <title>0.</title>
    <para>本利用許諾契約書は、この一般公衆利用許諾契約書(GPL)の条項に従って頒布できることを定めた著作権者の通告が記載されているプログラムまたは他の著作物に適用されます。以下、<quote>プログラム</quote>とは、そのようなプログラムまたは著作物を指し、<quote>プログラムに基づく著作物</quote> とは、プログラム自体か、または著作権が適用される任意の派生的著作物のいずれかを指します。つまり、逐語的か、または変更を含む、および/または別の言語に翻訳したプログラムまたはその一部を含む著作物を指します。(以下、翻訳は「改変」という用語に含まれます)。<quote/>各被許諾者のことを「利用者」と呼びます。<quote/> </para>
   </formalpara>
   <para>複製、頒布、改変以外の活動は、本使用許諾では適用されません。これらは対象外です。プログラムを実行する行為は制限されません。また、プログラムからの出力は、その内容が(プログラムの実行によって作成されたこととは無関係に)プログラムに基づく著作物を構成する場合にのみ適用されます。それが本当かどうかは、プログラムの実行内容によって異なります。 </para>
   <formalpara xml:id="bw4vaow">
    <title>1.</title>
    <para>利用者は、受領したプログラムのソースコードを任意のメディアでそのまま複製または頒布することができます。その際には、各複製物に適切な著作権表示と保証の放棄を適宜明記し、本利用許諾契約書および一切の保証の否定に関する通告すべてを維持したまま、プログラムの他の受領者に本利用許諾契約書の複製物をプログラムとともに頒布することを条件とします。 </para>
   </formalpara>
   <para>利用者は、複製物の移送に関する実際的な行為を有償にすることができます。また、自己裁量により有償の代わりに保証を提供してもかまいません。 </para>
   <formalpara xml:id="bw4vaox">
    <title>2.</title>
    <para>利用者は、プログラムの複製物またはその一部を改変することができます。したがって、プログラムに基づいた著作物を形成し、第1項の条項に従ってそのような改変を複製または頒布することができます。ただし、次のすべての条件を満たしていることも前提とします。 </para>
   </formalpara>
   <formalpara xml:id="bw4vaoy">
    <title>a)</title>
    <para>利用者は、ファイルを改変したことおよび改変日を示す情報を、改変したファイルに明記する必要があります。 </para>
   </formalpara>
   <formalpara xml:id="bw4vaoz">
    <title>b)</title>
    <para>利用者は、利用者が頒布または公開する著作物、プログラムの全体または一部を含む著作物、あるいはプログラムまたはその一部から派生した著作物を、総じて本使用許諾の条項に従ってすべてのサードパーティに無償で使用許諾する必要があります。 </para>
   </formalpara>
   <formalpara xml:id="bw4vap0">
    <title>c)</title>
    <para>改変されたプログラムが、通常、実行時に対話形式でコマンドを読み取るようになっている場合に、そのプログラムを最も一般的な方法で対話形式での利用に向けて実行するときは、適切な著作権表示および無保証(あるいは利用者が保証)通告、ユーザがプログラムをここの条件の下で再頒布できること、本使用許諾の複製物をユーザが閲覧する方法の説明などの告知を出力または表示できるようにする必要があります(例外: プログラム自体が対話型にもかかわらず通常そのような告知を出力しない場合は、プログラムに基づいた利用者の著作物でも告知を出力する必要はありません)。 </para>
   </formalpara>
   <para>こうした要件は、総じて改変された著作物に適用されます。その著作物の一部がプログラムから派生していないと特定できて、それぞれが別の独立した著作物であると合理的に考えられる場合、利用者がそれらを別の著作物として頒布するときには、本使用許諾およびその条項はそうした部分には適用されません。しかし、利用者が同じ部分をプログラムに基づいた著作物全体の一部として頒布する場合は、頒布物全体が、本使用許諾の条項に従わなければなりません。これは、本使用許諾の条項により他の被許諾者に与えられる許可はプログラム全体に及ぶため、作者にかかわらずあらゆる部分に本使用許諾が適用されるためです。 </para>
   <para>したがって、この項の趣旨は、利用者がすべて作成した著作物に対して権利を主張したり、利用者の権利に異議を申し立てることはではなく、プログラムに基いた派生著作物または集合著作物の頒布を管理する権利を行使することです。 </para>
   <para>さらに、プログラムに基づいていない別の著作物をプログラム(またはプログラムに基づいた著作物)とともに記憶装置のボリュームや頒布メディアにまとめただけでは、本使用許諾の適用範囲が他の著作物にまで及ぶことはありません。 </para>
   <formalpara xml:id="bw4vap1">
    <title>3.</title>
    <para>利用者は第1項および第2項の条項に従って、プログラム(または第2項のプログラムに基づいた著作物)をオブジェクトコードまたは実行形式で複製または頒布することができます。ただし、次のいずれかを実施するという条件も付きます。 </para>
   </formalpara>
   <formalpara xml:id="bw4vap2">
    <title>a)</title>
    <para>著作物に、該当するコンピュータの読み取り可能なソースコード一式を添付します。このソースコードを第1項および第2項の条項に従ってソフトウェアの交換で習慣的に使われるメディアで頒布する必要があります。または、 </para>
   </formalpara>
   <formalpara xml:id="bw4vap3">
    <title>b)</title>
    <para>マシンで読み取り可能な該当するソースコードの複製を、ソースの頒布に実際にかかるコストを上回らない程度の手数料で第三者に提供するために、著作物に、3年以上有効な書面による提案を添付します。このソースコードの複製を第1項および第2項の条項に従ってソフトウェアの交換で習慣的に使われるメディアで頒布します。あるいは、 </para>
   </formalpara>
   <formalpara xml:id="bw4vap4">
    <title>c)</title>
    <para>著作物に、該当するソースコードの頒布の提案に関して利用者が得た情報を添付します(この選択肢は、非営利目的の頒布の場合、および利用者が、先ほどのb項と一致するような提案とともにオブジェクトコードまたは実行可能ファイル形式でプログラムを受領した場合に限り選択できます)。 </para>
   </formalpara>
   <para>著作物のソースコードとは、それに改変を加える場合に好ましい著作物の形式のことです。実行形式の著作物の場合、「ソースコード一式」とは、その著作物に含まれているすべてのモジュールのすべてのソースコードのほかに、関連するあらゆるインタフェース定義ファイル、および実行可能ファイルのコンパイルやインストールの制御に使用されるスクリプトを加えたものを意味します。しかし、特別な例外として、ソースコードを頒布する場合は、通常の頒布物(ソースまたはバイナリ形式)に実行可能ファイルの実行先オペレーティングシステムの主要なコンポーネント(コンパイラ、カーネルなど)まで加える必要はありません。ただし、そのコンポーネント自体に実行可能ファイルが付随する場合は除きます。 </para>
   <para>指定された場所から複製するためのアクセス手段を提供することによって、実行可能ファイルまたはオブジェクトコードを頒布している場合は、第三者がオブジェクトコードとともにソースを複製するように強制されなくても、ソースコードを同じ場所から複製するために同等のアクセス手段を提供していればソースコードの頒布と見なされます。 </para>
   <formalpara xml:id="bw4vap5">
    <title>4.</title>
    <para>利用者は、本利用許諾契約書に明示的に記載されている形態を除き、プログラムを複製、改変、二次利用許諾、および頒布してはなりません。別の方法でプログラムを複製、改変、二次使用許諾、または頒布しようとするのは無効であり、本使用許諾の下で利用者の権利は自動的に消滅します。ただし、本使用許諾の下で利用者から複製物または権利を受領した関係者は、条項を遵守している限り、権利が消滅することはありません。 </para>
   </formalpara>
   <formalpara xml:id="bw4vap6">
    <title>5.</title>
    <para>利用者は、本利用許諾契約書に署名しない限り、それを受け入れる必要はありません。しかし、利用者にプログラムまたはその派生著作物の改変または頒布の許可を与えるものは、本使用許諾以外にありません。こうした行為は、利用者が本使用許諾を受け入れなければ、法的に禁じられます。したがって、プログラム(またはプログラムに基づいた著作物)を改変または頒布すれば、利用者は、そうした行為に関して本使用許諾を受け入れ、プログラムまたはプログラムに基づいた著作物の複製、頒布、または改変に関するすべての条項を承認したことになります。 </para>
   </formalpara>
   <formalpara xml:id="bw4vap7">
    <title>6.</title>
    <para>利用者がプログラム(またはプログラムに基づいた著作物)を再頒布するたびに、受領者は、本利用許諾契約書の条項に従ってプログラムを複製、頒布、または改変するための利用許諾を元の許諾者から自動的に受領します。利用者は、本利用許諾契約書で受領者に付与された権利の行使に関してさらに制約を課すことはできません。利用者は、第三者の本使用許諾の遵守に対して責任を負うものではありません。 </para>
   </formalpara>
   <formalpara xml:id="bw4vap8">
    <title>7.</title>
    <para>特許侵害に関する裁判所の判決または申し立ての結果として、あるいはその他の理由(特許問題に限らない)で、利用者に課せられた条件(裁判所の命令、契約などを問わず)が利用許諾契約書の条件と矛盾している場合でも、利用者は利用許諾契約書の条件を免除されません。利用者が本使用許諾の下での義務と他の関連する義務を同時に満たすように頒布できない場合は、結果としてプログラムを頒布してはなりません。たとえば、特許利用許諾で、利用者から直接的または間接的に複製物を受領した者によるプログラムの無償再頒布が許されていない場合、利用者が特許利用許諾と利用許諾契約書の両方を満足させる唯一の方法は、プログラムの頒布を全面的に中止することです。 </para>
   </formalpara>
   <para>本条項の任意の部分が、特定の状況の下で無効または実施不能になっている場合は、本条項の残りの部分が適用されるようになっていますが、他の状況では本条項は総じて適用されるようになっています。 </para>
   <para>本条項の目的は、特許または他の財産権を侵害したり、そのような権利の主張の正当性を争うことを利用者に勧めることではありません。本条項の唯一の目的は、フリーソフトウェア流通システムの完全性を保護することであり、一般使用許諾の実践によって実現されます。多くの人々が、このシステムの一貫した用途を信頼して、このシステムを介して頒布される広い範囲のソフトウェアに多大な貢献を果たしてきました。作者や寄贈者が他のシステムを介してソフトウェアを頒布するかどうかを決めるのは本人次第であり、被許諾者がその選択を強要することはできません。 </para>
   <para>本条項は、本使用許諾の他の条項の結果と考えられることを徹底的に明らかにすることを目的としています。 </para>
   <formalpara xml:id="bw4vap9">
    <title>8.</title>
    <para>プログラムの頒布または使用が、特定の国の特許または著作権で保護されたインタフェースのどちらかで制限されている場合、プログラムに本利用許諾契約書を適用した元の著作権者は、そうした国を除外する明示的な地域頒布制限を加えるため、頒布は除外されていない国の中やそうした国同士でしか許可されません。そのような場合は、地域頒布制限が本使用許諾の本文に記載されているのと同様に解釈されます。 </para>
   </formalpara>
   <formalpara xml:id="bw4vapa">
    <title>9.</title>
    <para>フリーソフトウェア財団は、一般公衆利用許諾契約書(GPL)の改訂版または新版を随時公表することがあります。そのような新版は、性格的には現行版と似たものになりますが、新たな問題や懸案事項に対応するために細部が異なる可能性があります。 </para>
   </formalpara>
   <para>各版には、区別するための版番号が設定されます。プログラムに、それに適用される本利用許諾契約書の版番号と「後継版」が指定されている場合、利用者は、選択によって現行版の条項またはフリーソフトウェア財団から公開される後継版の条項に従うことになります。<quote/>プログラムに、本利用許諾契約書の版番号が指定されていない場合、利用者は、フリーソフトウェア財団からこれまでに公開された任意の版を選択することができます。 </para>
   <formalpara xml:id="bw4vapb">
    <title>10.</title>
    <para>利用者が、頒布条件の異なる他のフリープログラムにプログラムの一部を組み込みたい場合は、作者に書面で許可を求めてください。フリーソフトウェア財団が著作権を有するソフトウェアについては、フリーソフトウェア財団に書面で問い合わせてください。例外を認める場合もあります。FSFの意思決定は、FSFのフリーソフトウェアのすべての派生物をフリーな状態に保つこと、および一般にソフトウェアの共有と再利用を促進することという2つの目標を手がかりにしています。 </para>
   </formalpara>
   <section xml:id="gplv2-nowarranty">
    <title>無保証</title>
    <formalpara xml:id="bw4vapd">
     <title>11.</title>
     <para>本プログラムには無償で利用許諾が付与されるため、本プログラムには適用される法律によって許容される範囲まで保証はありません。特に書面に記載されていない限り、著作権者またはその他の当事者(またはその両方）は、本プログラムを「現状のまま」で提供し、商品性および特定目的に対する適合性の暗示的な保証を含めて（ただしそれに限定されず)、明示的、暗示的を問わず、いかなる保証の責任も負いません。本プログラムの品質および性能に関する全体的なリスクは利用者が負うものとします。本プログラムに問題があると判明した場合、必要な点検、修復、修正にかかる費用はすべて利用者が負担するものとします。 </para>
    </formalpara>
    <formalpara xml:id="bw4vape">
     <title>12.</title>
     <para>適用される法律によって要求されているか、または書面によって合意されていない限り、いかなる場合も、上記で許可されているとおりに本プログラムを変更または頒布(またはその両方)することができる著作権者またはいずれかの他の当事者は、本プログラムの使用または使用不可によって生じた一般的、特殊、偶発的、または間接的な損害を含めて(データの損失、データの不正確な出力、または利用者かその他の当事者が被った損失、あるいは他の本プログラムと合わせて動作する本プログラムの障害を含むがそれに限定されない)、利用者のいかなる損害に対しても責任を負わず、また、そのような著作権者またはその他の当事者がそのような損傷の可能性について知らされていても一切の責任を負いません。 </para>
    </formalpara>
   </section>
   <section xml:id="gplv2-endterms">
    <title>条項の終わり</title>
    <para/>
   </section>
  </section>
  <section xml:id="gplv2-apply">
   <title>こうした条項を新しいプログラムに適用する方法</title>
   <para>利用者が新しいプログラムを開発し、できる限り広く一般に使用させたい場合は、本使用許諾の条項に従ってそのプログラムを誰でも再頒布および変更できるフリーソフトウェアにする方法が最も優れています。 </para>
   <para>そのためには、プログラムに次の通告を添付してください。保証のないことを最も効果的に伝えるには、各ソースファイルの冒頭に通告を添付するのが最も無難です。また、各ファイルには、少なくとも「著作権」の行を用意し、全文がある場所を示す必要があります。<quote/> </para>

<screen>
one line to give the program’s name and an idea of what it does. 
Copyright (C) yyyy name of author

</screen>


<screen>
This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

</screen>


<screen>
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

</screen>


<screen>
You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307,
USA.

</screen>

   <para>また、電子メールや郵送で利用者に連絡する方法に関する情報も加えてください。 </para>
   <para>対話型プログラムの場合は、それを対話モードで起動したときに次のような短い通告が出力されるようにしてください。 </para>

<screen>
Gnomovision version 69, Copyright (C) year name of author
Gnomovision comes with ABSOLUTELY NO WARRANTY; for details
type `show w’. This is free software, and you are welcome
to redistribute it under certain conditions; type `show c’ 
for details.

</screen>

   <para>仮想コマンド「show w」と「show c」は、一般公衆利用許諾契約書(GPL)の該当する箇所を示すようになっている必要があります。言うまでもなく、利用者が使用するコマンドは、必ずしも「show w」や「show c」のような形式に限定されません。こうしたコマンドには、利用者のプログラムに合わせたマウスクリックやメニュー項目も考えられます。 </para>
   <para>また、利用者は、必要に応じて雇用主(プログラマとして作業する場合)または場合によっては学校に、プログラムの「著作権放棄声明書」に署名してもらう必要があります。<quote/>次に例を示しますが、名前は適当に変更してください。 </para>

<screen>
Yoyodyne, Inc., hereby disclaims all copyright
interest in the program `Gnomovision’
(which makes passes at compilers) written 
by James Hacker.

</screen>


<screen>
signature of Ty Coon, 1 April 1989
Ty Coon, President of Vice

</screen>

   <para>本一般公衆利用許諾契約書(GPL)では、著作権を有するプログラムに利用者のプログラムを組み込むことは許可していません。利用者のプログラムがサブルーチンライブラリである場合、利用者は、著作権を有するアプリケーションをそのライブラリとリンクすることを許可した方が有用と考えるかもしれません。利用者がこのような操作を希望する場合は、本利用許諾契約書ではなく、「GNU劣等一般公衆利用許諾契約書(LGPL)」を適用します。 </para>
   <para/>
   <para/>
   <para/>
   <para/>
   <para/>
  </section>
 </section>
 <section xml:id="gfdl-i" role="legal" xml:base="common_gfdl_i.xml">
  <title>GNUフリー文書利用許諾契約書(GFDL)</title>
  <para>第1.2版、2002年11月 </para>
  <para>Copyright (C) 2000,2001,2002 Free Software Foundation, Inc. 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA </para>
  <para>この使用許諾書を一字一句そのままの複製および頒布することは許可されますが、変更は許可されません。 </para>
  <section xml:id="gfdl-preamble">
   <title>前文</title>
   <para>この利用許諾契約書の目的は、マニュアル、テキストブック、またはその他の機能的で有用な文書を、自由という意味で「フリー」にすることです。つまり、そのような文書を、変更の有無や商用非商用に関わらず、コピーまたは再配布する実効的な自由をすべての人々に保証することです。第二に、本利用許諾契約書は、作者または発行者が他者によって行われた変更について責任を負わないとともに、その著作物の功績が確保されるように意図されています。 </para>
   <para>本利用許諾契約書は、「コピーレフト」(著作物を自由に複製および改変できるようにすること)の一種であり、文書の派生著作物は、それ自体が同じ意味においてフリーでなければなりません。<quote/>フリーソフトウェア向けに考慮されたコピーレフト利用許諾であるGNU一般公衆利用許諾契約書(GPL)を補足するものです。 </para>
   <para>弊社は、この利用許諾契約書をフリーソフトウェアのマニュアルに使用するために設計しました。それは、フリーソフトウェアにはフリーマニュアルが必要だからです。つまり、フリープログラムには、そのソフトウェアと同じ自由を提供するマニュアルが付属しなければなりません。ただし、本利用許諾契約書は、ソフトウェアマニュアルに制限されるものではありません。主題であるか否か、または印刷された本として発行されるか否かに関わらず、任意のテキスト著作物に使用することができます。本利用許諾契約書は、その目的が指示または参照に置かれている著作物に主に使用することを推奨します。 </para>
  </section>
  <section xml:id="gfdl-definitions">
   <title>適用範囲と定義</title>
   <para>本利用許諾契約書は、この利用許諾の条項に従って頒布できることを定めた著作権者の通告が記載されている任意のメディアにおけるマニュアルまたは他の著作物に適用されます。そのような通告は、その著作物をここに記載されている条件に従って使用するための世界的な無償の利用許諾を無期限で付与します。次に示す「文書」は、そのような任意のマニュアルまたは著作物を指します。<quote/>その公衆ユーザはいずれも被許諾者であり、「利用者」と呼ばれます。<quote/>利用者は、著作権法に従った許可が必要になるような方法で著作物を複製、変更または頒布する場合に、利用許諾を受け入れます。 </para>
   <para>文書の「変更された版」とは、そのまま複製されるか、変更または別の言語に翻訳された(またはその両方)文書あるいはその一部を含んだ著作物のことです。<quote/> </para>
   <para>「二次セクション」は、文書の発行者または作者と文書の全体的な主題(または関連事項)との関係のみを示す文書の名前付き付録または前付け部分です。総体的な主題に直接関わる内容は含まれていません。<quote/>(したがって、文書が部分的に数学のテキストブックになっている場合、二次セクションでは数学について説明されない場合があります)。関係には、主題または関連事項との歴史的なつながり、あるいはそれらに関する法的、商的、哲学的、倫理的、政治的位置付けが含まれる場合があります。 </para>
   <para>「不変セクション」は、文書が本利用許諾契約書の条件の下でリリースされる旨を述べている通告において、そのタイトルが不変セクションのものとして指定されている、ある特定の二次セクションです。<quote/>セクションが、すでに説明した二次セクションの定義に一致しない場合は、不変として指定することはできません。文書には、不変セクションが含まれない場合があります。文書で不変セクションを特定しない場合、不変セクションは含まれません。 </para>
   <para>「カバーテキスト」とは、文書が本利用許諾契約書の条件の下でリリースされる旨を述べている通告において、表カバーテキストまたは裏カバーテキストとして列挙されている、ある一定の短い文章のことです。<quote/>表カバーテキストは、最大で5語、裏カバーテキストは、最大で25語によって構成できます。 </para>
   <para>文書の<quote>透過的な複製</quote>とは、その仕様が一般の利用者にとって入手可能で、一般的なテキストエディタまたは一般的な描画プログラム(画素で構成される画像用)、あるいは広く使用されている図面エディタ(図面用)で文書を直接改訂するのに適した形式で表される機械可読の複製のことです。テキストフォーマッタへの入力またはテキストフォーマッタへの入力に適したさまざまな形式への変換に適していることも前提になります。読者による以後の変更を阻止または妨げるようにマークアップまたはマークアップのない状態が調整されている、他の点では透過的なファイル形式で行われた複製は、透過的な複製ではありません。イメージ形式は、相当量のテキストに使用されている場合、透過的ではありません。<quote>透過的</quote>ではない複製は、<quote>不透明</quote>と呼ばれます。 </para>
   <para>透過的な複製に適した形式として、マークアップのないプレーンなASCII、Texinfo入力形式、LaTeX入力形式、一般に取得可能なDTDを使用するSGMLまたはXML、標準に準拠したHTML、人為的変更用のPostScriptまたはPDFがあります。透過的なイメージ形式には、PNG、XCF、JPGが含まれます。不透明な形式には、独自のワードプロセッサのみで読み取りおよび編集を行える独自の形式、DTDまたは処理(またはその両方)ツールを一般に取得できないSGMLまたはXML、機械生成HTML、出力のみを目的として一部のワードプロセッサによって作成されるPostScriptまたはPDFが含まれます。 </para>
   <para>「タイトルページ」とは、印刷された本の場合、タイトルページ自体、および本利用許諾契約書でタイトルページに表示することが要求されるマテリアルを読みやすいように保持するために必要な以降のページのことを指します。<quote/>そのようなタイトルページがない形式の著作物の場合、「タイトルページ」は、本文の開始部分に先行する、著作物のタイトルを最も顕著に表している部分の近くにあるテキストのことを指します。<quote/> </para>
   <para>「XYZという表題の付いた」セクションとは、そのタイトルが正確にXYZになっているか、またはXYZを別の言語に翻訳しているテキストに続いてカッコ付きのXYZが含まれている文書の名前付きサブユニットのことです。<quote/>(ここで、XYZは、次に示すように、「謝辞」、「献辞」、「推薦」、「履歴」などの特定のセクション名を表します)。<quote/><quote/><quote/><quote/>文書を変更するときに、そのようなセクションの「タイトルを保存する」とは、この定義に従って「XYZという表題の付いた」セクションが残されることを表します。<quote/><quote/> </para>
   <para>文書では、本利用許諾契約書が文書に適用される旨を述べている通告の付近に保証の放棄を含めることができます。保証の放棄条項は、本利用許諾契約書内の参照によって、保証の放棄に関してのみ組み込まれると見なされます。つまり、これらの保証の放棄条項がもつ可能性のある他のいかなる含意も無効であり、本利用許諾契約書の意味にまったく影響を与えません。 </para>
  </section>
  <section xml:id="gfdl-verbatim">
   <title>そのままの複製</title>
   <para>利用者は、商用か否かを問わず、任意のメディアにおいて文書を複製または頒布することができます。その際に、本利用許諾契約書、著作権表示、および本利用許諾契約書が文書に適用される旨を述べる利用許諾通告をすべての複製で再生し、本利用許諾契約書の条件に他のいかなる条件も追加しないことが前提条件になります。利用者は、技術的手段によって、作成または頒布する複製の読み込みまたはさらなる複製を妨げたり、制御したりすることはできません。ただし、複製と引き換えに対価を受け取ることができます。十分に大量の複製を頒布する場合は、セクション3の条件に従う必要もあります。 </para>
   <para>すでに述べた同じ条件に従って複製を貸与したり、複製を公開したりすることもできます。 </para>
  </section>
  <section xml:id="gfdl-quantity">
   <title>大量の複製</title>
   <para>発行する文書の印刷した複製(または、通常、印刷したカバーをもつメディアに含まれた複製)が100部を超え、文書の利用許諾通告でカバーテキストを必要とする場合は、すべてのカバーテキスト(表カバーの表カバーテキスト、裏カバーの裏カバーテキスト)を明瞭かつ読みやすく記載したカバーに文書の複製を同封する必要があります。また、両方のカバーでは、これらの複製の発行者として、利用者を読みやすい状態で明確に識別しなければなりません。表カバーには、フルタイトルを記述し、タイトルのすべての語が同等に目立つようにする必要があります。カバーには他のマテリアルを追加することもできます。カバーに限って変更を行った場合の複製は、文書のタイトルが保持されていて、これらの条件を満たしている限り、他の点に関してそのままの複製と見なすことができます。 </para>
   <para>いずれかのカバーで、必要なテキストが多すぎて、読みやすい状態に収まらない場合は、列挙されている最初の部分(問題なく収まる分)を実際のカバーに記載し、残りの部分を隣接ページに入れます。 </para>
   <para>文書の不透明な複製を100部以上公開または頒布する場合は、それぞれの不透明な複製とともに機械可読の透過的な複製を含めるか、それぞれの不透明な複製内あるいはその複製とともに、ネットワークの一般利用者が標準的な一般ネットワークプロトコルを使用して、追加マテリアルのない文書の完全な透過的複製をダウンロードするときにアクセスできるコンピュータネットワークの場所を明記する必要があります。後者のオプションを使用する場合は、不透明な複製の大量頒布を開始するときに十分慎重な手順を取り、この透過的な複製が、その版の不透明な複製を最後に一般頒布した後(直接またはエージェントや小売業者を通じて)少なくとも1年間、指定した場所で継続的にアクセス可能となるように配慮する必要があります。 </para>
   <para>大量の複製を再頒布する時点よりもかなり前に、文書の作者に連絡して、文書の更新版を提供する機会を与えることが要求されますが、必須ではありません。 </para>
  </section>
  <section xml:id="gfdl-modify">
   <title>変更</title>
   <para>文書の変更された版を、すでに述べた第2項および第3項の条件に従って複製および頒布することができます。その際は、本利用許諾契約書に確実に従って、変更された版をリリースし、変更された版が文書の役割を担うようにして、その複製を所要する任意の利用者に変更された版の頒布および変更の利用許諾を与えることが前提になります。また、変更された版で次のことを行う必要があります。 </para>
   <formalpara xml:id="bw4vnmy">
    <title>A.</title>
    <para>タイトルページ(カバーがある場合はカバー上も含める)で、文書、および以前の版の文書(以前の版がある場合は、その旨、文書の履歴セクションに列挙する)と識別されるタイトルを使用します。前の版と同じタイトルは、その版の元の発行者が許可を与えた場合に、使用することができます。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnmz">
    <title>B.</title>
    <para>タイトルページ上に、この要件から解放されない限り、変更された版において変更の著者としての責任を担う1人以上の人またはエンティティとともに、文書の筆頭著者を少なくとも5人、作者として列挙します(5人に満たない場合は、その筆頭著者のすべて)。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn0">
    <title>C.</title>
    <para>タイトルページ上に、変更された版の発行者の名前を、発行者として記載します。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn1">
    <title>D.</title>
    <para>文書のすべての著作権表示を保持します。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn2">
    <title>E.</title>
    <para>変更に関する適切な著作権表示を、他の著作権表示の隣に追加します。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn3">
    <title>F.</title>
    <para>著作権表示の直後に、本利用許諾契約書の条項に従って変更された版を利用するための許可を一般利用者に与える利用許諾通告を、次の補遺に示す形式で含めます。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn4">
    <title>G.</title>
    <para>その利用許諾通告に、不変セクションの全リスト、および文書の利用許諾通告で指定されている必須カバーテキストを保持します。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn5">
    <title>H.</title>
    <para>本利用許諾契約書の変更されていない複製を含めます。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn6">
    <title>I.</title>
    <para><quote>履歴</quote>という表題のセクションを保持して、そのタイトルを保持し、タイトルページに記載されているとおりに、変更された版のタイトル、年度、新しい作者、発行者を少なくとも示す項目を追加します。文書に<quote>履歴</quote>というセクションがない場合は、そのタイトルページに記載されているとおりに文書のタイトル、年度、作者、発行者を示すセクションを作成し、前の文章に記載されているとおりに変更された版を示す項目を追加します。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn7">
    <title>J.</title>
    <para>文書の透過的な複製に一般利用者がアクセスできるように文書で指定されている場合は、そのネットワークの場所、およびその文書の基盤となった前の版に対応して文書で指定されているネットワークの場所を保持します。これらは、<quote>履歴</quote>セクションに配置することができます。文書自体よりも4年以上前に発行された著作物の場合、または参照されているその版の元の発行者が許可を与えている場合は、そのネットワークの場所を省略することができます。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnn8">
    <title>K.</title>
    <para>「謝辞」または「献辞」という表題のセクションの場合は、そのセクションのタイトルを保持し、セクション内に、それぞれの貢献者謝辞またはその中の献辞(またはその両方)のすべての内容と意味合いを保持します。<quote/><quote/> </para>
   </formalpara>
   <formalpara xml:id="bw4vnn9">
    <title>L.</title>
    <para>文書のすべての不変セクションを保持し、そのテキストおよびタイトルを未変更のままにします。セクション番号またはそれと同等の要素は、セクションタイトルの一部と見なされません。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnna">
    <title>M.</title>
    <para>「推薦」という表題の任意のセクションを削除します。<quote/>そのようなセクションは、変更された版に含めることはできません。 </para>
   </formalpara>
   <formalpara xml:id="bw4vnnb">
    <title>N.</title>
    <para>既存のセクションのタイトルを変更して、「推薦」という表題にしたり、タイトルが不変セクションと矛盾したりしないようにします。<quote/> </para>
   </formalpara>
   <formalpara xml:id="bw4vnnc">
    <title>O.</title>
    <para>保証の放棄を保持します。 </para>
   </formalpara>
   <para>変更された版に、二次セクションと見なされ、文書から複製されたマテリアルを含まない新しい前付けセクションまたは付録が含まれる場合は、これらの一部またはすべてを任意に「不変」として指定することができます。これを行うには、変更された版の利用許諾表示内で列挙されている不変セクションにそのタイトルを追加します。これらのタイトルは、他のすべてのセクションタイトルと異なっている必要があります。 </para>
   <para>「推薦」という表題のセクションを追加することができますが、その際は、変更された版のさまざまな当事者による推薦以外の要素が含まれていないことが前提になります。たとえば、校正者によるコメント、または文が標準的な信頼できる定義として組織によって承認されていることを示すという宣言文などが相当します。<quote/> </para>
   <para>表カバーテキストとしての最大5語の短い文、および裏カバーテキストとしての最大25語の短い文を、変更された版のカバーテキストのリストの終わりに追加できます。表カバーテキストの短い1文および裏カバーテキストの短い1文のみを、1つのエンティティが追加できます(またはエンティティによって行われた調整を通じて)。文書に、利用者または利用者が関わる同じエンティティによって行われた調整を通じて前に追加された同じカバーのカバーテキストがすでに含まれている場合は、別のものを追加することはできませんが、古いものを置き換えることができます。ただし、その古いものを追加した前の発行者から明示的な許可を得る必要があります。 </para>
   <para>文書の作者および発行者は、本利用許諾契約書により、その名前を得るために使用したり、変更された版の推薦を主張または暗示したりする許可を与えるものではありません。 </para>
  </section>
  <section xml:id="gfdl-combine">
   <title>文書の結合</title>
   <para>文書は、すでに述べた変更された版に関するセクション4の条件に従って、本利用許諾契約書の下でリリースされた他の文書と結合することができます。その際は、その組み合わせの中に、元の全文書のすべての不変セクションを未変更のまま含めて、そのすべてを結合された著作物の不変セクションとしてその利用許諾表示に列挙し、そのすべての保証の放棄を保持することが前提となります。 </para>
   <para>結合された著作物には、本利用許諾契約書の複製を1つのみ含める必要があります。複数の同一の不変セクションは、単一の複製で置き換えることができます。同じ名前だが内容の異なる複数の不変セクションがある場合は、そのような各セクションのタイトルを固有なものにします。その際は、その終わりに、カッコ付きで、そのセクションの元の作者または発行者の名前(既知の場合)、あるいは固有の番号を追加します。不変セクションのリスト内のセクションタイトルには、結合された著作物の利用許諾表示の場合と同じ調整を加えます。 </para>
   <para>組み合わせでは、さまざまな元の文書の「履歴」という表題のセクションを結合して、1つの「履歴」というセクションを構築する必要があります。同じように、「謝辞」という表題のセクション、および「献辞」という表題のセクションも結合します。<quote/><quote/><quote/><quote/>「推薦」という表題のすべてのセクションを削除する必要があります。<quote/> </para>
  </section>
  <section xml:id="gfdl-collect">
   <title>文書のコレクション</title>
   <para>文書および本利用許諾契約書の下でリリースされた他の文書から成るコレクションを作成して、さまざまな文書に含まれる本利用許諾契約書の個々の複製を、コレクションに含まれる単一の複製で置き換えることができますが、他のすべての点での各文書のそのままの複製に関する本利用許諾契約書の規則に従うことが前提になります。 </para>
   <para>そのようなコレクションから単一の文書を抽出して、その文書を本利用許諾契約書に従って個々に頒布することができますが、その際は、本利用許諾契約書の複製を抽出した文書に挿入して、その文書のそのままの複製に関するその他のすべての点で、本利用許諾契約書に従う必要があります。 </para>
  </section>
  <section xml:id="gfdl-aggregate">
   <title>独立した著作物の集積</title>
   <para>文書またはその派生物を他の個別および独立した文書または著作物とともに、ストレージまたは頒布メディア内またはそのボリューム上に蓄積することを「集積」と呼びます。その場合は、個々の著作物の許可を超えてその蓄積の利用者の法的権限を制限することに、蓄積による著作権を使用しないことが前提になります。文書が集積に含まれる場合、本利用許諾契約書は、それ自体が文書の派生著作物ではない集積内の他の著作物に適用されません。 </para>
   <para>セクション3のカバーテキスト要件が文書のこれらの複製に適用可能であり、文書が集積全体の半分に満たない場合は、文書のカバーテキストを、集積内の文書のカバー、または文書が電子形式の場合は、電子的な同等のカバーに配置することができます。それ以外の場合は、集積全体の印刷されたカバー上に表示する必要があります。 </para>
  </section>
  <section xml:id="gfdl-translate">
   <title>翻訳</title>
   <para>翻訳は変更の一種と見なされるため、セクション4の条件に従って文書の翻訳を頒布することができます。不変セクションを翻訳で置き換えるには、その著作権者による特殊な許可が必要ですが、これらの不変セクションの元の版に加えて、不変セクションのすべて、または一部の翻訳を含めることができます。本利用許諾契約書、文書内のすべての利用許諾表示、および保証の放棄の翻訳を含めることができますが、その際は、本利用許諾契約書の元の英語版、およびそれらの利用許諾表示と保証の放棄の元の版も含めることが前提になります。本利用許諾契約書、利用許諾表示、または保証の放棄の翻訳と元の版との間に不一致がある場合は、元の版が優先されます。 </para>
   <para>文書内のセクションに、「謝辞」、「献辞」、または「履歴」という表題が付いている場合は、そのタイトルを保持する(セクション1)ための要件(セクション4)により、通常は実際のタイトルを変更する必要があります。<quote/><quote/><quote/> </para>
  </section>
  <section xml:id="gfdl-termination">
   <title>消滅</title>
   <para>利用者は、本利用許諾契約書に明示的に記載されている形態を除き、文書を複製、改変、二次利用許諾、および頒布してはなりません。別の方法で文書を複製、改変、二次利用許諾、または頒布しようとするのは無効であり、本利用許諾契約書の下で利用者の権利は自動的に消滅します。ただし、本使用許諾の下で利用者から複製物または権利を受領した関係者は、条項を遵守している限り、権利が消滅することはありません。 </para>
  </section>
  <section xml:id="gfdl-revisions">
   <title>本利用許諾契約書の将来の改訂</title>
   <para>フリーソフトウェア財団は、GNUフリー文書利用許諾契約書(GFDL)の新版または改訂版を随時公表することがあります。そのような新版は、性格的には現行版と似たものになりますが、新たな問題や懸案事項に対応するために細部が異なる可能性があります。http://www.gnu.org/copyleft/を参照してください。 </para>
   <para>本利用許諾契約書の各版には、区別するための版番号が設定されます。文書に、それに適用される本利用許諾契約書の特定の版番号と「後継版」が指定されている場合、利用者は、選択によって、その指定された版の条項またはフリーソフトウェア財団から公開される後継版の条項(ドラフトではない)に従うことになります。<quote/>文書に、本利用許諾契約書の版番号が指定されていない場合、利用者は、フリーソフトウェア財団からこれまでに公開された任意の版(ドラフトではない)を選択することができます。 </para>
  </section>
  <section xml:id="gfdl-apply">
   <title>補遺: 本利用許諾書をご使用の文書に使用する方法</title>
   <para>作成した文書内で本利用許諾契約書を使用するには、本利用許諾契約書の複製を文書に含め、タイトルページの直後に、次の著作権および利用許諾表示を挿入します。 </para>

<screen>
Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.

</screen>

   <para>不変セクション、表カバーテキスト、および裏カバーテキストがある場合は、「with...Texts」の行を次のように置き換えます。 </para>

<screen>
with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.

</screen>

   <para>カバーテキストのない不変セクションが含まれている場合、またはこの3つの他の組み合わせの場合は、その2つの代替要素をマージして状況に合わせます。 </para>
   <para>文書にプログラムコードの重要な例が含まれている場合は、GNU一般公衆利用許諾契約書(GPL)などの選択したフリーソフトウェアの利用許諾に従って、これらの例を平行してリリースし、フリーソフトウェアでのその利用を許可することを推奨します。 </para>
  </section>
 </section>
</appendix>

<appendix xml:id="b653gv6" xml:base="ax_docupdates.xml"><title>マニュアルの更新</title><info/>
 
 <para>この項では、SUSE Linux Enterprise Server 11の最初のリリース以降に、『<citetitle>SUSE Linux Enterprise Serverストレージ管理ガイド</citetitle>』に対して行われた文書内容の変更に関する情報を提供します。</para>
 <para>このドキュメントは次の日付に更新されました。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="b18f6m4l" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b17tlcs5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b17ir4gy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b176hzef" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg9cw" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14jt4a4" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14dmrrl" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13z9xd2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13g65gi" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12irb56" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12mdifb" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12doybp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b10v707p" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bzit5x5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bw4b1n8" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bvqj59s" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bvc15n0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="burkc4m" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bt5x8xp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgqw2y" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bq2fgom" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndh000" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="boj6043" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bmy23qz" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bm18yt7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bleqdg7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bkkotcf" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bfmmkat" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <section xml:id="b18f6m4l">
  <title>2013年12月16日</title>
  <para/>
  <section xml:id="b18f6m4m">
   <title>デバイスのマルチパスI/Oの管理</title>
   <para>次の節が更新されました。変更内容は次のとおりです。</para>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b18f6m4n-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b18f6m4o-->
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>次のccissの例を修正しました。</para>

<screen>
devnode "^cciss.c[0-9]d[0-9].*"

devnode "^cciss.c[0-9]d[0-9]*[p[0-9]*]"
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b17tlcs5">
  <title>2013年11月4日</title>
  <para/>
  <section xml:id="b17tlcs6">
   <title>デバイスのマルチパスI/Oの管理</title>
   <para>次の節が更新されました。変更内容は次のとおりです。</para>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b17tlcs7-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b17tlcs8-->
       <entry>
        <para><xref linkend="mpiosysconfpart" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>マルチパスのデバイスのパーティショニングに関する問題を追加しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b17ir4gy">
  <title>2013年10月14日</title>
  <para>次の節が更新されました。変更内容は次のとおりです。</para>
  <section xml:id="b17ir4gz">
   <title>Linux用iSNS</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b17ir4h0-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b17ir4h1-->
       <entry>
        <para><xref linkend="sec-isns-ddadd" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>次のコマンドに-p ip:portオプションを追加しました。</para>

<screen>
iscsiadm -m node -t iqn.2006-02.com.example.iserv:systems -p ip:port --op=update --name=node.startup --value=automatic

iscsiadm -m node -t iqn.2006-02.com.example.iserv:systems -p ip:port --op=delete
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b176hzef">
  <title>2013年10月4日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b17cmfjk" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b17cmlvf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b176hzeg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b17cmfjk">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b17cmfjl-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b17cmfjm-->
       <entry>
        <para><xref linkend="b12doufy" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/>の<literal>blacklist_exceptions</literal>の例にリンクを追加しました。</para>
       </entry>
      </row>
      <row><!--id=b17cmfjn-->
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><literal>blacklist_exceptions</literal>セクションを使って、<literal>blacklist</literal>セクションで使用している正規表現によってブラックリスト化されたデバイスに対してマルチパスを有効にする例を追加しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b17cmlvf">
   <title>ボリュームのスナップショット</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b17cmlvg-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b17cmlvh-->
       <entry>
        <para><xref linkend="snapshots" xrefstyle="ChapTitleOnPage"/></para>
       </entry>
       <entry>
        <para>わかりやすくするため、「元のボリューム」を「ソース論理ボリューム」に変更しました。</para>
       </entry>
      </row>
      <row><!--id=b17cnp7r-->
       <entry>
        <para><xref linkend="bi7xb8b" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>Xenホスト環境では、スナップショット機能を使用して、仮想マシンのストレージバックエンドをバックアップしたり、仮想マシンイメージに対する変更(パッチやアップグレードなど)をテストしたりできます。 </para>
       </entry>
      </row>
      <row><!--id=b17cnp7s-->
       <entry>
        <para><xref linkend="snapshot-xen-host" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=b17cnp7t-->
       <entry>
        <para><xref linkend="lvconvert-merge" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>ソース論理ボリュームに仮想マシンイメージが含まれる場合、仮想マシンをシャットダウンしてソース論理ボリュームとスナップショットボリュームを(この順序でマウント解除することによって)非アクティブにした後、mergeコマンドを発行する必要があります。続いて、スナップショットボリュームとソース論理ボリュームを(この順序でマウントすることによって)アクティブにします。マージ完了時に、ソース論理ボリュームが自動的に再マウントされてスナップショットボリュームは削除されるので、マージ完了後まで仮想マシンを再起動しないでください。マージが完了した後、生成された論理ボリュームを仮想マシンで使用します。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b176hzeg">
   <title>SLES 11のストレージの新機能</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b176hzeh-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b176hzei-->
       <entry>
        <para><xref linkend="bndgyoe" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>EVMSで管理しているシステムデバイスをSLES 10 SP4からSLES 11へアップグレードする際の準備方法に関する情報を追加しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b13jg9cw">
  <title>2013年6月(SLES 11 SP3)</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14ffk97" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g63v9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15coqxp" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14dug5l" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b155zz9h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13jg9cx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15coqxs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15q3ht8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14ffkub" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b14ffk97">
   <title>LVMの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b14ffk98-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b14ffk99-->
       <entry>
        <para><xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>LVMの論理ボリュームのシンプロビジョニングに関する情報を追加しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b13g63v9">
   <title>IP ネットワークの大容量記憶域: iSCSI LIOターゲットサーバ</title>
   <para><xref linkend="cha-iscsi-lio" xrefstyle="ChapTitleOnPage"/>は、新たに追加されました。</para>
  </section>
  <section xml:id="b15coqxp">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b15coqxq-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b15coqxr-->
       <entry>
        <para><xref linkend="b14ff9rs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=b15gv138-->
       <entry>
        <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><filename>/usr/share/doc/packages/multipath-tools/multipath.conf.defaults</filename>ファイルにデフォルトの定義があるストレージアレイのリストを更新しました。</para>
       </entry>
      </row>
      <row><!--id=b15gv4eu-->
       <entry>
        <para><xref linkend="beep4ms" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><literal>-r</literal>は新しいオプションです。</para>
       </entry>
      </row>
      <row><!--id=b15jxit2-->
       <entry>
        <para><xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=b15dsfgw-->
       <entry>
        <para><xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><literal>alua</literal>、<literal>rdac</literal>、<literal>hp-sw</literal>、<literal>emc</literal>用のSCSIハードウェアハンドラに関する情報を追加しました。</para>
       </entry>
      </row>
      <row><!--id=b15gv4ev-->
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>廃止予定の属性<literal>udev_dir</literal>と<literal>getuid_callout</literal>、新しい属性<literal>uid_attribute</literal>、および<literal>path_selector</literal>と<literal>max_fds</literal>の変更されたデフォルト値に関する注釈を付けることで、デフォルト値のリストを更新しました。</para>
       </entry>
      </row>
      <row><!--id=b15gvcrm-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><literal>path_selector</literal>のデフォルトを、<literal>round-robin</literal>から<literal>service-time</literal>に変更しました。</para>
        <para><literal>getuid_callout</literal>属性は廃止予定なので、<literal>uid_attribute</literal>パラメータに置き換えられました。</para>
        <para><literal>uid_attribute</literal>を追加しました。</para>
       </entry>
      </row>
      <row><!--id=b15cq0jh-->
       <entry>
        <para><xref linkend="scandev" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <warning>
         <para>EMC PowerPath環境では、SCSIバスをスキャンする場合に、オペレーティングシステムに付属する<filename>rescan-scsi-bus.sh</filename>ユーティリティまたはHBAベンダスクリプトを使用しないでください。ファイルシステムが破損する可能性を避けるため、EMCでは、Linux用EMC PowerPathのベンダマニュアルに記載されている手順に従うよう求めています。</para>
        </warning>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b14dug5l">
   <title>mdadmによるソフトウェアRAID 6および10の管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b14dug5m-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b14dug5n-->
       <entry>
        <para><xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b155zz9h">
   <title>Linuxファイルシステムの概要</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b155zz9i-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b15tkrrw-->
       <entry>
        <para><xref linkend="b15tkr5k" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>クリーンアップ頻度は、マウントポイントのSnapper設定で定義されています。日次、月次、年次のクリーンアップのTIMELINE_LIMITパラメータ値を下げると、スナップショットの数と保持期間を減らせます。</para>
       </entry>
      </row>
      <row><!--id=b155zz9j-->
       <entry>
        <para><xref linkend="b15tkr5p" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b13jg9cx">
   <title>ソフトウェアRAID用のストレージエンクロージャLEDユーティリティ</title>
   <para><xref linkend="cha-raids-lee" xrefstyle="ChapTitleOnPage"/>は、新たに追加されました。</para>
  </section>
  <section xml:id="b15coqxs">
   <title>ボリュームのスナップショット</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b15coqxt-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b15coqxu-->
       <entry>
        <para><xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>LVM論理ボリュームスナップショットのシンプロビジョニングに関する情報を追加しました。</para>
       </entry>
      </row>
      <row><!--id=b15coqxv-->
       <entry>
        <para><xref linkend="lvconvert-merge" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b15q3ht8">
   <title>ストレージに関する問題のトラブルシュート</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b15q3ht9-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b15q3hta-->
       <entry>
        <para><xref linkend="trbl-btrfs-volfull" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b14ffkub">
   <title>SLES 11のストレージの新機能</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b14ffkuc-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b14ffkud-->
       <entry>
        <para><xref linkend="new-sles11sp3" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b14jt4a4">
  <title>2013年3月19日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14jt4a5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b14jt4a5">
   <title>Linuxファイルシステムの概要</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b14jt4a6-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b14jt4a7-->
       <entry>
        <para><xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本項は、SLES 11におけるinodeサイズとバイト数/inode数の比率に対するデフォルト設定の変更を説明するために更新されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b14dmrrl">
  <title>2013年3月11日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14doxle" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14dmrrm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b14doxle">
   <title>LVMの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b14doxlf-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b14doxlg-->
       <entry>
        <para><xref linkend="lvm-activate-vgs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b14dmrrm">
   <title>Linuxファイルシステムの概要</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b14dmrrn-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b14dmrro-->
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>複数デバイスのサポート。ファイルシステムを拡大したり、縮小できます。この機能は、YaSTパーティショナの今後のリリースで利用可能となる予定です。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b13z9xd2">
  <title>2013年2月8日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13z9xd3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b13z9xd3">
   <title>ルートパーティション用のソフトウェアRAID1の設定</title>
   <para>このセクションは、ソフトウェアRAID1タイプに重点を置くために変更されました。ソフトウェアRAID0およびRAID5はサポートされていません。これらは、これまでエラーに含まれていました。追加の重要な変更点を以下に記載しています。</para>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b13z9xd4-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b13z9xd5-->
       <entry>
        <para><xref linkend="bi9d2lj" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><filename>/boot </filename>パーティション用に使用する、3つ目のデバイスが必要です。 デバイスは、ローカルのデバイスである必要があります。</para>
       </entry>
      </row>
      <row><!--id=b13za2s6-->
       <entry>
        <para><xref linkend="b13za1ue" xrefstyle="StepXRef"/> での <xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><filename>/boot</filename>パーティションを作成します。デバイスは、ローカルのデバイスである必要があります。</para>
       </entry>
      </row>
      <row><!--id=b13za83a-->
       <entry>
        <para><xref linkend="bi9dzpu" xrefstyle="StepXRef"/> での <xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para> <guimenu>RAIDタイプ</guimenu>で、<guimenu>RAID 1 (ミラーリング)</guimenu>を選択します。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b13g65gi">
  <title>2013年1月8日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13jh2o0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g65z1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b13jh2o0">
   <title>LVMの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b13jh2o1-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b13jh2o2-->
       <entry>
        <para><xref linkend="sec-yast2-system-lvm-explanation" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <important>
         <para>LVMの構成後にマルチパスのサポートを追加する場合は、<filename>/etc/lvm/lvm.conf</filename>ファイルを修正し、<filename>/dev/disk/by-id</filename>ディレクトリ内のマルチパスデバイス名のみをスキャンするようにして(<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>に記載するとおり)、 サーバを再起動します。</para>
        </important>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b13g65z1">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b13g65z2-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b13jbspx-->
       <entry>
        <para><xref linkend="beg2pi0" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>各ノード上の<filename>/etc/multipath.conf</filename>ファイル内の構成設定が、クラスタ全体で同一であるようにしてください。 </para>
       </entry>
      </row>
      <row><!--id=b13g65z3-->
       <entry>
        <para><xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><filename>/dev/disk/by-id</filename>ディレクトリでマルチパスマップのデバイスへのリンクを使用する際は、デバイスの固定パスインスタンスではなく、<filename>dm-uuid*</filename>名または別名を指定するようにしてください。</para>
       </entry>
      </row>
      <row><!--id=b13gbii2-->
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>デバイスマッパー名に対して生ディスクとパーティションの両方を許容する場合は、<filename>mpath</filename>の前にハイフン(-)を付けずに、次のように指定します。</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*mpath-.*|", "r|.*|" ]
</screen>

       </entry>
      </row>
      <row><!--id=b13gbxz9-->
       <entry>
        <para><xref linkend="mpiousingpart" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><filename>lvm.conf</filename>および<filename>md.conf</filename>に対する環境設定ファイルが、必ずマルチパスデバイスの名前をポイントするようにします。これは、<filename>boot.multipath</filename>が有効になっていて、<filename>boot.lvm</filename>および<filename>boot.md</filename>以前にロードされていれば、自動的に行われます。そうなっていない場合は、LVMおよびMDの環境設定ファイルにマルチパスデバイスに対する固定パスが含まれている可能性があり、マルチパスデバイス名を使用するためにこれらを修正する必要があります。 </para>
       </entry>
      </row>
      <row><!--id=b13g705m-->
       <entry>
        <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>始める前に、「<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/>」の要件をレビューしてください。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b12irb56">
  <title>2012年11月14日</title>
  <para>次の節が更新されました。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12o29bv" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b12o29bv">
   <title>Linuxファイルシステムの概要</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b12o29bw-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b12r1r9k-->
       <entry>
        <para><xref linkend="sec-filesystems-lfs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは、<link xlink:href="http://www.suse.com/products/server/technical-information/">SUSE Linux Enterprise Server技術情報Webサイト</link>の<link xlink:href="http://www.suse.com/products/server/technical-information/#FileSystem">ファイルシステムのサポートとサイズ</link>との一貫性を持たせるため、更新されました。</para>
       </entry>
      </row>
      <row><!--id=b12o29bx-->
       <entry>
        <para><xref linkend="sect-stor-limits" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b12mdifb">
  <title>2012年10月29日</title>
  <para>前付けおよび誤植正誤表の修正。 </para>
 </section>
 <section xml:id="b12doybp">
  <title>2012年10月19日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12doybq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12doybu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b12doybq">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b12doybr-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b12doybs-->
       <entry>
        <para><xref linkend="bbillhs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>デバイス設定の具体例が、より上位の組織レベルに移動しました。</para>
       </entry>
      </row>
      <row><!--id=b12doybt-->
       <entry>
        <para><xref linkend="mpiohwsupconf" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><filename>/etc/multipath.conf</filename>ファイルを修正してドライ実行を行う際に、変更前の(またはデフォルトの)マルチパス設定で、<filename>multipathd</filename>デーモンがすでに実行されていることを前提とします。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b12doybu">
   <title>Linuxファイルシステムの概要</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b12doybv-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b12doybw-->
       <entry>
        <para><xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>Ext3ファイルシステムのファイルに対する拡張属性およびACL用のスペースを確保するため、Ext3に対するデフォルト  のinodeサイズが、SLES  10での 256バイトから、SLES11では256バイトに増えました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="b10v707p">
  <title>2012年9月28日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b10v71m2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b10v71m1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="b10v71m2">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b11v3x0i-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b122v4qy-->
       <entry>
        <para><xref linkend="b122uvel" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>SLES 11 SP2では、Prioritizerの指定には<literal>prio</literal>キーワードが使われ、Prioritizerが引数を必要とする場合は、その引数の指定に<literal>prio_args</literal>キーワードが使われます。</para>
        <para>マルチパスツール0.4.9以降では、<literal>/etc/multipath.conf</literal>ファイルの<literal>defaults{}</literal>または<literal>devices{}</literal>セクションの<filename>prio</filename>設定を使用します。キーワード<literal>prio</literal>が、<literal>multipath{)</literal>セクションの個別の<literal>multipaths</literal>定義に指定された場合は、暗黙のうちに無視されます。</para>
       </entry>
      </row>
      <row><!--id=b122xhwg-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><literal>prio</literal>および<literal>prio_args</literal>キーワードの使用に関する情報を追加しました。</para>
       </entry>
      </row>
      <row><!--id=b122u3zy-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>SLES 11 SP2では、rr_min_ioマルチパス属性は廃止となり、rr_min_io_rq属性に代わりました。</para>
       </entry>
      </row>
      <row><!--id=b11v3x0j-->
       <entry>
        <para><xref linkend="b11qkzgw" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=b122v4qz-->
       <entry>
        <para><xref linkend="b122uxzr" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=b122v4r0-->
       <entry>
        <para><xref linkend="b11qkzgx" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>こわれたリンクを修正しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="b10v71m1">
   <title>Linuxファイルシステムの概要</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row><!--id=b10v72jy-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=b10v72jz-->
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>Btrfsツールパッケージは<filename>btrfsprogs</filename>です。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bzit5x5">
  <title>2012年4月12日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bznyukh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bznyugr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bznyukh">
   <title>デバイスのマルチパスI/Oの管理</title>
   <para>この項は、すべての例でデバイスパスに<filename>/dev/disk/by-id</filename>ディレクトリを使用するよう更新されました。</para>
  </section>
  <section xml:id="bznyugr">
   <title>mdadmによるソフトウェアRAIDアレイのサイズ変更</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bznyyes-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bznyyet-->
       <entry>
        <para><xref linkend="resizedecr" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>個々のコンポーネントパーティションのサイズを縮小する前にRAIDのサイズを縮小するよう、手順の順番を修正しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bw4b1n8">
  <title>2012年2月27日(SLES 11 SP2)</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bw4b52h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7nlj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkbgyt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkgdv2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bw4b1n9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="byz8ra8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7y6n" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk9zeq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bxuakwj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkf9o0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bw4b52h">
   <title>Fibre Channel Storage over Ethernet Networks: FCoE</title>
   <para>このセクションは新たに追加されました。OpenFCoE (Open Fibre Channel over Ethernet)のサポートは、SLES 11から開始されています。</para>
  </section>
  <section xml:id="bwk7nlj">
   <title>GNU利用許諾契約書</title>
   <para>このセクションは新たに追加されました。</para>
  </section>
  <section xml:id="bwkbgyt">
   <title>LVMの設定 </title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bwkbgyu-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bwkbgyv-->
       <entry>
        <para><xref linkend="lvmtagging" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bwkgdv2">
   <title>NFSv4上でのアクセス制御リストの管理</title>
   <para>このセクションは新たに追加されました。</para>
  </section>
  <section xml:id="bw4b1n9">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bw4b1na-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bw4b1nb-->
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>SLES 11のデフォルトパス<literal>getuid</literal>は、/lib/udev/scsi_idです。</para>
       </entry>
      </row>
      <row><!--id=bwk7js1-->
       <entry>
        <para><xref linkend="mpioerrormgmt" xrefstyle="HeadingOnPage"/></para>
        <para><xref linkend="mpiostall" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><command>dmsetup message</command>コマンドでは、値0はセクタを表し、セクタ情報が不要なときに使用されます。 </para>
       </entry>
      </row>
      <row><!--id=bxu9zlh-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>クラスタ環境でマルチパスI/Oを使用する際のno_path_retryおよびフェールバックの設定に関して、推奨事項を追加しました。</para>
       </entry>
      </row>
      <row><!--id=bxu9zli-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>パスセレクタオプションの名前と設定が修正されました:</para>
        <simplelist>
         <member>round-robin 0</member> <member>least-pending 0</member> <member>service-time 0</member> <member>queue-length 0</member>
        </simplelist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="byz8ra8">
   <title>mdadmによるソフトウェアRAID 6および10の管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=byz8ra9-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=byz8raa-->
       <entry>
        <para><xref linkend="byz81ho" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bwk7y6n">
   <title>IPネットワークの大容量記憶域 - iSCSI </title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bwk7ylk-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bwkrs5c-->
       <entry>
        <para><xref linkend="bwkrqdd" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=bwk7yll-->
       <entry>
        <para><xref linkend="bwk7p6z" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bwk9zeq">
   <title>Linuxファイルシステムの概要</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bwk9zer-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bwk9zes-->
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。 </para>
        <para>SUSE Linux Enterprise 11 SP2から、Btrfsファイルシステムがルートのファイルシステムとしてサポートされます。つまり、SUSE Linux Enterprise 11 SP2のすべてのアーキテクチャにわたる、オペレーティングシステム用のファイルシステムです。 </para>
       </entry>
      </row>
      <row><!--id=bwkbczk-->
       <entry>
        <para><xref linkend="sec-filesystems-major-reiser" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <important>
         <para>ReiserFSファイルシステムは、特にマイグレーション用として、SUSE Linux Enterprise Server 11のライフタイムの間、完全にサポートされます。SUSEでは、SUSE Linux Enterprise Server 12から、新しいReiserFSファイルシステムの作成をサポートしない予定です。</para>
        </important>
       </entry>
      </row>
      <row><!--id=bwks4dw-->
       <entry>
        <para><xref linkend="bwkryet" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=bwkbc4f-->
       <entry>
        <para><xref linkend="sec-filesystems-lfs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションの値は、現在の規格に合わせて更新されました。</para>
       </entry>
      </row>
      <row><!--id=bwkbkhq-->
       <entry>
        <para><xref linkend="bwkbhpd" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bxuakwj">
   <title>ファイルシステムのサイズ変更</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bxuakwk-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bxuakwl-->
       <entry>
        <para><xref linkend="biuynjy" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="biuzt6a" xrefstyle="SectTitleOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>resize2fsコマンドでは、マウントされている場合にExt3ファイルシステムのみサイズ変更可能です。  Ext3ボリュームのサイズを、ボリュームのマウントまたはアンマウント時に拡大または縮小できます。ボリュームサイズを拡大または縮小するためには、Ext2/4ファイルシステムをアンマウントする必要があります。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bwkf9o0">
   <title>mdadmによるソフトウェアRAIDアレイのサイズ変更</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bwkfa7i-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bwkfa7j-->
       <entry>
        <para><xref linkend="resizeincrraid" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para><command>--assume-clean</command>は新しいオプションです。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bvqj59s">
  <title>2011年7月12日</title>
  <para>次の節が更新されました。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bvqj7sc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bvqj7sc">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bvqj7sd-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bvqj7se-->
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><command>mkinitrd</command>の実行が必要なのは、ルート(/)デバイスまたはその一部(<filename>/var</filename>、<filename>/etc</filename>、<filename>/log</filename>など)がSAN上にあり、マルチパスのブートが必要な場合のみです。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bvc15n0">
  <title>2011年6月14日</title>
  <para>次の節が更新されました。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bvc17t5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bvc17t8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bvc17t5">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bvc17t6-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bvc17t7-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>path_grouping_policyのデフォルト設定が、SLES 11ではマルチバスからフェールオーバーに変更となりました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bvc17t8">
   <title>SLES 11のストレージの新機能</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bvc17t9-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bvc17ta-->
       <entry>
        <para><xref linkend="bvc111p" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="burkc4m">
  <title>2011年5月5日</title>
  <para>このリリースでは、壊れたリンクが修復され、古い参照が削除されています。</para>
 </section>
 <section xml:id="bt5x8xp">
  <title>2011年1月</title>
  <para>次の節が更新されました。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bt5yoiu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bt5wm3n" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bt5ylzd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bt5yoiu">
   <title>LVMの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bt5yoiv-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bt5yoiw-->
       <entry>
        <para><xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>LVM2では、物理エクステントのい数を制限しません。エクステントが多くても、論理ボリュームに対するI/Oパフォーマンスに影響しませんが、LVMツールの動作が遅くなります。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bt5wm3n">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bt5wpqq-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bt5wpqr-->
       <entry>
        <para>特定ホストバスアダプタのフェイルオーバーの調整</para>
       </entry>
       <entry>
        <para>このセクションは削除されました。HBAフェールオーバーのガイダンスについては、ベンダのマニュアルをを参照してください。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bt5ylzd">
   <title>ファイルシステムのサイズ変更</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bt5ylze-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bt5ylzf-->
       <entry>
        <para><xref linkend="resizedecrfs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>ファイルシステムのサイズの縮小は、ファイルシステムのマウント解除時にサポートされています。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="brgqw2y">
  <title>2010年9月16日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="brgqysi" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="brgqysi">
   <title>LVMの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=brgqysj-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=brgqysk-->
       <entry>
        <para><xref linkend="bi706ct" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>説明と手順が拡張され、ディスク全体を使用するパーティションの設定方法が説明されています。</para>
        <para>手順は、YaSTパーティショナでハードディスクのパーティショニング機能を使用するように変更されました。</para>
       </entry>
      </row>
      <row><!--id=brgqysl-->
       <entry>
        <para> すべてのLVM管理セクション</para>
       </entry>
       <entry>
        <para>この章全体を通じて、YaSTパーティショナでボリューム管理を使用するように手順が変更されました。</para>
       </entry>
      </row>
      <row><!--id=brgqysm-->
       <entry>
        <para><xref linkend="brgpqe2" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=brgqysn-->
       <entry>
        <para><xref linkend="brgqpfy" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=brgqyso-->
       <entry>
        <para><xref linkend="brgpmw3" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=brgqysp-->
       <entry>
        <para><xref linkend="brgob84" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bq2fgom">
  <title>2010年6月21日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bq2fjfm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq7udwm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq2fh2u" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq2gisd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bq2fjfm">
   <title>LVMの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bq2fjfn-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bq2fjfo-->
       <entry>
        <para><xref linkend="bi706ct" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>手順に詳細が追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bq7udwm">
   <title>マルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bq7udwn-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bq7udwo-->
       <entry>
        <para><xref linkend="mpionames" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>ルートデバイスにユーザフレンドリな名前を使用すると、データが失われることがあります。「<link xlink:href="http://www.novell.com/support/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=7001133"><citetitle>TID 7001133: Recommendations for the usage of user_friendly_names in multipath configurations</citetitle></link>」から代替の方法が追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bq2fh2u">
   <title>mdadmによるソフトウェアRAID 6および10の管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bq2fi7n-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bq2fi7o-->
       <entry>
        <para><xref linkend="b7cynnk" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>例のエラーが修正されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bq2gisd">
   <title>IPネットワークの大容量記憶域 - iSCSI</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bq2gise-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bq2gisf-->
       <entry>
        <para><xref linkend="nofail" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bndh000">
  <title>2010年5月(SLES 11 SP1)</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bo1piss" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bok8zbg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bpjchpc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bndh0qn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bo1piss">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bo1pist-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bo1pisu-->
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><xref linkend="bg89rst" xrefstyle="StepOnPage"/>の例は修正されました。</para>
       </entry>
      </row>
      <row><!--id=bombwdc-->
       <entry>
        <para><xref linkend="bok8cn1" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=bothcg7-->
       <entry>
        <para><xref linkend="mpiotoolsmpt" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>パッケージのファイルリストは、サーバのアーキテクチャによって異なることがあります。multipath-toolsパッケージに含まれているファイルのリストについては、<link xlink:href="http://www.novell.com/products/server/techspecs.html?tab=1"><guimenu>SUSE Linux Enterprise Server Technical Specifications</guimenu>の<guimenu>Package Descriptions</guimenu>Webページ</link>にアクセスして、目的のアーキテクチャを見つけ、<guimenu>パッケージを名前でソート</guimenu>を選択し、次に、「multipath-tools」で検索して、そのアーキテクチャのパッケージリストを見つけます。</para>
       </entry>
      </row>
      <row><!--id=bomc4i7-->
       <entry>
        <para><xref linkend="mpiosysconfsandevs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>SANデバイスがサーバ上でルートデバイスとして使用される場合は、<xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/>に示されているように、デバイスのタイムアウト設定を変更します。</para>
       </entry>
      </row>
      <row><!--id=bpjp7nk-->
       <entry>
        <para><xref linkend="mpiohwsupconf" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>-v3冗長レベルの出力例が追加されました。</para>
       </entry>
      </row>
      <row><!--id=bomcuqx-->
       <entry>
        <para><xref linkend="bomcrff" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=bomcuqy-->
       <entry>
        <para><xref linkend="bomc64e" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bok8zbg">
   <title>IPネットワークの大容量記憶域 - iSCSI</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bok8zbh-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bok8zbi-->
       <entry>
        <para><xref linkend="bojud2n" xrefstyle="StepXRef"/> での <xref linkend="sec-inst-system-iscsi-target-yast" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><guimenu>YaST</guimenu>の<guimenu>Network Services</guimenu><guimenu>iSCSI Target</guimenu>機能の<guimenu>保存</guimenu>オプションを使用すると、iSCSIターゲット情報をエクスポートできます。これにより、この情報をリソースの利用者に簡単に提供することができます。</para>
       </entry>
      </row>
      <row><!--id=bp5cfck-->
       <entry>
        <para><xref linkend="sec-inst-system-iscsi-ts" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bpjchpc">
   <title>ソフトウェアRAIDの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bpjchpd-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bpjchpe-->
       <entry>
        <para><xref linkend="bgchysh" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>『Software RAID HOW-TO』は、サポートされなくなりました。代わりに、「<link xlink:href="https://raid.wiki.kernel.org/index.php/Linux_Raid"><citetitle>Linux RAID </citetitle>wiki</link>」を使用してください。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bndh0qn">
   <title>新機能</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bndh0qo-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bndh0qp-->
       <entry>
        <para><xref linkend="bndgyod" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="boj6043">
  <title>2010年2月23日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="boj6044" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="boja57r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="boj6044">
   <title>ルートパーティション用のソフトウェアRAIDの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=boj6045-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=boj62jo-->
       <entry>
        <para><xref linkend="bi9d2lj" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>RAID 0の定義のエラーを修正しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="boja57r">
   <title>マルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=boja57s-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=boja57t-->
       <entry>
        <para><xref linkend="scandev" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>再起動せずにデバイスをスキャンできる<filename>rescan-scsi-bus.sh</filename>スクリプトの使用に関する情報を追加しました。</para>
       </entry>
      </row>
      <row><!--id=boja57u-->
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>再起動せずにデバイスをスキャンできる<filename>rescan-scsi-bus.sh</filename>スクリプトの使用に関する情報を追加しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bmy23qz">
  <title>2009年12月1日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bmy26at" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy2h0k" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy26aw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bmy26at">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bmy26au-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bn4z2ku-->
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>-f mpathオプションが-f multipathに変更されました。</para>
        <para>mkinitrd -f multipath</para>
       </entry>
      </row>
      <row><!--id=bmy26av-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/>のprio_callout (<xref linkend="b122sbgy"/>)</para>
       </entry>
       <entry>
        <para>マルチパスのprio_calloutsプログラムは、<filename>/lib/libmultipath/lib*</filename>内の共有ライブラリ内にあります。共有ライブラリを使用することで、デーモンの起動時、コールアウトプログラムがメモリにロードされます。 </para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bmy2h0k">
   <title>ファイルシステムのサイズ変更</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bmy2h0l-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bmy2h0m-->
       <entry>
        <para><xref linkend="biuytzx" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>resize2fsユーティリティが、ext3ファイルシステムのオンライン、またはオフラインのサイズ変更をサポートするようになりました。 </para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bmy26aw">
   <title>新機能</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bmy26ax-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bmy26ay-->
       <entry>
        <para><xref linkend="bmy1edt" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>

<screen>

</screen>

       </entry>
      </row>
      <row><!--id=bn4z2kv-->
       <entry>
        <para><xref linkend="bn4yxd1" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bm18yt7">
  <title>2009年10月20日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bm18yt8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bm1n6qa" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmqj45v" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bm18yt8">
   <title>LVMの設定</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bm18yt9-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bm18yta-->
       <entry>
        <para><xref linkend="sec-yast2-system-lvm-explanation" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>YaSTコントロールセンターで、<menuchoice><guimenu>システム</guimenu><guimenu>パーティショナ</guimenu></menuchoice>の順に選択します。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bm1n6qa">
   <title>デバイスのマルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bm1n6qb-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bm1n6qc-->
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>キーワードdevnode_blacklistは廃止され、キーワードblacklistに代わりました。</para>
       </entry>
      </row>
      <row><!--id=bmqiea8-->
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>getuid_calloutがgetuidに変更されました。</para>

<screen>

</screen>

       </entry>
      </row>
      <row><!--id=bmqicwf-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>getuid_calloutがgetuidに変更されました。</para>

<screen>

</screen>

       </entry>
      </row>
      <row><!--id=bmqj3nw-->
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>least-pending、length-load-balancing、およびservice-timeの各オプションのパスセレクタに関する説明を追加しました。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bmqj45v">
   <title>新機能</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bmqj45w-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bmqj45x-->
       <entry>
        <para><xref linkend="bmqiv07" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bleqdg7">
  <title>2009年8月3日</title>
  <para>次の節が更新されました。この変更については次に説明しています。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bleqegm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bleqegm">
   <title>マルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bleqegn-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bleqego-->
       <entry>
        <para><xref linkend="bleqcv0" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bkkotcf">
  <title>2009年6月22日</title>
  <para>次の項が更新されています。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bkobnh2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bky5or6" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bkkout0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bkobnh2">
   <title>マルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bkobnh3-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bky5lwj-->
       <entry>
        <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>System Zに<xref linkend="bky5jc7" xrefstyle="StepOnPage"/>および<xref linkend="bky5j1x" xrefstyle="StepOnPage"/>を追加しました。</para>

<screen>

</screen>

       </entry>
      </row>
      <row><!--id=bkobnh4-->
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>ステップ2のコマンドラインの構文を修正しました。</para>

<screen>

</screen>

       </entry>
      </row>
      <row><!--id=bky51ut-->
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><xref linkend="befqjhp" xrefstyle="StepOnPage"/>ではステップ7とステップ8を変更しました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bky5or6">
   <title>mdadmによるソフトウェアRAID 6および10の管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bky5or7-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bky5or8-->
       <entry>
        <para><xref linkend="raidmdadmdegraded" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>毎秒更新されている間に再構築の進捗を確認するには、次のように入力します。</para>

<screen>
watch -n 1 cat /proc/mdstat 
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
  <section xml:id="bkkout0">
   <title>IPネットワークの大容量記憶域 - iSCSI </title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bkkout1-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bkkout2-->
       <entry>
        <para><xref linkend="sec-inst-system-iscsi-initiator-yast" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>わかりやすくするため、内容を整理しました。</para>
        <para>iSCSIターゲットデバイスの起動オプションの設定の使用法に関する情報を追加しました。</para>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <formalpara xml:id="bkobopt">
           <title>自動:</title>
           <para>このオプションは、iSCSIサービス自体の起動時に接続するiSCSIターゲットに使用されます。これが通常の設定です。</para>
          </formalpara>
         </listitem>
         <listitem>
          <formalpara xml:id="bkobopu">
           <title>Onboot(起動時):</title>
           <para>このオプションは、起動時、つまりルート(<filename>/</filename>)がiSCSI上にある場合に接続するiSCSIターゲットに使用します。したがって、iSCSIターゲットデバイスはサーバの起動時にinitrdによって評価されます。</para>
          </formalpara>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
 <section xml:id="bfmmkat">
  <title>2009年5月21日</title>
  <para>次の節が更新されました。変更内容は次のとおりです。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bfmml01" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <section xml:id="bfmml01">
   <title>マルチパスI/Oの管理</title>
   <informaltable>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row><!--id=bfmml02-->
       <entry>
        <para>場所</para>
       </entry>
       <entry>
        <para>変更</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row><!--id=bkk3nxd-->
       <entry>
        <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>IBM zSeriesデバイスをマルチパス処理でテストした結果、dev_loss_tmoパラメータを90秒に、fast_io_fail_tmoパラメータを5秒に設定する必要があることわかりました。zSeriesデバイスをご使用の場合は、手動で<filename>/etc/multipath.conf</filename>ファイルの作成と設定を行い、値を指定する必要があります。詳細については、<xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/>を参照してください。</para>
       </entry>
      </row>
      <row><!--id=bfmml04-->
       <entry>
        <para><xref linkend="mpiotoolsdm" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>マルチパス処理は、SUSE Linux Enterprise Server 11以降の<filename>/boot</filename>デバイスに対してサポートされています。 </para>
       </entry>
      </row>
      <row><!--id=bkj949q-->
       <entry>
        <para><xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>このセクションは新たに追加されました。</para>
       </entry>
      </row>
      <row><!--id=bfmml03-->
       <entry>
        <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>SUSE Linux Enterprise Server 11では、<filename>/boot</filename>および<filename>/root</filename>用のDM-MPがサポート、および提供されるようになりました。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </section>
 </section>
</appendix>

</book>
