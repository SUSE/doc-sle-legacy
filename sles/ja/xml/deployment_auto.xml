<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="deployment_auto.xml" id="cha.deployment.autoinst" os="sled;sles">
 <title>自動インストール</title>
 <para>
  AutoYaSTを使用して、多数のマシンに並行してSUSE® Linux Enterpriseをインストールできます。AutoYaST技術は、異種ハードウェア環境への導入に対して柔軟に対応します。この章では、単純な自動インストールを行うための準備作業、および異種ハードウェア環境の場合の高度なインストール方法について説明します。
 </para>
 <sect1 id="sec.deployment.autoinst.simple">
  <title>単純な大規模インストール</title>

  <important>
   <title>同一のハードウェアを使用している環境</title>
   <para>
    このシナリオでは、全く同じハードウェア設定の一連のコンピュータにSUSE Linux Enterpriseを展開することが想定されています。
   </para>
  </important>

  <para>
   AutoYaSTの大規模インストールを準備するには、次の手順に従ってください。
  </para>

  <procedure>
   <step performance="required">
    <para>
     導入に必要なインストールの詳細を定義したAutoYaSTプロファイルを作成します。詳細は、<xref linkend="sec.deployment.autoinst.simple.profile"/>を参照してください。
    </para>
   </step>
   <step performance="required">
    <para>
     AutoYaSTプロファイルのソース、およびインストールルーチンに渡すパラメータを決定します。詳細については、<xref linkend="sec.deployment.autoinst.simple.dist"/>を参照してください。
    </para>
   </step>
   <step performance="required">
    <para>
     <xref linkend="sec.deployment.autoinst.simple.source"/>の説明に従って、SUSE Linux Enterpriseインストールデータのソースを決定します。
    </para>
   </step>
   <step performance="required">
    <para>
     自動インストールのブートシナリオを決定および設定します。詳細は、<xref linkend="sec.deployment.autoinst.simple.boot"/>を参照してください。
    </para>
   </step>
   <step performance="required">
    <para>
     パラメータを手動で追加、または<filename>info</filename>ファイルを作成して、インストールルーチンにコマンドラインを渡します。詳細は、<xref linkend="sec.deployment.autoinst.simple.info"/>を参照してください。
    </para>
   </step>
   <step performance="required">
    <para>
     自動インストールを開始します。詳細は、<xref linkend="sec.deployment.autoinst.simple.install"/>を参照してください。
    </para>
   </step>
  </procedure>

  <sect2 id="sec.deployment.autoinst.simple.profile">
   <title>AutoYaSTプロファイルの作成</title>
   <para>
    AutoYaSTに、何をインストールするか、そしてインストール先システムをどのように設定するかを知らせるには、AutoYaSTプロファイルを使用します。このプロファイルは、さまざまな方法で作成できます。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      インストールした直後のコンピュータから同一構成の他のコンピュータに複製する
     </para>
    </listitem>
    <listitem>
     <para>
      AutoYaST GUIを使って、要件に合うようにプロファイルを作成および変更する
     </para>
    </listitem>
    <listitem>
     <para>
      XMLエディタを使って最初からプロファイルを作成する
     </para>
    </listitem>
   </itemizedlist>
   <para>
    インストール直後のコンピュータから複製するには、次の手順に従ってください。
   </para>
   <procedure>
    <step performance="required">
     <para>
      通常のインストールを行います。
     </para>
    </step>
    <step performance="required">
     <para>
      ハードウェア設定を完了し、リリースノートを読んだら、<guimenu>このシステムをAutoYaST用に複製する</guimenu>を選択します(デフォルトで、このチェックボックスがオンになっていない場合)。このチェックボックスをオンにすると、<filename>/root/autoyast.xml</filename>プロファイルが作成されます。このプロファイルは、同一構成の他のコンピュータへの複製インストールに利用できます。
     </para>
    </step>
   </procedure>
   <para>
    AutoYaST GUIを使って既存のシステム設定からプロファイルを必要に応じて作成および変更するには、次の手順に従ってください。
   </para>
   <procedure>
    <step performance="required">
     <para>
      root<systemitem class="username">として、YaSTを起動します。</systemitem>
     </para>
    </step>
    <step performance="required">
     <para>
      <menuchoice><guimenu>その他</guimenu><guimenu>自動インストール</guimenu></menuchoice>の順に選択して、AutoYaST GUIを起動します。
     </para>
    </step>
    <step performance="required">
     <para>
      <menuchoice><guimenu>ツール</guimenu><guimenu>参照プロファイルの作成</guimenu></menuchoice>の順に選択してAutoYaSTを準備し、現在のシステム設定をAutoYaSTプロファイルにミラーリングさせます。
     </para>
    </step>
    <step performance="required">
     <para>
      デフォルトリソース(ブートローダ、パーティション分割、ソフトウェアの選択など)に加えて、システムの他の側面もプロファイルに追加したい場合は、<guimenu>参照コントロールファイルの作成</guimenu>のリストで項目を選択します。
     </para>
    </step>
    <step performance="required">
     <para>
      ［作成］<guimenu>をクリックすると、YaSTによりすべてのシステム情報が収集され、新しいプロファイルが作成されます。</guimenu>
     </para>
    </step>
    <step performance="required">
     <para>
      次に、以下のいずれかの作業を行います。
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        作成されたプロファイルが完全に要件と一致している場合は、<menuchoice><guimenu>ファイル</guimenu><guimenu>名前を付けて保存</guimenu></menuchoice>の順に選択して、<filename>autoyast.xml</filename>のようにプロファイル名を入力します。
       </para>
      </listitem>
      <listitem>
       <para>
        左側のツリービューから適切な設定項目(<quote/>「ハードウェア」、「プリンタ」など)を選択し、<guimenu>設定</guimenu>をクリックして参照プロファイルを変更します。各YaSTモジュールが開きますが、変更内容はシステムに適用されるのではなく、AutoYaSTプロファイルに書き込まれます。作業が完了したら、<menuchoice><guimenu>ファイル</guimenu><guimenu>名前を付けて保存</guimenu></menuchoice>の順に選択して、適切なプロファイル名を入力します。
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step performance="required">
     <para>
      <menuchoice><guimenu>ファイル</guimenu><guimenu>終了</guimenu></menuchoice>の順に選択して、AutoYaSTモジュールを終了します。
     </para>
    </step>
   </procedure>
   <figure>
    <title>AutoYaSTフロントエンドを使ったAutoYaSTプロファイルの編集</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.dist">
   <title>プロファイルの配布とAutoYaSTパラメータの決定</title>
   <para>
    AutoYaSTプロファイルは、さまざまな方法で配布できます。プロファイルデータを配布するために使用するプロトコルによって、プロファイルの場所を知らせるために使用するAutoYaSTパラメータが異なります。プロファイルの場所は、ブートプロンプト、またはブート時にロードされる<filename>info</filename>ファイルを使って、インストールルーチンに渡されます。次のオプションを指定できます。
   </para>
   <informaltable>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         プロファイルの場所
        </para>
       </entry>
       <entry>
        <para>
         パラメータ
        </para>
       </entry>
       <entry>
        <para>
         説明
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         ファイル
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=file://<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         指定したパス(ソースルートディレクトリへの相対パス。CD ROMの最上位ディレクトリにある場合は、<filename>file:///autoyast.xml</filename>)にあるコントロールファイルをインストールルーチンに参照させます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Device
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=device://<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         インストールルーチンに、ストレージデバイス上の制御ファイルを参照させます。デバイス名以外は必要ありません。たとえば、<filename>/dev/sda1</filename>ではなく、<filename>sda1</filename>と指定する必要があります。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         フロッピー(Floppy)
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=floppy://<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         インストールルーチンに、フロッピードライブにあるフロッピーディスク上の制御ファイルを参照させます。このオプションは、CD-ROMからブートする場合などに役立ちます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=nfs://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         インストールルーチンに、NFSサーバから制御ファイルを取得させます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=http://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         インストールルーチンに、HTTPサーバから制御ファイルを取得させます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTPS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=https://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         インストールルーチンに、HTTPSサーバから制御ファイルを取得させます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         TFTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=tftp://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         インストールルーチンに、TFTPサーバから制御ファイルを取得させます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         FTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=ftp://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         インストールルーチンに、FTPサーバから制御ファイルを取得させます。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    <replaceable>server</replaceable>および<replaceable>path</replaceable>の部分には、それぞれ実際のサーバ名またはパス名を指定してください。
   </para>
   <para>
    AutoYaSTには、クライアントのMACアドレスに特定のプロファイルをバインドできる機能があります。この機能を利用することにより、<option>autoyast=</option>パラメータを変更せずに、異なるプロファイルを使用して、同じセットアップで別のインスタンスのインストールを行うことができます。
   </para>
   <para>
    この機能を使用するには、次の手順に従ってください。
   </para>
   <procedure>
    <step performance="required">
     <para>
      クライアントのMACアドレスをファイル名にして、個別のプロファイルを作成します。作成したプロファイルは、自分のAutoYaSTプロファイルがあるHTTPサーバに保管します。
     </para>
    </step>
    <step performance="required">
     <para>
      <option>autoyast=</option>パラメータの作成時には、パスとファイル名を省略します。以下に例を示します。
     </para>
<screen>autoyast=tftp://192.168.1.115/</screen>
    </step>
    <step performance="required">
     <para>
      自動インストールを開始します。
     </para>
    </step>
   </procedure>
   <para>
    YaSTは、次の手順でプロファイルの場所を判断します。
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      YaSTは、自分のIPアドレスの大文字16進数表記を使ってプロファイルを検索します。たとえば、IPアドレスの<literal>192.0.2.91</literal>は、16進数表記で<literal>C000025B</literal>となります。
     </para>
    </listitem>
    <listitem>
     <para>
      このファイルが見つからなかった場合、16進数表記の桁を1つ削除して、もう一度検索を行います。適切な名前を持つファイルが見つかるまで、この手順を8回繰り返します。
     </para>
    </listitem>
    <listitem>
     <para>
      それでも失敗する場合は、ファイル名としてクライアントのMACアドレスを使用してファイルを検索します。たとえば、クライアントのMACアドレスが<literal>0080C8F6484C</literal>である場合、この名前を持つファイルが検索されます。
     </para>
    </listitem>
    <listitem>
     <para>
      ファイル名がMACアドレスであるファイルが見つからなかった場合は、ファイル名が<filename>default</filename> (小文字)のファイルを探します。YaSTがAutoYaSTプロファイルを検索する順序の例を以下に示します。
     </para>
<screen>
C000025B 
C000025 
C00002 
C0000 
C000 
C00 
C0 
C 
0080C8F6484C 
default
     </screen>
    </listitem>
   </orderedlist>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.source">
   <title>インストールデータの提供</title>
   <para>
    インストールデータは、製品CD、DVD、またはネットワークインストールソースを介して提供できます。製品CDをインストールソースとして使用する場合は、ブートプロセスを手動で開始したり、CDを交換する必要があるため、インストール先のクライアントに物理的にアクセスする必要があります。
   </para>
   <para>
    ネットワーク経由でインストールソースを提供する場合は、<xref linkend="sec.deployment.remoteinst.instserver.sles9"/>の説明に従ってネットワークインストールサーバ(HTTP、NFS、FTP)を設定します。インストールルーチンにサーバの場所を渡すには、<filename>info</filename>ファイルを使用します。
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.boot">
   <title>ブートシナリオの設定</title>
   <para>
    クライアントは、さまざまな方法でブートできます。
   </para>
   <variablelist>
    <varlistentry>
     <term>ネットワークブート</term>
     <listitem>
      <para>
       通常のリモートインストールでは、Wake on LANとPXEで自動インストールを開始することができます。また、ブートイメージとコントロールファイルはTFTPで取得し、インストールソースはネットワークインストールサーバから取得できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ブート可能CD-ROM</term>
     <listitem>
      <para>
       自動インストールするシステムのブートにオリジナルのSUSE Linux Enterpriseメディアを使用し、コントロールファイルをネットワークやフロッピーディスクから取得します。または、インストールソースとAutoYaSTプロファイルの両方を格納した独自のCD-ROMを作成することもできます。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    以降の項では、ネットワークブートまたはCD-ROMからのブート手順の基本的な概略を説明します。
   </para>
   <sect3 id="sec.deployment.autoinst.simple.boot.pxe">
    <title>ネットワークブートの準備</title>
    <para>
     Wake on LAN、PXE、およびTFTPを使ったネットワークブートについては、<xref linkend="sec.deployment.remoteinst.scenario.vncpxe"/>を参照してください。自動インストールの準備を行うには、PXE Linux設定ファイル(<filename>/srv/tftp/pxelinux.cfg/default</filename>)に、AutoYaSTプロファイルの場所を指定した<literal>autoyast</literal>パラメータを追加します。標準インストールを行う場合のエントリの例を以下に示します。
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ 
	  
	</screen>
    <para>
     自動インストール時の例を以下に示します。
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ \
           autoyast=nfs://192.168.1.110/profiles/autoyast.xml
	</screen>
    <para>
     これらの例のIPアドレスとパスは、実際の環境に合わせて変更する必要があります。
    </para>
   </sect3>
   <sect3 id="sec.deployment.autoinst.simple.boot.cd">
    <title>CD-ROM からのブートの準備</title>
    <para>
     AutoYaSTインストールでCD-ROMからブートするには、さまざまな方法があります。次の中から、適切な方法を選択してください。
    </para>
    <variablelist>
     <varlistentry>
      <term>SUSE Linux Enterprise Mediaからブートし、プロファイルをネットワーク経由で取得する</term>
      <listitem>
       <para>
        ネットワークベースのインストールでは完全にインストールできない場合(ハードウェアがPXEをサポートしていない場合など)で、プロセス中にシステムに物理的にアクセスできる場合は、この方法を使用します。
       </para>
       <para>
        この方法では、次のものが必要になります。
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          SUSE Linux Enterprise Serverメディア
         </para>
        </listitem>
        <listitem>
         <para>
          プロファイルデータを提供するネットワークサーバ(詳細は<xref linkend="sec.deployment.autoinst.simple.dist"/>を参照)
         </para>
        </listitem>
        <listitem>
         <para>
          プロファイルの場所をインストールルーチンに知らせる<filename>info</filename>ファイルを含んだフロッピーディスク
         </para>
         <para>
          <emphasis>または</emphasis>
         </para>
         <para>
          autoyast=<literal>パラメータを手動で入力するため、システムのブートプロンプトへのアクセス</literal>
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term> SUSE Linux Enterprise Mediaからのブートとインストール、およびフロッピーディスクからのプロファイルの取得 </term>
      <listitem>
       <para>
        ネットワークベースのインストールでは完全にインストールできない場合に、この方法を使用します。この方法では、ターゲットコンピュータをオンにしたり、ブートプロンプトでプロファイルの場所を入力するため、インストールするシステムに物理的にアクセスする必要があります。また、いずれの場合でも、インストールの内容によってはメディアを交換しなければならないこともあります。
       </para>
       <para>
        この方法では、次のものが必要になります。
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          SUSE Linux Enterprise Serverメディア
         </para>
        </listitem>
        <listitem>
         <para>
          プロファイルと<filename>info</filename>ファイルの両方を格納したフロッピーディスク
         </para>
         <para>
          <emphasis>または</emphasis>
         </para>
         <para>
          <option>autoyast=</option>パラメータを入力するため、ターゲットのブートプロンプトへのアクセス
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>カスタムメディアからブートおよびインストールを行い、プロファイルもそのメディアから取得する</term>
      <listitem>
       <para>
        特定のソフトウェアパッケージだけをインストールすればよく、ターゲット数が比較的少ない場合は、インストールデータとプロファイルの両方を格納した独自のCDを作成することも考慮してください。この方法は、ネットワークが利用できない場合などに役立ちます。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.info">
   <title>info<filename>ファイルの作成</filename></title>
   <para>
    ターゲットのインストールルーチンには、AutoYaSTフレームワークのすべてのコンポーネントを認識させる必要があります。認識させるには、インストールプロセスを制御するために必要なAutoYaSTコンポーネント、インストールソース、およびパラメータを探すのに必要なすべてのパラメータを含んだコマンドラインを作成します。
   </para>
   <para>
    このためには、インストール時にブートプロンプトから手動でこれらのパラメータを指定するか、またはインストールルーチン(linuxrc)に参照させる<filename>info</filename>ファイルを作成します。ブートプロンプトから手動で指定する方法は、インストール対象クライアントに物理的にアクセスする必要があるため、大規模な導入には向いていません。ファイルを作成する方法は、<filename>info</filename>ファイルをいくつかのメディアに格納し、それを自動インストールの前にクライアントのドライブに挿入して準備しておくことができます。かわりに、<filename>pxelinux.cfg/default</filename>ファイルにlinuxrcパラメータを指定して、PXEブートを使用することもできます。詳細は、<xref linkend="sec.deployment.autoinst.simple.boot.pxe"/>を参照してください。
   </para>
   <para>
    linuxrcで一般的に使用されるパラメータを以下に示します。詳細は、<filename>/usr/share/doc/packages/autoyast</filename>にある、AutoYaSTパッケージのドキュメントを参照してください。
   </para>
   <important>
    <title>パラメータと値の区切り方</title>
    <para>
     ブートプロンプトからlinuxrcに渡すパラメータを入力する場合、パラメータと値の間は「<literal>=</literal>」で区切ります。info<filename>ファイルを使用する場合は、パラメータと値の間を「</filename>:<literal>」で区切ります。</literal>
    </para>
   </important>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         キーワード
        </para>
       </entry>
       <entry>
        <para>
         値
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <literal>netdevice</literal>
        </para>
       </entry>
       <entry>
        <para>
         ネットワークセットアップに使用するネットワークデバイス(BOOTP/DHCPリクエスト用)  複数のネットワークデバイスを利用できる場合にのみ指定する必要があります。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>hostip</literal>
        </para>
       </entry>
       <entry>
        <para>
         指定しない場合、クライアントはBOOTPリクエストを送信します。値を指定した場合は、指定したデータに基づいてクライアントが設定されます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netmask</literal>
        </para>
       </entry>
       <entry>
        <para>
         選択したネットワークのネットマスク。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>ゲートウェイ</literal>
        </para>
       </entry>
       <entry>
        <para>
         デフォルトゲートウェイ。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>nameserver</literal>
        </para>
       </entry>
       <entry>
        <para>
         ネームサーバ。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>autoyast</literal>
        </para>
       </entry>
       <entry>
        <para>
         自動インストールに使用するコントロールファイルの場所で、「<literal>autoyast=nfs//192.168.1.110/profiles/</literal>」のように指定します。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>install</literal>
        </para>
       </entry>
       <entry>
        <para>
         インストールソースの場所で、「<literal>install=nfs://192.168.1.110/CDs/</literal>」のように指定します。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vnc</literal>
        </para>
       </entry>
       <entry>
        <para>
         「<literal>1</literal>」を設定すると、VNCリモート制御によるインストールが有効になります。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vncpassword</literal>
        </para>
       </entry>
       <entry>
        <para>
         VNCのパスワードを指定します。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>usessh</literal>
        </para>
       </entry>
       <entry>
        <para>
         「<literal>1</literal>」を設定すると、SSHリモート制御によるインストールが有効になります。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netsetup</literal>
        </para>
       </entry>
       <entry>
        <para>
         <literal>1</literal>に設定すると、ネットワークをセットアップします。通常、これは自動的に実行されますが、インストールリポジトリがローカルで提供され(例えば、DVDまたはローカルisoイメージにより)、<filename>info</filename>ファイルがネットワークからロードされる場合には、<literal>netsetup=1</literal>と設定する必要があります。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    自動インストール時にDHCP経由でクライアントを設定し、ネットワークインストールソースをを使用し、インストールプロセスをVNCを使って監視する場合、<filename>info</filename>ファイルは次のようになります。
   </para>
<screen>autoyast:<replaceable>profile_source</replaceable> install:<replaceable>install_source</replaceable> vnc:1 vncpassword:<replaceable>some_password</replaceable></screen>
   <para>
    インストール時に静的なネットワーク設定を使う場合、<filename>info</filename>ファイルは次のようになります。
   </para>
<screen>
autoyast:<replaceable>profile_source</replaceable> \
install:<replaceable>install_source</replaceable> \ 
hostip:<replaceable>some_ip</replaceable> \ 
netmask:<replaceable>some_netmask</replaceable> \ 
gateway:<replaceable>some_gateway</replaceable></screen>
   <para>
    改行箇所の<literal>\</literal>マークは、それらの改行が読みやすさのためにだけ追加されていることを示します。すべてのオプションは、連続した文字列として入力する必要があります。
   </para>
   <para>
    <filename>info</filename>ファイル中のデータをlinuxrcに利用させるには、さまざまな方法があります。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      インストール時に、クライアントのドライブ内にあるフロッピーディスクまたはCD ROMにファイルを格納する。<systemitem>info=floppy:/info</systemitem>または<systemitem>info=cd:/info</systemitem>に類似した情報パラメータを追加する。
     </para>
    </listitem>
    <listitem>
     <para>
      カスタムインストールメディアまたはPXEブートから提供されるシステムのブート用初期RAMディスクのルートディレクトリにファイルを格納する。
     </para>
    </listitem>
    <listitem>
     <para>
      AutoYaSTプロファイルの一部としてファイルデータを保管する。この場合、linuxrcに認識させるために、AutoYaSTファイルのファイル名は、<filename>info</filename>でなければなりません。この場合の例を以下に示します。
     </para>
    </listitem>
    <listitem>
     <para>
      infoファイルの場所を示すURLを使用する。この構文は<systemitem>info=http://www.example.com/info</systemitem>のようになります。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    linuxrcは、プロファイル内でファイルの先頭を表す文字列(<option>start_linuxrc_conf</option>)を探します。文字列が見つかったら、そこから内容の解析を開始し、終端を表す文字列(<option>end_linuxrc_conf</option>)が見つかった時点で解析を終了します。プロファイル内で、オプションを次のように指定します。
   </para>
<screen>....
  &lt;install&gt;
....
    &lt;init&gt;
      &lt;info_file&gt;
&lt;![CDATA[
#
# Don't remove the following line:
# start_linuxrc_conf
#
install: nfs:<replaceable>server</replaceable>/<replaceable>path</replaceable>
vnc: 1
vncpassword: test
autoyast: file:///info

# end_linuxrc_conf
# Do not remove the above comment
#
]]&gt;

      &lt;/info_file&gt;
    &lt;/init&gt;
......
  &lt;/install&gt;
....
</screen>
   <para>
    この場合、linuxrcは従来の<filename>info</filename>ファイルのかわりに、ブートパラメータを含んだプロファイルをロードします。<option>install:</option>パラメータは、インストールソースの場所を示しています。<option>vnc</option>と<option>vncpassword</option>は、インストールの監視にVNCを使うことを表しています。<option>autoyast</option>パラメータは、<filename>info</filename>をAutoYaSTプロファイルとして扱うように指示します。
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.install">
   <title>自動インストールの開始と監視</title>
   <para>
    前述の準備が完了したら(プロファイル、インストールソース、および<filename>info</filename>ファイル)、自動インストールを開始できます。ブート方法やプロセスの監視方法によっては、クライアントでの物理的な操作が必要なこともあります。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      クライアントシステムを物理メディア(製品CDやカスタムCDなど)からブートする場合は、それらのメディアをクライアントのドライブに挿入する必要があります。
     </para>
    </listitem>
    <listitem>
     <para>
      Wake on LANを使ってクライアントの電源を入れる場合以外は、クライアントの電源を手動で入れる必要があります。
     </para>
    </listitem>
    <listitem>
     <para>
      リモートによる自動インストールを行わない場合は、AutoYaSTからのメッセージはクライアントのモニタに表示されます。モニタが接続されていない場合は、シリアルコンソールに送られます。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    リモートによる自動インストールを行うには、<xref linkend="sec.deployment.autoinst.simple.info"/>の説明に従ってVNCまたはSSHパラメータを指定し、<xref linkend="sec.deployment.remoteinst.monitor"/>の説明に従って、他のコンピュータからクライアントに接続します。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.advanced">
  <title>ルールベースの自動インストール</title>

  <para>
   以降の項では、AutoYaSTを使用したルールベースのインストールの基本的な概念、およびカスタム自動インストール設定の作成例について説明します。
  </para>

  <sect2 id="sec.deployment.autoinst.advanced.expl">
   <title>ルールベースの自動インストールとは</title>
   <para>
    ルールベースのAutoYaSTインストールを利用すれば、異種ハードウェアが存在する環境で自動インストールを実施できます。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      サイトに異なるベンダからのハードウェアが混在していますか?
     </para>
    </listitem>
    <listitem>
     <para>
      サイトにあるコンピュータのハードウェア構成がそれぞれ異なっていますか(違うデバイスを使っていたり、メモリ量やディスクサイズが異なる場合など)?
     </para>
    </listitem>
    <listitem>
     <para>
      複数のドメイン間でインストールを実施する場合に、これらのドメインを区別する必要がありますか?
     </para>
    </listitem>
   </itemizedlist>
   <para>
    基本的に、ルールベースの自動インストールでは、異種ハードウェア環境に合わせて複数のプロファイルをマージした、独自のカスタムプロファイルを作成します。各ルールにはセットアップの特徴(ディスクサイズなど)が記述されており、ルールに一致した場合にどのプロファイルを使用するかをAutoYaSTに指示します。それぞれの特徴が記述された複数のルールは、AutoYaSTの<filename>rules.xml</filename>ファイルに保管されます。AutoYaSTはこれらのルールを処理して、AutoYaSTルールに一致する複数のプロファイルをマージした最終プロファイルを生成します。この手順の概略図は、<xref linkend="sec.deployment.autoinst.advanced.example"/>を参照してください。
   </para>
   <para>
    ルールベースのAutoYaST自動インストールを利用すれば、柔軟にSUSE Linux Enterpriseの導入を計画し、それを実行することができます。実行可能なアクションは次のとおりです。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      AutoYaSTで事前定義されているシステム属性に一致するかどうかを判断するルールを作成する
     </para>
    </listitem>
    <listitem>
     <para>
      論理演算子を使って複数のシステム属性(ディスクサイズとカーネルのアーキテクチャなど)を1つのルールにまとめる
     </para>
    </listitem>
    <listitem>
     <para>
      シェルスクリプトを実行して、その出力をAutoYaSTフレームワークに渡すことによって独自のカスタムルールを作成する作成可能なカスタムルールの数は5つです。
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <para>
     AutoYaSTを使ったルールの作成と使用については、<filename>/usr/share/doc/packages/autoyast2/html/index.html</filename>にあるパッケージドキュメントの<guimenu>Rules and Classes</guimenu>の章を参照してください。
    </para>
   </note>
   <para>
    ルールベースのAutoYaSTの大規模インストールを準備するには、次の手順に従ってください。
   </para>
   <procedure>
    <step performance="required">
     <para>
      異種ハードウェア環境のセットアップに必要なインストールの詳細を定義した、複数のAutoYaSTプロファイルを作成します。詳細は、<xref linkend="sec.deployment.autoinst.simple.profile"/>を参照してください。
     </para>
    </step>
    <step performance="required">
     <para>
      ハードウェアセットアップのシステム属性と一致するルールを定義します。詳細については、<xref linkend="sec.deployment.autoinst.advanced.example"/>を参照してください。
     </para>
    </step>
    <step performance="required">
     <para>
      AutoYaSTプロファイルのソース、およびインストールルーチンに渡すパラメータを決定します。詳細については、<xref linkend="sec.deployment.autoinst.simple.dist"/>を参照してください。
     </para>
    </step>
    <step performance="required">
     <para>
      <xref linkend="sec.deployment.autoinst.simple.source"/>の説明に従って、SUSE Linux Enterpriseインストールデータのソースを決定します。
     </para>
    </step>
    <step performance="required">
     <para>
      パラメータを手動で追加、または<filename>info</filename>ファイルを作成して、インストールルーチンにコマンドラインを渡します。詳細は、<xref linkend="sec.deployment.autoinst.simple.info"/>を参照してください。
     </para>
    </step>
    <step performance="required">
     <para>
      自動インストールのブートシナリオを決定および設定します。詳細は、<xref linkend="sec.deployment.autoinst.simple.boot"/>を参照してください。
     </para>
    </step>
    <step performance="required">
     <para>
      自動インストールを開始します。詳細は、<xref linkend="sec.deployment.autoinst.simple.install"/>を参照してください。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.advanced.example">
   <title>ルールベースの自動インストールの例</title>
   <para>
    ルールをどのように作成するかを理解するため、ここでは次の例を使って説明します。概略図は、<xref linkend="fig.autoyast.rules"/>を参照してください。AutoYaSTインストールを1回実行すると、次のセットアップが行われます。
   </para>
   <variablelist>
    <varlistentry>
     <term>プリントサーバ</term>
     <listitem>
      <para>
       このコンピュータには、最低限の項目しかインストールされません。デスクトップ環境は必要なく、一部のソフトウェアパッケージのみが必要とされます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>技術部門のワークステーション</term>
     <listitem>
      <para>
       これらのコンピュータにはデスクトップ環境と、さまざまな開発ソフトウェアが必要です。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>営業部門のラップトップ</term>
     <listitem>
      <para>
       これらのコンピュータには、デスクトップ環境と特定のアプリケーション(オフィス、カレンダソフトウェアなど)が必要です。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure id="fig.autoyast.rules">
    <title>AutoYaSTルール</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_rules.svg" width="90%" format="SVG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_rules.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    まず最初に、<xref linkend="sec.deployment.autoinst.simple.profile"/>に説明されているいずれかの方法を使って、それぞれのケースに対応するプロファイルを作成します。この例では、それぞれ<filename>print.xml</filename>、<filename>engineering.xml</filename>、および<filename>sales.xml</filename>を作成します。
   </para>
   <para>
    次に、AutoYaSTに使用するプロファイルを指示するために、3種類のハードウェアタイプを識別するルールを作成します。次のようなアルゴリズムに基づいて、ルールをセットアップします。
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      コンピュータのIPアドレスが<guimenu>192.168.2.253</guimenu>かどうか?そうならば、プリントサーバとして設定する。
     </para>
    </listitem>
    <listitem>
     <para>
      コンピュータにPCMCIAハードウェアが搭載されており、Intel製のチップセットが使用されているか?  そうならば、Intel製ラップトップであると判断し、営業部門に適したソフトウェアをインストールする。
     </para>
    </listitem>
    <listitem>
     <para>
      前述の条件に当てはまらない場合は、開発部門のワークステーションと判断し、適切なソフトウェアやパッケージをインストールする。
     </para>
    </listitem>
   </orderedlist>
   <para>
    このような条件を定義した<filename>rules.xml</filename>ファイルの例を以下に示します。
   </para>
<screen>
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE autoinstall SYSTEM "/usr/share/autoinstall/dtd/rules.dtd"&gt; 
&lt;autoinstall xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns"&gt;
  &lt;rules config:type="list"&gt;
    &lt;rule&gt;
       &lt;hostaddress&gt;
	    &lt;match&gt;192.168.2.253&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/hostaddress&gt;
       &lt;result&gt;
            &lt;profile&gt;print.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
       &lt;haspcmcia&gt;
            &lt;match&gt;1&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/haspcmcia&gt;
       &lt;custom1&gt;
           &lt;script&gt;
if grep -i intel /proc/cpuinfo &gt; /dev/null; then
echo -n "intel"
else
echo -n "non_intel"
fi;
           &lt;/script&gt;
           &lt;match&gt;*&lt;/match&gt;
           &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/custom1&gt;
       &lt;result&gt;
            &lt;profile&gt;sales.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
        &lt;operator&gt;and&lt;/operator&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
        &lt;haspcmcia&gt;
            &lt;match&gt;0&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
        &lt;/haspcmcia&gt;
 	&lt;result&gt;
            &lt;profile&gt;engineering.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
  &lt;/rules&gt;
&lt;/autoinstall&gt;
</screen>
   <para>
    このルールファイルを配布する場合、<filename>autoyast=</filename>protocol<filename>:</filename>serverip<filename>/profiles/<replaceable> URLで指定されている</replaceable>profiles<replaceable>ディレクトリ内に</replaceable>rules</filename>ディレクトリが常駐することを確認してください。AutoYaSTは、<filename>rules</filename>サブディレクトリの<filename>rules.xml</filename>を探し、ファイルに指定されているプロファイルをロードおよびマージします。
   </para>
   <para>
    以降の自動インストール作業は、通常と同じように実施します。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.moreinfo">
  <title>詳細情報</title>

  <para>

   AutoYaST技術の詳細な情報については、<phrase os="sles"><xref linkend="book.autoyast"/>または</phrase>ソフトウェアとともにインストールされたマニュアル(<filename>/usr/share/doc/packages/autoyast2</filename>)を参照してください。
  </para>
 </sect1>
</chapter>
