<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="yast2_ftp.xml" id="cha-ftp">
 <title>YaSTを使用したFTPサーバの設定</title><indexterm> <primary>FTPサーバ</primary> <secondary>設定</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>FTPサーバ</secondary> </indexterm>
 <abstract>
  <para>
   YaST <guimenu>FTPサーバ</guimenu>モジュールを使用すると、コンピュータをFTP (File Transfer Protocol)サーバとして機能するように設定できます。匿名および/または認証されたユーザがコンピュータに接続し、FTPプロトコルを使用してファイルをダウンロードできます。設定によっては、それらのユーザがFTPサーバにファイルをアップロードすることも可能です。YaSTは、システムにインストールされたFTPサーバデーモンに対して、統一された設定インタフェースを提供しています。
  </para>
 </abstract>
 <para>
  YaSTの<guimenu>FTPサーバ</guimenu>設定モジュールを使用すると、2つの異なるFTPサーバデーモンを設定できます。
 </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    <systemitem class="daemon">vsftpd</systemitem> (Very Secure FTP Daemon) 、および
   </para>
  </listitem>
  <listitem>
   <para>
    <systemitem class="daemon">pure-ftpd</systemitem>
   </para>
  </listitem>
 </itemizedlist>
 <para>
  設定できるのは、インストール済みサーバだけです。 
 </para>
 <para>
  vsftpdサーバとpure-ftpdサーバの設定オプションは多少異なります(特に、<guimenu>エキスパート設定</guimenu>ダイアログ)。この章では、vsftpdサーバの設定について説明します。
 </para>
 <para>
  YaST FTPサーバモジュールがシステム内にない場合は、<systemitem class="resource">yast2-ftp-server</systemitem>パッケージをインストールしてください。
 </para>
 <para>
  YaSTで、FTPサーバを設定するには、次の手順に従います。
 </para>
 <procedure>
  <step performance="required">
   <para>
    YaSTコントロールセンターを開き、<menuchoice><guimenu>ネットワークサービス</guimenu><guimenu>FTPサーバ</guimenu></menuchoice>の順に選択するか、<systemitem class="username">root</systemitem>として<command>yast2 ftp-server</command>コマンドを実行します。
   </para>
  </step>
  <step performance="required">
   <para>
    システムにFTPサーバがインストールされていない場合は、YaST FTPサーバモジュールの起動時に、インストールするサーバをどれにするか質問されます。サーバを選択してダイアログを確認します。2つのサーバがインストールされている場合は、サーバを選択して、<guimenu>OK</guimenu>をクリックします。
   </para>
  </step>
  <step performance="required">
   <para>
    <guimenu>起動</guimenu>ダイアログで、FTPサーバの起動に関するオプションを設定します。詳細については、<xref linkend="sec-ftp-start"/>を参照してください。
   </para>
   <para>
    <guimenu>一般</guimenu>ダイアログで、FTPディレクトリ、歓迎メッセージ、ファイル作成マスクなどの各種パラメータを設定します。詳細については、<xref linkend="sec-ftp-general"/>を参照してください。
   </para>
   <para>
    <guimenu>Performance</guimenu>ダイアログで、FTPサーバの負荷に影響するパラメータを設定します。詳細については、<xref linkend="sec-ftp-performance"/>を参照してください。
   </para>
   <para>
    <guimenu>認証</guimenu>ダイアログで、匿名および/または認証されたユーザに対してFTPサーバを使用可能にするかどうか設定します。詳細については、<xref linkend="sec-ftp-auth"/>を参照してください。
   </para>
   <para>
    <guimenu>エキスパート設定</guimenu>ダイアログで、FTPサーバの操作モード、SSL接続、およびファイアウォール設定を設定します。詳細については、<xref linkend="sec-ftp-expert"/>を参照してください。
   </para>
  </step>
  <step performance="required">
   <para>
    <guimenu>完了</guimenu>を押して設定を保存します。
   </para>
  </step>
 </procedure>
 <sect1 id="sec-ftp-start">
  <title>FTPサーバの起動</title>

  <para>
   <guimenu>FTP Start-Up</guimenu>ダイアログの<guimenu>サービス開始</guimenu>フレームで、FTPサーバを起動する方法を設定します。システムブート時の自動的なサーバ起動とサーバの手動起動のどちらかを選択できます。FTP接続要求後にのみFTPサーバを起動する場合は、<guimenu>xinetd経由</guimenu>を選択します。
  </para>

  <para>
   FTPサーバの現在のステータスが、<guimenu>FTP Start-Up</guimenu>ダイアログの<guimenu>開始/停止</guimenu>フレームに表示されます。<guimenu>FTPを開始する</guimenu>をクリックして、FTPサーバを起動します。サーバを停止するには、<guimenu>FTPを停止する</guimenu>をクリックします。サーバの設定を変更したら、<guimenu>設定を保存してFTPを再起動する</guimenu>をクリックします。<guimenu>完了</guimenu>を押して設定モジュールを終了すると、設定が保存されます。
  </para>

  <para>
   <guimenu>FTP起動</guimenu>ダイアログの<guimenu>選択されたサービス</guimenu>フレームに、使用されるFTPサーバ(vsftpdまたはpure-ftpd)が表示されます。両方のサーバがインストールされている場合、それらを切り替えることができます。現在の設定は自動的に変換されます。
   
  </para>

  <figure id="fig-yast2-ftp-start-up">
   <title>FTPサーバの設定 － 起動</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_ftp-start-up.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_ftp-start-up.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 id="sec-ftp-general">
  <title>FTP一般設定</title>

  <para>
   <guimenu>FTP General Settings</guimenu>ダイアログの<guimenu>一般の設定</guimenu>フレームで、FTPサーバへの接続後に表示される<guimenu>Welcome message</guimenu>を設定できます。
  </para>

  <para>
   <guimenu>Chroot Everyone</guimenu>オプションをオンにした場合は、すべてのローカルユーザが、ログイン後、ホームディレクトリのchroot jailに配置されます。このオプションは、セキュリティに影響します(特に、ユーザがアップロードパーミッションまたはシェルアクセスを持つ場合)。したがって、このオプションの有効化には、注意が必要です。
  </para>

  <para>
   <guimenu>Verbose Logging</guimenu>オプションをオンにすると、すべてのFTP要求と応答がログされます。
  </para>

  <para>
   匿名および/または認証されたユーザが作成するファイルのパーミッションは、umaskで制限できます。<guimenu>Umask for Anonymous</guimenu>で匿名ユーザ用のファイル作成マスクを設定し、<guimenu>Umask for Authenticated Users</guimenu>で認証されたユーザ用のファイル作成マスクを設定します。マスクは、必ずｾﾞﾛで始まる8進数として入力してください。umaskの詳細については、umaskマニュアルページ(<command>man 1p umask</command>)を参照してください。
  </para>

  <para>
   <guimenu>FTP Directories</guimenu>フレームで、匿名/認証されたユーザ用のディレクトリを設定します。<guimenu>参照</guimenu>をクリックすると、ローカルファイルシステムから使用できるディレクトリを選択できます。匿名ユーザのデフォルトFTPディレクトリは、<filename>/srv/ftp</filename>です。ただし、vsftpdでは、このディレクトリにすべてのユーザが書き込むことはできません。代わりに、書き込みパーミッション付きのサブディレクトリ<filename>upload</filename>が匿名ユーザ用に作成されます。
  </para>

  <note>
   <title>FTPディレクトリの書込みパーミッション</title>
   <para>
    pure-ftpdサーバでは、匿名ユーザ用のFTPディレクトリを書き込み可能にできます。サーバ間で切り換えを行う場合は、vsftpdサーバに戻す前に、pure-ftpdで使用したディレクトリから書き込みパーミッションを削除したことを確認してください。
   </para>
  </note>
 </sect1>
 <sect1 id="sec-ftp-performance">
  <title>FTPパフォーマンス設定</title>

  <para>
   <guimenu>パフォーマンス</guimenu>ダイアログで、FTPサーバの負荷に影響するパラメータを設定します。<guimenu>Max Idle Time</guimenu>は、リモートクライアントがFTPのコマンド間で待機できる最大時間(分)です。これよりアクティビティのない時間が長くなると、リモートクライアントの接続は切断されます。<guimenu>Max Clients for One IP</guimenu>では、1つのIPアドレスから接続できるクライアントの最大数を決定します。<guimenu>最大クライアント</guimenu>では、接続できるクライアントの最大数を決定します。クライアントをさらに追加すると、エラーメッセージが表示されます。
  </para>

  <para>
   最大データ転送速度(KB/秒)の設定は、ローカルの認証されたユーザについては<guimenu>Local Max Rate</guimenu>、匿名クライアントについては<guimenu>Anonymous Max Rate</guimenu>で行います。速度設定のデフォルト値は、<literal>0</literal>であり、無制限のデータ転送速度を意味します。
  </para>
 </sect1>
 <sect1 id="sec-ftp-auth">
  <title>認証</title>

  <para>
   <guimenu>認証</guimenu>ダイアログの<guimenu>Enable/Disable Anonymous and Local Users</guimenu>フレームでは、どのユーザにFTPサーバへのアクセスを許可するか設定できます。次のオプションのいずれかを選択できます: 匿名ユーザのみ、(システムにアカウントのある)認証されたユーザのみ、またはその両方のタイプのユーザにアクセスを付与します。
  </para>

  <para>
   FTPサーバへのファイルのアップロードを許可するには、<guimenu>認証</guimenu>ダイアログの<guimenu>Uploading</guimenu>フレームにある<guimenu>Enable Upload</guimenu>をオンにします。ここでは、各ボックスにチェック印を入れることで、匿名ユーザにも、アップロードまたはディレクトリの作成を許可できます。
  </para>

  <note>
   <title>vsftp—匿名ユーザのファイルのアップロードを許可する</title>
   <para>
    vsftpdサーバを使用し、匿名ユーザにファイルをアップロードさせたり、ディレクトリを作成させる場合は、すべてのユーザ用書き込みパーミッション付きのサブディレクトリを、匿名FTPディレクトリ内に作成する必要があります。
   </para>
  </note>
 </sect1>
 <sect1 id="sec-ftp-expert">
  <title>エキスパート設定</title>

  <para>
   FTPサーバは、アクティブモードまたはパッシブモードで実行できます。デフォルトでは、サーバはパッシブモードで実行されます。アクティブモードに切り換えるには、<guimenu>エキスパート設定</guimenu>ダイアログの<guimenu>パッシブモードを許可する</guimenu>オプションのチェックをオフにするだけです。データストリーム用に使用するサーバのポート範囲を変更することもできます。このためには、<guimenu>Min Port for Pas. Mode</guimenu>と<guimenu>Max Port for Pas. Mode</guimenu>のオプションを微調整します。
  </para>

  <para>
   クライアントとサーバ間で暗号化された通信が必要な場合は、<guimenu>SSLを有効に</guimenu>できます。サポートされるプロトコルのバージョンをチェックし、SSL暗号化接続で使用されるDSA証明書を指定します。

  </para>

  <para>
   システムがファイアウォールで保護されている場合は、<guimenu>ファイアウォール内でポートを開く</guimenu>をオンにして、FTPサーバへの接続を有効にします。
  </para>
 </sect1>
 <sect1 id="sec-ftp-info">
  <title>さらに詳細な説明が必要な場合は</title>

  <para>
   FTPサーバの詳細については、<phrase os="sles"><command>pure-ftpd</command>、</phrase><command>vsftpd</command>、および<command>vsftpd.conf</command>のマニュアルページを参照してください。
  </para>
 </sect1>
</chapter>
