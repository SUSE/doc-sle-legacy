<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE chapter
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="net_samba.xml" xml:id="cha-samba"><title>Samba</title><info><abstract>
  <para>
   Sambaを使用すると、Mac OS X、Windows、OS/2マシンに対するファイルサーバおよびプリントサーバをUnixマシン上に構築できます。Sambaは、今や成熟の域に達したかなり複雑な製品です。Sambaは、YaSTまたはSWAT (Webインタフェース)を使用するか、設定ファイルを手動で編集して設定します。
  </para>
 </abstract></info>
 <indexterm xml:id="idx-Samba" class="startofrange"> <primary>Samba</primary> </indexterm> <indexterm> <primary>SMB</primary> <see>Samba</see> </indexterm> <indexterm> <primary>Mac OS X</primary> <secondary>ファイル共有</secondary> </indexterm> <indexterm> <primary>Windows</primary> <secondary>ファイル共有</secondary> </indexterm> <indexterm> <primary>OS/2</primary> <secondary>ファイル共有</secondary> </indexterm> <indexterm> <primary>Linux</primary> <secondary>別のOSとのファイル共有</secondary> </indexterm>
 
 <section xml:id="sec-samba-term">
  <title>用語集</title>

  <para>
   ここでは、SambaのマニュアルやYaSTモジュールで使用される用語について説明します。
  </para>

  <variablelist>
   <varlistentry>
    <term>SMBプロトコル</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>SMB</secondary></indexterm><indexterm><primary>プロトコル</primary><secondary>SMB</secondary></indexterm><indexterm><primary>smbd</primary></indexterm>SambaはSMB(サーバメッセージブロック)プロトコルを使用します。SMBは<phrase role="productname">NetBIOS</phrase>サービスを基にしています。Microsoftがこのプロトコルをリリースしたので、他のソフトウェアメーカはMicrosoftドメインネットワークに接続できるようになりました。Sambaでは、SMBプロトコルがTCP/IPプロトコルの上で動作するので、すべてのクライアントにTCP/IPプロトコルをインストールする必要があります。<indexterm> <primary>Samba</primary> <secondary>TCP/IP</secondary> </indexterm>
     </para>
     <tip arch="zseries" os="sles">
      <title>IBM System z: NetBIOSのサポート</title>
      <para>
       IBM System zではSMB over TCP/IPのみがサポートされています。これら2つのシステムではNetBIOSをサポートしていません。
      </para>
     </tip>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CIFSプロトコル</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>CIFS</secondary></indexterm><indexterm><primary>プロトコル</primary><secondary>CIFS </secondary></indexterm>CIFS (common Internet file system)プロトコルは、Sambaがサポートしているプロトコルです。CIFSは、ネットワーク上で使用する標準のリモートファイルシステムで、ユーザグループによる共同作業およびネットワーク間でのドキュメントの共有ができるようにします。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS<indexterm> <primary>Samba</primary> <secondary>名前</secondary> </indexterm></term>
    <listitem>
     <para>
      <indexterm><primary>NetBIOS</primary></indexterm>NetBIOSは、マシン間通信用に設計された、ネームサービスを提供するソフトウェアインタフェース(API)です。これにより、ネットワークに接続されたマシンが、それ自体の名前を維持できます。予約を行えば、これらのマシンを名前によって指定できます。名前を確認する一元的なプロセスはありません。ネットワーク上のマシンでは、すでに使用済みの名前でない限り、名前をいくつでも予約できます。NetBIOSインタフェースは、異なるネットワークアーキテクチャに実装できるようになっています。ネットワークハードウェアと比較的密接に機能する実装は<phrase role="productname">NetBEUI</phrase>と呼ばれますが、これはよく<phrase role="productname">NetBIOS</phrase>とも呼ばれます。NetBIOSとともに実装されるネットワークプロトコルは、Novell IPX (TCP/IP経由の NetBIOS)とTCP/IPです。
     </para>
     <para>
      TCP/IP経由で送信されたNetBIOS名は、<filename>/etc/hosts</filename>で使用されている名前、またはDNSで定義された名前とまったく共通点がありません。NetBIOSは独自の、完全に独立した名前付け規則を使用しています。しかし、管理を容易にするために、DNSホスト名に対応する名前を使用するか、DNSをネイティブで使用することをお勧めします。これはSambaが使用するデフォルトでもあります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Sambaサーバ<indexterm> <primary>Samba</primary> <secondary>サーバ</secondary> </indexterm></term>
    <listitem>
     <para>
      Sambaサーバは、SMB/CIFSサービスおよびNetBIOS over IPネーミングサービスをクライアントに提供します。Linuxの場合、3種類のSambaサーバデーモン(SMB/CIFSサービス用smnd、ネーミングサービス用nmbd、認証用winbind)が用意されています。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Sambaクライアント<indexterm xml:id="idx-Samba-clients" class="startofrange"> <primary>Samba</primary> <secondary>クライアント</secondary> </indexterm></term>
    <listitem>
     <para>
      Sambaクライアントは、SMBプロトコルを介してSambaサーバからSambaサービスを使用するシステムです。Mac OS X、Windows、OS/2などの一般的なオペレーティングシステムは、すべてSMBプロトコルをサポートしています。TCP/IPプロトコルは、すべてのコンピュータにインストールする必要があります。Sambaは、異なるUNIXフレーバーに対してクライアントを提供します。Linuxでは、SMB用のカーネルモジュールがあり、LinuxシステムレベルでのSMBリソースの統合が可能です。Sambaクライアントに対していずれのデーモンも実行する必要はありません。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>共有</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>共有</secondary></indexterm>SMBサーバは、そのクライアントに対し、共有によってリソースを提供します。共有は、サーバ上のサブディレクトリのあるディレクトリおよびプリンタです。これは名前によってエクスポートされ、名前によってアクセスされます。共有名にはどのような名前も設定できます。エクスポートディレクトリの名前である必要はありません。プリンタにも名前が割り当てられます。クライアントはプリンタに名前でアクセスできます。<indexterm><primary>印刷</primary><secondary>Samba</secondary></indexterm><indexterm><primary>Samba</primary><secondary>プリンタ</secondary></indexterm><indexterm class="endofrange" startref="idx-Samba-clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>DC</secondary></indexterm>ドメインコントローラ(DC)はドメインのアカウントを処理するサーバです。データレプリケーションには、1つのドメインの中で追加のドメインコントローラが使用できます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 
 <section xml:id="sec-samba-serv-start" os="osuse;sles">
  <title>Sambaの起動および停止</title>

  <para>
   Sambaサーバは、自動(ブート中)か手動で起動または停止できます。ポリシーの開始および停止は、<xref linkend="sec-samba-yast2-conf"/>で説明しているように、YaST Sambaサーバ設定の一部です。
  </para>

  <para>
   YaSTを使用して実行中のSambaサービスを停止または起動するには、<menuchoice><guimenu>システム</guimenu><guimenu>システムサービス(ランレベル)</guimenu></menuchoice>の順に選択し、winbind、smb、nmbにチェックを付けます。コマンドラインで、「<command>rcsmb stop &amp;&amp; rcnmb stop</command>」を入力して、Sambaに必要なサービスを停止し、「<command>rcnmb start &amp;&amp; rcsmb start</command>」を入力して起動します。rcsmbは必要に応じてwinbindを処理します。
  </para><indexterm> <primary>Samba</primary> <secondary>起動</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>停止</secondary> </indexterm>
 </section>
 <section xml:id="sec-samba-serv-inst">
  <title>Sambaサーバの設定</title><indexterm> <primary>Samba</primary> <secondary>インストール</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>サーバ</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>設定</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>Samba</secondary> </indexterm>

  <para os="osuse;sles">
   <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>のSambaサーバは、YaSTを使って、または手動で設定することができます。手動で設定を行えば細かい点まで調整できますが、YaSTのGUIほど便利ではありません。
  </para>

  

  <section xml:id="sec-samba-yast2-conf" os="osuse;sles">
   <title>YaSTによるSambaサーバの設定</title>
   <para>
    Sambaサーバを設定するには、YaSTを起動して、<menuchoice><guimenu>ネットワークサービス</guimenu><guimenu>Sambaサーバ</guimenu></menuchoice>の順に選択します。
   </para>
   <section xml:id="sec-samba-yast2-conf-inst">
    <title>初期Samba設定</title>
    <para>
     このモジュールを初めて起動すると、<guimenu>Sambaインストール</guimenu>ダイアログが起動して、サーバ管理に関していくつかの基本的な事項を決定するように要求されます。設定の最後に、Samba管理者パスワードを要求されます(<guimenu>Sambaルートパスワード</guimenu>)。次回起動時には、<guimenu>Samba Configuration</guimenu>ダイアログが表示されます。
    </para>
    <para>
     <guimenu>Sambaインストール</guimenu>ダイアログは、次の2つのステップとオプションの詳細設定で構成されています。
    </para>
    <variablelist>
     <varlistentry>
      <term>ワークグループまたはドメイン名</term>
      <listitem>
       <para>
        <guimenu>Workgroup or Domain Name</guimenu>から既存の名前を選択するか、新しい名前を入力し、<guimenu>次へ</guimenu>を入力します。
       </para>

      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Sambaサーバのタイプ</term>
      <listitem>
       <para>
        次のステップでは、サーバをPDC(プライマリドメインコントローラ)として機能させるか、BDC(バックアップドメインコントローラとして機能させるか、またはドメインコントローラとしては機能させないかを指定します。デフォルトでは、サーバはドメインコントローラとして設定されていません。<guimenu>次へ</guimenu>で続行します。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     詳細なサーバ設定に進まない場合は、<guimenu>OK</guimenu>を選択して確認します。次に、最後のポップアップボックスで、<guimenu>Sambaルートパスワード</guimenu>を設定します。
    </para>
    <para>
     この設定はすべて、後から<guimenu>Sambaの設定</guimenu>ダイアログで<guimenu>起動</guimenu>、<guimenu>共有</guimenu>、<guimenu>識別情報</guimenu>、<guimenu>信頼されたドメイン</guimenu>、<guimenu>LDAP設定</guimenu>の各タブを使用して変更することができます。
    </para>
   </section>
   <section xml:id="sec-samba-yast2-conf-adv">
    <title>Sambaの詳細設定</title>
    <para>
     Sambaサーバモジュールの初回起動中、2つの初期化ステップ(<xref linkend="sec-samba-yast2-conf-inst"/>参照)の直後に<guimenu>Sambaの設定</guimenu>ダイアログが表示されます。ここでは、Sambaサーバの設定を編集することができます。
    </para>
    <para>
     設定を編集し終わったら、<guimenu>OK</guimenu>をクリックして設定を保存します。
    </para>
    <section>
     <title>サーバを起動する</title>
     <para>
      <guimenu>Start Up</guimenu>タブで、Sambaサーバの起動に関する設定を行います。システムのブート時に毎回サービスが起動されるようにするには、<guimenu>During Boot</guimenu>を選択します。手動起動を有効化するには、<guimenu>Manually</guimenu>を選択します。Sambaサーバの起動の詳細については、<xref linkend="sec-samba-serv-start"/>を参照してください。
     </para>
     <para>
      このタブで、ファイアウォールのポートを開くこともできます。そのためには、<guimenu>Open Port in Firewall</guimenu>を選択します。複数のネットワークインタフェースがある場合は、<guimenu>Firewall Details</guimenu>をクリックし、インタフェースを選択した後、<guimenu>OK</guimenu>をクリックして、Sambaサービス用のネットワークインタフェースを選択します。
     </para>

    </section>
    <section>
     <title>共有</title>
     <para>
      <guimenu>共有</guimenu>タブで、有効にするSambaの共有を指定します。homesおよびプリンタなど、事前定義済みの共有がいくつかあります。<guimenu>状態の変更</guimenu>を使用して、<guimenu>有効</guimenu>と<guimenu>無効</guimenu>の間で切り替えます。新規の共有を追加するには<guimenu>追加</guimenu>、共有を削除するには<guimenu>削除</guimenu>をクリックします。
     </para>

     <para>
      <guimenu>ユーザにディレクトリの共有を許可する</guimenu>を選択すると、<guimenu>許可するグループ</guimenu>中のグループメンバーに、各自のディレクトリを他のユーザと共有させることができます。たとえば、ローカルの範囲の<systemitem>users</systemitem>、あるいはドメインの範囲では<systemitem>DOMAIN\Users</systemitem>を設定します。また、ユーザにはファイルシステムへのアクセスを許可するパーミッションがあることを確認してください。<guimenu>最大共有数</guimenu>で、共有の最大数を制限することができます。認証なしでユーザ共用へのアクセスを許可するには、<guimenu>ゲストアクセスを許可</guimenu>を有効にします。

     </para>
    </section>
    <section>
     <title>ID</title>
     <para>
      <guimenu>識別情報</guimenu>タブで、ホストが関連付けられているドメイン(<guimenu>基本設定</guimenu>)と、ネットワークで代替ホスト名を使用するかどうか(<guimenu>NetBIOS Hostname</guimenu>)を指定します。名前解決にMicrosoft Windows Internet Name Service(WINS)を使用することもできます。この場合、<guimenu>Use WINS for Hostname Resolution</guimenu>を有効にし、DHCP経由でWINSサーバを取得(<guimenu>Retrieve WINS server via DHCP</guimenu>を使用)するかどうか決定します。<phrase os="sles">TDBデータベースではなくLDAPなど、</phrase>エキスパートグローバル設定またはユーザ認証ソースを設定するには、<guimenu>詳細設定</guimenu>をクリックします。

     </para>

    </section>
    <section>
     <title>信頼されたドメイン</title>
     <para>
      他のドメインのユーザを、自分のドメインにアクセスさせるには、<guimenu>Trusted Domains</guimenu>タブで適切な設定を行います。新しいドメインを追加するには、<guimenu>追加</guimenu>をクリックします。選択したドメインを削除するには、<guimenu>削除</guimenu>をクリックします。
     </para>
    </section>
    <section>
     <title>LDAP設定</title>
     <para>
      <guimenu>LDAP Settings</guimenu>タブでは、認証に使用するLDAPサーバを設定することができます。LDAPサーバへの接続をテストするには、<guimenu>Test Connection</guimenu>をクリックします。エキスパートLDAP設定を設定するか、デフォルト値を使用する場合、<guimenu>詳細な設定</guimenu>をクリックします。
     </para>
     <para>
      LDAP設定に関する詳細については、<xref linkend="cha-security-ldap"/>を参照してください。
     </para>
    </section>
   </section>
  </section>

  <section xml:id="sec-samba-serv-inst-swat" os="osuse;sles">
   <title>SWATを使用したWeb管理</title>
   <para>
    <indexterm> <primary>Samba</primary> <secondary>swat</secondary> </indexterm> <indexterm> <primary>環境設定ファイル</primary> <secondary>samba</secondary> </indexterm> <indexterm> <primary>環境設定ファイル</primary> <secondary>サービス</secondary> </indexterm> Sambaサーバ管理の代替ツールは、SWAT(Samba Web管理ツール)です。このプログラムには、Sambaサーバを設定するための簡単なWebインタフェースがあります。SWATを使用するには、Webブラウザで、<link xlink:href="http://localhost:901"/>を開き、<systemitem class="username">root</systemitem>ユーザでログインします。特別なSamba rootアカウントがない場合、システムの<systemitem class="username">root</systemitem>アカウントを使用します。
   </para>
   <note>
    <title>SWATの有効化</title>
    <para>
     Sambaサーバのインストール後、SWATは有効化されていません。SWATを有効化するには、YaSTで<menuchoice><guimenu>ネットワークサービス</guimenu><guimenu>ネットワークサービス(xinetd)</guimenu></menuchoice>の順に開き、ネットワークサービス設定を有効にし、テーブルから<guimenu>swat</guimenu>を選択し、<guimenu>状態の変更(オンまたはオフ)</guimenu>をクリックします。
    </para>
   </note>
  </section>

  <section xml:id="sec-samba-serv-inst-manual" os="osuse;sles">
   <title>サーバの手動設定</title>
   <para>
    <indexterm> <primary>Samba</primary> <secondary>設定</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>Samba</secondary> </indexterm> <indexterm> <primary>環境設定ファイル</primary> <secondary>smb.conf</secondary> </indexterm> Sambaをサーバとして使用する場合は、<systemitem class="resource">samba</systemitem>をインストールします。Sambaの主要設定ファイルは、 <filename>/etc/samba/smb.conf </filename>です。このファイルは2つの論理部分に分けられます。<literal>[global]</literal>セクションには、中心的なグローバル設定が含まれます。<literal>[share]</literal>セクションには、個別のファイルとプリンタ共有が入っています。このアプローチにより、共有に関する詳細は<literal>[global]</literal>セクションで個別に、またはグローバルに設定することができ、設定ファイルの構造的透過性が高まっています。
   </para>
   <section xml:id="sec-samba-smb-conf-Erlaeuterung">
    <title>グローバルセクション</title>
    <para>
     <literal>[global]</literal>の次のパラメータは、ネットワークの設定に応じた必要条件を満たし、Windows環境で他のマシンがSMBを経由してこのSambaサーバにアクセスできるようにするために多少の調整が必要です。
    </para>
    
    <variablelist>
     <varlistentry>
      <term><literal>workgroup = TUX-NET</literal>
      </term>
      <listitem>
       <para>
        この行は、Sambaサーバをワークグループに割り当てます。<literal>TUX-NET</literal>を実際のネットワーク環境にある適切なワークグループに置き換えてください。DNS名がネットワーク内の他のマシンに割り当てられていなければ、SambaサーバがDNS名の下に表示されます。DNS名が使用できない場合は、<literal>netbiosname=<replaceable>MYNAME</replaceable></literal>を使用してサーバ名を設定します。このパラメータに関する詳細については、<systemitem>smb.conf</systemitem>のマニュアルページを参照してください。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>os level = 20</literal>
      </term>
      <listitem>
       <para>
        このパラメータは、SambaサーバがワークグループのLMB(ローカルマスタブラウザ)になるかどうかのきっかけとなります。Samba 3リリースシリーズでは、デフォルト設定(<literal>20</literal>)を上書きする必要はほとんどなくなりました。Sambaサーバの設定が誤っていた場合に、既存のWindowsネットワークに支障が出ないよう、小さな値(たとえば<literal>2</literal>)を選択します。この重要なトピックの詳細については、『Samba 3 Howto』のネット「ワークブラウジング」の章を参照してください。『Samba 3 Howto』の詳細については、<xref linkend="sec-samba-info"/>を参照してください。
       </para>
       <para>
        ネットワーク内に他のSMBサーバ(たとえば、Windows 2000サーバ)が存在せず、ローカル環境に存在するすべてのシステムのリストをSambaサーバに保存する場合は、<literal>os level</literal>の値を大きくします(たとえば、<literal>65</literal>)。これでSambaサーバが、ローカルネットワークのLMBとして選択されました。
       </para>
       <para>
        この設定を変更するときは、それが既存のWindowsネットワーク環境にどう影響するかを慎重に検討する必要があります。はじめに、隔離されたネットワークで、または影響の少ない時間帯に、変更をテストしてください。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal/>wins supportとwins server<literal/>
      </term>
      <listitem>
       <para>
        アクティブなWINSサーバをもつ既存のWindowsネットワークにSambaサーバを参加させる場合は、<option>wins server</option>オプションを有効にし、その値をWINSサーバのIPアドレスに設定します。
       </para>
       <para>
        各Windowsマシンの接続先サブネットが異なり、互いを認識させなければならない場合は、WINSサーバをセットアップする必要があります。SambaサーバをWINSサーバなどにするには、<literal>wins support = Yes</literal>オプションを設定します。ネットワーク内でこの設定が有効なSambaサーバは1台だけであることを確認します。<filename>smb.conf</filename>ファイル内で、オプション<literal>wins server</literal>と<literal>wins support</literal>は同時に有効にしないでください。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="sec-samba-smb-conf-shares">
    <title>共有</title><indexterm> <primary>Samba</primary> <secondary>シェア</secondary> </indexterm>
    <para>
     次の例では、SMBクライアントがCD-ROMドライブとユーザディレクトリ(<literal>homes</literal>)を利用できるようにする方法を示します。
    </para>
    <variablelist>
     <varlistentry>
      <term>[cdrom]</term>
      <listitem>
       <para>
        CD-ROMドライブが誤って利用可能になるのを避けるため、これらの行はコメントマーク(この場合はセミコロン)で無効にします。最初の列のセミコロンを削除し、CD-ROMドライブをSambaと共有します。
       </para>
       <example xml:id="dat-cd-rom">
        <title>CD-ROMの共有(無効)</title>
<screen>;[cdrom]
;       comment = Linux CD-ROM
;       path = /media/cdrom
;       locking = No</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term><option>[cdrom]</option>および<option>コメント</option>
         </term>
         <listitem>
          <para>
           <literal>[cdrom]</literal>セクションエントリは、ネットワーク上のすべてのSMBクライアントが認識できる共有の名前です。さらに<literal>comment</literal>を追加して、共有を説明することができます。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>path = /media/cdrom</option>
         </term>
         <listitem>
          <para>
           <option>path</option>オプションで、<filename>/media/cdrom</filename>ディレクトリをエクスポートします。
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
       <para>
        デフォルトを非常に制約的に設定することによって、このシステム上に存在するユーザのみがこの種の共有を利用できるようになります。この共有をあらゆるユーザに開放する場合は、設定に<literal>guest ok = yes</literal>という行を追加します。この設定は、ネットワーク上の全ユーザに読み込み許可を与えます。このパラメータを使用する場合には、相当な注意を払うことをお勧めします。またこのパラメータを<literal>[global]</literal>セクションで使用する場合には、さらに注意が必要です。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><option>[homes]</option>
      </term>
      <listitem>
       <para>
        <option>[homes]</option>共有は、ここでは特に重要です。ユーザがLinuxファイルサーバの有効なアカウントとパスワードを持ち、独自のホームディレクトリを持っていればそれに接続することができます。
       </para>
       <example xml:id="dat-homes-frei">
        <title>[homes]共有</title>
<screen>[homes]
	comment = Home Directories
	valid users = %S
	browseable = No
	read only = No
	create mask = 0640
	directory mask = 0750</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term>[homes]</term>
         <listitem>
          <para>
           SMBサーバに接続しているユーザの共有名を他の共有が使用していない限り、<literal>[homes]</literal>共有ディレクティブを使用して共有が動的に生成されます。生成される共有の名前は、ユーザ名になります。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>valid users = %S</option>
         </term>
         <listitem>
          <para>
           <literal>%S</literal> は、接続が正常に確立されるとすぐに、具体的な共有名に置き換えられます。[homes]<option>共有の場合、これは常にユーザ名です。</option>したがって、ユーザの共有に対するアクセス権は、そのユーザだけに付与されます。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>browseable = No</option>
         </term>
         <listitem>
          <para>
           この設定を行うと、共有がネットワーク環境で認識されなくなります。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>read only = No</option>
         </term>
         <listitem>
          <para>
           デフォルトでは、Sambaは<literal>read only = Yes</literal>パラメータによって、エクスポートされた共有への書き込みアクセスを禁止します。共有に書き込めるように設定するには、<literal>read only = No</literal>値を設定します。これは<literal>writable = Yes</literal>と同値です。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>create mask = 0640</option>
         </term>
         <listitem>
          <para>
           MS Windows NTベース以外のシステムは、UNIXのパーミッションの概念を理解しないので、ファイルの作成時にアクセス権を割り当てることができません。<literal>create mask</literal>パラメータは、新しく作成されたファイルに割り当てられるアクセス権を定義します。これは書き込み可能な共有にのみ適用されます。実際、この設定はオーナーが読み書き権を持ち、オーナーの一次グループのメンバが読み込み権を持つことを意味します。<option>valid users = %S</option>を設定すると、グループに読み込み権が与えられても、読み込みアクセスができなくなります。グループに読み書き権を付与する場合は、<option>valid users = %S</option>という行を無効にしてください。
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="sec-samba-rechte">
    <title>セキュリティレベル</title><indexterm xml:id="idx-Samba-security" class="startofrange"> <primary>Samba</primary> <secondary>セキュリティ</secondary> </indexterm> <indexterm> <primary>セキュリティ</primary> <secondary>Samba</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>パーミッション</secondary> </indexterm>
    <para>
     セキュリティを向上させるため、各共有へのアクセスは、パスワードによって保護されています。SMBでは、次の方法で権限を確認できます。
    </para>
    <variablelist>
     <varlistentry>
      <term>共有レベルのセキュリティ(<literal>セキュリティ=共有</literal>)</term>
      <listitem>
       <para>
        パスワードが共有に対し確実に割り当てられています。このパスワードを持っているユーザ全員が、その共有にアクセスできます。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ユーザレベルのセキュリティ(<literal>セキュリティ=ユーザ</literal>)</term>
      <listitem>
       <para>
        このセキュリティレベルは、ユーザという概念をSMBに取り入れています。各ユーザは、サーバにパスワードを登録する必要があります。登録後、エクスポートされた個々の共有へのアクセスは、ユーザ名に応じてサーバが許可します。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>サーバレベルのセキュリティ(<literal>セキュリティ=サーバ</literal>)</term>
      <listitem>
       <para>
        クライアントに対しては、Sambaがユーザレベルモードで動作しているように見えます。しかし、Sambaはすべてのパスワードクエリを別のユーザレベルモードサーバに渡し、ユーザレベルモードサーバが認証されます。この設定では、追加の<option>password server</option>パラメータが必要になります。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ADSレベルのセキュリティ(<literal>セキュリティ=ADS</literal>)</term>
      <listitem>
       <para>
        このモードでは、Sambaはアクティブディレクトリ環境のドメインメンバーとして動作します。このモードで操作するには、Sambaを実行しているコンピュータにKerberosがインストールされ設定済みであることが必要です。Sambaを使用してコンピュータをADSレルムに結合させる必要があります。これは、YaSTの<guimenu>Windowsドメインメンバーシップ</guimenu>モジュールを使用して行います。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ドメインレベルのセキュリティ(<literal>セキュリティ=ドメイン</literal>)</term>
      <listitem>
       <para>
        このモードは、マシンがWindows NTドメインに参加している場合にのみ正しく動作します。Sambaはユーザ名とパスワードをWindows NT PrimaryまたはBackup Domain Controllerに渡すことによって、これらを検証しようとします。Windows NT Serverが行うのと同じ方法です。暗号化されたパスワードパラメータが<literal>yes</literal>に設定されている必要があります。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     共有、ユーザ、サーバ、またはドメインレベルのセキュリティの設定は、サーバ全体に適用されます。個別の共有ごとに、ある共有には共有レベルのセキュリティ、別の共有にはユーザレベルセキュリティを設定するといったことはできません。しかし、システム上に設定したIPアドレスごとに、別のSambaサーバを実行することは可能です。
    </para>
    <para>
     この詳細については、『Samba 3 HOWTO』を参照してください。つのシステムに複数のサーバをセットアップする場合は、オプション<option>interfaces</option>および<option>bind interfaces only</option>に注意してください。
    </para><indexterm class="endofrange" startref="idx-Samba-security"/>
   </section>
  </section>
 </section>
 <section xml:id="sec-samba-client-inst">
  <title>クライアントの設定</title><indexterm> <primary>Samba</primary> <secondary>クライアント</secondary> </indexterm>

  <para>
   クライアントは、TCP/IP経由でのみSambaサーバにアクセスできます。IPX経由のNetBEUIおよびNetBIOSは、Sambaで使用できません。
  </para>

  <section xml:id="sec-samba-client-inst-yast">
   <title>YaSTによるSambaクライアントの設定</title><indexterm> <primary>YaST</primary> <secondary>Samba</secondary> <tertiary>クライアント</tertiary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>クライアント</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>Samba</secondary> <tertiary>クライアント</tertiary> </indexterm>
   <para>
    SambaクライアントをSambaサーバまたはWindowsサーバ上のリソース(ファイルまたはプリンタ)にアクセスするように設定します。NTまたはActive Directoryのドメインまたはワークグループを、<menuchoice> <guimenu>ネットワークサービス</guimenu><guimenu>Windowsドメインメンバーシップ</guimenu></menuchoice>の順に選択して表示したダイアログに入力します。<guimenu>Linuxの認証にもSMBの情報を使用する</guimenu>を有効にした場合、ユーザ認証は、Samba、NT、またはKerberosのサーバ上で実行されます。
   </para>

   <para>
    <guimenu>エキスパート設定</guimenu>をクリックして、高度な設定オプションを設定します。たとえば、認証による自動的なサーバホームディレクトリのマウントを有効化するには、<guimenu>サーバディレクトリのマウント</guimenu>のテーブルを使用します。これにより、CIFS上でホストされると、ホームディレクトリにアクセスできるようになります。詳細については、 <systemitem>pam_mount</systemitem>のマニュアルページを参照してください。
   </para>
   <para>
    すべての設定を完了したら、ダイアログを確認して設定を終了します。
   </para>
  </section>
 </section>
 <section xml:id="sec-samba-anmeld-serv">
  <title>ログインサーバとしてのSamba</title><indexterm> <primary>Samba</primary> <secondary>ログイン</secondary> </indexterm>

  <para>
   Windowsクライアントが大部分を占めるネットワークでは、ユーザが有効なアカウントとパスワードを持つ場合のみ登録できることが求められるのが普通です。Windowsベースのネットワークでは、このタスクはPDC (プライマリドメインコントローラ)によって処理されます。Windows NTサーバをPDCとして使用することもできますが、Sambaサーバを使用しても処理できます。<xref linkend="dat-samba-smb-conf-dom"/>に示すように、<filename>smb.conf</filename>の<literal>[global]</literal>セクションにエントリを追加する必要があります。
  </para>

  <example xml:id="dat-samba-smb-conf-dom">
   <title>smb.confファイルのグローバルセクション</title>
<screen>[global]
    workgroup = TUX-NET
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   暗号化されたパスワードが検証目的で使用される場合、Sambaサーバはこれを処理できるはずです。これには、<literal>[global]</literal>セクションでエントリ<literal>encrypt passwords = yes</literal>を指定します(Sambaバージョン 3ではデフォルト)。また、ユーザアカウントとパスワードをWindowsに準拠した暗号化形式で作成する必要があります。そのためにはコマンド<command>smbpasswd</command> <option>-a name</option>を実行します。さらに次のコマンドを使用して、Windows ドメイン概念で必要になるコンピュータのドメインアカウントを作成します。
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm> <primary>コマンド</primary><secondary>smbpasswd</secondary> </indexterm>

  <para>
   <command>useradd</command>コマンドを使用すると、ドル記号が追加されます。コマンド<command>smbpasswd</command>を指定すると、パラメータ<option>-m</option>を使用したときにドル記号が自動的に挿入されます。コメント付きの設定例(<filename>/usr/share/doc/packages/Samba/examples/smb.conf.SuSE</filename>)には、この作業を自動化するための設定が含まれています。
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   Sambaがこのスクリプトを正常に実行できるようにするため、必要な管理者権限を持つSambaユーザを選択して、<systemitem class="groupname">ntadmin</systemitem>グループに追加します。これにより、このLinuxグループに属するすべてのユーザに対し、次のコマンドによって<literal>Domain Admin</literal>ステータスを割り当てることができます。
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>

  <para>
   このトピックの詳細については、<filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>にある『Samba 3 HOWTO』の第12章を参照してください。
  </para>
 </section>
 <section xml:id="sec-samba-adnet" os="sles">
  <title>Active Directoryネットワーク内のSambaサーバ</title>

  <para>
   LinuxサーバとWindowsサーバの両方を利用する場合、2つの独立した認証システムまたはネットワークを作成するか、または単一の中央認証システムを持つ単一のネットワークに両方のサーバを接続します。SambaはActive Directoryドメインと連携できるため、お使いのSUSE Linux Enterprise ServerをActive Directory (AD)に参加させることができます。
  </para>

  <para>
   既存のActive Directoryドメインに参加するには、インストール時に設定を行うか、または後でYaSTを使って、SMBユーザ認証を有効にします。インストール時のドメイン結合については、を参照してください。<phrase os="sles"><xref linkend="sec-i-yast2-conf-manual-user-auth"/></phrase>
  </para>

  <para>
   稼働中のシステムをActive Directoryドメインに参加させるには、以下の手順に従ってください。
  </para>

  <procedure>
   <step>
    <para>
     <systemitem class="username">root</systemitem>としてログインし、YaSTを起動します。
    </para>
   </step>
   <step>
    <para>
     <menuchoice><guimenu>ネットワークサービス</guimenu><guimenu>Windowsドメインメンバーシップ</guimenu></menuchoice>の順に選択します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>Windows Domain Membership</guimenu>画面の<guimenu>Domain or Workgroup</guimenu>に、参加するドメインを入力します。
    </para>
    <figure>
     <title>Windowsドメインメンバーシップの決定</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     SUSE Linux Enterprise ServerでLinux認証にSMBソースを使用する場合は、<guimenu>Linuxの認証にもSMBの情報を用いる</guimenu>を選択します。
    </para>
   </step>
   <step>
    <para>
     ドメインへの参加を確認するメッセージが表示されたら、<guimenu>OK</guimenu>をクリックします。
    </para>
   </step>
   <step>
    <para>
     Active DirectoryサーバのWindows管理者用パスワードを入力し、<guimenu>OK</guimenu>をクリックします。
    </para>
    <para>
     Active Directoryドメインコントローラから、すべての認証データを取得できるようになりました。
    </para>
   </step>
  </procedure>
  <tip>
  <para>
複数のSambaサーバが存在する環境では、UIDとGIDが常に作成されるわけではありません。ユーザに割り当てられるUIDは、最初のログイン順になるため、サーバ間でUIDの競合が生じます。この問題を解決するには、idnetityマッピングを利用する必要があります。詳細については、<link xlink:href="https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/idmapper.html"/>を参照してください。
  </para>
  </tip>
 </section>
 <section xml:id="sec-samba-info">
  <title>詳細情報</title>

  <para>
   Sambaについての詳細な情報は、デジタルドキュメントの形で入手できます。コマンドラインから「<command>apropos</command><option>samba</option>」と入力するとマニュアルページを参照できます。または、Sambaマニュアルがインストールされている場合は、<filename>/usr/share/doc/packages/samba</filename>ディレクトリに格納されているオンラインマニュアルと例を参照できます。また、コメント付きの設定例(<filename>smb.conf.SUSE</filename>)が<filename>examples</filename>サブディレクトリに用意されています。<indexterm> <primary>環境設定ファイル</primary> <secondary>smb.conf</secondary> </indexterm>
  </para>

  <para>
   Sambaチームが作成した『Samba-3 HOWTO』にはトラブルシューティングについても説明されています。またマニュアルのPart Vでは、手順を追って設定を確認するためのガイドが用意されています。<systemitem>samba-doc</systemitem>パッケージのインストール後、<filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>で、『Samba-3 HOWTO』を参照できます。
  </para>

  <indexterm class="endofrange" startref="idx-Samba"/>
 </section>
</chapter>
