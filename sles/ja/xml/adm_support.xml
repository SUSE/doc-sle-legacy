<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="adm_support.xml" id="cha-adm-support">
 <title>サポート用システム情報の収集</title>
<indexterm> <primary>サポート</primary> </indexterm> <indexterm> <primary>システム情報</primary> </indexterm>
 <abstract>
  
  <para>
   問題がある場合は、<command>supportconfig</command>コマンドラインツールまたはYaST<guimenu>サポート</guimenu>モジュールで詳細なシステムレポートを作成できます。動作するように設計されています。どちらも、現在のカーネルのバージョン、ハードウェア、インストールされているパッケージ、パーティション設定などのシステム情報を収集します。結果は、複数のファイルのTARアーカイブになります。サービス要求(SR)を開いた後、そのTARアーカイブをグローバルテクニカルサポートにアップロードできます。これは、レポートされた問題を特定したり、問題解決を支援したりするのに役立ちます。
  </para>
  <para>このコマンドラインツールは、デフォルトでインストールされるパッケージ<systemitem>supportutils</systemitem>によって提供されます。YaST<guimenu>サポート</guimenu>モジュールは、このコマンドラインツールが基になっています。
  </para>
 </abstract>
 
  <sect1 id="sec-admsupport-supportconfig">
  <title>Supportconfigによるシステム情報の収集</title>

  <para>
   グローバルテクニカルサポートに提出できる詳細なシステム情報のTARアーカイブを作成するには、<command>supportconfig</command>コマンドラインツールまたはYaST<guimenu>サポート</guimenu>モジュールを使用します。このコマンドラインツールは、デフォルトでインストールされるパッケージ<systemitem>supportutils</systemitem>によって提供されます。YaST<guimenu>サポート</guimenu>モジュールも、このコマンドラインツールが基になっています。
  </para>

  <sect2 id="sec-admsupport-supportconfig-sr">
   <title>サービス要求番号の作成</title>
   <para>
    Supportconfigアーカイブはいつでも生成できます。ただし、supportconfigデータをグローバルテクニカルサポートに提出するには、まずサービス要求番号を生成する必要があります。サービス要求番号はアーカイブをサポートにアップロードするために必要です。
   </para>
   <para>
    サービス要求を作成するには、<ulink url="http://www.novell.com/center/eservice"/>にアクセスして、画面の指示に従います。11桁のサービス要求番号を記録します。
   </para>
   <note>
    <title>プライバシーポリシー</title>
    <para>
     SUSEおよびNovellは、システムレポートを機密データとして扱います。プライバシーに関する取り組みの詳細については、<ulink url="http://www.novell.com/company/legal/privacy/"/>を参照してください。
    </para>
   </note>
  </sect2>

  <sect2 id="sec-admsupport-supportconfig-upload">
   <title>アップロード先</title>
   <para>
    サービス要求番号を作成したら、supportconfigアーカイブをグローバルテクニカルサポートにアップロードできます。<xref linkend="pro-admsupport-submit-yast"/>または<xref linkend="pro-admsupport-submit-cli"/>を参照してください。次のいずれかのアップロードターゲットを使用します。
   </para>


   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      米国内のお客様: <ulink url="ftp://ftp.novell.com/incoming"/>
     </para>
    </listitem>
    <listitem>
     <para>
      EMEA (ヨーロッパ、中東、およびアフリカ): <ulink url="ftp://support-ftp.suse.com/in"/>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    または、サービス要求URL<ulink url="http://www.novell.com/center/eservice"/>を使用してTARアーカイブを手動でサービス要求に添付することもできます。
   </para>
  </sect2>

  <sect2 id="sec-admsupport-yast">
   <title>YaSTでのSupportconfigアーカイブの作成</title>
   <para>
    YaSTでシステム情報を収集するには、次の手順に従います。
    
   </para>
   <procedure>
    <step performance="required">
     <para>
      YaSTを起動して、<guimenu>サポート</guimenu>モジュールを開きます。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2-support-main.png" width="70%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2-support-main.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step performance="required">
     <para>
      <guimenu>Create report tarball (レポートtarballを作成)</guimenu>をクリックします。
     </para>
    </step>
    <step performance="required">
     <para>
      次のウィンドウで、ラジオボタンリストからsupportconfigオプションを1つ選択します。デフォルトでは、<guimenu>Use Custom (Expert) Settings (カスタム(エキスパート)設定を使用します)</guimenu>が事前選択されています。最初にレポート機能をテストしたい場合は、<guimenu>Only gather a minimum amount of info (最小限度の情報のみを収集する)</guimenu>を使用します。その他のオプションに関する背景情報については、<command>supportconfig</command>のマニュアルページを参照してください。
     </para>
     <para>
      <guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step id="step-supportconfig-contact" performance="required">
     <para>
      連絡先情報を入力します。情報は<filename>basic-environment.txt</filename>という名前のファイルに書き込まれ、作成するアーカイブに組み込まれます。
     </para>
    </step>
    <step id="step-supportconfig-upload-target" performance="required">
     <para>
      情報収集プロセスの終了時にアーカイブをグローバルテクニカルサポートに送信する場合、<guimenu>Upload Information (情報のアップロード)</guimenu>に入力する必要があります。YaSTによって自動的にアップロードサーバが提案されます。サーバを変更する場合、利用可能なアップロードサーバの詳細については、<xref linkend="sec-admsupport-supportconfig-upload"/>を参照してください。
     </para>
     <para>
      アーカイブを後で送信する場合、<guimenu>Upload Information (情報のアップロード)</guimenu>は空白のままで構いません。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step performance="required">
     <para>
      情報の収集が開始します。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2-support-conf.png" width="90%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2-support-conf.png" width="80%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <para>
      プロセスが完了したら、<guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step performance="required">
     <para>
      データ収集を確認します。ログファイルのファイル名を<guimenu>File Name (ファイル名)</guimenu>で選択して、YaSTで内容を表示します。サポートへの送信前にTARアーカイブから除外したいファイルを削除するには、<guimenu>Remove from Data (データから削除)</guimenu>を使用します。<guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step performance="required">
     <para>
      TARアーカイブを保存します。YaSTモジュールを<systemitem class="username">root</systemitem>ユーザとして起動した場合、デフォルトではアーカイブを<filename>/var/log</filename>に保存するよう提案されます(そうでない場合はホームディレクトリ)。ファイル名の形式は、<filename>nts_<replaceable>HOST</replaceable>_<replaceable>DATE</replaceable>_<replaceable>TIME</replaceable>.tbz</filename>です。
     </para>
    </step>
    <step performance="required">
     <para>
      アーカイブをサポートに直接アップロードする場合は、<guimenu>Upload log files tarball to URL (ログファイルtarballをURLへアップロード)</guimenu>が有効になっていることを確認してください。ここに表示される<guimenu>Upload Target (アップロードターゲット)</guimenu>は、<xref linkend="step-supportconfig-upload-target"/>でYaSTによって提案されたものです。アップロードターゲットを変更する場合は、<xref linkend="sec-admsupport-supportconfig-upload"/>で、利用可能なアップロードサーバの詳細情報を参照します。
     </para>
    </step>
    <step performance="required">
     <para>
      アップロードをスキップする場合は、<guimenu>Upload log files tarball to URL (ログファイルtarballをURLへアップロード)</guimenu>を無効にします。
     </para>
    </step>
    <step performance="required">
     <para>
      変更内容を確認し、YaSTモジュールを閉じます。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec-admsupport-cli">
   <title>コマンドラインからのsupportconfigアーカイブの作成</title>
   <para>
    次の手順は、supportconfigアーカイブをサポートに直接送信せずにアーカイブを作成する方法を示しています。アーカイブをアップロードするには、特定のオプションを指定してコマンドを実行する必要があります。<xref linkend="pro-admsupport-submit-cli"/>を参照してください。
   </para>
   <procedure>
    <step performance="required">
     <para>
      シェルを開き<systemitem class="username">root</systemitem>になります。
     </para>
    </step>
    <step performance="required">
     <para>
      オプションなしで<command>supportconfig</command>を実行します。デフォルトのシステム情報が収集されます。
     </para>
    </step>
    <step performance="required">
     <para>
      ツールが操作を完了するまで待機します。
     </para>
    </step>
    <step performance="required">
     <para>
      デフォルトのアーカイブ場所は<filename>/var/log</filename>で、ファイル名の形式は<filename>nts_<replaceable>HOST</replaceable>_<replaceable>DATE</replaceable>_<replaceable>TIME</replaceable>.tbz</filename>です。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec-admsupport-options">
   <title>Supportconfigの一般的なオプション</title>
   <para>
    <command>supportconfig</command>ユーティリティは、通常、オプションなしで呼び出されます。<command>supportconfig</command> <option>-h</option>で、すべてのオプションを一覧表示するか、マニュアルページを参照してください。よくある使用事例については、次のリストで簡単に説明します。
   </para>
   <variablelist>
    <varlistentry>
     <term>収集する情報のサイズを削減する</term>
     <listitem>
      <para>
       最小オプション(<option>-m</option>)を使用します。
      </para>
<screen>supportconfig -m</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>情報を特定のトピックに限定する</term>
     <listitem>
      <para>
       すでにデフォルトの<command>supportconfig</command>出力で問題を特定し、その問題が特定の領域または機能セットにのみ関係することが判明している場合は、<command>supportconfig</command>の次回実行時に収集する情報を特定の領域に限定できます。たとえば、LVMに問題があることを検出した場合に、最近変更したLVMの設定をテストしたいときは、LVMに関連する最小限のsupportconfig情報のみを収集するのが適切です。
      </para>
<screen>supportconfig -i LVM</screen>
      <para>
       収集する情報を特定の領域に限定する場合に使用できる機能のキーワードを網羅したリストについては、次のコマンドを実行します。
      </para>
<screen>supportconfig -F</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>追加の連絡先情報を出力に含める</term>
     <listitem>
<screen>supportconfig -E tux@example.org -N "Tux Penguin" -O "Penguin Inc." ...</screen>
      <para>
       (すべてを1行に記述)
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ローテーション済みログファイルの収集</term>
     <listitem>
<screen>supportconfig -l</screen>
      <para>
       これは、大規模なログを行う環境や、再起動後のsyslogによるログファイルのローテーション時にカーネルクラッシュが発生した場合に特に有効です。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 id="sec-admsupport-submit">
  <title>グローバルテクニカルサポートへの情報の送信</title>

  <para>
   システム情報をグローバルテクニカルサポートへ送信するには、YaST<guimenu>サポート</guimenu>モジュールまたは<command>supportconfig</command>コマンドラインユーティリティを使用します。サーバに問題がありサポートの支援が必要な場合、まずサービス要求を開く必要があります。詳細については、<xref linkend="sec-admsupport-supportconfig-sr"/>を参照してください。
  </para>

  <para>
   次の例では、実際のサービス要求番号のプレースホルダとして<replaceable>12345678901</replaceable>を使用しています。<replaceable>12345678901</replaceable>は、<xref linkend="sec-admsupport-supportconfig-sr"/>で作成したサービス要求番号に置き換えてください。
  </para>

  <procedure id="pro-admsupport-submit-yast">
   <title>YaSTを使用したサポートへの情報の送信</title>
   <para>
    次の手順は、supportconfigアーカイブを作成済みであるものの、まだアップロードしていないことを想定しています。<xref linkend="sec-admsupport-yast"/>の<xref linkend="step-supportconfig-contact" xrefstyle="select:label nopage"/>で説明されているように、アーカイブに連絡先情報が含まれていることを確認してください。supportconfigアーカイブの生成と送信を一度に行う方法については、<xref linkend="sec-admsupport-yast"/>を参照してください。
   </para>
   <step performance="required">
    <para>
     YaSTを起動して、<guimenu>サポート</guimenu>モジュールを開きます。
    </para>
   </step>
   <step performance="required">
    <para>
     <guimenu>アップロード</guimenu>をクリックします。
    </para>
   </step>
   <step performance="required">
    <para>
     既存のsupportconfigアーカイブのパスを<guimenu>Package with log files (ログファイルのあるパッケージ)</guimenu>に指定するか、<guimenu>参照</guimenu>をクリックしてアーカイブを参照します。
    </para>
   </step>
   <step id="step-supportcfg-submit-upltarget" performance="required">
    <para>
     YaSTによって自動的にアップロードサーバが提案されます。サーバを変更する場合、利用可能なアップロードサーバの詳細については、<xref linkend="sec-admsupport-supportconfig-upload"/>を参照してください。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2-support-conf-upload.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2-support-conf-upload.png" width="60%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     
     <guimenu>次へ</guimenu>で続行します。
    </para>
   </step>
   <step performance="required">
    <para>
     <guimenu>完了</guimenu>をクリックします。
    </para>
   </step>
  </procedure>

  <procedure id="pro-admsupport-submit-cli">
   <title>コマンドラインからのサポートへの情報の送信</title>
   <para>
    次の手順は、supportconfigアーカイブを作成済みであるものの、まだアップロードしていないことを想定しています。supportconfigアーカイブの生成と送信を一度に行う方法については、<xref linkend="sec-admsupport-yast"/>を参照してください。
   </para>
   <step performance="required">
    <para>
     インターネット接続のあるサーバの場合
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       デフォルトのアップロードターゲットを使用するには、次を実行します。
      </para>
<screen>supportconfig -ur <replaceable>12345678901</replaceable></screen>
     </step>
     <step performance="required">
      <para>
       安全なアップロードターゲットには、次を使用します。
      </para>

<screen>supportconfig -ar <replaceable>12345678901</replaceable></screen>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     インターネット接続の<emphasis>ない</emphasis>サーバの場合
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       次を実行します。
      </para>
<screen>supportconfig -r <replaceable>12345678901</replaceable></screen>
     </step>
     <step performance="required">
      <para>
       <filename>/var/log/nts_SR12345678901</filename><replaceable>*tbz</replaceable>アーカイブをいずれかのFTPサーバに手動でアップロードします。使用するサーバは世界のどの地域にいるかに応じて異なります。概要については、<xref linkend="sec-admsupport-supportconfig-upload"/>を参照してください。
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     FTPサーバの着信ディレクトリにTARアーカイブが届くと、お客様のサービス要求に自動的に添付されます。
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 id="sec-admsupport-kernel">
  <title>カーネルモジュールのサポート</title>
  
  <para>
   あらゆるエンタープライズ向けオペレーティングシステムにとって重要な要件は、利用環境に対して受けられるサポートのレベルです。カーネルモジュールは、ハードウェア(<quote>コントローラ</quote>)とオペレーティングシステムを結ぶものの中で最も重要です。SUSE Linux Enterpriseのカーネルモジュールにはすべて<literal>supported</literal>フラグが付いており、これは次の3つの値を取ります。
  </para>
  
  <itemizedlist mark="bullet" spacing="normal">
   
   <listitem>
    <para>
     <quote>yes</quote>、したがって、<literal>supported</literal>
    </para>
   </listitem>
   <listitem>
    <para>
     <quote>external</quote>、したがって<literal>supported</literal>
    </para>
   </listitem>
   <listitem>
    <para>
     <quote/> (空、未設定)、したがって<literal>unsupported</literal>
    </para>
   </listitem>
  </itemizedlist>
  
  <para>
   次のルールが適用されます。
  </para>
  
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     自己再コンパイルしたカーネルのすべてのモジュールには、デフォルトで「unsupported」のマークが付きます。
    </para>
   </listitem>
   <listitem>
    <para>
     SUSEパートナーによってサポートされていて、<literal>SUSE SolidDriverプログラム</literal>を使用して配信されているカーネルモジュールには、<quote>external</quote>のマークが付きます。
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>supported</literal>フラグが設定されていない場合、そのモジュールをロードすると、カーネルが汚染されます。汚染カーネルはサポートされません。サポート対象外のカーネルモジュールは追加のRPMパッケージ(<systemitem>kernel-<replaceable>FLAVOR</replaceable>-extra</systemitem>)に含まれており、デフォルトではロードされません(<replaceable>FLAVOR</replaceable>=<literal>default</literal>|<literal>|xen</literal>|...)。さらに、これらのサポート対象外のモジュールはインストーラで利用できず、<systemitem class="resource">kernel-<replaceable>FLAVOR</replaceable>-extra</systemitem>パッケージはSUSE Linux Enterpriseのメディアに含まれていません。
    </para>
   </listitem>
   <listitem>
    <para>
     Linuxカーネルのライセンスと互換性があるライセンスに従って提供されていないカーネルモジュールを使用しても、カーネルが汚染されます。詳細については、<filename>/usr/src/linux/Documentation/sysctl/kernel.txt</filename>、および<filename>/proc/sys/kernel/tainted</filename>の状態を参照してください。
    </para>
   </listitem>
  </itemizedlist>
  
  <sect2 id="sec-admsupport-kernel-background">
   <title>技術的背景</title>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Linuxカーネル:SUSE Linux Enterprise <phrase role="productname"><phrase os="sles;sled;slerte">11 SP4</phrase></phrase>では、<filename>/proc/sys/kernel/unsupported</filename>の値はデフォルトで<literal>2</literal>に設定されています(<literal>do not warn in syslog when loading unsupported modules </literal>(サポート対象外のカーネルのロード時にsyslogで警告しない))。このデフォルト値は、インストーラでも、インストールしたシステムでも使用されます。詳細については、<filename>/usr/src/linux/Documentation/sysctl/kernel.txt</filename>を参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      <command>modprobe</command>: モジュールの依存関係を確認して適切にモジュールをロードするための<command>modprobe</command>ユーティリティは、<literal>supported</literal>フラグの値を確認します。この値が<quote>yes</quote>または<quote>external</quote>であればモジュールはロードされ、他の値の場合はロードされません。この動作を無効にする方法については、<xref linkend="sec-admsupport-kernel-unsupported"/>を参照してください。
     </para>
     <note>
      <para>
       SUSEは一般的に、<command>modprobe -r</command>によるストレージモジュールの削除をサポートしていません。
      </para>
     </note>
    </listitem>
   </itemizedlist>
  </sect2>
  
  <sect2 id="sec-admsupport-kernel-unsupported">
   <title>サポート対象外のモジュールの使用</title>
   <para>
    一般的なサポート可能性は重要ですが、サポート対象外のモジュールをロードしなければならないこともあります(たとえば、テストやデバッグを行う場合や、ハードウェアベンダーがホットフィックスを提供している場合など)。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      デフォルト値を無効にするには、<filename>/etc/modprobe.d/unsupported-modules.conf</filename>を編集して、変数の値を変更します。
      <varname>allow_unsupported_modules</varname> の値を<literal>1</literal>に変更します。initrdでサポート対象外のモジュールが必要な場合は、必ず<command>mkinitrd</command>を実行してinitrdをアップデートしてください。
     </para>
     <para>
      モジュールを一度だけロードする場合は、<command>modprobe</command>で<option>--allow-unsupported-modules</option>オプションを使用できます。詳細については、<command>modprobe</command>のマニュアルページを参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      インストール時に、ドライバアップデートディスクを使用してサポート対象外のモジュールを追加できます。この場合、これらのモジュールはロードされます。ブート時およびそれ以降にサポート対象外のモジュールを強制的にロードするには、カーネルコマンドラインオプション<option>oem-modules</option>を使用します。<systemitem class="resource">module-init-tools</systemitem>パッケージのインストールおよび初期化時に、カーネルフラグ<literal>TAINT_NO_SUPPORT</literal> (<filename>/proc/sys/kernel/tainted</filename>)が評価されます。カーネルがすでに汚染されている場合は、<literal>allow_unsupported_modules</literal>が有効になります。これにより、インストール中のシステムでサポート対象外のモジュールが失敗しないようにします。インストール時にサポート対象外のモジュールが存在しておらず、もう1つの特殊なカーネルコマンドラインオプション(<option>oem-modules=1</option>)を使用していない場合は、引き続き、サポート対象外のモジュールを許可しない動作がデフォルトです。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    サポート対象外のモジュールをロードおよび実行すると、カーネルとシステム全体がSUSEのサポート対象外になる点に注意してください。
   </para>
  </sect2>
 </sect1>
 

 <sect1 id="sec-admsupport-moreinfo">
  <title>その他の情報</title>

  <para>
   システム情報の収集の詳細については、次のドキュメントを参照してください。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <command>man supportconfig</command>—<command>supportconfig</command>のマニュアルページ
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man supportconfig.conf</command>—supportconfig環境設定ファイルのマニュアルページ
    </para>
   </listitem>
   <listitem>
    <para>
     <ulink url="http://www.suse.com/communities/conversations/basic-server-health-check-supportconfig/"/>—「A Basic Server Health Check with Supportconfig」
    </para>
   </listitem>
   <listitem>
    <para>
     <ulink url="https://www.novell.com/communities/coolsolutions/cool_tools/create-your-own-supportconfig-plugin/"/>—「Create Your Own Supportconfig Plugin」
    </para>
   </listitem>
   <listitem>
    <para>
     <ulink url="http://www.suse.com/communities/conversations/creating-a-central-supportconfig-repository/"/>—「Creating a Central Supportconfig Repository」
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
