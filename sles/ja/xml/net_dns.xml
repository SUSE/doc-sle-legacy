<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="net_dns.xml" id="cha.dns">
 <title>ドメインネームシステム</title><indexterm> <primary>ドメインネームシステム</primary> <see>DNS</see> </indexterm> <indexterm> <primary>DNS</primary> <secondary>設定</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>DNS</secondary> </indexterm><indexterm> <primary>ネームサーバ</primary> <see>DNS</see> </indexterm>
 <abstract>
  <para>
   DNS (ドメインネームシステム)は、ドメイン名とホスト名をIPアドレスに解決するために必要です。これにより、たとえばIPアドレス192.168.2.100がホスト名<literal>jupiter</literal>に割り当てられます。独自のネームサーバをセットアップする前に、<xref linkend="sec.basicnet.nameres"/>で DNS に関する一般的な説明を参照してください。以降に示す設定例はBINDの場合のものです。
  </para>
 </abstract>
 <sect1 id="sec.dns.basic">
  <title>DNS用語</title><indexterm> <primary>DNS</primary> <secondary>用語</secondary> </indexterm>

  <variablelist>
   <varlistentry>
    <term>ゾーン</term>
    <listitem>
     <para>
      ドメインのネームスペースは、ゾーンと呼ばれる領域に分割されます。たとえば、<literal>example.com</literal>の場合は、<literal>com</literal>ドメインの<literal>example</literal>セクション(つまりゾーン)を表します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DNSサーバ</term>
    <listitem>
     <para>
      DNSサーバは、ドメインの名前とIP情報を管理するサーバです。マスタゾーン用にプライマリDNSサーバ、スレーブゾーン用にセカンダリサーバ、またはキャッシュ用にいずれのゾーンも持たないスレーブサーバを持つことできます。
     </para>
     <variablelist>
      <varlistentry>
       <term>マスタゾーンのDNSサーバ</term>
       <listitem>
        <para>
         マスタゾーンにはネットワークからのすべてのホストが含まれ、DNSサーバのマスタゾーンにはドメイン内のすべてのホストに関する最新のレコードが格納されます。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>スレーブゾーンのDNSサーバ</term>
       <listitem>
        <para>
         スレーブゾーンはマスタゾーンのコピーです。スレーブゾーンのDNSサーバは、ゾーン転送操作によりマスタサーバからゾーンデータを取得します。スレーブゾーンのDNSサーバは、有効なゾーンデータである(期限切れでない)限り、ゾーンに適切に応答します。スレーブがゾーンデータの新規コピーを取得できない場合、ゾーンへの応答を停止します。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>フォワーダ</term>
    <listitem>
     <para>
      フォワーダは、DNSサーバがクエリに回答できない場合に、そのクエリの転送先になるDNSサーバです。1つの環境設定内で複数の設定ソースを有効にするには、<literal>netconfig</literal>を使用します(<command>man 8 netconfig</command>も参照)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>レコード</term>
    <listitem>
     <para>
      レコードは、名前とIPアドレスに関する情報です。サポートされているレコードおよびその構文は、BINDのドキュメントで説明されています。次は、特別なレコードの一部です。
     </para>
     <variablelist>
      <varlistentry>
       <term>NSレコード</term>
       <listitem>
        <para>
         NSレコードは、指定のドメインゾーンの担当マシンをネームサーバに指定します。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>MXレコード</term>
       <listitem>
        <para>
         MX(メール交換)レコードは、インターネット上でメールを転送する際に通知するマシンを説明します。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>SOAレコード</term>
       <listitem>
        <para>
         SOA (Start of Authority)レコードは、ゾーンファイル内で最初のレコードです。SOAレコードは、DNSを使用して複数のコンピュータ間でデータを同期化する際に使用されます。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec.dns.install">
  <title>インストール</title>

  <para>
   DNSサーバをインストールするには、YaSTを起動してから、<menuchoice><guimenu>ソフトウェア</guimenu><guimenu>ソフトウェア管理</guimenu></menuchoice>の順に選択します。<menuchoice><guimenu>表示</guimenu><guimenu>パターン</guimenu></menuchoice>の順に選択して、<guimenu>DHCPおよびDNSサーバ</guimenu>を選択します。依存関係のあるパッケージのインストールを確認して、インストールプロセスを完了します。
  </para>
 </sect1>
 <sect1 id="sec.dns.yast">
  <title>YaSTでの設定</title>

  <para>
   YaST DNSモジュールを使用して、ローカルネットワーク用にDNSサーバを設定します。このモジュールを初めて起動すると、サーバ管理に関して2、3の決定を行うように要求されます。この初期セットアップを完了すると、基本的なサーバ設定が生成されます。エキスパートモードを使用すると、より詳細な設定タスク(ACLのセットアップ、ロギング、TSIGキーなどのオプション)を処理できます。
  </para>

  <sect2 id="sec.dns.yast.wizard">
   <title>ウィザードによる設定</title>

   <para>
    ウィザードは3つのステップ(ダイアログ)で構成されています。各ダイアログの適切な箇所でエキスパート用の設定モードに入ることができます。
   </para>
   <procedure>
    <step performance="required">
     <para>
      モジュールを初めて起動すると、のような<guimenu>フォワーダの設定</guimenu><xref linkend="fig.yast2.dnsinst.forwarders"/>ダイアログが表示されます。<guimenu>Netconfig DNS Policy</guimenu>を使用すると、フォワーダを提供するデバイスを決定したり、独自の<guimenu>Forwarder List</guimenu>を指定するかどうかを決定できます。netconfigの詳細については、<command>man 8 netconfig</command>を参照してください。
     </para>
     <figure id="fig.yast2.dnsinst.forwarders">
      <title>DNSサーバのインストール:フォワーダの設定</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      フォワーダは、ご使用のDNSサーバが回答できないクエリの送信先とするDNSサーバです。フォワーダのIPアドレスを入力して、<guimenu>追加</guimenu>をクリックします。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>DNSゾーン</guimenu>ダイアログは、複数の部分で構成されており、<xref linkend="sec.dns.zonefile"/>で説明するゾーンファイルの管理に関する項目を設定します。新しいゾーンの場合は、<guimenu>名前</guimenu>にゾーン名を入力します。逆引きゾーンを追加する場合は、<literal>.in-addr.arpa</literal>で終わる名前を入力しなければなりません。最後に、<guimenu>タイプ</guimenu>(マスタ、スレーブ、または転送)を選択します。<xref linkend="fig.yast2.dnsinst.zones"/>を参照してください。既存のゾーンのその他の項目を設定するには、<guimenu>Edit</guimenu>をクリックします。ゾーンを削除するには、<guimenu>Delete</guimenu>をクリックします。
     </para>
     <figure id="fig.yast2.dnsinst.zones">
      <title>DNSサーバのインストール:DNSゾーン</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_zone.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_zone.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step performance="required">
     <para>
      最後のダイアログでは、<guimenu>ファイアウォールで開いているポート</guimenu>をクリックして、ファイアウォールのDNSポートを開くことができます。次に、ブート時にDNSサーバ を起動するかどうか(<guimenu>オン</guimenu>か、<guimenu>オフ</guimenu>か)を決定します。LDAPサポートを有効にすることもできます。詳細については、<xref linkend="fig.yast2.dnsinst.finish"/>を参照してください。
     </para>
     <figure id="fig.yast2.dnsinst.finish">
      <title>DNSサーバのインストール:完了ウィザード</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_finish.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_finish.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2>
   <title>エキスパート設定</title>
   <para>
    YaSTのモジュールを起動するとウィンドウが開き、複数の設定オプションが表示されます。設定を完了すると、基本的な機能が組み込まれたDNSサーバ設定が作成されます。
   </para>
   <sect3>
    <title>起動</title>
    <para>
     <guimenu>起動</guimenu>では、DNSサーバをシステムのブート中に起動するか、それとも手動で起動するか指定します。DNSサーバをすぐに起動するには、<guimenu>今すぐDNSサーバを起動する</guimenu>を選択します。DNSサーバを停止するには、<guimenu>今すぐDNSサーバを停止する</guimenu>を選択します。現在の設定を保存するには、<guimenu>設定を保存して、今すぐDNSサーバをリロードする</guimenu>を選択します。ファイアウォールのDNSポートを開くには<guimenu>ファイアウォール内でポートを開く</guimenu>を、ファイアウォールの設定を変更するには<guimenu>Firewall Details</guimenu>をクリックします。
    </para>
    <para>
     <guimenu>LDAPサポートを有効にする</guimenu>を選択すると、ゾーンファイルがLDAPデータベースによって管理されるようになります。ゾーンデータを変更してそれがLDAPデータベースに書き込まれると、設定を再ロードするように要求されます。DNSサーバを再起動すると、変更がすぐに反映されます。
    </para>
   </sect3>
   <sect3>
    <title>フォワーダ</title>
    <para>
     ローカルDNSサーバは、要求に応答できない場合、要求を<guimenu>フォワーダ</guimenu>に転送しようとします(そのように設定されている場合)。このフォワーダは、手動で、<guimenu>Forwarder List</guimenu>に追加できます。フォワーダが、ダイアルアップ接続でのように静的でない場合は、<guimenu>netconfig</guimenu>が設定を処理します。netconfigの詳細については、<command>man 8 netconfig</command>を参照してください。
    </para>
   </sect3>
   <sect3>
    <title>基本的なオプション</title>
    <para>
     このセクションでは、基本的なサーバオプションを設定します。<guimenu>オプション</guimenu>メニューから設定する項目を選択して、対応する入力フィールドに値を指定します。新しいエントリを追加するには、<guimenu>追加</guimenu>を選択してください。
    </para>

   </sect3>
   <sect3>
    <title>ログ</title>
    <para>
     DNSサーバがログに記録する内容とログの方法を設定するには、<guimenu>ログ記録</guimenu>を選択します。<guimenu>Log Type</guimenu>に、DNSサーバがログデータを書き込む場所を指定します。システム全体のログファイル<filename>/var/log/messages</filename>を使用する場合は<guimenu>システムログ</guimenu>を、別のファイルを指定する場合は<guimenu>ファイル</guimenu>を選択します。別のファイルを指定する場合は、ファイル名、ログファイルの最大サイズ(メガバイト(MB))と保管するログファイル数(バージョン)も指定します。
    </para>
    <para>
     <guimenu>追加ログ</guimenu>には、さらに詳細なオプションが用意されています。<guimenu>すべてのDNSクエリをログに記録</guimenu>を有効にすると、<emphasis>すべての</emphasis>クエリがログに記録されるため、ログファイルが非常に大きくなる可能性があります。ですから、このオプションを有効にするのはデバッグ時だけにすることをお勧めします。DHCPサーバとDNSサーバ間でのゾーン更新時のデータトラフィックをログに記録するには、<guimenu>ゾーン更新をログに記録</guimenu>を有効にします。マスタからスレーブへのゾーン転送時のデータトラフィックをログに記録するには、<guimenu>ゾーン転送をログに記録</guimenu>を有効にします。詳細については、<xref linkend="fig.yast2.dns.logging"/>を参照してください。
    </para>
    <figure id="fig.yast2.dns.logging">
     <title>DNSサーバ:ログの記録</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
   <sect3>
    <title>ACL</title>
    <para>
     このダイアログでは、アクセス制限を強制するACL(アクセス制御リスト)を定義します。<guimenu>名前</guimenu>に個別名を入力したら、次の形式で、<guimenu>値</guimenu>にIPアドレス(ネットマスクは省略可)を指定します。
    </para>
<screen>{ 192.168.1/24; }</screen>
    <para>
     設定ファイルの構文に従って、アドレスの末尾にはセミコロンを付け、中カッコで囲む必要があります。
    </para>

   </sect3>
   <sect3>
    <title>TSIGキー</title>
    <para>
     TSIG (トランザクションシグネチャー)の主な目的は、DHCPおよびDNSサーバ間で安全な通信を行うことです。<xref linkend="sec.dns.tsig"/>を参照してください。
    </para>
    <para>
     TSIGキーを生成するには、<guimenu>キーID</guimenu>フィールドに個別名を入力し、キーを格納するファイルを<guimenu>ファイル名</guimenu>フィールドに入力します。<guimenu>生成</guimenu>をクリックすると、選択内容が確定されます。
    </para>
    <para>
     作成済みのキーを使用するには、<guimenu>キーID</guimenu>フィールドを空白のままにして、<guimenu>ファイル名</guimenu>で、そのキーが保存されているファイルを選択します。その後、<guimenu>追加</guimenu>をクリックすると、入力内容が確定されます。
    </para>

   </sect3>
   <sect3>
    <title>DNSゾーン(スレーブゾーンの追加)</title>
    <para>
     スレーブゾーンを追加するには、<guimenu>DNSゾーン</guimenu>を選択し、ゾーンタイプに<guimenu>スレーブ</guimenu>を選択し、新規ゾーンの名前を書き込み、<guimenu>追加</guimenu>をクリックします。
    </para>
    <para>
     <guimenu>マスタDNSサーバのIP</guimenu>の下の<guimenu>ゾーンエディタ</guimenu>サブダイアログで、スレーブがデータをプルするマスタを指定します。サーバへのアクセスを制限するために、リストから定義済みのACLを1つ選択します。

    </para>

   </sect3>
   <sect3>
    <title>DNSゾーン(マスタゾーンの追加)</title>
    <para>
     マスタゾーンを追加するには、<guimenu>DNSゾーン</guimenu>を選択し、ゾーンタイプに<guimenu>マスタ</guimenu>を選択し、新規ゾーンの名前を書き込み、<guimenu>追加</guimenu>をクリックします。マスタゾーンの追加時には、逆引きゾーンも必要です。たとえば、ゾーン<systemitem>example.com</systemitem>(サブネット<literal>192.168.1.0/24</literal>内のホストをポイントするゾーン)を追加する際には、カバーされるIPアドレス範囲の逆引きゾーンも追加する必要があります。定義上、このゾーンの名前は、<literal>1.168.192.in-addr.arpa</literal>となります。
    </para>
   </sect3>
   <sect3>
    <title>DNSゾーン(マスタゾーンの編集)</title>
    <para>
     マスタゾーンを編集するには、<guimenu>DNSゾーン</guimenu>を選択し、テーブルからマスタゾーンを選択し、<guimenu>編集</guimenu>をクリックします。このダイアログには、<guimenu>基本</guimenu>(最初に表示される)、<guimenu>NSレコード</guimenu>、<guimenu>MXレコード</guimenu>、<guimenu>SOA</guimenu>、および<guimenu>レコード</guimenu>のページがあります。
    </para>
    <para os="sles;osuse">
     に示す基本ダイアログを使用すると、ダイナミックDNSの設定と、クライアントおよびスレーブネームサーバへのゾーン転送に関するアクセスオプションを定義できます。<xref linkend="fig.yast2.dns.ddns"/>ゾーンの動的更新を許可するには、<guimenu>動的アップデートの許可</guimenu>および対応するTSIGキーを選択します。このキーは、更新アクションの開始前に定義しておく必要があります。ゾーン転送を有効にするには、対応するACLを選択します。ACLは事前に定義しておく必要があります。
    </para>
    <para>
     <guimenu>基本</guimenu>ダイアログで、ゾーン転送を有効にするかどうか選択します。リストされたACLを使用して、ゾーンをダウンロードできるユーザを定義します。
    </para>
    <figure id="fig.yast2.dns.ddns" os="sles;osuse">
     <title>DNSサーバ: ゾーンエディタ(基本)</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <variablelist>
     <varlistentry>
      <term>ゾーンエディタ(NSレコード)</term>
      <listitem>
       <para>
        <guimenu>レコード</guimenu>ダイアログでは、指定したゾーンの代替ネームサーバを定義できます。リストに自分が使用しているネームサーバが含まれていることを確認してください。レコードを追加するには、<guimenu>追加するネームサーバ</guimenu>にレコード名を入力し、<guimenu>追加</guimenu>をクリックして確定します。詳細については、<xref linkend="fig.yast2.dns.nsrec"/>を参照してください。
       </para>
       <figure id="fig.yast2.dns.nsrec">
        <title>DNSサーバ:ゾーンエディタ(NSレコード)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ(MXレコード)</term>
      <listitem>
       <para>
        現行ゾーンのメールサーバを既存のリストに追加するには、対応するアドレスと優先順位の値を入力します。その後、<guimenu>追加</guimenu>を選択して確定します。詳細については、<xref linkend="fig.yast2.dns.mxrec"/>を参照してください。
       </para>
       <figure id="fig.yast2.dns.mxrec">
        <title>DNSサーバ:ゾーンエディタ(MXレコード)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="72%" fileref="yast2_dns_def_mxrec.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_mxrec.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ(SOA)</term>
      <listitem>
       <para>
        このページでは、SOA (start of authority)レコードを作成できます。個々のオプションについては、<xref linkend="ex.welt.zone"/>を参照してください。<phrase os="sles">LDAPを介して管理される動的ゾーンの場合、SOAレコードの変更がサポートされないので注意してください。</phrase>
       </para>
       <figure id="fig.yast2.dns.soa">
        <title>DNSサーバ:ゾーンエディタ(SOA)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ(レコード)</term>
      <listitem>
       <para>
        このダイアログでは、名前解決を管理します。<guimenu>レコードキー</guimenu>では、ホスト名を入力してレコードタイプを選択します。<guimenu>Aレコード</guimenu>はメインエントリを表します。この値はIPアドレスでなければなりません。<guimenu>CNAME</guimenu>はエイリアスです。<guimenu>NS</guimenu>および<guimenu>MX</guimenu>の各タイプを指定すると、<guimenu>NSレコード</guimenu>および<guimenu>MXレコード</guimenu>の各タブで提供される情報に基づいて、詳細レコードまたは部分レコードが展開されます。この3つのタイプのは、既存のAレコードに解決されます。<guimenu>PTR</guimenu>は逆引きゾーン用レコードです。これは、次の例のように、<literal>A</literal>レコードとは反対です。
       </para>
<screen>hostname.example.com. IN A 192.168.0.1
1.0.168.192.in-addr.arpa IN PTR hostname.example.com.</screen>
      </listitem>
     </varlistentry>
    </variablelist>


    <note>
     <title>逆引きゾーンの編集</title>
     <para>
      正引きゾーンの追加後、メインメニューに戻って、編集用の逆引きゾーンを選択します。次に、タブ<guimenu>基本</guimenu>で、チェックボックス<guimenu>Automatically Generate Records From</guimenu>にチェック印を入れ、正引きゾーンを選択します。これにより、正引きゾーンでのすべての変更が、逆引きゾーンで自動的に更新されます。
     </para>
    </note>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.dns.bind">
  <title>BINDネームサーバの起動</title><indexterm id="idx.DNS_BIND" class="startofrange"> <primary>DNS</primary> <secondary>BIND</secondary> </indexterm> <indexterm id="idx.BIND" class="startofrange"> <primary>BIND</primary> </indexterm>

  <para>
   <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>システムでは、ネームサーバBIND (<emphasis>Berkeley Internet Name Domain</emphasis>)は、事前設定されて提供されるので、インストールが正常に完了すればただちに起動できます。すでにインターネットに接続し、<systemitem class="ipaddress">/etc/resolv.conf</systemitem>の<systemitem class="domainname">localhost</systemitem>にネームサーバアドレス<filename>127.0.0.1</filename>が入力されている場合、通常、プロバイダのDNSを知らなくても、すでに機能する名前解決メカニズムが存在します。この場合、BINDは、ルートネームサーバを介して名前の解決を行うため、処理が非常に遅くなります。通常、効率的で安全な名前解決を実現するには、<filename>forwarders</filename>の下の設定ファイル<systemitem>/etc/named.conf</systemitem>にプロバイダのDNSとそのIPアドレスを入力する必要があります。いままでこれが機能している場合、ネームサーバは、純粋な<emphasis>キャッシュ専用</emphasis>ネームサーバとして動作しています。ネームサーバは、そのゾーンを設定してはじめて、正しいDNSにすることができます。簡単な例については、<filename>/usr/share/doc/packages/bind/config</filename>のドキュメントを参照してください。
  </para><indexterm> <primary>環境設定ファイル</primary> <secondary>resolv.conf</secondary> </indexterm> <indexterm> <primary>環境設定ファイル</primary> <secondary>named.conf</secondary> </indexterm>

  <tip>
   <title>ネームサーバ情報の自動取得</title>
   

   <para>
    インターネット接続やネットワーク接続のタイプによっては、ネームサーバ情報を自動的に現在の状態に適合させることができます。これを行うには、<filename>/etc/sysconfig/network/config</filename>ファイル内の<systemitem>NETCONFIG_DNS_POLICY</systemitem>変数を <literal>auto</literal>に設定します。
   </para>
  </tip>

  <para>
   ただし、公式のドメインは、その1つが責任のある機関によって割り当てられるまで、セットアップしないでください。独自のドメインを持っていて、プロバイダがそれを管理している場合でも、BINDはそのドメインに対する要求を転送しないので、そのドメインを使用しないほうが賢明です。たとえば、プロバイダのWebサーバは、このドメインからはアクセスできません。
  </para>

  <para>
   ネームサーバを起動するには、<systemitem class="username">root</systemitem>ユーザとして、コマンド「<command>rcnamed</command><option>start</option>」を入力します。右側に緑色で<quote>done</quote>と表示されたら、named(ネームサーバプロセス名)が正常に起動しています。サーバが正常に起動したらすぐに、<command>host</command>または<command>dig</command>プログラムを用いてローカルシステム上でネームサーバをテストしてください。デフォルトサーバ<systemitem class="domainname">localhost</systemitem>とそのアドレス<systemitem class="ipaddress">127.0.0.1</systemitem>が返されるはずです。これが返されない場合は、<filename>/etc/resolv.conf</filename>に含まれているネームサーバエントリが誤っているか、同ファイルが存在しないかのいずれかです。最初のテストとして、「<command>host</command><option>127.0.0.1</option>」を入力します。これは常に機能するはずです。エラーメッセージが表示された場合は、<command>rcnamed</command> <option>status</option>を使用して、サーバが実際に起動されていることを確認します。ネームサーバが起動しない場合、または予想しない動作をしている場合、多くはログファイル<filename>/var/log/messages</filename>でその原因が明らかになります。
  </para><indexterm> <primary>ログファイル</primary> <secondary>メッセージ</secondary> </indexterm> <indexterm> <primary>DNS</primary> <secondary>起動</secondary> </indexterm> <indexterm> <primary>DNS</primary> <secondary>トラブルシューティング</secondary> </indexterm>

  <para>
   プロバイダのネームサーバ(またはすでにネットワーク上で動作しているネームサーバ)をフォワーダとして使用する場合は、<systemitem>forwarders</systemitem>の下の<systemitem>options</systemitem>セクションに、対応するIPアドレスまたはアドレスを入力します。に含まれているアドレスは、単なる例です。<xref linkend="ex.forward"/>各自サイトの設定に合わせて変更してください。<indexterm> <primary>DNS</primary> <secondary>転送</secondary> </indexterm>
  </para>

  <example id="ex.forward">
   <title>named.confファイルの転送オプション</title>


<screen>options { 
        directory "/var/lib/named";
        forwarders { 10.11.12.13; 10.11.12.14; };
        listen-on { 127.0.0.1; 192.168.1.116; };
        allow-query { 127/8; 192.168/16 };
        notify no;
        };</screen>
  </example>

  <para>
   options<systemitem>エントリの後には、ゾーン用のエントリ、</systemitem>localhost<systemitem class="domainname">と</systemitem>0.0.127.in-addr.arpa<systemitem>が続きます。</systemitem><quote>.</quote>の下の<literal>type hint(タイプヒント)</literal>は必ず存在しなければなりません。対応するファイルは、変更する必要がなく、そのままで機能します。また、各エントリの末尾が<quote>;</quote>で閉じられ、中カッコが適切な位置にあることを確認してください。設定ファイル<filename>/etc/named.conf</filename>またはゾーンファイルを変更したら、<command>rcnamed</command><option>reload</option>を使用して、BINDにそれらを再読み込みさせます。または、<command>rcnamed</command><option>restart</option>を使用してネームサーバを停止、再起動しても同じ結果が得られます。サーバは「<command>rcnamed</command><option>stop</option>」を入力していつでも停止することができます。
  </para>
 </sect1>
 <sect1 id="sec.dns.named">
  <title>The /etc/named.conf環境設定ファイル</title><indexterm id="idx.configuration_files_named.conf" class="startofrange"> <primary>環境設定ファイル</primary><secondary>host.conf</secondary> </indexterm>

  <para>
   BINDネームサーバ自体のすべての設定は、<filename>/etc/named.conf</filename>ファイルに格納されます。ただし、処理するドメインのゾーンデータ(ホスト名、IPアドレスなどで構成されている)は、<filename>/var/lib/named</filename>ディレクトリ内の個別のファイルに格納されます。この詳細については、後述します。
  </para>

  <para>
   <filename>/etc/named.conf</filename>ファイルは、大きく2つのエリアに分けられます。1つは一般的な設定用の<systemitem>options</systemitem>セクション、もう1つは個々のドメインの<systemitem>zone</systemitem>エントリで構成されるセクションです。ログ<systemitem>セクションと</systemitem>acl<systemitem> (アクセス制御リスト)エントリは省略可能です。</systemitem>コメント行は、行頭に<literal>#</literal>記号または<literal>//</literal>を指定します。最も基本的な<filename>/etc/named.conf</filename>ファイルの例を、<xref linkend="ex.named.mini"/>に示します。
  </para>

  <example id="ex.named.mini">
   <title>基本的な/etc/named.confファイル</title>
<screen>options { 
        directory "/var/lib/named"; 
        forwarders { 10.0.0.1; };
        notify no;
};

zone "localhost" in {
       type master;
       file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
        type master;
        file "127.0.0.zone";
};

zone "." in {
        type hint;
        file "root.hint";
};</screen>
  </example>

  <sect2 id="sec.dns.named.options">
   <title>重要な設定オプション</title><indexterm> <primary>DNS</primary> <secondary>オプション</secondary> </indexterm>
   <variablelist>
    <varlistentry>
     <term>directory "<replaceable>filename</replaceable>";</term>
     <listitem>
      <para>
       BINDが検索する、ゾーンファイルが格納されているディレクトリを指定します。通常は<filename>/var/lib/named</filename>です。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forwarders { <replaceable>ip-address</replaceable>; };</term>
     <listitem>
      <para>
       DNS要求が直接解決できない場合、それらが転送されるネームサーバ(ほとんどの場合、プロバイダのネームサーバ)を指定します。<replaceable>ip-address</replaceable>には、IPアドレスを<literal>192.168.1.116</literal>のように指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forward first;</term>
     <listitem>
      <para>
       ルートネームサーバでDNS要求の解決を試みる前に、それらを転送するようにします。<systemitem>forward first</systemitem>の代わりに<systemitem>forward only</systemitem>を指定すると、要求が転送されたままになり、ルートネームサーバには送り返されません。このオプションは、ファイアウォール構成で使用します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on port 53 { 127.0.0.1; <replaceable>ip-address</replaceable>; };<indexterm> <primary>ports</primary> <secondary>53</secondary> </indexterm></term>
     <listitem>
      <para>
       BINDがクライアントからのクエリを受け取るネットワークインタフェースとポートを指定します。<literal>port 53</literal>はデフォルトポートであるため、明示的に指定する必要はありません。<literal/>ローカルホストからの要求を許可するには、<literal>127.0.0.1</literal>と記述します。このエントリ全体を省略した場合は、すべてのインタフェースがデフォルトで使用されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on-v6 port 53 {any; };</term>
     <listitem>
      <para>
       BINDがIPv6クライアント要求をリッスンするポートを指定します。any<literal>以外で指定できるのは</literal>none<literal>だけです。</literal>IPv6に関して、サーバはワイルドカードアドレスのみ受け付けます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>
       ファイアウォールが発信DNS要求をブロックする場合、このエントリが必要です。BINDに対し、外部への要求をポート53から発信し、1024を超える上位ポートからは発信しないように指示します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>
       BINDがIPv6のクエリに使用するポートを指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-query { 127.0.0.1; <replaceable>net</replaceable>; };</term>
     <listitem>
      <para>
       クライアントがDNS要求を発信できるネットワークを定義します。<replaceable>net</replaceable>には、アドレス情報を<literal>192.168.2.0/24</literal>のように指定します。末尾の<systemitem>/24</systemitem>は、ネットマスクの短縮表記で、この場合<systemitem class="netmask">255.255.255.0</systemitem>を表します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-transfer ! *;;</term>
     <listitem>
      <para>
       ゾーン転送を要求できるホストを制御します。この例では、<systemitem>!が使用されているので、ゾーン転送要求は完全に拒否されます。*</systemitem>. このエントリがなければ、ゾーン転送をどこからでも制約なしに要求できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>
       このエントリがなければ、BINDは1時間ごとに数行の統計情報を生成して<filename>/var/log/messages</filename>に保存します。0を指定すると、統計情報をまったく生成しないか、時間間隔を分単位で指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cleaning-interval 720;</term>
     <listitem>
      <para>
       このオプションは、BINDがキャッシュをクリアする時間間隔を定義します。キャッシュがクリアされるたびに、<filename>/var/log/messages</filename>にエントリが追加されます。時間の指定は分単位です。デフォルトは60分です。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>
       BINDは定期的にインタフェースを検索して、新しいインタフェースや存在しなくなったインタフェースがないか確認します。この値を<systemitem>0</systemitem>に設定すると、この検索が行われなくなり、BINDは起動時に検出されたインタフェースのみをリッスンします。0以外の値を指定する場合は分単位で指定します。デフォルトは60分です。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>notify no;</term>
     <listitem>
      <para>
       <option>no</option>に設定すると、ゾーンデータを変更したとき、またはネームサーバが再起動されたときに、他のネームサーバに通知されなくなります。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    すべての利用可能なオプションのリストについては、マニュアルページ<command>man 5 named.conf</command>を参照してください。
   </para>
  </sect2>

  <sect2 id="sec.dns.named.log">
   <title>ロギング</title><indexterm> <primary>DNS</primary> <secondary>ログの記録</secondary> </indexterm>
   <para>
    BINDでは、何を、どのように、どこにログ出力するかを詳細に設定できます。通常は、デフォルト設定のままで十分です。<xref linkend="ex.no.log"/>に、このエントリの最も簡単な形式、すなわちログをまったく出力しない例を示します。
   </para>
   <example id="ex.no.log">
    <title>ログを無効にするエントリ</title>
<screen>logging {
        category default { null; };
};</screen>
   </example>
  </sect2>

  <sect2 id="sec.dns.named.zones">
   <title>ゾーンエントリ</title>
   <example id="ex.meine.domain">
    <title>example.comのゾーンエントリ</title>
<screen>zone "example.com" in {
      type master;
      file "example.com.zone";
      notify no;
};</screen>
   </example>
   <para>
    <systemitem>zone</systemitem>の後、管理対象のドメイン名(<systemitem class="domainname">example.com</systemitem>)を指定し、その後に<systemitem>in</systemitem>と関連のオプションを中カッコで囲んで指定します(<xref linkend="ex.meine.domain"/>参照)。スレーブゾーン<emphasis>を定義するには、<systemitem>type</systemitem>を<literal>slave</literal>に変更し、このゾーンを<literal>master</literal>として管理することをネームサーバに指定します(<xref linkend="ex.andere.domain"/>参照)。これが他のマスタのスレーブとなることもあります。</emphasis>
   </para>
   <example id="ex.andere.domain">
    <title>example.netのゾーンエントリ</title>
<screen>zone "example.net" in {
      type slave;
      file "slave/example.net.zone";
      masters { 10.0.0.1; }; 
};</screen>
   </example>
<?dbfo-need height="10em"?>


   <para>
    ゾーンオプション
   </para>
   <variablelist>
    <varlistentry>
     <term>type master;</term>
     <listitem>
      <para>
       master<literal>を指定して、BINDに対し、ゾーンがローカルネームサーバによって処理されるように指示します。</literal>これは、ゾーンファイルが正しい形式で作成されていることが前提となります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type slave;</term>
     <listitem>
      <para>
       このゾーンは別のネームサーバから転送されたものです。必ず<systemitem>masters</systemitem>とともに使用します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type hint;</term>
     <listitem>
      <para>
       ルートネームサーバの設定には、ゾーン<literal>.</literal>(<literal>hint</literal>タイプ)を使用します。このゾーン定義はそのまま使用できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>example.com.zone</filename>ファイルまたは<quote>slave/example.net.zone</quote>ファイル</term>
     <listitem>
      <para>
       このエントリは、ドメインのゾーンデータが格納されているファイルを指定します。スレーブの場合は、このデータを他のネームサーバから取得するので、このファイルは不要です。マスタとスレーブのファイルを区別するには、スレーブファイルにディレクトリ<filename>slave</filename>を使用します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>masters { <replaceable>server-ip-address</replaceable>; };</term>
     <listitem>
      <para>
       このエントリは、スレーブゾーンにのみ必要です。ゾーンファイルの転送元となるネームサーバを指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-update {! *; };</term>
     <listitem>
      <para>
       このオプションは、外部の書き込みアクセスを制御し、クライアントにDNSエントリへの書き込み権を付与することができます。ただし、これは通常、セキュリティ上の理由で好ましくありません。このエントリがなければ、ゾーンの更新は完全に拒否されます。! *<literal>によってそのような操作が禁止されるため、前述のエントリは同じものをアーカイブします。</literal>
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 id="sec.dns.zonefile">
  <title>ゾーンファイル</title><indexterm> <primary>DNS</primary> <secondary>ゾーン</secondary> <tertiary>ファイル</tertiary> </indexterm>

  <para>
   ゾーンファイルは2種類必要です。一方はIPアドレスをホスト名に割り当て、もう一方は逆にIPアドレスのホスト名を提供します。
  </para>

<?dbfo-need height="20em"?>



  <tip>
   <title>ゾーンファイルでのドット(ピリオド、フルストップ)の使用</title>
   <para>
    フィルタフィールドの右側にある <literal>"."</literal>はゾーンファイル内で重要な意味を持ちます。末尾に<literal>.</literal>のホスト名を指定すると、ゾーンが追加されます。完全なホスト名を完全なドメイン名とともに指定する場合は、末尾に<literal>.</literal>を付けて、ドメインが追加されないようにします。ネームサーバ設定エラーの原因として最も頻繁に挙げられるのは、おそらく「.」の打ち忘れや位置の間違いです。
   </para>
  </tip>



  <para>
   最初に、ドメイン<filename>example.com</filename>に責任を負うゾーンファイル<filename>example.com.zone</filename>について示します(<xref linkend="ex.welt.zone"/>を参照してください)。
  </para>

  <example id="ex.welt.zone">
   <title>/var/lib/named/example.com.zoneファイル</title>
<screen linenumbering="numbered">1.  $TTL 2D 
2.  example.com. IN SOA      dns  root.example.com. ( 
3.               2003072441  ; serial
4.               1D          ; refresh
5.               2H          ; retry
6.               1W          ; expiry
7.               2D )        ; minimum
8.  
9.               IN NS       dns 
10.              IN MX       10 mail
11. 
12. gate         IN A        192.168.5.1 
13.              IN A        10.0.0.1 
14. dns          IN A        192.168.1.116 
15. mail         IN A        192.168.3.108 
16. jupiter      IN A        192.168.2.100
17. venus        IN A        192.168.2.101
18. saturn       IN A        192.168.2.102
19. mercury      IN A        192.168.2.103
20. ntp          IN CNAME    dns 
21. dns6         IN A6  0    2002:c0a8:174::
</screen>

  </example>

  <variablelist>
   <varlistentry>
    <term>1行目:</term>
    <listitem>
     <para>
      <systemitem>$TTL</systemitem>は、このファイルのすべてのエントリに適用されるデフォルトの寿命(time to live)です。この例では、エントリは2日間(<literal>2 D</literal>)有効です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>2行目:</term>
    <listitem>
     <para>
      ここから、SOA (start of authority)制御レコードが始まります。
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        管理対象のドメイン名は、先頭の<literal>example.com</literal>です。この末尾には、<literal>「.」</literal>(ピリオド)が付いています。ピリオドを付けないと、ゾーンが再度、末尾に追加されてしまいます。あるいはピリオドを<literal>@</literal>で置き換えることもできます。その場合は、ゾーンが<filename>/etc/named.conf</filename>の対応するエントリから抽出されます。
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem>IN SOA</systemitem>の後には、このゾーンのマスタであるネームサーバの名前を指定します。この名前は、末尾に「<literal>.</literal>」が付いていないので、<literal>dns</literal>から<literal>dns.example.com</literal>に拡張されます。
       </para>
      </listitem>
      <listitem>
       <para>
        この後には、このネームサーバの責任者の電子メールアドレスが続きます。<literal>@</literal>記号はすでに特別な意味を持つので、ここでは代わりに<literal>「.」</literal>(ピリオド)を使用します。<systemitem>root@example.com</systemitem>の場合、エントリは<systemitem>root.example.com</systemitem>を読み込む必要があります。フィルタフィールドの右側にある <literal>"."</literal>を末尾につける必要があります。
       </para>
      </listitem>
      <listitem>
       <para>
        <literal>「(」</literal>は、<literal>「)」</literal>までの行をすべてSOAレコードに含める場合に使用します。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>3行目:</term>
    <listitem>
     <para>
      <systemitem>シリアル番号</systemitem>は任意の番号で、このファイルを変更するたびに増加します。変更があった場合、セカンダリネームサーバ(スレーブサーバ)に通知する必要があります。これには、日付と実行番号をYYYYMMDDNNという形式で表記した10桁の数値が、慣習的に使用されています。
     </para>

    </listitem>
   </varlistentry>
   <varlistentry>
    <term>4行目:</term>
    <listitem>
     <para>
      <systemitem>リフレッシュレート</systemitem>は、セカンダリネームサーバがゾーン<systemitem>serial number</systemitem>を確認する時間間隔を指定します。この例では1日です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>5行目:</term>
    <listitem>
     <para>
      <systemitem>再試行間隔</systemitem>は、エラーが生じた場合に、セカンダリネームサーバがプライマリサーバに再度通知を試みる時間間隔を指定します。この例では2時間です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>6行目:</term>
    <listitem>
     <para>
      <systemitem>有効期限</systemitem>は、セカンダリネームサーバがプライマリサーバに再通知できなかった場合に、キャッシュしたデータを廃棄するまでの時間枠を指定します。ここでは、1週間です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>7行目:</term>
    <listitem>
     <para>
      SOAレコードの最後のエントリは、<systemitem>ネガティブキャッシュTTL</systemitem>です。これは、DNSクエリが解決できないという他のサーバからの結果をキャッシュしておく時間です。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>9行目:</term>
    <listitem>
     <para>
      <systemitem>IN NS</systemitem>では、このドメインを担当するネームサーバを指定します。<systemitem>dns</systemitem>は、<systemitem>dns.example.com</systemitem>に拡張されます。これは、末尾に「<literal>.</literal>」が付いていないためです。このように、プライマリネームサーバと各セカンダリネームサーバに1つずつ指定する行がいくつかあります。<filename>/etc/named.conf</filename>で<systemitem>notify</systemitem>を<option>no</option>に設定しない限り、ゾーンデータが変更されると、ここにリストされているすべてのネームサーバにそれが通知されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>10行目:</term>
    <listitem>
     <para>
      MXレコードは、ドメイン<systemitem class="domainname">example.com</systemitem>宛ての電子メールを受領、処理、および転送するメールサーバを指定します。この例では、ホスト<systemitem class="domainname">mail.example.com</systemitem>が指定されています。ホスト名の前の数字は、プリファレンス値です。複数のMXエントリが存在する場合、値が最も小さいメールサーバが最初に選択され、このサーバへのメール配信ができなければ、次に小さい値のメールサーバが試みられます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>12～19行目:</term>
    <listitem>
     <para>
      これらは、ホスト名に1つ以上のIPアドレスが割り当てられている実際のアドレスレコードです。ここでは、名前が「<literal>.</literal>」なしで一覧にされています。これは、これらの名前にはドメインが含まれていないためです。したがって、これらの名前にはすべて、<systemitem class="domainname">example.com</systemitem>が追加されます。ホスト<systemitem>gate</systemitem>には、ネットワークカードが2枚搭載されているので、2つのIPアドレスが割り当てられます。ホストアドレスが従来型のアドレス(IPv4)の場合、レコードに<literal>A</literal>が付きます。アドレスがIPv6アドレスの場合、エントリに<literal>AAAA </literal>が付きます。

     </para>


     <note>
      <title>IPv6の構文</title>
      <para>
       IPv6レコードの構文は、IPv4と少し異なっています。断片化の可能性があるため、アドレスの前に消失したビットに関する情報を入力する必要があります。IPv6アドレスを必要な数の<quote>0</quote>で満たすには、アドレス内の正しい位置に2つコロンを追加します。

      </para>
<screen>pluto     AAAA 2345:00C1:CA11::1234:5678:9ABC:DEF0
pluto     AAAA 2345:00D2:DA11::1234:5678:9ABC:DEF0</screen>

     </note>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>20行目:</term>
    <listitem>
     <para>
      エイリアス<literal>ntp</literal>を<literal>dns</literal>の別名として使用できます(<systemitem>CNAME</systemitem>は<emphasis>一般名</emphasis>という意味)。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>



  <para>
   擬似ドメイン<literal>in-addr.arpa</literal>は、IPアドレスからホスト名への逆引き参照に使用されます。このドメインの前に、IPアドレスのネットワーク部分が逆順に指定されます。たとえば、<systemitem class="ipaddress">192.168</systemitem>は、<systemitem>168.192.in-addr.arpa</systemitem>に解決されます。参照先 <xref linkend="dat.arpa"/>。<indexterm> <primary>DNS</primary> <secondary>逆引き</secondary> </indexterm>
  </para>



  <example id="dat.arpa">
   <title>逆引き</title>
<screen linenumbering="numbered">1.  $TTL 2D
2.  168.192.in-addr.arpa.   IN SOA dns.example.com. root.example.com. (
3.                          2003072441      ; serial
4.                          1D              ; refresh
5.                          2H              ; retry
6.                          1W              ; expiry
7.                          2D )            ; minimum
8.
9.                          IN NS           dns.example.com.
10. 
11. 1.5                     IN PTR          gate.example.com. 
12. 100.3                   IN PTR          www.example.com. 
13. 253.2                   IN PTR          cups.example.com. </screen>
  </example>

  <variablelist>
   <varlistentry>
    <term>1行目:</term>
    <listitem>
     <para>
      $TTLは、このファイルのすべてのエントリに適用される標準のTTLです。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>2行目:</term>
    <listitem>
     <para>

      この設定ファイルは、ネットワーク<systemitem class="ipaddress">192.168</systemitem>の逆引きを有効にします。ゾーン名は<systemitem>168.192.in-addr.arpa</systemitem>であり、これはホスト名に追加しません。そのため、すべてのホスト名はドメインの最後に「<literal>.</literal>」を付けた完全形式で入力します。残りのエントリは、前出の<systemitem>example.com</systemitem>の例の記述と同じです。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>3～7行目:</term>
    <listitem>
     <para>
      前出の例の<systemitem>example.com</systemitem>を参照してください。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>9行目:</term>
    <listitem>
     <para>
      正引きの場合と同様、この行は、このゾーンを担当するネームサーバを指定します。ただし、ホスト名はドメインと末尾の<literal>「.」</literal>(ピリオド)が付いた完全な形で指定されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>11～13行目:</term>
    <listitem>
     <para>
      これらはそれぞれのホスト上でのIPアドレスを示すポインタレコードです。IPアドレスの最後の部分のみが、行の最初に入力され、末尾に<literal>「.」</literal>(ピリオド)は付きません。ゾーンをこれに追加すると(<systemitem>.in-addr.arpa</systemitem>を付けずに)、完全なIPアドレスが逆順で生成されます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   通常、ゾーン転送は、異なるバージョンのBIND間でも問題なく行えるはずです。<indexterm class="endofrange" startref="idx.DNS_BIND"/><indexterm class="endofrange" startref="idx.BIND"/><indexterm class="endofrange" startref="idx.configuration_files_named.conf"/>

  </para>
 </sect1>

 <sect1 id="sec.dns.dynupdate">
  <title>ゾーンデータの動的アップデート</title>

  <para>
   動的アップデート<emphasis>という用語は、マスタサーバのゾーンファイル内のエントリが追加、変更、削除される操作を指します。</emphasis>この仕組みは、RFC 2136に記述されています。動的アップデートをゾーンごとに個別に構成するには、オプションの<systemitem>allow-update</systemitem>ルールまたは<systemitem>update-policy</systemitem>ルールを追加します。動的に更新されるゾーンを手動で編集してはなりません。
  </para>

  <para>
   サーバに更新エントリを転送するには、<command>nsupdate</command>コマンドを使用します。このコマンドの詳細な構文については、nsupdateのマニュアルページ(<command>man</command><option>8 nsupdate</option>)を参照してください。セキュリティ上の理由から、こうした更新はTSIGキーを使用して実行するようにしてください(<xref linkend="sec.dns.tsig"/>参照)。
  </para>
 </sect1>
 <sect1 id="sec.dns.tsig">
  <title>安全なトランザクション</title>

  <para>
   安全なトランザクションは、共有秘密キー(TSIGキーとも呼ばれる)に基づくトランザクション署名(TSIG)を使用して実現できます。ここでは、このキーの生成方法と使用方法について説明します。
  </para>

  <para>
   安全なトランザクションは、異なるサーバ間の通信、およびゾーンデータの動的アップデートに必要です。アクセス制御をキーに依存する方が、単にIPアドレスに依存するよりもはるかに安全です。
  </para>

  <para>
   TSIGキーの生成には、次のコマンドを使用します(詳細については、<command>man</command><option>dnssec-keygen</option>を参照)。
  </para>

<screen>dnssec-keygen -a hmac-md5 -b 128 -n HOST host1-host2</screen>

  <para>
   これにより、次のような形式の名前を持つファイルが2つ作成されます。
  </para>

<screen>Khost1-host2.+157+34265.private Khost1-host2.+157+34265.key</screen>

  <para>
   キー自体(<literal>ejIkuCyyGJwwuN3xAteKgg==</literal>のような文字列)は、両方のファイルにあります。キーをトランザクションで使用するには、2番目のファイル(<filename>Khost1-host2.+157+34265.key</filename>)を、できれば安全な方法で(たとえばscpを使用して)、リモートホストに転送する必要があります。<filename>host1</filename>と<literal>host2</literal>の間で安全な通信ができるようにするには、リモートサーバでキーを<literal>/etc/named.conf</literal>ファイルに含める必要があります。
  </para>

<screen>key host1-host2 {
 algorithm hmac-md5;
 secret "ejIkuCyyGJwwuN3xAteKgg==";
};</screen>

  <warning>
   <title>/etc/named.conf<filename>のファイルパーミッション</filename></title>
   <para>
    /etc/named.conf<filename>のファイルパーミッションが適切に制限されていることを確認してください。</filename>このファイルのデフォルトのパーミッションは<literal>0640</literal>で、オーナーが<systemitem class="username">root</systemitem>、グループが<systemitem class="username">named</systemitem>です。この代わりに、パーミッションが制限された別ファイルにキーを移動して、そのファイルを<filename>/etc/named.conf</filename>内にインクルードすることもできます。外部ファイルをインクルードするには、次のようにします。
   </para>
<screen>include  "filename"</screen>
   <para>
    ここで、<option>filename</option>には、キーを持つファイルへの絶対パスを指定します。
   </para>
  </warning>

  <para>





   サーバ<literal>host1</literal>が<literal>host2</literal>(この例では、アドレス<literal>10.1.2.3</literal>)のキーを使用できるようにするには、host1の<filename>/etc/named.conf</filename>に次の規則が含まれている必要があります。
  </para>

<screen>server 10.1.2.3 {
  keys { host1-host2. ;};
};</screen>

  <para>
   同様のエントリが<literal>host2</literal>の設定ファイルにも含まれている必要があります。
  </para>

  <para>
   IPアドレスとアドレス範囲に対して定義されているすべてのACL (アクセス制御リスト―ACLファイルシステムと混同しないこと)にTSIGキーを追加してトランザクションセキュリティを有効にします。対応するエントリは、次のようになります。
  </para>

<screen>allow-update { key host1-host2. ;};</screen>

  <para>
   このトピックについての詳細は、<literal>update-policy</literal>の下の『<emphasis>BIND Administrator Reference Manual</emphasis>』を参照してください。
  </para>
 </sect1>
 <sect1 id="sec.dns.dnssec">
  <title>DNSセキュリティ</title>

  <para>
   DNSSEC、すなわちDNSセキュリティは、RFC2535に記述されています。DNSSECに利用できるツールについては、BINDのマニュアルを参照してください。
  </para>

  <para>
   ゾーンが安全だといえるためには、1つ以上のゾーンキーが関連付けられている必要があります。キーはホストキーと同様、<command>dnssec-keygen</command>によって生成されます。現在、これらのキーの生成には、DSA暗号化アルゴリズムが使用されています。生成されたパブリックキーは、<systemitem>$INCLUDE</systemitem>ルールによって、対応するゾーンファイルにインクルードします。
  </para>

  <para>
   <command>dnssec-signzone</command>コマンドを使用すると、生成されたキーのセット(<literal>keyset-</literal>ファイル)を作成し、それらを安全な方法で親ゾーンに転送し、署名することができます。これによって、<filename>/etc/named.conf</filename>内のゾーンごとにインクルードするファイルが生成されます。
  </para>


 </sect1>
 <sect1 id="sec.dns.info">
  <title>その他の情報</title>

  <para>
   ここで扱ったトピックの詳細については、<emphasis>/usr/share/doc/packages/bind/</emphasis>ディレクトリにインストールされる<systemitem class="resource">bind-doc</systemitem>パッケージ内の『<filename>BIND Administrator Reference Manual</filename>』を参照してください。BINDに付属のマニュアルやマニュアルページで紹介されているRFCも、必要に応じて参照してください。<filename>/usr/share/doc/packages/bind/README.SUSE</filename>には、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>のBINDに関する最新情報が含まれています。
  </para>
 </sect1>
</chapter>
