<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="lvm.xml" id="sec.yast2.system.lvm">
 <title>LVM 組態</title><indexterm> <primary>YaST</primary><secondary>LVM</secondary></indexterm><indexterm><primary>LVM</primary><secondary>YaST</secondary></indexterm><indexterm><primary>邏輯磁碟區管理員</primary><see>LVM</see></indexterm>

 <para>
  本節概述了邏輯磁碟區管理員 (LVM) 背後的原則及其多功能特性。在 <xref linkend="sec.yast2.system.lvm.yast"/> 中，學習如何使用 YaST 設定 LVM。
 </para>

 <warning>
  <para>
   使用 LVM 有時會增加風險，如遺失資料。這些危險也包括應用程式當機、電源中斷和錯誤指令。執行 LVM 或重新設定磁碟區前，請儲存您的資料。決不要在沒有備份的情形下工作。
  </para>
 </warning>

 <sect2 id="sec.yast2.system.lvm.explained">
  <title>邏輯磁碟區管理</title>
  <para>
   LVM 可以在數個檔案系統上彈性地散佈硬碟空間。啟始分割完成後，有時需要變更硬碟空間的分割，因此開發了此工具。因為要修改執行系統上的分割區很困難，LVM 提供記憶體空間的虛擬集區 (磁碟區群組，簡稱 VG)。如有必要，可從虛擬集區建立邏輯磁碟區 (LV)。作業系統可以存取這些 LV，而不是存取實體分割區。磁碟區群組可以佔用一個以上的磁碟，因此數個磁碟或是磁碟的數個部份可能會構成一個 VG。如此，LVM 提供了一種從實體磁碟空間進行擷取的方法，允許使用比實體磁碟重新分割更為簡單和安全的方式來變更分割。您可以在 <xref linkend="sec.IB.part.typen"/> 與 <xref linkend="sec.yast2.i_y2_part_expert"/> 中找到有關實體分割的背景資訊。
  </para>
  <figure id="fig.lvm.explained.schematic">
   <title>實體分割與 LVM</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="lvm.svg" width="75%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="lvm.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   <xref linkend="fig.lvm.explained.schematic"/>比較實體分割 (左邊) 與 LVM 分割 (右邊)。在左邊，一個磁碟已分割為三個實體分割區 (PART)，每一個都指定了掛接點 (MP)，以便作業系統可以存取它們。在右邊，已經個別將兩個磁碟分割成兩個及三個實體分割區。已經定義兩個 LVM 磁碟區群組 (VG1 與 VG2)。VG 1 包含 DISK 1 的兩個磁碟區以及 DISK 2 的一個磁碟區。VG 2 包含 DISK 2 其餘的兩個磁碟區。在 LVM 中，併入一個磁碟區群組中的實體磁碟分割區稱為實體磁碟區 (PV)。在磁碟區群組中，已經定義四個 LV (LV 1 至 LV 4)。作業系統可以透過關聯的掛接點來使用它們。各 LV 之間的邊緣不需要與任何分割區的邊緣對齊。請參閱此範例中 LV 1 與 LV 2 之間的邊緣。
  </para>
  <para>
   LVM 功能：
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     數個硬碟或分割區可以在大的邏輯磁碟區結合成一個。
    </para>
   </listitem>
   <listitem>
    <para>
     如果組態適用，當可用空間耗盡時您可以增大 LV (如 <filename>/usr</filename>)。
    </para>
   </listitem>
   <listitem>
    <para>
     您可以使用 LVM 在執行的系統中新增硬碟或 LV。然而，這種作法需要熱插拔硬體。
    </para>
   </listitem>
   <listitem>
    <para>
     可以啟用「等量分割模式」，將 LV 的資料流分散至數個 PV。如果這些 PV 位於不同的磁碟上，這樣就可以改善讀寫效能，就像 RAID 0 一樣。
    </para>
   </listitem>
   <listitem>
    <para>
     快照功能能夠讓執行中系統的備份 (特別是伺服器) 保持一致。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   由於具有這些功能，LVM 適用於使用頻繁的家用個人電腦或小型伺服器。對於資料越積越多的使用者來說 (例如在資料庫、音樂歸檔或使用者目錄中)，LVM 是再適合不過的工具了。這樣能夠允許比實體硬碟還大的檔案系統。LVM 的另一個好處是最大可以增加到 256 個 LV。不過，使用 LVM 與使用傳統分割區是不同的。有關設定 LVM 的說明及詳細資訊，請參閱官方網站的 LVM HOWTO (<ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"/>)。
  </para>
  <para>
   自核心 2.6 版起就可使用 LVM 2 版本，該版 LVM 可以與之前版本的 LVM 反向相容，並可讓您繼續管理舊的磁碟區群組。建立新的磁碟區群組時，需要決定要使用新的格式還是能夠反向相容的版本。LVM 2 不需要任何核心修補程式。這會用到整合於核心 2.6 中的裝置對應程式。此核心僅支援 LVM 第 2 版。因此，提到 LVM 時，本節一律指的是 LVM 第  2 版。
  </para>
  <sect3>
   <title>簡易佈建</title>
   <para>
    從核心 3.4 版開始，LVM 均支援簡易佈建。簡易佈建的磁碟區包含虛擬容量和實際容量。<emphasis>虛擬</emphasis>容量是可供主機使用的磁碟區儲存容量。<emphasis>實際</emphasis>容量是從儲存池中配置給磁碟區副本的儲存容量。在完全配置的磁碟區中，虛擬容量和實際容量是相同的。不過，在簡易佈建的磁碟區中，虛擬容量可以比實際容量大得多。如果簡易佈建的磁碟區沒有足夠的實際容量用於寫入操作，系統會將該磁碟區置於離線狀態，並會記錄錯誤。
   </para>
   <para>
    如需更多一般資訊，請參閱 <ulink url="http://wikibon.org/wiki/v/Thin_provisioning"/>。
   </para>
  </sect3>
 </sect2>

 <sect2 id="sec.yast2.system.lvm.yast">
  <title>使用 YaST 進行 LVM 組態</title>
  <para>
   YaST LVM 組態可透過 YaST 進階磁碟分割程式 (請參閱<xref linkend="sec.yast2.i_y2_part_expert"/>) 中<guimenu>系統檢視</guimenu>窗格內的<guimenu>磁碟區管理</guimenu>項目來存取。進階磁碟分割程式可讓您編輯和刪除現有的分割區，以及建立需要與 LVM 搭配使用的新分割區。首先應建立為磁碟區群組提供空間的實體磁碟區︰
  </para>
  <procedure>
   <step performance="required">
    <para>
     從<guimenu>硬碟</guimenu>中選取一個硬碟。
    </para>
   </step>
   <step performance="required">
    <para>
     切換到<guimenu>分割區</guimenu>索引標籤。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>新增</guimenu>並輸入此磁碟上 PV 所需的大小。
    </para>
   </step>
   <step performance="required">
    <para>
     使用<guimenu>不格式化分割區</guimenu>並將<guimenu>檔案系統 ID</guimenu>變更為<guimenu>0x8E Linux LVM</guimenu>。不要掛接此分割區。
    </para>
   </step>
   <step performance="required">
    <para>
     重複此程序，直到定義了可用磁碟上所有需要的實體磁碟區為止。
    </para>
   </step>
  </procedure>
  <sect3>
   <title>建立磁碟區群組</title>
   <para>
    如果系統上沒有磁碟區群組，您必須新增一個 (請參閱<xref linkend="fig.lvm.yast.volgrp"/>)。您可以按一下<guimenu>系統檢視</guimenu>窗格中的<guimenu>磁碟區管理</guimenu>，然後按一下<guimenu>新增磁碟區群組</guimenu>建立其他群組。通常一個磁碟區群組就已足夠。
   </para>
   <procedure>
    <step performance="required">
     <para>
      為磁碟區群組輸入一個名稱，例如 <literal>system</literal>。
     </para>
    </step>
    <step performance="required">
     <para>
      選取所需的<guimenu>實體範圍大小</guimenu>。這個值定義了磁碟區群組中實體區塊的大小。在磁碟區群組中的所有磁碟空間都會以此大小的區塊來處理。
     </para>
    </step>
    <step performance="required">
     <para>
      選取裝置並按一下<guimenu>新增</guimenu>，將準備好的實體磁碟區新增至磁碟區群組。可以選取多個裝置，只要在選取裝置的同時一直按住 <keycap>Ctrl</keycap> 即可。
     </para>
    </step>
    <step performance="required">
     <para>
      選取<guimenu>完成</guimenu>，使磁碟區群組可用於後面的組態步驟。
     </para>
    </step>
   </procedure>
   <figure id="fig.lvm.yast.volgrp">
    <title>建立磁碟區群組</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    如果定義了多個磁碟區群組，並且想要新增或移除 PV，請在<guimenu>磁碟區管理</guimenu>清單中選取該磁碟區群組，然後按一下<guimenu>調整大小</guimenu>。在以下視窗中，您可以在選定的磁碟區群組中新增或移除 PV。
   </para>
  </sect3>
  <sect3>
   <title>設定邏輯磁碟區</title>
   <para>
    當磁碟區群組中分派滿了 PV 後，在下一個對話方塊中定義作業系統應該使用的 LV。選擇目前的磁碟區群組，然後切換至<guimenu>邏輯磁碟區</guimenu>索引標籤。視需要<guimenu>新增</guimenu>、<guimenu>編輯</guimenu>、<guimenu>刪除</guimenu>LV 以及<guimenu>調整</guimenu>其大小，直到磁碟區群組中的所有空間都用完為止。為每個磁碟區群組至少指定一個 LV。
   </para>
   <figure id="fig.lvm.yast.mgmt">
    <title>邏輯磁碟區管理</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    按一下<guimenu>新增</guimenu>，然後在開啟的類似於精靈的快顯視窗中進行設定︰
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      輸入 LV 名稱。對於應掛接至 <filename>/home</filename> 的分割區，可以使用描述性名稱，如 <literal>HOME</literal>。
     </para>
    </listitem>
    <listitem>
     <para>
      選取 LV 的類型。可以是<guimenu>一般磁碟區</guimenu>、<guimenu>簡易池</guimenu>或<guimenu>簡易磁碟區</guimenu>。請注意，您首先需要建立簡易池，可用於儲存個別簡易磁碟區。
     </para>
    </listitem>
    <listitem>
     <para>
      選取 LV 的大小與等量磁碟區數量。如果只有一個 PV，則選取多個等量磁碟區毫無意義。
     </para>
     <tip>
      <para>
       簡易佈建的一大優勢在於儲存在簡易池中的所有簡易磁碟區的大小總和可以超過池本身的大小。
      </para>
     </tip>
    </listitem>
    <listitem>
     <para>
      選擇要在 LV 上使用的檔案系統以及掛接點。
     </para>
    </listitem>
   </orderedlist>
   <para>
    使用等量磁碟區可以在 LV 中跨多個 PV (等量) 分散資料流。但是，等量磁碟區操作只能在數個不同的 PV 上進行，每個 PV 至少需提供該磁碟區大小的空間。最大等量磁碟區數量等於 PV 的數量，其中等量磁碟區「1」表示「無等量磁碟區」。僅當 PV 分佈在數個不同硬碟上時，等量磁碟區操作才有意義，若非如此，效能將會降低。
   </para>
   <warning>
    <title>等量磁區</title>
    <para>
     YaST 在此時無法驗證您輸入之分割的正確性。在此所犯的錯誤只有稍後在磁碟上執行 LVM 時才會顯示出來。
    </para>
   </warning>
   <para>
    如果已經在系統上設定 LVM，還可以使用現有的邏輯磁碟區。在繼續前，請為這些邏輯磁碟區指定適當的掛接點。按一下<guimenu>完成</guimenu>返回 YaST 進階磁碟分割程式，然後於該處完成您的工作。
   </para>
  </sect3>
 </sect2>


</sect1>
