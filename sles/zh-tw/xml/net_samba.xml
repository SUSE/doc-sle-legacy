<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE chapter
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="net_samba.xml" xml:id="cha-samba"><title>Samba</title><info><abstract>
  <para>
   使用 Samba 可以將 Unix 機器設定為 Mac OS X、Windows 以及 OS/2 機器的檔案與列印伺服器。Samba 已經是一個開發至完全成熟且相當複雜的產品。使用 YaST、SWAT (一種 Web 介面) 設定 Samba，或透過手動編輯組態檔的方式設定。
  </para>
 </abstract></info>
 <indexterm xml:id="idx-Samba" class="startofrange"> <primary>Samba</primary> </indexterm> <indexterm> <primary>SMB</primary> <see>Samba</see> </indexterm> <indexterm> <primary>Mac OS X</primary> <secondary>共享檔案</secondary> </indexterm> <indexterm> <primary>Windows</primary> <secondary>共享檔案</secondary> </indexterm> <indexterm> <primary>OS/2</primary> <secondary>共享檔案</secondary> </indexterm> <indexterm> <primary>Linux</primary> <secondary>與另一個 OS 共享檔案</secondary> </indexterm>
 
 <section xml:id="sec-samba-term">
  <title>術語</title>

  <para>
   下列為 Samba 文件和 YaST 模組中常用的詞彙。
  </para>

  <variablelist>
   <varlistentry>
    <term>SMB 通訊協定</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>SMB</secondary> </indexterm> <indexterm> <primary>通訊協定</primary> <secondary>SMB</secondary> </indexterm> <indexterm> <primary>smbd</primary> </indexterm>Samba 使用基於 <phrase role="productname">NetBIOS</phrase> 服務的 SMB (伺服器訊息區塊) 通訊協定。由於 Microsoft 發行了此通訊協定，因此其他的軟體製造商可以建立連接至 Microsoft 網域網路的連接。使用 Samba，SMB 通訊協定就可以在 TCP/IP 通訊協定上運作，因此 TCP/IP 通訊協定必須安裝在所有的用戶端上。<indexterm> <primary>Samba</primary> <secondary>TCP/IP 與</secondary> </indexterm>
     </para>
     <tip arch="zseries" os="sles">
      <title>IBM System z：NetBIOS 支援</title>
      <para>
       IBM System z 僅支援經由 TCP/IP 的 SMB。在這些系統上不提供 NetBIOS 支援。
      </para>
     </tip>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CIFS 通訊協定</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>CIFS</secondary></indexterm><indexterm><primary>通訊協定</primary><secondary>CIFS</secondary></indexterm>CIFS (一般網際網路檔案系統) 通訊協定是 Samba 所支援的另一種通訊協定。CIFS 定義用於網路上的標準遠端檔案系統存取通訊協定，讓使用者群組可以透過網路分工合作和共享文件。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS<indexterm> <primary>Samba</primary> <secondary>名稱</secondary> </indexterm></term>
    <listitem>
     <para>
      <indexterm> <primary>NetBIOS</primary> </indexterm>NetBIOS 是用來在提供名稱服務的機器之間進行通訊的軟體介面 (API)。它允許連接至網路的機器保留自己的名稱。在保留後，就可以使用名稱來定址這些機器。在此沒有檢查名稱的中央程序。在網路上的任何機器都可以保留它所需的任何數量名稱，只要這些名稱尚未使用。可以針對不同的網路結構實作 NetBIOS 介面。有一個與網路硬體一起緊密運作的執行程序，稱為 <phrase role="productname">NetBEUI</phrase>，不過這通常稱為 <phrase role="productname">NetBIOS</phrase>。與 NetBIOS 一起執行的網路通訊協定是 Novell 的 IPX (經由 TCP/IP 的 NetBIOS) 與 TCP/IP。
     </para>
     <para>
      經由 TCP/IP 所傳送的 NetBIOS 名稱，與 <filename>/etc/hosts</filename> 中所使用的名稱，或由 DNS 所定義的名稱完全不相同。NetBIOS 使用自己完全獨立的命名慣例。不過，一般建議使用與 DNS 主機名稱相對應的名稱，如此可使管理較為輕鬆，或者可本地使用 DNS。Samba 預設是使用此對應名稱。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba 伺服器<indexterm> <primary>Samba</primary> <secondary>伺服器</secondary> </indexterm></term>
    <listitem>
     <para>
      Samba 伺服器可為用戶端提供 SMB/CIFS 服務和 NetBIOS over IP 命名服務。對於 Linux 系統，Samba 伺服器有三種精靈可用：smbd (用於 SMB/CIFS 服務)、nmbd (用於命名服務) 及 winbind (用於驗証)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba 用戶端<indexterm xml:id="idx-Samba-clients" class="startofrange"> <primary>Samba</primary> <secondary>用戶端</secondary> </indexterm></term>
    <listitem>
     <para>
      Samba 用戶端是透過 SMB 通訊協定，使用 Samba 伺服器所提供之 Samba 服務的系統。所有一般的作業系統 (例如 Mac OS X、Windows 以及 OS/2) 都支援 SMB 通訊協定。TCP/IP 通訊協定必須安裝在所有的電腦上。Samba 提供適用於不同 UNIX 類別的用戶端。就 Linux 而言，有一個 SMB 的核心模組，允許在 Linux 系統層級上整合 SMB 資源。您不必為 Samba 用戶端執行任何精靈。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>共享</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>共享</secondary> </indexterm>SMB 伺服器透過共享方式向用戶端提供資源。共享是指印表機和位在伺服器上的目錄及其子目錄。它是利用名稱來輸出，並且可藉由其名稱來存取。共用名稱可以設成任何名稱 它並不需要是輸出目錄的名稱。也會指定一個名稱給印表機。用戶端可以透過其名稱存取印表機。<indexterm><primary>列印</primary><secondary>Samba</secondary></indexterm><indexterm><primary> Samba</primary><secondary>印表機</secondary></indexterm><indexterm class="endofrange" startref="idx-Samba-clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>DC</secondary> </indexterm>領域控制器 (DC) 是處理網域中帳戶的伺服器。進行資料複製時，可在一個網域中使用其他領域控制器。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 
 <section xml:id="sec-samba-serv-start" os="osuse;sles">
  <title>啟動和停止 Samba</title>

  <para>
   您可以在開機時自動啟動 Samba 伺服器，也可以手動啟動或停止。啟動和停止原則是 YaST Samba 伺服器組態的一部分 (如 <xref linkend="sec-samba-yast2-conf"/> 所述)。
  </para>

  <para>
   若要使用 YaST 停止或啟動執行中的 Samba 服務，請使用<menuchoice><guimenu>系統</guimenu> <guimenu>系統服務 (執行層級)</guimenu></menuchoice>，然後檢查 winbind、smb 與 nmb。在指令行中使用 <command>rcsmb stop &amp;&amp; rcnmb stop</command> 可停止 Samba 所需的服務，使用 <command>rcnmb start &amp;&amp; rcsmb start</command> 可啟動這些服務；必要時，rcsmb 會參考 winbind 的結果。
  </para><indexterm> <primary>Samba</primary> <secondary>啟動</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>停止</secondary> </indexterm>
 </section>
 <section xml:id="sec-samba-serv-inst">
  <title>設定 Samba 伺服器</title><indexterm> <primary>Samba</primary><secondary>安裝</secondary></indexterm><indexterm><primary>Samba</primary><secondary>伺服器</secondary></indexterm><indexterm><primary>Samba</primary><secondary>設定</secondary></indexterm><indexterm><primary>設定</primary><secondary>Samba </secondary></indexterm>

  <para os="osuse;sles">
   <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 中的 Samba 伺服器可以兩種方式設定：使用 YaST 設定或手動設定。手動設定組態可以提供較詳細的設定，但是缺乏 YaST GUI 提供的方便性。
  </para>

  

  <section xml:id="sec-samba-yast2-conf" os="osuse;sles">
   <title>使用 YaST 設定 Samba 伺服器</title>
   <para>
    若要設定 Samba 伺服器，請啟動 YaST 並選取<menuchoice><guimenu>網路服務</guimenu> <guimenu>Samba 伺服器</guimenu></menuchoice>。
   </para>
   <section xml:id="sec-samba-yast2-conf-inst">
    <title>初始的 Samba 組態</title>
    <para>
     第一次啟動模組時，系統會啟動<guimenu>Samba 安裝</guimenu>對話方塊，提示您對伺服器管理進行一些基本設定。組態設定結束時，系統會提示您輸入 Samba 管理員密碼 (<guimenu>Samba root 使用者密碼</guimenu>)。之後再啟動該模組時，會顯示<guimenu>Samba 組態</guimenu>對話方塊。
    </para>
    <para>
     <guimenu>Samba 安裝</guimenu>對話方塊包含兩個步驟與一些選擇性的詳細設定：
    </para>
    <variablelist>
     <varlistentry>
      <term>工作群組或網域名稱</term>
      <listitem>
       <para>
        在 <guimenu>工作群組或網域名稱</guimenu> 中選取現有的名稱，或輸入新的名稱，並按一下 <guimenu>下一步</guimenu>。
       </para>

      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba 伺服器類型</term>
      <listitem>
       <para>
        在下一步中，指定伺服器是應該做為主要網域控制器 (PDC)、備份網域控制器 (BDC) 還是根本不做為網域控制器。伺服器預設未設定為網域控制器。按<guimenu>下一步</guimenu>繼續。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     如果不想繼續設定伺服器的詳細組態，請按一下<guimenu>確定</guimenu>確認。然後，在最後一個快顯方塊中設定<guimenu>Samba root 使用者密碼</guimenu>。
    </para>
    <para>
     之後可在<guimenu>Samba 組態</guimenu>對話方塊的<guimenu>啟動</guimenu>、<guimenu>共享</guimenu>、<guimenu>身分</guimenu>、<guimenu>信任的網域</guimenu>與<guimenu>LDAP 設定</guimenu>索引標籤中變更所有設定。
    </para>
   </section>
   <section xml:id="sec-samba-yast2-conf-adv">
    <title>進階 Samba 組態</title>
    <para>
     第一次啟動 Samba 伺服器模組時，執行<xref linkend="sec-samba-yast2-conf-inst"/> 中所述的兩個初始步驟後，<guimenu>Samba 組態</guimenu>對話方塊會直接顯示。用此調整您的 Samba 伺服器組態。
    </para>
    <para>
     編輯組態後，按一下<guimenu>確定</guimenu>儲存設定。
    </para>
    <section>
     <title>啟動伺服器</title>
     <para>
      在<guimenu>啟動</guimenu>索引標籤中，設定 Samba 伺服器的啟動。若每次系統開機時都要啟動服務，請選取<guimenu>開機時</guimenu>。若要啟用手動啟動，請選擇<guimenu>手動</guimenu>。如需有關啟動 Samba 伺服器的詳細資訊，請參閱<xref linkend="sec-samba-serv-start"/>。
     </para>
     <para>
      在此索引標籤中，您也可以開啟您的防火牆中的連接埠。若要執行此動作，請選取<guimenu>在防火牆中開啟埠</guimenu>。如果您有多個網路介面，請按一下<guimenu>防火牆詳細資訊</guimenu>，選取介面，並按一下<guimenu>確定</guimenu>來選取 Samba 服務的網路介面。
     </para>

    </section>
    <section>
     <title>共享</title>
     <para>
      在<guimenu>共享</guimenu>索引標籤中，決定要啟用的 Samba 共享。標籤中有一些預先定義的共同，如 home 和 printer。使用<guimenu>切換狀態</guimenu>以切換<guimenu>作用中</guimenu>與<guimenu>非作用中</guimenu>。按一下<guimenu>新增</guimenu>可新增新的共享，按一下<guimenu>刪除</guimenu>可刪除選取的共享。
     </para>

     <para>
      <guimenu>允許使用者共享自己的目錄</guimenu>讓<guimenu>許可的群組</guimenu>中的群組成員能與其他使用者共享自己的目錄。例如：<systemitem>users</systemitem> 針對本地範圍，<systemitem>DOMAIN\Users</systemitem> 針對網域範圍。使用者還必須確定檔案系統的許可權允許存取。請使用<guimenu>最多共享數</guimenu>限制可建立的共享總數。若要允許在沒有驗證的情況下存取使用者共享，請啟用<guimenu>允許訪客存取</guimenu>。

     </para>
    </section>
    <section>
     <title>識別</title>
     <para>
      在<guimenu>身分</guimenu>索引標籤中，您可以決定主機關聯的網域 (<guimenu>基本設定</guimenu>)，以及是否要在網路中使用替代的主機名稱 (<guimenu>NetBIOS 主機名稱</guimenu>)。也可以使用 Microsoft Windows 網際網路名稱服務 (WINS) 進行名稱解析。在這種情況下，請啟用<guimenu>使用 WINS 解析主機名稱</guimenu>，並決定是否<guimenu>透過 DHCP 取回 WINS 伺服器</guimenu>。若要設定進階全域設定或使用者驗證來源<phrase os="sles"> (例如 LDAP 而非 TDB 資料庫)</phrase>，請按一下<guimenu>進階設定</guimenu>。

     </para>

    </section>
    <section>
     <title>信任的網域</title>
     <para>
      若要讓其他網域的使用者存取您的網域，請在<guimenu>信任的網域</guimenu>索引標籤中進行適當的設定。若要新增網域，請按一下<guimenu>新增</guimenu>。若要移除所選網域，請按一下<guimenu>移除</guimenu>。
     </para>
    </section>
    <section>
     <title>LDAP 設定</title>
     <para>
      在索引標籤<guimenu>LDAP 設定</guimenu>中，您可決定 LDAP 伺服器是否使用驗證。若要測試 LDAP 伺服器的連接，請按一下<guimenu>測試連接</guimenu>。若要查看進階 LDAP 設定或使用者預設值，請按一下 <guimenu>進階設定</guimenu>。
     </para>
     <para>
      如需 LDAP 組態的詳細資訊，請參閱<xref linkend="cha-security-ldap"/>。
     </para>
    </section>
   </section>
  </section>

  <section xml:id="sec-samba-serv-inst-swat" os="osuse;sles">
   <title>使用 SWAT 管理網頁</title>
   <para>
    <indexterm><primary>Samba</primary><secondary>swat</secondary></indexterm><indexterm><primary>組態檔</primary><secondary>samba</secondary></indexterm><indexterm><primary>組態檔</primary><secondary>服務 </secondary></indexterm>另一種管理 Samba 伺服器的工具是 SWAT (Samba Web Administration Tool，Samba 網頁管理工具)。它提供簡單的網頁介面，以用於設定 Samba 伺服器。若要使用 SWAT，請在網頁瀏覽器中開啟 <link xlink:href="http://localhost:901"/>，並以 <systemitem class="username">root</systemitem> 使用者的身分登入。如果您沒有特殊的 Samba root 帳戶，請使用系統的 <systemitem class="username">root</systemitem> 帳戶。
   </para>
   <note>
    <title>啟用 SWAT</title>
    <para>
     安裝 Samba 伺服器後，並不會啟用 SWAT。若要啟動 SWAT，請在 YaST 中開啟 <menuchoice><guimenu>網路服務</guimenu><guimenu>網路服務 (xinetd)</guimenu></menuchoice>，啟用網路服務組態，選取表格中的 <guimenu>swat</guimenu>，並按一下 <guimenu>切換狀態 (開啟或關閉)</guimenu>。
    </para>
   </note>
  </section>

  <section xml:id="sec-samba-serv-inst-manual" os="osuse;sles">
   <title>手動設定伺服器</title>
   <para>
    <indexterm><primary>Samba</primary><secondary>設定</secondary></indexterm><indexterm><primary>設定</primary><secondary>Samba</secondary></indexterm><indexterm> <primary>組態檔</primary><secondary>smb.conf</secondary></indexterm>如果您想要使用 Samba 做為伺服器，請安裝 <systemitem class="resource">samba</systemitem>。Samba 的主要組態檔為 <filename>/etc/samba/smb.conf</filename>。這個檔案可以分成兩個邏輯部份。<literal>[global]</literal> 區段包含中央與全域設定值。<literal>[share]</literal> 區段包含個別檔案與印表機共享。利用此方法，就可以在 <literal>[global]</literal> 區段中以不同的方式或以全域方式設定關於共享的細節，它可以加強組態檔的結構透明化。
   </para>
   <section xml:id="sec-samba-smb-conf-Erlaeuterung">
    <title>全域區段</title>
    <para>
     下列 <literal>[global]</literal> 區段的參數需要做一些調整，以符合網路設定的需求，讓其他機器可以透過 Windows 環境中的 SMB 存取 Samba 伺服器。
    </para>
    
    <variablelist>
     <varlistentry>
      <term><literal>workgroup = TUX-NET</literal>
      </term>
      <listitem>
       <para>
        這一行是將 Samba 伺服器指定給工作群組。以網路環境中適當的工作群組取代 <literal>TUX-NET</literal>。Samba 伺服器會以其 DNS 名稱顯示，除非此名稱已指定給網路中的其他機器。如果沒有可用的 DNS 名稱，請使用 <literal><replaceable>netbiosname=MYNAME</replaceable></literal> 設定伺服器名稱。如需更多有關此參數的詳細資料，請參閱 <systemitem>smb.conf</systemitem> man 頁面。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>os level = 20</literal>
      </term>
      <listitem>
       <para>
        此參數會觸發 Samba 伺服器是否嘗試變成其工作群組的 LMB (本地主要的瀏覽器)。對於 Samba 3 版本系列，通常不需要覆寫預設設定 (<literal>20</literal>)。選擇一個極小值 (例如 <literal>2</literal>) 可以讓現有的 Winodws 網路免受因 Samba 伺服器設定不當而造成的任何干擾。有關此重要主題的詳細資訊，可參閱《Samba 3 Howto》中的「Network Browsing」(網路瀏覽) 一章；如需有關《Samba 3 Howto》的詳細資訊，請參閱<xref linkend="sec-samba-info"/>。
       </para>
       <para>
        如果網路中沒有其他的 SMB 伺服器 (例如，Windows 2000 伺服器)，而且您希望 Samba 伺服器保留本地環境中存在的所有系統的清單，請將 <literal>os level</literal> 設成更高的值 (例如，<literal>65</literal>)。接著就會將 Samba 伺服器選擇成本地網路的 LMB。
       </para>
       <para>
        當變更此設定值時，請小心地考慮這個值將會如何影響現有的 Windows 網路環境。首先請在獨立的網路中或在一天中非重要的時間測試變更。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>wins support</literal> 與 <literal>wins server</literal>
      </term>
      <listitem>
       <para>
        若要將 Samba 伺服器整合至含有主動 WINS 伺服器的現有 Windows 網路中，請啟用 <option>wins server</option> 選項，並將其值設為該 WINS 伺服器的 IP 位址。
       </para>
       <para>
        如果您的數台 Windows 機器連接至不同的子網路，但仍然需要看到彼此，則您需要設定 WINS 伺服器。若要將 Samba 伺服器變成像這樣的 WINS 伺服器，請設定 <literal>wins support = Yes</literal> 選項。請確定網路中只有一個 Samba 伺服器啟用了這個設定值。<literal>wins server</literal> 與 <literal>wins support</literal> 選項絕不能在 <filename>smb.conf</filename> 檔案中同時啟用。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="sec-samba-smb-conf-shares">
    <title>共享</title><indexterm> <primary>Samba</primary> <secondary>共享</secondary> </indexterm>
    <para>
     下列範例說明如何將 CD-ROM 光碟機與使用者目錄 (<literal>homes</literal>) 開放給 SMB 用戶端使用。
    </para>
    <variablelist>
     <varlistentry>
      <term>[cdrom]</term>
      <listitem>
       <para>
        若要避免不小心將 CD-ROM 光碟機開放成共享，請以備註符號停用這些行 (在此例中為分號)。請在第一個資料欄中移除分號，以便和 Samba 共享 CD-ROM 光碟機。
       </para>
       <example xml:id="dat-cd-rom">
        <title>CD-ROM 共享(已停用)</title>
<screen>;[cdrom]
;       comment = Linux CD-ROM
;       path = /media/cdrom
;       locking = No</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term><option>[cdrom]</option> and <option>comment</option>
         </term>
         <listitem>
          <para>
           <literal>[cdrom]</literal> 區段項目是網路上所有 SMB 用戶端都可以看到之共享的名稱。可以另外再加入一個 <literal>comment</literal>，以進一步描述共享。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>path = /media/cdrom</option>
         </term>
         <listitem>
          <para>
           <option>path</option> 會輸出 <filename>/media/cdrom</filename> 目錄。
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
       <para>
        利用限制非常嚴格的預設組態，就可以將這種共享只開放給出現在此系統上的使用者共享。如果這個共享應該開放每個人使用，請將 <literal>guest ok = yes</literal> 加入組態。這個設定值可以將讀取權限開放給網路上的每個人使用。建議您處理此參數時必須極為小心。這將會在 <literal>[global]</literal> 區段中套用更多此參數的使用。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><option>[homes]</option>
      </term>
      <listitem>
       <para>
        <option>[homes]</option> 共享在這裡特別重要。如果使用者擁有 Linux 檔案伺服器以及其自己主目錄的有效帳戶與密碼，就可以連接到主目錄。
       </para>
       <example xml:id="dat-homes-frei">
        <title>[homes] 共享</title>
<screen>[homes]
	comment = Home Directories
	valid users = %S
	browseable = No
	read only = No
	create mask = 0640
	directory mask = 0750</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term>[homes]</term>
         <listitem>
          <para>
           只要沒有其他的共享，使用共享的使用者名稱連接至 SMB 伺服器，就會使用 <literal>[homes]</literal> 共享指示來動態產生共享。共享的產生名稱是使用者名稱。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>valid users = %S</option>
         </term>
         <listitem>
          <para>
           只要成功地建立連接，就會以共享的具體名稱取代 <literal>%S</literal>。<option>[homes]</option> 共享，永遠為使用者名稱。因此，對使用者共享的存取權限僅限於該使用者。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>browseable = No</option>
         </term>
         <listitem>
          <para>
           這個設定值讓共享在網路環境變成無形的。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>read only = No</option>
         </term>
         <listitem>
          <para>
           根據預設，Samba 會利用 <literal>read only = Yes</literal> 參數，以禁止寫入任何輸出共享的權限。若要開放共享為可寫入的，請設定 <literal>read only = No</literal> 的值，這與 <literal>writable = Yes</literal> 同義。
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>create mask = 0640</option>
         </term>
         <listitem>
          <para>
           以 MS Windows NT 為基礎的系統將無法理解 UNIX 權限的概念，因此在建立檔案時，它們將無法指定權限。<literal>create mask</literal> 參數可以定義指定給新建立檔案的存取權限。這只會套用至可寫入的共享。實際上，這個設定值表示擁有者具有讀取與寫入權限，而擁有者的主要群組成員則具有讀取權限。<option>valid users = %S</option> 可以在即使群組具有讀取權限時禁止讀取權限。若想要使群組具有讀取或寫入權限，請停用 <option>valid users = %S</option> 一行。
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="sec-samba-rechte">
    <title>安全性層級</title><indexterm xml:id="idx-Samba-security" class="startofrange"> <primary>Samba</primary><secondary>安全性</secondary></indexterm><indexterm><primary>安全性</primary><secondary>Samba</secondary> </indexterm><indexterm><primary>Samba</primary><secondary>權限</secondary></indexterm>
    <para>
     為了提高安全性，每個共享存取權都以密碼保護。SMB 提供下列幾種權限檢查方式︰
    </para>
    <variablelist>
     <varlistentry>
      <term>共享層級安全性 (<literal>安全性 = 共享</literal>)</term>
      <listitem>
       <para>
        每個共享都必須指定密碼。每個知道此密碼的人員都具有該共享的存取權。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>使用者層級安全性 (<literal>安全性 = 使用者</literal>)</term>
      <listitem>
       <para>
        此變體在 SMB 中引入了使用者概念。每個使用者都必須以自己的密碼註冊伺服器。在註冊後，伺服器可以視使用者名稱將存取權授予個別輸出的共享。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>伺服器層級安全性 (<literal>安全性 = 伺服器</literal>)</term>
      <listitem>
       <para>
        對其用戶端而言，Samba 會模擬在使用者層級模式中工作。不過，它會將所有的密碼查詢傳遞給另一個將會處理驗證的使用者層級模式伺服器。此設定需要用到另一個<option>密碼伺服器</option>參數。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ADS 層級安全性 (<literal>安全性 = ADS</literal>)</term>
      <listitem>
       <para>
        在這種模式下，Samba 在 Active Directory 環境中以網域成員的身分執行。要以此模式作業，執行 Samba 的機器需要安裝與設定 Kerberos。您必須讓使用 Samba 的機器加入 ADS 領域。可使用 YaST 的 <guimenu>Windows 網域成員</guimenu>模組完成此操作。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>網域層級安全性 (<literal>安全性 = 網域</literal>)</term>
      <listitem>
       <para>
        僅在機器已加入到 Windows NT 網域時，此模式才會正常工作。Samba 將嘗試驗證使用者名稱與密碼，方法是將其傳送至 Windows NT 主網域或備份網域控制器。這與 Windows NT 伺服器用來驗證的方法相同。需要將加密密碼參數設定為 <literal>yes</literal>。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     共享、使用者、伺服器或網域層級安全性的選項會套用至整部伺服器。因為無法針對伺服器組態的個別共享提供共享層級的安全性，並針對其他的共享提供使用者層級的安全性。然而，您可以針對系統上每個設定的 IP 位址執行個別的 Samba 伺服器。
    </para>
    <para>
     在《Samba 3 HOWTO》中可以找到關於此主題的詳細資訊。至於在一個系統上的多個伺服器，請注意 <option>interfaces</option> 與 <option>bind interfaces only</option> 選項。
    </para><indexterm class="endofrange" startref="idx-Samba-security"/>
   </section>
  </section>
 </section>
 <section xml:id="sec-samba-client-inst">
  <title>設定用戶端</title><indexterm> <primary>Samba</primary> <secondary>用戶端</secondary> </indexterm>

  <para>
   用戶端只能透過 TCP/IP 存取 Samba 伺服器。NetBEUI 與透過 IPX 的 NetBIOS 無法與 Samba 一起使用。
  </para>

  <section xml:id="sec-samba-client-inst-yast">
   <title>使用 YaST 設定 Samba 用戶端</title><indexterm> <primary>YaST</primary> <secondary>Samba</secondary> <tertiary>用戶端</tertiary> </indexterm> <indexterm> <primary>Samba</primary><secondary>用戶端</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>Samba</secondary> <tertiary>用戶端</tertiary> </indexterm>
   <para>
    設定 Samba 用戶端以存取 Samba 或 Windows 伺服器上的資源 (檔案或印表機)。在<menuchoice><guimenu>網路服務</guimenu><guimenu>Windows 網域成員</guimenu></menuchoice>對話方塊中輸入 NT 或 Active Directory 網域或工作群組。如果您啟用了<guimenu>Linux 驗證也使用 SMB 資訊</guimenu>，則使用者驗證將會在 Samba、NT 或 Kerberos 伺服器上執行。
   </para>

   <para>
    按一下<guimenu>進階設定</guimenu>可以指定進階組態選項。例如，使用<guimenu>安裝伺服器目錄</guimenu>表格可設定在驗證時自動掛接伺服器主目錄。這樣，當使用者的主目錄在 CIFS 上託管時，他們便可以存取這些目錄。如需詳細資料，請參閱 <systemitem>pam_mount</systemitem> man 頁面。
   </para>
   <para>
    完成所有設定之後，在對話方塊中進行確認以完成組態設定。
   </para>
  </section>
 </section>
 <section xml:id="sec-samba-anmeld-serv">
  <title>做為登入伺服器的 Samba</title><indexterm> <primary>Samba</primary> <secondary>登入</secondary> </indexterm>

  <para>
   在以 Windows 用戶端為主的網路中，通常會建議使用者只註冊一個有效的帳戶與密碼。在以 Windows 為基礎的網路中，這個任務是由主要網域控制器 (PDC) 來處理。您可以使用已設定為 PDC 的 Windows NT 伺服器，但也可借助 Samba 伺服器完成此任務。在 <filename>smb.conf</filename> 的 <literal>[global]</literal> 區段中必須編輯的項目如 <xref linkend="dat-samba-smb-conf-dom"/> 所示。
  </para>

  <example xml:id="dat-samba-smb-conf-dom">
   <title>在 smb.conf 中的全域區段</title>
<screen>[global]
    workgroup = TUX-NET
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   如果使用加密密碼進行驗證，則 Samba 伺服器必須能夠處理這些密碼。在 <literal>[global]</literal> 區段中的 <literal>encrypt passwords = yes</literal> 項目可以啟用此功能 (加上 Samba 版本 3，現在這個是預設值)。除此之外，必須準備符合 Winodws 加密格式的使用者帳戶與密碼。此操作可使用指令 <command>smbpasswd</command> <option>-a name</option> 來完成。使用下列指令為電腦建立網域帳戶 (Windows 網域概念所需)：
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm> <primary>指令</primary> <secondary>smbpasswd</secondary> </indexterm>

  <para>
   使用 <command>useradd</command> 指令，就會加上貨幣符號。當使用 <option>-m</option> 參數時，<command>smbpasswd</command> 指令就會自動插入這個符號。加備註的組態範例 (<filename>/usr/share/doc/packages/Samba/examples/smb.conf.SuSE</filename>) 包含一些設定，可讓此任務自動執行。
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   為確保 Samba 可正確執行此程序檔，請選擇擁有所需之管理員權限的 Samba 使用者，並將其新增至 <systemitem class="groupname">ntadmin</systemitem> 群組。這樣就可以透過下列指令將 <literal>Domain Admin</literal> 狀態指定給此 Linux 群組內的所有使用者：
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>

  <para>
   如需有關此主題的詳細資訊，請參閱《Samba 3 HOWTO》(<filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>) 的第 12 章。
  </para>
 </section>
 <section xml:id="sec-samba-adnet" os="sles">
  <title>含 Active Directory 的網路中之 Samba 伺服器</title>

  <para>
   若您同時執行 Linux 伺服器與 Windows 伺服器，您可建立兩個獨立的驗證系統與網路，或將兩部伺服器透過一個中央驗證系統連接到一個網路。由於 Samba 可與 Active Directory 網域共同運作，因此您可將 SUSE Linux Enterprise Server 加入 Active Directory (AD) 中。
  </para>

  <para>
   加入現有 AD 領域的動作可以在安裝期間進行，也可以後來藉由在安裝好的系統中使用 YaST 啟動 SMB 使用者驗證來進行。安裝時加入網域的說明可在<phrase os="sles"><xref linkend="sec-i-yast2-conf-manual-user-auth"/></phrase> 中找到。
  </para>

  <para>
   若要在運作中的系統加入 AD 網域，請執行下列步驟：
  </para>

  <procedure>
   <step>
    <para>
     以 <systemitem class="username">root</systemitem> 身份登入並啟動 YaST。
    </para>
   </step>
   <step>
    <para>
     啟動<menuchoice><guimenu>網路服務</guimenu><guimenu>Windows 網域成員</guimenu></menuchoice>。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>Windows 領域成員</guimenu>畫面的<guimenu>領域或工作群組</guimenu>中輸入要加入的領域。
    </para>
    <figure>
     <title>決定 Windows 網域成員</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     核取<guimenu>Linux 驗證也使用 SMB 資訊</guimenu>，以在 SUSE Linux Enterprise Server 上使用 SMB 來源進行 Linux 驗證。
    </para>
   </step>
   <step>
    <para>
     按一下<guimenu>確定</guimenu>，並在出現提示時確認要加入網域。
    </para>
   </step>
   <step>
    <para>
     為 Windows 管理員提供 AD 伺服器上的密碼，並按一下<guimenu>確定</guimenu>。
    </para>
    <para>
     您的伺服器現在已可使用 Active Directory 網域控制器上的所有驗證資料。
    </para>
   </step>
  </procedure>
  <tip>
  <para>
如果環境中含有多個 Samba 伺服器，則建立的 UID 和 GID 不一致。分配給使用者的 UID 與使用者首次登入的順序有關，這會導致 UID 在不同伺服器之間出現衝突。要解決此問題，您需要使用身分映射。請參閱 <link xlink:href="https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/idmapper.html"/>，以取得詳細資料
  </para>
  </tip>
 </section>
 <section xml:id="sec-samba-info">
  <title>更多資訊</title>

  <para>
   可在數位文件中取得更多有關 Samba 的資訊。如果已安裝 Samba 文件，若要取得更多的線上文件與範例，請在指令行輸入 <command>apropos</command><option>samba</option> 以顯示一些手冊頁或直接瀏覽 <filename>/usr/share/doc/packages/samba</filename> 目錄。在 <filename>examples</filename> 子目錄中尋找加有備註的範例組態 (<filename>smb.conf.SuSE</filename>)。<indexterm><primary>組態檔</primary><secondary>smb.conf</secondary> </indexterm>
  </para>

  <para>
   《Samba 3 HOWTO》由 Samba 團隊提供，包含疑難排解一節。除此之外，文件的第五部份提供檢查組態的逐步指南。安裝 <filename>samba-doc</filename> 套件後，可以在 <systemitem>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</systemitem> 中找到《Samba 3 HOWTO》。
  </para>

  <indexterm class="endofrange" startref="idx-Samba"/>
 </section>
</chapter>
