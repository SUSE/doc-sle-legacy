<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect1
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="update_split_brain.xml" xml:id="sec-update-split-brain">
 <title>Atomic 更新</title>

 <para>
  Atomic 更新依賴於能夠管理兩個系統副本並可讓您在更新失敗後輕鬆復原的工具來進行。提供的工具要求進行特殊的磁碟分割區設定。每個系統副本都位於系統自己的主分割區中。如果更新失敗，您總是可以切換回另一個分割區上系統的先前狀態。
 </para>



 <section xml:id="cha-update-split-brain-setup">
  <title>設定</title>
  <warning>
   <title>嚴格的磁碟分割要求</title>
   <para>
    該實作對磁碟分割有嚴格的要求︰第一個根分割區是 <filename>/dev/sda1</filename>，且其大小不得超過整個磁碟大小的一半。工具會建立系統的第二個根分割區 <filename>/dev/sda2</filename>。其他分割區 (如果有) 分享兩個根分割區上的大小 — 考量這些分割區的大小，然後相應減少第一個分割區的大小；以下是粗略的計算方法︰
   </para>
   <para>
    完整磁碟大小 - <systemitem>sda1</systemitem> 的大小 - <systemitem>sda2</systemitem> 的大小 = 其他分割區的可用空間。
   </para>
  </warning>
  <procedure>
   <step>
    <para>
     將 <filename>/dev/sda1</filename> 做為單一的根分割區安裝系統，所佔空間要小於整個磁碟大小的一半。
    </para>
   </step>
   <step>
    <para>
     視需要對安裝的系統進行自定。請務必安裝 <systemitem>multi-update-tools</systemitem> 套件。
    </para>
   </step>
   <step>
    <para>
     執行 <command>multi-update-setup --partition</command>，以相近的大小建立系統的第二個根分割區 (<filename>/dev/sda2</filename>)。
    </para>
   </step>
   <step>
    <para>
     視需要分割其餘的磁碟空間，然後繼接著續自定設定(*)。
    </para>
   </step>
   <step>
    <para>
     執行 <command>multi-update-setup --clone</command>，將系統複製到另一個分割區。使用此指令還可以變更目標系統 <filename>/etc/fstab</filename> 中的 <filename>/</filename> (根) 項目。
    </para>
   </step>
   <step>
    <para>
     如果需要，請進一步自定設定(*)。
    </para>
   </step>
   <step>
    <para>
     執行 <command>multi-update-setup --bootloader</command>，啟動開機載入程式設定。開機載入程式功能表中即會包含一個項目，用於將另一個系統開機。
    </para>
    <warning>
     <title>必要的 GRUB 開機載入程式</title>
     <para>
      必須安裝 GRUB 開機載入程式。工具與其他開機載入程式不相容。
     </para>
    </warning>
   </step>
   <step>
    <para>
     如果沒有需要執行的自定設定 (即標有 * 號的設定)，請執行 <command>multi-update-setup --complete</command> 以執行這三個步驟。
    </para>
   </step>
  </procedure>
 </section>



 <section xml:id="cha-update-split-brain-updating">
  <title>更新另一個系統</title>
  <para>
   執行 <command>multi-update</command>。此指令會在 <command>chroot</command> 環境中執行 <systemitem>zypper</systemitem>，並更新另一個系統，哪個系統處於使用中狀態無關緊要。開機時，預設會提供其開機功能表。
  </para>
 </section>



 <section xml:id="cha-update-split-brain-touble">
  <title>疑難排解</title>
  <para>
   如果已更新系統的開機載入程式在更新後被損毀，則您必須變更<quote>使用中</quote>旗標，對另一個系統的根分割區設定該旗標以將該系統開機。
  </para>
  <para>
   如果已更新的系統根本未開機，您需要存取開機載入程式功能表，選取另一個系統。
  </para>
  <para>
   如需 GRUB 的詳細資訊，請參閱<xref linkend="cha-grub"/>。
  </para>
 </section>

 <section xml:id="cha-update-split-brain-limitation">
  <title>限制</title>
  <para>
   根分割區必須按分割區名稱、ID 或採用其他方式進行掛接。不支援按分割區 UUID 或標籤掛接。
  </para>
 </section>



 <section xml:id="cha-update-split-brain-info">
  <title>更多資訊</title>
  <para>
   如需詳細資訊，請參閱 <systemitem>multi-update-tools</systemitem> 套件隨附的 <filename>/usr/share/doc/packages/multi-update-tools/README</filename>。
  </para>
 </section>
</section>
