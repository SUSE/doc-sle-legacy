<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE book PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<?novdocinfo structuredapp = "NovDocX"?>
<?profile name = "+PubBeta" arch = "Next" condition = "Manual"?>
<?profile name = "+PubTest" arch = "Future,Next" condition = "Manual"?>
<?profile name = "+Pubwww" arch = "EMPTY" condition = "Manual"?>
<?profile name = "Future" arch = "Future"?>
<?profile name = "Manual" condition = "Manual"?>
<?profile name = "Next" arch = "Next"?>
<?novdocmeta idref="stor_admin"
 element="book"
 DepthToc="3"
 DepthNumbering="3"
?>
<book xml:base="stor_admin.xml" revision="12/16/13" conformance="sles11,Novell,no,4,80" lang="zh-tw" id="stor-admin">
<bookinfo id="bookinfo" role="Suse" xml:base="00_front.xml">
 <title>儲存管理指南</title> <productname>SUSE Linux Enterprise Server 11 SP3 </productname>
 <date><?dbtimestamp format="Y"?> 年 <?dbtimestamp format="B"?> 月 <?dbtimestamp format="d"?> 日</date>
 <titleabbrev>儲存管理指南</titleabbrev>
 <legalnotice id="legalnotices">
  <title>法律聲明</title>
  <para>版權 © 2006–2013 Novell, Inc. 及貢獻者。保留所有權利。 </para>
  <para>根據 GNU 自由文件授權 (GNU Free Documentation License) 1.2 版或 1.3 版 (自由選擇)，使用者可以複製、散佈與/或修改本文件；「恆常章節」為此著作權聲明與授權。<quote>GNU 自由文件授權</quote>一節中包含 1.2 版授權的一份副本。</para>
  <para>本手冊中所有資訊在編輯時，都已全力注意各項細節。但這不保證百分之百的正確性。因此，Novell, Inc.、SUSE LINUX Products GMBH、作者或譯者都不需對任何錯誤或造成的結果負責。</para>
 </legalnotice>
 <legalnotice id="bw4uqnv">
  <title>商標</title>
  <simplelist>
   <member><ulink url="http://www.novell.com/company/legal/trademarks/tmlist.html">如需 Novell 商標之相關資訊，請參閱 Novell 商標和服務標誌清單</ulink>。</member><member>Linux* 是 Linus Torvalds 的註冊商標。所有其他協力廠商商標，為各所有人所有之財產。</member><member>商標符號 (®、™ 等) 表示 Novell 的商標；星號 (*) 則代表協力廠商的商標。</member>
  </simplelist>
 </legalnotice>
</bookinfo>

<preface id="preface" xml:base="00_preface.xml">
 <title>關於本指南</title>
 <para>本指南提供關於如何管理 SUSE Linux Enterprise Server 11 Support Pack 3 (SP3) 伺服器上儲存裝置的資訊。</para>
 <bridgehead id="audience">使用對象</bridgehead>
 <para>本指南的適用對象為系統管理員。</para>
 <bridgehead id="usercomments">意見反應</bridgehead>
 <para>我們希望得到您對本手冊以及本產品隨附之其他文件的意見和建議。請使用線上文件中每頁底下的「使用者意見」功能，或造訪 www.novell.com/documentation/feedback.html，然後寫下您的意見。</para>
 <bridgehead id="docupdates">文件更新</bridgehead>
 <para>請造訪 <ulink url="http://www.suse.com/documentation/sles11">SUSE Linux Enterprise Server 11 的 SUSE 文件網站</ulink>，獲取最新版本的<citetitle>《SUSE Linux Enterprise Server 11 儲存管理指南》</citetitle>。</para>
 <bridgehead id="additionaldoc">其他文件</bridgehead>
 <para>如需有關分割和管理裝置的資訊，請參閱<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html"><citetitle>《SUSE Linux Enterprise Server 11 部署指南》</citetitle></ulink> 中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/cha_advdisk.html"><quote>進階磁碟設定</quote></ulink>。</para>
</preface>

<chapter id="filesystems" lang="zh-tw" xml:base="01_filesystems.xml">
 <title>Linux 中檔案系統的綜覽</title>
 <para>SUSE Linux Enterprise Server 隨附有多種不同的檔案系統供您選擇，包括 Btrfs、Ext3、Ext2、ReiserFS 和 XFS。每個檔案系統都有其各自的優點和缺點。 </para>
 <para>專業的高效能設定可能需要高可用儲存系統。為滿足高效能叢集案例的要求，SUSE Linux Enterprise Server 在 SLES 高可用性儲存基礎結構 (HASI) 版本中加入了 OCFS2 (Oracle Cluster File System 2) 與 Distributed Replicated Block Device (DRBD)。本指南中將不會介紹這些先進的儲存系統。如需詳細資訊，請參閱<ulink url="http://www.suse.com/documentation/sle_ha/book_sleha/data/book_sleha.html"><citetitle>《SUSE Linux Enterprise 11 SP3 High Availability Extension Guide》(SUSE Linux Enterprise 11 SP2 高可用性延伸指南)</citetitle></ulink>。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec-filesystems-glossary" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-major" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-add" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-lfs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-stor-limits" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkbhpd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-filesystems-info" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sec-filesystems-glossary">
  <title>術語</title>
  <variablelist>
   <varlistentry id="bgchzar">
    <term>中繼資料</term>
    <listitem>
     <para>資料結構屬於檔案系統的內部結構。它可確保磁碟上的所有資料組織正確並可進行存取。基本上，它是<quote>關於資料的資料</quote>。幾乎每一種檔案系統都有自己的中繼資料結構，這也是檔案系統展現出不同效能特性的原因所在。它對於維護中繼資料的完整極為重要，因為要不是如此，檔案系統上所有資料便無法存取。 </para>
    </listitem>
   </varlistentry>
   <varlistentry id="bgchzas">
    <term>inode</term>
    <listitem>
     <para>檔案系統的資料結構包含檔案的各種資訊，包括大小、連結數量、實際儲存檔案內容之磁碟區塊的指標、建立日期和時間、修改和存取權限。 </para>
    </listitem>
   </varlistentry>
   <varlistentry id="bgchzat">
    <term>記錄</term>
    <listitem>
     <para>在檔案系統的內容中，記錄是一種磁碟上的結構，包含了檔案系統用於儲存有關檔案系統之中繼資料變更資訊的一種記錄。記錄可大大降低檔案系統的復原時間，因為有了它就不需要在系統啟動時執行檢查整個檔案系統這一冗長的搜尋程序。而是只重複檢查記錄。 </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec-filesystems-major">
  <title>Linux 的主要檔案系統</title>
  <para>SUSE Linux Enterprise Server 提供了各種檔案系統可供選擇。本節包含有關這些檔案系統的工作方式及其優點的綜覽。 </para>
  <para>請記住，沒有一種檔案系統能夠完美適合所有類型的應用程式，這點非常重要。每一種檔案系統都有自己特殊的優、缺點，必須考慮在內。此外，即使是最頂級的檔案系統，也無法取代合理的備份策略。 </para>
  <para>本節中使用的<emphasis>資料完整性</emphasis>和<emphasis>資料一致性</emphasis>這兩個詞彙，並不表示使用者空間資料 (應用程式寫入其檔案中的資料) 的一致性。這項資料是否一致必須由應用程式本身控制。 </para>
  <important>
   <para>除非在本節中特別指明，否則設定或變更分割區以及檔案系統所需的一切步驟，都可以使用 YaST 來執行。 </para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-ext2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-ext3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-reiser" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-filesystems-major-xfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkryet" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bwk8gda">
   <title>Btrfs</title>
   <para>Btrfs 是 Chris Mason 開發的「寫時複製」(copy-on-write，COW) 檔案系統。它以 Ohad Rodeh 開發的支援 COW 的 B 樹為基礎。Btrfs 是記錄樣式的檔案系統。它不會記錄區塊變更，而是將它們寫入新位置，然後將變更連結起來。直到最後一次寫入時才會提交新變更。 </para>
   <important>
    <para>因為 Btrfs 支援儲存檔案系統的快照，所以建議保留兩倍於標準儲存建議的磁碟空間。YaST 磁碟分割程式會根據根檔案系統的 Btrfs 儲存建議自動保留此空間。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15tkq5m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkq5n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5j" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5k" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5l" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5o" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15tkr5p" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15tkq5m">
    <title>主要功能</title>
    <para>Btrfs 提供容錯、修復與簡易管理功能，例如：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>可寫入快照，可讓您在套用更新之後有需要時輕鬆地復原系統，或者可讓您備份檔案。 </para>
     </listitem>
     <listitem>
      <para>多重裝置支援，可讓您增大或縮小檔案系統。該功能計劃在 YaST 磁碟分割程式的後續版本中提供。</para>
     </listitem>
     <listitem>
      <para>進行壓縮以高效使用儲存空間。 </para>
      <para>使用 Btrfs 指令設定透明壓縮。Btrfs 的壓縮和加密功能尚在開發中，目前在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 上不受支援。</para>
     </listitem>
     <listitem>
      <para>中繼資料和使用者資料分別使用不同的 RAID 層級。</para>
     </listitem>
     <listitem>
      <para>中繼資料和使用者資料分別使用不同的檢查總數，可提高錯誤偵測效率。</para>
     </listitem>
     <listitem>
      <para>與 Linux 邏輯磁碟區管理員 (LVM) 儲存物件整合。</para>
     </listitem>
     <listitem>
      <para>與 SUSE Linux 上的 YaST 磁碟分割程式及 AutoYaST 整合。</para>
     </listitem>
     <listitem>
      <para>從現有的 Ext2、Ext3 和 Ext4 檔案系統進行離線移轉。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="b15tkq5n">
    <title>開機載入程式支援</title>
    <para>對 Btrfs 上 <filename>/boot</filename> 的開機載入程式支援計劃自 SUSE Linux Enterprise 12 起提供。</para>
   </sect3>
   <sect3 id="b15tkr5j">
    <title>Btrfs 子磁碟區</title>
    <para>Btrfs 會在其已指定的空間池中建立預設子磁碟區。它可讓您建立其他子磁碟區，做為同一個空間池內的不同檔案系統。子磁碟區的數量僅受為池配置的空間限制。</para>
    <para>如果將 Btrfs 用於根 (<filename>/</filename>) 檔案系統，YaST 磁碟分割程式會自動準備 Btrfs 檔案系統以與 Btrfs 子磁碟區搭配使用。您可以包含任何子目錄做為子磁碟區。例如，<xref linkend="b11qhfrl" xrefstyle="TableTitleOnPage"/> 會識別建議視為子磁碟區的子目錄，因為它們包含因以下原因而不應建立快照的檔案：</para>
    <table id="b11qhfrl" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
     <title>YaST 中針對 Btrfs 的預設子磁碟區處理</title>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="2381*"/>
     <colspec colnum="2" colname="2" colwidth="7620*"/>
      <thead>
       <row id="bwk8pe0">
        <entry>
         <para>路徑</para>
        </entry>
        <entry>
         <para>包含做為子磁碟區的原因</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="b11qhf62">
        <entry>
         <para><filename>/opt</filename></para>
        </entry>
        <entry>
         <para>包含協力廠商附加應用程式軟體套件。</para>
        </entry>
       </row>
       <row id="b11qhf63">
        <entry>
         <para><filename>/srv</filename></para>
        </entry>
        <entry>
         <para>包含 <filename>http</filename> 與 <filename>ftp</filename> 檔案。</para>
        </entry>
       </row>
       <row id="b11qhf64">
        <entry>
         <para><filename>/tmp</filename></para>
        </entry>
        <entry>
         <para>包含暫存檔案。</para>
        </entry>
       </row>
       <row id="b11qhf65">
        <entry>
         <para><filename>/var/crash</filename></para>
        </entry>
        <entry>
         <para>包含已毀損核心的記憶體傾印。</para>
        </entry>
       </row>
       <row id="b11qhf66">
        <entry>
         <para><filename>/var/log</filename></para>
        </entry>
        <entry>
         <para>包含系統和應用程式的記錄檔案，這些檔案永遠不會得到復原。</para>
        </entry>
       </row>
       <row id="b11qhf67">
        <entry>
         <para><filename>/var/run</filename></para>
        </entry>
        <entry>
         <para>包含執行時期變數資料。</para>
        </entry>
       </row>
       <row id="b11qhf68">
        <entry>
         <para><filename>/var/spool</filename></para>
        </entry>
        <entry>
         <para>包含等待程式、使用者或管理員處理的資料，例如新聞、郵件及印表機佇列。</para>
        </entry>
       </row>
       <row id="b11qhf69">
        <entry>
         <para><filename>/var/tmp</filename></para>
        </entry>
        <entry>
         <para>包含在各子系統重新開機期間保留的暫存檔案或目錄。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para>安裝之後，您可以使用 YaST 進階磁碟分割程式新增或移除 Btrfs 子磁碟區。如需詳細資訊，請參閱<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html"><citetitle>《SUSE Linux Enterprise Server 11 SP3 部署指南》</citetitle></ulink> 中的<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/sec_yast2_i_y2_part_expert.html#yast2_btrfs_yast"><quote>使用 YaST 管理 Btrfs 子磁碟區</quote></ulink>。</para>
   </sect3>
   <sect3 id="b15tkr5k">
    <title>根檔案系統的快照</title>
    <para>Btrfs 提供具有 SUSE Snapper 基礎結構的可寫快照，可讓您在套用更新之後，視需要輕鬆地復原系統或備份檔案。Snapper 可讓您建立、刪除和比較快照，以及回復快照之間的差異。如果將 Btrfs 用於根 (<filename>/</filename>) 檔案系統，YaST 會自動為根檔案系統啟用快照。 </para>
    <para>如需 ZYpp (<filename>snapper-zypp-plugin</filename>) 和 YaST (<filename>yast2-snapper</filename>) 中 Snapper 及其整合的詳細資訊，請參閱<ulink url="http://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html"><citetitle>《SUSE Linux Enterprise Server 11 SP3 管理指南》</citetitle></ulink> 中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_admin/data/cha_snapper.html"><quote>使用 Snapper 執行快照/復原</quote></ulink>。 </para>
    <para>若要防止快照填滿系統磁碟，您可以在 <filename>/etc/snapper/configs/root</filename> 組態檔案中或針對其他掛接點將 Snapper 清理預設值變更為更積極的值。Snapper 提供了三種演算法來清理在日常 Cron 工作中執行的舊快照。清理頻率在掛接點的 Snapper 組態中定義。請將每日、每月和每年的 TIMELINE_LIMIT 參數值設定得較低，以縮短快照的保留時間並減少其數量。如需相關資訊，請參閱<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html"><citetitle>《SUSE Linux Enterprise Server 11 SP3 管理指南》</citetitle></ulink>中的<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_snapper_config.html#sec_snapper_config_modify"><quote>調整組態檔案</quote></ulink>。</para>
    <para>如需 SUSE Snapper 專案的詳細資訊，請參閱 <ulink url="http://en.opensuse.org/Portal:Snapper">OpenSUSE.org 上的 Snapper 入口網站 wiki</ulink>。</para>
   </sect3>
   <sect3 id="b15tkr5l">
    <title>線上檢查和修復功能</title>
    <para><command>scrub</command> 檢查和修復功能包含在 Btrfs 指令行工具中。它會在假設樹狀結構沒有問題的前提下，驗證資料和中繼資料的完整性。您可以在掛接的檔案系統上定期執行 <command>scrub</command>；在一般操作過程中，該指令會做為背景程序執行。</para>
   </sect3>
   <sect3 id="b15tkr5m">
    <title>RAID 與多重路徑支援</title>
    <para>您可以使用 YaST 磁碟分割程式，在多個裝置 (MD) 和裝置對應程式 (DM) 儲存組態上建立 Btrfs。</para>
   </sect3>
   <sect3 id="b15tkr5n">
    <title>從 Ext 檔案系統移轉至 Btrfs</title>
    <para>您可以將資料磁碟區從現有 Ext 檔案系統 (Ext2、Ext3 或 Ext4) 移轉至 Btrfs 檔案系統。轉換程序會在裝置上以離線狀態進行。檔案系統需要裝置上至少 15% 的可用空間。 </para>
    <para>若要將 Ext 檔案系統轉換成 Btrfs，請將檔案系統置於離線狀態，然後輸入：</para>

<screen>
btrfs-convert &lt;<replaceable>device</replaceable>&gt;
</screen>

    <para>若要將移轉復原為原始 Ext 檔案系統，請將檔案系統置於離線狀態，然後輸入：</para>

<screen>
btrfs-convert -r &lt;<replaceable>device</replaceable>&gt;
</screen>

    <important>
     <para>復原為原始 Ext 檔案系統時，在轉換成 Btrfs 之後新增的所有資料都將遺失。也就是說，只會將原始資料轉換回 Ext 檔案系統。 </para>
    </important>
   </sect3>
   <sect3 id="b15tkr5o">
    <title>Btrfs 管理</title>
    <para>Btrfs 已整合到 YaST 磁碟分割程式和 AutoYaST 中。安裝期間可以使用它來設定根檔案系統的解決方案。安裝之後，您可以使用 YaST 磁碟分割程式來檢視和管理 Btrfs 磁碟區。</para>
    <para>Btrfs 管理工具提供於 <filename>btrfsprogs</filename> 套件中。如需使用 Btrfs 指令的詳細資訊，請參閱 <command>btrfs(8)</command>、<command>btrfsck(8)</command>、<command>mkfs.btrfs(8)</command> 和 <command>btrfsctl(8)</command> 的 man 頁面。如需 Btrfs 功能的詳細資訊，請參閱 <ulink url="http://btrfs.wiki.kernel.org"><citetitle>Btrfs wiki</citetitle></ulink>。</para>
    <para>在不久的將來，SUSE Linux Enterprise 更新儲存庫中將會提供 <command>fsck.btrfs(8)</command> 工具。</para>
   </sect3>
   <sect3 id="b15tkr5p">
    <title>Btrfs 子磁碟區配額支援</title>
    <para>Btrfs <systemitem>根</systemitem>檔案系統子磁碟區 <filename>/var/log</filename>、<filename>/var/crash</filename> 和 <filename>/var/cache</filename> 可在執行一般操作過程中使用所有可用的磁碟空間，但會導致系統功能出現問題。為了協助避免此狀況，SUSE Linux Enterprise 現在提供了 Btrfs 子磁碟區配額支援。如需詳細資料，請參閱 <filename>btrfs(8)</filename> 手冊頁。</para>
   </sect3>
  </sect2>
  <sect2 id="sec-filesystems-major-ext2">
   <title>Ext2</title>
   <para>Ext2 的起源要回到 Linux 歷史的古早年代。它的前輩 - 延伸檔案系統，是在 1992 年 4 月落實並整合至 Linux 0.96c。延伸檔案系統已經過多次修改，而到了 Ext2，成為多年來最受歡迎的 Linux 檔案系統。若建立了檔案系統的記錄，因其復原快速，Ext2 就顯得不再那麼重要了。 </para>
   <para>簡短的 Ext2 功能摘要可以協助瞭解它曾是 (在某些領域依然是) 很多 Linux 使用者最喜愛的 Linux 檔案系統的原因所在。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bi6ymkx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzb1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bi6ymkx">
    <title>穩固性和速度</title>
    <para>Ext2 經過多次改良和密集測試，已經算是<quote>老前輩</quote>了。這可能是為什麼人們通常稱它堅如磐石的原因所在。在檔案系統無法完全取消掛接而導致系統中斷後，e2fsck 會開始分析檔案系統資料。中繼資料會進入一致性狀態，而待處理的檔案或資料區塊會寫入指定的目錄 (稱為 <filename>lost+found</filename>)。與記錄檔案系統相比，e2fsck 會分析整個檔案系統，不只是中繼資料最近修改的位元而已。這比檢查記錄檔案系統的記錄資料，要花費更多時間。按照檔案系統大小，此程序會花半小時或更長的時間。因此，不要為任何需要高可用性的伺服器選擇 Ext2。不過，因為 Ext2 不會維護記錄，而且使用相當少的記憶體，因此有時候比其他檔案系統較快速一些。</para>
   </sect3>
   <sect3 id="bgchzb1">
    <title>升級容易</title>
    <para>因為 Ext3 是以 Ext2 程式碼為基礎，而且共用它的磁碟上格式和中繼資料格式，所以從 Ext2 升級至 Ext3 十分容易。 </para>
   </sect3>
  </sect2>
  <sect2 id="sec-filesystems-major-ext3">
   <title>Ext3</title>
   <para>Ext3 是由 Stephen Tweedie 設計。不像其他所有下一代檔案系統，Ext3 不依循全新的設計原則。它是以 Ext2 為基礎。這兩個檔案系統彼此關係十分密切。Ext3 檔案系統可以輕易地建立在 Ext2 檔案系統的最上層。Ext2 和 Ext3 最重要的差別是 Ext3 支援記錄處理。簡而言之，Ext3 提供三個主要優點： </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzb3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzb4" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="sec-filesystems-major-ext22ext3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bgchzb3">
    <title>可輕易從 Ext2 升級，並具有很高的可靠性</title>
    <para>Ext3 以 Ext2 的程式碼做為強大的基礎，因此可以成為眾人喝采的下一代檔案系統。在 Ext3 中完美融合了 Ext2 的可靠性和穩固性特點，同時具備記錄檔案系統的優點。不像轉換至其他記錄檔案系統 (例如 ReiserFS、JFS 或 XFS) 那麼冗長乏味 (備份整個檔案系統，然後從頭建立)，轉換至 Ext3 只是數分鐘的事。它還非常安全，因為從頭開始重新建立整個檔案系統，並不能確保萬無一失。考慮一下等候升級至記錄檔案系統的現有 Ext2 系統數量，您可以輕易瞭解為什麼 Ext3 對很多系統管理員都具有一定重要性。從 Ext3 降級至 Ext2 就和升級一樣容易。只要乾淨取消掛載 Ext3 檔案系統，然後重新掛載成 Ext2 檔案系統就可以了。 </para>
   </sect3>
   <sect3 id="bgchzb4">
    <title>可靠性和效能</title>
    <para>其他記錄檔案系統，有些會依照<quote>僅中繼資料</quote>記錄方法。這表示您的中繼資料會始終維持一致的狀態，但這並不能自動保證檔案系統資料本身的一致性。Ext3 的設計是妥善管理中繼資料和資料二者。<quote>管理</quote>的程度可以自定。在 <option>data=journal</option> 模式啟用 Ext3，可提供最大的安全性 (資料整合性)，不過因為中繼資料和資料都會記錄下來，所以系統速度會減慢。較新的方法是使用 <option>data=ordered</option> 模式，這樣可以確定資料和中繼資料整合性，不過僅限中繼資料使用記錄。檔案系統驅動程式會收集所有對應至某一中繼資料更新的所有資料區塊。更新中繼資料前，這些資料區塊會寫入硬碟。如此一來便可以達到中繼資料和資料的一致性，不會犧牲效能。第三個要使用的選項是 <option>data=writeback</option>，允許在其中繼資料已經提交至記錄後，將資料寫入主要檔案系統。一般認為此選項的效能最好。不過，它可以允許在損毀和復原舊資料後，重新顯示舊資料，同時又維護內部檔案系統整合性。Ext3 使用 <option>data=ordered</option> 選項做為預設值。 </para>
   </sect3>
   <sect3 id="sec-filesystems-major-ext22ext3">
    <title>將 Ext2 檔案系統轉換成 Ext3</title>
    <para>若要將 Ext2 檔案系統轉換為 Ext3，請執行下列步驟：</para>
    <procedure id="bgchzb5">
     <step id="bgchzb6" performance="required">
      <para>以 <systemitem>root</systemitem> 使用者身分執行 <command>tune2fs -j</command> 來建立 Ext3 記錄。 </para>
      <para>這樣會以預設參數建立 Ext3 記錄。</para>
      <para>若要指定記錄的大小以及存放它的裝置，請執行 <command>tune2fs <option>-J</option></command>，不要同時使用需要的記錄選項 <option>size=</option> 和 <option>device=</option>。如需 <command>tune2fs</command> 程式的詳細資訊，請參閱 <command>tune2fs</command> 線上文件。</para>
     </step>
     <step id="bgchzb7" performance="required">
      <para>以 <systemitem>root</systemitem> 使用者身分編輯檔案 <filename>/etc/fstab</filename>，將為對應分割區指定的檔案系統類型從 <literal>ext2</literal> 變更為 <literal>ext3</literal>，然後儲存變更。</para>
      <para>這可確保 Ext3 檔案系統會被識別為 Ext3 檔案系統。完成的變更會在下次啟動時生效。</para>
     </step>
     <step id="bgchzb8" performance="required">
      <para>若要開機設定為 Ext3 分割區的根檔案系統，請在 <filename>initrd</filename> 中加入模組 <literal>ext3</literal> 和 <literal>jbd</literal>。</para>
      <substeps performance="required">
       <step id="bi6z1gc" performance="required">
        <para>以 <systemitem>root</systemitem> 身分編輯 <filename>/etc/sysconfig/kernel</filename>，將 <literal>ext3</literal> 和 <literal>jbd</literal> 新增至 <envar>INITRD_MODULES</envar> 變數，然後儲存變更。</para>
       </step>
       <step id="bi6z1rw" performance="required">
        <para>執行 <command>mkinitrd</command> 指令。 </para>
        <para>這樣就可以建置新的 initrd，並準備使用。</para>
       </step>
      </substeps>
     </step>
     <step id="bi6z29v" performance="required">
      <para>重新啟動系統。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="sec-fileystems-major-ext3inodesize">
    <title>Ext3 檔案系統 Inode 大小和 Inode 數量</title>
    <para>Inode 會儲存檔案及其在檔案系統中之區塊位置的相關資訊。為了在 Inode 中留出空間用於延伸的屬性和 ACL，Ext3 的預設 Inode 大小已從 SLES 10 上的 128 位元組增大到 SLES 11 上的 256 位元組。與 SLES 10 相比，當您在 SLES 11 上建立新的 Ext3 檔案系統時，為相同數量之 Inode 預先配置的預設空間會增加一倍，檔案系統中檔案的可用空間則會減少相應的空間。因此，您必須使用較大的分割區才能容納 SLES 10 上 Ext3 檔案系統可能容納的相同 Inode 數和檔案數。</para>
    <para>建立新的 Ext3 檔案系統時，將根據可建立的 Inode 總數預先配置 Inode 表格的空間。每 Inode 的位元組數比率和檔案系統的大小決定了可以建立的 Inode 數。檔案系統建立後，將會為每一個每 Inode 的位元組數位元組空間建立一個 Inode︰</para>

<screen role="compact2">
number of inodes = total size of the file system divided by the number of bytes per inode
</screen>

    <para>Inode 數控制了檔案系統中可容納的檔案數：一個檔案對應一個 Inode。為了解決 Inode 大小日益增大而可用空間日益減少的問題，每 Inode 的位元組數比率的預設值已從 SLES 10 上的 8192 位元組增大到 SLES 11 上的 16384 位元組。比率增加了一倍，表示可建立的檔案數是 SLES 10 上 Ext3 檔案系統所允許檔案數的一半。</para>
    <important>
     <para>配置 Inode 之後，您無法變更 Inode 大小或每 Inode 的位元組數比率的設定。如果不使用其他設定重新建立檔案系統，或不延伸檔案系統，則無法新增 Inode。當超出最大 Inode 數時，除非刪除某些檔案，否則無法在檔案系統上建立新的檔案。</para>
    </important>
    <para>建立新的 Ext3 檔案系統時，您可以指定 Inode 大小和每 Inode 的位元組數比率來控制 Inode 空間使用量以及檔案系統上所允許的檔案數。如果不指定區塊大小、Inode 大小和每 Inode 的位元組數比率值，則會套用 <filename>/etc/mked2fs.conf</filename> 檔案中的預設值。如需詳細資訊，請參閱 <filename>mke2fs.conf(5)</filename> man 頁面。</para>
    <para>使用下列準則：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b14jepus">
       <title>Inode 大小：</title>
       <para>預設 Inode 大小為 256 位元組。以位元組為單位指定一個值，該值是 2 的冪且大於或等於 128 位元組 (最大為區塊大小)，例如 128、256、512 等。僅當不在 Ext3 檔案系統上使用延伸的屬性或 ACL 時，方可使用 128 位元組。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b14jeput">
       <title>每 Inode 的位元組數比率：</title>
       <para>每 Inode 的位元組數比率預設值為 16384 位元組。有效的每 Inode 的位元組數比率值必須是 2 的幂且大於或等於 1024 位元組，例如 1024、2048、4096、8192、16384、32768 等。此值不應小於檔案系統的區塊大小，因為區塊大小是用於儲存資料的最小空間區塊。Ext3 檔案系統的預設區塊大小為 4 KB。 </para>
      </formalpara>
      <para>此外，您應該考量需要儲存的檔案數和檔案大小。例如，如果檔案系統將儲存許多小型檔案，您可以指定一個較小的每 Inode 的位元組數比率，這樣可增加 Inode 數。如果檔案系統將儲存大型檔案，則可以指定一個較大的每 Inode 的位元組數比率，這樣可減少可能的 Inode 數。 </para>
      <para>一般而言，最好準備充足的 Inode，而不是將其耗盡。如果 Inode 太少且檔案也很小，則在實際上為空的磁碟上，您可能已經達到最大檔案數。如果 Inode 太多且檔案也很大，則您可能會被告知存在可用空間但卻無法使用，因為您無法在為 Inode 保留的空間中建立新檔案。</para>
     </listitem>
    </itemizedlist>
    <para>如果不在 Ext3 檔案系統上使用延伸的屬性或 ACL，則可以在建立檔案系統時，分別指定 128 位元組和 8192 位元組做為 Inode 大小和每 Inode 的位元組數比率，藉以還原 SLES 10 的行為。使用下列任一種方法來設定 Inode 大小和每 Inode 的位元組數比率：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b14irnj5">
       <title>修改所有新 Ext3 檔案的預設設定︰</title>
       <para>在文字編輯器中，修改 <filename>/etc/mke2fs.conf</filename> 檔案的 <literal>defaults</literal> 區段，以將 <literal>inode_size</literal> 和 <literal>inode_ratio</literal> 設為所需的預設值。這些值會套用至所有新的 Ext3 檔案系統。例如：</para>
      </formalpara>

<screen>
blocksize = 4096
inode_size = 128
inode_ratio = 8192
</screen>

     </listitem>
     <listitem>
      <formalpara id="b14irnj6">
       <title>在指令行中：</title>
       <para>當建立新的 Ext3 檔案系統時，將 Inode 大小 (<literal>-I 128</literal>) 和每 Inode 的位元組數比率 (<literal>-i 8192</literal>) 傳遞至 <command>mkfs.ext3(8)</command> 指令或 <command>mke2fs(8)</command> 指令。例如，使用下列任一個指令：</para>
      </formalpara>

<screen>
mkfs.ext3 -b 4096 -i 8092 -I 128 /dev/sda2

mke2fs -t ext3 -b 4096 -i 8192 -I 128 /dev/sda2
</screen>

     </listitem>
     <listitem>
      <formalpara id="b12dp9td">
       <title>在使用 YaST 進行安裝期間：</title>
       <para>在安裝期間建立新的 Ext3 檔案系統時，傳遞 Inode 大小和每 Inode 的位元組數比率值。在 YaST 磁碟分割程式之<guimenu>編輯分割區</guimenu>頁面的<guimenu>格式化選項</guimenu>下，選取<guimenu>格式化分割區</guimenu>&gt;<guimenu>Ext3</guimenu>，然後按一下<guimenu>選項</guimenu>。在<guimenu>檔案系統選項</guimenu>對話方塊中，從<guimenu>區塊大小 (位元組)</guimenu>、<guimenu>每 Inode 的位元組數</guimenu>和<guimenu>Inode 大小</guimenu>下拉式選單中選取所需的值。</para>
      </formalpara>
      <para>例如，從<guimenu>區塊大小 (位元組)</guimenu>下拉式選單中選取 4096，從<guimenu>每 Inode 的位元組數</guimenu>下拉式選單中選取 8192，從<guimenu>Inode 大小</guimenu>下拉式選單中選取 128，然後按一下<guimenu>確定</guimenu>。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="ext3_inode_yast_a.png" width="305pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
     <listitem>
      <formalpara id="b12dpiab">
       <title>在使用 autoyast 進行安裝期間：</title>
       <para>在 autoyast 設定檔中，可以使用 <literal>fs_options</literal> 標記將 -i 的 <literal>opt_bytes_per_inode</literal> 比率值設為 8192，並將 -I 的 <literal>opt_inode_density</literal> 值設為 128：</para>
      </formalpara>

<screen>
&lt;partitioning config:type="list"&gt;
    &lt;drive&gt;
      &lt;device&gt;/dev/sda&lt;/device&gt;
      &lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext3&lt;/filesystem&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;fs_options&gt;
            &lt;opt_bytes_per_inode&gt;
              &lt;option_str&gt;-i&lt;/option_str&gt;
              &lt;option_value&gt;8192&lt;/option_value&gt;
            &lt;/opt_bytes_per_inode&gt;
            &lt;opt_inode_density&gt;
              &lt;option_str&gt;-I&lt;/option_str&gt;
              &lt;option_value&gt;128&lt;/option_value&gt;
            &lt;/opt_inode_density&gt;
          &lt;/fs_options&gt;
          &lt;mount&gt;/&lt;/mount&gt;
          &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
          &lt;partition_type&gt;primary&lt;/partition_type&gt;
          &lt;size&gt;25G&lt;/size&gt;
        &lt;/partition&gt;
</screen>

     </listitem>
    </itemizedlist>
    <para>如需詳細資訊，請參閱 <ulink url="http://www.novell.com/support/kb/doc.php?id=7009075"><citetitle>SLES11 ext3 分割區只能儲存 SLES10 上可儲存之檔案數量的 50%</citetitle> [技術資訊文件 7009075]</ulink>。</para>
   </sect3>
  </sect2>
  <sect2 id="sec-filesystems-major-reiser">
   <title>ReiserFS</title>
   <para>正式說來，2.4 核心版本的重要功能之一，ReiserFS，自其 6.4 版以來早已被 2.2.x SUSE 核心當作核心修補程式使用。ReiserFS 是由 Hans Reiser 與 Namesys 開發團隊所設計。ReiserFS 已經證實是 Ext2 的強大替代方案。其重要優點是磁碟空間使用率佳，磁碟存取效能好，當機復原快，以及使用資料記錄確保可靠性。</para>
   <important>
    <para>SUSE Linux Enterprise Server 11 的生命期間完全支援 ReiserFS 檔案系統，尤其是用於移轉目的。SUSE 計劃從 SUSE Linux Enterprise Server 12 起，不再支援建立新的 ReiserFS 檔案系統。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzav" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzaw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzax" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzay" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bgchzav">
    <title>更佳的磁碟空間利用</title>
    <para>在 ReiserFS 中，所有資料皆按照名為 B*-平衡樹的結構整理。樹狀結構提供更佳的磁碟空間利用，因為小的檔案可以直接儲存在 B* 樹葉節點，而不是儲存在別處，而且只維護實際磁碟位置的指標。此外，未以 1 或 4 kB 的區塊配置儲存體，而是按需要的正確大小。另一項優點則依賴 inode 的動態配置。這樣會使得檔案系統比傳統的檔案系統更有彈性，例如在 Ext2，inode 密度必須在檔案系統建立期間指定。 </para>
   </sect3>
   <sect3 id="bgchzaw">
    <title>更佳的磁碟存取效能</title>
    <para>至於小的檔案，檔案資料和<quote>stat_data</quote> (inode) 資訊兩者通常儲存在一起。它們可以使用單一磁碟 I/O 操作來讀取，這表示您只需要存取一次磁碟，便能擷取所有需要的資訊。 </para>
   </sect3>
   <sect3 id="bgchzax">
    <title>快速損毀復原</title>
    <para>使用記錄來追蹤最新的中繼資料變更，只要幾秒便能檢查檔案系統，即使很大的檔案系統也沒問題。 </para>
   </sect3>
   <sect3 id="bgchzay">
    <title>透過資料記錄的可靠性</title>
    <para>ReiserFS 還支援資料記錄和排序資料模式，此模式類似<xref linkend="sec-filesystems-major-ext3" xrefstyle="HeadingOnPage"/> 中簡述的概念。預設模式為 <literal>data=ordered</literal>，這個模式可以確保資料和中繼資料的完整性，但是記錄僅適用中繼資料。 </para>
   </sect3>
  </sect2>
  <sect2 id="sec-filesystems-major-xfs">
   <title>XFS</title>
   <para>1990 年代早期，SGI 開始對原先要當成 IRIX OS 的檔案系統 XFS 進行研發。XFS 隱含的目標是建立高效能 64 位元記錄檔案系統，以滿足嚴格的計算挑戰。XFS 對於操控大型檔案以及執行高階硬體，具備良好功能。不過，XFS 還是有一個缺點。和 ReiserFS 一樣，XFS 專注於中繼資料完整性，而不重視資料的完整性。</para>
   <para>以下是 XFS 主要功能的快速回顧，這些正是為什麼它在高階計算中比其他記錄檔案系統更具競爭力的證明。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bgchzba" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzbb" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bgchzbc" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bgchzba">
    <title>透過使用配置群組取得的高擴充性</title>
    <para>建立 XFS 檔案系統時，檔案系統所屬的區塊裝置，會分割成 8 或更多等同大小的線性區域。這些稱為<emphasis>配置群組</emphasis>。每一個配置群組管理自己的 inode 以及可用的磁碟空間。事實上，配置群組可以看成是檔案系統中的檔案系統。因為配置群組彼此各自獨立，所以核心可以同時處理一個以上的配置群組。此功能是 XFS 具備優良延展性的關鍵。當然，獨立配置群組的概念也符合多處理器系統的需求。 </para>
   </sect3>
   <sect3 id="bgchzbb">
    <title>透過有效磁碟空間管理取得高效能</title>
    <para>可用空間和 inode 是由配置群組裡面的 B<superscript>+</superscript> 樹處理。使用 B<superscript>+</superscript> 樹可大大增強 XFS 的效能和延展性。XFS 使用<emphasis>延遲配置</emphasis>，透過將程序分為兩個部分來處理配置。待處理的交易會儲存在 RAM 並保留適當的空間。XFS 仍然沒有決定資料儲存的確切位置 (在檔案系統區塊中)。此決策會盡量延緩至最後時刻。部分暫時資料永遠不會儲存至磁碟，因為當 XFS 決定了其實際儲存位置時，它早已過時了。採用這種方式，XFS 將增加寫入效能並減少檔案系統片段。因為比起其他檔案系統，延遲配置會導致較少的寫入事件，這樣在寫入過程中若是發生當機就會導致較嚴重的資料遺失。 </para>
   </sect3>
   <sect3 id="bgchzbc">
    <title>預先配置來避免檔案系統零散化</title>
    <para>寫入資料至檔案系統前，XFS 會<emphasis>保留</emphasis> (預先配置) 檔案需要的可用空間。因此，可大幅降低檔案系統零散化。因為檔案的內容是分佈在檔案系統中，所以效能就會提高。 </para>
   </sect3>
  </sect2>
  <sect2 id="bwkryet">
   <title>檔案系統功能比較</title>
   <para>如需 SUSE Linux Enterprise Server 中主要作業系統的並排功能比較，請參閱 <ulink url="http://www.suse.com/products/server/technical-information/">SUSE Linux Enterprise Server 技術資訊網站</ulink> 上的<ulink url="http://www.suse.com/products/server/technical-information/#FileSystem">檔案系統支援與大小</ulink>。</para>
  </sect2>
 </sect1>
 <sect1 id="sec-filesystems-add">
  <title>其他受支援的檔案系統</title>
  <para role="intro"><xref linkend="tab-dateisysteme" xrefstyle="TableXRef"/> 彙整 Linux 支援的其他檔案系統。提供其他系統支援主要是確定不同媒體或外來作業系統中，資料交換的相容性。</para>
  <table id="tab-dateisysteme" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <title>Linux 的檔案系統類型</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="2381*"/>
   <colspec colnum="2" colname="2" colwidth="7620*"/>
    <thead>
     <row id="bi6z95b">
      <entry>
       <para>檔案系統類型</para>
      </entry>
      <entry>
       <para>描述</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="bwk81ba">
      <entry>
       <para><systemitem>cramfs</systemitem></para>
      </entry>
      <entry>
       <para>壓縮的 ROM 檔案系統：ROM 的一種壓縮唯讀檔案系統。</para>
      </entry>
     </row>
     <row id="bwk81bb">
      <entry>
       <para><systemitem>hpfs</systemitem></para>
      </entry>
      <entry>
       <para>高效能檔案系統：IBM OS/2 標準檔案系統。僅在唯讀模式下受支援。</para>
      </entry>
     </row>
     <row id="bwk81bc">
      <entry>
       <para><systemitem>iso9660</systemitem></para>
      </entry>
      <entry>
       <para>CD-ROM 的標準檔案系統。</para>
      </entry>
     </row>
     <row id="bwk81bd">
      <entry>
       <para><systemitem>minix</systemitem></para>
      </entry>
      <entry>
       <para>源自作業系統學術研究專案的檔案系統，是 Linux 使用的第一個檔案系統。現在，它可作為磁片檔案系統來使用。</para>
      </entry>
     </row>
     <row id="bwk81be">
      <entry>
       <para><systemitem>msdos</systemitem></para>
      </entry>
      <entry>
       <para><filename>fat</filename> 最早源自 DOS 的檔案系統，現在各種作業系統均使用之。</para>
      </entry>
     </row>
     
     
     <row id="bwk81bg">
      <entry>
       <para><systemitem>nfs</systemitem></para>
      </entry>
      <entry>
       <para>網路檔案系統：使用這種檔案系統，資料可以儲存在網路中的任何機器上，而且可以經由授權從網路存取。</para>
      </entry>
     </row>
     <row id="bwk81bh">
      <entry>
       <para><systemitem>ntfs</systemitem></para>
      </entry>
      <entry>
       <para>Windows NT 檔案系統；唯讀。</para>
      </entry>
     </row>
     <row id="bwk81bi">
      <entry>
       <para><systemitem>smbfs</systemitem></para>
      </entry>
      <entry>
       <para>有些產品 (例如 Windows) 會使用伺服器訊息區塊，透過網路來存取檔案。</para>
      </entry>
     </row>
     <row id="bwk81bj">
      <entry>
       <para><systemitem>sysv</systemitem></para>
      </entry>
      <entry>
       <para>用於 SCO UNIX、Xenix 和 Coherent (個人電腦的商用 UNIX 系統)。</para>
      </entry>
     </row>
     <row id="bwk81bk">
      <entry>
       <para><systemitem>ufs</systemitem></para>
      </entry>
      <entry>
       <para>由 BSD、SunOS 和 NextStep 使用。僅支援唯讀模式。</para>
      </entry>
     </row>
     <row id="bwk81bl">
      <entry>
       <para><systemitem>umsdos</systemitem></para>
      </entry>
      <entry>
       <para>MS-DOS 上的 UNIX：套用於標準 <filename>fat</filename> 檔案系統的最上層，透過建立特殊檔案來實現 UNIX 功能 (許可權、連結、長檔案名稱)。</para>
      </entry>
     </row>
     <row id="bwk81bm">
      <entry>
       <para><systemitem>vfat</systemitem></para>
      </entry>
      <entry>
       <para>虛擬 FAT：<literal>fat</literal> 檔案系統的副檔名 (支援長檔名)。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </sect1>
 <sect1 id="sec-filesystems-lfs">
  <title>Linux 的大型檔案支援</title>
  <para>一開始，Linux 支援的檔案大小最大為 2 GiB (2<superscript>31</superscript> 位元組)。除非檔案系統隨附大型檔案支援，否則 32 位元系統上的最大檔案大小為 2 GiB。 </para>
  <para>目前，我們所有的標準檔案系統都具有 LFS (大型檔案支援)，理論上可以支援最大為 2<superscript>63</superscript> 位元組的檔案大小。<xref linkend="tab-maxsize" xrefstyle="TableXRef"/> 概述了 Linux 檔案和檔案系統的目前磁碟格式限制。表格中的數字假設檔案系統使用 4 KiB 區塊大小 (此為常用標準)。使用不同的區塊大小時，結果將會不同。使用疏鬆區塊時，<xref linkend="tab-maxsize" xrefstyle="TableXRef"/> 中的最大檔案大小可以大於檔案系統的實際大小。 </para>
  <note>
   <para>在本文件中：1024 位元組 = 1 KiB；1024 KiB = 1 MiB；1024 MiB = 1 GiB；1024 GiB = 1 TiB；1024 TiB = 1 PiB；1024 PiB = 1 EiB (另請參閱<ulink url="http://physics.nist.gov/cuu/Units/binary.html"><citetitle>《NIST: Prefixes for Binary Multiples》(NIST：二倍數的字首)</citetitle></ulink>。</para>
  </note>
  <table id="tab-maxsize" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
   <title>檔案和檔案系統的最大大小 (磁碟格式，4 KiB 區塊大小)</title>
   <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="3334*"/>
   <colspec colnum="2" colname="2" colwidth="3334*"/>
   <colspec colnum="3" colname="3" colwidth="3334*"/>
    <thead>
     <row id="b12r1f2q">
      <entry>
       <para>檔案系統 (4 KiB 區塊大小)</para>
      </entry>
      <entry>
       <para>檔案系統的最大大小</para>
      </entry>
      <entry>
       <para>最大檔案大小</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="b12r1f2r">
      <entry>
       <para>Btrfs</para>
      </entry>
      <entry>
       <para>16 EiB</para>
      </entry>
      <entry>
       <para>16 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2s">
      <entry>
       <para>Ext3</para>
      </entry>
      <entry>
       <para>16 TiB</para>
      </entry>
      <entry>
       <para>2 TiB</para>
      </entry>
     </row>
     <row id="b12r1f2t">
      <entry>
       <para>OCFS2 (High Availability Extension 中可使用之支援叢集的檔案系統)</para>
      </entry>
      <entry>
       <para>16 TiB</para>
      </entry>
      <entry>
       <para>1 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2u">
      <entry>
       <para>ReiserFS v3.6</para>
      </entry>
      <entry>
       <para>16 TiB</para>
      </entry>
      <entry>
       <para>1 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2v">
      <entry>
       <para>XFS</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
     </row>
     <row id="b12r1f2w">
      <entry>
       <para>NFSv2 (用戶端)</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
      <entry>
       <para>2 GiB</para>
      </entry>
     </row>
     <row id="b12r1f2x">
      <entry>
       <para>NFSv3 (用戶端)</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
      <entry>
       <para>8 EiB</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
  <important>
   <para><xref linkend="tab-maxsize" xrefstyle="TableXRef"/>會說明磁碟上 (On-Disk) 格式的限制。 Linux 核心會強制其處理的檔案和檔案系統依循自身大小限制。限制如下： </para>
   <variablelist>
    <varlistentry id="bgchzc6">
     <term>檔案大小</term>
     <listitem>
      <para>在 32 位元系統上，檔案不能超過 2 TiB (2<superscript>41</superscript> 位元組)。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchzc7">
     <term>檔案系統大小</term>
     <listitem>
      <para>檔案系統大小最大可達 2<superscript>73</superscript> 位元組。不過，此限制仍然跟不上目前可用的硬體。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </important>
 </sect1>
 <sect1 id="sect-stor-limits">
  <title>Linux 核心儲存限制</title>
  <para><xref linkend="b12o27j6" xrefstyle="TableXRef"/> 總結了與 SUSE Linux Enterprise 11 Service Pack 3 相關聯之儲存的核心限制。 </para>
  <table id="b12o27j6" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
   <title>儲存限制</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="5001*"/>
   <colspec colnum="2" colname="2" colwidth="5001*"/>
    <thead>
     <row id="b12o27j7">
      <entry>
       <para>儲存功能</para>
      </entry>
      <entry>
       <para>限制</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="b12o27j8">
      <entry>
       <para>支援的最大 LUN 數</para>
      </entry>
      <entry>
       <para>每個目標 16384 個 LUN。</para>
      </entry>
     </row>
     <row id="b12o27j9">
      <entry>
       <para>每個 LUN 的最大路徑數</para>
      </entry>
      <entry>
       <para>本身無限制。每個路徑都視為一個一般 LUN。</para>
       <para>實際限制由每個目標的 LUN 數和每個 HBA 的目標數 (對於光纖通道 HBA 為 16777215) 指定。</para>
      </entry>
     </row>
     <row id="b12o27ja">
      <entry>
       <para>最大 HBA 數</para>
      </entry>
      <entry>
       <para>未設限. 實際限制由系統的 PCI 插槽數決定。</para>
      </entry>
     </row>
     <row id="b12o27jb">
      <entry>
       <para>每個作業系統使用 device-mapper-multipath 的最大路徑數 (總計)</para>
      </entry>
      <entry>
       <para>大約為 1024。實際數量取決於裝置數量字串的長度。它是 multipath-tools 中的一個編譯時間變數，如果此限制會導致問題，則可提高其值。</para>
      </entry>
     </row>
     <row id="b12r1mnq">
      <entry>
       <para>每一區塊裝置的最大大小</para>
      </entry>
      <entry>
       <para>對於 X86，最大為 16 TiB。</para>
       <para>對於 x86_64、ia64、s390x 和 ppc64，最大為 8 EiB。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </sect1>
 <sect1 id="bwkbhpd">
  <title>使用 YaST 磁碟分割程式管理裝置</title>
  <para>您可以使用 YaST 磁碟分割程式來建立和管理檔案系統及 RAID 裝置。如需詳細資訊，請參閱<ulink url="https://www.suse.com/documentation/sles11/book_sle_deployment/data/book_sle_deployment.html"><citetitle>《SUSE Linux Enterprise Server 11 SP3 部署指南》</citetitle></ulink> 中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_deployment/data/cha_advdisk.html"><quote>進階磁碟設定</quote></ulink>。</para>
 </sect1>
 <sect1 id="sec-filesystems-info">
  <title>其他資訊</title>
  <para>請造訪上述每種檔案系統專案維護的專屬首頁，找出的郵件清單資訊、詳盡文件以及常見問題：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="http://e2fsprogs.sourceforge.net/"><citetitle>E2fsprogs: Ext2/3/4 File System Utilities (E2fsprogs︰Ext2/3/4 檔案系統公用程式)</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://www.ibm.com/developerworks/linux/library/l-fs7/"><citetitle>Introducing Ext3 (Ext3 簡介)</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://oss.sgi.com/projects/xfs/"><citetitle>XFS: A High-Performance Journaling Filesytem (高效能記錄檔案系統)</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://oss.oracle.com/projects/ocfs2/"><citetitle>OCFS2 Project (OCFS2 專案)</citetitle></ulink></para>
   </listitem>
  </itemizedlist><?dbfo-need height="20em"?>


  <para>有關 Linux 檔案系統的多部份全面教學課程，請參閱<ulink url="https://www.ibm.com/developerworks/linux/library/l-fs/"><citetitle>《Advanced File System Implementor’s Guide》(進階檔案系統實作指南)</citetitle></ulink> 中的「IBM developerWork」。 </para>
  <para>Wikipedia 計畫上的<ulink url="http://en.wikipedia.org/wiki/Comparison_of_file_systems#Comparison"><citetitle>《Comparison of File Systems》(檔案系統比較)</citetitle></ulink> 中提供了對幾種檔案系統 (不僅是 Linux 檔案系統) 的深入比較。 </para>
 </sect1>
</chapter>

<chapter id="storwhatsnew" lang="zh-tw" xml:base="01_whatsnew.xml">
 <title>SLES 11 中關於儲存的新功能</title>
 <para>本章所述的是 SUSE Linux Enterprise Server 11 中的功能與行為變更。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="new-sles11sp3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkb7my" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndgyod" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndgyoe" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="new-sles11sp3">
  <title>SLES 11 SP3 中的新增功能</title>
  <para>除了錯誤修正之外，本節所述的是 SUSE Linux Enterprise Server 11 SP3 版本的功能與行為變更︰</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b15ds08f" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08d" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08c" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15ds08e" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b15ds08f">
   <title>Btrfs 配額</title>
   <para><systemitem>根</systemitem>檔案系統上的 Btrfs 子磁碟區配額支援已新增到 <command>btrfs(8)</command> 指令中。</para>
  </sect2>
  <sect2 id="b15ds08d">
   <title>iSCSI LIO 目標伺服器</title>
   <para>YaST 支援 iSCSI LIO 目標伺服器軟體。如需更多資訊，請參閱<xref linkend="cha-iscsi-lio" xrefstyle="ChapTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="b15ds08c">
   <title>Linux 軟體 RAID</title>
   <para>針對 Linux 軟體 RAID 新增了下列加強功能︰</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jy5sx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy5sy" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy5sz" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15jy5sx">
    <title>對 Intel RSTe+ 的支援</title>
    <para>軟體 RAID 提供了對 Intel RSTe+ (Rapid Storage Technology Enterprise) 平台的改良支援，以支援 RAID 層級 0、1、4、5、6 和 10。</para>
   </sect3>
   <sect3 id="b15jy5sy">
    <title>LEDMON 公用程式</title>
    <para>LEDMON 公用程式支援 MD 軟體 RAID 的 PCIe-SSD 機殼指示燈。如需更多資訊，請參閱<xref linkend="cha-raids-lee" xrefstyle="ChapTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="b15jy5sz">
    <title>軟體 RAID 中的裝置順序</title>
    <para>在 YaST 磁碟分割程式的<guimenu>新增 RAID</guimenu> 精靈中，<guimenu>分類</guimenu>選項可讓您指定 Linux 軟體 RAID 中所選裝置的使用順序，以確保一半陣列位於一個磁碟子系統上，另一半陣列位於另一個磁碟子系統上。例如，如果一個磁碟子系統失敗，系統將從第二個磁碟子系統繼續執行。如需相關資訊，請參閱<xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/> 中的<xref linkend="b14dtk77" xrefstyle="StepXRef"/>。</para>
   </sect3>
  </sect2>
  <sect2 id="b15ds08g">
   <title>LVM2</title>
   <para>針對 LVM2 新增了下列加強功能︰</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jy33d" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jy33e" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15jy33d">
    <title>簡易池和簡易磁碟區</title>
    <para>可以簡易佈建 LVM 邏輯磁碟區。如需更多資訊，請參閱<xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/>。</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b15jy6mq">
       <title>簡易池︰</title>
       <para>邏輯磁碟區是保留給簡易磁碟區使用的空間池。簡易磁碟區可以視需要從簡易池中配置它們所需的空間。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b15jy6mr">
       <title>簡易磁碟區︰</title>
       <para>建立為疏鬆磁碟區的磁碟區。該磁碟區會視需要從簡易池配置所需的空間。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="b15jy33e">
    <title>簡易快照</title>
    <para>可以簡易佈建 LVM 邏輯磁碟區快照。如果您建立沒有指定大小的快照，系統就會使用簡易佈建。如需更多資訊，請參閱<xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
  </sect2>
  <sect2 id="b15ds08e">
   <title>多路徑 I/O</title>
   <para>針對多重路徑 I/O 進行了下列變更和加強︰</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b15jxva2" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jxva1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b15jxva0" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b15jxva2">
    <title>mpathpersist(8)</title>
    <para><command>mpathpersist(8)</command> 公用程式是新增功能。它可用來管理裝置對應程式多重路徑裝置上的 SCSI 永久保留。如需更多資訊，請參閱<xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="b15jxva1">
    <title>multipath(8)</title>
    <para>針對 <command>multipath(8)</command> 指令新增了下列加強︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para><literal>-r</literal> 選項可讓您強制重新載入裝置映射。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="b15jxva0">
    <title>/etc/multipath.conf</title>
    <para>裝置對應程式 - 多重路徑工具新增了針對 <filename>/etc/multipath.conf</filename> 檔案的下列加強︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b15jxy6m" role="intro">
       <title>udev_dir</title>
       <para/>
      </formalpara>
      <para>已廢棄 <literal>udev_dir</literal> 屬性。升級到 SLES 11 SP3 之後，您可以從 <filename>/etc/multipath.conf</filename> 檔案的 <literal>defaults</literal> 區段中移除下面一行︰</para>

<screen>
udev_dir /dev
</screen>

     </listitem>
     <listitem>
      <formalpara id="b15jxy6n" role="intro">
       <title>getuid_callout</title>
       <para/>
      </formalpara>
      <para>在 <filename>/etc/multipath.conf</filename> 檔案的 <literal>defaults</literal> 區段中，<literal>getuid_callout</literal> 屬性已廢棄，並以 <literal>uid_attribute</literal> 參數取代。此參數是提供唯一路徑識別碼的 udev 屬性。預設值為 <literal>ID_SERIAL</literal>。</para>
      <para>升級到 SLES 11 SP3 之後，您可以修改 <filename>/etc/multipath.conf</filename> 檔案之 <literal>defaults</literal> 區段中的屬性︰ </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>從 <literal>defaults</literal> 區段中移除下面一行︰</para>

<screen>
  getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

       </listitem>
       <listitem>
        <para>在 <literal>defaults</literal> 區段中新增下面一行：</para>

<screen>
  uid_attribute "ID_SERIAL"
</screen>

       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <formalpara id="b15jxy6o" role="intro">
       <title>path_selector</title>
       <para/>
      </formalpara>
      <para>在 <filename>/etc/multipath.conf</filename> 檔案的 <literal>defaults</literal> 區段中，<literal>path_selector</literal> 屬性的預設值已從 <literal>"round-robin 0"</literal> 變更為 <literal>"service-time 0"</literal>。<literal>service-time</literal> 選項會根據路徑的未執行 I/O 數量及其相應輸送量選擇下一批 I/O。 </para>
      <para>升級到 SLES 11 SP3 之後，您可以修改 <filename>/etc/multipath.conf</filename> 檔案之 <literal>defaults</literal> 區段中的屬性值，以使用建議的預設值︰ </para>

<screen>
  path_selector "service-time 0"
</screen>

     </listitem>
     <listitem>
      <formalpara id="b15jxy6p" role="intro">
       <title>user_friendly_names</title>
       <para/>
      </formalpara>
      <para><literal>user_friendly_names</literal> 屬性可在 <literal>devices</literal> 區段和 <literal>multipaths</literal> 區段中設定。</para>
     </listitem>
     <listitem>
      <formalpara id="b15jxy6q" role="intro">
       <title>max_fds</title>
       <para/>
      </formalpara>
      <para role="intro"><literal>max_fds</literal> 屬性的預設設定已變更為 <literal>max</literal>：這允許多重路徑精靈在監控路徑時開啟系統允許開啟的最大檔案描述子數量。 </para>
      <para role="intro">升級到 SLES 11 SP3 之後，您可以在 <filename>/etc/multipath.conf</filename> 檔案中修改該屬性值︰ </para>

<screen>
max_fds "max"
</screen>

     </listitem>
     <listitem>
      <formalpara id="b15jxy6r" role="intro">
       <title>reservation_key</title>
       <para/>
      </formalpara>
      <para role="intro">在 <filename>/etc/multipath.conf</filename> 檔案的 <literal>defaults</literal> 或 <literal>multipaths</literal> 區段中，<literal>reservation_key</literal> 屬性可用於指定與 <command>mpathpersist(8)</command> 公用程式搭配使用的服務動作保留金鑰，以管理裝置對應程式多重路徑裝置的永久保留。系統預設不會使用該屬性。如果未設定該屬性，<command>multipathd</command> 精靈將不會檢查新探查到的路徑或已重新啟用之路徑的永久保留。 </para>

<screen>
reservation_key &lt;<replaceable>reservation key</replaceable>&gt;
</screen>

      <para>例如：</para>

<screen>
multipaths {
        multipath {
                          wwid   XXXXXXXXXXXXXXXX
                         alias      yellow
                         reservation_key  0x123abc
      }
}
</screen>

      <para> 如需設定永久保留的相關資訊，請參閱<xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
     <listitem>
      <formalpara id="b15jxy6s" role="intro">
       <title>hardware_handler</title>
       <para/>
      </formalpara>
      <para>在 SCSI 層中新增了 4 個可以與 DM-Multipath 搭配使用的 SCSI 硬體處理程式︰ </para>
      <simplelist>
       <member><filename>scsi_dh_alua</filename> </member> <member><filename>scsi_dh_rdac</filename> </member> <member><literal>scsi_dh_hp_sw</literal> </member> <member><literal>scsi_dh_emc</literal> </member>
      </simplelist>
      <para>這些處理程式是在 Linux 核心中 SCSI 目錄下建立的模組。以前使用的是裝置對應程式層中的硬體處理程式。</para>
      <para>將模組新增至 <filename>initrd</filename> 影像，然後在 <filename>/etc/multipath.conf</filename> 檔案中將它們指定為 <literal>alua</literal>、<literal>rdac</literal>、<literal>hp_sw</literal> 和 <literal>emc</literal> 硬體處理程式類型。如需將裝置驅動程式新增至 <filename>initrd</filename> 影像的相關資訊，請參閱<xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="bwkb7my">
  <title>SLES 11 SP2 中的新增功能</title>
  <para>除了錯誤修正之外，本節所述的是 SUSE Linux Enterprise Server 11 SP2 版本的功能與行為變更︰</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>Btrfs 檔案系統。請參閱<xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>乙太網路上的開放光纖通道。請參閱<xref linkend="cha-fcoe" xrefstyle="ChapTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>LVM 儲存物件的標記。請參閱<xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>NFSv4 ACL 工具。請參閱<xref linkend="nfsv4acls" xrefstyle="ChapTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para><command>mdadm resize</command> 指令的 <command>--assume-clean</command> 選項。請參閱<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>。</para>
   </listitem>
   <listitem>
    <para>在 <filename>/etc/multipath.conf</filename> 檔案的 <literal>defaults</literal> 區段中，<literal>default_getuid</literal> 參數已過時並且已由 <literal>getuid_callout</literal> 參數取代︰</para>
    <para>該行已從</para>

<screen>
  default_getuid "/sbin/scsi_id -g -u -s /block/%n"
</screen>

    <para>變更為</para>

<screen>
  getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 id="bndgyod">
  <title>SLES 11 SP1 中的新增功能</title>
  <para>除了錯誤修正之外，本節所述的是 SUSE Linux Enterprise Server 11 SP1 版本中的功能與行為變更。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bnmqoyw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmr1a1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmqre5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmti6z" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtvr8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmrccr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmrfnk" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtwna" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmss2g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmszsy" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bnmtqql" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bnmqoyw">
   <title>儲存 iSCSI 目標資訊</title> 
   <para>在<link linkend="sec-inst-system-iscsi-target-yast"><guimenu>YaST</guimenu>〉<guimenu>網路服務</guimenu>〉<guimenu>iSCSI 目標</guimenu></link>功能中，新增了<guimenu>儲存</guimenu>選項，可讓您輸出 iSCSI 目標資訊。這樣，為資源使用者提供資訊便會更為方便。</para>
  </sect2>
  <sect2 id="bnmr1a1">
   <title>在 iSCSI 啟動器中修改驗證參數</title> 
   <para>在<link linkend="sec-inst-system-iscsi-target-yast"><guimenu>YaST</guimenu>〉<guimenu>網路服務</guimenu>〉<guimenu>iSCSI 啟動器</guimenu></link>功能中，您可以修改用於連接目標裝置的驗證參數。以前，您需要先刪除該項目然後重新建立，才能變更驗證資訊。</para>
  </sect2>
  <sect2 id="bnmqre5">
   <title> 允許針對 MPIO 裝置進行永久保留</title> 
   <para>SCSI 啟動器可以對共享的儲存裝置施加 SCSI 保留，如此可將其他伺服器上的 SCSI 啟動器鎖定在外，阻止其存取該裝置。即使 SCSI 例外處理程序進行 SCSI 重設時，這些保留也依然存在。</para>
   <para>以下情況可能需要使用 SCSI 保留：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para> 在簡單的 SAN 環境中，若嘗試將某 LUN 新增至一部伺服器，而該 LUN 正被其他伺服器所使用，則可能會導致資料損毀，永久的 SCSI 保留有助於防止出現此類管理員錯誤。SAN 分區通常用於防止出現此類錯誤。 </para>
    </listitem>
    <listitem>
     <para>在設定了容錯移轉的高可用性環境中，永久的 SCSI 保留有助於防止連錯路徑的伺服器連接到其他伺服器所保留的 SCSI 裝置。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bnmti6z">
   <title>MDADM 3.0.2</title> 
   <para>使用最新版本的多裝置管理 (MDADM，<command>mdadm</command>)，其中提供了一些錯誤修正並改進了部分功能。</para>
  </sect2>
  <sect2 id="bnmtvr8">
   <title>MDRAID 外部中繼資料的開機載入程式支援</title> 
   <para>新增了該支援以使用 MDADM 公用程式 3.0 版的外部中繼資料功能，從 Intel 矩陣儲存技術中繼資料格式所定義的 RAID 磁碟區安裝和執行作業系統。這就將該功能從裝置對應程式 RAID (DMRAID) 基礎架構移轉到多裝置 RAID (MDRAID) 基礎架構，從而提供更為成熟的 RAID 5 實作，以及更豐富的 MD 核心基礎架構功能。如此，在包括 Intel、DDF (常用 RAID 磁碟資料格式) 和原始 MD 中繼資料在內的所有中繼資料格式中都可使用常用 RAID 驅動程式。</para>
  </sect2>
  <sect2 id="bnmrccr">
   <title>MDRAID 外部中繼資料的 YaST 安裝和開機支援</title> 
   <para> 在 YaST 安裝程式工具中新增了對 RAID 0、1、10、5 和 6 的 MDRAID 外部中繼資料支援。該安裝程式可以偵測 RAID 陣列以及平台是否啟用了 RAID 功能。若適用於 Intel Matrix Storage Manager 的平台 BIOS 中啟用多重路徑 RAID，安裝程式會提供「DMRAID」、「MDRAID」(建議) 選項；若未啟用，則不提供任何選項。此外還修改了 <filename>initrd</filename>，以支援將基於 BIOS 的 RAID 陣列組合起來的功能。 </para>
  </sect2>
  <sect2 id="bnmrfnk">
   <title>包含根檔案系統之 MDRAID 陣列的關機已改進</title>  
   <para>關機程序檔已修改為等待所有 MDRAID 陣列標示為清空。現在，作業系統關機程序會一直等待改動位元的清除，直到所有 MDRAID 磁碟區完成寫入作業為止。 </para>
   <para>對啟動程序檔、關機程序檔以及 <command>initrd</command> 進行了變更，以確定根 (<filename>/</filename>) 檔案系統 (包含作業系統與應用程式檔案的系統磁碟區) 是否駐留在軟體 RAID 陣列中。陣列的中繼資料處理器在關機程序中較早啟動，以在關機過程中監控最終的根檔案系統環境。該處理器已從一般 <command>killall</command> 事件中排除。該程序還允許在關機結束時靜止寫入並清除陣列的中繼資料改動位元 (指示陣列是否需要重新同步)。</para>
  </sect2>
  <sect2 id="bnmtwna">
   <title>iSCSI 裝置上的 MD</title> 
   <para>現在，YaST 安裝程式允許經由 iSCSI 裝置設定 MD。 </para>
   <para>若開機時需要 RAID 陣列，則會在 <filename>boot.md</filename> 之前載入 iSCSI 啟動器軟體，以便為系統提供針對 RAID 自動設定的 iSCSI 目標。</para>
   <para>若是新的安裝，Libstorage 會建立 <filename>/etc/mdadm.conf</filename> 檔案，並新增 <literal>AUTO -all</literal> 一行。更新期間不會新增該行。若 <filename>/etc/mdadm.conf</filename> 包含該行， </para>

<screen>
AUTO -all
</screen>

   <para>則所有 RAID 陣列均不會自動組合，除非 <filename>/etc/mdadm.conf</filename> 中明確列出了某些陣列。</para>
  </sect2>
  <sect2 id="bnmss2g">
   <title>MD-SGPIO</title> 
   <para>MD-SGPIO 公用程式是一個獨立應用程式，可透過 <command>sysfs(2)</command> 監控 RAID 陣列。有些事件會觸發控制指示燈閃爍的指示燈變更申請，而這些指示燈與機箱或儲存子系統磁碟機槽中的每個插槽相關聯。它支援兩種類型的指示燈系統： </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>雙指示燈系統 (活動指示燈和狀態指示燈)</para>
    </listitem>
    <listitem>
     <para>三指示燈系統 (活動指示燈、位置指示燈和失敗指示燈)</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bnmszsy">
   <title>調整 LVM 2 鏡像大小 </title> 
   <para>修改了用於調整邏輯磁碟區大小的 <command>lvresize</command>、<command>lvextend</command> 與 <command>lvreduce</command> 指令，以允許調整 LVM 2 鏡像的大小。以前，如果邏輯磁碟區是一個鏡像，這些指令便會報告錯誤。 </para>
  </sect2>
  <sect2 id="bnmtqql">
   <title>更新適用於 IBM 伺服器上之介面卡的儲存驅動程式</title> 
   <para>更新以下儲存驅動程式以使用最新的可用版本支援 IBM 伺服器上的儲存介面卡。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>Adaptec︰<filename>aacraid</filename>、<filename>aic94xx</filename></para>
    </listitem>
    <listitem>
     <para>Emulex︰<filename>lpfc</filename></para>
    </listitem>
    <listitem>
     <para>LSI︰<filename>mptas</filename>、<filename>megaraid_sas</filename></para>
     <para>現在，<filename>mptsas</filename> 驅動程式支援原生 EEH (增強型錯誤處理器) 復原，這是進階平台使用者所有 IO 裝置的核心功能。 </para>
    </listitem>
    <listitem>
     <para>qLogic︰<filename>qla2xxx</filename>、<filename>qla3xxx</filename>、<filename>qla4xxx</filename></para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 id="bndgyoe">
  <title>SLES 11 中的新增功能</title>
  <para>本節中記錄的功能與行為變更針對的是 SUSE Linux Enterprise Server 11 版本。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bi72tak" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bi72zf2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12xr11r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu3u2m" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu3v96" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bin8klb" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="binagtl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="binahn3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bin9wm3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmqiv07" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy1edt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bn4yxd1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bvc111p" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bi72tak">
   <title>EVMS2 已廢棄</title>
   <para>企業磁碟區管理系統 (EVMS2) 儲存管理解決方案已廢棄。SUSE Linux Enterprise Server 11 套件中已移除了所有 EVMS 管理模組。您在升級系統時，Linux Volume Manager 2 (LVM2) 會自動識別 EVMS 管理的非系統裝置並加以管理。如需詳細資訊，請參閱<ulink url="http://www.novell.com/linux/volumemanagement/strategy.html"><citetitle>《Evolution of Storage and Volume Management in SUSE Linux Enterprise》(SUSE Linux Enterprise 中儲存和磁碟區管理的演進)</citetitle></ulink>。</para>
   <para>如果您讓 EVMS 管理系統裝置 (包含根 (<filename>/</filename>)、<filename>/boot</filename> 或 <filename>swap</filename> 的任何裝置)，可以在將 SLES 10 伺服器重新開機以便升級之前，嘗試執行以下步驟準備伺服器︰</para>
   <procedure id="b176hy1d">
    <step id="b176hy1e" performance="required">
     <para>在 /etc/fstab 檔案中，將開機和交換磁碟修改到預設 <filename>/dev/system/sys_lx</filename> 目錄︰</para>
     <substeps performance="required">
      <step id="b176hy1f" performance="required">
       <para>從 <filename>swap</filename> 和根 (<filename>/</filename>) 分割區的路徑中移除 <filename>/evms/lvm2</filename>。</para>
      </step>
      <step id="b176hy1g" performance="required">
       <para>從 <filename>/boot</filename> 分割區的路徑中移除 <filename>/evms</filename>。</para>
      </step>
     </substeps>
    </step>
    <step id="b176hy1h" performance="required">
     <para>在 <filename>/boot/grub/menu.lst</filename> 檔案中，從路徑中移除 <filename>/evms/lvm2</filename>。 </para>
    </step>
    <step id="b176hy1i" performance="required">
     <para>在 <filename>/etc/sysconfig/bootloader</filename> 檔案中，驗證根裝置的路徑是否為 <filename>/dev</filename> 目錄。</para>
    </step>
    <step id="b176hy1j" performance="required">
     <para>確定 <filename>boot.lvm</filename> 和 <filename>boot.md</filename> 均已啟用︰</para>
     <substeps performance="required">
      <step id="b176hy1k" performance="required">
       <para>在 YaST 中，按一下<guimenu>系統</guimenu><guimenu>執行層級編輯器</guimenu><guimenu>進階模式</guimenu>。</para>
      </step>
      <step id="b176hy1l" performance="required">
       <para>選取 <filename>boot.lvm</filename>。</para>
      </step>
      <step id="b176hy1m" performance="required">
       <para>按一下<guimenu>設定/重設</guimenu><guimenu>啟用服務</guimenu>。</para>
      </step>
      <step id="b176hy1n" performance="required">
       <para>選取 <filename>boot.md</filename>。</para>
      </step>
      <step id="b176hy1o" performance="required">
       <para>按一下<guimenu>設定/重設</guimenu><guimenu>啟用服務</guimenu>。</para>
      </step>
      <step id="b176hy1p" performance="required">
       <para>按一下<guimenu>完成</guimenu>，然後按一下<guimenu>是</guimenu>。</para>
      </step>
     </substeps>
    </step>
    <step id="b176hy1q" performance="required">
     <para>重新開機並開始升級。 </para>
    </step>
   </procedure>
   <para>如需有關在 SUSE Linux Enterprise Server 10 中使用 EVMS2 管理儲存的資訊，請參閱<ulink url="http://www.novell.com/documentation/sles10/stor_admin/data/bookinfo.html"><citetitle>《SUSE Linux Enterprise Server 10 SP3：儲存管理指南》</citetitle></ulink>。</para>
  </sect2>
  <sect2 id="bi72zf2">
   <title>Ext3 做為預設檔案系統</title>
   <para>Ext3 檔案系統已取代 ReiserFS 做為 YaST 工具在安裝和建立檔案系統時建議使用的預設檔案系統。ReiserFS 仍受支援。如需詳細資訊，請參閱 <citetitle>SUSE Linux Enterprise 11 技術規格</citetitle>網頁上的<ulink url="http://www.novell.com/linux/techspecs.html?tab=2"><citetitle>《File System Support》(檔案系統支援)</citetitle></ulink>。</para>
  </sect2>
  <sect2 id="b12xr11r">
   <title>Ext3 的預設 Inode 大小已增大</title>
   <para>為了給 Ext3 檔案系統上檔案的延伸屬性和 ACL 留出空間，Ext3 的預設 Inode 大小已從 SLES 10 上的 128 位元組增大到 SLES11 上的 256 位元組。如需更多資訊，請參閱<xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/>。</para>
  </sect2>
  <sect2 id="biu3u2m">
   <title>JFS 檔案系統已廢棄</title>
   <para>不再支援 JFS 檔案系統，已從該套裝作業系統中移除 JFS 公用程式。</para>
  </sect2>
  <sect2 id="biu3v96">
   <title>OCFS2 檔案系統包含於高可用性版本中</title>
   <para>SUSE Linux Enterprise 高可用性延伸完全支援 OCFS2 檔案系統。</para>
  </sect2>
  <sect2 id="bin8klb">
   <title>/dev/disk/by-name 已廢棄</title>
   <para>在 SUSE Linux Enterprise Server 11 套件中，<filename>/dev/disk/by-name</filename> 路徑已廢棄。 </para>
  </sect2>
  <sect2 id="binagtl">
   <title>/dev/disk/by-id 目錄中的裝置名稱永久不變</title>
   <para>在 SUSE Linux Enterprise Server 11 中，當啟動多重路徑時，預設多重路徑設定依賴 <command>udev</command> 覆寫 <filename>/dev/disk/by-id</filename> 目錄中的現存符號連結。在您啟動多重路徑之前，該連結透過使用裝置的 <filename>scsi-xxx</filename> 名稱來指向 SCSI 裝置。當多重路徑正在執行時，該符號連結則透過使用裝置的 <filename>dm-uuid-xxx</filename> 名稱來指向裝置。這樣可確保不論多重路徑是否啟動，<filename>/dev/disk/by-id</filename> 路徑中的符號連結始終指向同一裝置。由於 <filename>lvm.conf</filename> 和 <filename>md.conf</filename> 等組態檔案會自動指向正確的裝置，所以無須對其進行修改。</para>
   <para>如需關於此行為變更如何影響其他功能的詳細資訊，請參閱以下各節︰</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="binahn3" xrefstyle="SectTitleOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bin9wm3" xrefstyle="SectTitleOnPage"/></para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="binahn3">
   <title>多重路徑裝置的過濾器</title>
   <para><filename>/dev/disk/by-name</filename> 目錄的廢棄 (如<xref linkend="bin8klb" xrefstyle="SectTitleOnPage"/> 中所述) 會影響您在組態檔案中設定多重路徑裝置過濾器的方式。若在 <filename>/etc/lvm/lvm.conf</filename> 檔案中，多重路徑裝置過濾器使用的是 <filename>/dev/disk/by-name</filename> 裝置名稱路徑，則您需要將該檔案修改為使用 <filename>/dev/disk/by-id</filename> 路徑。設定使用 <filename>by-id</filename> 路徑的過濾器時，請注意以下事項：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><filename>/dev/disk/by-id/scsi-*</filename> 裝置名稱永久不變，且建立它僅是為了該目的。</para>
    </listitem>
    <listitem>
     <para>不要在過濾器中使用 <filename>/dev/disk/by-id/dm-*</filename> 名稱。它們是裝置對應程式裝置的符號連結，使用這些名稱會導致在回應 <filename>pvscan</filename> 指令時報告重複的 PV。這些名稱會從 <filename>LVM-pvuuid</filename> 變更為 <filename>dm-uuid</filename>，再變回 <filename>LVM-pvuuid</filename>。</para>
    </listitem>
   </itemizedlist>
   <para>如需關於設定過濾器的資訊，請參閱<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="bin9wm3">
   <title>多重路徑裝置的使用者易記名稱</title>
   <para>在 <filename>/dev/disk/by-id</filename> 目錄中對多重路徑裝置名稱處理方式的變更 (如<xref linkend="binagtl" xrefstyle="SectTitleOnPage"/> 中所述) 會影響您對使用者易記名稱的設定，因為裝置的這兩個名稱有所不同。您必須將組態檔案修改為在設定多重路徑後僅掃描裝置對應程式名稱。</para>
   <para>例如，您需要修改 <filename>lvm.conf</filename> 檔案以使用多重路徑裝置名稱進行掃描，方法是指定 <filename>/dev/disk/by-id/dm-uuid-.*-mpath-.*</filename> 路徑，而非 <filename>/dev/disk/by-id</filename>。</para>
  </sect2>
  <sect2 id="bmqiv07">
   <title>多重路徑的進階 I/O 負載平衡選項</title>
   <para>除了輪替之外，系統還提供了以下適用於裝置對應程式多重路徑的進階 I/O 負載平衡選項︰</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>Least-pending</para>
    </listitem>
    <listitem>
     <para>Length-load-balancing</para>
    </listitem>
    <listitem>
     <para>Service-time</para>
    </listitem>
   </itemizedlist>
   <para>如需相關資訊，請參閱<xref linkend="beg263n" xrefstyle="HeadingOnPage"/> 中的<xref linkend="b122sbgu" xrefstyle="RefNoPage"/>。</para>
  </sect2>
  <sect2 id="bmy1edt">
   <title>多重路徑工具 Callout 的位置變更</title>
   <para>裝置對應程式多重路徑工具的 <filename>mpath_*</filename> prio_callout 已移至位於 <filename>/lib/libmultipath/lib*</filename> 中的共享程式庫中。透過使用共享程式庫，callout 會在精靈啟動時載入到記憶體中。這有助於避免在所有路徑失效的情況下出現系統鎖死，例如當需要從磁碟載入程式而磁碟此時不可用的情況下。</para>
  </sect2>
  <sect2 id="bn4yxd1">
   <title>mkinitrd -f 的選項從 mpath 變更為 multipath</title>
   <para>將裝置對應程式多重路徑服務新增到 <filename>initrd</filename> 的選項已從 <literal>-f mpath</literal> 變更為 <literal>-f multipath</literal>。 </para>
   <para>若要建立新的 <filename>initrd</filename>，現在指令變更為：</para>

<screen>
mkinitrd -f multipath
</screen>

  </sect2>
  <sect2 id="bvc111p">
   <title>MPIO 路徑群組規則的預設設定從多重匯流排變更為容錯移轉</title>
   <para>在 <filename>/etc/multipath.conf</filename> 檔案中，<literal>path_grouping_policy</literal> 的預設設定已從 <literal>multibus</literal> 變更為 <literal>failover</literal>。 </para>
   <para>如需設定 path_grouping_policy 的詳細資訊，請參閱<xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
 </sect1>
</chapter>

<chapter id="storplan" lang="zh-tw" xml:base="01_planning.xml">
 <title>規劃儲存解決方案</title>
 <para>請考慮所需儲存及如何才能有效地管理和分割儲存空間以最大限度地滿足您的需要。本章中的資訊可幫助您規劃 SUSE Linux Enterprise Server 11 伺服器上檔案系統的儲存部署。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi72kf0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72p1s" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72o4h" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi72q5v" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi739fa" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi72kf0">
  <title>分割裝置</title>
  <para>如需使用 YaST 進階磁碟分割程式的資訊，請參閱<citetitle>《SUSE Linux Enterprise Server 11 安裝與管理指南》</citetitle>中的<quote>使用 YaST 磁碟分割程式</quote>。</para>
 </sect1>
 <sect1 id="bi72p1s">
  <title>多重路徑支援</title>
  <para>Linux 支援使用多重 I/O 路徑在伺服器及其儲存裝置之間建立容錯連接。預設會停用 Linux 多重路徑支援。如果您使用的是儲存子系統廠商提供的多重路徑解決方案，則不必分別設定 Linux 多重路徑。</para>
 </sect1>
 <sect1 id="bi72o4h">
  <title>軟體 RAID 支援</title>
  <para>Linux 支援硬體和軟體 RAID 裝置。如果您使用的是硬體 RAID 裝置，則無需軟體 RAID 裝置。可以在同一伺服器上同時使用硬體和軟體 RAID 裝置。</para>
  <para>為了最大化軟體 RAID 裝置的效能優點，RAID 使用的分割區應來自不同的實體裝置。對於軟體 RAID 1 裝置，鏡像複製分割區無法共用任何相同的磁碟。</para>
 </sect1>
 <sect1 id="bi72q5v">
  <title>檔案系統快照</title>
  <para>Linux 支援檔案系統快照。</para>
 </sect1>
 <sect1 id="bi739fa">
  <title>備份與防毒支援</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="biu2e2j" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biu2e2k" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="biu2e2j">
   <title>開放原始碼備份</title>
   <para>用於在 Linux 上進行資料備份的開放原始碼工具包括 <command>tar</command>、<command>cpio</command> 和 <command>rsync</command>。如需詳細資訊，請參閱這些工具的 man 頁面。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>PAX：POSIX 檔案系統歸檔程式。該歸檔程式支援最常用的兩種標準歸檔 (備份) 檔案格式 <command>cpio</command> 和 <command>tar</command>。若需更多資訊，請參閱 man 頁面。</para>
    </listitem>
    <listitem>
     <para>Amanda：進階馬里蘭自動網路磁碟歸檔程式。請造訪 <ulink url="http://www.amanda.org/">www.amanda.org</ulink>。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="biu2e2k">
   <title>商業備份與防毒支援</title>
   <para>Novell Open Enterprise Server (OES) 2 for Linux 產品中包含 SUSE Linux Enterprise Server (SLES) 10。防毒和備份軟體廠商同時支援 OES 2 和 SLES 10。您可以造訪廠商網站瞭解他們排定的 SLES 11 支援。 </para>
   <para>如需目前可用的備份和防毒軟體廠商清單，請參閱 <ulink url="http://www.novell.com/products/openenterpriseserver/partners_communities.html"><citetitle>Novell Open Enterprise Server 合作夥伴支援：備份和防毒支援</citetitle></ulink>。此清單每季度更新一次。</para>
  </sect2>
 </sect1>
</chapter>

<chapter id="lvm" lang="zh-tw" xml:base="02_lvm.xml">
 <title>LVM 組態</title>
 <para>本章概述了邏輯磁碟區管理員 (LVM) 背後的原則，以及可適合多種狀況下使用的基本功能。YaST LVM 組態可透過 YaST 進階磁碟分割程式來完成。這個磁碟分割工具讓您編輯和刪除現有磁碟分割，以及建立應該與 LVM 一起使用的新磁碟分割。</para>
 <warning>
  <para>使用 LVM 可能會增加風險，如遺失資料。這些危險也包括應用程式當機、電源中斷和錯誤指令。執行 LVM 或重新設定磁碟區前，請儲存您的資料。決不要在沒有備份的情形下工作。 </para>
 </warning>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec-yast2-system-lvm-explanation" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi706ct" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8b" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvm-activate-vgs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgpqe2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgqpfy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuz4lz" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgpmw3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgob84" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="btx9jxu" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sec-yast2-system-lvm-explanation">
  <title>瞭解邏輯磁碟區管理員</title>
  <para>LVM 可以跨數個檔案系統彈性地分配硬碟空間。在安裝過程中，僅當完成首次磁碟分割時需要變更硬碟空間的分割，由此開發了此工具。因為要修改正在執行之系統上的分割區很困難，LVM 提供了記憶體空間的虛擬集區 (磁碟區群組，或 VG)，需要時，可從虛擬集區建立邏輯磁碟區 (LV)。作業系統可以存取這些 LV，而不是存取實體分割區。磁碟區群組可以延伸至一個以上的磁碟，因此數個磁碟或是數個磁碟的某些部份可能會構成單一的 VG。借此，LVM 提供了一種從實體磁碟空間進行擷取的方法，允許使用比實體磁碟重新分割更為簡單和安全的方式來變更分割。 </para>
  <para role="intro"><xref linkend="bo1t1qx" xrefstyle="FigureXRef"/>比較實體分割 (左邊) 與 LVM 分割 (右邊)。在左邊，單一個磁碟已分割為三個實體分割區 (PART)，每一個都會指定掛接點 (MP)，讓作業系統存取它們。在右邊，已經個別將兩個磁碟分割成兩個及三個實體分割區。已經定義兩個 LVM 磁碟區群組 (VG1 與 VG2)。VG 1 包含 DISK 1 的兩個磁碟區以及 DISK 2 的一個磁碟區。VG 2 包含 DISK 2 其餘的兩個磁碟區。 </para>
  <figure pgwide="0" id="bo1t1qx">
   <title>實體分割與 LVM</title>
   <mediaobject>
    <imageobject role="fo">
    <imagedata fileref="lvm.png" width="445pt" format="eps"/></imageobject>
    <imageobject role="html">
    <imagedata fileref="lvm.png" width="445pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>在 LVM 中，併入一個磁碟區群組中的實體磁碟分割區稱為實體磁碟區 (PV)。在<xref linkend="bo1t1qx" xrefstyle="FigureXRef"/> 中的磁碟區群組中，已經定義四個邏輯磁碟區 (LV 1 至 LV 4)，作業系統可以透過關聯的掛接點來使用這些邏輯磁碟區。在不同的邏輯磁碟區之間的邊緣，不需要對齊任何分割區的邊緣。請參閱此範例中 LV 1 與 LV 2 之間的邊緣。 </para>
  <para>LVM 功能： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>數個硬碟或分割區可以在大的邏輯磁碟區結合成一個。 </para>
   </listitem>
   <listitem>
    <para>如果組態適用，當可用空間耗盡時，可以擴大 LV (如 <filename>/usr</filename>)。 </para>
   </listitem>
   <listitem>
    <para>使用 LVM，就可以在執行的系統中新增硬碟或 LV。然而，這種作法需要能執行此動作的熱交換式硬體。 </para>
   </listitem>
   <listitem>
    <para>可以啟動<emphasis>分割模式</emphasis>，將邏輯磁碟區的資料流分散至數個實體磁碟區。如果這些實體磁碟區是在不同的磁碟上，這可改善讀寫效能，就像 RAID 0 一樣。 </para>
   </listitem>
   <listitem>
    <para>快照功能能夠讓執行系統中的備份 (特別是伺服器) 成為一致。 </para>
   </listitem>
  </itemizedlist>
  <para>使用 LVM 的這些功能，對於使用頻繁的家用個人電腦或小型伺服器而言，在效能上可以看到改善。如果您在資料庫、音樂歸檔或使用者目錄中的資料會一直累積，LVM 就是非常適用的工具。可允許比實體硬碟還大的檔案系統。LVM 的另一個好處是最大可以增加到 256 個 LV。不過，請記住使用 LVM 與使用傳統分割區是不同的。 </para>
  <para>從核心 2.6 版本開始，即可使用 LVM 2 版本，它可以向下相容之前的 LVM，而且可以繼續管理舊的磁碟區群組。建立新的磁碟區群組時，請決定要使用新的格式或能夠向下相容的版本。LVM 2 不需要任何核心修補程式。這會用到整合於核心 2.6 中的裝置對應程式。此核心僅支援 LVM 第 2 版。因此，提到 LVM 時，本節一律指的是 LVM 第  2 版。 </para>
  <para>您可以使用 YaST 磁碟分割程式來管理新的或現有的 LVM 儲存物件。有關設定 LVM 的指示及詳細資訊，請參閱官方網站的 <ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"><citetitle>LVM HOWTO</citetitle></ulink>。 </para>
  <important>
   <para>如果在設定 LVM 之後新增多重路徑支援，您必須修改 <filename>/etc/lvm/lvm.conf</filename> 檔案，以便僅掃描 <filename>/dev/disk/by-id</filename> 目錄中的多重路徑裝置名稱 (如<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/> 中所述)，然後將伺服器重新開機。</para>
  </important>
 </sect1>
 <sect1 id="bi706ct">
  <title>建立 LVM 分割區</title>
  <para>對每個磁碟，將要用於 LVM 的可用空間分割為 <literal>0x8E Linux LVM</literal>。您可以在單個裝置上建立一或多個 LVM 分割區。裝置上的所有分割區不必都是 LVM 分割區。 </para>
  <para>您可以使用磁碟區群組功能，將一或多個 LVM 分割區分組到稱為磁碟區群組的邏輯空間池中，然後從磁碟區群組中的空間切出一或多個邏輯磁碟區。</para>
  <para>當您在 YaST 磁碟分割程式中建立 LVM 分割區時，只能使用磁碟上的可用空間。如果想將整個磁碟用於單個 LVM 分割區，而此磁碟上已有其他分割區，則必須先移除所有現有的分割區以釋放空間，然後才能在 LVM 分割區中使用該部分空間。 </para>
  <warning>
   <para>刪除分割區會損毀該分割區中的所有資料。 </para>
  </warning>
  <procedure id="bq2fjmu">
   <step id="bq2fjmv" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="bq2fk0j" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgn1yt" performance="required">
    <para>(選擇性) 移除一或多個現有的分割區，以釋放該部分空間並使它可供您用來建立 LVM 分割區。</para>
    <para>如需更多資訊，請參閱<xref linkend="brgob84" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
   <step id="bq2fk9e" performance="required">
    <para>在「分割區」頁面上，按一下<guimenu>新增</guimenu>。</para>
   </step>
   <step id="brgodov" performance="required">
    <para>在<guimenu>新分割區類型</guimenu>下，選取<guimenu>主分割區</guimenu>或<guimenu>延伸分割區</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="brgoefx" performance="required">
    <para role="intro">指定<guimenu>新分割區大小</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
    <informaltable role="1" frame="topbot" rowsep="0" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgpexh">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm2_a.png" width="151pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <itemizedlist mark="bullet" spacing="normal">
          <listitem>
           <formalpara id="brgof07">
            <title>最大大小︰</title>
            <para>使用磁碟上的所有可用空間。</para>
           </formalpara>
          </listitem>
          <listitem>
           <formalpara id="brgooyf">
            <title>自定大小：</title>
            <para>指定最大為磁碟上可用空間量的大小。</para>
           </formalpara>
          </listitem>
          <listitem>
           <formalpara id="brgooyg">
            <title>自定區域：</title>
            <para>指定磁碟上可用空間的開始和結束磁柱。</para>
           </formalpara>
          </listitem>
         </itemizedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgpahi" performance="required">
    <para role="intro">設定分割區格式：</para>
    <informaltable role="1" frame="topbot" rowsep="0" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgpi5z">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm3_a.png" width="139pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>不格式化</guimenu>。</para>
          </listitem>
          <listitem>
           <para>從<guimenu>檔案系統 ID</guimenu>下拉式清單中，選取<guimenu>0x8E Linux LVM</guimenu>做為分割區識別碼。</para>
          </listitem>
          <listitem>
           <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>不掛接分割區</guimenu>。</para>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgosll" performance="required">
    <para>按一下<guimenu>完成</guimenu>。</para>
    <para>直到您按<guimenu>下一步</guimenu>和<guimenu>完成</guimenu>離開分割程式後，分割區才會真正建立。</para>
   </step>
   <step id="bq2fkxr" performance="required">
    <para>對要新增的每個 Linux LVM 分割區重複<xref linkend="bq2fk9e" xrefstyle="StepXRef"/> 至<xref linkend="brgosll" xrefstyle="StepXRef"/>。 </para>
   </step>
   <step id="brgouy6" performance="required">
    <para>按<guimenu>下一步</guimenu>，確認新的 Linux LVM 分割區有列出，然後按一下<guimenu>完成</guimenu>離開分割程式。</para>
   </step>
   <step id="bq2fl52" performance="required">
    <para>(選擇性) 繼續依照<xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/> 中所述設定磁碟區群組組態。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchx8a">
  <title>建立磁碟區群組</title>
  <para>LVM 磁碟區群組會將 Linux LVM 分割區整理到一個邏輯空間池中。您可以從群組的可用空間中切出邏輯磁碟區。群組中的 Linux LVM 分割區可以位於相同磁碟也可以位於不同的磁碟上。您可以從相同或不同的磁碟新增 LVM 分割區來擴大群組的大小。指定為 LVM 保留的所有分割區給磁碟區群組。否則，仍然不會使用分割區上的空間。</para>
  <procedure id="brgncwg">
   <step id="brgnjca" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="brgnjcb" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgncwh" performance="required">
    <para>在左側面板中，按一下<guimenu>磁碟區管理</guimenu>。</para>
    <para>右側面板中即會列出現有磁碟區群組的清單。</para>
   </step>
   <step id="brgnd6f" performance="required">
    <para role="intro">在「磁碟區管理」頁面左下方，按一下<guimenu>新增磁碟區群組</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm4_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgndwo" performance="required">
    <para>指定<guimenu>磁碟區群組名稱</guimenu>。</para>
    <para>如果您要在安裝時建立磁碟區群組，建議為將包含 SUSE Linux Enterprise Server 系統檔案的磁碟區群組指定 <literal>system</literal> 名稱。</para>
   </step>
   <step id="brgnght" performance="required">
    <para>指定<guimenu>實體範圍大小</guimenu>。</para>
    <para><guimenu>實體範圍大小</guimenu>定義磁碟區群組中實體區塊的大小。在卷冊群組中的所有磁碟空間都會以此大小的區塊來處理。值可以是 1 KB 到 16 GB 範圍內 2 的次方。此值通常設定為 4 MB。 </para>
    <para>在 LVM1 中，4 MB 實體範圍允許的最大 LV 大小是 256 GB，因為該 LVM 最多支援每個 LV 有 65534 個範圍。VM2 不限制實體範圍的數量。範圍數量龐大不會影響邏輯磁碟區的 I/O 效能，但會降低 LVM 工具的速度。</para>
    <important>
     <para>在單個 VG 中不應混合使用不同的實體範圍大小。在進行初始設定後，就不應當再修改範圍。</para>
    </important>
   </step>
   <step id="brgnhd9" performance="required">
    <para>在<guimenu>可用實體磁碟區</guimenu>清單中，選取要用來組成此磁碟區群組的 Linux LVM 分割區，然後按一下<guimenu>新增</guimenu>以將它們移至<guimenu>選定實體磁碟區</guimenu>清單。</para>
   </step>
   <step id="brgnihe" performance="required">
    <para>按一下<guimenu>完成</guimenu>。</para>
    <para>新群組便會出現在<guimenu>磁碟區群組</guimenu>清單中。</para>
   </step>
   <step id="brgnk9f" performance="required">
    <para>在「磁碟區管理」頁面中按<guimenu>下一步</guimenu>，確認新的磁碟區群組有列出，然後按一下<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchx8b">
  <title>設定實體磁碟區</title>
  <para role="intro">將 Linux LVM 分割區指定給磁碟區群組後，該分割區便稱為實體磁碟區。 </para>
  <figure pgwide="0" id="fig-yast2-lvm5">
   <title>名為 Home 的磁碟區群組中的實體磁碟區</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_lvm5_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>若要將更多實體磁碟區新增至現有的磁碟區群組：</para>
  <procedure id="brgq6lc">
   <step id="brgq6ld" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="brgq6le" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgq6lf" performance="required">
    <para>在左側面板中，選取「磁碟區管理」並展開群組清單。</para>
   </step>
   <step id="brgq6lg" performance="required">
    <para>在「磁碟區管理」下，選取磁碟區群組，然後按一下<guimenu>綜覽</guimenu>索引標籤。</para>
   </step>
   <step id="brgq6lh" performance="required">
    <para role="intro">在頁面底部，按一下<guimenu>調整大小</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgq6li" performance="required">
    <para>從<guimenu>可用實體磁碟區</guimenu>清單中選取一個實體磁碟區 (LVM 分割區)，然後按一下「新增」以將其移至<guimenu>選定實體磁碟區</guimenu>。</para>
   </step>
   <step id="brgq6lj" performance="required">
    <para>按一下<guimenu>完成</guimenu>。</para>
   </step>
   <step id="brgq6lk" performance="required">
    <para>按<guimenu>下一步</guimenu>，確認變更有列出，然後按一下<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchx8c">
  <title>設定邏輯磁碟區</title>
  <para>磁碟區群組中填入實體磁碟區後，使用「邏輯磁碟區」對話方塊 (請參閱<xref linkend="fig-yast2-lvm6" xrefstyle="FigureXRef"/>) 可定義和管理作業系統應使用的邏輯磁碟區。此對話方塊會列出該磁碟區群組中所有的邏輯磁碟區。可以使用<guimenu>新增</guimenu>、<guimenu>編輯</guimenu>以及<guimenu>移除</guimenu>選項管理邏輯磁碟區。至少指定一個邏輯磁碟區給每個磁碟區群組。可以視需要建立新的邏輯磁碟區，直到磁碟區群組中的所有可用空間都用完為止。 </para>
  <para>從 SLES 11 SP3 開始，可以簡易佈建 LVM 邏輯磁碟區。簡易佈建可讓您建立預訂大小超過可用空間的邏輯磁碟區。您可以建立一個簡易池，來包含保留的供任意數量簡易磁碟區使用的未使用空間。簡易磁碟區將建立為疏鬆磁碟區，並且會視需要從簡易池配置空間。簡易池可以在需要時動態擴充，以具成本效益的方式來配置儲存空間。</para>
  <important>
   <para>若要在叢集中使用簡易佈建磁碟區，使用它的簡易池和簡易磁碟區必須在單個叢集資源中管理。如此，簡易磁碟區和簡易池便可永遠獨佔地掛接在同一個節點上。</para>
  </important>
  <figure pgwide="0" id="fig-yast2-lvm6">
   <title>邏輯磁碟區管理</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_lvm6_a.png" width="339pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>也可以將邏輯磁碟區中的資料流分散至數個實體磁碟區 (等量磁區)。如果這些實體磁碟區是在不同的硬碟上，通常可以改善讀寫效能 (像 RAID 0 一樣)。不過，具有 <literal>n</literal> 個等量磁區的等量 LV，只有在 LV 所需的硬碟空間可以平均分散給 <literal>n</literal> 個實體磁碟區時，才能正確建立。例如，如果只有兩個實體磁碟區可用，那麼就無法建立具有三個等量磁區的邏輯磁碟區。 </para>
  <procedure id="brgq5hr">
   <step id="brgq6ll" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="brgq6lm" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgq6ln" performance="required">
    <para>在左側面板中，選取「磁碟區管理」，然後將其展開以顯示磁碟區群組清單。</para>
   </step>
   <step id="brgq6lo" performance="required">
    <para>在「磁碟區管理」下，選取磁碟區群組，然後按一下<guimenu>邏輯磁碟區</guimenu>索引標籤。</para>
   </step>
   <step id="brgq5hs" performance="required">
    <para>在左下方按一下<guimenu>新增</guimenu>，以開啟「新增邏輯磁碟區」對話方塊。</para>
   </step>
   <step id="brgq8gl" performance="required">
    <para role="intro">指定邏輯磁碟區的<guimenu>名稱</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm9_a.png" width="137pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b15cmz3e" performance="required">
    <para>指定 LVM 磁碟區的類型︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b15cmz3f">
       <title>一般磁碟區︰</title>
       <para>(預設) 系統會立即配置磁碟區的空間。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b15cmz3g">
       <title>簡易池︰</title>
       <para>邏輯磁碟區是保留給簡易磁碟區使用的空間池。簡易磁碟區可以視需要從簡易池中配置它們所需的空間。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b15cmz3h">
       <title>簡易磁碟區︰</title>
       <para>建立為疏鬆磁碟區的磁碟區。該磁碟區會視需要從簡易池配置所需的空間。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm9a_a.png" width="137pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgqd13" performance="required">
    <para role="intro">指定磁碟區的大小以及是否使用多個等量磁區。</para>
    <informaltable role="1" frame="topbot" rowsep="0" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgqgrg">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm10_a.png" width="137pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para>指定邏輯磁碟區的大小，最高為最大可用大小。</para>
           <para>目前磁碟區群組中的可用空間量顯示在<guimenu>最大大小</guimenu>選項旁邊。</para>
          </listitem>
          <listitem>
           <para>指定等量磁區的數量。</para>
           <warning>
            <para>YaST 在此時沒有機會驗證您所輸入的等量磁區之正確性。在此所犯的錯誤只有稍後在磁碟上執行 LVM 時才會顯示出來。 </para>
           </warning>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgqevk" performance="required">
    <para>指定邏輯磁碟區的格式化選項：</para>
    <informaltable role="1" frame="topbot" rowsep="1" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
      <tbody>
       <row id="brgqevl">
        <entry>
         <mediaobject>
          <imageobject>
          <imagedata fileref="yast2_lvm11_a.png" width="134pt" format="png"/></imageobject>
         </mediaobject>
        </entry>
        <entry>
         <orderedlist spacing="normal">
          <listitem>
           <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>格式化分割區</guimenu>，然後從<guimenu>檔案系統</guimenu>下拉式清單中選取格式化類型，例如 Ext3。 </para>
          </listitem>
          <listitem>
           <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>掛接分割區</guimenu>，然後選取掛接點。</para>
           <para>儲存於此邏輯磁碟區上的檔案，可以在已安裝系統的此掛接點上找到。</para>
          </listitem>
          <listitem>
           <para>按一下<guimenu>Fstab 選項</guimenu>可為磁碟區新增特殊掛接選項。</para>
          </listitem>
         </orderedlist>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="brgqmpf" performance="required">
    <para>按一下<guimenu>完成</guimenu>。</para>
   </step>
   <step id="brgqn20" performance="required">
    <para>按<guimenu>下一步</guimenu>，確認變更有列出，然後按一下<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="lvm-activate-vgs">
  <title>自動啟動非根 LVM 磁碟區群組</title>
  <para>非根 LVM 磁碟區群組的啟動行為由 <literal>/etc/sysconfig/lvm</literal> 檔案中的參數設定所控制。</para>
  <para>根據 <literal>/etc/sysconfig/lvm</literal> 檔案中 <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal> 參數的設定，非根 LVM 磁碟區群組預設會在系統重新啟動時透過 <filename>/etc/rc.d/boot.lvm</filename> 自動啟動。此參數可讓您在系統重新啟動時啟動所有磁碟區群組，或者僅啟動指定的非根 LVM 磁碟區群組。</para>
  <para>若要在系統重新啟動時啟動所有非根 LVM 磁碟區群組，請確保 <filename>/etc/sysconfig/lvm</filename> 檔案中 <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal> 參數的值為空白 (<literal>""</literal>)。此為預設值。對於幾乎所有標準 LVM 安裝，都可以放心地將該值保留為空白。</para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="" 
</screen>

  <para>若要在系統重新啟動時僅啟動指定的非根 LVM 磁碟區群組，請指定該磁碟區群組名稱做為 <literal>LVM_VGS_ACTIVATED_ON_BOOT</literal> 參數的值：</para>

<screen>
LVM_VGS_ACTIVATED_ON_BOOT="vg1" 
</screen>

  <para>依預設，新探查到的 LVM 磁碟區群組不會自動啟動。<literal>LVM_ACTIVATED_ON_DISCOVERED</literal> 參數在 <filename>/etc/sysconfig/lvm</filename> 檔案中處於停用狀態：</para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="disable"
</screen>

  <para>您可以啟用 <literal>LVM_ACTIVATED_ON_DISCOVERED</literal> 參數以允許透過 udev 規則啟動新探查到的 LVM 磁碟區群組：</para>

<screen>
LVM_ACTIVATED_ON_DISCOVERED="enable"
</screen>

 </sect1>
 <sect1 id="lvmtagging">
  <title>標記 LVM2 儲存物件</title>
  <para role="intro">標記是指定給儲存物件中繼資料的無序關鍵字或詞彙。透過使用標記，您可以為 LVM 儲存物件的中繼資料附加無序的標記清單，用實用的方式對物件集合進行分類。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bwkc8pi" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkc1zg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkc1ta" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkepmz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkdms3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkdqfz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bwkc8pi">
   <title>使用 LVM2 標記</title>
   <para role="intro">標記 LVM2 儲存物件之後，便可以在指令中使用標記來完成下列任務：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>選取要根據是否存在特定標記來處理的 LVM 物件。</para>
    </listitem>
    <listitem>
     <para>在組態檔案中使用標記，可控制在伺服器上啟動哪些磁碟區群組和邏輯磁碟區。</para>
    </listitem>
    <listitem>
     <para>透過在指令中指定標記，覆寫全域組態檔案中的設定。</para>
    </listitem>
   </itemizedlist>
   <para>可以使用標記來代替接受下列各項的任何指令行 LVM 物件參考：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>物件清單</para>
    </listitem>
    <listitem>
     <para>單一物件，只要標記展開為單一物件</para>
    </listitem>
   </itemizedlist>
   <para>在所有位置都尚不支援用標記取代物件名稱。引數展開之後，對於清單中重複的引數，系統會移除重複的引數並保留每個引數的第一個例項。</para>
   <para>每當遇到可能不明確的引數類型時，都必須使用 at 符號 (@) 字元為標記加上字首，例如 <literal>@mytag</literal>。其他情況下，是否使用 <quote>@</quote> 隨您選擇。</para>
  </sect2>
  <sect2 id="bwkc1zg">
   <title>建立 LVM2 標記的要求</title>
   <para role="intro">將標記與 LVM 搭配使用時，請考慮下列要求：</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkc4lx" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkc75c" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bwkc4lx">
    <title>受支援的字元</title>
    <para>LVM 標記單字可以包含 ASCII 大寫字元 A 到 Z、小寫字元 a 到 z、數字 0 到 9、底線 (_)、加號 (+)、連字號 (-) 及句點 (.)。單字不能以連字號開頭。最大長度為 128 個字元。</para>
   </sect3>
   <sect3 id="bwkc75c">
    <title>受支援的儲存物件</title>
    <para>您可以標記 LVM2 實體磁碟區、磁碟區群組、邏輯磁碟區和邏輯磁碟區區段。PV 標記儲存在其磁碟區群組的中繼資料中。刪除磁碟區群組也會刪除未同步實體磁碟區中的標記。您雖然不能標記快照，但可以標記它們的來源。</para>
    <para>無法對 LVM1 物件加標記，因為磁碟格式不支援。</para>
   </sect3>
  </sect2>
  <sect2 id="bwkc1ta">
   <title>指令行標記語法</title>
   <variablelist>
    <varlistentry id="bwkddun">
     <term>--addtag &lt;<replaceable>標記資訊</replaceable>&gt;</term>
     <listitem>
      <para>將標記新增至 LVM2 儲存物件 (或對其<emphasis>加標記</emphasis>)。</para>
      <formalpara id="bwkdj1p">
       <title>範例</title>
       <para/>
      </formalpara>

<screen>
vgchange --addtag @db1 vg1
</screen>

     </listitem>
    </varlistentry>
    <varlistentry id="bwkdh2t">
     <term>--deltag &lt;<replaceable>標記資訊</replaceable>&gt;</term>
     <listitem>
      <para>移除 LVM2 儲存物件的標記 (或對其<emphasis>取消標記</emphasis>)。</para>
      <formalpara id="bwkdjin">
       <title>範例</title>
       <para/>
      </formalpara>

<screen>
vgchange --deltag @db1 vg1
</screen>

     </listitem>
    </varlistentry>
    <varlistentry id="bwkdh2u">
     <term>--tag &lt;<replaceable>標記資訊</replaceable>&gt;</term>
     <listitem>
      <para>指定標記，用來縮小要啟動或取消啟動之磁碟區群組或邏輯磁碟區的清單。</para>
      <formalpara id="bwkdg98">
       <title>範例</title>
       <para/>
      </formalpara>
      <para>如果磁碟區具有與提供的標記相符的標記，輸入以下指令可將其啟動：</para>

<screen>
lvchange -ay --tag @db1 vg1/vol2
</screen>

     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="bwkepmz">
   <title>組態檔案語法</title>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkcqoj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkeuio" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkcwqd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bwkcqoj">
    <title>啟用 lvm.conf 檔案中的主機名稱標記</title>
    <para>將以下程式碼新增至 <filename>/etc/lvm/lvm.conf</filename> 檔案，以啟用主機上 <filename>/etc/lvm/lvm_&lt;<replaceable>主機名稱</replaceable>&gt;.conf</filename> 檔案中分別定義的主機標記。</para>

<screen>
tags {
   # Enable hostname tags
   hosttags = 1
}
</screen>

    <para>您需要將啟用代碼放在主機上的 <filename>/etc/lvm/lvm_&lt;<replaceable>主機名稱</replaceable>&gt;.conf</filename> 檔案中。請參閱<xref linkend="bwkctd3" xrefstyle="HeadingOnPage"/>。</para>
   </sect3>
   <sect3 id="bwkeuio">
    <title>為 lvm.conf 檔案中的主機名稱定義標記</title>

<screen>
tags {

   tag1 { }
      # Tag does not require a match to be set.

   tag2 {
      # If no exact match, tag is not set.
      host_list = [ "hostname1", "hostname2" ]
   }
}
</screen>

   </sect3>
   <sect3 id="bwkctd3">
    <title>定義啟動行為</title>
    <para>您可以修改 <filename>/etc/lvm/lvm.conf</filename> 檔案，根據標記啟動 LVM 邏輯磁碟區。 </para>
    <para>在文字編輯器中，將以下程式碼新增至該檔案：</para>

<screen>
  activation {
      volume_list = [ "vg1/lvol0", "@database" ]
  }
</screen>

    <para>用您的標記取代 <literal>@database</literal>。使用 <literal>"@*"</literal> 可使標記與主機上設定的任何標記相符。 </para>
    <para>啟動指令會比對磁碟區群組與邏輯磁碟區的中繼資料中設定的 <replaceable>vgname</replaceable>、<replaceable>vgname/lvname</replaceable> 或 @<replaceable>tag</replaceable>。當中繼資料標記相符時，磁碟區群組或邏輯磁碟區才會啟動。如果沒有相符標記，預設不會啟動任何項目。</para>
    <para>如果沒有 <literal>volume_list</literal> 並且主機上定義了標記，則僅當主機標記與中繼資料標記相符時，磁碟區群組或邏輯磁碟區才會啟動。</para>
    <para>如果沒有 <literal>volume_list</literal> 並且主機上未定義任何標記，則不會啟動。</para>
   </sect3>
   <sect3 id="bwkcwqd">
    <title>在多個主機名稱組態檔案中定義啟動行為</title>
    <para>如果 <filename>lvm.conf</filename> 檔案中啟用了主機標記，您便可在主機的組態檔案 (<filename>/etc/lvm/lvm_&lt;<replaceable>主機標記</replaceable>&gt;.conf</filename>) 中使用啟動代碼。例如，<filename>/etc/lvm/</filename> 資料夾中包含某個伺服器的兩個組態檔案：</para>
    <simplelist>
     <member><filename>lvm.conf</filename></member> <member><filename>lvm_&lt;<replaceable>主機標記</replaceable>&gt;.conf</filename></member>
    </simplelist>
    <para>伺服器啟動時，會載入 <filename>/etc/lvm/lvm.conf</filename> 檔案，並處理該檔案中的任何標記設定。如果定義了任何主機標記，它會載入相關的 <filename>/etc/lvm/lvm_&lt;<replaceable>主機標記</replaceable>&gt;.conf</filename> 檔案。當伺服器搜尋特定組態檔案項目時，會先搜尋主機標記檔案，然後再搜尋 <filename>lvm.conf</filename> 檔案，並在尋找到第一個相符項目時停止搜尋。在 <filename>lvm_&lt;<replaceable>host_tag</replaceable>&gt;.conf</filename> 檔案中，使用與設定標記先後順序相反的順序。如此會先搜尋最後設定之標記的檔案。在主機標記檔案中設定的新標記將觸發其他組態檔案的載入。 </para>
   </sect3>
  </sect2>
  <sect2 id="bwkdms3">
   <title>將標記用於叢集中的簡單啟動控制</title>
   <para>在 <filename>/etc/lvm/lvm.conf</filename> 檔案中啟用 <literal>hostname_tags</literal> 選項，可以設定簡單主機名稱啟動控制。在叢集中的每台機器上使用相同的檔案，使之成為全域設定。 </para>
   <procedure id="bwkel6y">
    <step id="bwkel6z" performance="required">
     <para>在文字編輯器中，將以下代碼新增至 <filename>/etc/lvm/lvm.conf</filename> 檔案：</para>

<screen>
tags {
   hostname_tags = 1
}
</screen>

    </step>
    <step id="bwkelf9" performance="required">
     <para>將該檔案複製到叢集中的所有主機上。</para>
    </step>
    <step id="bwkelow" performance="required">
     <para>在叢集的任何機器中，將 <literal>db1</literal> 新增至啟動 <filename>vg1/lvol2</filename> 的機器清單：</para>

<screen>
lvchange --addtag @db1 vg1/lvol2
</screen>

    </step>
    <step id="bwkelx8" performance="required">
     <para>在 <filename>db1</filename> 伺服器上，輸入以下指令以將其啟動：</para>

<screen>
lvchange -ay vg1/vol2
</screen>

    </step>
   </procedure>
  </sect2>
  <sect2 id="bwkdqfz">
   <title>使用標記啟動叢集中的偏好主機</title>
   <para>本節中的範例示範如何透過兩種方法實現下列目的：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>僅在資料庫主機 <filename>db1</filename> 與 <filename>db2</filename> 上啟動磁碟區群組 <filename>vg1</filename>。</para>
    </listitem>
    <listitem>
     <para>僅在檔案伺服器主機 <filename>fs1</filename> 上啟動磁碟區群組 <filename>vg2</filename>。</para>
    </listitem>
    <listitem>
     <para>起初，在檔案伺服器備份主機 <filename>fsb1</filename> 上不啟動任何項目，但是讓它準備好接管檔案伺服器主機 <filename>fs1</filename> 的工作。</para>
    </listitem>
   </itemizedlist>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bwkdsty" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bwkdtdw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bwkdsty">
    <title>選項 1：在主機之間複製的集中式管理與靜態組態</title>
    <para>下面的解決方案會在多個主機之間複製單一組態檔案。</para>
    <procedure id="bwkdvwj">
     <step id="bwkdvwk" performance="required">
      <para>將 <literal>@database</literal> 標記新增至磁碟區群組 <filename>vg1</filename> 的中繼資料。在終端機主控台中，輸入</para>

<screen>
vgchange --addtag @database vg1
</screen>

     </step>
     <step id="bwke0dt" performance="required">
      <para>將 <literal>@fileserver</literal> 標記新增至磁碟區群組 <filename>vg2</filename> 的中繼資料。在終端機主控台中，輸入</para>

<screen>
vgchange --addtag @fileserver vg2
</screen>

     </step>
     <step id="bwke0du" performance="required">
      <para>在文字編輯器中，使用以下代碼修改 <filename> /etc/lvm/lvm.conf</filename> 檔案，以定義 <literal>@database</literal>、<literal>@fileserver</literal> 與 <literal>@fileserverbackup</literal> 標記。</para>

<screen>
tags {
   database {
      host_list = [ "db1", "db2" ]
   }
   fileserver {
      host_list = [ "fs1" ]
   }
   fileserverbackup {
      host_list = [ "fsb1" ]
   }
}

activation {
   # Activate only if host has a tag that matches a metadata tag
   volume_list = [ "@*" ]
}
</screen>

     </step>
     <step id="bwke0dv" performance="required">
      <para>將修改後的 <filename>/etc/lvm/lvm.conf</filename> 檔案複製到四部主機：<filename>db1</filename>、<filename>db2</filename>、<filename>fs1</filename> 與 <filename>fsb1</filename>。</para>
     </step>
     <step id="bwke2yh" performance="required">
      <para>如果檔案伺服器主機停機，您可在任何節點上的終端機主控台中輸入以下指令，來啟動 <filename>fsb1</filename> 上的 <filename>vg2</filename>：</para>

<screen>
vgchange --addtag @fileserverbackup vg2
vgchange -ay vg2
</screen>

     </step>
    </procedure>
   </sect3>
   <sect3 id="bwkdtdw">
    <title>選項 2：本地化的管理與組態</title>
    <para>在下面的解決方案中，每部主機都在本地保留要啟動哪些磁碟區類別的相關資訊。</para>
    <procedure id="bwke3z3">
     <step id="bwke8yi" performance="required">
      <para role="intro">將 <literal>@database</literal> 標記新增至磁碟區群組 <filename>vg1</filename> 的中繼資料。在終端機主控台中，輸入</para>

<screen>
vgchange --addtag @database vg1
</screen>

     </step>
     <step id="bwke8yj" performance="required">
      <para>將 <literal>@fileserver</literal> 標記新增至磁碟區群組 <filename>vg2</filename> 的中繼資料。在終端機主控台中，輸入</para>

<screen>
vgchange --addtag @fileserver vg2
</screen>

     </step>
     <step id="bwke8yk" performance="required">
      <para>啟用 <filename>/etc/lvm/lvm.conf</filename> 檔案中的主機標記：</para>
      <substeps performance="required">
       <step id="bwke8dm" performance="required">
        <para>在文字編輯器中，使用以下代碼修改 <filename>/etc/lvm/lvm.conf</filename> 檔案，以啟用主機標記組態檔案。</para>

<screen>
tags {
   hosttags = 1
}
</screen>

       </step>
       <step id="bwke8dn" performance="required">
        <para>將修改後的 <filename>/etc/lvm/lvm.conf</filename> 檔案複製到四部主機：<filename>db1</filename>、<filename>db2</filename>、<filename>fs1</filename> 與 <filename>fsb1</filename>。</para>
       </step>
      </substeps>
     </step>
     <step id="bwke7w8" performance="required">
      <para>在主機 <filename>db1</filename> 上，建立資料庫主機 <filename>db1</filename> 的啟動組態檔案。在文字編輯器中，建立 <filename>/etc/lvm/lvm_db1.conf</filename> 檔案並新增以下程式碼：</para>

<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>

     </step>
     <step id="bwkeef1" performance="required">
      <para>在主機 <filename>db2</filename> 上，建立資料庫主機 <filename>db2</filename> 的啟動組態檔案。在文字編輯器中，建立 <filename>/etc/lvm/lvm_db2.conf</filename> 檔案並新增以下程式碼：</para>

<screen>
activation {
   volume_list = [ "@database" ]
}
</screen>

     </step>
     <step id="bwkeef2" performance="required">
      <para>在主機 fs1 上，建立檔案伺服器主機 <filename>fs1</filename> 的啟動組態檔案。在文字編輯器中，建立 <filename>/etc/lvm/lvm_fs1.conf</filename> 檔案並新增以下程式碼：</para>

<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>

     </step>
     <step id="bwkeef3" performance="required">
      <para>如果檔案伺服器主機 <filename>fs1</filename> 停機，要將備用檔案伺服器主機 fsb1 做為檔案伺服器啟動：</para>
      <substeps performance="required">
       <step id="bwkeef4" performance="required">
        <para>在主機 <filename>fsb1</filename> 上，建立主機 <filename>fsb1</filename> 的啟動組態檔案。在文字編輯器中，建立 <filename>/etc/lvm/lvm_fsb1.conf</filename> 檔案並新增以下程式碼：</para>

<screen>
activation {
   volume_list = [ "@fileserver" ]
}
</screen>

       </step>
       <step id="bwkeef5" performance="required">
        <para>在終端機主控台中，輸入下列其中一個指令：</para>

<screen>
vgchange -ay vg2

vgchange -ay @fileserver
</screen>

       </step>
      </substeps>
     </step>
    </procedure>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="brgpqe2">
  <title>調整磁碟區群組大小</title>
  <para role="intro">您可以新增和移除磁碟區群組的 Linux LVM 分割區，以擴大或縮小其大小。</para>
  <warning>
   <para>如果邏輯磁碟區正在使用某個分割區，則移除該分割區可能會導致資料遺失。</para>
  </warning>
  <procedure id="brgpt5w">
   <step id="brgpt5x" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="brgpt5y" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgpt5z" performance="required">
    <para>在左側面板中，選取「磁碟區管理」，然後將其展開以顯示磁碟區群組清單。</para>
   </step>
   <step id="brgpt60" performance="required">
    <para>在「磁碟區管理」下，選取磁碟區群組，然後按一下<guimenu>綜覽</guimenu>索引標籤。</para>
   </step>
   <step id="brgpt61" performance="required">
    <para role="intro">在頁面底部，按一下<guimenu>調整大小</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm8_a.png" width="329pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgptkf" performance="required">
    <para>請執行下列其中一個步驟︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="brgpw44">
       <title>新增︰</title>
       <para>透過將一或多個實體磁碟區 (LVM 分割區) 從<guimenu>可用實體磁碟區</guimenu>清單移至<guimenu>選定實體磁碟區</guimenu>清單，可以擴大磁碟區群組的大小。 </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="brgpxfv">
       <title>移除︰</title>
       <para>透過將一或多個實體磁碟區 (LVM 分割區) 從<guimenu>選定實體磁碟區</guimenu>清單移至<guimenu>可用實體磁碟區</guimenu>清單，可以縮小磁碟區群組的大小。 </para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step id="brgptf8" performance="required">
    <para>按一下<guimenu>完成</guimenu>。</para>
   </step>
   <step id="brgpt62" performance="required">
    <para>按<guimenu>下一步</guimenu>，確認變更有列出，然後按一下<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="brgqpfy">
  <title>使用 YaST 調整邏輯磁碟區的大小</title>
  <procedure id="brgqpvs">
   <step id="brgqsmd" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="brgqsme" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgqsmf" performance="required">
    <para>在左側面板中，選取「磁碟區管理」，然後將其展開以顯示磁碟區群組清單。</para>
   </step>
   <step id="brgqsmg" performance="required">
    <para>在「磁碟區管理」下，選取磁碟區群組，然後按一下<guimenu>邏輯磁碟區</guimenu>索引標籤。</para>
   </step>
   <step id="brgqsmh" performance="required">
    <para>在頁面的底部，按一下<guimenu>調整大小</guimenu>以開啟「調整邏輯磁碟區的大小」對話方塊。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="yast2_lvm12_a.png" width="244pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="brgqpvt" performance="required">
    <para>使用滑動軸來擴大或縮小邏輯磁碟區的大小。</para>
    <warning>
     <para>縮小包含資料之邏輯磁碟區的大小可能會導致資料損毀。</para>
    </warning>
   </step>
   <step id="brgqueh" performance="required">
    <para>按一下<guimenu>確定</guimenu>。</para>
   </step>
   <step id="brgqulm" performance="required">
    <para>按<guimenu>下一步</guimenu>，確認變更有列出，然後按一下<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuz4lz">
  <title>使用指令調整邏輯磁碟區的大小</title>
  <para><command>lvresize</command>、<command>lvextend</command> 與 <command>lvreduce</command> 指令可用於調整邏輯磁碟區的大小。如需這些指令的語法及選項資訊，請參閱相應指令的 man 頁面。</para>
  <para>您還可以使用 YaST 磁碟分割程式增加邏輯磁碟區的大小。YaST 使用 <command>parted(8)</command> 來增大分割區。 </para>
  <para>若要擴充 LV，VG 上必須有足夠多的未配置空間。 </para>
  <para>您雖然可以在 LV 正在使用中時對其進行擴充或縮減，但若其上包含檔案系統，則無法如此作業。擴充或縮減 LV 不會自動修改磁碟區中檔案系統的大小。調整大小後必須使用另一個指令來增大檔案系統。如需調整檔案系統大小的相關資訊，請參閱<xref linkend="biuymaa" xrefstyle="ChapTitleOnPage"/>。</para>
  <para>請確保使用正確的順序： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>若要擴充 LV，則必須先擴充 LV 然後再嘗試增大檔案系統。</para>
   </listitem>
   <listitem>
    <para>若要縮減 LV，則必須先縮減檔案系統然後再嘗試縮減 LV。</para>
   </listitem>
  </itemizedlist>
  <para>若要擴充邏輯磁碟區的大小：</para>
  <procedure id="biuz4s4">
   <step id="biuz7nu" performance="required">
    <para>開啟終端機主控台，然後以 <systemitem>root</systemitem> 使用者身分登入。</para>
   </step>
   <step id="biuz81p" performance="required">
    <para>如果邏輯磁碟區包含為虛擬機器 (例如 Xen VM) 代管的檔案系統，請關閉該 VM。</para>
   </step>
   <step id="biuz7ph" performance="required">
    <para>卸下邏輯磁碟區上的檔案系統。</para>
   </step>
   <step id="biuz4s5" performance="required">
    <para>在終端機主控台提示符處，輸入以下指令以增加邏輯磁碟區的大小︰</para>

<screen>
lvextend -L +<replaceable>size</replaceable> <replaceable>/dev/vgname/lvname</replaceable>
</screen>

    <para>對於 <replaceable>size</replaceable>，請指定您要新增到邏輯磁碟區的空間容量，例如 10GB。以邏輯磁碟區的 Linux 路徑 (例如 <filename>/dev/vg1/v1</filename>) 取代 <filename><replaceable>/dev/vgname/lvname</replaceable></filename>。例如：</para>

<screen>
lvextend -L +10GB /dev/vg1/v1<replaceable/>
</screen>

   </step>
  </procedure>
  <para>例如，將其上包含 (已掛接並啟用) ReiserFS 的 LV 擴充 10GB：</para>

<screen>
lvextend −L +10G <replaceable>/dev/vgname/lvname</replaceable>
resize_reiserfs −s +10GB −f <replaceable>/dev/vg−name/lv−name</replaceable>
</screen>

  <para>例如，將包含 ReiserFS 的 LV 縮減 5GB：</para>

<screen>
umount <replaceable>/mountpoint−of−LV</replaceable>
resize_reiserfs −s −5GB <replaceable>/dev/vgname/lvname</replaceable>
lvreduce <replaceable>/dev/vgname/lvname</replaceable>
mount <replaceable>/dev/vgname/lvname</replaceable> <replaceable>/mountpoint−of−LV</replaceable>
</screen>

 </sect1>
 <sect1 id="brgpmw3">
  <title>刪除磁碟區群組</title>
  <warning>
   <para>刪除磁碟區群組會損毀其每個成員分割區中的所有資料。 </para>
  </warning>
  <procedure id="brgppd6">
   <step id="brgppd7" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="brgppd8" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgppd9" performance="required">
    <para>在左側面板中，選取「磁碟區管理」並展開群組清單。</para>
   </step>
   <step id="brgpos4" performance="required">
    <para>在「磁碟區管理」下，選取磁碟區群組，然後按一下<guimenu>綜覽</guimenu>索引標籤。</para>
   </step>
   <step id="brgpos5" performance="required">
    <para>在頁面的底部，按一下<guimenu>刪除</guimenu>，然後按一下<guimenu>是</guimenu>確認刪除。</para>
   </step>
   <step id="brgpos6" performance="required">
    <para>按<guimenu>下一步</guimenu>，確認刪除的磁碟區群組 (刪除項目以紅色字型顯示) 有列出，然後按一下<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="brgob84">
  <title>刪除 LVM 分割區 (實體分割區)</title>
  <warning>
   <para>刪除分割區會損毀該分割區中的所有資料。 </para>
  </warning>
  <procedure id="brgobbw">
   <step id="brgobki" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="brgobkj" performance="required">
    <para>在 YaST 中，開啟<guimenu>磁碟分割程式</guimenu>。</para>
   </step>
   <step id="brgobuj" performance="required">
    <para>如果 Linux LVM 分割區目前為磁碟區群組的成員，可從磁碟區群組移除該分割區，或者<link linkend="brgpmw3">刪除磁碟區群組</link>。</para>
   </step>
   <step id="brgobkk" performance="required">
    <para>在 YaST 磁碟分割程式中的<guimenu>硬碟</guimenu>下，選取裝置 (例如 <filename>sdc</filename>)。</para>
   </step>
   <step id="brgobkl" performance="required">
    <para>在「分割區」頁面中，選取要移除的分割區，按一下<guimenu>刪除</guimenu>，然後按一下<guimenu>是</guimenu>確認刪除。</para>
   </step>
   <step id="brgobkm" performance="required">
    <para>按<guimenu>下一步</guimenu>，確認刪除的分割區 (刪除項目以紅色字型顯示) 有列出，然後按一下<guimenu>完成</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="btx9jxu">
  <title>使用 LVM 指令</title>
  <para>如需使用 LVM 指令的資訊，請參閱<xref linkend="btx8b05" xrefstyle="TableXRef"/> 中所述指令的 man 頁面。以 <systemitem>root</systemitem> 使用者身分執行指令。</para>
  <table id="btx8b05" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
   <title>LVM 指令</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="5001*"/>
   <colspec colnum="2" colname="2" colwidth="5001*"/>
    <thead>
     <row id="btx8b06">
      <entry>
       <para>指令</para>
      </entry>
      <entry>
       <para>描述</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="btx8b07">
      <entry>

<screen>
pvcreate <replaceable>&lt;device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>啟始化裝置 (例如 <filename>/dev/sdb</filename>)，以使 LVLM 將其做為實體磁碟區使用。</para>
      </entry>
     </row>
     <row id="btx8yob">
      <entry>

<screen>
pvdisplay &lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>顯示 LVM 實體磁碟區的相關資訊，例如邏輯磁碟區中目前是否正在使用該磁碟區。</para>
      </entry>
     </row>
     <row id="btx8b08">
      <entry>

<screen>
vgcreate -c y &lt;<replaceable>vg_name&gt;</replaceable> &lt;<replaceable>dev1</replaceable>&gt; [<replaceable>dev2</replaceable>...]
</screen>
</entry>
      <entry>
       <para>使用一或多個指定的裝置建立叢集磁碟區群組。</para>
      </entry>
     </row>
     <row id="btx8b09">
      <entry>

<screen>
vgchange -a [ey | n] &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>為輸入/輸出啟動 (<literal>-a ey</literal>) 或取消啟動 (<literal>-a n</literal>) 磁碟區群組及其邏輯磁碟區。</para>
       <important>
        <para>請務必使用 <literal>ey</literal> 選項在叢集節點上獨佔啟動磁碟區群組。此選項預設用於載入程序檔中。</para>
       </important>
      </entry>
     </row>
     <row id="btx8lez">
      <entry>

<screen>
vgremove &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>移除磁碟區群組。使用此指令之前，移除邏輯磁碟區，然後取消啟動磁碟區群組。</para>
      </entry>
     </row>
     <row id="btx8b0a">
      <entry>

<screen>
vgdisplay &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>顯示指定磁碟區群組的相關資訊。</para>
       <para>若要查看磁碟區群組的總體實體範圍，請輸入</para>

<screen>
vgdisplay vg_name | grep "Total PE"
</screen>

      </entry>
     </row>
     <row id="b15cnuq5">
      <entry>

<screen>
lvcreate -L <replaceable>size</replaceable> -n &lt;<replaceable>lv_name</replaceable>&gt; &lt;<replaceable>vg_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>建立具有指定大小的邏輯磁碟區。</para>
      </entry>
     </row>
     <row id="btx8b0b">
      <entry>

<screen>
lvcreate -L &lt;size&gt; &lt;-T|--thinpool&gt; &lt;<replaceable>vg_name/thin_pool_name</replaceable>&gt;

lvcreate -virtualsize &lt;size&gt; &lt;-T|--thin&gt; 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;

lvcreate -L &lt;size&gt; -T 
&lt;<replaceable>vg_name</replaceable>/<replaceable>thin_pool_name</replaceable>&gt; 
-virtualsize &lt;size&gt; -n &lt;<replaceable>thin_lv_name</replaceable>&gt;


</screen>
</entry>
      <entry>
       <para>建立具有指定大小的簡易邏輯磁碟區或簡易池。</para>
       <para>建立簡易池或簡易邏輯磁碟區，或者兩者都建立。指定選用引數 --size 將會建立簡易池邏輯磁碟區。指定選用引數 --virtualsize 將會基於給定簡易池磁碟區建立簡易邏輯磁碟區。同時指定這兩個引數將會同時建立簡易池和使用此池的簡易磁碟區。</para>
      </entry>
     </row>
     <row id="b15cmns0">
      <entry>

<screen>
lvcreate -s [-L <replaceable>size</replaceable>] -n <replaceable>&lt;snap_volume</replaceable>&gt; <replaceable>&lt;source_volume_path</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>建立指定邏輯磁碟區的快照磁碟區。如果未包括大小選項 (-L、--size)，則系統會將快照建立為簡易快照。</para>
      </entry>
     </row>
     <row id="btx8b0c">
      <entry>

<screen>
lvremove&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>移除邏輯磁碟區，例如 <filename>/dev/vg_name/lv_name</filename>。</para>
       <para>使用此指令之前，請執行 <command>umount</command> 指令卸下邏輯磁碟區以將其關閉。</para>
      </entry>
     </row>
     <row id="b15cmns1">
      <entry>

<screen>
lvremove <replaceable>snap_volume_path</replaceable>
</screen>
</entry>
      <entry>
       <para>移除快照磁碟區。</para>
      </entry>
     </row>
     <row id="b15cmns2">
      <entry>

<screen role="compact2">
lvconvert --merge  [-b] [-i &lt;<replaceable>seconds</replaceable>&gt;] [&lt;<replaceable>snap_volume_path</replaceable>&gt;[...&lt;snapN&gt;]|@&lt;<replaceable>volume_tag</replaceable>&gt;]
</screen>
</entry>
      <entry>
       <para>將快照資料回復 (復原或合併) 到原始磁碟區。</para>
      </entry>
     </row>
     <row id="btx8b0d">
      <entry>

<screen>
vgextend <replaceable>&lt;vg_name&gt;</replaceable>&lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>將指定的實體磁碟區新增至現有磁碟區群組</para>
      </entry>
     </row>
     <row id="btx8b0e">
      <entry>

<screen>
vgreduce <replaceable>&lt;vg_name</replaceable>&gt; &lt;<replaceable>device</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>從現有磁碟區群組中移除指定的實體磁碟區。 </para>
       <important>
        <para>確保實體磁碟區目前未由任何邏輯磁碟區使用。如果在使用中，您必須使用 <command>pvmove</command> 指令將資料移至另一個實體磁碟區。</para>
       </important>
      </entry>
     </row>
     <row id="btx8b0f">
      <entry>

<screen>
lvextend -L <replaceable>size</replaceable>&lt;<replaceable>/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>擴充指定邏輯磁碟區的大小。此後，您還必須擴充檔案系統以利用最新可用的空間。</para>
      </entry>
     </row>
     <row id="btx8b0g">
      <entry>

<screen>
lvreduce -L <replaceable>size</replaceable> <replaceable>&lt;/dev/vg_name/lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>縮小指定邏輯磁碟區的大小。 </para>
       <important>
        <para>在縮小磁碟區之前，請務必先縮小檔案系統的大小，否則會有遺失資料的風險。</para>
       </important>
      </entry>
     </row>
     <row id="b11lxo1l">
      <entry>

<screen>
lvrename <replaceable>&lt;/dev/vg_name/old_lv_name</replaceable>&gt; <replaceable>&lt;/dev/vg_name/new_lv_name</replaceable>&gt;
</screen>
</entry>
      <entry>
       <para>將磁碟區群組中的現有 LVM 邏輯磁碟區從舊磁碟區名稱重新命名為新磁碟區名稱。這不會變更磁碟區群組名稱。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </sect1>
</chapter>

<chapter id="biuymaa" lang="zh-tw" xml:base="02_fs_resize.xml">
 <title>調整檔案系統大小</title>
 <para>當您的資料需要增大磁碟區時，則您可能需要增加分配給其檔案系統的空間容量。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="biuynjy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt5y" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt64" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt6a" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biuzt6g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="biuynjy">
  <title>調整大小準則</title>
  <para>調整任何分割區或檔案系統的大小都存在一定的風險，可能會造成資料遺失。 </para>
  <warning>
   <para>若要避免資料遺失，在開始執行調整大小任務之前，請務必備份資料。</para>
  </warning>
  <para>計劃調整檔案系統大小時，請考慮以下準則。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="biuytzx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biuyupz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="biuyw0v" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="biuytzx">
   <title>支援調整大小的檔案系統</title>
   <para>檔案系統必須支援調整大小才能利用為磁碟區增加的可用空間。SUSE Linux Enterprise Server 11 中提供了適用於檔案系統 Ext2、Ext3、Ext4 及 ReiserFS 的檔案系統調整大小公用程式。該公用程式支援增加和減少大小，如下所述︰</para>
   <table id="b8qqe0i" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>檔案系統支援調整大小</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="2500*"/>
    <colspec colnum="3" colname="3" colwidth="2500*"/>
    <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row id="b8qqedo">
       <entry>
        <para>檔案系統</para>
       </entry>
       <entry>
        <para>公用程式</para>
       </entry>
       <entry>
        <para>增加大小 (增大)</para>
       </entry>
       <entry>
        <para>減少大小 (縮減)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bxuadqe">
       <entry>
        <para>Ext2</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>僅限離線</para>
       </entry>
       <entry>
        <para>僅限離線</para>
       </entry>
      </row>
      <row id="bxuadqf">
       <entry>
        <para>Ext3</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>線上或離線</para>
       </entry>
       <entry>
        <para>僅限離線</para>
       </entry>
      </row>
      <row id="bxuacq3">
       <entry>
        <para>Ext4</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>僅限離線</para>
       </entry>
       <entry>
        <para>僅限離線</para>
       </entry>
      </row>
      <row id="b8qqedr">
       <entry>
        <para>ReiserFS</para>
       </entry>
       <entry>
        <para>resize_reiserfs</para>
       </entry>
       <entry>
        <para>線上或離線</para>
       </entry>
       <entry>
        <para>僅限離線</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="biuyupz">
   <title>增加檔案系統的大小</title>
   <para>您可以將檔案系統增大到裝置的最大可用空間，或指定一個精確值。請務必先增大裝置或邏輯磁碟區的大小，然後再嘗試增大檔案系統大小。</para>
   <para>為檔案系統指定精確大小時，請確保新大小符合以下條件︰</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必須大於現有資料的大小；否則資料會遺失。 </para>
    </listitem>
    <listitem>
     <para>新的大小不得超過目前裝置的大小，因為檔案系統大小不能超過可用空間大小。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="biuyw0v">
   <title>減少檔案系統的大小</title>
   <para>當要減少裝置上檔案系統的大小時，請確定新大小滿足下列條件︰</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必須大於現有資料的大小；否則資料會遺失。 </para>
    </listitem>
    <listitem>
     <para>新的大小不得超過目前裝置的大小，因為檔案系統大小不能超過可用空間大小。</para>
    </listitem>
   </itemizedlist>
   <para>如果另外還想減少代管檔案系統之邏輯磁碟區的大小，請先減少檔案系統的大小，然後再嘗試減少裝置或邏輯磁碟區的大小。</para>
  </sect2>
 </sect1>
 <sect1 id="biuzt5y">
  <title>增大 Ext2、Ext3 或 Ext4 檔案系統的大小</title>
  <para>檔案系統掛接後，您可以使用 <command>resize2fs</command> 指令來增大 Ext2、Ext3 和 Ext4 檔案系統的大小。檔案系統卸載後，您還可以使用 <command>resize3fs</command> 指令來增大 Ext3 檔案系統的大小。</para>
  <procedure id="biuzt5z">
   <step id="biuzt60" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
   </step>
   <step id="bxuagy1" performance="required">
    <para>如果檔案系統為 Ext2 或 Ext4，您必須卸載該檔案系統。Ext3 檔案系統可以掛接，也可以卸載。</para>
   </step>
   <step id="biuzt61" performance="required">
    <para>使用下列方法之一增加檔案系統的大小︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>若要將檔案系統的大小擴充至名為 <filename>/dev/sda1</filename> 之裝置的最大可用大小，請輸入</para>

<screen>
resize2fs /dev/sda1
</screen>

      <para>如果未指定大小參數，則預設大小為分割區的大小。</para>
     </listitem>
     <listitem>
      <para>若要將檔案系統擴充至指定大小，請輸入 </para>

<screen>
resize2fs /dev/sda1 <replaceable>size</replaceable>
</screen>

      <para><replaceable>size</replaceable> 參數可指定所需的檔案系統新大小。如果未指定單位，則大小參數的單位即為檔案系統的區塊大小。也可以選擇透過下列其中一種單位指示項給大小參數加上字尾︰s 表示 512 位元組磁區；K 表示 KB (1 KB 為 1024 位元組)；M 表示 MB；G 表示 GB。</para>
     </listitem>
    </itemizedlist>
    <para>請等候直至完成大小調整，然後再繼續。</para>
   </step>
   <step id="biuzt62" performance="required">
    <para>如果未掛接檔案系統，請立即掛接。 </para>
    <para>例如，若要在掛接點 <filename>/home</filename> 為名為 <filename>/dev/sda1</filename> 的裝置掛接 Ext2 檔案系統，請輸入</para>

<screen>
mount -t ext2 /dev/sda1 /home
</screen>

   </step>
   <step id="biuzt63" performance="required">
    <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

    <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuzt64">
  <title>增加 Reiser 檔案系統的大小</title>
  <para>在掛接或卸載 ReiserFS 檔案系統時可以增加其大小。</para>
  <procedure id="biuzt65">
   <step id="biuzt66" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
   </step>
   <step id="biuzt67" performance="required">
    <para>使用以下其中一種方法，增加名為 <filename>/dev/sda2</filename> 之裝置上檔案系統的大小︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>若要將檔案系統的大小擴充至裝置的最大可用大小，請輸入</para>

<screen>
resize_reiserfs /dev/sda2
</screen>

      <para>若不指定大小，該指令會將磁碟區增加至分割區的總大小。 </para>
     </listitem>
     <listitem>
      <para>若要將檔案系統擴充至指定大小，請輸入</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/sda2
</screen>

      <para>用所需大小 (以位元組計) 取代 <replaceable>size</replaceable>。您也可以指定值的單位，例如 50000K (KB)、250M (MB) 或 2G (GB)。也可以使用加號 (+) 為值加上字首，以指定為目前大小增加的值。例如，以下指令可將 <filename>/dev/sda2</filename> 上的檔案系統的大小增加 500 MB︰</para>

<screen>
resize_reiserfs -s +500M /dev/sda2
</screen>

     </listitem>
    </itemizedlist>
    <para>請等候直至完成大小調整，然後再繼續。</para>
   </step>
   <step id="biuzt68" performance="required">
    <para>如果未掛接檔案系統，請立即掛接。 </para>
    <para>例如，若要在掛接點 <filename>/home</filename> 為名為 <filename>/dev/sda2</filename> 的裝置掛接 ReiserFS 檔案系統，請輸入</para>

<screen>
mount -t reiserfs /dev/sda2 /home
</screen>

   </step>
   <step id="biuzt69" performance="required">
    <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

    <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuzt6a">
  <title>減少 Ext2 或 Ext3 檔案系統的大小</title>
  <para>您可以在磁碟區卸載後縮減 Ext2、Ext3 或 Ext4 檔案系統的大小。</para>
  <procedure id="biuzt6b">
   <step id="biuzt6c" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
   </step>
   <step id="bt5yjdr" performance="required">
    <para>卸載檔案系統。</para>
   </step>
   <step id="biuzt6d" performance="required">
    <para>輸入以下指令，減少裝置 (如 <filename>/dev/sda1</filename>) 上檔案系統的大小</para>

<screen>
resize2fs /dev/sda1 &lt;size&gt;
</screen>

    <para>使用所需大小的整數值 (以 KB 計) 取代 <replaceable>size</replaceable>。(1 KB = 1024 B。)</para>
    <para>請等候直至完成大小調整，然後再繼續。</para>
   </step>
   <step id="biuzt6e" performance="required">
    <para>掛接檔案系統。例如，若要在掛接點 <filename>/home</filename> 為名為 <filename>/dev/sda1</filename> 的裝置掛接 Ext2 檔案系統，請輸入</para>

<screen>
mount -t ext2 /dev/md0 /home
</screen>

   </step>
   <step id="biuzt6f" performance="required">
    <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

    <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biuzt6g">
  <title>減少 Reiser 檔案系統的大小</title>
  <para>只有在卸載磁碟區後才能減少 Reiser 檔案系統的大小。 </para>
  <procedure id="biuzt6h">
   <step id="biuzt6i" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
   </step>
   <step id="biuzt6j" performance="required">
    <para>輸入以下指令卸載裝置</para>

<screen>
umount /mnt/point
</screen>

    <para>如果您嘗試要減少其大小的分割區包含系統檔案 (例如根 (<filename>/</filename>) 磁碟區)，僅當系統從可開機的 CD 或磁片開機時，才可以進行卸載操作。</para>
   </step>
   <step id="biuzt6k" performance="required">
    <para>輸入以下指令，減少名為 <filename>/dev/sda1</filename> 的裝置上檔案系統的大小</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/sda2
</screen>

    <para>用所需大小 (以位元組計) 取代 <replaceable>size</replaceable>。您也可以指定值的單位，例如 50000K (KB)、250M (MB) 或 2G (GB)。您也可以使用減號 (-) 為該值加上字首，以指定為目前大小減少的值。例如，以下指令可將 <filename>/dev/md0</filename> 上檔案系統的大小減少 500 MB︰</para>

<screen>
resize_reiserfs -s -500M /dev/sda2
</screen>

    <para>請等候直至完成大小調整，然後再繼續。</para>
   </step>
   <step id="biuzt6l" performance="required">
    <para>輸入以下指令掛接檔案系統 </para>

<screen>
mount -t reiserfs /dev/sda2 /mnt/point
</screen>

   </step>
   <step id="biuzt6m" performance="required">
    <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

    <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
   </step>
  </procedure>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" id="uuid" lang="zh-tw" revision="03/15/10" xml:base="03_uuid.xml">
 <title>使用 UUID 掛接裝置</title>
 <para>本章描述可選擇性使用 UUID 而非裝置名稱來識別開機載入程式檔案及 <filename>/etc/fstab</filename> 檔案中的檔案系統裝置。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="udev" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="understanduuid" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidbootx86" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidbootia64" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="uuidmoreinfo" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="udev">
  <title>使用 udev 命名裝置</title>
  <para>在 Linux 2.6 和更新版本的核心中，<command>udev</command> 透過永久命名裝置，為動態 <filename>/dev</filename> 目錄提供了一個使用者空間解決方案。做為 HotPlug 系統的一部分，會在裝置新增至系統或從系統中移除時執行 <command>udev</command>。</para>
  <para>規則清單用來比對特定的裝置屬性。<command>udev</command> 規則基礎結構 (定義於 <filename>/etc/udev/rules.d</filename> 目錄) 為所有磁碟裝置提供了固定名稱，不會隨辨識順序或裝置使用的連接而改變。<command>udev</command> 工具會檢查核心所建立的每個適當區塊裝置，根據特定匯流排、磁碟機類型或檔案系統套用命名規則。如需有關如何定義自己的 <command>udev</command> 規則的資訊，請參閱<ulink url="http://reactivated.net/writing_udev_rules.html"><citetitle>寫入 udev 規則</citetitle></ulink>。 </para>
  <para><command>udev</command> 會根據動態核心指定裝置節點名稱，維護指向 <filename>/dev/disk</filename> 目錄中裝置的永久符號連結類別，該目錄將進一步分類為 <filename>by-id</filename>、<filename>by-label</filename>、<filename>by-path</filename> 及 <filename>by-uuid</filename> 子目錄。 </para>
  <note>
   <para>除了 <command>udev</command> 以外的其他程式，例如 LVM 或 <command>md</command>，也可能會產生 UUID，但不會在 <filename>/dev/disk</filename> 中列出。</para>
  </note>
 </sect1>
 <sect1 id="understanduuid">
  <title>瞭解 UUID</title>
  <para>UUID (通用唯一識別碼) 是 128 位元的檔案系統編號，在本地系統和其他系統中都是唯一的。它根據系統硬體資訊和時戳 (做為其種子的一部分) 隨機產生。UUID 通常用於唯一標記裝置。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="usinguuid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="findinguuid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="usinguuid">
   <title>使用 UUID 組譯或啟動檔案系統裝置</title>
   <para>UUID 對於分割區始終是唯一的，不會隨其顯示順序和掛接位置而變化。特定 SAN 裝置連接到伺服器後，系統分割區會被重新命名並上移為上一個裝置。例如，如果在安裝期間將根目錄 (<filename>/</filename>) 指定給 <filename>/dev/sda1</filename>，它可能會在連接 SAN 後被指定給 <filename>/dev/sdg1</filename>。解決此問題的一個方法是在開機載入程式和開機裝置的 <filename>/etc/fstab</filename> 檔案中使用 UUID。 </para>
   <para>無論裝置掛接在哪里，廠商為磁碟機指定的裝置 ID 都不會改變，所以在開機時始終可以找到該裝置。UUID 是檔案系統的內容，在磁碟重新格式化時會發生變更。在開機載入程式檔案中，您通常要在系統開機時指定裝置的掛接位置 (例如 <filename>/dev/sda1</filename>)。開機載入程式還可以透過裝置的 UUID 與管理員指定的磁碟區標籤來掛接裝置。但是，如果您使用標籤和檔案位置，就不可在掛接分割區後變更標籤名稱。 </para>
   <para>您可以將 UUID 用做組譯與啟動軟體 RAID 裝置的準則。建立 RAID 後，<command>md</command> 驅動程式會為裝置產生一個 UUID，並將該值儲存在 <filename>md</filename> 超級區塊中。 </para>
  </sect2>
  <sect2 id="findinguuid">
   <title>尋找檔案系統裝置的 UUID</title>
   <para>可以在 <filename>/dev/disk/by-uuid</filename> 目錄中找到任何區塊裝置的 UUID。例如，如下所示的 UUID：</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a 
</screen>

  </sect2>
 </sect1>
 <sect1 id="uuidbootx86">
  <title>使用開機載入程式與 /etc/fstab 檔案中的 UUID (x86)</title>
  <para>安裝後，您可以選擇性使用下列程序，在開機載入程式與 <filename>/etc/fstab</filename> 檔案中為 x86 系統設定系統裝置的 UUID。</para>
  <para>開始之前，請先複製 <filename>/boot/grub/menu.1st</filename> 檔案和 <filename>/etc/fstab</filename> 檔案。</para>
  <procedure id="b4pdcrj">
   <step id="b4pdcrk" performance="required">
    <para>在未連接 SAN 裝置的情況下，安裝適用於 x86 的 SUSE Linux Enterprise Server。</para>
   </step>
   <step id="b4pde5j" performance="required">
    <para>安裝之後，將系統開機。</para>
   </step>
   <step id="b4pdeci" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者或同等身分開啟終端機主控台。</para>
   </step>
   <step id="b4pdejm" performance="required">
    <para>導覽到 <filename>/dev/disk/by-uuid</filename> 目錄找到安裝 <filename>/boot</filename>、<filename>/root</filename> 及 <filename>swap</filename> 之裝置的 UUID。</para>
    <substeps performance="required">
     <step id="b4pdgjc" performance="required">
      <para>在終端機主控台提示符下，輸入 </para>

<screen>
cd /dev/disk/by-uuid
</screen>

     </step>
     <step id="b4pdhde" performance="required">
      <para>輸入以下指令以列出所有分割區</para>

<screen>
ll
</screen>

     </step>
     <step id="b4pdhy7" performance="required">
      <para>尋找 UUID，例如</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>

     </step>
    </substeps>
   </step>
   <step id="b4pdk3y" performance="required">
    <para>使用 YaST 中的「開機載入程式」選項或使用文字編輯器編輯 <filename>/boot/grub/menu.1st</filename> 檔案。 </para>
    <para>例如，將</para>

<screen>
kernel /boot/vmlinuz root=/dev/sda1
</screen>

    <para>變更為</para>

<screen>
kernel /boot/vmlinuz root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>

    <important>
     <para>如果出錯，您可以在未連接 SAN 的情況下開機伺服器，並根據 <filename>/boot/grub/menu.1st</filename> 檔案的備份副本來更正錯誤。</para>
    </important>
    <para>如果使用 YaST 中的「開機載入程式」選項，在您變更值時會錯誤地將一些重複的行新增至開機載入程式檔案。使用編輯器移除以下重複的行：</para>

<screen>
color white/blue black/light-gray
</screen>


<screen>
default 0
</screen>


<screen>
timeout 8
</screen>


<screen>
gfxmenu (sd0,1)/boot/message
</screen>

    <para>使用 YaST 變更裝置掛接到根目錄 (<filename>/</filename>) 的方式時 (例如使用 UUID 或標籤)，需要再次儲存開機載入程式組態以使變更對於開機載入程式生效。</para>
   </step>
   <step id="b4pdl03" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者或同等身分執行以下其中一項操作，將 UUID 存放在 <filename>/etc/fstab</filename> 檔案中：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST，選取<menuchoice><guimenu>系統</guimenu><guimenu>磁碟分割程式</guimenu></menuchoice>，再選取所需的裝置，然後修改<guimenu>Fstab 選項</guimenu>。</para>
     </listitem>
     <listitem>
      <para>編輯 <filename>/etc/fstab</filename> 檔案將系統裝置從位置修改為 UUID。</para>
      <para>例如，如果根 (<filename>/</filename>) 磁碟區中有 <filename>/dev/sda1</filename> 的裝置路徑，且其 UUID 為 <filename>e014e482-1c2d-4d09-84ec-61b3aefde77a</filename>，則將行項目從 </para>

<screen>
/dev/sda1   /            reiserfs   acl,user_xattr        1 1
</screen>

      <para>變更為</para>

<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1 
</screen>

      <important>
       <para>檔案中不要留有零散字元或空格。</para>
      </important>
     </listitem>
    </itemizedlist>
   </step>
  </procedure>
 </sect1>
 <sect1 id="uuidbootia64">
  <title>使用開機載入程式與 /etc/fstab 檔案中的 UUID (IA64)</title>
  <para>安裝之後，使用以下程序在開機載入程式與 <filename>/etc/fstab</filename> 檔案中為 IA64 系統設定系統裝置的 UUID。IA64 使用 EFI BIOS。其檔案系統組態檔案為 <filename>/boot/efi/SuSE/elilo.conf</filename>，而非 <filename>/etc/fstab</filename>。</para>
  <para>開始之前，請先複製 <filename>/boot/efi/SuSE/elilo.conf</filename> 檔案。</para>
  <procedure id="b4pec1b">
   <step id="b4pec1c" performance="required">
    <para>在未連接 SAN 裝置的情況下，安裝 SUSE Linux Enterprise Server for IA64。</para>
   </step>
   <step id="b4pec1d" performance="required">
    <para>安裝之後，將系統開機。</para>
   </step>
   <step id="b4pec1e" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者或同等身分開啟終端機主控台。</para>
   </step>
   <step id="b4pec1f" performance="required">
    <para>導覽到 <filename>/dev/disk/by-uuid</filename> 目錄找到安裝 <filename>/boot</filename>、<filename>/root</filename> 及 <filename>swap</filename> 之裝置的 UUID。</para>
    <substeps performance="required">
     <step id="b4pec1h" performance="required">
      <para>在終端機主控台提示符下，輸入 </para>

<screen>
cd /dev/disk/by-uuid
</screen>

     </step>
     <step id="b4pec1i" performance="required">
      <para>輸入以下指令以列出所有分割區</para>

<screen>
ll
</screen>

     </step>
     <step id="b4pec1j" performance="required">
      <para>尋找 UUID，例如</para>

<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>

     </step>
    </substeps>
   </step>
   <step id="b4pec1k" performance="required">
    <para>使用 YaST 中的「開機載入程式」選項編輯開機載入程式檔案。 </para>
    <para>例如，將</para>

<screen>
root=/dev/sda1
</screen>

    <para>變更為</para>

<screen>
root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>

   </step>
   <step id="b4pec1l" performance="required">
    <para>編輯 <filename>/boot/efi/SuSE/elilo.conf</filename> 檔案將系統裝置從位置修改為 UUID。</para>
    <para>例如，將</para>

<screen>
/dev/sda1   /   reiserfs   acl,user_xattr        1 1
</screen>

    <para>變更為</para>

<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1
</screen>

    <important>
     <para>檔案中不要留有零散字元或空格。</para>
    </important>
   </step>
  </procedure>
 </sect1>
 <sect1 id="uuidmoreinfo">
  <title>其他資訊</title>
  <para>有關使用 <command>udev(8)</command> 管理裝置的詳細資訊，請參閱<citetitle>《SUSE Linux Enterprise Server 11 管理指南》</citetitle>中的<ulink url="http://www.suse.com/documentation/sles11/book_sle_admin/data/cha_udev.html"><quote>使用 udev 進行動態核心裝置管理</quote></ulink>。</para>
  <para>有關 <command>udev(8)</command> 指令的詳細資訊，請參閱其線上文件。在終端機主控台提示符下輸入以下指令：</para>

<screen>
man 8 udev
</screen>

 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" id="multipathing" lang="zh-tw" revision="03/15/10" xml:base="04_mpio.xml">
 <title>管理裝置的多重路徑 I/O</title>
 <para>本章描述如何管理伺服器和區塊儲存裝置間之多重路徑的容錯移轉和路徑負載平衡。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="mpioovw" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="be5rvii" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiotools" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiosysconf" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostart" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bkj8n9w" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="scandev" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostatus" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpioerrormgmt" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpiostall" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpirk" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="mpionext" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="mpioovw">
  <title>瞭解多重路徑 I/O</title>
  <para>多重路徑是指伺服器與相同實體或邏輯區塊儲存裝置在伺服器中的主機匯流排介面卡與裝置的儲存控制器之間、跨多重實體路徑進行通訊的能力，通常是在光纖通道 (FC) 或 iSCSI SAN 環境中進行。若有多個通道可用，您還可以與直接連接的儲存建立多個連接。 </para>
  <para>Linux 多重路徑提供了連接容錯功能並可在各主動連接之間實現負載平衡。設定並執行多重路徑時，會自動隔離並識別裝置連接失敗，並將 I/O 重新路由至替代連接。 </para>
  <para>常見的連接問題包括介面卡、纜線或控制器錯誤。為裝置設定多重路徑 I/O 後，多重路徑驅動程式將監控裝置間的主動連接。當多重路徑驅動程式偵測到主動路徑的 I/O 錯誤時，會將流量容錯移轉至裝置的指定次要路徑。偏好的路徑復原後，控制將返回至該路徑。</para>
 </sect1>
 <sect1 id="be5rvii">
  <title>規劃多重路徑</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpioovwguide" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122uvel" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingmdadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14ff9rs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bleqcv0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiousingpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="be5rs3a" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="be5ruyr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="mpioovwguide">
   <title>多重路徑準則</title>
   <para>使用本節中的準則規劃多重路徑 I/O 解決方案。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg2qyg" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2qpf" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2qgh" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2q2x" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pi0" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pdq" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2pdr" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="beg2qyg">
    <title>先決條件</title>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>多重路徑在裝置層級進行管理。 </para>
     </listitem>
     <listitem>
      <para>您用於多重路徑裝置的儲存陣列必須支援多重路徑。如需詳細資訊，請參閱<xref linkend="be5ruyr" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>只有在伺服器中的主機匯流排配接器和區塊儲存裝置的主機匯流排控制器之間存在多重實體路徑時，才需要設定多重路徑。應按伺服器所見為邏輯裝置設定多重路徑。 </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="beg2qpf">
    <title>廠商提供的多重路徑解決方案</title>
    <para>對於某些儲存陣列，廠商提供了自己的多重路徑軟體來管理陣列之實體和邏輯裝置的多重路徑。在這種情況下，您應根據廠商的指示設定那些裝置的多重路徑。</para>
   </sect3>
   <sect3 id="beg2qgh">
    <title>磁碟管理任務</title>
    <para>請先執行以下磁碟管理任務，再嘗試為具有多路徑的實體或邏輯裝置設定多重路徑：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>使用協力廠商工具將實體磁碟分割為數個較小的邏輯磁碟。</para>
     </listitem>
     <listitem>
      <para>使用協力廠商工具分割實體磁碟或邏輯磁碟。如果您變更正在執行系統中的分割區，則裝置對應程式多重路徑 (DM-MP) 模組將不會自動偵測並反映這些變更。DM-MPIO 必須重新啟始化，這通常需要重新開機。</para>
     </listitem>
     <listitem>
      <para>使用協力廠商 SAN 陣列管理工具建立並設定硬體 RAID 裝置。</para>
     </listitem>
     <listitem>
      <para>使用協力廠商 SAN 陣列管理工具建立邏輯裝置，例如 LUN。指定陣列所支援的邏輯裝置類型由陣列廠商決定。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="beg2q2x">
    <title>軟體 RAID</title>
    <para>Linux 軟體 RAID 管理軟體在多重路徑的最上層執行。對於每個具有多重 I/O 路徑的裝置和要用於軟體 RAID 的裝置來說，您必須先設定多重路徑的裝置，然後才能嘗試建立軟體 RAID 裝置。無法自動探查多重路徑裝置。軟體 RAID 無法知曉多重路徑管理是否於後台執行。</para>
    <para>如需為現有軟體 RAID 設定多重路徑的相關資訊，請參閱<xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="beg2pi0">
    <title>高可用性解決方案</title>
    <para>叢集儲存資源的高可用性解決方案在每個節點上之多重路徑服務的基礎上執行。請確保每個節點上之 <filename>/etc/multipath.conf</filename> 檔案中的組態設定在整個叢集中保持一致。 </para>
    <para>執行下列動作，確保所有裝置中的多重路徑裝置名稱都相同： </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>使用 UUID 及別名來確保多重路徑裝置名稱在叢集中的所有節點上都保持一致。別名在所有節點中必須是唯一的。將 <filename>/etc/multipath.conf</filename> 檔案從節點複製到叢集中所有其他節點的 <filename>/etc/</filename> 目錄上。</para>
     </listitem>
     <listitem>
      <para>使用多重路徑對應裝置的連結時，請確定在 <filename>/dev/disk/by-id</filename> 目錄中指定 <filename>dm-uuid*</filename> 名稱或別名，而不是裝置的固定路徑例項。如需更多資訊，請參閱<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>將 <literal>user_friendly_names</literal> 組態選項設為「否」以將其停用。使用者易記的名稱對於某個節點而言是唯一的，但是叢集中的每個節點可能無法為裝置指定相同的使用者易記名稱。 </para>
      <para>執行下列動作，您可以強制系統定義的使用者易記名稱在叢集中的所有節點上都保持一致：</para>
      <orderedlist spacing="normal">
       <listitem>
        <para>在一個節點上的 <filename>/etc/multipath.conf</filename> 檔案中： </para>
        <orderedlist spacing="normal">
         <listitem>
          <para>將 <literal>user_friendly_names</literal> 組態選項設為「yes」以將其啟用。 </para>
          <para>多重路徑會使用 <filename>/var/lib/multipath/bindings</filename> 檔案為 <filename>/dev/mapper</filename> 目錄中的裝置指定一個永久且唯一的名稱，格式為 <filename>mpath&lt;<replaceable>n</replaceable>&gt;</filename>。 </para>
         </listitem>
         <listitem>
          <para>(選擇性) 設定 <literal>/etc/multipath.conf</literal> 檔案之 <literal>defaults</literal> 區段中的 <literal>bindings_file</literal> 選項，以指定 <filename>bindings</filename> 檔案的替代位置。 </para>
          <para>預設位置為 <filename>/var/lib/multipath/bindings</filename>。</para>
         </listitem>
        </orderedlist>
       </listitem>
       <listitem>
        <para>設定節點上的所有多重路徑裝置。</para>
       </listitem>
       <listitem>
        <para>將 <filename>/etc/multipath.conf</filename> 檔案從節點複製到叢集中所有其他節點的 <filename>/etc/</filename> 目錄上。</para>
       </listitem>
       <listitem>
        <para>將 <filename>bindings</filename> 檔案從該節點複製到叢集中所有其他節點上的 <filename>bindings_file</filename> 路徑中。 </para>
       </listitem>
      </orderedlist>
     </listitem>
    </itemizedlist>
    <para>用於 LAN 鏡像複製裝置的分散式複製區塊裝置 (DRBD) 高可用性解決方案在多重路徑的基礎上執行。對於每個具有多重 I/O 路徑的裝置和要用於 DRDB 解決方案的裝置來說，您必須先設定多重路徑的裝置，然後才能設定 DRDB。</para>
   </sect3>
   <sect3 id="beg2pdq">
    <title>磁碟區管理器</title>
    <para>磁碟區管理員 (如 LVM2 和 Clustered LVM2) 在多重路徑的基礎上執行。必須先設定裝置的多重路徑，然後才能使用 LVM2 或 cLVM2 在其上建立區段管理員和檔案系統。如需更多資訊，請參閱<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="beg2pdr">
    <title>虛擬化環境</title>
    <para>在虛擬化環境中使用多重路徑時，將在主機伺服器環境中控制多重路徑。請先設定裝置的多重路徑，然後才能將其指派給虛擬訪客機器。</para>
   </sect3>
  </sect2>
  <sect2 id="b122uvel">
   <title>multipath-tools-0.4.9 中的 PRIO 設定</title>
   <para>SLES 11 SP2 會將 multipath-tools 從 0.4.8 升級至 0.4.9。PRIO 語法中的某些變更需要您視需要手動修改 <filename>/etc/multipath.conf</filename> 檔案以符合新語法。</para>
   <para><filename>/etc/multipath.conf</filename> 檔案中 <literal>prio</literal> 關鍵字的語法在 <filename>multipath-tools-0.4.9</filename> 中已變更。<literal>prio</literal> 行會指定優先程度排序器。如果優先程度排序器需要引數，您可以在另一行上使用 <literal>prio_args</literal> 關鍵字來指定該引數。而在以前，優先程度排序器及其引數包含在 <literal>prio</literal> 行上。</para>
   <para>多重路徑工具 0.4.9 及更新版本會使用 <filename>/etc/multipath.conf</filename> 檔案之 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 區段中的 <literal>prio</literal> 設定。當關鍵字 <literal>prio</literal> 是為 <literal>multipaths{)</literal> 區段中的個別 <literal>multipath</literal> 定義而指定時，它會無訊息式地忽略該關鍵字。在適用於 SLES 11 SP1 的多重路徑工具 0.4.8 及更早版本中，允許 <literal>multipaths{)</literal> 區段中個別 <literal>multipath</literal> 定義中的 prio 設定覆寫 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 區段中的 <literal>prio</literal> 設定。</para>
  </sect2>
  <sect2 id="mpiousingdev">
   <title>將 WWID、使用者易記的名稱和別名用於多重路徑裝置</title>
   <para role="intro">多重路徑裝置可透過其 WWID、使用者易記的名稱或您為其指定的別名來唯一識別。<filename>/dev/sdn</filename> 和 <filename>/dev/dm-n</filename> 格式的裝置節點名稱可在重新開機時變更，並且每次可能都會指定給不同的裝置。裝置的 WWID、使用者易記的名稱和別名在重新開機期間始終不變，因此是識別裝置的最好方法。</para>
   <para>如果您要直接使用整個 LUN (例如，若您使用 SAN 功能分割您的儲存區)，可為 <command>mkfs</command>、<command>fstab</command>、您的應用程式等使用 <filename>/dev/disk/by-id/xxx</filename> 名稱。分割的裝置會將 <filename>_part&lt;n&gt;</filename> 附加到裝置名稱中，例如 <filename>/dev/disk/by-id/xxx_part1</filename>。</para>
   <para>在 <filename>/dev/disk/by-id</filename> 目錄中，多重路徑對應裝置會以裝置的 <filename>dm-uuid*</filename> 名稱或別名 (如果在 <filename>/etc/multipath.conf</filename> 檔案中為它指定了別名) 表示。<filename>scsi-</filename> 與 <filename>wwn-</filename> 裝置名稱表示裝置的實體路徑。 </para>
   <important>
    <para>使用多重路徑對應裝置的連結時，請確定在 <filename>/dev/disk/by-id</filename> 目錄中指定 <filename>dm-uuid*</filename> 名稱或別名，而不是裝置的固定路徑例項。</para>
   </important>
   <para>在 <filename>/etc/multipath.conf</filename> 檔案中定義裝置別名時，請確定使用的是每個裝置的 WWID (例如 <filename>3600508e0000000009e6baa6f609e7908</filename>) 而不是其 WWN，後者會以 <filename>0x</filename> 取代裝置 ID 的第一個字元，例如 <filename>0x600508e0000000009e6baa6f609e7908</filename>。 </para>
   <para>如需將使用者易記的名稱和別名用於多重路徑裝置的相關資訊，請參閱<xref linkend="mpionames" xrefstyle="HeadingOnPage"/>。</para>
  </sect2>
  <sect2 id="mpiousinglvm">
   <title>在多重路徑裝置上使用 LVM2</title>
   <para>請確保 <filename>lvm.conf</filename> 的組態檔案指向多重路徑裝置名稱，而不是固定的路徑名稱。如果 <filename>boot.multipath</filename> 已啟用並在 <filename>boot.lvm</filename> 之前載入，則應自動完成此操作。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b13iv5ro" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b13iv6p5" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b13iv6p6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b13iv5ro">
    <title>在 /etc/lvm/lvm.conf 檔案中新增多重路徑裝置過濾器</title>
    <para>LVM2 預設不辨識多重路徑裝置。若要讓 LVM2 將多重路徑裝置識別為可能的實體磁碟區，您必須修改 <filename>/etc/lvm/lvm.conf</filename> 以透過多重路徑 I/O 層級掃描多重路徑裝置。 </para>
    <para>新增多重路徑過濾器可防止 LVM 掃描並使用代表 SAN (/dev/sd*) 的個別路徑之原始裝置節點的實體路徑。請確定指定了過濾器路徑，以便在設定多重路徑之後，LVM 僅掃描裝置 (<filename>/dev/disk/by-id/dm-uuid-.*-mpath-.*</filename>) 的裝置對應程式名稱。</para>
    <para>若要修改多重路徑的 <filename>/etc/lvm/lvm.conf</filename>，請使用以下方法：</para>
    <procedure id="bg89qbw">
     <step id="bg89qbx" performance="required">
      <para>在文字編輯器中開啟 <filename>/etc/lvm/lvm.conf</filename> 檔案。</para>
      <para>如果 <filename>/etc/lvm/lvm.conf</filename> 不存在，您可以在終端機主控台提示符處輸入以下指令，根據目前的 LVM 組態建立該檔案：</para>

<screen>
lvm dumpconfig &gt; /etc/lvm/lvm.conf
</screen>

     </step>
     <step id="bg89qku" performance="required">
      <para>變更 <literal>/etc/lvm/lvm.conf</literal> 中的 <literal>filter</literal> 和 <filename>types</filename> 項目，如下所示： </para>

<screen>
filter = [ "a|/dev/disk/by-id/.*|", "r|.*|" ]
types = [ "device-mapper", 1 ]
</screen>

      <para>這樣可讓 LVM2 只掃描 by-id 路徑，而拒絕其他所有項目。 </para>
      <para>若您使用的是使用者易記的名稱，請指定過濾器路徑，以便在設定多重路徑之後僅掃描裝置對應程式名稱。下列過濾器路徑僅接受多重路徑裝置上的分割區：</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*-mpath-.*|", "r|.*|" ]
</screen>

      <para>若要接受裝置對應程式名稱的原始磁碟區和分割區，請按如下所示指定路徑，<filename>mpath</filename> 前面不需要連字號 (-)︰</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*mpath-.*|", "r|.*|" ]
</screen>

     </step>
     <step id="bg89rst" performance="required">
      <para>如果您也在非多重路徑裝置上使用 LVM2，請對 <literal>filter</literal> 和 <literal>types</literal> 進行必要的調整以符合您的設定。否則，在修改 <filename>lvm.conf</filename> 檔案以啟用多重路徑後，使用 <command>pvscan</command> 將無法顯示其他 LVM 裝置。 </para>
      <para>您只想將使用 LVM 設定的裝置包含到 LVM 快取中，因此請務必明確指定過濾器應包含哪些其他非多重路徑裝置。</para>
      <para>例如，如果本地磁碟為 <filename>/dev/sda</filename>，且所有 SAN 裝置都為 <filename>/dev/sdb</filename> 及以上，則在過濾器中按如下方式指定本地路徑和多重路徑：</para>

<screen>
filter = [ "a|/dev/sda.*|", "a|/dev/disk/by-id/.*|", "r|.*|" ]
types = [ "device-mapper", 253 ]
</screen>

     </step>
     <step id="bg89rib" performance="required">
      <para>儲存檔案。</para>
     </step>
     <step id="bg89zhw" performance="required">
      <para>將 dm-multipath 新增至 <filename>/etc/sysconfig/kernel:INITRD_MODULES</filename>。</para>
     </step>
     <step id="bg8aqrw" performance="required">
      <para>新增一個 <filename>initrd</filename> 以確保裝置對應程式多重路徑服務已使用變更後的設定載入。僅當根 (/) 裝置或其任何部分 (例如 <filename>/var</filename>、<filename>/etc</filename>、<filename>/log</filename>) 位於 SAN 上且需要多重路徑以便開機時，才需要執行 <command>mkinitrd</command>。</para>
      <para>在終端機主控台提示符下輸入以下指令：</para>

<screen>
mkinitrd -f multipath
</screen>

     </step>
     <step id="bg89rnr" performance="required">
      <para>重新開機伺服器以套用變更。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="b13iv6p5">
    <title>啟用 boot.multipath</title>
    <para>必須在 LVM 之前載入多重路徑，以確保正確建立多重路徑對應。如果在 LVM 之後載入多重路徑，可能會導致多重路徑裝置的裝置對應不完整，這是因為 LVM 會鎖定裝置，使得 MPIO 無法正確建立對應。 </para>
    <para>如果系統裝置是不使用 MPIO 和 LVM 的本地裝置，則您可以停用 <filename>boot.multipath</filename> 與 <filename>boot.lvm</filename>。伺服器啟動之後，您可以在啟動 LVM 之前手動啟動多重路徑，然後執行 <command>pvscan</command> 指令以識別 LVM 物件。</para>
   </sect3>
   <sect3 id="b13iv6p6">
    <title>LVM 裝置的 MPIO 對應疑難排解</title>
    <para>啟動 LVM 程序的時間非常重要。如果 LVM 在 MPIO 對應完成之前啟動，LVM 可能會使用裝置的固定路徑，而不是其多重路徑。由於裝置正常工作，因此在固定路徑失敗之前，您可能不會意識到裝置的 MPIO 對應不完整。您可以啟用 <filename>boot.multipath</filename> 並依照<xref linkend="b13iv5ro" xrefstyle="HeadingOnPage"/> 中的指示操作，以協助防止該問題。 </para>
    <para>若要疑難排解對應問題，您可以使用 <command>dmsetup</command> 來檢查每個多重路徑裝置是否都存在預期的路徑數。以 <systemitem>root</systemitem> 使用者的身分，在命令提示字元中輸入下列內容：</para>

<screen>
dmsetup ls --tree
</screen>

    <para>在下面的範例回應中，第一個裝置有四個路徑。第二個裝置是只有一個路徑的本地裝置。第三個裝置有兩個路徑。此工具不會報告主動路徑與被動路徑之間的區別。</para>

<screen>
  vg910-lv00 (253:23)
    └─ 360a980006465576657346d4b6c593362 (253:10)
      |- (65:96)
      |- (8:128)
      |- (8:240)
      └─ (8:16)
  vg00-lv08 (253:9)
    └─ (8:3)
  system_vg-data_lv (253:1)
    └─36006016088d014007e0d0d2213ecdf11 (253:0)
      ├─ (8:32)
      └─ (8:48)
</screen>

    <para>錯誤的對應通常會傳回很少的路徑，並且不含主要編號 253。例如，下面展示了針對第三個裝置的錯誤對應情況︰</para>

<screen>
  system_vg-data_lv (8:31)
     └─ (8:32)
</screen>

   </sect3>
  </sect2>
  <sect2 id="mpiousingmdadm">
   <title>將 mdadm 用於多重路徑裝置</title>
   <para><command>mdadm</command> 工具要求以 ID 而非裝置節點路徑存取裝置。因此，<filename>/etc/mdadm.conf</filename> 檔案中的 <systemitem>DEVICE</systemitem> 項目應按如下所示設定，以確保在設定多重路徑之後僅掃描裝置對應程式名稱：</para>

<screen>
DEVICE /dev/disk/by-id/dm-uuid-.*mpath-.*
</screen>

   <para>如果您使用的是使用者易記名稱或多重路徑別名，請按如下所示指定路徑：</para>

<screen>
DEVICE /dev/disk/by-id/dm-name-.*
</screen>

  </sect2>
  <sect2 id="b14ff9rs">
   <title>將多重路徑用於 NetApp 裝置</title>
   <para>將多重路徑用於 NetApp 裝置時，建議在 <filename>/etc/multipath.conf</filename> 檔案中進行如下設定：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>為 NetApp 裝置全域設定下列參數的預設值：</para>

<screen>
max_fds max

queue_without_daemon no
</screen>

    </listitem>
    <listitem>
     <para>在硬體表中為 NetApp 裝置設定下列參數的預設值：</para>

<screen>
dev_loss_tmo infinity

fast_io_fail_tmo 5

features "3 queue_if_no_path pg_init_retries 50"
</screen>

    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bleqcv0">
   <title>將 --noflush 用於多重路徑裝置</title>
   <para>在多重路徑裝置上執行時，應始終使用 <literal>--noflush</literal> 選項。 </para>
   <para>例如，在執行表格重新載入的程序檔中，應使用 <literal>--noflush</literal> 選項進行恢復，以確保所有重要 I/O 不會被衝洗，因為您需要多重路徑拓樸資訊。</para>

<screen>
load
resume --noflush
</screen>

  </sect2>
  <sect2 id="bok8cn1">
   <title>根裝置為多重路徑裝置時的 SAN 逾時設定</title> 
   <para>所有路徑都已失敗並已從系統移除時，多重路徑裝置上包含根目錄 (<filename>/</filename>) 的系統可能會停止，因為系統會收到儲存子系統 (例如光纖通道儲存陣列) 發出的 <literal>dev_loss_tmo</literal> 逾時通知。 </para>
   <para>如果系統裝置設定了多個路徑，且多重路徑 <literal>no_path_retry</literal> 設定處於啟用狀態，您應相應地修改儲存子系統的 <literal>dev_loss_tmo</literal> 設定，以確保在所有路徑失效的情況下不會移除任何裝置。強烈建議您將 <literal>dev_loss_tmo</literal> 的值設為等於或大於多重路徑中 <literal>no_path_retry</literal> 設定的值。</para>
   <para>建議按如下方式設定儲存子系統的 <literal>dev_los_tmo</literal>：</para>

<screen>
&lt;dev_loss_tmo&gt; = &lt;no_path_retry&gt; * &lt;polling_interval&gt;
</screen>

   <para>其中，以下定義適用於多重路徑值：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><literal>no_path_retry</literal> 定義多重路徑 I/O 嘗試多少次後路徑視為遺失並停止將 I/O 排入佇列。 </para>
    </listitem>
    <listitem>
     <para><literal>polling_interval</literal> 是執行路徑檢查的時間間隔 (以秒為單位)。</para>
    </listitem>
   </itemizedlist>
   <para>每個多重路徑值都應在 <filename>/etc/multipath.conf</filename> 組態檔案中設定。如需更多資訊，請參閱<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="mpiousingpart">
   <title>分割多重路徑裝置</title>
   <para>如果正在升級，則對多重路徑裝置分割方式的行為變更可能會影響您的組態。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="binawqz" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="binazqd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="binazxj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="binawqz">
    <title>SUSE Linux Enterprise Server 11</title>
    <para>在 SUSE Linux Enterprise Server 11 中，當啟動多重路徑時，預設多重路徑設定依賴 <command>udev</command> 覆寫 <filename>/dev/disk/by-id</filename> 目錄中的現存符號連結。在您啟動多重路徑之前，該連結透過使用裝置的 <filename>scsi-xxx</filename> 名稱來指向 SCSI 裝置。當多重路徑正在執行時，該符號連結則透過使用裝置的 <filename>dm-uuid-xxx</filename> 名稱來指向裝置。這樣可確保不論多重路徑是否啟動，<filename>/dev/disk/by-id</filename> 路徑中的符號連結始終指向同一裝置。 </para>
    <para>請確保 <filename>lvm.conf</filename> 與 <filename>md.conf</filename> 的組態檔案指向多重路徑裝置名稱。如果 <filename>boot.multipath</filename> 已啟用並在 <filename>boot.lvm</filename> 與 <filename>boot.md</filename> 之前載入，則應自動完成此操作。否則，LVM 與 MD 組態檔案可能包含多重路徑裝置的固定路徑，並且您必須修正那些路徑才能使用多重路徑裝置名稱。如需 LVM2 與 cLVM 的詳細資訊，請參閱<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。如需軟體 RAID 的詳細資訊，請參閱<xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/>。</para>
   </sect3>
   <sect3 id="binazqd">
    <title>SUSE Linux Enterprise Server 10</title>
    <para>在 SUSE Linux Enterprise Server 10 中，使用 <filename>kpartx</filename> 軟體在 <filename>/etc/init.d/boot.multipath</filename> 中將符號連結新增至所有新建立磁碟分割區之 <filename>multipath.conf</filename> 組態檔案的 <filename>/dev/dm-*</filename> 行中，且不需要重新開機。這樣會觸發 <filename>udevd</filename> 以填寫 <filename>/dev/disk/by-*</filename> 符號連結。其主要優點是您可以使用新參數呼叫 <filename>kpartx</filename>，而無需重新開機伺服器。</para>
   </sect3>
   <sect3 id="binazxj">
    <title>SUSE Linux Enterprise Server 9</title>
    <para>在 SUSE Linux Enterprise Server 9 中，無法分割多重路徑 I/O 裝置自身。如果基礎實體裝置已進行分割，則多重路徑 I/O 裝置將反映這些分割區，且該層會提供 <filename>/dev/disk/by-id/&lt;name&gt;p1 ... pN</filename> 裝置，讓您可透過多重路徑 I/O 層存取分割區。因此，需要在啟用多重路徑 I/O 之前分割裝置。如果變更正在執行之系統中的磁碟分割，則 DM-MPIO 不會自動偵測並反映這些變更。必須重新啟始化裝置，這通常需要重新開機。 </para>
   </sect3>
  </sect2>
  <sect2 id="be5rs3a">
   <title>多重路徑 I/O 的受支援結構</title>
   <para>多重路徑驅動程式與工具支援以下七種受支援的處理器結構：IA32、AMD64/EM64T、IPF/IA64、p-Series (32 位元 與 64 位元)、z-Series (31 位元與 64 位元)。</para>
  </sect2>
  <sect2 id="be5ruyr">
   <title>多重路徑的受支援儲存陣列</title>
   <para>多重路徑驅動程式與工具支援大部分儲存陣列。儲存多重路徑裝置的儲存陣列必須支援多重路徑，這樣才能使用多重路徑驅動程式與工具。一些儲存陣列廠商會提供其自己的多重路徑管理工具。請參閱廠商的硬體文件以決定所需設定。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="be5s8ae">
    <title>為多重路徑自動偵測儲存陣列</title>
    <para><filename>multipath-tools</filename> 套件會自動偵測以下儲存陣列：</para>
    <simplelist>
     <member>3PARdata VV</member> <member>AIX NVDISK</member> <member>AIX VDASD</member> <member>APPLE Xserve RAID</member> <member>COMPELNT Compellent Vol</member> <member>COMPAQ/HP HSV101、HSV111、HSV200、HSV210、HSV300、HSV400、HSV 450</member> <member>COMPAQ/HP MSA、HSV</member> <member>COMPAQ/HP MSA VOLUME</member> <member>DataCore SANmelody</member> <member>DDN SAN DataDirector</member> <member>DEC HSG80</member> <member>DELL MD3000</member> <member>DELL MD3000i</member> <member>DELL MD32xx</member> <member>DELL MD32xxi</member> <member>DGC</member> <member>EMC Clariion</member> <member>EMC Invista</member> <member>EMC SYMMETRIX</member> <member>EUROLOGC FC2502</member> <member>FSC CentricStor</member> <member>FUJITSU ETERNUS_DX、DXL、DX400、DX8000</member> <member>HITACHI DF</member> <member>HITACHI/HP OPEN</member> <member>HP A6189A</member> <member>HP HSVX700</member> <member>HP LOGICAL VOLUME</member> <member>HP MSA2012fc、MSA 2212fc、MSA2012i</member> <member>HP MSA2012sa、MSA2312 fc/i/sa、MCA2324 fc/i/sa、MSA2000s VOLUME</member> <member>HP P2000 G3 FC|P2000G3 FC/iSCSI|P2000 G3 SAS|P2000 G3 iSCSI</member> <member>IBM 1722-600</member> <member>IBM 1724</member> <member>IBM 1726</member> <member>IBM 1742</member> <member>IBM 1745、1746</member> <member>IBM 1750500</member> <member>IBM 1814</member> <member>IBM 1815</member> <member>IBM 1818</member> <member>IBM 1820N00</member> <member>IBM 2105800</member> <member>IBM 2105F20</member> <member>IBM 2107900</member> <member>IBM 2145</member> <member>IBM 2810XIV</member> <member>IBM 3303 NVDISK</member> <member>IBM 3526</member> <member>IBM 3542</member> <member>IBM IPR</member> <member>IBM Nseries</member> <member>IBM ProFibre 4000R</member> <member>IBM S/390 DASD ECKD</member> <member>IBM S/390 DASD FBA</member> <member>Intel Multi-Flex</member> <member>LSI/ENGENIO INF-01-00</member> <member>NEC DISK ARRAY</member> <member>NETAPP LUN</member> <member>NEXENTA COMSTAR</member> <member>Pillar Axiom</member> <member>PIVOT3 RAIGE VOLUME</member> <member>SGI IS</member> <member>SGI TP9100、TP 9300</member> <member>SGI TP9400、TP9500</member> <member>STK FLEXLINE 380</member> <member>STK OPENstorage D280</member> <member>SUN CSM200_R</member> <member>SUN LCSM100_[IEFS]</member> <member>SUN STK6580、STK6780</member> <member>SUN StorEdge 3510、T4</member> <member>SUN SUN_6180</member>
    </simplelist>
    <para>一般說來，大多數其他儲存陣列應該都可使用。自動偵測到儲存陣列後，會套用多重路徑的預設設定。如果您需要非預設設定，則必須手動建立並設定 <filename>/etc/multipath.conf</filename> 檔案。如需更多資訊，請參閱<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
    <para>對支援多重路徑的 IBM zSeries 裝置進行的測試表明，應將 <literal>dev_loss_tmo</literal> 參數設定為 90 秒，將 <literal>fast_io_fail_tmo</literal> 參數設定為 5 秒。若您使用的是 zSeries 裝置，則必須手動建立並設定 <filename>/etc/multipath.conf</filename> 檔案來指定這些值。如需更多資訊，請參閱<xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/>。</para>
    <para>對於未自動偵測到的硬體，需要在 <filename>/etc/multipath.conf</filename> 檔案的 <literal>devices</literal> 區段中設定相應的項目。在此狀況下，您必須手動建立並設定組態檔案。如需更多資訊，請參閱<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
    <para>請考慮以下警告： </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>並非所有自動偵測到的儲存陣列都已在 SUSE Linux Enterprise Server 上經過測試。如需更多資訊，請參閱<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>某些儲存陣列可能需要特定的硬體處理器。硬體處理器是在切換路徑群組與處理 I/O 錯誤時執行硬體特定動作的核心模組。如需更多資訊，請參閱<xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/>。</para>
     </listitem>
     <listitem>
      <para>修改 <filename>/etc/multipath.conf</filename> 檔案後，必須執行 <command>mkinitrd</command> 在系統中重新建立 INITRD，然後重新開機以使變更生效。</para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="mpiosuphw">
    <title>經測試支援多重路徑的儲存陣列</title>
    <para>下列儲存陣列已經過 SUSE Linux Enterprise Server 測試：</para>
    <simplelist>
     <member>EMC</member> <member>Hitachi</member> <member>Hewlett-Packard/Compaq</member> <member>IBM</member> <member>NetApp</member> <member>SGI</member>
    </simplelist>
    <para>大多數其他廠商提供的儲存陣列應該也可使用。請參閱廠商文件獲取指導原則。如需 <filename>multipath-tools</filename> 套件可辨識的預設儲存陣列清單，請參閱<xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/>。</para>
   </sect3>
   <sect3 id="be5s6p6">
    <title>需要特定硬體處理器的儲存陣列</title>
    <para>從一個路徑到另一個路徑的容錯移轉時需要特殊指令的儲存陣列，或需要特殊非標準錯誤處理的儲存陣列，可能都需要額外的延伸支援。因此，裝置對應程式多重路徑服務已配備用於硬體處理器的插入程式。例如，已針對 EMC CLARiiON CX 陣列系列提供一個此類處理器。 </para>
    <important>
     <para>請參閱硬體廠商文件，以確定是否必須安裝硬體處理器以用於裝置對應程式多重路徑。</para>
    </important>
    <para><command>multipath -t</command> 指令可顯示需要使用特定硬體處理器進行特殊處理之儲存陣列的內部表格。所顯示的清單不是受支援儲存陣列的完整清單。它列出的僅僅是需要特殊處理的陣列，以及 <filename>multipath-tools</filename> 開發人員在開發該工具期間有存取權限的陣列。</para>
    <important>
     <para>真正支援主動/主動多重路徑的陣列不需要特殊處理，因此 <command>multipath -t</command> 指令不會列出此類陣列。 </para>
    </important>
    <para><command>multipath -t</command> 表格中的清單內容並不表示已在該特定硬體上進行 SUSE Linux Enterprise Server 測試。如需經過測試的儲存陣列清單，請參閱<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>。</para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="mpiotools">
  <title>多重路徑管理工具</title>
  <para>SUSE Linux Enterprise Server 10 及更高版本中的多重路徑支援以 Linux 2.6 核心的裝置對應程式多重路徑模組及 <systemitem>multipath-tools</systemitem> 使用者空間套件為基礎。使用多裝置管理 (MDADM，<command>mdadm</command>) 公用程式可以檢視多重路徑裝置的狀態。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpiotoolsdm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiotoolsmpt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiotoolsmdadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="beep4ms" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="mpiotoolsdm">
   <title>裝置對應程式多重路徑模組</title>
   <para>裝置對應程式多重路徑 (DM-MP) 模組為 Linux 提供了多重路徑功能。DM-MPIO 是在 SUSE Linux Enterprise Server 11 中進行多重路徑的較好解決方案。它是該產品提供的唯一一個多重路徑選項，Novell 與 SUSE 均對其完全支援。 </para>
   <para>DM-MPIO 可自動設定多重路徑子系統的多種設定。每個裝置最多可設定 8 個路徑。模組支援主動/被動 (一個主動路徑，其他均為被動路徑) 或主動/主動 (所有路徑均為主動路徑，使用輪替式負載平衡) 組態。 </para>
   <para>DM-MPIO 框架可以採用以下兩種方式進行擴充： </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>使用特定硬體處理器。如需更多資訊，請參閱<xref linkend="be5s6p6" xrefstyle="HeadingOnPage"/>。</para>
    </listitem>
    <listitem>
     <para>使用更精密的負載平衡演算法取代輪替式演算法</para>
    </listitem>
   </itemizedlist>
   <para>DM-MPIO 的使用者空間元件會自動探查路徑並進行分組，還會自動重新測試路徑，以便在先前失敗的路徑恢復正常時，能自動重新啟用該路徑。這樣會將管理員對生產環境的關注需求降到最低。</para>
   <para>DM-MPIO 防範的是裝置路徑中的失敗，而不是裝置本身的失敗。如果其中一個主動路徑遺失 (例如網路卡損壞或光纖纜線被移開)，則 I/O 會重新導向到其餘的路徑。如果組態為主動/被動模式，則路徑會容錯移轉到其中一個被動路徑。如果您使用的是輪替式負載平衡組態，則流量會分流到其餘的正常路徑。如果所有主動路徑都失敗，則必須喚醒非主動的次要路徑，因此需經過大約 30 秒的延遲之後才會開始容錯移轉。</para>
   <para>如果磁碟陣列有多個儲存處理器，請確保 SAN 交換器已連接到您要存取的 LUN 所屬的儲存處理器。在大多數磁碟陣列中，所有 LUN 都屬於兩個儲存處理器，因此兩個連接都處於主動模式。 </para>
   <note>
    <para>在有些磁碟陣列中，儲存陣列透過儲存處理器來管理流量，因此每次只會顯示一個儲存處理器。一個處理器為主動，另外一個為被動，直到發生了失敗。如果您連接到錯誤的儲存處理器 (路徑為被動的處理器)，則可能找不到所需的 LUN，或雖然找到了 LUN，但在嘗試存取時會發生錯誤。 </para>
   </note>
   <table id="b567ef1" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>儲存陣列的多重路徑 I/O 功能</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2857*"/>
    <colspec colnum="2" colname="2" colwidth="7144*"/>
     <thead>
      <row id="b567fx1">
       <entry>
        <para>儲存陣列的功能</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b567fx2">
       <entry>
        <para>主動/被動控制器</para>
       </entry>
       <entry>
        <para>只有一個控制器處於主動狀態，並服務所有的 LUN。次要控制器處於待命狀態。次要控制器也會將 LUN 提供給多重路徑元件，以便作業系統瞭解備援路徑的情況。如果主要控制器失敗，則由次要控制器接管其工作並服務所有 LUN。</para>
        <para>在某些陣列中，可將 LUN 指定給不同的控制器。將指定的 LUN 指定給要做為其主動控制器的控制器。每次當一個控制器為任何指定的 LUN 執行磁碟 I/O 時，另一個控制器就為該 LUN 保持待命狀態。另外的那個控制器也會提供路徑，但無法執行磁碟 I/O。使用該 LUN 的伺服器會連接到 LUN 的指定控制器。如果一組 LUN 的主要控制器失敗，則由次要控制器接管其工作並服務所有 LUN。</para>
       </entry>
      </row>
      <row id="b567fx3">
       <entry>
        <para>主動/主動控制器</para>
       </entry>
       <entry>
        <para>兩個控制器共享所有 LUN 的負載，可以處理任何指定 LUN 的磁碟 I/O。如果一個控制器失敗，另一個控制器便會自動處理所有流量。</para>
       </entry>
      </row>
      <row id="b567fx4">
       <entry>
        <para>載入平衡</para>
       </entry>
       <entry>
        <para>裝置對應程式多重路徑驅動程式會自動對通過所有主動路徑的流量進行負載平衡控制。</para>
       </entry>
      </row>
      <row id="b567fx6">
       <entry>
        <para>控制器容錯移轉</para>
       </entry>
       <entry>
        <para>主動控制器容錯移轉到被動 (或待命) 控制器時，裝置對應程式多重路徑驅動程式會自動啟動主機與待命之間的路徑，使其成為主要路徑。 </para>
       </entry>
      </row>
      <row id="b567fx5">
       <entry>
        <para>開機/根裝置支援</para>
       </entry>
       <entry>
        <para>SUSE Linux Enterprise Server 10 及更高版本提供對根 (<filename>/</filename>) 裝置的多重路徑支援。主機伺服器必須連接到開機裝置目前的主動控制器與儲存處理器。</para>
        <para>SUSE Linux Enterprise Server 11 及更高版本提供了對 <filename>/boot</filename> 裝置的多重路徑支援。 </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>裝置對應程式多重路徑會偵測每個路徑，查看有無多重路徑裝置做為獨立的 SCSI 裝置。SCSI 裝置名稱採用的格式為 <filename>/dev/sd<replaceable>N</replaceable></filename>，其中 <filename><replaceable>N</replaceable></filename> 是為裝置自動產生的字母，從 a 開始，並隨著裝置的建立依序發佈，例如 <filename>/dev/sda</filename>、<filename>/dev/sdb</filename>，依此類推。如果裝置數量超過 26 個，則字母將會重複，這樣，<filename>/dev/sdz</filename> 之後的裝置將命名為 <filename>/dev/sdaa</filename>、<filename>/dev/sdab</filename>，依此類推。</para>
   <para>如果有多個路徑未自動偵測到，則您可以在 <filename>/etc/multipath.conf</filename> 檔案中手動設定。在您建立並設定 <filename>multipath.conf</filename> 檔案之前，該檔案並不存在。如需更多資訊，請參閱<xref linkend="bbillhs" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="mpiotoolsmpt">
   <title>多重路徑 I/O 管理工具</title>
   <para><command>multipath-tools</command> 使用者空間套件會自動探查路徑，並對其進行分組。它會週期性地自動測試路徑，這樣，先前失敗的路徑在恢復正常後，便可自動重新啟用。這樣會將管理員對生產環境的關注需求降到最低。</para>
   <table id="b59pxng" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>multipath-tools 套件中的工具</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2857*"/>
    <colspec colnum="2" colname="2" colwidth="7144*"/>
     <thead>
      <row id="b59q186">
       <entry>
        <para>工具</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b59q187">
       <entry>
        <para>multipath</para>
       </entry>
       <entry>
        <para>對系統進行掃描，找出多重路徑裝置並進行組合。</para>
       </entry>
      </row>
      <row id="b59q188">
       <entry>
        <para>multipathd</para>
       </entry>
       <entry>
        <para>等待映射事件，然後執行 <command>multipath</command>。</para>
       </entry>
      </row>
      <row id="b59q189">
       <entry>
        <para>devmap-name</para>
       </entry>
       <entry>
        <para>為 <command>udev</command> 提供有意義的裝置名稱以進行裝置映射 (devmaps)。</para>
       </entry>
      </row>
      <row id="b59q18a">
       <entry>
        <para>kpartx</para>
       </entry>
       <entry>
        <para>將線性 devmaps 映射到多重路徑裝置中的分割區，這樣能夠建立對裝置中各分割區的多重路徑監控。</para>
       </entry>
      </row>
      <row id="b15jwqx6">
       <entry>
        <para>mpathpersist</para>
       </entry>
       <entry>
        <para>管理裝置對應程式多重路徑裝置上的 SCSI 永久保留。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>對於不同的伺服器架構，套件的檔案清單可能會有所不同。有關 multipath-tools 套件中包含的檔案清單，請造訪<ulink url="http://www.novell.com/products/server/techspecs.html?tab=1"><citetitle>「SUSE Linux Enterprise Server Technical Specifications」</citetitle>&gt;<citetitle>「Package Descriptions」</citetitle>網頁</ulink>，找到您的架構並選取<guimenu>Packages Sorted by Name</guimenu>，然後搜尋<quote>multipath-tools</quote>以找到適用於該架構的套件清單。</para>
   <para>您也可以透過查詢套件本身來確定 RPM 檔案的檔案清單：使用 <command>rpm -ql</command> 或 <command>rpm -qpl</command> 指令選項。</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>若要查詢已安裝的套件，請輸入</para>

<screen>
rpm -ql &lt;<replaceable>package_name</replaceable>&gt;
</screen>

    </listitem>
    <listitem>
     <para>若要查詢未安裝的套件，請輸入</para>

<screen>
rpm -qpl &lt;<replaceable>URL_or_path_to_package</replaceable>&gt;
</screen>

    </listitem>
   </itemizedlist>
   <para>若要檢查是否已安裝 <filename>multipath-tools</filename> 套件，請執行以下操作：</para>
   <procedure id="bcmre1m">
    <step id="bcmre1n" performance="required">
     <para>在終端機主控台提示符下輸入以下指令：</para>

<screen>
rpm -q multipath-tools
</screen>

     <para>如果已安裝，回應內容會重複該套件名稱並提供版本資訊，例如：</para>

<screen>
multipath-tools-04.7-34.23
</screen>

     <para>如果未安裝，則回應內容為：</para>

<screen>
package multipath-tools is not installed
</screen>

    </step>
   </procedure>
  </sect2>
  <sect2 id="mpiotoolsmdadm">
   <title>對多重路徑裝置使用 MDADM</title>
   <para>Udev 是預設的裝置處理器，該系統可透過 Worldwide ID (而不是裝置節點名稱) 自動識別裝置。這解決了 MDADM 與 LVM 的先前版本中組態檔案 (<filename>mdadm.conf</filename> 與 <filename>lvm.conf</filename>) 無法正確辨識多重路徑裝置的問題。 </para>
   <para>與 LVM2 一樣，MDADM 也要求透過 ID 而非裝置節點路徑存取裝置。因此，應使用如下指令設定 <filename>/etc/mdadm.conf</filename> 中的 <systemitem>DEVICE</systemitem> 項目： </para>

<screen>
DEVICE /dev/disk/by-id/*
</screen>

   <para>若您使用的是使用者易記名稱，請按照以下方式指定路徑，以便在設定多重路徑之後僅掃描裝置對應程式名稱：</para>

<screen>
DEVICE /dev/disk/by-id/dm-uuid-.*-mpath-.*
</screen>

   <para>若要驗證是否已安裝 MDADM：</para>
   <procedure id="bcmrfp3">
    <step id="bcmrfp4" performance="required">
     <para>在終端機主控台提示符處輸入以下指令，確定是否已安裝 <filename>mdadm</filename> 套件：</para>

<screen>
rpm -q mdadm
</screen>

     <para>如果已安裝，回應內容會重複該套件名稱並提供版本資訊。例如：</para>

<screen>
mdadm-2.6-0.11
</screen>

     <para>如果未安裝，則回應內容為：</para>

<screen>
package mdadm is not installed
</screen>

    </step>
   </procedure>
   <para>如需修改 <filename>/etc/lvm/lvm.conf</filename> 檔案的資訊，請參閱<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/>。</para>
  </sect2>
  <sect2 id="beep4ms">
   <title>Linux multipath(8) 指令</title>
   <para>使用 Linux <command>multipath(8)</command> 指令可以設定並管理多重路徑裝置。</para>
   <para><command>multipath(8)</command> 指令的一般語法為：</para>

<screen>
multipath [-v verbosity_level] [-b bindings_file] [-d] [-h|-l|-ll|-f|-F|-B|-c|-q|-r|-w|-W] [-p failover|multibus|group_by_serial|group_by_prio|group_by_node_name] [<replaceable>devicename</replaceable>]
</screen>

   <bridgehead id="b15drtkg">選項</bridgehead>
   <variablelist>
    <varlistentry id="b15drtkh">
     <term>-v verbosity_level</term>
     <listitem>
      <para>列印所有路徑和多重路徑。</para>
      <variablelist>
       <varlistentry id="b15drtki">
        <term>0</term>
        <listitem>
         <para>無輸出。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drtkj">
        <term>1</term>
        <listitem>
         <para>僅列印建立的或更新的多重路徑名稱。用於餽送其他工具，例如 <command>kpartx</command>。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drtkk">
        <term>2+</term>
        <listitem>
         <para>列印所有資訊︰偵測到的路徑、多重路徑和裝置映射。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkl">
     <term>-h</term>
     <listitem>
      <para>列印用法文字。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkm">
     <term>-d</term>
     <listitem>
      <para>試執行；不建立或更新裝置映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkn">
     <term>-l</term>
     <listitem>
      <para>基於 <filename>sysfs</filename> 中提取的資訊和裝置對應程式顯示目前的多重路徑拓撲。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtko">
     <term>-ll</term>
     <listitem>
      <para>基於所有可用的資訊 (sysfs、裝置對應程式、路徑檢查程式等) 顯示目前的多重路徑拓撲。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkp">
     <term>-f</term>
     <listitem>
      <para>衝洗指定為參數的多重路徑裝置映射 (如果未使用)。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkq">
     <term>-F</term>
     <listitem>
      <para>衝洗所有未使用的多重路徑裝置映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkr">
     <term>-t</term>
     <listitem>
      <para>將內部硬體表格列印至 <filename>stdout</filename>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtks">
     <term>-r</term>
     <listitem>
      <para>強制重新載入裝置映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkt">
     <term>-B</term>
     <listitem>
      <para>將繫結檔案視為唯讀檔案。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtku">
     <term>-b bindings_file</term>
     <listitem>
      <para>設定 user_friendly_names 繫結檔案位置。預設值為 <filename>/etc/multipath/bindings</filename>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkv">
     <term>-c</term>
     <listitem>
      <para>檢查區塊裝置是否應該為多重路徑裝置中的路徑。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkw">
     <term>-q</term>
     <listitem>
      <para><filename>multipathd</filename> 未執行時，允許設定了 <literal>queue_if_no_path</literal> 的裝置表格。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtkx">
     <term>-w</term>
     <listitem>
      <para>從 WWID 檔案中移除指定裝置的 WWID。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drtky">
     <term>-W</term>
     <listitem>
      <para>重設 WWID 檔案以僅包括目前的多重路徑裝置。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drv6f">
     <term>-p policy</term>
     <listitem>
      <para>強制新映射使用指定的規則。系統不會修改現有映射。</para>
      <variablelist>
       <varlistentry id="b15drv6g">
        <term>failover</term>
        <listitem>
         <para>每個優先程度群組對應一個路徑。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6h">
        <term>multibus</term>
        <listitem>
         <para>所有路徑都在一個優先程度群組中。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6i">
        <term>group_by_serial</term>
        <listitem>
         <para>每個序列對應一個優先程度群組。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6j">
        <term>group_by_prio</term>
        <listitem>
         <para>每個優先程度值對應一個優先程度群組。優先程度由註標程式決定，在組態檔案中指定為 global、per-controller 或 per-multipath 選項。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15drv6k">
        <term>group_by_node_name</term>
        <listitem>
         <para>每個目標節點名稱對應一個優先程度群組。目標節點名稱取自 <filename> /sys/class/fc_transport/target*/node_name</filename> 中。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
    <varlistentry id="b15drx1o">
     <term>device_name</term>
     <listitem>
      <para>僅更新指定裝置的裝置映射。請以裝置路徑形式 (例如 <filename>/dev/sdb</filename>)、<literal><replaceable>主要</replaceable>:<replaceable>次要</replaceable></literal>格式指定名稱，或指定多重路徑映射名稱。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="beep4mt">一般範例</bridgehead>
   <variablelist>
    <varlistentry id="bomamxl">
     <term>multipath</term>
     <listitem>
      <para>設定所有多重路徑裝置。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomalct">
     <term>multipath <replaceable>裝置名稱</replaceable></term>
     <listitem>
      <para>設定特定的多重路徑裝置。</para>
      <para>使用 <filename>/dev/sdb</filename> (顯示於 udev 的 $DEVNAME 變數中) 等裝置節點名稱取代<replaceable>裝置名稱</replaceable>，或採用 <literal>major:minor</literal> 格式。裝置也可以使用多重路徑對應名稱。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomamxm">
     <term>multipath -f</term>
     <listitem>
      <para>選擇性隱藏多重路徑映射及其映射裝置的分割區。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomamxn">
     <term>multipath -d</term>
     <listitem>
      <para>模擬執行。顯示潛在的多重路徑裝置，但不建立任何裝置，也不更新裝置映射。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomamxo">
     <term>multipath -v2 -d</term>
     <listitem>
      <para>顯示試執行中潛在多重路徑裝置的多重路徑映射資訊。使用 -v2 選項可僅顯示本地磁碟。此詳細層級會列印已建立或已更新的多重路徑名稱，僅用於為 kpartx 等其他工具提供資訊。 </para>
      <para>如果裝置已存在且沒有變更，則不會輸出內容。使用 <command>multipath -ll</command> 可查看已設定多重路徑裝置的狀態。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc3">
     <term>multipath -v2 <replaceable>裝置名稱</replaceable></term>
     <listitem>
      <para>設定特定的潛在多重路徑裝置並顯示其多重路徑映射資訊。此詳細層級僅會列印已建立或已更新的多重路徑名稱，用於為 <command>kpartx</command> 等其他工具提供資訊。 </para>
      <para>如果裝置已存在且沒有變更，則不會輸出內容。使用 <command>multipath -ll</command> 可查看已設定多重路徑裝置的狀態。</para>
      <para>使用 <filename>/dev/sdb</filename> (顯示於 <command>udev</command> 的 $DEVNAME 變數中) 等裝置節點名稱取代<replaceable>裝置名稱</replaceable>，或採用 <literal>major:minor</literal> 格式。裝置也可以使用多重路徑對應名稱。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc4">
     <term>multipath -v3</term>
     <listitem>
      <para>設定潛在的多重路徑裝置並顯示其多重路徑映射資訊。此詳細層級會列印所有已刪除的路徑、多重路徑和裝置映射。wwid 與 devnode 列入黑名單的裝置都會顯示。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc5">
     <term>multipath -v3 <replaceable>裝置名稱</replaceable></term>
     <listitem>
      <para>設定特定的潛在多重路徑裝置並顯示其資訊。使用 -v3 選項會顯示完整路徑清單。此詳細層級會列印所有已刪除的路徑、多重路徑和裝置映射。wwid 與 devnode 列入黑名單的裝置都會顯示。</para>
      <para>使用 <filename>/dev/sdb</filename> (顯示於 <command>udev</command> 的 $DEVNAME 變數中) 等裝置節點名稱取代<replaceable>裝置名稱</replaceable>，或採用 <literal>major:minor</literal> 格式。裝置也可以使用多重路徑對應名稱。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc6">
     <term>multipath -ll</term>
     <listitem>
      <para>顯示所有多重路徑裝置的狀態。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomasgg">
     <term>multipath -ll <replaceable>裝置名稱</replaceable></term>
     <listitem>
      <para>顯示指定多重路徑裝置的狀態。</para>
      <para>使用 <filename>/dev/sdb</filename> (顯示於 <command>udev</command> 的 $DEVNAME 變數中) 等裝置節點名稱取代<replaceable>裝置名稱</replaceable>，或採用 <literal>major:minor</literal> 格式。裝置也可以使用多重路徑對應名稱。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomaqc7">
     <term>multipath -F</term>
     <listitem>
      <para>衝洗所有未使用的多重路徑裝置映射。這會取消解析多個路徑，但不會刪除裝置。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomasgh">
     <term>multipath -F <replaceable>裝置名稱</replaceable></term>
     <listitem>
      <para>衝洗指定多重路徑裝置之未使用的多重路徑裝置映射。這會取消解析多個路徑，但不會刪除該裝置。</para>
      <para>使用 <filename>/dev/sdb</filename> (顯示於 <command>udev</command> 的 $DEVNAME 變數中) 等裝置節點名稱取代<replaceable>裝置名稱</replaceable>，或採用 <literal>major:minor</literal> 格式。裝置也可以使用多重路徑對應名稱。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bomasgi">
     <term>multipath -p [ failover | multibus | group_by_serial | group_by_prio | group_by_node_name ]</term>
     <listitem>
      <para>透過指定<xref linkend="beg177b" xrefstyle="TableXRef"/> 中所述的其中一個群組規則選項，來設定群組規則：</para>
      <table id="beg177b" role="1" frame="topbot" rowsep="1" pgwide="0" width="96%">
       <title>multipath -p 指令的群組規則選項</title>
       <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="2684*"/>
       <colspec colnum="2" colname="2" colwidth="7319*"/>
        <thead>
         <row id="beep4mu">
          <entry>
           <para>規則選項</para>
          </entry>
          <entry>
           <para>描述</para>
          </entry>
         </row>
        </thead>
        <tbody>
         <row id="beep4mv">
          <entry>
           <para>failover</para>
          </entry>
          <entry>
           <para>(預設) 每個優先程度群組對應一個路徑。每次只能使用一個路徑。</para>
          </entry>
         </row>
         <row id="beep4mw">
          <entry>
           <para>multibus</para>
          </entry>
          <entry>
           <para>所有路徑都在一個優先程度群組中。</para>
          </entry>
         </row>
         <row id="beep4mx">
          <entry>
           <para>group_by_serial</para>
          </entry>
          <entry>
           <para>每個偵測到的 SCSI 序號 (控制器節點全球號碼) 對應一個優先程度群組。</para>
          </entry>
         </row>
         <row id="beep4my">
          <entry>
           <para>group_by_prio</para>
          </entry>
          <entry>
           <para>每個路徑優先程度值對應一個優先程度群組。優先程度相同的路徑位於同一個優先程度群組中。優先程度由註標程式決定，在 <filename>/etc/multipath.conf</filename> 組態檔案中指定為 global、per-controller 或 per-multipath 選項。</para>
          </entry>
         </row>
         <row id="beep4mz">
          <entry>
           <para>group_by_node_name</para>
          </entry>
          <entry>
           <para>每個目標節點名稱對應一個優先程度群組。目標節點名稱取自 <filename>/sys/class/fc_transport/target*/node_name</filename> 位置。</para>
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b15jw320">
   <title>Linux mpathpersist(8) 公用程式</title>
   <para><command>mpathpersist(8)</command> 公用程式可用來管理裝置對應程式多重路徑裝置上的 SCSI 永久保留。 </para>
   <para><command>mpathpersist(8)</command> 指令的一般語法為：</para>

<screen>
mpathpersist [options] [device]
</screen>

   <para>將此公用程式與 <filename>/etc/multipath.conf</filename> 檔案中的服務動作保留金鑰 (<literal>reservation_key</literal> 屬性) 搭配使用，可設定 SCSI 裝置的永久保留。系統預設不會使用該屬性。如果未設定該屬性，<command>multipathd</command> 精靈將不會檢查新探查到的路徑或已重新啟用之路徑的永久保留。 </para>

<screen>
reservation_key &lt;<replaceable>reservation key</replaceable>&gt;
</screen>

   <para>您可以將該屬性新增至 <literal>defaults</literal> 區段或 <literal>multipaths</literal> 區段。例如：</para>

<screen>
multipaths {
        multipath {
                          wwid   XXXXXXXXXXXXXXXX
                         alias      yellow
                         reservation_key  0x123abc
      }
}
</screen>

   <para>為所有適合永久管理的多重路徑裝置設定 <literal>reservation_key</literal> 參數，然後重新啟動 <command>multipathd</command> 精靈。設定它之後，您可以在 mpathpersist 指令中指定保留金鑰。</para>
   <bridgehead id="b15jw321">選項</bridgehead>
   <variablelist>
    <varlistentry id="b15jwii5">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>輸出指令用法資訊，然後結束。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwii6">
     <term>-d &lt;<replaceable>裝置</replaceable>&gt;</term>
     <term>--device=&lt;<replaceable>裝置</replaceable>&gt;</term>
     <listitem>
      <para>查詢或變更裝置。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwii7">
     <term>-H</term>
     <term>--hex</term>
     <listitem>
      <para>以十六進位顯示輸出回應。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwii8">
     <term>-X &lt;TID&gt;</term>
     <term>--transportID=&lt;TID&gt;</term>
     <listitem>
      <para>可以用多種形式引用輸送 ID。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jw322">
     <term>-v &lt;<replaceable>層級</replaceable>&gt;</term>
     <term>--verbose &lt;<replaceable>層級</replaceable>&gt;</term>
     <listitem>
      <para>指定詳細度層級。</para>
      <variablelist>
       <varlistentry id="b15jw323">
        <term>0</term>
        <listitem>
         <para>重要訊息和錯誤訊息。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15jw324">
        <term>1</term>
        <listitem>
         <para>警告訊息。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15jw325">
        <term>2</term>
        <listitem>
         <para>資訊訊息。</para>
        </listitem>
       </varlistentry>
       <varlistentry id="b15jw326">
        <term>3</term>
        <listitem>
         <para>啟用了追蹤的資訊訊息。</para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="b15jwii9">PR In 選項</bridgehead>
   <variablelist>
    <varlistentry id="b15jwiie">
     <term>-i</term>
     <term>--位於</term>
     <listitem>
      <para>要求 PR In 指令。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiih">
     <term>-k</term>
     <term>--read-keys</term>
     <listitem>
      <para>PR In︰讀取金鑰。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiim">
     <term>-s</term>
     <term>--read-status</term>
     <listitem>
      <para>PR In︰讀取完整狀態。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiin">
     <term>-r</term>
     <term>--read-reservation</term>
     <listitem>
      <para>PR In︰讀取保留。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwiir">
     <term>-c</term>
     <term>--report-capabilities</term>
     <listitem>
      <para>PR In︰報告功能。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="b15jwiiz">PR Out 選項</bridgehead>
   <variablelist>
    <varlistentry id="b15jwij0">
     <term>-o</term>
     <term>--out</term>
     <listitem>
      <para>要求 PR Out 指令。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij1">
     <term>-c</term>
     <term>--清除</term>
     <listitem>
      <para>PR Out︰清除</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij2">
     <term>-Z</term>
     <term>--param-aptpl</term>
     <listitem>
      <para>PR Out 參數 <literal>APTPL</literal>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij3">
     <term>-S SARK</term>
     <term>--param-sark=SARK</term>
     <listitem>
      <para>十六進位的 PR Out 參數 Service Action Reservation Key (SARK)。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij4">
     <term>-P</term>
     <term>--preempt</term>
     <listitem>
      <para>PR Out︰先佔。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij5">
     <term>-A</term>
     <term>--preempt-abort</term>
     <listitem>
      <para>PR Out︰先佔並中止。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij6">
     <term>-T &lt;<replaceable>類型</replaceable>&gt;</term>
     <term>--prout-type=&lt;<replaceable>類型</replaceable>&gt;</term>
     <listitem>
      <para>PR Out 指令類型。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij7">
     <term>-G</term>
     <term>--註冊</term>
     <listitem>
      <para>PR Out︰註冊。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij8">
     <term>-I</term>
     <term>--register-ignore</term>
     <listitem>
      <para>PR Out︰註冊並忽略。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwij9">
     <term>-L</term>
     <term>--release</term>
     <listitem>
      <para>PR Out︰釋放</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b15jwija">
     <term>-R</term>
     <term>--保留</term>
     <listitem>
      <para>PR Out︰保留。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <bridgehead id="b15jwmcx">範例</bridgehead>
   <para>註冊 <filename>/dev/mapper/mpath9</filename> 裝置的服務動作保留金鑰。</para>

<screen role="compact2">
mpathpersist --out --register --param-sark=123abc --prout-type=5 -d /dev/mapper/mpath9
</screen>

   <para>讀取 <filename>/dev/mapper/mpath9</filename> 裝置的服務動作保留金鑰。</para>

<screen role="compact2">
mpathpersisst -i -k -d /dev/mapper/mpath9
</screen>

   <para>保留 <filename>/dev/mapper/mpath9</filename> 裝置的服務動作保留金鑰。</para>

<screen role="compact2">
mpathpersist --out --reserve --param-sark=123abc --prout-type=8 -d /dev/mapper/mpath9
</screen>

   <para>讀取 <filename>/dev/mapper/mpath9</filename> 裝置的保留狀態。</para>

<screen role="compact2">
mpathpersist -i -s -d /dev/mapper/mpath9
</screen>

  </sect2>
 </sect1>
 <sect1 id="mpiosysconf">
  <title>設定系統以進行多重路徑</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="mpiosysconfsandevs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiosysconfpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpioboot" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="mpiosysconfsandevs">
   <title>準備 SAN 裝置以進行多重路徑</title>
   <para>在為 SAN 裝置設定多重路徑 I/O 之前，請視需要執行以下步驟準備 SAN 裝置：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>使用廠商工具對 SAN 進行設定並分區。</para>
    </listitem>
    <listitem>
     <para>使用廠商工具設定儲存陣列中主機 LUN 的許可權。</para>
    </listitem>
    <listitem>
     <para>安裝 Linux HBA 驅動程式模組。安裝模組時，驅動程式會自動掃描 HBA 以探查任何擁有存取主機的許可權的 SAN 裝置。驅動程式會將這些裝置提交至主機以供稍後設定之用。</para>
     <note>
      <para>請確保您使用的 HBA 驅動程式沒有啟用本機多重路徑。</para>
     </note>
     <para>如需更多詳細資料，請參閱廠商的特定指示。</para>
    </listitem>
    <listitem>
     <para>載入驅動程式模組後，探查指定給特定陣列 LUN 或分割區的裝置節點。</para>
    </listitem>
    <listitem>
     <para>如果 SAN 裝置將做為伺服器上的根裝置使用，請依<xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/> 中所述修改該裝置的逾時設定。</para>
    </listitem>
   </itemizedlist>
   <para>如果 HBA 驅動程式無法探查到 LUN，可使用 <command>lsscsi</command> 來檢查作業系統是否能正常探查到 SCSI 裝置。如果 HBA 驅動程式無法探查到 LUN，請檢查 SAN 的分區設定。尤其是要檢查 LUN 遮罩是否處於使用中，且 LUN 是否正確地指定給伺服器。</para>
   <para>如果 HBA 驅動程式可以探查到 LUN，但不存在相應的區塊裝置，則還需要其他核心參數來變更 SCSI 裝置的掃描行為，如指出 LUN 沒有連續編號。相關資訊，請參閱 Novell 支援知識庫中的 <ulink url="http://support.novell.com/"><citetitle>TID 3955167: Troubleshooting SCSI (LUN) Scanning Issues (SCSI (LUN) 掃描問題疑難排解)</citetitle></ulink>。</para>
  </sect2>
  <sect2 id="mpiosysconfpart">
   <title>分割多重路徑裝置</title>
   <para>不建議對含有多個路徑的裝置進行磁碟分割，但這項操作是受支援的。使用 <command>kpartx</command> 工具無需重新開機即可在多重路徑裝置中建立分割區。在嘗試使用 YaST 中的分割程式功能或使用協力廠商分割工具設定多重路徑之前，也可以製做裝置的分割區。</para>
   <para>多重路徑裝置是裝置對應程式裝置。雖然使用指令行工具 (例如 parted、kpartx 或 fdisk) 可以修改裝置對應程式裝置，但並不一定會產生更新其他層所需的 udev 事件。分割裝置對應程式裝置之後，您應該檢查多重路徑對應，確保已對應裝置對應程式裝置。如果未對應它們，您可以重新對應多重路徑裝置，或將伺服器重新開機，以取得多重路徑對應中的所有新分割區。</para>
   <para>多重路徑裝置上一個分割區的裝置對應程式裝置不同於一個獨立裝置。使用整個裝置建立 LVM 邏輯磁碟區時，必須指定不包含分割區的裝置。如果您將多重路徑分割區指定為 LVM 邏輯磁碟區的目標裝置，則 LVM 會認為基礎實體裝置已分割，導致建立失敗。如果您需要細分 SAN 裝置，可以拆分 SAN 裝置上的 LUN，並將每個 LUN 做為獨立的多重路徑裝置顯示給伺服器。</para>
  </sect2>
  <sect2 id="mpiosysconfsvr">
   <title>在 initrd 中設定裝置驅動程式以使用多重路徑功能 </title>
   <para>您必須手動設定伺服器，讓其自動為多重路徑 IO 裝置在 <literal>initrd</literal> 中所連接的控制器載入裝置驅動程式。您需要將必要的驅動程式模組新增至檔案 <filename>/etc/sysconfig/kernel</filename> 中的變數 INITRD_MODULES。 </para>
   <para>例如，如果系統包含由 <filename>cciss</filename> 驅動程式存取的 RAID 控制器，且多重路徑裝置連接至由 qla2xxx 驅動程式存取的 QLogic 控制器，則此項目應為： </para>

<screen>
   INITRD_MODULES="cciss"
</screen>

   <para>由於 QLogic 驅動程式並不會在系統啟動時自動載入，因此請新增在這裡： </para>

<screen>
   INITRD_MODULES="cciss qla23xx"
</screen>

   <para>變更 <filename>/etc/sysconfig/kernel</filename> 後，必須使用 <command>mkinitrd</command> 指令在系統中重新建立 <literal>initrd</literal>，然後重新開機以使變更生效。</para>
   <para>若您將 LILO 當作開機管理員使用，請使用 <command>/sbin/lilo</command> 指令將其重新安裝。若您使用 GRUB，則無須進一步動作。 </para>
   <para>在 SUSE Linux Enterprise Server 11 SP3 及更新版本中，SCSI 層中新增了四個 SCSI 硬體處理程式，它們可以與 DM-Multipath 配合使用︰ </para>
   <simplelist>
    <member><filename>scsi_dh_alua</filename> </member> <member><filename>scsi_dh_rdac</filename> </member> <member><literal>scsi_dh_hp_sw</literal> </member> <member><literal>scsi_dh_emc</literal> </member>
   </simplelist>
   <para>將模組新增至 <filename>initrd</filename> 影像，然後在 <filename>/etc/multipath.conf</filename> 檔案中將它們指定為 <literal>alua</literal>、<literal>rdac</literal>、<literal>hp_sw</literal> 和 <literal>emc</literal> 硬體處理程式類型。例如，新增以下其中一行做為裝置定義︰</para>

<screen>
hardware_handler "1 alua"

hardware_handler "1 rdac"

hardware_handler "1 hp_sw"

hardware_handler "1 emc"
</screen>

   <para>若要將模組包括在 <filename>initrd</filename> 影像中︰</para>
   <procedure id="b15dscl4">
    <step id="b15dscl5" performance="required">
     <para>將裝置處理程式模組新增至 <filename>/etc/sysconfig/kernel</filename> 中的 INITRD_MODULES 變數。</para>
    </step>
    <step id="b15dscl6" performance="required">
     <para>建立新的 <filename>initrd</filename>︰</para>

<screen>
mkinitrd -k /boot/vmlinux-&lt;<replaceable>flavour</replaceable>&gt; \
-i /boot/initrd-&lt;<replaceable>flavour</replaceable>&gt;-scsi-dh \
-M /boot/System.map-&lt;<replaceable>flavour</replaceable>&gt;
</screen>

    </step>
    <step id="b15dscl7" performance="required">
     <para>使用新建立的 <filename>initrd</filename> 更新開機組態檔案 (<filename>grub.conf</filename>、<filename>lilo.conf</filename>、<filename>yaboot.conf</filename>)。</para>
    </step>
    <step id="b15dscl8" performance="required">
     <para>然後重新啟動伺服器。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="mpioboot">
   <title>新增 multipathd 至開機順序</title>
   <para>使用本節所述的方法將多重路徑 I/O 服務 (<command>multipathd</command>) 新增至開機順序。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b5c8qi6" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b5c8qtj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b5c8qi6">
    <title>使用 YaST 新增 multipathd</title>
    <procedure id="b5997ck">
     <step id="b5997cl" performance="required">
      <para>在 YaST 中，按一下<guimenu>系統</guimenu>&gt;<guimenu>系統服務 (Runlevel)</guimenu>&gt;<guimenu>簡單模式</guimenu>。</para>
     </step>
     <step id="b5997cm" performance="required">
      <para>選取<guimenu>multipathd</guimenu>，然後按一下<guimenu>啟用</guimenu>。 </para>
     </step>
     <step id="b5997cn" performance="required">
      <para>按一下<guimenu>確定</guimenu>確認服務啟動訊息。</para>
     </step>
     <step id="b5997co" performance="required">
      <para>按一下<guimenu>完成</guimenu>，然後按一下<guimenu>是</guimenu>。</para>
      <para>這些變更只有在伺服器重新啟動後才會生效。 </para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="b5c8qtj">
    <title>使用指令行新增 multipathd</title>
    <procedure id="b5c8qz1">
     <step id="b5c8qz2" performance="required">
      <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
     </step>
     <step id="b5c8r4x" performance="required">
      <para>在終端機主控台提示符下，輸入</para>

<screen>
insserv multipathd
</screen>

     </step>
    </procedure>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="mpiostart">
  <title>啟用及啟動多重路徑 I/O 服務</title>
  <para>若要啟動多重路徑服務，以及在重新開機時啟用該服務，請執行下列步驟：</para>
  <procedure id="b7jqkxe">
   <step id="b7jqkxg" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
   </step>
   <step id="b7jqkxh" performance="required">
    <para>在終端機主控台提示符下，輸入</para>

<screen>
chkconfig multipathd on
</screen>


<screen>
chkconfig boot.multipath on
</screen>

   </step>
  </procedure>
  <para>如果系統開機時 boot.multipath 服務沒有自動啟動，請執行下列操作手動啟動：</para>
  <procedure id="b5c8s8w">
   <step id="b5c8s8x" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
   </step>
   <step id="b5c8sla" performance="required">
    <para>輸入</para>

<screen>
/etc/init.d/boot.multipath start
</screen>


<screen>
/etc/init.d/multipathd start
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bbillhs">
  <title>建立或修改 /etc/multipath.conf 檔案</title>
  <para>在您建立 <filename>/etc/multipath.conf</filename> 檔案之前，該檔案並不存在。<command>multipathd</command> 精靈執行時會自動套用預設多重路徑裝置設定，除非您建立多重路徑組態檔案並進行個人化設定。<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.synthetic</filename> 檔案包含 <filename>/etc/multipath.conf</filename> 範例檔案，您可將其當成多重路徑的設定指南。 </para>
  <para>每次建立或修改 <filename>/etc/multipath.conf</filename> 檔案時，都不會在儲存檔案後自動套用變更。這樣，您便有時間在提交變更之前，先進行試執行以驗證這些變更。對修改的設定感到滿意之後，可以更新多重路徑對應以供執行中的多重路徑精靈使用，或者在下一次重新啟動多重路徑精靈 (例如系統重新啟動時) 時套用變更。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="beenynn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122wjjt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="mpiohwsupconf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbj8y2r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="beenynn">
   <title>建立 /etc/multipath.conf 檔案</title>
   <para>如果 <filename>/etc/multipath.conf</filename> 檔案不存在，請複製範例以建立此檔案：</para>
   <procedure id="bbillht">
    <step id="bbillhu" performance="required">
     <para>在終端機主控台中，以 <systemitem>root</systemitem> 使用者身分登入。</para>
    </step>
    <step id="bbillhv" performance="required">
     <para>輸入以下指令 (所有指令必須在一行中) 複製範例：</para>

<screen>
cp /usr/share/doc/packages/multipath-tools/multipath.conf.synthetic /etc/multipath.conf
</screen>

    </step>
    <step id="bcmqvq2" performance="required">
     <para>將 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename> 檔案作為參考，以決定如何為系統設定多重路徑。</para>
    </step>
    <step id="bcmqx5z" performance="required">
     <para>請確保您的 SAN 有相應的 <command>device</command> 項目。大多數廠商會提供有關正確設定 <command>device</command> 區段的文件。 </para>
     <para>在 <filename>/etc/multipath.conf</filename> 檔案中，不同的 SAN 需要不同的 <command>device</command> 區段。如果您使用的是自動偵測到的儲存子系統 (請參閱<xref linkend="mpiosuphw" xrefstyle="HeadingOnPage"/>)，則可以使用該裝置的預設項目；而不需要對 <filename>/etc/multipath.conf</filename> 檔案的組態做進一步的設定。 </para>
    </step>
    <step id="bcmqweh" performance="required">
     <para>儲存檔案。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b122wjjt">
   <title>/etc/multipath.conf 檔案中的區段</title>
   <para><filename>/etc/multipath.conf</filename> 檔案由下列區段構成。請參閱 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename>，瞭解包含每個屬性及其選項之詳細備註的範本。</para>
   <variablelist>
    <varlistentry id="b122vffx">
     <term>預設值</term>
     <listitem>
      <para>多重路徑 I/O 的一般預設設定。如果在相應的裝置或多重路徑區段中未提供值，則會使用這些值。如需更多資訊，請參閱<xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12donk3">
     <term>blacklist</term>
     <listitem>
      <para>列出因不是多重路徑候選而要丟棄的裝置名稱。裝置可透過其裝置節點名稱 (<literal>devnode</literal>)、WWID (<literal>wwid</literal>)、廠商或產品字串 (<literal>device</literal>) 來識別。如需更多資訊，請參閱<xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/>。</para>
      <para>您通常會忽略非多重路徑裝置，例如 <filename>cciss</filename>、<filename>fd</filename>、<filename>hd</filename>、<filename>md</filename>、<filename>dm</filename>、<filename>sr</filename>、<filename>scd</filename>、<filename>st</filename>、<filename>ram</filename>、<filename>raw</filename> 和 <filename>loop</filename>。</para>
      <formalpara id="b122sbge" role="intro">
       <title>值</title>
       <para/>
      </formalpara>
      <para>如需取得範例說明，請參閱 <xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12doufy">
     <term>blacklist_exceptions</term>
     <listitem>
      <para>列出即使不在黑名單上也要被視為多重路徑候選之裝置的裝置名稱。裝置可透過其裝置節點名稱 (<literal>devnode</literal>)、WWID (<literal>wwid</literal>)、廠商或產品字串 (<literal>device</literal>) 來識別。您必須使用黑名單中所用之相同關鍵字來指定排除的裝置。例如，如果在黑名單中將 devnode 關鍵字用於裝置，則要使用 devnode 關鍵字來排除黑名單例外中的某些裝置。無法使用 <literal>devnode</literal> 關鍵字將裝置列入黑名單，也無法使用 <literal>wwid</literal> 關鍵字排除其中某些裝置。</para>
      <formalpara id="b122sbgg" role="intro">
       <title>值</title>
       <para/>
      </formalpara>
      <para>如需相關範例，請參閱<xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/> 和 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename> 檔案。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b122vffy">
     <term>multipaths</term>
     <listitem>
      <para>指定個別多重路徑裝置的設定。除了不支援個別設定的設定以外，這些值會覆寫組態檔案之 <literal>defaults</literal> 與 <literal>devices</literal> 區段中所指定的內容。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b122vh2i">
     <term>devices</term>
     <listitem>
      <para>指定個別儲存控制器的設定。這些值會覆寫組態檔案之 <filename>defaults</filename> 區段中所指定的值。如果使用預設不支援的儲存陣列，則可以建立 <literal>devices</literal> 子區段來指定其預設設定。如果關鍵字允許，可以用個別多重路徑裝置的設定覆寫這些值。</para>
      <para>如需資訊，請參閱以下章節：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
       </listitem>
       <listitem>
        <para><xref linkend="bkj8n9w" xrefstyle="SectTitleOnPage"/></para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="mpiohwsupconf">
   <title>驗證 /etc/multipath.conf 檔案中的多重路徑設定</title>
   <para>每次建立或修改 <filename>/etc/multipath.conf</filename> 檔案時，都不會在儲存檔案後自動套用變更。您可以在更新多重路徑對應之前，先執行設定的<quote>試執行</quote>來驗證多重路徑設定。</para>
   <para>在伺服器命令提示字元中輸入</para>

<screen>
<command>multipath -v2 -d</command>
</screen>

   <para>此指令會掃描裝置，然後顯示提交變更時設定將產生的效果。假設在您修改 <filename>/etc/multipath.conf</filename> 檔案並進行試執行時，<filename>multipathd</filename> 精靈已使用舊 (或預設) 的多重路徑設定執行。如果變更可接受，請繼續執行<xref linkend="bbj8y2r" xrefstyle="HeadingOnPage"/>。</para>
   <para>輸出類似下方所列： </para>

<screen>
26353900f02796769
[size=127 GB]
[features="0"]
[hwhandler="1    emc"] 
</screen>


<screen>
\_ round-robin 0 [first]
  \_ 1:0:1:2 sdav 66:240  [ready ]
  \_ 0:0:1:2 sdr  65:16   [ready ]
</screen>


<screen>
\_ round-robin 0 
  \_ 1:0:0:2 sdag 66:0    [ready ]
  \_ 0:0:0:2 sdc   8:32   [ready ] 
</screen>

   <para>路徑會分為不同的優先程度群組。每次只有一個優先程度群組處於主動狀態。若要塑造主動/主動組態，所有路徑都必須分在相同的群組。若要塑造主動/被動組態，不應平行作用的路徑則會放置於不同的優先程度群組。這通常會在裝置探查時自動進行。 </para>
   <para>輸出會顯示順序、群組中用來平衡 I/O 的排程規則，以及各優先程度群組的路徑。對於每個路徑，會顯示其實體位址 (host:bus:target:lun)、裝置節點名稱、主要和次要的裝置編號和狀態。 </para>
   <para>透過在試執行中使用 -v3 詳細層級，可以查看所有已刪除的路徑、多重路徑和裝置映射。WWID 與裝置節點列入黑名單的裝置都會顯示。</para>

<screen>
multipath -v3 d
</screen>

   <para role="intro">下面的範例顯示了有兩個 Qlogic HBA 連接至 Xiotech Magnitude 3000 SAN 之 64 位元 SLES 11 SP2 伺服器上的 -v3 輸出。為精簡範例，省略了一些多重項目。</para>

<screen role="compact2">
dm-22: device node name blacklisted
&lt; content omitted &gt;
loop7: device node name blacklisted
&lt; content omitted &gt;
md0: device node name blacklisted
&lt; content omitted &gt;
dm-0: device node name blacklisted
sdf: not found in pathvec
sdf: mask = 0x1f
sdf: dev_t = 8:80
sdf: size = 105005056
sdf: subsystem = scsi
sdf: vendor = XIOtech
sdf: product = Magnitude 3D
sdf: rev = 3.00
sdf: h:b:t:l = 1:0:0:2
sdf: tgt_node_name = 0x202100d0b2028da
sdf: serial = 000028DA0014
sdf: getuid= "/lib/udev/scsi_id --whitelisted --device=/dev/%n" (config file default)
sdf: uid = 200d0b2da28001400 (callout)
sdf: prio = const (config file default)
sdf: const prio = 1
&lt; content omitted &gt;
ram15: device node name blacklisted
&lt; content omitted &gt;
===== paths list =====
uuid              hcil    dev dev_t pri dm_st  chk_st  vend/prod/rev
200d0b2da28001400 1:0:0:2 sdf 8:80  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 1:0:0:1 sde 8:64  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 1:0:0:0 sdd 8:48  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28001400 0:0:0:2 sdc 8:32  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 0:0:0:1 sdb 8:16  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 0:0:0:0 sda 8:0   1   [undef][undef] XIOtech,Magnitude 3D
params = 0 0 2 1 round-robin 0 1 1 8:80 1000 round-robin 0 1 1 8:32 1000
status = 2 0 0 0 2 1 A 0 1 0 8:80 A 0 E 0 1 0 8:32 A 0
sdf: mask = 0x4
sdf: path checker = directio (config file default)
directio: starting new request
directio: async io getevents returns 1 (errno=Success)
directio: io finished 4096/0
sdf: state = 2
&lt; content omitted &gt;
</screen>

  </sect2>
  <sect2 id="bbj8y2r">
   <title>套用 /etc/multipath.conf 檔案變更以更新多重路徑對應</title>
   <para>當 <command>multipathd</command> 正在執行時，對 <filename>/etc/multipath.conf</filename> 檔案所做的變更無法生效。在進行變更後，儲存並關閉檔案，然後執行以下操作以套用變更並更新多重路徑對應：</para>
   <procedure id="bbj8ync">
    <step id="bbj8ynd" performance="required">
     <para>停止 <command>multipathd</command> 服務。</para>
    </step>
    <step id="bbj8zk2" performance="required">
     <para>輸入以下指令清除舊的多重路徑繫結</para>

<screen>
/sbin/multipath -F
</screen>

    </step>
    <step id="bbj91hd" performance="required">
     <para>輸入以下指令建立新的多重路徑繫結</para>

<screen>
/sbin/multipath -v2 -l
</screen>

    </step>
    <step id="bbj8zu9" performance="required">
     <para>啟動 <command>multipathd</command> 服務。</para>
    </step>
    <step id="bi0ay0m" performance="required">
     <para>執行 <command>mkinitrd</command> 影像在系統中重新建立 <filename>initrd</filename>，然後重新開機以使變更生效。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="bbj68de">
  <title>設定輪詢、排入佇列和錯誤回復的預設規則</title>
  <para>多重路徑 I/O 的目的是在儲存系統與伺服器之間提供連接容錯。需要的預設行為視伺服器是獨立伺服器還是高可用性叢集中的節點而定。 </para>
  <para>如果您為獨立伺服器設定了多重路徑 I/O，<literal>no_path_retry</literal> 設定可使伺服器作業系統在盡可能長的時間內不收到 I/O 錯誤。它將訊息排入佇列，直到多重路徑容錯移轉發生並提供有效的連接為止。</para>
  <para>為高可用性叢集中的節點設定多重路徑 I/O 時，您希望多重路徑報告 I/O 故障以觸發資源容錯移轉，而不是等待多重路徑容錯移轉得以解決。在叢集環境中，您必須修改 <literal>no_path_retry</literal> 設定，以確保在與儲存系統的連接中斷時，叢集節點會收到與叢集驗證程序相關的 I/O 錯誤 (建議設為 heartbeat 容錯的 50%)。此外，您還希望將多重路徑 I/O 錯誤回復設為手動，以避免因路徑故障而造成資源的乒乓效應。</para>
  <para><filename>/etc/multipath.conf</filename> 檔案應包含 <command>defaults</command> 區段，您可在其中指定輪詢、排入佇列和錯誤回復的預設行為。如果 <command>device</command> 區段中沒有指定此欄位，系統會為該 SAN 組態套用預設設定。</para>
  <para role="intro">以下各項將編譯到預設設定中。除非您透過建立並設定個人化的 <filename>/etc/multipath.conf</filename> 檔案來覆寫這些值，否則將會使用它們。</para>

<screen>
defaults {
  verbosity 2
#  udev_dir is deprecated in SLES 11 SP3
#  udev_dir              /dev
  polling_interval      5
#  path_selector default value is service-time in SLES 11 SP3
#  path_selector         "round-robin 0"
  path selector         "service-time 0"
  path_grouping_policy  failover
#  getuid_callout is deprecated in SLES 11 SP3 and replaced with uid_attribute
#  getuid_callout        "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
#  uid_attribute is new in SLES 11 SP3
  uid_attribute         "ID_SERIAL"
  prio                  "const"
  prio_args             ""
  features              "0"
  path_checker          "directio"
  alias_prefix          "mpath"
  rr_min_io_rq          1
  max_fds               "max"
  rr_weight             "uniform"
  queue_without_daemon  "yes"
  flush_on_last_del     "no"
  user_friendly_names   "no"
  fast_io_fail_tmo      5
  bindings_file         "/etc/multipath/bindings"
  wwids_file            "/etc/multipath/wwids"
  log_checker_err       "always"
  retain_attached_hw_handler  "no"
  detect_prio           "no"
  failback              "manual"
  no_path_retry         "fail"
  }
</screen>

  <para>如需設定輪詢、排入佇列和錯誤回復規則的相關資訊，請參閱<xref linkend="bbi89rh" xrefstyle="SectTitleOnPage"/> 中的下列參數：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b122w0sa" xrefstyle="HeadingOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122sbgo" xrefstyle="HeadingOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122sbgh" xrefstyle="HeadingOnPage"/></para>
   </listitem>
  </itemizedlist>
  <para>如果修改 <literal>defaults</literal> 區段中的設定，則在更新多重路徑對應之前，或在重新啟動多重路徑精靈 (例如系統重新啟動時) 之前，不會套用變更。</para>
 </sect1>
 <sect1 id="bbj5x7z">
  <title>將非多重路徑裝置列入黑名單</title>
  <para><filename>/etc/multipath.conf</filename> 檔案應該包含 <command>blacklist</command> 區段，其中列出了所有非多重路徑裝置。您可以透過 WWID (<literal>wwid</literal> 關鍵字)、裝置名稱 (<literal>devnode</literal> 關鍵字) 或裝置類型 (<literal>device</literal> 區段) 將裝置列入黑名單。您還可以使用 <literal>blacklist_exceptions</literal> 區段，對透過 <literal>blacklist</literal> 區段中所用的正規表示式列入黑名單的一些裝置啟用多重路徑。 </para>
  <para>您通常會忽略非多重路徑裝置，例如·<filename>cciss</filename>、<filename>fd</filename>、<filename>hd</filename>、<filename>md</filename>、<filename>dm</filename>、<filename>sr</filename>、<filename>scd</filename>、<filename>st</filename>、<filename>ram</filename>、<filename>raw</filename> 和 <filename>loop</filename>。例如，本地 IDE 硬碟機和軟碟機一般沒有多重路徑。如果您希望 <command>multipath</command> 忽略單路徑裝置，請將它們加入 <command>blacklist</command> 區段中。 </para>
  <note>
   <para>關鍵字 <literal>devnode_blacklist</literal> 已被關鍵字 <literal>blacklist</literal> 取代。</para>
  </note>
  <para>例如，若要將本地裝置與 <filename>cciss</filename> 驅動程式中的所有陣列列入黑名單，以免受到多重路徑的管理，則 <command>blacklist</command> 區段應為：</para>

<screen>
blacklist {
      wwid "26353900f02796769"
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
      devnode "^hd[a-z][0-9]*"
      devnode "^cciss.c[0-9]d[0-9].*"
}
</screen>

  <para>您也可以只將驅動程式中的分割區 (而不是整個陣列) 列入黑名單。例如，您可以使用以下正規表示式，只將 <filename>cciss</filename> 驅動程式指定的分割區而非整個陣列列入黑名單：</para>

<screen>
blacklist {
      devnode "^cciss.c[0-9]d[0-9]*[p[0-9]*]"
}
</screen>

  <para>您可以在 blacklist 中新增 <literal>device</literal> 區段，並使用 <literal>vendor</literal> 和 <literal>product</literal> 關鍵字，按特定裝置類型列入黑名單。</para>

<screen>
blacklist {
      device {
           vendor  "DELL"
           product "*"
       }
}
</screen>

  <para>您可以使用 <literal>blacklist_exceptions</literal> 區段，對透過 <literal>blacklist</literal> 區段中所用的正規表示式列入黑名單的一些裝置啟用多重路徑。您可以透過 WWID (<literal>wwid</literal> 關鍵字)、裝置名稱 (<literal>devnode</literal> 關鍵字) 或裝置類型 (<literal>device</literal> 區段) 新增例外。您必須以將相應裝置列入黑名單的相同方式指定例外。也就是說，<literal>wwid</literal> 例外適用於 <literal>wwid</literal> 黑名單，<literal>devnode</literal> 例外適用於 <literal>devnode</literal> 黑名單，而裝置類型例外適用於裝置類型黑名單。</para>
  <para>例如，如果您擁有來自不同廠商的裝置類型，可以針對所需的裝置類型啟用多重路徑。在 <literal>blacklist</literal> 區段中將所有廠商的裝置類型列入黑名單，然後在 <literal>blacklist_exceptions</literal> 區段中新增 <literal>device</literal> 區段，針對所需的裝置類型啟用多重路徑。</para>

<screen>
blacklist {
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
      device {
           vendor  "DELL"
           product "*"
       }
}

blacklist_exceptions {
      device {
           vendor  "DELL"
           product "MD3220i"
       }
}
</screen>

  <para>您還可以使用 blacklist_exceptions 僅針對特定裝置啟用多重路徑。例如：</para>

<screen>
blacklist {
      wwid "*"
}

blacklist_exceptions {
        wwid "3600d0230000000000e13955cc3751234"
        wwid "3600d0230000000000e13955cc3751235"
}
</screen>

  <para>修改 <filename>/etc/multipath.conf</filename> 檔案後，必須執行 <command>mkinitrd</command> 在系統中重新建立 <filename>initrd</filename>，然後重新啟動伺服器以使變更生效。 </para>
  <para>此後，當您發出 <command>multipath -ll</command> 指令時，本地裝置將不再列於多重路徑映射中。</para>
 </sect1>
 <sect1 id="mpionames">
  <title>設定使用者易記的名稱或別名</title>
  <para role="intro">多重路徑裝置可透過其 WWID、使用者易記的名稱或您為其指定的別名來識別。開始之前，請參閱<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/> 中的要求。</para>
  <important>
   <para>由於以 <filename>/dev/sdn</filename> 與 <filename>/dev/dm-n</filename> 形式表示的裝置節點名稱會在系統重新開機時變更，因此最好使用其 WWID 來參考多重路徑裝置。此外，您還可以使用對應至 WWID 的使用者易記名稱或別名，以便在重新開機時唯一識別裝置。</para>
  </important>
  <para><xref linkend="bq7xokx" xrefstyle="TableXRef"/> 介紹了 <filename>/etc/multipath.conf</filename> 檔案中可用於裝置的裝置名稱類型。如需 <filename>multipath.conf</filename> 設定的範例，請參閱 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.synthetic</filename> 檔案。 </para>
  <table id="bq7xokx" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <title>多重路徑裝置名稱類型比較</title>
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="1667*"/>
   <colspec colnum="2" colname="2" colwidth="8334*"/>
    <thead>
     <row id="bq7xoky">
      <entry>
       <para>名稱類型</para>
      </entry>
      <entry>
       <para>描述</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="bq7xokz">
      <entry>
       <para>WWID (預設)</para>
      </entry>
      <entry>
       <para>序列 WWID (全球識別碼) 是多重路徑裝置的識別碼，保證其全球唯一，永不變更。多重路徑中使用的預設名稱是邏輯單位的 ID，就是 <filename>/dev/disk/by-id</filename> 目錄中存放的 ID。例如，WWID 為 <literal>3600508e0000000009e6baa6f609e7908</literal> 的裝置列為 <filename>/dev/disk/by-id/scsi-3600508e0000000009e6baa6f609e7908</filename>。</para>
      </entry>
     </row>
     <row id="bq7xol0">
      <entry>
       <para>使用者易記</para>
      </entry>
      <entry>
       <para><filename>/dev/mapper</filename> 目錄中的「裝置對應程式多重路徑」裝置名稱還參考了邏輯單位的 ID。這些多重路徑裝置名稱是格式為 <filename>/dev/mapper/mpath&lt;<replaceable>n</replaceable>&gt;</filename> 的使用者易記名稱，例如 <filename>/dev/mapper/mpath0</filename>。這些名稱是唯一且永久的，因為它們使用 <filename>/var/lib/multipath/bindings</filename> 檔案來追蹤 UUID 與易記名稱之間的關聯。 </para>
      </entry>
     </row>
     <row id="bq7xol1">
      <entry>
       <para>別名</para>
      </entry>
      <entry>
       <para>別名是管理員為多重路徑裝置指定的全域唯一名稱。別名會覆寫 WWID 及使用者易記的 <filename>/dev/mapper/mpathN</filename> 名稱。</para>
       <para>如果使用的是 user_friendly_names，請不要將別名設為 mpathN 格式。這可能會與自動指定的使用者易記名稱相衝突，從而提供錯誤的裝置節點名稱。</para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
  <para><filename>/etc/multipath.conf</filename> 檔案中的全域多重路徑 <literal>user_friendly_names</literal> 選項用於啟用或停用對多重路徑裝置使用易記名稱的功能。如果將它設定為「no」(預設值)，則多重路徑會使用 WWID 做為裝置的名稱。如果將它設定為「yes」，則多重路徑會使用 <filename>/dev/mapper</filename> 目錄中的 <filename>/var/lib/multipath/bindings</filename> 檔案，為裝置指定格式為 <filename>mpath&lt;<replaceable>n</replaceable>&gt;</filename> 的永久且唯一的名稱。<literal>/etc/multipath.conf</literal> 檔案中的 <literal>bindings file</literal> 選項可用於指定 <filename>bindings</filename> 檔案的替代位置。 </para>
  <para><filename>/etc/multipath.conf</filename> 檔案中的全域多重路徑 <literal>alias</literal> 選項用於明確地為裝置指定名稱。如果為多重路徑裝置設定了別名，則會使用別名而不是 WWID 或易記名稱。</para>
  <para>在下列情況下，使用 <literal>user_friendly_names</literal> 選項可能會產生問題：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <formalpara id="bq7wtcr" role="intro">
     <title>根裝置正在使用多重路徑：</title>
     <para>如果系統根裝置正在使用多重路徑，而您使用了 <literal>user_friendly_names</literal> 選項，則會將 <filename>/var/lib/multipath/bindings</filename> 檔案中的使用者易記設定包含在 <filename>initrd</filename> 中。如果您之後變更儲存設定，例如新增或移除裝置，則 <filename>initrd</filename> 中的繫結設定會與 <filename>/var/lib/multipath/bindings</filename> 中的繫結設定不符。</para>
    </formalpara>
    <warning>
     <para><filename>initrd</filename> 與 <filename>/var/lib/multipath/bindings</filename> 之間的繫結不符會導致將錯誤的掛接點指定給裝置，進而造成檔案系統損毀及資料遺失。</para>
    </warning>
    <para>為了避免此問題發生，建議您對系統根裝置使用預設 WWID 設定。請勿將別名用於系統根裝置。裝置名稱將會不同，因此使用別名會使您失去透過核心指令行順利關閉多重路徑的功能。</para>
   </listitem>
   <listitem>
    <formalpara id="bq7uui0">
     <title>從另一個分割區掛接 /var︰</title>
     <para><literal>user_friendly_names</literal> 組態檔案的預設位置是 <filename>/var/lib/multipath/bindings</filename>。如果 <filename>/var</filename> 資料不在系統根裝置上，而是從另一個分割區掛接，則設定多重路徑時無法獲取 <filename>bindings</filename> 檔案。</para>
    </formalpara>
    <para>請確定 <filename>/var/lib/multipath/bindings</filename> 檔案位於系統根裝置上，並且多重路徑可以找到它。例如，可以按如下所示操作：</para>
    <orderedlist spacing="normal">
     <listitem>
      <para>將 <filename>/var/lib/multipath/bindings</filename> 檔案移至 <filename>/etc/multipath/bindings</filename>。</para>
     </listitem>
     <listitem>
      <para>將 /<filename>etc/multipath.conf</filename> 之 <literal>defaults</literal> 區段中的 <literal>bindings_file</literal> 選項設定為這個新位置。例如︰</para>

<screen>
defaults {
               user_friendly_names yes
               bindings_file "/etc/multipath/bindings"
}
</screen>

     </listitem>
    </orderedlist>
   </listitem>
   <listitem>
    <formalpara id="bq7wpfj" role="intro">
     <title>initrd 中存在多重路徑：</title>
     <para>即使系統根裝置不在多重路徑上，<filename>initrd</filename> 中也有可能包含多重路徑。例如，如果系統根裝置位於 LVM 上，則可能會出現這種情況。如果您使用 <literal>user_friendly_names</literal> 選項並且 <filename>initrd</filename> 中存在多重路徑，則應該使用參數 <command>multipath=off</command> 開機，以免發生問題。</para>
    </formalpara>
    <para>這會在系統開機期間於 <filename>initrd</filename> 中停用多重路徑。系統開機之後，<filename>boot.multipath</filename> 與 <filename>multipathd</filename> 開機程序檔便能啟用多重路徑。</para>
   </listitem>
  </itemizedlist>
  <para>若要啟用使用者易記名稱或指定別名：</para>
  <procedure id="b7jqnux">
   <step id="b7jqqgl" performance="required">
    <para>在終端機主控台中，以 <systemitem>root</systemitem> 使用者身分登入。</para>
   </step>
   <step id="b7jqp5o" performance="required">
    <para>在文字編輯器中開啟 <filename>/etc/multipath.conf</filename> 檔案。</para>
   </step>
   <step id="bq7y78q" performance="required">
    <para role="intro">(選擇性) 修改 <filename>/var/lib/multipath/bindings</filename> 檔案的位置。 </para>
    <para>替代路徑必須是系統根裝置上可存取的位置，並且多重路徑必須能夠找到它。 </para>
    <substeps performance="required">
     <step id="bq7y96x" performance="required">
      <para>將 <filename>/var/lib/multipath/bindings</filename> 檔案移至 <filename>/etc/multipath/bindings</filename>。</para>
     </step>
     <step id="bq7y96y" performance="required">
      <para>將 /<filename>etc/multipath.conf</filename> 之 <literal>defaults</literal> 區段中的 <literal>bindings_file</literal> 選項設定為這個新位置。例如︰</para>

<screen>
defaults {
               user_friendly_names yes
               bindings_file "/etc/multipath/bindings"
}
</screen>

     </step>
    </substeps>
   </step>
   <step id="b7jqp5q" performance="required">
    <para>(選擇性，但不建議) 啟用使用者易記的名稱：</para>
    <substeps performance="required">
     <step id="bq7xauk" performance="required">
      <para>取消 <literal>Defaults</literal> 區段及其結束括號的註解。</para>
     </step>
     <step id="bq7xb1y" performance="required">
      <para>取消 <literal>user_friendly_names option</literal> 的註解，然後將「否」值變更為「是」。</para>
      <para>例如：</para>

<screen>
## Use user friendly names, instead of using WWIDs as names.
defaults {
  user_friendly_names yes
}
</screen>

     </step>
    </substeps>
   </step>
   <step id="b7jrp3u" performance="required">
    <para role="intro">(選擇性) 在 <command>multipath</command> 區段中使用 <command>alias</command> 選項，為裝置指定您自己的名稱。</para>
    <para role="intro">例如：</para>

<screen>
## Use alias names, instead of using WWIDs as names.
multipaths {
       multipath {
               wwid           36006048000028350131253594d303030
               alias             blue1
       }
       multipath {
               wwid           36006048000028350131253594d303041
               alias             blue2
       }
       multipath {
               wwid           36006048000028350131253594d303145
               alias             yellow1
       }
       multipath {
               wwid           36006048000028350131253594d303334
               alias             yellow2
       }
}
</screen>

   </step>
   <step id="b7jqp5r" performance="required">
    <para>儲存變更，然後關閉檔案。</para>
    <para>在更新多重路徑對應之前，或在重新啟動多重路徑精靈 (例如系統重新啟動時) 之前，不會套用變更。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bkj8n9w">
  <title>設定 zSeries 裝置的預設設定</title>
  <para>對支援多重路徑的 IBM zSeries 裝置進行的測試表明，應將 dev_loss_tmo 參數設定為 90 秒，將 fast_io_fail_tmo 參數設定為 5 秒。若您使用的是 zSeries 裝置，請依照以下方式修改 <filename>/etc/multipath.conf</filename> 檔案以指定這些值：</para>

<screen>
defaults {
       dev_loss_tmo 90
       fast_io_fail_tmo 5
}
</screen>

  <para>dev_loss_tmo 參數設定將某個多重路徑連結標示為失敗之前需等待的秒數。若該路徑失敗，則目前在該路徑上的所有 I/O 都會失敗。預設值會因所用的裝置驅動程式而有所不同。值的有效範圍為 0 至 600 秒。若要使用驅動程式的內部逾時，請將該值設定為零 (0) 或任何大於 600 的值。</para>
  <para>fast_io_fail_tmo 參數設定偵測到連結問題後將 I/O 確定為失敗之前需等待的時間。到達該驅動程式的 I/O 都會失敗。如果 I/O 排在擁堵的佇列中，則未到 dev_loss_tmo 時間且佇列未疏通之前 I/O 不會失敗。</para>
  <para>如果修改 <filename>/etc/multipath.conf</filename> 檔案，則在更新多重路徑對應之前，或在重新啟動多重路徑精靈 (例如系統重新啟動時) 之前，不會套用變更。</para>
 </sect1>
 <sect1 id="bbi89rh">
  <title>設定路徑容錯移轉規則與優先程度</title>
  <para>在 Linux 主機上，若一個儲存控制器有多個路徑，則每個路徑會顯示為獨立的區塊裝置，導致單個 LUN 有多個區塊裝置。裝置對應程式多重路徑服務會偵測到多個路徑具有同一個 LUN ID，然後會使用該 ID 建立新的多重路徑裝置。例如，若主機上有兩個 HBA 透過未分區的光纖通道交換器連接至具有兩個連接埠的某個儲存控制器，則該主機會探查到四個區塊裝置，即 <filename>/dev/sda</filename>、<filename>/dev/sdb</filename>、<filename>/dev/sdc</filename> 與 <filename>/dev/sdd</filename>。裝置對應程式多重路徑服務會建立單個區塊裝置 <filename>/dev/mpath/mpath1</filename>，透過以上四個基礎區塊裝置來重新路由 I/O。</para>
  <para>本節說明如何指定容錯移轉的規則及如何設定路徑的優先程度。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="beep0mu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi89xy" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbj87iv" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi8acn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bbi8els" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="beep0mu">
   <title>設定路徑容錯移轉規則</title>
   <para>使用包含 -p 選項的 <command>multipath</command> 指令來設定路徑容錯移轉規則：</para>

<screen>
multipath <replaceable>devicename</replaceable> -p <replaceable>policy</replaceable> 
</screen>

   <para role="intro">用以下其中一個規則選項取代 <replaceable>policy</replaceable>：</para>
   <table id="beg1vn7" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>multipath -p 指令的群組規則選項</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="2381*"/>
    <colspec colnum="2" colname="2" colwidth="7620*"/>
     <thead>
      <row id="beg1vn8">
       <entry>
        <para>規則選項</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="beg1vn9">
       <entry>
        <para>failover</para>
       </entry>
       <entry>
        <para>(預設) 每個優先程度群組對應一個路徑。</para>
       </entry>
      </row>
      <row id="beg1vna">
       <entry>
        <para>multibus</para>
       </entry>
       <entry>
        <para>所有路徑都在一個優先程度群組中。</para>
       </entry>
      </row>
      <row id="beg1vnb">
       <entry>
        <para>group_by_serial</para>
       </entry>
       <entry>
        <para>每個偵測到的序號對應一個優先程度群組。</para>
       </entry>
      </row>
      <row id="beg1vnc">
       <entry>
        <para>group_by_prio</para>
       </entry>
       <entry>
        <para>每個路徑優先程度值對應一個優先程度群組。優先程度由註標程式決定，在 <filename>/etc/multipath.conf</filename> 組態檔案中指定為 global、per-controller 或 per-multipath 選項。</para>
       </entry>
      </row>
      <row id="beg1vnd">
       <entry>
        <para>group_by_node_name</para>
       </entry>
       <entry>
        <para>每個目標節點名稱對應一個優先程度群組。目標節點名稱取自 <filename>/sys/class/fc_transport/target*/node_name</filename> 位置。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="bbi89xy">
   <title>設定容錯移轉優先程度</title>
   <para>您必須在 <filename>/etc/multipath.conf</filename> 檔案中手動輸入裝置的容錯移轉優先程度。<filename>/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</filename> 檔案中提供了所有設定與選項的範例。</para>
   <para>如果修改 <filename>/etc/multipath.conf</filename> 檔案，則不會在儲存檔案時自動套用變更。詳細資訊，請參閱 <xref linkend="mpiohwsupconf" xrefstyle="SectTitleOnPage"/> 及  <xref linkend="bbj8y2r" xrefstyle="SectTitleOnPage"/>。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8jjc" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8jjd" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbi8g9x" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="beg263n">
    <title>瞭解優先程序群組與屬性</title>
    <para><emphasis>優先程度群組</emphasis>是進入相同實體 LUN 的路徑集合。依預設，I/O 以輪替方式發佈到群組的所有路徑。<command>multipath</command> 指令會根據 SAN 的 path_grouping_policy 設定，在該 SAN 中自動為每個 LUN 建立優先程度群組。<literal/><command>multipath</command> 指令會將群組中路徑的數量乘以群組的優先程度，來決定哪個群組為主要群組。計算值最高的群組為主要群組。主要群組中的所有路徑都失敗時，計算值次高的優先程度群組成為主動群組。 </para>
    <para><emphasis>路徑優先程度</emphasis>是指定給路徑的整數值。值越高，優先程度越高。系統使用了外部程式來指定每個路徑的優先程度。對於指定的裝置，優先程度相同的路徑屬於同一個優先程度群組。</para>
    <para>適用於 LES 11 SP2 的多重路徑工具 0.4.9 會使用 <filename>/etc/multipath.conf</filename> 檔案之 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 區段中的 <literal>prio</literal> 設定。當關鍵字 <literal>prio</literal> 是為 <literal>multipaths{)</literal> 區段中的個別 <literal>multipath</literal> 定義而指定時，它會無訊息式地忽略該關鍵字。在適用於 SLES  11 SP1 的多重路徑工具 0.4.8 及更早版本中，允許 <literal>multipaths{)</literal> 區段中個別 <literal>multipath</literal> 定義中的 prio 設定覆寫 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 區段中的 <literal>prio</literal> 設定。</para>
    <para><filename>/etc/multipath.conf</filename> 檔案中 <literal>prio</literal> 關鍵字的語法在 <filename>multipath-tools-0.4.9</filename> 中已變更。<literal>prio</literal> 行會指定優先程度排序器。如果優先程度排序器需要引數，您可以在另一行上使用 <literal>prio_args</literal> 關鍵字來指定該引數。而在以前，優先程度排序器及其引數包含在 <literal>prio</literal> 行上。</para>
    <bridgehead id="b15gvvaa">Defaults 或 Devices 區段的 PRIO 設定</bridgehead>
    <variablelist>
     <varlistentry id="b122w59j">
      <term>prio</term>
      <listitem>
       <para>指定要呼叫以取得路徑優先程度值的優先程度排序程式。系統會將每個路徑群組的權數加總，以判斷發生故障時要使用的下一個路徑群組。</para>
       <para>如果指定的優先程度排序器需要引數，請使用 <literal>prio_args</literal> 關鍵字進行指定。</para>
       <formalpara id="b122w59k" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>如果未指定任何 <literal>prio</literal> 關鍵字，則所有路徑的優先程度均相等。預設設定為「const」，且 <literal>prio_args</literal> 設定沒有任何值。</para>

<screen>
prio      "const"
prio_args ""
</screen>

       <para>優先程度排序器範例如下：</para>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2907*"/>
        <colspec colnum="2" colname="2" colwidth="7096*"/>
         <thead>
          <row id="b122xdcu">
           <entry>
            <para>優先程度排序程式</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122xdcv">
           <entry>
            <para>alua</para>
           </entry>
           <entry>
            <para>根據 SCSI-3 ALUA 設定產生路徑優先程度。 </para>
           </entry>
          </row>
          <row id="b122xdcw">
           <entry>
            <para>const</para>
           </entry>
           <entry>
            <para>為所有路徑產生相同的優先程度。</para>
           </entry>
          </row>
          <row id="b122xdcx">
           <entry>
            <para>emc</para>
           </entry>
           <entry>
            <para>為 EMC 陣列產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122xdcy">
           <entry>
            <para>hdc</para>
           </entry>
           <entry>
            <para>為 Hitachi HDS Modular 儲存陣列產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122xdcz">
           <entry>
            <para>hp_sw</para>
           </entry>
           <entry>
            <para>為主動/待命模式下的 Compaq/HP 控制器產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122xdd0">
           <entry>
            <para>ontap</para>
           </entry>
           <entry>
            <para>為 NetApp 陣列產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122xdd1">
           <entry>
            <para>random</para>
           </entry>
           <entry>
            <para>為每個路徑產生隨機優先程度。</para>
           </entry>
          </row>
          <row id="b122xdd2">
           <entry>
            <para>rdac</para>
           </entry>
           <entry>
            <para>為 LSI/Engenio RDAC 控制器產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122xdd3">
           <entry>
            <para>weightedpath</para>
           </entry>
           <entry>
            <para>根據在 <literal>prio_args</literal> 的引數中所指定的權數值，產生路徑優先程度，例如：</para>

<screen>
&lt;hbtl|devname&gt; &lt;<replaceable>regex1</replaceable>&gt; &lt;<replaceable>prio1</replaceable>&gt; &lt;<replaceable>regex2</replaceable>&gt; &lt;<replaceable>prio2</replaceable>&gt;...
</screen>

            <para><literal>hbtl regex</literal> 引數格式會使用含有權數值的 SCSI <literal>H:B:T:L</literal> 表示法 (例如 <literal>1:0:.:.</literal> 與 <literal>*:0:0:.</literal>)，其中 H、B、T、L 分別指裝置的主機、匯流排、目標和 LUN ID。例如：</para>

<screen>
prio "weightedpath"
prio_args "hbtl 1:.:.:. 2 4:.:.:. 4"
</screen>

            <para>devname 正規表示式引數格式使用每個裝置的裝置節點名稱與權數值。例如：</para>

<screen>
prio "weightedpath"
prio_args "devname sda 50 sde 10 sdc 50 sdf 10"
</screen>

           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122w59l">
      <term>prio_args</term>
      <listitem>
       <para>指定需要引數之指定優先程度排序程式的引數。大多數 <literal>prio</literal> 程式都不需要引數。</para>
       <formalpara id="b122w59m" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>沒有預設值。該值取決於 <literal>prio</literal> 設定以及優先程度排序器是否需要引數。</para>

<screen>
prio      "const"
prio_args ""
</screen>

      </listitem>
     </varlistentry>
    </variablelist>
    <bridgehead id="b15gvvab">多重路徑屬性</bridgehead>
    <para>多重路徑屬性用於控制裝置的多重路徑 I/O 行為。您可以將屬性指定為所有多重路徑裝置的預設值。此外，還可以指定僅套用至指定多重路徑裝置的屬性，方法是在多重路徑組態檔案的 <literal>multipaths</literal> 區段中為該裝置建立一個項目。</para>
    <variablelist>
     <varlistentry id="b122sbg9">
      <term>user_friendly_names</term>
      <listitem>
       <para>指定是使用全球 ID (WWID) 還是使用 <filename>/var/lib/multipath/bindings</filename> 檔案為多重路徑裝置指定格式為 <filename>/dev/mapper/mpathN</filename>、永久且唯一的別名。</para>
       <para>此選項可以在 <literal>devices</literal> 區段和 <literal>multipaths</literal> 區段中使用。</para>
       <formalpara id="b122sbga" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122skbh">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122skbi">
           <entry>
            <para>no</para>
           </entry>
           <entry>
            <para>(預設) 使用 <filename>/dev/disk/by-id/</filename> 位置中所顯示的 WWID。</para>
           </entry>
          </row>
          <row id="b122skbj">
           <entry>
            <para>yes</para>
           </entry>
           <entry>
            <para>自動產生易記名稱做為多重路徑裝置的別名來取代實際的 ID。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgh">
      <term>failback</term>
      <listitem>
       <para>指定是否監控失敗路徑的復原狀況，並指出失敗路徑恢復使用後群組進行錯誤回復所花的時間。</para>
       <para>失敗路徑復原後，系統會根據此設定將該路徑重新新增到啟用了多重路徑的路徑清單中。多重路徑會評估優先程度群組，並在主要路徑的優先程度高於次要群組時，變更主動優先程度群組。 </para>
       <formalpara id="b122sbgi" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122sm95">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122sm96">
           <entry>
            <para>manual</para>
           </entry>
           <entry>
            <para>(預設) 不監控失敗路徑的復原狀況。管理員會執行 <command>multipath</command> 指令來更新已啟用的路徑與優先程度群組。</para>
           </entry>
          </row>
          <row id="b122sm97">
           <entry>
            <para>immediate</para>
           </entry>
           <entry>
            <para>某路徑復原後，立即啟用該路徑。</para>
           </entry>
          </row>
          <row id="b122sm98">
           <entry>
            <para>n</para>
           </entry>
           <entry>
            <para>某路徑復原後，等待 <replaceable>n</replaceable> 秒後再啟用此路徑。指定一個大於 0 的整數值。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>對於叢集環境中的多重路徑，建議將錯誤回復設為「manual」，以防止多重路徑容錯移轉發生乒乓效應。</para>

<screen>
failback "manual"
</screen>

       <important>
        <para>請務必向儲存系統廠商確認錯誤回復設定。不同的儲存系統可能需要不同的設定。</para>
       </important>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgm">
      <term>getuid_callout</term>
      <listitem>
       <para>為獲得唯一路徑識別碼而呼叫的預設程式和引數。使用絕對 Linux 路徑指定位置。</para>
       <para>此屬性在 SLES 11 SP3 中已廢棄。取而代之的是 <link linkend="b15gvth2"><literal>uid_attribute</literal></link>。</para>
       <formalpara id="b122sbgn" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>預設位置和引數包括：</para>

<screen>
/lib/udev/scsi_id -g -u -s
</screen>

       <para>範例：</para>

<screen>
getuid_callout "/lib/udev/scsi_id -g -u -d /dev/%n"

getuid_callout "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgo">
      <term>no_path_retry</term>
      <listitem>
       <para>指定路徑失敗時要採取的行為。</para>
       <formalpara id="b122sbgp" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122sr39">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122sr3a">
           <entry>
            <para>n</para>
           </entry>
           <entry>
            <para>指定在 <command>multipath</command> 停止佇列且使路徑失敗之前的重試次數。指定一個大於 0 的整數值。</para>
            <para>在叢集中，您可以指定值「0」來防止排入佇列，並允許資源進行容錯移轉。</para>
           </entry>
          </row>
          <row id="b122sr3b">
           <entry>
            <para>fail</para>
           </entry>
           <entry>
            <para>指定立即失敗 (不排入佇列)。</para>
           </entry>
          </row>
          <row id="b122sr3c">
           <entry>
            <para>queue</para>
           </entry>
           <entry>
            <para>永不停止佇列 (在路徑恢復正常之前始終排入佇列)。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>在叢集中工作時，建議在 <filename>/etc/multipath.conf</filename> 檔案中將重試設為「fail」或「0」。這會導致儲存連接中斷時，讓資源進行容錯移轉。否則，該訊息會排入佇列，而不會發生資源容錯移轉。 </para>

<screen>
no_path_retry "fail"
no_path_retry "0"
</screen>

       <important>
        <para>請務必向儲存系統廠商確認重試設定。不同的儲存系統可能需要不同的設定。</para>
       </important>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgs">
      <term>path_checker</term>
      <listitem>
       <para role="intro">決定路徑的狀態。</para>
       <formalpara id="b122sbgt" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122swb1">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122swb2">
           <entry>
            <para>directio</para>
           </entry>
           <entry>
            <para>(<filename>multipath-tools</filename> 0.4.8 版及更高版本中的預設值) 讀取具備直接 I/O 的第一個磁區，這對 DASD 裝置非常有用。在 <filename>/var/log/messages</filename> 中記錄失敗訊息。</para>
           </entry>
          </row>
          <row id="b122swb3">
           <entry>
            <para>readsector0</para>
           </entry>
           <entry>
            <para>(<filename>multipath-tools</filename> 0.4.7 版及較早版本中的預設值；已廢棄，並由 <literal>directio</literal> 取代。)讀取裝置的第一個磁區。在 <filename>/var/log/messages</filename> 中記錄失敗訊息。</para>
           </entry>
          </row>
          <row id="b122swb4">
           <entry>
            <para>tur</para>
           </entry>
           <entry>
            <para>將 SCSI 測試單位就緒指令發送至裝置。這是較佳設定 (若 LUN 支援)。若指令失敗，它不會在 <filename>/var/log/messages</filename> 中記錄訊息。</para>
           </entry>
          </row>
          <row id="b122swb5">
           <entry>
            <para><replaceable>自定廠商值</replaceable></para>
           </entry>
           <entry>
            <para>有些 SAN 廠商會提供自定 path_checker 選項：</para>
            <itemizedlist mark="bullet" spacing="normal">
             <listitem>
              <formalpara id="b122w9oz">
               <title>cciss_tur：</title>
               <para>檢查 HP 智慧型儲存陣列的路徑狀態。</para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara id="b122swb6">
               <title>emc_clariion：</title>
               <para>查詢 EMC Clariion EVPD 的 0xC0 頁以決定路徑狀態。</para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara id="b122swb7">
               <title>hp_sw：</title>
               <para>檢查包含主動/待命韌體之 HP 儲存陣列的路徑狀態 (Up、Down 或 Ghost)。 </para>
              </formalpara>
             </listitem>
             <listitem>
              <formalpara id="b122swb8">
               <title>rdac：</title>
               <para>檢查 LSI/Engenio RDAC 儲存控制器的路徑狀態。</para>
              </formalpara>
             </listitem>
            </itemizedlist>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgq">
      <term>path_grouping_policy</term>
      <listitem>
       <para role="intro">指定由指定控制器代管之多重路徑裝置的路徑分組規則。</para>
       <formalpara id="b122sbgr" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122swaq">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122swar">
           <entry>
            <para>failover</para>
           </entry>
           <entry>
            <para>(預設) 每個優先程度群組指定一個路徑，以便每次只使用一個路徑。</para>
           </entry>
          </row>
          <row id="b122swas">
           <entry>
            <para>multibus</para>
           </entry>
           <entry>
            <para>所有有效的路徑均屬於一個優先程度群組。流量透過群組中的所有主動路徑來保持負載平衡。</para>
           </entry>
          </row>
          <row id="b122swat">
           <entry>
            <para>group_by_prio</para>
           </entry>
           <entry>
            <para>每個路徑優先程度值對應一個優先程度群組。優先程度相同的路徑位於同一個優先程度群組中。優先程度由外部程式指定。</para>
           </entry>
          </row>
          <row id="b122swau">
           <entry>
            <para>group_by_serial</para>
           </entry>
           <entry>
            <para>路徑根據 SCSI 目標序號 (控制器節點 WWN) 來分組。</para>
           </entry>
          </row>
          <row id="b122swav">
           <entry>
            <para>group_by_node_name</para>
           </entry>
           <entry>
            <para>每個目標節點名稱指定一個優先程度群組。目標節點名稱取自 <filename> /sys/class/fc_transport/target*/node_name</filename> 中。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgu">
      <term>path_selector</term>
      <listitem>
       <para role="intro">指定用於負載平衡的 path-selector 演算法。</para>
       <formalpara id="b122sbgv" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122t3po">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122t3pp">
           <entry>
            <para>round-robin 0</para>
           </entry>
           <entry>
            <para>(SLES 11 SP2 及較早版本中的預設值) 用於平衡一個優先程度群組中所有主動路徑之間的流量的負載平衡演算法。</para>
           </entry>
          </row>
          <row id="b122t3pr">
           <entry>
            <para>queue-length 0</para>
           </entry>
           <entry>
            <para>與 least-pending 選項類似，是一個可平衡多個路徑上進行中的 I/O 數量的動態負載平衡器。</para>
           </entry>
          </row>
          <row id="b122t3ps">
           <entry>
            <para>service-time 0</para>
           </entry>
           <entry>
            <para>(SLES 11 SP3 及更新版本中的預設值) 可根據延遲情況來平衡多個路徑上之 I/O 的服務時間導向型負載平衡器。 </para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgw">
      <term>pg_timeout</term>
      <listitem>
       <para>指定路徑群組逾時處理。</para>
       <formalpara id="b122sbgx" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>NONE (內部預設值)</para>
      </listitem>
     </varlistentry>
     <varlistentry id="b122w0sa">
      <term>polling_interval</term>
      <listitem>
       <para>指定一個路徑檢查週期結束與下一個路徑檢查週期開始之間的時間 (以秒為單位)。</para>
       <formalpara id="b122w0sb" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>指定一個大於 0 的整數值。預設值為 5。請務必向儲存系統廠商確認 polling_interval 設定。不同的儲存系統可能需要不同的設定。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbgy">
      <term>prio_callout</term>
      <listitem>
       <para>指定要用來決定多重路徑映射之配置的程式和引數。</para>
       <para>多重路徑 prio_callout 程式位於 <filename>/lib/libmultipath/lib*</filename> 中的共享程式庫中。透過使用共享程式庫，callout 程式會在精靈啟動時載入到記憶體中。 </para>
       <para>使用 <command>multipath</command> 指令查詢時，指定的 mpath_prio_* callout 程式會傳回相對於整個多重路徑配置之指定路徑的優先程度。 </para>
       <para>該指令與 group_by_prio 的 path_grouping_policy 一起使用時，具有相同優先程度的所有路徑都會分到一個多重路徑群組。總優先程度最高的群組成為主動群組。</para>
       <para>群組中的所有路徑都失敗時，總優先程度次高的群組成為主動群組。此外，系統可能還會將一條容錯移轉指令 (由硬體處理器決定) 傳送至該目標。</para>
       <para>mpath_prio_* 程式也可以是廠商或管理員為指定設定建立的自定程序檔。</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>指令行中的 <literal>%n</literal> 會展開至 <filename>/dev</filename> 目錄中的裝置名稱。 </para>
        </listitem>
        <listitem>
         <para>指令行中的 <literal>%b</literal> 會展開至 <filename>/dev</filename> 目錄中<replaceable>主要:次要</replaceable>格式的裝置編號。</para>
        </listitem>
        <listitem>
         <para>指令行中的 <literal>%d</literal> 會展開至 <filename>/dev/disk/by-id</filename> 目錄中的裝置 ID。</para>
        </listitem>
       </itemizedlist>
       <para>如果裝置為熱插式裝置，請使用 <literal>%d</literal> 旗標取代 <literal>%n</literal>。這能解決從裝置可以使用到 <command>udev</command> 建立裝置節點之間所經過的一小段時間的問題。</para>
       <formalpara id="b122sbgz" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122tqh2">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122tqh3">
           <entry>
            <para>(無值)</para>
           </entry>
           <entry>
            <para>如果未使用任何 <literal>prio_callout</literal> 屬性，則所有路徑的優先程度均相等。此為預設選項。</para>
           </entry>
          </row>
          <row id="b122tqh4">
           <entry>
            <para>/bin/true</para>
           </entry>
           <entry>
            <para>當未使用 group_by_prio 時，請指定此值。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
       <para>使用 <command>multipath</command> 指令查詢時，<command>prioritizer</command> 程式會產生路徑的優先程度。程式名稱必須以 <filename>mpath_prio_</filename> 開頭，並以裝置類型或所使用的平衡方式命名。目前的 prioritizer 程式包括以下幾種：</para>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="3539*"/>
        <colspec colnum="2" colname="2" colwidth="6464*"/>
         <thead>
          <row id="b122tml8">
           <entry>
            <para>優先程度排序程式</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122tml9">
           <entry>
            <para>mpath_prio_alua %n</para>
           </entry>
           <entry>
            <para>根據 SCSI-3 ALUA 設定產生路徑優先程度。 </para>
           </entry>
          </row>
          <row id="b122tmla">
           <entry>
            <para>mpath_prio_balance_units</para>
           </entry>
           <entry>
            <para>為所有路徑產生相同的優先程度。</para>
           </entry>
          </row>
          <row id="b122tp25">
           <entry>
            <para>mpath_prio_emc %n</para>
           </entry>
           <entry>
            <para>為 EMC 陣列產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122tp26">
           <entry>
            <para>mpath_prio_hds_modular %b</para>
           </entry>
           <entry>
            <para>為 Hitachi HDS Modular 儲存陣列產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122tp27">
           <entry>
            <para>mpath_prio_hp_sw %n</para>
           </entry>
           <entry>
            <para>為主動/待命模式下的 Compaq/HP 控制器產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122tp28">
           <entry>
            <para>mpath_prio_netapp %n</para>
           </entry>
           <entry>
            <para>為 NetApp 陣列產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122tp29">
           <entry>
            <para>mpath_prio_random %n</para>
           </entry>
           <entry>
            <para>為每個路徑產生隨機優先程度。</para>
           </entry>
          </row>
          <row id="b122tp2a">
           <entry>
            <para>mpath_prio_rdac %n</para>
           </entry>
           <entry>
            <para>為 LSI/Engenio RDAC 控制器產生路徑優先程度。</para>
           </entry>
          </row>
          <row id="b122tp2b">
           <entry>
            <para>mpath_prio_tpc %n</para>
           </entry>
           <entry>
            <para>您可以選擇性地使用由廠商或管理員建立的程序檔，從您用來為每個路徑指定要使用的優先程度的檔案中取得優先程度。</para>
           </entry>
          </row>
          <row id="b122tp2c">
           <entry>
            <para>mpath_prio_spec.sh %n</para>
           </entry>
           <entry>
            <para>提供使用者建立的程序檔的路徑，該程序檔會根據第二個資料檔案中包含的資訊，為多重路徑產生優先程度。(此路徑與檔名僅做為範例。請指定您自己的程序檔位置。)程序檔可由廠商或管理員建立。程序檔的目標檔案會識別所有多重路徑裝置的每個路徑，並為每個路徑指定優先程度。如需取得範例說明，請參閱<xref linkend="bbj87iv" xrefstyle="SectTitleOnPage"/>。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b122sbh0">
      <term>rr_min_io</term>
      <listitem>
       <para>指定需要路由至一個路徑之後再切換至同一個路徑群組中下一個路徑的 I/O 異動的數量，這由 <literal>path_selector</literal> 設定中指定的演算法決定。</para>
       <para>rr_min_io 屬性僅用於核心 2.6.31 及更早版本。它在 SLES 11 SP2 中已過時，並且已由 <literal>rr_min_io_rq</literal> 屬性所取代。</para>
       <formalpara id="b122sbh1" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>指定一個大於 0 的整數值。預設值為 1000。</para>

<screen>
rr_min_io "1000"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry id="b122sbh2">
      <term>rr_min_io_rq</term>
      <listitem>
       <para role="intro">在切換至目前路徑群組中的下一個路徑之前，使用基於申請的 device-mapper-multipath 指定路由至某個路徑之 I/O 申請的數量。 </para>
       <para>此屬性適用於執行 SLES 11 SP2 及更新版本的系統。它取代了 rr_min_io 屬性。</para>
       <formalpara id="b122sbh3" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <para>指定一個大於 0 的整數值。預設值為 1。</para>

<screen>
rr_min_io_rq "1"
</screen>

      </listitem>
     </varlistentry>
     <varlistentry id="b122sbh4">
      <term>rr_weight</term>
      <listitem>
       <para role="intro">指定用於計算路徑權重的方式。</para>
       <formalpara id="b122sbh5" role="intro">
        <title>值</title>
        <para/>
       </formalpara>
       <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
        <tgroup cols="2">
        <colspec colnum="1" colname="1" colwidth="2642*"/>
        <colspec colnum="2" colname="2" colwidth="7360*"/>
         <thead>
          <row id="b122tlbj">
           <entry>
            <para>值</para>
           </entry>
           <entry>
            <para>描述</para>
           </entry>
          </row>
         </thead>
         <tbody>
          <row id="b122tlbk">
           <entry>
            <para>uniform</para>
           </entry>
           <entry>
            <para>(預設) 所有路徑都擁有相同的輪替權數。</para>
           </entry>
          </row>
          <row id="b122tlbl">
           <entry>
            <para>priorities</para>
           </entry>
           <entry>
            <para>每個路徑的權數由路徑的優先程度乘以 rr_min_io_rq 設定 (或核心 2.6.31 及更早版本的 rr_min_io 設定) 決定。</para>
           </entry>
          </row>
         </tbody>
        </tgroup>
       </informaltable>
      </listitem>
     </varlistentry>
     <varlistentry id="b15gvth2">
      <term>uid_attribute</term>
      <listitem>
       <para>提供唯一路徑識別碼的 udev 屬性。預設值為 <literal>ID_SERIAL</literal>。</para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="bbi8jjc">
    <title>設定輪替式負載平衡</title>
    <para>所有路徑都處於主動狀態。I/O 設定為在移至序列中的下一個開啟路徑之前需經過秒數的時間或數個 I/O 異動。</para>
   </sect3>
   <sect3 id="bbi8jjd">
    <title>設定單一路徑容錯移轉</title>
    <para>優先程度最高 (設定值最低) 的單一路徑對流量而言是主動路徑。其他路徑可用於容錯移轉，但只有在發生容錯移轉時才會使用。 </para>
   </sect3>
   <sect3 id="bbi8g9x">
    <title>將 I/O 路徑分組以使用輪替式負載平衡</title>
    <para>具有相同優先程度的多個路徑都歸入主動群組。該群組中的所有路徑都失敗時，裝置會容錯移轉至優先程度次高的群組。群組中的所有路徑以輪替式負載平衡方式共享流量負載。</para>
   </sect3>
  </sect2>
  <sect2 id="bbj87iv">
   <title>使用程序檔設定路徑優先程度</title>
   <para>您可以建立一個與裝置對應程式多重路徑 (DM-MPIO) 互動的程序檔，以在 LUN 設定為 <command>prio_callout</command> 設定的資源時，為 LUN 的路徑提供優先程度。 </para>
   <para>首先，設定文字檔，在其中列出關於每個裝置的資訊以及要指定給每個路徑的優先程度值。例如，將檔案命名為 <filename>/usr/local/etc/primary-paths</filename>。以下列格式為每個路徑輸入一行指令：</para>

<screen>
host_wwpn target_wwpn scsi_id priority_value
</screen>

   <para>這會為裝置中的每個路徑傳回一個優先程度值。請確保變數 FILE_PRIMARY_PATHS 可解析為含有每個裝置相應資料 (如主機 wwpn、目標 wwpn、scsi_id 及優先程度值) 的實際檔案。 </para>
   <para>包含八個路徑的單一 LUN 的 <filename>primary-paths</filename> 檔案中，每個路徑顯示如下：</para>

<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:0 sdb 3600a0b8000122c6d00000000453174fc 50
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:1 sdc 3600a0b80000fd6320000000045317563 2
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:2 sdd 3600a0b8000122c6d0000000345317524 50
</screen>


<screen>
0x10000000c95ebeb4 0x200200a0b8122c6e 2:0:0:3 sde 3600a0b80000fd6320000000245317593 2
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:0 sdi 3600a0b8000122c6d00000000453174fc 5
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:1 sdj 3600a0b80000fd6320000000045317563 51
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:2 sdk 3600a0b8000122c6d0000000345317524 5
</screen>


<screen>
0x10000000c95ebeb4 0x200300a0b8122c6e 2:0:1:3 sdl 3600a0b80000fd6320000000245317593 51
</screen>

   <para>若要繼續<xref linkend="b122sbgy" xrefstyle="HeadingOnPage"/> 中提到的範例，請建立名為 <filename>/usr/local/sbin/path_prio.sh</filename> 的程序檔。您可使用任何路徑和檔名。程序檔會執行下列動作：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>在多重路徑中查詢時，從 <filename>/usr/local/etc/primary-paths</filename> 檔案中查找裝置及其路徑。</para>
    </listitem>
    <listitem>
     <para>將檔案中該項目最後一欄中的優先程度值傳回多重路徑。</para>
    </listitem>
   </itemizedlist>
  </sect2>
  <sect2 id="bbi8acn">
   <title>設定 ALUA (mpath_prio_alua)</title>
   <para><command>mpath_prio_alua(8)</command> 指令可做為 Linux <command>multipath(8)</command> 指令的優先程度註標。該指令會傳回 DM-MPIO 用於將優先程度相同的 SCSI 裝置分在同一組的編號。此路徑優先程度工具以 ALUA (非同步邏輯單位存取) 為基礎。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="beg2eyu" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="beg2e1m" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbj46qo" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bbj4fvf" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="beg2eyu">
    <title>語法</title>

<screen>
mpath_prio_alua [-d <replaceable>directory</replaceable>] [-h] [-v] [-V] <replaceable>device</replaceable> [<replaceable>device</replaceable>...] 
</screen>

   </sect3>
   <sect3 id="beg2e1m">
    <title>必備條件</title>
    <para>SCSI 裝置.</para>
   </sect3>
   <sect3 id="bbj46qo">
    <title>選項</title>
    <variablelist>
     <varlistentry id="bbj46v3">
      <term>-d <replaceable>directory</replaceable></term>
      <listitem>
       <para>指定可在其中找到所列裝置節點名稱的 Linux 目錄路徑。預設目錄為 <filename>/dev</filename>。使用此選項時，請只指定要管理的一或多個裝置的裝置節點名稱 (如 <filename>sda</filename>)。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4am6">
      <term>-h</term>
      <listitem>
       <para>顯示此指令的說明，然後結束。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4am7">
      <term>-v</term>
      <listitem>
       <para>開啟詳細輸出，以較易理解的形式顯示狀態。輸出包括有關指定裝置所處的連接埠群組及其目前狀態的資訊。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4am8">
      <term>-V</term>
      <listitem>
       <para>顯示此工具的版本號碼，然後結束。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bbj4c17">
      <term><replaceable>裝置</replaceable> [<replaceable>裝置</replaceable>...] </term>
      <listitem>
       <para>指定要管理的 SCSI 裝置 (或多個裝置)。該裝置必須為支援報告目標連接埠群組 (<command>sg_rtpg(8)</command>) 指令的 SCSI 裝置。為裝置節點名稱使用下列其中一種格式：</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>使用完整的 Linux 目錄路徑，如 <filename>/dev/sda</filename>。請勿與 -d 選項一起使用。</para>
        </listitem>
        <listitem>
         <para>只使用裝置節點名稱，如 <filename>sda</filename>。使用 -d 選項指定目錄路徑。</para>
        </listitem>
        <listitem>
         <para>裝置的主要和次要編號以冒號 (:) 分隔，不含空格，如 <filename>8:0</filename>。這會在 <filename>/dev</filename> 目錄中建立名稱為 <filename>tmpdev-&lt;major&gt;:&lt;minor&gt;-&lt;pid&gt;</filename> 格式的暫存裝置節點。例如，<filename>/dev/tmpdev-8:0-&lt;pid&gt;</filename>。</para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="bbj4fvf">
    <title>傳回值</title>
    <para>成功後會傳回值 0 和群組的優先程度值。<xref linkend="bbilsw8" xrefstyle="TableXRef"/> 顯示了 <command>mpath_prio_alua</command> 指令所傳回的優先程度值。 </para>
    <table id="bbilsw8" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
     <title>裝置對應程式多重路徑的 ALUA 優先程度</title>
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="2381*"/>
     <colspec colnum="2" colname="2" colwidth="7620*"/>
      <thead>
       <row id="bbiltgc">
        <entry>
         <para>優先程度值</para>
        </entry>
        <entry>
         <para>描述</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="bbiltgd">
        <entry>
         <para>50</para>
        </entry>
        <entry>
         <para>裝置屬於主動且最佳化的群組。</para>
        </entry>
       </row>
       <row id="bbiltge">
        <entry>
         <para>10</para>
        </entry>
        <entry>
         <para>裝置屬於主動但非最佳化的群組。</para>
        </entry>
       </row>
       <row id="bbj4j3r">
        <entry>
         <para>1</para>
        </entry>
        <entry>
         <para>裝置屬於待命群組。</para>
        </entry>
       </row>
       <row id="bbiltgf">
        <entry>
         <para>0</para>
        </entry>
        <entry>
         <para>所有其他群組。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para>由於 <command>multipath</command> 指令對每個值的處理方式不同，因此這些值相差比較大。該指令會將群組中路徑的數量乘以群組的優先程度值，然後選取所得結果最高的群組。例如，如果非最佳化的路徑群組有 6 個路徑 (6 x 10 = 60)，最佳化路徑群組有一個路徑 (1 x 50 = 50)，那麼非最佳化群組的得分最高，因此 multipath 會選擇非最佳化群組。流向裝置的流量會以輪替式方式使用該群組中的所有 6 個路徑。</para>
    <para>失敗時會傳回指出指令失敗原因的值 (1 到 5)。如需資訊，請參閱 <command>mpath_prio_alua</command> 的線上文件。</para>
   </sect3>
  </sect2>
  <sect2 id="bbi8els">
   <title>報告目標路徑群組</title>
   <para>使用 SCSI 報告目標連接埠群組 (<command>sg_rtpg(8)</command>) 指令。如需資訊，請參閱 <command>sg_rtpg(8)</command> 的線上文件。</para>
  </sect2>
 </sect1>
 <sect1 id="mpioroot">
  <title>設定根裝置的多重路徑 I/O</title>
  <para>SUSE Linux Enterprise Server 11 中提供了裝置對應程式多重路徑 I/O (DM-MPIO) 及其對 <filename>/boot</filename> 和 <filename>/root</filename> 的支援。此外，YaST 安裝程式中的 YaST 磁碟分割程式支援在安裝期間啟用多重路徑。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bp27t6u" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bomc64f" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bomc64g" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bp27t6u">
   <title>安裝時啟用多重路徑 I/O</title>
   <para>若要在多重路徑裝置上安裝作業系統，則安裝過程中多重路徑軟體必須處於執行中狀態。系統安裝過程中，multipathd 精靈不會自動啟動。您可以使用 YaST 磁碟分割程式中的<guimenu>設定多重路徑</guimenu>選項來啟動。 </para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bomcrff" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bomc64e" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bomcrff">
    <title>在主動/主動多重路徑儲存 LUN 上安裝時啟用多重路徑 I/O</title>
    <procedure id="bomcrfg">
     <step id="bomcrfh" performance="required">
      <para>安裝期間，在 YaST 的「安裝設定」頁面上按一下<guimenu>磁碟分割</guimenu>，開啟 YaST 磁碟分割程式。</para>
     </step>
     <step id="bomcrfi" performance="required">
      <para>選取<guimenu>自定分割區 (進階)</guimenu>。</para>
     </step>
     <step id="bomcrfj" performance="required">
      <para>選取<guimenu>硬碟</guimenu>主圖示，按一下<guimenu>設定</guimenu>按鈕，然後選取<guimenu>設定多重路徑</guimenu>。</para>
     </step>
     <step id="bomcrfk" performance="required">
      <para role="intro">啟動多重路徑。</para>
      <para>YaST 即會開始重新掃描磁碟，然後顯示可用的多重路徑裝置 (例如 <filename>/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</filename>)。之後所有的處理步驟都應使用此裝置。 </para>
     </step>
     <step id="bomcrfl" performance="required">
      <para>按<guimenu>下一步</guimenu>繼續安裝。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bomc64e">
    <title>在主動/被動多重路徑儲存 LUN 上安裝時啟用多重路徑 I/O</title>
    <para>系統安裝過程中，multipathd 精靈不會自動啟動。您可以使用 YaST 磁碟分割程式中的<guimenu>設定多重路徑</guimenu>選項來啟動。 </para>
    <para>若要在主動/被動多重路徑儲存 LUN 上安裝時啟用多重路徑 I/O：</para>
    <procedure id="bomc6el">
     <step id="bomc6em" performance="required">
      <para>安裝期間，在 YaST 的「安裝設定」頁面上按一下<guimenu>磁碟分割</guimenu>，開啟 YaST 磁碟分割程式。</para>
     </step>
     <step id="bomc7xx" performance="required">
      <para>選取<guimenu>自定分割區 (進階)</guimenu>。</para>
     </step>
     <step id="bomc83f" performance="required">
      <para>選取<guimenu>硬碟</guimenu>主圖示，按一下<guimenu>設定</guimenu>按鈕，然後選取<guimenu>設定多重路徑</guimenu>。</para>
     </step>
     <step id="bomc8h8" performance="required">
      <para>啟動多重路徑。</para>
      <para>YaST 即會開始重新掃描磁碟，然後顯示可用的多重路徑裝置 (例如 <filename>/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</filename>)。之後所有的處理步驟都應使用此裝置。記下裝置路徑與 UUID，稍後會用到。 </para>
     </step>
     <step id="bomcatl" performance="required">
      <para>按<guimenu>下一步</guimenu>繼續安裝。</para>
     </step>
     <step id="bomca3n" performance="required">
      <para>完成所有設定和安裝後，YaST 即會開始寫入開機載入程式資訊，並顯示重新啟動系統的倒數計時。按一下<guimenu>停止</guimenu>按鈕停止計數器，然後按 CTRL+ALT+F5 存取主控台。</para>
     </step>
     <step id="bomcamo" performance="required">
      <para>使用主控台確定是否在 <filename>/boot/grub/device.map</filename> 檔案中為 <filename>hd0</filename> 項目輸入了被動路徑。</para>
      <para>執行此動作非常必要，因為安裝程序無法區分主動路徑與被動路徑。</para>
      <substeps performance="required">
       <step id="bomcby2" performance="required">
        <para role="intro">輸入以下指令，將根裝置掛接至 <filename>/mnt</filename>︰</para>

<screen>
mount /dev/disk/by-id/&lt;<replaceable>UUID</replaceable>&gt;_part2 /mnt
</screen>

        <para role="intro">例如，輸入︰</para>

<screen>
mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt
</screen>

       </step>
       <step id="bomcfm2" performance="required">
        <para role="intro">輸入以下指令，將開機裝置掛接至 <filename>/mnt/boot</filename>︰</para>

<screen>
mount /dev/disk/by-id/&lt;<replaceable>UUID</replaceable>&gt;_part1 /mnt/boot
</screen>

        <para role="intro">例如，輸入 </para>

<screen>
mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt/boot
</screen>

       </step>
       <step id="bomcg7c" performance="required">
        <para>輸入以下指令，開啟 <filename>/mnt/boot/grub/device.map</filename> 檔案</para>

<screen>
less /mnt/boot/grub/device.map
</screen>

       </step>
       <step id="bomcg05" performance="required">
        <para>在 <filename>/mnt/boot/grub/device.map</filename> 檔案中，確定 <filename>hd0</filename> 項目是否指向被動路徑，然後執行下列其中一項動作︰</para>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <formalpara id="bomchix">
           <title>主動路徑：</title>
           <para>不需要執行任何動作，跳過<xref linkend="bomc8jz" xrefstyle="StepXRef"/>，繼續<xref linkend="bomcboo" xrefstyle="StepXRef"/>。</para>
          </formalpara>
         </listitem>
         <listitem>
          <formalpara id="bomciib">
           <title>被動路徑：</title>
           <para>必須變更組態並重新安裝開機載入程式。繼續執行<xref linkend="bomc8jz" xrefstyle="StepXRef"/>。</para>
          </formalpara>
         </listitem>
        </itemizedlist>
       </step>
      </substeps>
     </step>
     <step id="bomc8jz" performance="required">
      <para role="intro">如果 hd0 項目指向被動路徑，請變更組態並重新安裝開機載入程式：</para>
      <substeps performance="required">
       <step id="bomcmd6" performance="required">
        <para role="intro">在主控台提示符處，輸入下列指令：</para>

<screen>
mount -o bind /dev /mnt/dev

mount -o bind /sys /mnt/sys

mount -o bind /proc /mnt/proc

chroot

</screen>

       </step>
       <step id="bomclu7" performance="required">
        <para role="intro">在主控台中執行 <command>multipath -ll</command>，然後檢查輸出以尋找主動路徑。 </para>
        <para>被動路徑會有 <literal>ghost</literal> 標記。</para>
       </step>
       <step id="bomcmwr" performance="required">
        <para>在 <filename>/mnt/boot/grub/device.map</filename> 檔案中，將 <literal>hd0</literal> 項目變更為主動路徑並儲存變更，然後關閉檔案。</para>
       </step>
       <step id="bomcndj" performance="required">
        <para role="intro">如果先前選擇從 MBR 開機，<filename>/etc/grub.conf</filename> 內容應如下所示：</para>

<screen>
setup --stage2=/boot/grub/stage2 (hd0) (hd0,0)
quit
</screen>

       </step>
       <step id="bomcoe1" performance="required">
        <para role="intro">輸入以下指令，重新安裝開機載入程式</para>

<screen>
grub &lt; /etc/grub.conf
</screen>

       </step>
       <step id="bomcol7" performance="required">
        <para role="intro">輸入下列指令：</para>

<screen>
exit

umount /mnt/*

umount /mnt
</screen>

       </step>
      </substeps>
     </step>
     <step id="bomcboo" performance="required">
      <para>按 CTRL+ALT+F7 返回 YaST 圖形環境。 </para>
     </step>
     <step id="bomcjfg" performance="required">
      <para>按一下<guimenu>確定</guimenu>繼續執行安裝的重新開機作業。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="bomc64f">
   <title>對現有根裝置啟用多重路徑 I/O</title>
   <procedure id="b7cjqvq">
    <step id="b7cjqvr" performance="required">
     <para>僅使用單個主動路徑安裝 Linux，尤其是當磁碟分割程式中列有 <filename>by-id</filename> 符號連結時。</para>
    </step>
    <step id="b7cjrle" performance="required">
     <para>使用安裝期間所用的 <filename>/dev/disk/by-id</filename> 路徑來掛接裝置。</para>
    </step>
    <step id="b7cjs32" performance="required">
     <para>安裝之後，將 <command>dm-multipath</command> 新增至 <filename>/etc/sysconfig/kernel:INITRD_MODULES</filename>。</para>
    </step>
    <step id="bky5jc7" performance="required">
     <para>對於 System Z，請先編輯 <filename>/etc/zipl.conf</filename> 檔案，以 <filename>/etc/fstab</filename> 中使用的 by-id 資訊變更 <filename>zipl.conf</filename> 中的 by-path 資訊，然後再執行 mkinitrd。 </para>
    </step>
    <step id="b7cjsl3" performance="required">
     <para>重新執行 <command>/sbin/mkinitrd</command> 以更新 <filename>initrd</filename> 影像。</para>
    </step>
    <step id="bky5j1x" performance="required">
     <para>對於 System Z，請在執行 <command>mkinitrd</command> 之後執行 <command>zipl</command>。</para>
    </step>
    <step id="b7cjuv4" performance="required">
     <para>重新載入伺服器。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="bomc64g">
   <title>在根裝置上停用多重路徑 I/O</title>
   <procedure id="b7jqdde">
    <step id="b7jqddf" performance="required">
     <para>將 <literal>multipath=off</literal> 新增至核心指令行。</para>
     <para>這只會影響根裝置，而不會影響所有其他裝置。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="mpioraid">
  <title>設定現有軟體 RAID 的多重路徑 I/O</title>
  <para>理想狀況下，您應該先設定裝置的多重路徑，然後再將它們當成軟體 RAID 裝置的元件使用。如果您在建立任何軟體 RAID 裝置後再新增多重路徑，則系統重新開機時可能會先啟動 <command>multipath</command> 服務，然後再啟動 DM-MPIO 服務，導致 RAID 可能會無法使用多重路徑。您可以使用本節所述的程序，讓多重路徑針對多先前存在的軟體 RAID 執行。 </para>
  <para>例如，在下列情況中，您可能需要設定軟體 RAID 中裝置的多重路徑：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>如果在執行全新安裝或升級期間建立新的軟體 RAID，將其做為磁碟分割設定的一部分。</para>
   </listitem>
   <listitem>
    <para>如果將軟體 RAID 中的裝置當成成員裝置或備品之前未設定裝置以進行多重路徑。</para>
   </listitem>
   <listitem>
    <para>如果透過將新的 HBA 配接器新增至伺服器，或擴充 SAN 中的儲存子系統來擴展您的系統。 </para>
   </listitem>
  </itemizedlist>
  <note>
   <para>下列指示假設軟體 RAID 裝置為 <filename>/dev/mapper/mpath0&gt;</filename>，這是核心可辨識的裝置名稱。假設您已依照<xref linkend="mpionames" xrefstyle="HeadingOnPage"/> 中所述在 <filename>/etc/multipath.conf</filename> 檔案中啟用了使用者易記的名稱。 </para>
   <para>請務必修改適用於軟體 RAID 之裝置名稱的指示。</para>
  </note>
  <procedure id="b59pkd5">
   <step id="b59qv1e" performance="required">
    <para role="intro">開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
    <para>請在下列步驟中使用此主控台輸入指令，除非導向到其他位置。</para>
   </step>
   <step id="b59qezr" performance="required">
    <para>如果目前已掛接或正在執行任何軟體 RAID 裝置，請為每個裝置輸入以下指令以卸下裝置並將其停止。</para>

<screen>
umount /dev/mapper/mpath0
</screen>


<screen>
mdadm --misc --stop /dev/mapper/mpath0
</screen>

   </step>
   <step id="b59q95b" performance="required">
    <para>輸入以下指令停止 <command>boot.md</command> 服務</para>

<screen>
/etc/init.d/boot.md stop
</screen>

   </step>
   <step id="b59qeuu" performance="required">
    <para>輸入以下指令啟動 <filename>boot.multipath</filename> 和 <filename>multipathd</filename> 服務：</para>

<screen>
/etc/init.d/boot.multipath start
</screen>


<screen>
/etc/init.s/multipathd start
</screen>

   </step>
   <step id="b59qp65" performance="required">
    <para>啟動多重路徑服務之後，驗證軟體 RAID 的元件裝置是否列在 <filename>/dev/disk/by-id</filename> 目錄中。請執行下列其中一個步驟︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b59qrp7">
       <title>裝置已列出：</title>
       <para>裝置名稱現在應該有連至裝置對應程式多重路徑裝置名稱的符號連結，如 <filename>/dev/dm-1</filename>。 </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b59qrx0">
       <title>裝置未列出：</title>
       <para>透過衝洗和重新探查裝置的方式，強制多重路徑服務辨識裝置。 </para>
      </formalpara>
      <para>要實現此目的，請輸入以下指令：</para>

<screen>
multipath -F
</screen>


<screen>
multipath -v0
</screen>

      <para>裝置現在應該列於 <filename>/dev/disk/by-id</filename> 中，並擁有連至其裝置對應程式多重路徑裝置名稱的符號連結。例如：</para>

<screen>
lrwxrwxrwx 1 root root 10 2011-01-06 11:42 dm-uuid-mpath-36006016088d014007e0d0d2213ecdf11 -&gt; ../../dm-1
</screen>

     </listitem>
    </itemizedlist>
   </step>
   <step id="b59qtrw" performance="required">
    <para>輸入以下指令重新啟動 <filename>boot.md</filename> 服務和 RAID 裝置 </para>

<screen>
/etc/init.d/boot.md start
</screen>

   </step>
   <step id="b59qu7z" performance="required">
    <para>輸入以下指令檢查軟體 RAID 的狀態</para>

<screen>
mdadm --detail /dev/mapper/mpath0
</screen>

    <para>RAID 的元件裝置應與其裝置對應程式多重路徑裝置名稱相符，這些裝置名稱在 <filename>/dev/disk/by-id</filename> 目錄中列為裝置的符號連結。</para>
   </step>
   <step id="b59r62x" performance="required">
    <para>建立新的 <filename>initrd</filename>，以確保系統重新開機時先載入裝置對應程式多重路徑服務，然後再載入 RAID 服務。僅當根 (/) 裝置或其任何部分 (例如 <filename>/var</filename>、<filename>/etc</filename>、<filename>/log</filename>) 位於 SAN 上且需要多重路徑以便開機時，才需要執行 <command>mkinitrd</command>。</para>
    <para>輸入</para>

<screen>
mkinitrd -f multipath
</screen>

   </step>
   <step id="b59rekg" performance="required">
    <para>將伺服器重新開機，以套用這些安裝後組態設定。</para>
   </step>
   <step id="b59rf4m" performance="required">
    <para>檢查 RAID 狀態，以驗證軟體 RAID 陣列是否正確地顯示在多重路徑裝置頂部。輸入</para>

<screen>
mdadm --detail /dev/mapper/mpath0
</screen>

    <para>例如：</para>
    <simplelist>
     <member><literal>Number Major Minor RaidDevice State</literal></member> <member> <literal>0 253 0 0 active sync /dev/dm-0</literal></member> <member> <literal>1 253 1 1 active sync /dev/dm-1</literal></member> <member> <literal>2 253 2 2 active sync /dev/dm-2</literal></member>
    </simplelist>
   </step>
  </procedure>
 </sect1>
 <sect1 id="scandev">
  <title>掃描新裝置而不重新開機</title>
  <para>如果您的系統已經設定多重路徑，而您稍後需要將更多儲存體新增到 SAN，則可以使用 <command>rescan-scsi-bus.sh</command> 程序檔掃描新的裝置。依預設，此程序檔會掃描所有 HBA 的一般 LUN 範圍。 </para>
  <warning>
   <para>在 EMC PowerPath 環境中，請勿使用作業系統隨附的 <filename>rescan-scsi-bus.sh</filename> 公用程式或 HBA 廠商程序檔來掃描 SCSI 匯流排。為了避免潛在的檔案系統損毀，EMC 要求您遵循 EMC PowerPath for Linux 的廠商文件中提供的程序來操作。</para>
  </warning>
  <bridgehead id="boimjzp">語法</bridgehead>

<screen>
rescan-scsi-bus.sh [options] [host [host ...]]
</screen>

  <para>您可以透過指令行指定主機 (已廢棄)，或使用 <literal>--hosts=LIST</literal> 選項來指定 (推薦)。</para>
  <bridgehead id="boimk55">選項</bridgehead>
  <para>對於大多數儲存子系統，該程序檔都可在不使用任何選項的情況下成功執行。但在某些特殊情況下，可能需要為 <command>rescan-scsi-bus.sh</command> 程序檔使用下列一或多個參數：</para>
  <informaltable role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="2381*"/>
   <colspec colnum="2" colname="2" colwidth="7620*"/>
    <thead>
     <row id="boiml8l">
      <entry>
       <para>選項</para>
      </entry>
      <entry>
       <para>描述</para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row id="boiml8m">
      <entry>

<screen>
-l
</screen>
</entry>
      <entry>
       <para>啟動對 LUN 0-7 的掃描。[預設值：0]</para>
      </entry>
     </row>
     <row id="boiml8n">
      <entry>

<screen>
-L NUM
</screen>
</entry>
      <entry>
       <para>啟動對 LUN 0-NUM 的掃描。[預設值：0]</para>
      </entry>
     </row>
     <row id="boiml8o">
      <entry>

<screen>
-w
</screen>
</entry>
      <entry>
       <para>掃描 ID 為 0 到 15 的目標裝置。[預設值：0 到 7]</para>
      </entry>
     </row>
     <row id="boimoae">
      <entry>

<screen>
-c
</screen>
</entry>
      <entry>
       <para>啟用對通道 0 或 1 的掃描。[預設值：0]</para>
      </entry>
     </row>
     <row id="boimoaf">
      <entry>

<screen>
-r
--remove
</screen>
</entry>
      <entry>
       <para>啟用裝置的移除。[預設：已停用]</para>
      </entry>
     </row>
     <row id="boimoag">
      <entry>

<screen>
-i
--issueLip
</screen>
</entry>
      <entry>
       <para>對光纖通道 LIP 進行重設。[預設：已停用]</para>
      </entry>
     </row>
     <row id="boimoah">
      <entry>

<screen>
--forcerescan
</screen>
</entry>
      <entry>
       <para>重新掃描現有裝置。</para>
      </entry>
     </row>
     <row id="boimoai">
      <entry>

<screen>
--forceremove
</screen>
</entry>
      <entry>
       <para>移除所有裝置並重新新增。 </para>
       <warning>
        <para>此選項非常危險，請慎用。</para>
       </warning>
      </entry>
     </row>
     <row id="boimoaj">
      <entry>

<screen>
--nooptscan
</screen>
</entry>
      <entry>
       <para>發現 0 之前持續尋找 LUN。</para>
      </entry>
     </row>
     <row id="boj5t9m">
      <entry>

<screen>
--color
</screen>
</entry>
      <entry>
       <para>使用彩色的字首 OLD/NEW/DEL。</para>
      </entry>
     </row>
     <row id="boj5t9n">
      <entry>

<screen>
--hosts=LIST
</screen>
</entry>
      <entry>
       <para>僅掃描 LIST 中的主機，LIST 是以逗號分隔的單一值和範圍的清單。不允許使用空格。</para>

<screen>
--hosts=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row id="boj5t9o">
      <entry>

<screen>
--channels=LIST
</screen>
</entry>
      <entry>
       <para>僅掃描 LIST 中的通道，LIST 是以逗號分隔的單一值和範圍的清單。不允許使用空格。 </para>

<screen>
--channels=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row id="boj5t9p">
      <entry>

<screen>
--ids=LIST
</screen>
</entry>
      <entry>
       <para>僅掃描 LIST 中的目標 ID，LIST 是以逗號分隔的單一值和範圍的清單。不允許使用空格。 </para>

<screen>
--ids=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
     <row id="boimoak">
      <entry>

<screen>
--luns=LIST
</screen>
</entry>
      <entry>
       <para>僅掃描 LIST 中的 LUN，LIST 是以逗號分隔的單一值和範圍的清單。不允許使用空格。</para>

<screen>
--luns=A[-B][,C[-D]]
</screen>

      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <bridgehead id="boj5xxj">程序</bridgehead>
  <para>使用以下程序掃描裝置，以便在不將系統重新開機的情況下使這些裝置適用於多重路徑。 </para>
  <procedure id="b59rt6j">
   <step id="b59rt6k" performance="required">
    <para>在儲存子系統中，使用廠商的工具來配置裝置並更新其存取控制設定，以允許 Linux 系統存取新的儲存。如需詳細資料，請參閱廠商提供的文件。</para>
   </step>
   <step id="b59rw69" performance="required">
    <para>掃描主機的所有目標，以使 Linux 核心的 SCSI 子系統的中間層級可辨識其新裝置。在終端機主控台提示符處輸入</para>

<screen>
rescan-scsi-bus.sh [options]
</screen>

   </step>
   <step id="b8ru7x3" performance="required">
    <para>檢查系統記錄 (<filename>/var/log/messages</filename> 檔案) 中的掃描進度。在終端機主控台提示符處輸入</para>

<screen>
tail -30 /var/log/messages
</screen>

    <para>此指令會顯示記錄的最後 30 行。例如：</para>

<screen>
# tail -30 /var/log/messages
. . .
Feb 14 01:03 kernel: SCSI device sde: 81920000
Feb 14 01:03 kernel: SCSI device sdf: 81920000
Feb 14 01:03 multipathd: sde: path checker registered
Feb 14 01:03 multipathd: sdf: path checker registered
Feb 14 01:03 multipathd: mpath4: event checker started
Feb 14 01:03 multipathd: mpath5: event checker started
Feb 14 01:03:multipathd: mpath4: remaining active paths: 1
Feb 14 01:03 multipathd: mpath5: remaining active paths: 1
</screen>

   </step>
   <step id="b8ruapd" performance="required">
    <para>重複<xref linkend="b59rw69" xrefstyle="StepXRef"/> 到<xref linkend="b8ru7x3" xrefstyle="StepXRef"/>，以透過 Linux 系統中連接至新裝置的其他 HBA 配接器新增路徑。</para>
   </step>
   <step id="b59ryjx" performance="required">
    <para>執行 <command>multipath</command> 指令辨識可設定 DM-MPIO 組態的裝置。在終端機主控台提示符處輸入 </para>

<screen>
multipath
</screen>

    <para>您現在可以設定新裝置以進行多重路徑了。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="be48i9g">
  <title>掃描新分割的裝置而不重新開機</title>
  <para role="intro">使用本節中的範例，可以在不重新開機的情況下偵測新增的多重路徑 LUN。</para>
  <warning>
   <para>在 EMC PowerPath 環境中，請勿使用作業系統隨附的 <filename>rescan-scsi-bus.sh</filename> 公用程式或 HBA 廠商程序檔來掃描 SCSI 匯流排。為了避免潛在的檔案系統損毀，EMC 要求您遵循 EMC PowerPath for Linux 的廠商文件中提供的程序來操作。</para>
  </warning>
  <procedure id="befqdst">
   <step id="befqdsu" performance="required">
    <para>開啟終端機主控台，然後以 <systemitem>root</systemitem> 使用者身分登入。</para>
   </step>
   <step id="boj61wx" performance="required">
    <para>掃描主機的所有目標，以使 Linux 核心的 SCSI 子系統的中間層級可辨識其新裝置。在終端機主控台提示符處輸入</para>

<screen>
rescan-scsi-bus.sh [options]
</screen>

    <para>如需 <filename>rescan-scsi-bus-sh</filename> 程序檔的語法和選項資訊，請參閱<xref linkend="scandev" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
   <step id="befqeer" performance="required">
    <para>輸入以下指令驗證裝置是否已探查到 (例如連結是否具有一個新的時戳)</para>

<screen>
ls -lrt /dev/dm-*
</screen>

    <para>也可以輸入以下指令在 <filename>/dev/disk/by-id</filename> 中驗證裝置︰</para>

<screen>
ls -l /dev/disk/by-id/
</screen>

   </step>
   <step id="befqfh9" performance="required">
    <para>輸入以下指令驗證新裝置是否顯示在記錄中︰</para>

<screen>
tail -33 /var/log/messages
</screen>

   </step>
   <step id="befqhvc" performance="required">
    <para>使用文字編輯器在 <filename>/etc/multipath.conf</filename> 檔案中新增裝置的新別名定義，如 <filename>data_vol3</filename>。 </para>
    <para>例如，如果 UUID 為 <filename>36006016088d014006e98a7a94a85db11</filename>，請進行下列變更：</para>

<screen>
defaults {
     user_friendly_names   yes
  }
multipaths {  
     multipath {      
          wwid    36006016088d014006e98a7a94a85db11      
          alias  data_vol3      
          }
  }
</screen>

   </step>
   <step id="befqj91" performance="required">
    <para>輸入以下指令建立裝置的分割區表︰</para>

<screen>
fdisk /dev/disk/by-id/dm-uuid-mpath-&lt;UUID&gt;
</screen>

    <para>以裝置 WWID 取代 UUID，例如 <filename>36006016088d014006e98a7a94a85db11</filename>。</para>
   </step>
   <step id="befqjhp" performance="required">
    <para>輸入以下指令觸發 udev︰</para>

<screen>
echo 'add' &gt; /sys/block/&lt;<replaceable>dm_device</replaceable>&gt;/uevent
</screen>

    <para>例如，若要為 <filename>dm-8</filename> 上的分割區產生裝置對應程式裝置，請輸入</para>

<screen>
echo 'add' &gt; /sys/block/dm-8/uevent
</screen>

   </step>
   <step id="befqkj8" performance="required">
    <para>輸入以下指令為新分割區建立檔案系統和標籤：</para>

<screen>
mke2fs -j /dev/disk/by-id/dm-uuid-mpath-&lt;<replaceable>UUID_partN</replaceable>&gt;
tune2fs -L <replaceable>data_vol3</replaceable> /dev/disk/by-id/dm-uuid-&lt;<replaceable>UUID_partN</replaceable>&gt;
</screen>

    <para>以實際 UUID 和分割區編號取代 <filename>UUID_part1</filename>，例如 36006016088d014006e98a7a94a85db11_part1。</para>
   </step>
   <step id="befqljm" performance="required">
    <para>輸入以下指令重新啟動 DM-MPIO，使其讀取別名︰</para>

<screen>
/etc/init.d/multipathd restart
</screen>

   </step>
   <step id="befqmbi" performance="required">
    <para role="intro">輸入以下指令驗證 <command>multipathd</command> 是否可辨識裝置︰</para>

<screen>
multipath -ll
</screen>

   </step>
   <step id="befqmno" performance="required">
    <para>使用文字編輯器在 <filename>/etc/fstab</filename> 檔案中新增掛接項目。 </para>
    <para>此時，您在<xref linkend="befqhvc" xrefstyle="StepXRef"/> 中建立的別名尚不存在於 <filename>/dev/disk/by-label</filename> 目錄中。在掛接項目中新增 <filename>/dev/dm-9</filename> 路徑，然後在下次重新開機到以下項目之前變更該項目 </para>

<screen>
LABEL=data_vol3
</screen>

   </step>
   <step id="befqr98" performance="required">
    <para>輸入以下指令建立要做為掛接點的目錄，然後掛接裝置</para>

<screen>
md <replaceable>/data_vol3</replaceable>
</screen>


<screen>
mount <replaceable>/data_vol3</replaceable>
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="mpiostatus">
  <title>檢視多重路徑 I/O 狀態</title>
  <para>查詢多重路徑 I/O 狀態會輸出多重路徑映射的目前狀態。 </para>
  <para><command>multipath -l</command> 選項會顯示上次執行路徑檢查程式後目前的路徑狀態。該選項不會執行路徑檢查程式。 </para>
  <para><command>multipath -ll</command> 選項會執行路徑檢查程式，更新路徑資訊，然後顯示目前的狀態資訊。此選項會始終顯示路徑狀態的最新資訊。</para>
  <procedure id="b8ruq0c">
   <step id="b8ruq0d" performance="required">
    <para>在終端機主控台提示符處輸入</para>

<screen>
multipath -ll
</screen>

    <para>此指令會顯示每個多重路徑裝置的資訊。例如：</para>

<screen>
3600601607cf30e00184589a37a31d911
[size=127 GB][features="0"][hwhandler="1 emc"]
</screen>


<screen>
\_ round-robin 0 [active][first]
  \_ 1:0:1:2 sdav 66:240  [ready ][active]
  \_ 0:0:1:2 sdr  65:16   [ready ][active]
</screen>


<screen>
\_ round-robin 0 [enabled]
  \_ 1:0:0:2 sdag 66:0    [ready ][active]
  \_ 0:0:0:2 sdc  8:32    [ready ][active]
</screen>

   </step>
  </procedure>
  <para>它會針對每個裝置顯示裝置的 ID、大小、功能和硬體處理器。</para>
  <para>在探查裝置時，裝置的路徑會自動分到不同的優先程度群組。每次只有一個優先程度群組處於主動狀態。對於主動/主動組態，所有路徑都屬於同一個群組。對於主動/被動組態，被動路徑位於另外的優先程度群組中。 </para>
  <para>指令會顯示每個群組的下列資訊：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>用於平衡群組內 I/O 的排程規則，如輪替式</para>
   </listitem>
   <listitem>
    <para>該群組是處於主動、已停用還是已啟用狀態</para>
   </listitem>
   <listitem>
    <para>該群組是否為第一個 (優先程度最高) 群組</para>
   </listitem>
   <listitem>
    <para>群組內包含的路徑</para>
   </listitem>
  </itemizedlist>
  <para>指令會顯示每個路徑的下列資訊：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>實體位址 <replaceable>host:bus:target:lun</replaceable>，如 1:0:1:2</para>
   </listitem>
   <listitem>
    <para>裝置節點名稱，如 <filename>sda</filename></para>
   </listitem>
   <listitem>
    <para>Major:minor 號碼</para>
   </listitem>
   <listitem>
    <para>裝置的狀態</para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 id="mpioerrormgmt">
  <title>在出錯狀況下管理 I/O</title>
  <para>如果所有路徑同時失敗，您可能需要啟用 queue_if_no_path 設定多重路徑，以將 I/O 排入佇列。如果不啟用，I/O 便會在所有路徑都失敗時立即失敗。在驅動程式、HBA 或光纖出現假性錯誤，且這類錯誤會導致所有路徑遺失的特定情況下，應將 DM-MPIO 設定為將所有 I/O 排入佇列，且永不向上傳播錯誤。 </para>
  <para>在叢集中使用多重路徑裝置時，您可以選擇停用 queue_if_no_path。如此，系統就不會將 I/O 排入佇列，而是自動使路徑失效，並會將 I/O 錯誤升級，產生叢集資源容錯移轉。</para>
  <para>啟用 queue_if_no_path 會導致 I/O 在有路徑重新啟用之前無限期地排入佇列，因此請確定 <command>multipathd</command> 正在執行，且對您的情況有效。否則，在重新開機或手動返回到容錯移轉以取代佇列之前，I/O 可能會無限期地擱置於受影響的多重路徑裝置中。</para>
  <para>若要測試案例，請執行下列步驟：</para>
  <procedure id="b5c8xoe">
   <step id="b7jqv1b" performance="required">
    <para>在終端機主控台中，以 <systemitem>root</systemitem> 使用者身分登入。 </para>
   </step>
   <step id="b7jqw8e" performance="required">
    <para>輸入以下指令啟動裝置 I/O 的佇列功能而非容錯移轉：</para>

<screen>
dmsetup message <replaceable>device_ID</replaceable> 0 queue_if_no_path
</screen>

    <para>用裝置的 ID 取代 <replaceable>device_ID</replaceable>。0 值代表磁區，當不需要磁區資訊時使用。 </para>
    <para>例如，輸入︰</para>

<screen>
dmsetup message 3600601607cf30e00184589a37a31d911 0 queue_if_no_path
</screen>

   </step>
   <step id="b7jqwaz" performance="required">
    <para>輸入以下指令返回到裝置 I/O 的容錯移轉：</para>

<screen>
dmsetup message <replaceable>device_ID</replaceable> 0 fail_if_no_path
</screen>

    <para>此指令會立即使所有排入佇列的 I/O 失敗。</para>
    <para>用裝置的 ID 取代 <replaceable>device_ID</replaceable>。例如，輸入︰</para>

<screen>
dmsetup message 3600601607cf30e00184589a37a31d911 0 fail_if_no_path
</screen>

   </step>
  </procedure>
  <para>若要對所有路徑都失敗的情況設定佇列 I/O，請執行下列步驟：</para>
  <procedure id="b7jqzyt">
   <step id="b7jr0j0" performance="required">
    <para>在終端機主控台中，以 <systemitem>root</systemitem> 使用者身分登入。 </para>
   </step>
   <step id="b5c9aza" performance="required">
    <para>在文字編輯器中開啟 <filename>/etc/multipath.conf</filename> 檔案。</para>
   </step>
   <step id="b5c99rh" performance="required">
    <para>取消預設區段及其結束括號的註解，然後新增 <literal>default_features</literal> 設定，如下所示：</para>

<screen>
defaults {
  default_features "1 queue_if_no_path"
}
</screen>

   </step>
   <step id="bi0b03b" performance="required">
    <para>修改 <filename>/etc/multipath.conf</filename> 檔案後，必須執行 <command>mkinitrd</command> 在系統中重新建立 <filename>initrd</filename>，然後重新開機以使變更生效。</para>
   </step>
   <step id="b7jr4r4" performance="required">
    <para>當您準備好返回到裝置 I/O 的容錯移轉時，請輸入：</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 fail_if_no_path
</screen>

    <para>用裝置對應的別名或裝置 ID 取代 <replaceable>mapname</replaceable>。0 值代表磁區，當不需要磁區資訊時使用。 </para>
    <para>此指令會立即使所有排入佇列的 I/O 失敗，並將錯誤傳播到呼叫應用程式。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="mpiostall">
  <title>解決擱置的 I/O</title>
  <para>如果所有路徑同時失敗，且 I/O 雖已排入佇列卻被擱置時，請執行下列步驟：</para>
  <procedure id="b7jlq1g">
   <step id="b7jlq1h" performance="required">
    <para>在終端機主控台提示符處輸入以下指令：</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 fail_if_no_path
</screen>

    <para>用裝置的正確裝置 ID 或對應的別名取代 <literal><replaceable>mapname</replaceable></literal>。0 值代表磁區，當不需要磁區資訊時使用。 </para>
    <para>此指令會立即使所有排入佇列的 I/O 失敗，並將錯誤傳播到呼叫應用程式。 </para>
   </step>
   <step id="b7jlq74" performance="required">
    <para>在終端機主控台提示符處輸入以下指令重新啟動佇列：</para>

<screen>
dmsetup message <replaceable>mapname</replaceable> 0 queue_if_no_path
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bpjpirk">
  <title>MPIO 疑難排解</title>
  <para>本節說明 MPIO 的一些已知問題和可能的解決方案。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b11qkzgw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b122uxzr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b11qkzgx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b11qkzgw">
   <title>升級到多重路徑 0.4.9 後個別裝置的 PRIO 設定失敗</title>
   <para>適用於 LES  11 SP2 的多重路徑工具 0.4.9 會使用 <filename>/etc/multipath.conf</filename> 檔案之 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 區段中的 <literal>prio</literal> 設定。當關鍵字 <literal>prio</literal> 是為 <literal>multipaths{)</literal> 區段中的個別 <literal>multipath</literal> 定義而指定時，它會無訊息式地忽略該關鍵字。</para>
   <para>在適用於 SLES  11 SP1 的多重路徑工具 0.4.8 及更早版本中，允許 <literal>multipaths{)</literal> 區段中個別 <literal>multipath</literal> 定義中的 prio 設定覆寫 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 區段中的 <literal>prio</literal> 設定。</para>
  </sect2>
  <sect2 id="b122uxzr">
   <title>升級到 multipath-tools-0.4.9 後使用引數的 PRIO 設定失敗</title>
   <para>從 <filename>multipath-tools-0.4.8</filename> 升級到 <filename>multipath-tools-0.4.9</filename> 後，<filename>/etc/multipath.conf</filename> 檔案中的 <literal>prio</literal> 設定對於需要引數的優先程度排序器將會損壞。在 multipath-tools-0.4.9 中，<literal>prio</literal> 關鍵字用於指定優先程度排序器，<literal>prio_args</literal> 關鍵字則用於為需要引數的優先程度排序器指定引數。以前，優先程度排序器及其引數都在同一 <literal>prio</literal> 行上指定。</para>
   <para>例如，在 multipath-tools-0.4.8 中，下行用於指定優先程度排序器，並且在同一行中指定其引數。</para>

<screen>
prio "weightedpath hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"
</screen>

   <para role="intro">升級到 <command>multipath-tools-0.4.9</command> 後，該指令會導致錯誤。訊息類似下方所列：</para>

<screen>
&lt;Month day hh:mm:ss&gt; | Prioritizer 'weightedpath hbtl [1,3]:.:.+:.+ 260
[0,2]:.:.+:.+ 20' not found in /lib64/multipath
</screen>

   <para>若要解決此問題，請使用文字編輯器修改 <filename>/etc/multipath.conf</filename> 檔案中的 <literal>prio</literal> 行。建立兩行，在 <filename>prio</filename> 行上指定優先程度排序器，並在其下的 <filename>prio_args</filename> 行上指定優先程度排序器引數：</para>

<screen>
prio "weightedpath"
prio_args "hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"
</screen>

  </sect2>
  <sect2 id="b11qkzgx">
   <title>技術資訊文件</title>
   <para>如需有關在 SUSE Linux Enterprise Server 上對多重路徑 I/O 問題進行疑難排解的資訊，請參閱 Novell 支援知識庫中的下列技術資訊文件 (TID)：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=3231766"><citetitle>Troubleshooting SLES Multipathing (MPIO) Problems (TID 3231766︰SLES 多重路徑 (MPIO) 問題疑難排解)</citetitle></ulink></para>
    </listitem>
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=3029706"><citetitle>DM MPIO Device Blacklisting Not Honored in multipath.conf (TID 3029706︰multipath.conf 中未遵從 DM MPIO 裝置黑名單)</citetitle></ulink></para>
    </listitem>
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=3955167"><citetitle>Troubleshooting SCSI (LUN) Scanning Issues (TID 3955167︰SCSI (LUN) 掃描問題疑難排解)</citetitle></ulink></para>
    </listitem>
    <listitem>
     <para><ulink url="http://www.novell.com/support/kb/doc.php?id=7007498"><citetitle>Using LVM on Multipath (DM MPIO) Devices (在多重路徑 (DM MPIO) 裝置上使用 LVM)</citetitle></ulink></para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 id="mpionext">
  <title>還有什麼功能？</title>
  <para>若要使用軟體 RAID，請先建立 RAID 並進行設定，然後再在裝置中建立檔案系統。如需資訊，請參閱以下章節：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidyast" xrefstyle="ChapTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadm" xrefstyle="ChapTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>

<chapter id="raidyast" lang="zh-tw" xml:base="05_raid.xml">
 <title>軟體 RAID 組態</title>
 <para>RAID (獨立磁碟容錯陣列，Redundant Array of Independent Disks) 的用途是將數個硬碟分割區組合成一個大型「虛擬」硬碟，以達最佳化效能、資料安全性或是兩者兼具的功能。大部分 RAID 控制器使用 SCSI 通訊協定，因為它可利用比 IDE 通訊協定更有效的方式處理較大量的硬碟，並且更適合指令的平行處理。有部分的 RAID 控制器支援 IDE 或 SATA 硬碟。軟體 RAID 可提供 RAID 系統的優點，卻不需要硬體 RAID 控制器的額外成本。但是這需要一些 CPU 時間，而且有一些記憶體需求，使它不適用於極高效能的電腦。 </para>
 <important>
  <para>OCFS2 等叢集檔案系統不支援軟體 RAID，因為 RAID 不支援同時啟動功能。如果要讓 RAID 適用於 OCFS2，則 RAID 需由儲存子系統處理。</para>
 </important>
 <para>SUSE Linux Enterprise 可讓您選擇將幾個硬碟組合為一個軟 RAID 系統。RAID 一詞是表示將數個硬碟結合成 RAID 系統的一些策略，每個都有不同的目標、優點及特色。這些變化通常稱為 <emphasis>RAID 層級</emphasis>。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi70wwi" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-yast2-system-raid-yast" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchysg" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchysh" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi70wwi">
  <title>瞭解 RAID 層級</title>
  <para>本節說明通用 RAID 層級 0、1、2、3、4、5 以及巢狀 RAID 層級。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bgchysa" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysb" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchyse" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bgchysf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bgchysa">
   <title>RAID 0</title>
   <para>此層級將每個檔案的區塊分散於多個磁碟，以提升您的資料存取效能。實際上，它不是真的 RAID，因為它不提供資料備份，但是此類型系統的名稱 <emphasis>RAID 0</emphasis> 已經成為標準。使用 RAID 0，就可將兩個以上的磁碟聚集在一起。效能非常好，但是如果其中一個硬碟錯誤，RAID 系統便會損毀而且資料會遺失。 </para>
  </sect2>
  <sect2 id="bgchysb">
   <title>RAID 1</title>
   <para>此層級對資料提供足夠的安全性，因為資料是以 1:1 複製到另一個硬碟。這就是所謂的<emphasis>硬碟鏡像</emphasis>。如果其中一個磁碟損毀，另一個鏡像複製磁碟上有其內容的複本。如果所有其他磁碟都受到損害，但有一個可用，就不會危害到資料。但是，如果未偵測到損毀的情況，則損毀的資料也可能會鏡射到正確的磁碟，因而造成資料損毀。在複製過程中的寫入效能比使用單一磁碟存取時稍差一些 (慢了百分之十到二十)，但是讀取存取卻較任何一般實體硬碟快得多，因為資料已複製，因此可以平行掃描。一般而言，可以說 RAID 1 比單一磁碟的讀取異動率快了將近兩倍，而且與單一磁碟的寫入異動率幾乎相同。 </para>
  </sect2>
  <sect2 id="bgchysc">
   <title>RAID 2 與 RAID 3</title>
   <para>這些都不是一般的 RAID 實作。「層級 2」在是位元層級分割資料，而不是在區塊層級。「層級 3」提供具有專用同位磁碟的位元層級分割，但是無法同時服務多個要求。這兩個層級都很少使用。 </para>
  </sect2>
  <sect2 id="bgchysd">
   <title>RAID 4</title>
   <para>「層級 4」提供與「層級 0」相同的區塊層級分割，並且結合專用的同位磁碟。在資料磁碟失敗時，會使用同位資料建立替代的磁碟。不過，同位磁碟可能造成寫入存取的瓶頸。儘管如此，有時還是會使用「層級 4」。 </para>
  </sect2>
  <sect2 id="bgchyse">
   <title>RAID 5</title>
   <para>RAID 5 是在「層級 0」與「層級 1」之間效能和備用方面最佳的折衷方法。硬碟空間等於使用的磁碟數減一。使用 RAID 0 可將資料分布至各個硬碟。在其中一個分割區上建立的<emphasis>同位區塊</emphasis>是基於安全性考量。它們以 XOR 互相連結，使得系統失敗時，能夠藉由對應的同位區塊重新建構內容。使用 RAID 5，不會有一個以上的硬碟同時失敗。如果一個硬碟失敗，必須立即更換以避免資料遺失的風險。 </para>
  </sect2>
  <sect2 id="bgchysf">
   <title>巢狀 RAID 層級</title>
   <para>已經開發一些其他的 RAID 層級，如 RAIDn、RAID 10、RAID 0+1、RAID 30 和 RAID 50 等。有些是硬體廠商所建立的專用實作。這些層級並不是很普遍，因此在這裡不做說明。 </para>
  </sect2>
 </sect1>
 <sect1 id="sec-yast2-system-raid-yast">
  <title>使用 YaST 進行軟體 RAID 組態</title>
  <para>YaST 軟體 RAID 組態可以透過 YaST 進階磁碟分割程式完成。這個磁碟分割工具可讓您編輯和刪除現有磁碟分割，以及建立應該與軟體 RAID 一起使用的新磁碟分割。 </para>
  <para>您可以按一下<menuchoice><guimenu>建立</guimenu> <guimenu>不格式化</guimenu></menuchoice>，然後選取<guimenu>0xFD Linux RAID</guimenu>做為分割區識別碼，來建立 RAID 分割區。對於 RAID 0 和 RAID 1，至少需要兩個分割區。對於 RAID 1，通常兩個剛好，無需更多。如果使用 RAID 5，至少需要三個分割區。建議您僅使用大小相同的分割區，因為每個節區只能提供相同容量的空間做為最小的分割區。RAID 分割區應該儲存在不同的硬碟上，以減少其中一個損壞時 (RAID 1 和 5) 遺失資料的風險，並最佳化 RAID 0 的效能。在建立 RAID 使用的所有分割區後，按一下<menuchoice><guimenu>RAID</guimenu><guimenu>建立 RAID</guimenu></menuchoice>以啟動 RAID 組態。 </para>
  <para>在精靈的下一頁中，選擇 RAID 層級 0、1 或 5，然後按<guimenu>下一步</guimenu>。以下對話方塊 (請參閱<xref linkend="fig-yast2-raid2" xrefstyle="FigureXRef"/>) 列出類型為<guimenu>Linux LVM</guimenu>或<guimenu>Linux Native</guimenu>的所有分割區。不會顯示交換和 DOS 分割區。如果已經指定分割區給 RAID 磁碟區，RAID 裝置的名稱 (例如 <filename>/dev/md0</filename>) 就會顯示在清單中。未指定的分割區以 <quote>--</quote> 表示。 </para>
  <figure pgwide="0" id="fig-yast2-raid2">
   <title>RAID 分割區</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_raid2_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>若要將之前未指定的分割區新增給所選的 RAID 磁碟區，請先選取分割區，然後按一下<guimenu>新增</guimenu>。此時，RAID 裝置的名稱會顯示於所選分割區的旁邊。指定保留給 RAID 的所有分割區。否則，仍然不會使用分割區上的空間。在指定所有的分割區後，按一下 <guimenu>下一步</guimenu> 以進入設定對話方塊，在此您可以微調效能 (請參閱 <xref linkend="fig-yast2-raid3" xrefstyle="FigureXRef"/>。) </para>
  <figure pgwide="0" id="fig-yast2-raid3">
   <title>檔案系統設定</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="yast2_raid3_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>使用傳統磁碟分割時，會設定要使用的檔案系統、加密以及 RAID 磁碟區的掛接點。在按一下<guimenu>完成</guimenu>以完成組態之後，請參閱 <filename>/dev/md0</filename> 裝置及其他在進階磁碟分割程式中以 <emphasis>RAID</emphasis> 表示的裝置。 </para>
 </sect1>
 <sect1 id="bgchysg">
  <title>軟體 RAID 疑難排解</title>
  <para>檢查 <filename>/proc/mdstat</filename> 檔案以確定 RAID 分割區是否已損毀。當系統失敗時，請關閉 Linux 系統並使用以相同方式磁碟分割的新硬碟來更換損壞的硬碟。然後重新啟動系統，並輸入 <command>mdadm /dev/mdX --add /dev/sdX</command> 指令。使用特定的裝置識別碼取代 <literal>X</literal>。如此可將硬碟自動整合到 RAID 系統並完整地重新建構。 </para>
  <para>雖然您可以在重建期間存取所有資料，但是在完全重建 RAID 之前，可能會遇到一些效能問題。 </para>
 </sect1><?dbfo-need height="10em"?>


 <sect1 id="bgchysh">
  <title>更多資訊</title>
  <para>可在下列網址的 HOWTO 中找到組態指南及軟體 RAID 的詳細資訊： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="https://raid.wiki.kernel.org/index.php/Linux_Raid"><citetitle>Linux RAID wiki</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><filename>/usr/share/doc/packages/mdadm/Software-RAID.HOWTO.html</filename> 檔案中的<citetitle>The Software RAID HOWTO</citetitle> (軟體 RAID HOWTO)</para>
   </listitem>
  </itemizedlist>
  <para>也有 Linux RAID 郵寄清單可供參考，如 <ulink url="http://marc.info/?l=linux-raid"><citetitle/>linux-raid</ulink>。</para>
 </sect1>
</chapter>

<chapter id="raidroot" lang="zh-tw" xml:base="05_raid_root.xml">
 <title>設定根分割區的軟體 RAID1</title>
 <para>在 SUSE Linux Enterprise Server 11 中，裝置對應程式 RAID 工具已整合到 YaST 磁碟分割程式中。您可以在安裝時使用磁碟分割程式，為包含根 (<filename>/</filename>) 分割區的系統裝置建立一個軟體 RAID1。必須在獨立裝置上建立 <filename>/boot</filename> 分割區，而不是在 MD RAID1 上。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi9d2lj" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9dppp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9dnnt" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi9d2lj">
  <title>將軟體 RAID1 裝置用於根分割區的先決條件</title>
  <para>確保您的組態符合下列要求：</para>
  <itemizedlist mark="box" spacing="normal">
   <listitem>
    <para>您需要兩個硬碟來建立 RAID1 鏡像裝置。幾個硬碟的大小應相似。RAID 假設為較小磁碟機的大小。區塊儲存裝置可以是本地 (機器中或直接連接到機器上)、光纖通道儲存子系統或 iSCSI 儲存子系統的任意組合。 </para>
   </listitem>
   <listitem>
    <para>您需要第三個裝置用於 <filename>/boot</filename> 分割區。開機裝置應該是一個本地裝置。</para>
   </listitem>
   <listitem>
    <para>如果您使用的是硬體 RAID 裝置，請不要嘗試在其上執行軟體 RAID。</para>
   </listitem>
   <listitem>
    <para>如果您使用的是 iSCSI 目標裝置，必須先啟用 iSCSI 啟動器支援，然後再建立 RAID 裝置。</para>
   </listitem>
   <listitem>
    <para>如果儲存子系統在伺服器與要用於軟體 RAID 的裝置 (直接連接的本地裝置、光纖通道裝置或 iSCSI 裝置) 之間提供了多重 I/O 路徑，您必須先啟用多重路徑支援，然後才能建立 RAID 裝置。</para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 id="bi9dppp">
  <title>安裝時啟用 iSCSI 啟動器支援</title>
  <para>如果要將某些 iSCSI 目標裝置用於根 (/) 分割區，必須先啟用 iSCSI 啟動器軟體使這些裝置可用，然後才能建立軟體 RAID1 裝置。</para>
  <procedure id="bi9dppq">
   <step id="bi9dppr" performance="required">
    <para>繼續進行 SUSE Linux Enterprise 11 的 YaST 安裝，直到進入「安裝設定」頁面。</para>
   </step>
   <step id="bi9dpps" performance="required">
    <para>按一下<guimenu>磁碟分割</guimenu>開啟「準備硬碟」頁面，按一下<guimenu>自定分割區 (進階)</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="bi9dppt" performance="required">
    <para>在「進階磁碟分割程式」頁面中，展開<guimenu>系統檢視</guimenu>面板中的<guimenu>硬碟</guimenu>，以檢視預設建議。</para>
   </step>
   <step id="bi9dppu" performance="required">
    <para>在<guimenu>硬碟</guimenu>頁面中，選取<guimenu>設定</guimenu><guimenu>設定 iSCSI</guimenu>，然後在提示您繼續啟始化 iSCSI 啟動器組態時按一下<guimenu>繼續</guimenu>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bi9dnnt">
  <title>安裝時啟用多重路徑 I/O 支援</title>
  <para>如果要將裝置的多重 I/O 路徑用於根 (/) 分割區，必須先啟用多重路徑支援，然後才能建立軟體 RAID1 裝置。</para>
  <procedure id="bi9dnnu">
   <step id="bi9dnnv" performance="required">
    <para>繼續進行 SUSE Linux Enterprise 11 的 YaST 安裝，直到進入「安裝設定」頁面。</para>
   </step>
   <step id="bi9dnnw" performance="required">
    <para>按一下<guimenu>磁碟分割</guimenu>開啟「準備硬碟」頁面，按一下<guimenu>自定分割區 (進階)</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="bi9dnnx" performance="required">
    <para>在「進階磁碟分割程式」頁面中，展開<guimenu>系統檢視</guimenu>面板中的<guimenu>硬碟</guimenu>，以檢視預設建議。</para>
   </step>
   <step id="bi9dnny" performance="required">
    <para>在<guimenu>硬碟</guimenu>頁面中，選取<guimenu>設定</guimenu><guimenu>設定多重路徑</guimenu>，然後在提示您啟動多重路徑時按一下<guimenu>是</guimenu>。 </para>
    <para>這會重新掃描裝置並解析多重路徑，以便每台裝置在硬碟清單中只列出一次。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bi9d19d">
  <title>建立根 (/) 分割區的軟體 RAID1 裝置</title>
  <procedure id="bi9d207">
   <step id="bi9d208" performance="required">
    <para>繼續進行 SUSE Linux Enterprise 11 的 YaST 安裝，直到進入「安裝設定」頁面。</para>
   </step>
   <step id="bi9dfe6" performance="required">
    <para>按一下<guimenu>磁碟分割</guimenu>開啟「準備硬碟」頁面，按一下<guimenu>自定分割區 (進階)</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
   </step>
   <step id="bi9dgrg" performance="required">
    <para>在「進階磁碟分割程式」頁面中，展開<guimenu>系統檢視</guimenu>面板中的<guimenu>硬碟</guimenu>以檢視預設建議，選取建議的分割區，然後按一下<guimenu>刪除</guimenu>。</para>
   </step>
   <step id="b13za1ue" performance="required">
    <para>建立 <filename>/boot</filename> 分割區。</para>
    <substeps performance="required">
     <step id="b13za3rl" performance="required">
      <para>在「進階磁碟分割程式」頁面的<guimenu>硬碟</guimenu>下，選取要用於 /boot 分割區的裝置，然後在<guimenu>硬碟分割區</guimenu>索引標籤中按一下<guimenu>新增</guimenu>。</para>
     </step>
     <step id="b13za3rm" performance="required">
      <para>在<guimenu>新分割區類型</guimenu>下，選取<guimenu>主分割區</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="b13za3rn" performance="required">
      <para>在<guimenu>新分割區大小</guimenu>下，指定要使用的大小，然後按<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="b13za3ro" performance="required">
      <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>格式化分割區</guimenu>，然後從下拉式選單中選取偏好的檔案系統類型 (例如 Ext2 或 Ext3)。</para>
     </step>
     <step id="b13za3rp" performance="required">
      <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>掛接分割區</guimenu>，然後從下拉式選單中選取<guimenu>/boot</guimenu>。</para>
     </step>
     <step id="b13za3rq" performance="required">
      <para>按一下<guimenu>完成</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="bi9drnn" performance="required">
    <para>建立交換分割區。</para>
    <substeps performance="required">
     <step id="bi9dq0p" performance="required">
      <para>在「進階磁碟分割程式」頁面的<guimenu>硬碟</guimenu>下，選取要用於交換分割區的裝置，然後在<guimenu>硬碟分割區</guimenu>索引標籤中按一下<guimenu>新增</guimenu>。</para>
     </step>
     <step id="bi9drt8" performance="required">
      <para>在<guimenu>新分割區類型</guimenu>下，選取<guimenu>主分割區</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9drz9" performance="required">
      <para>在<guimenu>新分割區大小</guimenu>下，指定要使用的大小，然後按<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9dt2p" performance="required">
      <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>格式化分割區</guimenu>，然後從下拉式清單中選取<guimenu>交換</guimenu>。</para>
     </step>
     <step id="bi9dtld" performance="required">
      <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>掛接分割區</guimenu>，然後從下拉式清單中選取<guimenu>交換</guimenu>。</para>
     </step>
     <step id="bi9du9n" performance="required">
      <para>按一下<guimenu>完成</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="bi9dv06" performance="required">
    <para>為要用於軟體 RAID1 的每個裝置設定 <guimenu>0xFD Linux RAID</guimenu> 格式。</para>
    <substeps performance="required">
     <step id="bi9dx99" performance="required">
      <para>在「進階磁碟分割程式」頁面的<guimenu>硬碟</guimenu>下，選取要用於 RAID1 的裝置，然後在<guimenu>硬碟分割區</guimenu>索引標籤中按一下<guimenu>新增</guimenu>。</para>
     </step>
     <step id="bi9dx9a" performance="required">
      <para>在<guimenu>新分割區類型</guimenu>下，選取<guimenu>主分割區</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9dx9b" performance="required">
      <para>在<guimenu>新分割區大小</guimenu>下，指定使用最大大小，然後按<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9dx9c" performance="required">
      <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>不格式化分割區</guimenu>，然後從下拉式清單中選取<guimenu>0xFD Linux RAID</guimenu>。</para>
     </step>
     <step id="bi9dx9d" performance="required">
      <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>不掛接分割區</guimenu>。</para>
     </step>
     <step id="bi9dx9e" performance="required">
      <para>按一下<guimenu>完成</guimenu>。</para>
     </step>
     <step id="bi9dy2u" performance="required">
      <para>對要用於軟體 RAID 的每台裝置重複<xref linkend="bi9dx99" xrefstyle="StepXRef"/> 到<xref linkend="bi9dx9e" xrefstyle="StepXRef"/>1.</para>
     </step>
    </substeps>
   </step>
   <step id="bi9e4kt" performance="required">
    <para>建立 RAID 裝置。</para>
    <substeps performance="required">
     <step id="bi9djfy" performance="required">
      <para>在<guimenu>系統檢視</guimenu>面板中，選取<guimenu>RAID</guimenu>，然後在「RAID」頁面中按一下<guimenu>新增 RAID</guimenu>。</para>
      <para><guimenu>可用的裝置</guimenu>中會列出您在<xref linkend="bi9dv06" xrefstyle="StepXRef"/> 中準備的裝置。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install_a.png" width="213pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="bi9dzpu" performance="required">
      <para>在<guimenu>RAID 類型</guimenu>下，選取<guimenu>RAID 1 (鏡像)</guimenu>。</para>
     </step>
     <step id="bi9e26m" performance="required">
      <para>在<guimenu>可用的裝置</guimenu>面板中，選取要用於 RAID 的裝置，然後按一下<guimenu>新增</guimenu>將這些裝置移至<guimenu>選定裝置</guimenu>面板。</para>
      <para>為 RAID1 指定兩個或更多個裝置。</para>
      <para>若要繼續此範例，請為 RAID 1 選取兩台裝置。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install2_a.png" width="218pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="bi9e393" performance="required">
      <para>按<guimenu>下一步</guimenu>。</para>
     </step>
     <step id="bi9e3nr" performance="required">
      <para>在<guimenu>RAID 選項</guimenu>下的下拉式清單中選取區塊大小。</para>
      <para> RAID 1 (鏡像) 的預設區塊大小為 4 KB。</para>
      <para>可用的區塊大小有：4 KB、8 KB、16 KB、32 KB、64 KB、128 KB、256 KB、512 KB、1 MB、2 MB 或 4 MB。</para>
     </step>
     <step id="bi9e530" performance="required">
      <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>格式化分割區</guimenu>，然後從<guimenu>檔案系統</guimenu>下拉式清單中選取檔案系統類型 (例如 Ext3)。</para>
     </step>
     <step id="bi9e97s" performance="required">
      <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>掛接分割區</guimenu>，然後從<guimenu>掛接點</guimenu>下拉式清單中選取 <filename>/</filename>。</para>
     </step>
     <step id="bi9e9uc" performance="required">
      <para>按一下<guimenu>完成</guimenu>。</para>
      <para>軟體 RAID 裝置便會受裝置對應程式的管理，並會在 <filename>/dev/md0</filename> 路徑下建立一台裝置。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="raid_yast_install3_a.png" width="213pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
    </substeps>
   </step>
   <step id="bi9ec68" performance="required">
    <para>在「進階磁碟分割程式」頁面中按一下<guimenu>接受</guimenu>。</para>
    <para>新的建議便會出現在「安裝設定」頁面的<guimenu>磁碟分割</guimenu>下。</para>
    <para>例如如下設定 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="raid_yast_install4_a.png" width="129pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bi9eh7a" performance="required">
    <para>繼續安裝。</para>
    <para>每次將伺服器重新開機時，裝置對應程式都會在開機時啟動，以便讓系統能夠自動辨識軟體 RAID，並啟動根 (/) 分割區上的作業系統。</para>
   </step>
  </procedure>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,yes,,80" id="raidmdadm" lang="zh-tw" revision="01/23/09" xml:base="05_raid10.xml">
 <title>使用 mdadm 管理軟體 RAID 6 和 10</title>
 <para>本章說明如何使用多個裝置管理 (<command>mdadm(8)</command>) 工具來建立軟體 RAID 6 和 10 裝置。您也可使用 <filename>mdadm</filename> 來建立 RAID 0、1、4 和 5。<command>mdadm</command> 工具可提供舊版程式 <command>mdtools</command> 與 <command>raidtools</command> 的功能。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="raidmdadmr6" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmr10nest" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmr10cpx" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="raidmdadmdegraded" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="raidmdadmr6">
  <title>建立 RAID 6</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr6ovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr6create" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="raidmdadmr6ovw">
   <title>瞭解 RAID 6</title>
   <para>RAID 6 從本質上說是 RAID 5 的延伸，它透過使用另一獨立的分散式同位規劃 (雙同位) 允許額外容錯。即使在資料復原程序過程中兩個硬碟機都發生故障，系統也能繼續操作，且不遺失資料。</para>
   <para>在多個磁碟機同時發生故障的情況下，RAID 6 可提供極高的資料容錯能力。它能夠處理兩個裝置的遺失，不會遺失資料。相應地，它需要 N+2 個磁碟機來儲存 N 個磁碟機的重要資料。至少需要 4 個裝置。</para>
   <para>但是，比較處於正常模式和有一個硬碟機發生故障模式下的 RAID 5，RAID 6 的效能略低。處於雙磁碟機故障模式下時，其速度會變得很慢。 </para>
   <table id="b8i9zn7" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>比較 RAID 5 與 RAID 6</title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row id="b8ihegi">
       <entry>
        <para>特性</para>
       </entry>
       <entry>
        <para>RAID 5</para>
       </entry>
       <entry>
        <para>RAID 6</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8ihegj">
       <entry>
        <para>裝置數量</para>
       </entry>
       <entry>
        <para>N+1，最小值為 3</para>
       </entry>
       <entry>
        <para>N+2，最小值為 4</para>
       </entry>
      </row>
      <row id="b8ihegk">
       <entry>
        <para>同位元</para>
       </entry>
       <entry>
        <para>分散式，單一</para>
       </entry>
       <entry>
        <para>分散式，兩個</para>
       </entry>
      </row>
      <row id="b8ihegl">
       <entry>
        <para>效能</para>
       </entry>
       <entry>
        <para>對寫入與重建有中等程度的影響</para>
       </entry>
       <entry>
        <para>對連續寫入的影響比 RAID 5 要大</para>
       </entry>
      </row>
      <row id="b8ihegm">
       <entry>
        <para>容錯</para>
       </entry>
       <entry>
        <para>一個元件裝置發生故障</para>
       </entry>
       <entry>
        <para>兩個元件裝置發生故障</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="raidmdadmr6create">
   <title>建立 RAID 6</title>
   <para>此節中的程序可建立具有四個裝置 (<filename>/dev/sda1</filename>、<filename>/dev/sdb1</filename>、<filename>/dev/sdc1</filename> 和 <filename>/dev/sdd1</filename>) 的 RAID  6 裝置 <filename>/dev/md0</filename>。請確保修改此程序以使用實際裝置節點。</para>
   <procedure id="b8ihegn">
    <step id="b8ihego" performance="required">
     <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
    </step>
    <step id="b8ihegp" performance="required">
     <para>建立 RAID 6 裝置。在指令提示符下，輸入 </para>

<screen>
mdadm --create /dev/md0 --run --level=raid6 --chunk=128 --raid-devices=4 /dev/sdb1 /dev/sdc1 /dev/sdc1 /dev/sdd1
</screen>

     <para>預設區塊大小為 64 KB。</para>
    </step>
    <step id="b8ihegq" performance="required">
     <para>在 RAID 6 裝置 <filename>/dev/md0</filename> 上建立檔案系統，如 Reiser 檔案系統 (reiserfs)。例如，在指令提示符下輸入</para>

<screen>
mkfs.reiserfs /dev/md0
</screen>

     <para>如果要使用其他檔案系統，請修改指令。</para>
    </step>
    <step id="b8ihegr" performance="required">
     <para>編輯 <filename>/etc/mdadm.conf</filename> 檔案，以新增元件裝置和 RAID 裝置 <filename>/dev/md0</filename> 的項目。</para>
    </step>
    <step id="b8ihegs" performance="required">
     <para>編輯 <filename>/etc/fstab</filename> 檔案以新增 RAID 6 裝置 <filename>/dev/md0</filename> 的項目。 </para>
    </step>
    <step id="b8ihegt" performance="required">
     <para>重新載入伺服器。</para>
     <para>RAID 6 裝置已掛接到 <filename>/local</filename>。</para>
    </step>
    <step id="b8ihegu" performance="required">
     <para>(可選) 新增熱備用以用於 RAID 陣列。例如，在指令提示符下輸入：</para>

<screen>
mdadm /dev/md0 -a /dev/sde1
</screen>

    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="raidmdadmr10nest">
  <title>使用 mdadm 建立巢狀 RAID 10 裝置</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr10nestovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10nest1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10nest2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="raidmdadmr10nestovw">
   <title>瞭解巢狀 RAID 裝置</title>
   <para>巢狀 RAID 裝置由 RAID 陣列構成，它使用其他 RAID 陣列取代實體磁碟做為其基本元素。此組態的目標是提高 RAID 的效能和容錯能力。 </para>
   <para>Linux 支援巢狀化 RAID 1 (鏡像) 與 RAID 0 (分割) 陣列。通常，此組合又稱為 RAID 10。為了辨識巢狀的順序，此文件使用下列術語︰</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <formalpara id="b8ghlom">
      <title>RAID 1+0：</title>
      <para>首先建立 RAID 1 (鏡像) 陣列，然後再結合以形成 RAID 0 (分割) 陣列。 </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara id="b8gzg7q">
      <title>RAID 0+1：</title>
      <para>首先建立 RAID 0 (分割) 陣列，然後再結合以形成 RAID 1 (鏡像) 陣列。 </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <para>下表描述 RAID 10 巢狀化為 1+0 與 0+1 的優點和缺點。假設使用的儲存物件位於不同的磁碟，且每個物件都有專屬的 I/O 功能。</para>
   <table id="b57a7uv" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>巢狀 RAID 層級</title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="1191*"/>
    <colspec colnum="2" colname="2" colwidth="1905*"/>
    <colspec colnum="3" colname="3" colwidth="6906*"/>
     <thead>
      <row id="b57a7uw">
       <entry>
        <para>RAID 層級</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
       <entry>
        <para>效能與容錯</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b57a7uz">
       <entry>
        <para>10 (1+0)</para>
       </entry>
       <entry>
        <para>使用 RAID 1 (鏡像) 陣列建立 RAID 0 (分割)</para>
       </entry>
       <entry>
        <para>RAID 1+0 提供高層級的 I/O 效能、資料備援及磁碟容錯。因為 RAID 0 中的每個成員裝置都是個別鏡像的，所以只要發生故障的磁碟處於不同的鏡像複製，這些故障磁碟都可進行容錯，且保持資料可用。 </para>
        <para>可以選擇性為每個基礎鏡像複製陣列設定備用，或者為服務所有鏡像複製的備用群組設定所用備用。 </para>
       </entry>
      </row>
      <row id="b57a7uy">
       <entry>
        <para>10 (0+1)</para>
       </entry>
       <entry>
        <para>使用 RAID 0 (分割) 陣列建立 RAID 1 (鏡像) </para>
       </entry>
       <entry>
        <para>RAID 0+1 提供高層級的 I/O 效能和資料備援，但容錯能力略低於 RAID 1+0。如果同側鏡像複製中的多個磁碟發生故障，則另一側的鏡像複製仍可用。但是，如果兩側鏡像複製中的磁碟同時發生故障，則會遺失所有資料。</para>
        <para>此解決方案的磁碟容錯能力低於 1+0 解決方案，但如果要執行維護操作或維護其他位置的鏡像複製，則可使鏡像複製的一側完全處於離線狀態，此時仍可擁有儲存裝置的完整功能。同樣地，如果兩個位置之間斷開連接，則每個位置都可獨立進行操作。但如果分割經過鏡像處理的區段，則上述說法不正確，因為鏡像複製的管理處於較低層級。 </para>
        <para>如果裝置發生故障，則位於那側的鏡像複製將失敗，因為 RAID 1 不具容錯能力。建立新 RAID 0 以取代發生故障的那一側，然後重新同步鏡像複製。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="raidmdadmr10nest1">
   <title>使用 mdadm 建立巢狀 RAID 10 (1+0)</title>
   <para>建立巢狀 RAID 1+0 的方法是︰建立兩個或更多 RAID 1 (鏡像) 裝置，然後將其做為元件裝置用於 RAID 0。</para>
   <important>
    <para>如果需要管理與裝置的多個連接，您必須在設定 RAID 裝置之前設定多重路徑 I/O。如需更多資訊，請參閱<xref linkend="multipathing" xrefstyle="ChapTitleOnPage"/>。</para>
   </important>
   <para>此節的程序使用下表顯示的裝置名稱。請確保將裝置名稱修改為自己裝置的名稱。</para>
   <table id="b6670cx" role="1" frame="topbot" rowsep="0" pgwide="0" width="100%">
    <title>經由巢狀化建立 RAID 10 (1+0) 的案例 </title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row id="b6670cy">
       <entry>
        <para>Raw 裝置</para>
       </entry>
       <entry>
        <para>RAID 1 (鏡像)</para>
       </entry>
       <entry>
        <para>RAID 1+0 (等量分割的鏡像複製)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8o7og9">
       <entry>
        <simplelist>
         <member><filename>/dev/sdb1</filename></member> <member><filename>/dev/sdc1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry morerows="1">
        <para/>
        <para><filename>/dev/md2</filename></para>
       </entry>
      </row>
      <row id="b8o7ogb">
       <entry>
        <simplelist>
         <member><filename>/dev/sdd1</filename></member> <member><filename>/dev/sde1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure id="b6670d3">
    <step id="b6670d4" performance="required">
     <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
    </step>
    <step id="b6670d5" performance="required">
     <para>建立兩個軟體 RAID 1 裝置，每個 RAID 1 裝置使用兩個不同裝置。在指令提示符下，輸入下列兩個指令︰</para>

<screen>
mdadm --create /dev/md0 --run --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1
</screen>


<screen>
mdadm --create /dev/md1 --run --level=1 --raid-devices=2 /dev/sdd1 /dev/sde1
</screen>

    </step>
    <step id="b6670d6" performance="required">
     <para>建立巢狀 RAID 1+0 裝置。在指令提示符下，使用您在<xref linkend="b6670d5" xrefstyle="StepXRef"/> 建立的軟體 RAID 1 裝置輸入以下指令︰</para>

<screen>
mdadm --create /dev/md2 --run --level=0 --chunk=64 --raid-devices=2 /dev/md0 /dev/md1
</screen>

     <para>預設區塊大小為 64 KB。 </para>
    </step>
    <step id="b6670d7" performance="required">
     <para>在 RAID 1+0 裝置 <filename>/dev/md2</filename> 上建立檔案系統，如 Reiser 檔案系統 (reiserfs)。例如，在指令提示符下輸入</para>

<screen>
mkfs.reiserfs /dev/md2
</screen>

     <para>如果要使用其他檔案系統，請修改指令。</para>
    </step>
    <step id="b6670d8" performance="required">
     <para>編輯 <filename>/etc/mdadm.conf</filename> 檔案，以新增元件裝置和 RAID 裝置 <filename>/dev/md2</filename> 的項目。</para>
    </step>
    <step id="b6670d9" performance="required">
     <para>編輯 <filename>/etc/fstab</filename> 檔案以新增 RAID 1+0 裝置 <filename>/dev/md2</filename> 的項目。 </para>
    </step>
    <step id="b6670da" performance="required">
     <para>重新載入伺服器。</para>
     <para>RAID 1+0 裝置已掛接到 <filename>/local</filename>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="raidmdadmr10nest2">
   <title>使用 mdadm 建立巢狀 RAID 10 (0+1)</title>
   <para>建立巢狀 RAID 0+1 的方法是︰建立兩到四個 RAID 0 (分割) 裝置，然後將其進行鏡像處理並做為元件裝置用於 RAID 1。 </para>
   <important>
    <para>如果需要管理與裝置的多個連接，您必須在設定 RAID 裝置之前設定多重路徑 I/O。如需更多資訊，請參閱<xref linkend="multipathing" xrefstyle="ChapTitleOnPage"/>。</para>
   </important>
   <para>在這一組態中，因為 RAID 0 無法容錯裝置遺失，所以無法為基礎 RAID 0 裝置指定備用裝置。如果鏡像複製某側的裝置發生故障，則必須建立取代 RAID 0 裝置，然後將其新增至鏡像複製。 </para>
   <para>此節的程序使用下表顯示的裝置名稱。請確保將裝置名稱修改為自己裝置的名稱。</para>
   <table id="b8gzg7s" role="1" frame="topbot" rowsep="0" pgwide="0" width="100%">
    <title>經由巢狀化建立 RAID 10 (0+1) 的案例 </title>
    <tgroup cols="3">
    <colspec colnum="1" colname="1" colwidth="3334*"/>
    <colspec colnum="2" colname="2" colwidth="3334*"/>
    <colspec colnum="3" colname="3" colwidth="3334*"/>
     <thead>
      <row id="b8gzg7t">
       <entry>
        <para>Raw 裝置</para>
       </entry>
       <entry>
        <para>RAID 0 (分割)</para>
       </entry>
       <entry>
        <para>RAID 0+1 (鏡像複製的等量分割)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bi71dhe">
       <entry>
        <simplelist>
         <member><filename>/dev/sdb1</filename></member> <member><filename>/dev/sdc1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry morerows="1">
        <para/>
        <para><filename>/dev/md2</filename></para>
       </entry>
      </row>
      <row id="bi71dhf">
       <entry>
        <simplelist>
         <member><filename>/dev/sdd1</filename></member> <member><filename>/dev/sde1</filename></member>
        </simplelist>
       </entry>
       <entry>
        <para><filename>/dev/md1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure id="b8gzg7y">
    <step id="b8gzg7z" performance="required">
     <para>開啟終端機主控台，然後以 root 使用者或同等身分登入。</para>
    </step>
    <step id="b8gzg80" performance="required">
     <para>建立兩個軟體 RAID 0 裝置，每個 RAID 0 裝置使用兩個不同裝置。在指令提示符下，輸入下列兩個指令︰</para>

<screen>
mdadm --create /dev/md0 --run --level=0 --chunk=64 --raid-devices=2 /dev/sdb1 /dev/sdc1
</screen>


<screen>
mdadm --create /dev/md1 --run --level=0 --chunk=64 --raid-devices=2 /dev/sdd1 /dev/sde1
</screen>

     <para>預設區塊大小為 64 KB。</para>
    </step>
    <step id="b8gzg81" performance="required">
     <para>建立巢狀 RAID 0+1 裝置。在指令提示符下，使用您在<xref linkend="b8gzg80" xrefstyle="StepXRef"/> 建立的軟體 RAID 0 裝置輸入以下指令︰</para>

<screen>
mdadm --create /dev/md2 --run --level=1 --raid-devices=2 /dev/md0 /dev/md1
</screen>

    </step>
    <step id="b8gzg82" performance="required">
     <para>在 RAID 0+1 裝置 <filename>/dev/md2</filename> 上建立檔案系統，如 Reiser 檔案系統 (reiserfs)。例如，在指令提示符下輸入</para>

<screen>
mkfs.reiserfs /dev/md2
</screen>

     <para>如果要使用其他檔案系統，請修改指令。</para>
    </step>
    <step id="b8gzg83" performance="required">
     <para>編輯 <filename>/etc/mdadm.conf</filename> 檔案，以新增元件裝置和 RAID 裝置 <filename>/dev/md2</filename> 的項目。</para>
    </step>
    <step id="b8gzg84" performance="required">
     <para>編輯 <filename>/etc/fstab</filename> 檔案以新增 RAID 0+1 裝置 <filename>/dev/md2</filename> 的項目。 </para>
    </step>
    <step id="b8gzg85" performance="required">
     <para>重新載入伺服器。</para>
     <para>RAID 0+1 裝置已掛接到 <filename>/local</filename>。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="raidmdadmr10cpx">
  <title>建立複雜 RAID 10</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="raidmdadmr10cpxcreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="raidmdadmr10cpxovw">
   <title>瞭解複雜 RAID10</title>
   <para>在 <command>mdadm</command> 中，RAID10 層級可建立單一複雜軟體 RAID，它結合了 RAID 0 (分割) 與 RAID 1 (鏡像) 的功能。所有資料區塊的多個複本按照分割原則分佈於多個裝置之上。元件裝置的大小應相同。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="b8ghyxy" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cym9j" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cym15" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cyneb" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="b7cynnk" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="byz81ho" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="b8ghyxy">
    <title>比較複雜 RAID10 與巢狀 RAID 10 (1+0)</title>
    <para role="intro">複雜 RAID 10 與巢狀 RAID 10 (1+0) 的用途相似，但有以下幾處差異︰</para>
    <table id="b8ghz5p" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
     <title>比較複雜與巢狀 RAID 10</title>
     <tgroup cols="3">
     <colspec colnum="1" colname="1" colwidth="3334*"/>
     <colspec colnum="2" colname="2" colwidth="3334*"/>
     <colspec colnum="3" colname="3" colwidth="3334*"/>
      <thead>
       <row id="b8gzgca">
        <entry>
         <para>特性</para>
        </entry>
        <entry>
         <para>複雜 RAID10</para>
        </entry>
        <entry>
         <para>巢狀 RAID 10 (1+0)</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="b8gzgcb">
        <entry>
         <para>裝置數量</para>
        </entry>
        <entry>
         <para>允許元件裝置的數量為偶數或奇數</para>
        </entry>
        <entry>
         <para>要求元件裝置的數量為偶數</para>
        </entry>
       </row>
       <row id="b8gzgcc">
        <entry>
         <para>元件裝置</para>
        </entry>
        <entry>
         <para>視為單一 RAID 裝置進行管理</para>
        </entry>
        <entry>
         <para>視為巢狀 RAID 裝置進行管理 </para>
        </entry>
       </row>
       <row id="b8gzgcd">
        <entry>
         <para>等量磁區</para>
        </entry>
        <entry>
         <para>在元件裝置近配置或遠配置中發生分割。 </para>
         <para>遠配置提供根據磁碟機數量 (而非 RAID 1 配對的數量) 調整的連續讀取輸送量。</para>
        </entry>
        <entry>
         <para>分割跨元件裝置連續發生</para>
        </entry>
       </row>
       <row id="b8gzgce">
        <entry>
         <para>多個資料複本</para>
        </entry>
        <entry>
         <para>兩個或更多複本，最多為陣列中的裝置數</para>
        </entry>
        <entry>
         <para>每個鏡像複製區段上的複本</para>
        </entry>
       </row>
       <row id="b8gzgcf">
        <entry>
         <para>熱備用裝置</para>
        </entry>
        <entry>
         <para>單一備用可用於所有元件裝置</para>
        </entry>
        <entry>
         <para>為每個基礎鏡像複製陣列設定備用，或者為服務所有鏡像複製的備用群組設定所用備用。 </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </sect3>
   <sect3 id="b7cym9j">
    <title>複雜 RAID10 中的複本數量</title>
    <para>設定複雜 RAID10 陣列時，必須指定每個所需資料區塊的複本數量。複本的預設數量是 2，但該值可以是 2 至陣列中裝置數量的任一值。 </para>
   </sect3>
   <sect3 id="b7cym15">
    <title>複雜 RAID10 中的裝置數量</title>
    <para>必須至少使用與指定的複本數量相同的元件裝置。但是，RAID10 陣列中的元件裝置數量不必是每個資料區塊複本數量的倍數。有效的儲存大小為裝置數量除以複本數量。</para>
    <para>例如，如果您為使用 5 個元件裝置建立的陣列指定 2 個複本，每個區塊的複本儲存在兩個不同的裝置之上。則所有資料的一個複本的有效儲存大小是元件裝置大小的 5/2 或 2.5 倍。</para>
   </sect3>
   <sect3 id="b7cyneb">
    <title>近配置</title>
    <para>使用近配置，資料區塊的複本被分割到不同元件裝置上鄰近位置。即一個資料區塊的多個複本位於不同裝置中偏移值類似的位置。近配置是 RAID10 的預設配置。例如，如果使用奇數數量的元件裝置和兩個資料複本，某些複本可能是裝置中的一個區塊。 </para>
    <para><command>mdadm</command> RAID10 之近配置的讀與寫效能與磁碟機數量超過其半數的 RAID 0 相似。 </para>
    <para role="intro">具有偶數數量的磁碟和兩個複本的近配置︰</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    0    1    1
  2    2    3    3
  4    4    5    5
  6    6    7    7
  8    8    9    9
</screen>

    <para>具有奇數數量的磁碟和兩個複本的近配置：</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    0    1    1    2
  2    3    3    4    4
  5    5    6    6    7
  7    8    8    9    9
  10   10   11   11   12
</screen>

   </sect3>
   <sect3 id="b7cynnk">
    <title>遠配置</title>
    <para>遠配置將資料分割到所有磁碟機的較前部分，然後將資料的另一複本分割到所有磁碟機的較後部分，確保區塊的所有複本位於不同的磁碟機。第二組值啟始於元件磁碟機的中間部分。</para>
    <para>使用遠配置，<command>mdadm</command> RAID10 的讀取效能與超出其全部磁碟機數量的 RAID 0 相似，但寫入效能大大低於 RAID 0，因為它會更多搜尋磁碟機開頭部分。遠配置最適用於讀密集型操作，如唯讀檔案伺服器。 </para>
    <para>raid10 的寫入速度與其他鏡像 RAID 類型相似 (例如 raid1 和使用近配置的 raid10)，因為該檔案系統的升級程式會以一種比 raw 寫入更佳的方式排程寫入操作。使用遠配置的 raid10 最適合鏡像寫入應用程式。</para>
    <para role="intro">具有偶數數量的磁碟和兩個複本的遠配置：</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    1    2    3
  4    5    6    7       
  . . .
  3    0    1    2
  7    4    5    6
</screen>

    <para role="intro">具有奇數數量的磁碟和兩個複本的遠配置：</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  5    6    7    8    9
  . . .
  4    0    1    2    3
  9    5    6    7    8
</screen>

   </sect3>
   <sect3 id="byz81ho">
    <title>偏移配置</title>
    <para>偏移配置會複製等量磁碟區，以便指定區塊的多個副本以連續偏移配置在連續的磁碟機上。實際上，會複製每個等量磁碟區，且各副本會按一個裝置進行偏移。如果使用適當的大型區塊大小，此方式應可為遠配置提供類似的讀取特性，但是寫入特性略低。 </para>
    <para role="intro">具有偶數數量的磁碟和兩個複本的偏移配置：</para>

<screen>
sda1 sdb1 sdc1 sde1
  0    1    2    3
  3    0    1    2       
  4    5    6    7
  7    4    5    6
  8    9   10   11
 11    8    9   10
</screen>

    <para role="intro">具有奇數數量的磁碟和兩個複本的偏移配置：</para>

<screen>
sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  4    0    1    2    3
  5    6    7    8    9
  9    5    6    7    8
 10   11   12   13   14
 14   10   11   12   13                
</screen>

   </sect3>
  </sect2>
  <sect2 id="raidmdadmr10cpxcreate">
   <title>使用 mdadm 建立複雜 RAID 10</title>
   <para><command>mdadm</command> 的 RAID10 選項可建立未經巢狀化的 RAID 10 裝置。如需有關 RAID10 的資訊，請參閱<xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/>。</para>
   <para>此節的程序使用下表顯示的裝置名稱。請確保將裝置名稱修改為自己裝置的名稱。</para>
   <table id="b667706" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>使用 mdadm RAID10 選項建立 RAID 10 的案例 </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b667707">
       <entry>
        <para>Raw 裝置</para>
       </entry>
       <entry>
        <para>RAID10 (近或遠分割規劃)</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b667708">
       <entry>
        <para><filename>/dev/sdf1</filename></para>
        <para><filename>/dev/sdg1</filename></para>
        <para><filename>/dev/sdh1</filename></para>
        <para><filename>/dev/sdi1</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/md3</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <procedure id="b66770c">
    <step id="b667c10" performance="required">
     <para>在 YaST 中，於要在 RAID 中使用的裝置上建立 0xFD Linux RAID 分割區，如 <filename>/dev/sdf1</filename>、<filename>/dev/sdg1</filename>、<filename>/dev/sdh1</filename> 和 <filename>/dev/sdi1</filename>。</para>
    </step>
    <step id="b66770d" performance="required">
     <para>開啟終端機主控台，然後以 root 使用者或同等身分登入。</para>
    </step>
    <step id="b66770e" performance="required">
     <para>建立 RAID 10 指令。在指令提示符下，輸入 (在同一行)︰</para>

<screen>
mdadm --create /dev/md3 --run --level=10 --chunk=4 --raid-devices=4 /dev/sdf1 /dev/sdg1 /dev/sdh1 /dev/sdi1
</screen>

    </step>
    <step id="b66770g" performance="required">
     <para>在 RAID 10 裝置 <filename>/dev/md3</filename> 上建立 Reiser 檔案系統。在指令提示符下，輸入</para>

<screen>
mkfs.reiserfs /dev/md3
</screen>

    </step>
    <step id="b66770h" performance="required">
     <para>編輯 <filename>/etc/mdadm.conf</filename> 檔案，以新增元件裝置和 RAID 裝置 <filename>/dev/md3</filename> 的項目。例如：</para>

<screen>
DEVICE /dev/md3
</screen>

    </step>
    <step id="b66770i" performance="required">
     <para>編輯 <filename>/etc/fstab</filename> 檔案以新增 RAID 10 裝置 <filename>/dev/md3</filename> 的項目。 </para>
    </step>
    <step id="b66770j" performance="required">
     <para>重新載入伺服器。</para>
     <para>RAID 10 裝置已掛接到 <filename>/raid10</filename>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b14drcbo">
   <title>使用 YaST 磁碟分割程式建立複雜 RAID10</title>
   <procedure id="b14dtk6s">
    <step id="b14dtk6t" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST，然後開啟磁碟分割程式。</para>
    </step>
    <step id="b14dtk6u" performance="required">
     <para>選取<guimenu>硬碟</guimenu>以檢視可用的磁碟，例如 sdab、sdc、sdd 和 sde。</para>
    </step>
    <step id="b14dtk6v" performance="required">
     <para>對於要在軟體 RAID 中使用的每個磁碟，在裝置上建立一個 RAID 分割區。每個分割區的大小應該相同。對於 RAID 10 裝置，您需要 </para>
     <substeps performance="required">
      <step id="b14dtk6w" performance="required">
       <para>在<guimenu>硬碟</guimenu>下，選取裝置，然後在右側面板中選取<guimenu>分割區</guimenu>索引標籤。</para>
      </step>
      <step id="b14dtk6x" performance="required">
       <para>按一下<guimenu>新增</guimenu>以開啟<guimenu>新增分割區</guimenu>精靈。</para>
      </step>
      <step id="b14dtk6y" performance="required">
       <para>在<guimenu>新分割區類型</guimenu>下，選取<guimenu>主分割區</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b14dtk6z" performance="required">
       <para>對於<guimenu>新分割區大小</guimenu>，指定此磁碟上 RAID 分割區的所需大小，然後按<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b14dtk70" performance="required">
       <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>不格式化分割區</guimenu>，然後從<guimenu>檔案系統 ID</guimenu>下拉式選單中選取<guimenu>0xFD Linux RAID</guimenu>。</para>
      </step>
      <step id="b14dtk71" performance="required">
       <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>不掛接分割區</guimenu>，然後按一下<guimenu>完成</guimenu>。</para>
      </step>
      <step id="b14dtk72" performance="required">
       <para>重複這些步驟，直到定義了磁碟上要用於 RAID 10 裝置的 RAID 分割區為止。</para>
      </step>
     </substeps>
    </step>
    <step id="b14dtk73" performance="required">
     <para>建立 RAID 10 裝置：</para>
     <substeps performance="required">
      <step id="b14dtk74" performance="required">
       <para>選取<guimenu>RAID</guimenu>，然後在右側面板中選取<guimenu>新增 RAID</guimenu>以開啟<guimenu>新增 RAID</guimenu>精靈。</para>
      </step>
      <step id="b14dtk75" performance="required">
       <para>在<guimenu>RAID 類型</guimenu>下，選取<guimenu>RAID 10 (鏡像和分割)</guimenu>。</para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="raid10_a.png" width="302pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b14dtk76" performance="required">
       <para>在<guimenu>可用的裝置</guimenu>清單中，選取所需的 Linux RAID 分割區，然後按一下<guimenu>新增</guimenu>以將它們移至<guimenu>選定裝置</guimenu>清單。</para>
      </step>
      <step id="b14dtk77" performance="required">
       <para>(選擇性) 按一下<guimenu>分類</guimenu>，指定 RAID 陣列中各磁碟的偏好順序。</para>
       <para>對於已新增磁碟的順序具有重要性的 RAID 類型，您可以指定裝置的使用順序，以確保一半陣列位於一個磁碟子系統中，而另一半陣列位於另一個磁碟子系統上。例如，如果一個磁碟子系統失敗，系統將從第二個磁碟子系統繼續執行。</para>
       <substeps performance="required">
        <step id="b14dutul" performance="required">
         <para>依次選取每個磁碟，然後按一下其中一個<guimenu>類別 X</guimenu>按鈕 (其中 X 是要指定給磁碟的字母)。可用的類別有 A、B、C、D 和 E，但是大多數情況下，只需要較少的類別 (例如，僅需 A 和 B)。以這種方式指定所有可用的 RAID 磁碟。 </para>
         <para>您可以按 Ctrl 或 Shift 鍵選取多個裝置，也可以在選定裝置上按一下滑鼠右鍵，然後從網路位置功能表中選擇適當的類別。</para>
        </step>
        <step id="b14dutum" performance="required">
         <para>透過選取其中一個排序選項指定裝置的順序︰</para>
         <formalpara id="b14dutun">
          <title>已排序︰</title>
          <para>先對類別 A 的所有裝置排序，然後對類別 B 的所有裝置排序，依此類推。例如：<literal>AABBCC</literal>。</para>
         </formalpara>
         <formalpara id="b14dutuo">
          <title>交錯式：</title>
          <para>先對類別 A 的第一個裝置排序，接著對類別 B 的第一個裝置排序，依此類推對所有指定了裝置的後續類別排序。之後，接著對類別 A、B 等的第二個裝置排序，依次類推。沒有類別的所有裝置將排在裝置清單的末尾。例如，<literal>ABCABC</literal>。</para>
         </formalpara>
         <formalpara id="b14dutup">
          <title>模式檔案︰</title>
          <para>選取包含多行的現有檔案，其中每一行都是一個正規表示式和一個類別名稱 (<literal>"sda.* A"</literal>). 所有符合該正規表示式的裝置都會指定給該行的指定類別。正規表示式將依次比對核心名稱 (<filename>/dev/sda1</filename>)、udev 路徑名稱 (<filename>/dev/disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0-part1</filename>) 和 udev ID (/dev/disk/by-id/ata-ST3500418AS_9VMN8X8L-part1)。如果裝置名稱與多個正規表示式相符，則第一個相符項決定其類別。</para>
         </formalpara>
        </step>
        <step id="b14dutuq" performance="required">
         <para>在對話方塊底部，按一下<guimenu>確定</guimenu>以確認順序。</para>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject>
           <imagedata fileref="raid10_classify_a.png" width="292pt" format="png"/></imageobject>
          </mediaobject>
         </informalfigure>
        </step>
       </substeps>
      </step>
      <step id="b14dttix" performance="required">
       <para>按一下<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b14dttiy" performance="required">
       <para>在<guimenu>RAID 選項</guimenu>下，指定<guimenu>區塊大小</guimenu>和<guimenu>同位演算法</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
       <para>對於 RAID 10，同位選項包括 n (近)、f (遠) 和 o (偏移)。數字表示需要之每個資料區塊的複本數量。預設值為 2。如需更多資訊，請參閱<xref linkend="raidmdadmr10cpxovw" xrefstyle="SectTitleOnPage"/>。</para>
      </step>
      <step id="b14dttiz" performance="required">
       <para>將檔案系統與掛接選項新增至 RAID 裝置，然後按一下<guimenu>完成</guimenu>。</para>
      </step>
     </substeps>
    </step>
    <step id="b14dttj0" performance="required">
     <para role="intro">選取<guimenu>RAID</guimenu>，再選取新建立的 RAID 裝置，然後按一下<guimenu>使用的裝置</guimenu>以檢視其分割區。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="raid10_useddevs_a.png" width="302pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b14dtw8j" performance="required">
     <para>按一下<guimenu>下一步</guimenu>。</para>
    </step>
    <step id="b14dtw8k" performance="required">
     <para>驗證要進行的變更，然後按一下<guimenu>完成</guimenu>以建立 RAID。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="raidmdadmdegraded">
  <title>建立降級 RAID 陣列</title>
  <para role="intro">降級陣列是指其中某些裝置遺失的陣列。只有 RAID 1、RAID 4、RAID 5 和 RAID 6 支援降級陣列。這些 RAID 類型具有容錯功能，可容許遺失某些裝置。降級陣列通常發生在裝置故障時。也可能會出於某種目的而建立降級陣列。 </para>
  <informaltable role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
   <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="3334*"/>
   <colspec colnum="2" colname="2" colwidth="3334*"/>
   <colspec colnum="3" colname="3" colwidth="3334*"/>
    <thead>
     <row id="b8gzm1p">
      <entry>
       <para>RAID 類型</para>
      </entry>
      <entry>
       <para>允許遺失插槽數量</para>
      </entry>
      <entry/>
     </row>
    </thead>
    <tbody>
     <row id="b8gzm1q">
      <entry>
       <para>RAID 1</para>
      </entry>
      <entry>
       <para>只要有一個裝置未遺失即可</para>
      </entry>
      <entry/>
     </row>
     <row id="b8gzm1r">
      <entry>
       <para>RAID 4</para>
      </entry>
      <entry>
       <para>一個插槽</para>
      </entry>
      <entry/>
     </row>
     <row id="b8h0rww">
      <entry>
       <para>RAID 5</para>
      </entry>
      <entry>
       <para>一個插槽</para>
      </entry>
      <entry/>
     </row>
     <row id="b8gzm1s">
      <entry>
       <para>RAID 6</para>
      </entry>
      <entry>
       <para>一或兩個插槽</para>
      </entry>
      <entry/>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
  <para>若要建立其中某些裝置遺失的降級陣列，只需在裝置名稱處標記<literal>遺失</literal>一詞。這會導致 <command>mdadm</command> 將陣列中的相應插槽保留空白。 </para>
  <para>建立 RAID 5 陣列時，<command>mdadm</command> 會自動建立具有額外備用磁碟機的降級陣列。這是因為在降級陣列中建立備用磁碟機通常比重新同步非降級但不乾淨的陣列上的同位要快得多。可以使用 <literal>--force</literal> 選項覆寫此功能。</para>
  <para>如果您要建立 RAID，但要使用的其中一個裝置上已有資料，則可以建立降級陣列。在這種情況下，建立具有其他裝置的降級陣列，將資料從使用中的裝置複製到在降級模式下執行的 RAID，再將該裝置新增至 RAID，然後等候 RAID 重建，如此操作資料就會分佈到所有裝置。下列程序是該處理程序的一個範例︰</para>
  <procedure id="b8h2aqj">
   <step id="b8h2aqk" performance="required">
    <para>使用一個單一磁碟機 <filename>/dev/sd 1</filename> 建立降級 RAID 1 裝置 <filename>/dev/md0</filename>，然後在指令提示符下輸入︰</para>

<screen>
mdadm --create /dev/md0 -l 1 -n 2 /dev/sda1 missing
</screen>

    <para>該裝置大小應不小於您計劃新增的裝置。</para>
   </step>
   <step id="b8h2atq" performance="required">
    <para>如果您要新增至鏡像複製的裝置包含要移至 RAID 陣列的資料，請將該資料立即複製到在降級模式下執行的 RAID 陣列。</para>
   </step>
   <step id="b8h2avw" performance="required">
    <para>將裝置新增至鏡像複製。例如，若要將 <filename>/dev/sdb1</filename> 新增至 RAID，請在指令提示符下輸入︰</para>

<screen>
mdadm /dev/md0 -a /dev/sdb1
</screen>

    <para>您一次只能新增一個裝置。請耐心等候核心建立鏡像複製並將其完全發佈到線上，然後才能新增其他鏡像複製。 </para>
   </step>
   <step id="b8h2ayp" performance="required">
    <para>在指令提示符下輸入以下指令以監控建立進度︰</para>

<screen>
cat /proc/mdstat
</screen>

    <para>若要查看每秒重新整理一次的重建進度，請輸入</para>

<screen>
watch -n 1 cat /proc/mdstat 
</screen>

   </step>
  </procedure>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,,80" id="raidresize" lang="zh-tw" revision="02/22/07" xml:base="05_raid_resize.xml">
 <title>使用 mdadm 調整軟體 RAID 陣列的大小</title>
 <para>本章描述如何使用「多裝置管理」(<command>mdadm(8)</command>) 工具增加或減少軟體 RAID 1、4、5 或 6 裝置的大小。 </para>
 <warning>
  <para>在開始執行本節描述的任一任務之前，請確定您已有效備份所有資料。 </para>
 </warning>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="resizeincr" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="resizedecr" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="resizeunderstand">
  <title>瞭解調整大小處理程序</title>
  <para>調整現有軟體 RAID 裝置的大小包括增加或減少每個元件分割區所佔空間。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b8ppjxz" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b8pr3ol" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b8ppjxz">
   <title>調整軟體 RAID 大小的準則 </title>
   <para><command>mdadm(8)</command> 工具僅支援調整軟體 RAID 層級 1、4、5 和 6 的大小。這些 RAID 層級提供磁碟容錯功能，因此調整大小時一次可以移除一個元件分割區。原則上，可以即時調整 RAID 分割區的大小，但在執行此操作時要格外留意您的資料避免遺失。 </para>
   <para>還必須能夠調整 RAID 上之檔案系統的大小，以便充分利用裝置上可用空間的變更。SUSE Linux Enterprise Server 11 中提供了適用於檔案系統 Ext2、Ext3 及 ReiserFS 的檔案系統調整大小公用程式。該公用程式支援增加和減少大小，如下所述︰</para>
   <table id="biuzuno" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>檔案系統支援調整大小</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="2500*"/>
    <colspec colnum="3" colname="3" colwidth="2500*"/>
    <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row id="biuzunp">
       <entry>
        <para>檔案系統</para>
       </entry>
       <entry>
        <para>公用程式</para>
       </entry>
       <entry>
        <para>增加大小</para>
       </entry>
       <entry>
        <para>減少大小</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="biuzunq">
       <entry>
        <para>Ext2 或 Ext3</para>
       </entry>
       <entry>
        <para>resize2fs</para>
       </entry>
       <entry>
        <para>可以，僅限離線狀態</para>
       </entry>
       <entry>
        <para>可以，僅限離線狀態</para>
       </entry>
      </row>
      <row id="biuzunr">
       <entry>
        <para>ReiserFS</para>
       </entry>
       <entry>
        <para>resize_reiserfs</para>
       </entry>
       <entry>
        <para>可以，線上或離線狀態均可</para>
       </entry>
       <entry>
        <para>可以，僅限離線狀態</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>調整任何分割區或檔案系統的大小都存在一定的風險，可能會造成資料遺失。 </para>
   <warning>
    <para>若要避免資料遺失，在開始執行調整大小任務之前，請務必備份資料。</para>
   </warning>
  </sect2>
  <sect2 id="b8pr3ol">
   <title>任務綜覽</title>
   <para>調整 RAID 大小包括下列任務。執行這些任務的順序取決於是增加還是減少大小。 </para>
   <table id="b8ppko3" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>調整 RAID 大小的相關任務</title>
    <tgroup cols="4">
    <colspec colnum="1" colname="1" colwidth="2500*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
    <colspec colnum="3" colname="3" colwidth="1250*"/>
    <colspec colnum="4" colname="4" colwidth="1250*"/>
     <thead>
      <row id="b8pps5o">
       <entry>
        <para>任務</para>
       </entry>
       <entry>
        <para>描述</para>
       </entry>
       <entry>
        <para>增加大小時採用的順序</para>
       </entry>
       <entry>
        <para>減少大小時採用的順序</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8pps5p">
       <entry>
        <para>調整每個元件分割區的大小。</para>
        <para/>
       </entry>
       <entry>
        <para>增加或減少每個元件分割區的使用中大小。一次僅可移除一個元件分割區，修改其大小，然後將其傳回 RAID。</para>
       </entry>
       <entry>
        <para>1</para>
       </entry>
       <entry>
        <para>2</para>
       </entry>
      </row>
      <row id="b8pps5q">
       <entry>
        <para>調整軟體 RAID 自身大小。</para>
       </entry>
       <entry>
        <para>RAID 無法自動知曉您對基礎元件分割區大小所做的調整 (增加或減少)。您必須通知它新大小。</para>
       </entry>
       <entry>
        <para>2</para>
       </entry>
       <entry>
        <para>3</para>
       </entry>
      </row>
      <row id="b8pps5r">
       <entry>
        <para>調整檔案系統的大小。</para>
       </entry>
       <entry>
        <para>您必須調整 RAID 上檔案系統的大小。這可能僅適用於提供調整大小工具的檔案系統，如 Ext2、Ext3、 及 ReiserFS。</para>
       </entry>
       <entry>
        <para>3</para>
       </entry>
       <entry>
        <para>1</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para/>
  </sect2>
 </sect1>
 <sect1 id="resizeincr">
  <title>增加軟體 RAID 的大小</title>
  <para>開始之前，請參閱<xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/> 中的準則。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="resizeincrpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="resizeincrpart">
   <title>增加元件分割區的大小</title>
   <para>套用此節中的程序以增加 RAID 1、4、5 或 6 的大小。對於 RAID 中的每個元件分割區，請先將它從 RAID 移除，修改其大小，然後將它傳回 RAID，RAID 需要一定的穩定時間，隨後就可以繼續。移除分割區時，RAID 在降級模式下操作，此時不具備磁碟容錯功能或會降低此功能。即便對於能夠容許多個磁碟同時發生故障的 RAID，也不要一次移除多個元件分割區。</para>
   <warning>
    <para>如果 RAID 不具備磁碟容錯功能或只是不一致，則移除任何分割區都會導致資料遺失。移除分割區時要非常小心，並確定已備份可用資料。 </para>
   </warning>
   <para>此節的程序使用下表顯示的裝置名稱。請確定將名稱修改為自己裝置的名稱。</para>
   <table id="b8prrn8" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>增加元件分割區大小的案例 </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b8pry2e">
       <entry>
        <para>RAID 裝置</para>
       </entry>
       <entry>
        <para>元件分割區</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b8pry2f">
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/sda1</filename></para>
        <para><filename>/dev/sdb1</filename></para>
        <para><filename>/dev/sdc1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>若要增加 RAID 元件分割區的大小，請執行下列步驟︰</para>
   <procedure id="b8pp3av">
    <step id="b8progi" performance="required">
     <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
    </step>
    <step id="b8pp3aw" performance="required">
     <para>輸入以下指令，以確定 RAID 陣列具有一致性且經過同步 </para>

<screen>
cat /proc/mdstat
</screen>

     <para>如果 RAID 陣列仍在根據指令的輸出進行同步，您必須等候同步完成，然後才能繼續。 </para>
    </step>
    <step id="b8pp3ax" performance="required">
     <para>從 RAID 陣列移除一個元件分割區。例如，若要移除 <filename>/dev/sda1</filename>，請輸入 </para>

<screen>
mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1
</screen>

     <para>為了操作成功，必須執行容錯和移除動作。 </para>
    </step>
    <step id="b8pp3ay" performance="required">
     <para>執行下列操作之一，增加在<xref linkend="b8pp3ax" xrefstyle="StepXRef"/> 中移除之分割區的大小︰</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>使用磁碟分割程式，如 <command>fdisk(8)</command>、<command>cfdisk(8)</command> 或 <command>parted(8)</command>，增加分割區的大小。通常選擇此選項。</para>
      </listitem>
      <listitem>
       <para>用更大容量的裝置取代分割區所在的磁碟。 </para>
       <para>僅當原始磁碟區上的其他檔案系統沒有被系統存取時，該選項才可用。當取代裝置被新增回 RAID 時，它需要更久的時間來同步資料，因為此時必須重建原始裝置上的所有資料。</para>
      </listitem>
     </itemizedlist>
    </step>
    <step id="b8pp3az" performance="required">
     <para>再次將分割區新增至 RAID 陣列。例如，若要新增 <filename>/dev/sda1</filename>，請輸入 </para>

<screen>
mdadm -a /dev/md0 /dev/sda1
</screen>

     <para>請等候直至 RAID 實現同步和一致性，然後再繼續下一分割區。</para>
    </step>
    <step id="b8ps27a" performance="required">
     <para>對陣列中的每個剩餘元件裝置重複執行<xref linkend="b8pp3aw" xrefstyle="StepXRef"/> 到<xref linkend="b8pp3az" xrefstyle="StepXRef"/> 的操作。請確定針對正確的元件分割區修改指令。</para>
    </step>
    <step id="b8ps2tp" performance="required">
     <para>如果系統發出訊息告知您核心無法重新讀取 RAID 的分割區表，則必須在調整所有分割區大小之後重新開機電腦，以強制更新分割區表。</para>
    </step>
    <step id="b8q915s" performance="required">
     <para>請繼續執行<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="resizeincrraid">
   <title>增加 RAID 陣列的大小</title>
   <para>在調整 RAID 中每個元件分割區的大小後 (請參閱<xref linkend="resizeincrpart" xrefstyle="SectTitleOnPage"/>)，RAID 陣列組態會繼續使用原始陣列大小，直至您強制其知曉新的可用空間。您可以指定 RAID 的大小，或使用最大可用空間。 </para>
   <para>在本節的程序中，使用 RAID 裝置的裝置名稱 <filename>/dev/md0</filename>。請確定修改名稱以使用自己裝置的名稱。</para>
   <procedure id="b8pp3b0">
    <step id="b8psa0o" performance="required">
     <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
    </step>
    <step id="b8pp3b1" performance="required">
     <para>請輸入以下指令，以檢查陣列的大小及陣列可識別的裝置大小</para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="b8psbwk" performance="required">
     <para>請執行下列其中一個步驟︰</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>請輸入以下指令，以將陣列的大小增加到可用的最大大小︰ </para>

<screen>
mdadm --grow /dev/md0 -z max
</screen>

      </listitem>
     </itemizedlist>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>請輸入以下指令，以將陣列的大小增加到可用的最大大小︰ </para>

<screen>
mdadm --grow /dev/md0 -z max --assume-clean
</screen>

       <para>陣列會使用已新增至裝置的任何空間，但是不會對此空間進行同步處理。建議將此指令用於 RAID1，因為該層級不需要同步。如果新增至成員裝置的空間已預先置零，則該指令可用於其他 RAID 層級。</para>
      </listitem>
     </itemizedlist>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>請輸入以下指令，以將陣列的大小增加到指定值︰ </para>

<screen>
mdadm --grow /dev/md0 -z <replaceable>size</replaceable>
</screen>

       <para>用適當的大小 (以 KB 為單位的整數值，1 KB 為 1024 位元組) 取代 <replaceable>size</replaceable>。 </para>
      </listitem>
     </itemizedlist>
    </step>
    <step id="b8pp3b3" performance="required">
     <para>請輸入以下指令，以重新檢查陣列的大小及陣列可識別的裝置大小︰ </para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="b8psgk9" performance="required">
     <para>請執行下列其中一個步驟︰ </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>如果已成功調整好陣列的大小，請繼續<xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/>。</para>
      </listitem>
      <listitem>
       <para>如果陣列未調整到預期大小，您必須重新開機，然後再次嘗試執行此程序。 </para>
      </listitem>
     </itemizedlist>
    </step>
   </procedure>
  </sect2>
  <sect2 id="resizeincrfs">
   <title>增加檔案系統的大小</title>
   <para>在增加陣列的大小後 (請參閱<xref linkend="resizeincrraid" xrefstyle="SectTitleOnPage"/>)，您就可以調整檔案系統的大小。 </para>
   <para>可以將檔案系統的大小增加到最大可用空間大小，或指定一個精確的值。為檔案系統指定精確大小時，請確保新大小符合以下條件︰</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必須大於現有資料的大小；否則資料會遺失。 </para>
    </listitem>
    <listitem>
     <para>新大小不得超過目前 RAID 的大小，因為檔案系統大小無法超過可用空間大小。</para>
    </listitem>
   </itemizedlist>
   <sect3 id="b8uks1t">
    <title>Ext2 或 Ext3</title>
    <para>使用 <command>resize2fs</command> 指令掛接或卸載時，可以調整 Ext2 與 Ext3 檔案系統的大小。</para>
    <procedure id="b8uksb5">
     <step id="b8uksb6" performance="required">
      <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
     </step>
     <step id="b8uksjw" performance="required">
      <para>使用下列方法之一增加檔案系統的大小︰</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>若要將檔案系統的大小擴充至名為 <filename>/dev/md0</filename> 的軟體 RAID 裝置的最大可用大小，請輸入</para>

<screen>
resize2fs /dev/md0
</screen>

        <para>如果未指定大小參數，則預設大小為分割區的大小。</para>
       </listitem>
       <listitem>
        <para>若要將檔案系統擴充至指定大小，請輸入 </para>

<screen>
resize2fs /dev/md0 <replaceable>size</replaceable>
</screen>

        <para><replaceable>size</replaceable> 參數可指定所需的檔案系統新大小。如果未指定單位，則大小參數的單位即為檔案系統的區塊大小。也可以選擇透過下列其中一種單位指示項給大小參數加上字尾︰s 表示 512 位元組磁區；K 表示 KB (1 KB 為 1024 位元組)；M 表示 MB；G 表示 GB。</para>
       </listitem>
      </itemizedlist>
      <para>請等候直至完成大小調整，然後再繼續。</para>
     </step>
     <step id="b8ule4k" performance="required">
      <para>如果未掛接檔案系統，請立即掛接。 </para>
      <para>例如，若要在掛接點 <filename>/raid</filename> 為名為 <filename>/dev/md0</filename> 的 RAID 掛接 Ext2 檔案系統，請輸入</para>

<screen>
mount -t ext2 /dev/md0 /raid
</screen>

     </step>
     <step id="b8ul4ag" performance="required">
      <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

      <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="b8ul8fq">
    <title>ReiserFS</title>
    <para>對於 Ext2 與 Ext3，掛接或卸載 ReiserFS 檔案系統時可增加其大小。調整大小的操作是在 RAID 陣列的區塊裝置上完成的。</para>
    <procedure id="b8ul8cv">
     <step id="b8ul8cw" performance="required">
      <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
     </step>
     <step id="b8ul8cx" performance="required">
      <para>使用以下其中一種方法，增加名為 <filename>/dev/md0</filename> 的軟體 RAID 裝置上檔案系統的大小︰</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>若要將檔案系統的大小擴充至裝置的最大可用大小，請輸入</para>

<screen>
resize_reiserfs /dev/md0
</screen>

        <para>若不指定大小，該指令會將磁碟區增加至分割區的總大小。 </para>
       </listitem>
       <listitem>
        <para>若要將檔案系統擴充至指定大小，請輸入</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/md0
</screen>

        <para>用所需大小 (以位元組計) 取代 <replaceable>size</replaceable>。您也可以指定值的單位，例如 50000K (KB)、250M (MB) 或 2G (GB)。也可以使用加號 (+) 為值加上字首，以指定為目前大小增加的值。例如，以下指令可將 <filename>/dev/md0</filename> 上的檔案系統的大小增加 500 MB︰</para>

<screen>
resize_reiserfs -s +500M /dev/md0
</screen>

       </listitem>
      </itemizedlist>
      <para>請等候直至完成大小調整，然後再繼續。</para>
     </step>
     <step id="b8ulei7" performance="required">
      <para>如果未掛接檔案系統，請立即掛接。 </para>
      <para>例如，若要為位於掛接點 <filename>/raid</filename> 處名稱為 <filename>/dev/md0</filename> 的 RAID 掛接 ReiserFS 檔案系統，請輸入</para>

<screen>
mount -t reiserfs /dev/md0 /raid
</screen>

     </step>
     <step id="b8ul8cy" performance="required">
      <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

      <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="resizedecr">
  <title>減少軟體 RAID 的大小</title>
  <para>開始之前，請參閱<xref linkend="resizeunderstand" xrefstyle="SectTitleOnPage"/> 中的準則。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="resizedecrfs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="resizedecrpart" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="resizedecrfs">
   <title>減少檔案系統的大小</title>
   <para>當要減少 RAID 裝置上檔案系統的大小時，請確定新大小滿足下列條件︰</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>新大小必須大於現有資料的大小；否則資料會遺失。 </para>
    </listitem>
    <listitem>
     <para>新大小不得超過目前 RAID 的大小，因為檔案系統大小無法超過可用空間大小。</para>
    </listitem>
   </itemizedlist>
   <para>在 SUSE Linux Enterprise Server 中，Ext2、Ext3 及 ReiserFS 提供了可減少檔案系統大小的公用程式。請使用下文中相應的程序減少檔案系統的大小。</para>
   <para>本節所述的程序使用的 RAID 裝置名稱為 <filename>/dev/md0</filename>。請務必修改指令，以使用您自己的裝置名稱。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bznzca1" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bznzca8" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bznzca1">
    <title>Ext2 或 Ext3</title>
    <para>掛接或卸載 Ext2 與 Ext3 檔案系統時，可調整其大小。 </para>
    <procedure id="bznzca2">
     <step id="bznzca3" performance="required">
      <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
     </step>
     <step id="bznzca4" performance="required">
      <para>輸入以下指令，減少 RAID 上檔案系統的大小</para>

<screen>
resize2fs /dev/md0 &lt;size&gt;
</screen>

      <para>使用所需大小的整數值 (以 KB 計) 取代 <replaceable>size</replaceable>。(1 KB = 1024 B。)</para>
      <para>請等候直至完成大小調整，然後再繼續。</para>
     </step>
     <step id="bznzca5" performance="required">
      <para>如果未掛接檔案系統，請立即掛接。例如，若要在掛接點 <filename>/raid</filename> 為名為 <filename>/dev/md0</filename> 的 RAID 掛接 Ext2 檔案系統，請輸入</para>

<screen>
mount -t ext2 /dev/md0 /raid
</screen>

     </step>
     <step id="bznzca6" performance="required">
      <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

      <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
     </step>
     <step id="bznzca7" performance="required">
      <para>繼續執行<xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bznzca8">
    <title>ReiserFS</title>
    <para>僅當卸載磁碟區時才能減少 ReiserFS 檔案系統的大小。 </para>
    <procedure id="bznzca9">
     <step id="bznzcaa" performance="required">
      <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
     </step>
     <step id="bznzcab" performance="required">
      <para>輸入以下指令卸載裝置</para>

<screen>
umount /mnt/point
</screen>

      <para>如果您嘗試要減少其大小的分割區包含系統檔案 (例如根 (<filename>/</filename>) 磁碟區)，僅當系統從可開機的 CD 或磁片開機時，才可以進行卸載操作。</para>
     </step>
     <step id="bznzcac" performance="required">
      <para>輸入以下指令，減少位於軟體 RAID 裝置 <filename>/dev/md0</filename> 上檔案系統的大小</para>

<screen>
resize_reiserfs -s <replaceable>size</replaceable> /dev/md0
</screen>

      <para>用所需大小 (以位元組計) 取代 <replaceable>size</replaceable>。您也可以指定值的單位，例如 50000K (KB)、250M (MB) 或 2G (GB)。您也可以使用減號 (-) 為該值加上字首，以指定為目前大小減少的值。例如，以下指令可將 <filename>/dev/md0</filename> 上檔案系統的大小減少 500 MB︰</para>

<screen>
resize_reiserfs -s -500M /dev/md0
</screen>

      <para>請等候直至完成大小調整，然後再繼續。</para>
     </step>
     <step id="bznzcad" performance="required">
      <para>輸入以下指令掛接檔案系統 </para>

<screen>
mount -t reiserfs /dev/md0 /mnt/point
</screen>

     </step>
     <step id="bznzcae" performance="required">
      <para>請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果</para>

<screen>
df -h
</screen>

      <para>可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以較易理解的格式列印大小，如 1K、234M 或 2G。</para>
     </step>
     <step id="bznzcaf" performance="required">
      <para>繼續執行<xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/>。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="resizedecrraid">
   <title>減少 RAID 陣列的大小</title>
   <para>調整檔案系統的大小之後，RAID 陣列組態會繼續使用其原始陣列大小，直到您強制它減少可用空間。使用 <command>mdadm --grow</command> 模式來強制 RAID 使用較小的節區大小。為此，您必須使用 -z 選項來指定 RAID 中每個裝置要使用的空間量 (以 KB 為單位)。此大小必須是區塊大小的倍數，並且必須為要寫入裝置的 RAID 超級區塊留出約 128KB 的空間。 </para>
   <para>在本節的程序中，使用 RAID 裝置的裝置名稱 <filename>/dev/md0</filename>。請務必修改指令，以使用您自己的裝置名稱。</para>
   <procedure id="bznzcau">
    <step id="bznzcav" performance="required">
     <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
    </step>
    <step id="bznzcaw" performance="required">
     <para>請輸入以下指令，以檢查陣列的大小及陣列可識別的裝置大小</para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="bznzcax" performance="required">
     <para>輸入以下指令將陣列的裝置大小減少至指定值 </para>

<screen>
mdadm --grow /dev/md0 -z <replaceable>&lt;size</replaceable>&gt;
</screen>

     <para>使用所需大小的整數值 (以 KB 計) 取代 <replaceable>size</replaceable>。(1 KB = 1024 B。) </para>
     <para>例如，下列指令會將每個 RAID 裝置的節區大小設為約 40 GB，其中區塊大小為 64 KB。它還包括用於 RAID 超級區塊的 128 KB。</para>

<screen>
mdadm --grow /dev/md2 -z 41943168
</screen>

    </step>
    <step id="bznzcay" performance="required">
     <para>請輸入以下指令，以重新檢查陣列的大小及陣列可識別的裝置大小︰ </para>

<screen>
mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"
</screen>

    </step>
    <step id="bznzcaz" performance="required">
     <para>請執行下列其中一個步驟︰ </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>如果已成功調整好陣列的大小，請繼續<xref linkend="resizedecrpart" xrefstyle="SectTitleOnPage"/>。</para>
      </listitem>
      <listitem>
       <para>如果陣列未調整到預期大小，您必須重新開機，然後再次嘗試執行此程序。 </para>
      </listitem>
     </itemizedlist>
    </step>
   </procedure>
  </sect2>
  <sect2 id="resizedecrpart">
   <title>減少元件分割區的大小</title>
   <para>減小 RAID 中每個裝置使用的節區大小之後，RAID 將不會使用每個元件分割區中的剩餘空間。您可以讓分割區保持其目前大小，以便為 RAID 將來的增長留出空間，也可以收回這些目前未使用的空間。</para>
   <para>若要收回空間，請逐個減少元件分割區。對於每個元件分割區，您可以將其從 RAID 移除，減小其分割區的大小，將分割區返回至 RAID，然後等待 RAID 穩定下來。若要允許中繼資料，所指定的大小應比<xref linkend="resizedecrraid" xrefstyle="SectTitleOnPage"/> 中為 RAID 指定的大小略大。</para>
   <para>移除分割區時，RAID 在降級模式下操作，此時不具備磁碟容錯功能或會降低此功能。即使對於那些可以容許多個磁碟失敗同時發生的 RAID 而言，您也決不能一次即移除一個以上的元件分割區。</para>
   <warning>
    <para>如果 RAID 不具備磁碟容錯功能或只是不一致，則移除任何分割區都會導致資料遺失。移除分割區時要非常小心，並確定已備份可用資料。 </para>
   </warning>
   <para>此節的程序使用下表顯示的裝置名稱。請務必修改指令，以使用您自己的裝置名稱。</para>
   <table id="bznzcah" role="1" frame="topbot" rowsep="1" pgwide="0" width="100%">
    <title>增加元件分割區大小的案例 </title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="bznzcai">
       <entry>
        <para>RAID 裝置</para>
       </entry>
       <entry>
        <para>元件分割區</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bznzcaj">
       <entry>
        <para><filename>/dev/md0</filename></para>
       </entry>
       <entry>
        <para><filename>/dev/sda1</filename></para>
        <para><filename>/dev/sdb1</filename></para>
        <para><filename>/dev/sdc1</filename></para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>若要減小 RAID 元件分割區的大小，請執行下列步驟︰</para>
   <procedure id="bznzcak">
    <step id="bznzcal" performance="required">
     <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者或同等身分登入。</para>
    </step>
    <step id="bznzcam" performance="required">
     <para>輸入以下指令，以確定 RAID 陣列具有一致性且經過同步 </para>

<screen>
cat /proc/mdstat
</screen>

     <para>如果 RAID 陣列仍在根據指令的輸出進行同步，您必須等候同步完成，然後才能繼續。 </para>
    </step>
    <step id="bznzcan" performance="required">
     <para>從 RAID 陣列移除一個元件分割區。例如，若要移除 <filename>/dev/sda1</filename>，請輸入 </para>

<screen>
mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1
</screen>

     <para>為了操作成功，必須執行容錯和移除動作。 </para>
    </step>
    <step id="bznzcao" performance="required">
     <para>減小<xref linkend="b8pp3ax" xrefstyle="StepXRef"/> 中移除之分割區的大小，讓其值略大於為節區大小設定的大小。大小應該是區塊大小的倍數，並為 RAID 超級區塊留出 128 KB 的空間。使用 <command>fdisk</command>、<command>cfdisk</command> 或 <command>parted</command> 等磁碟分割程式減小分割區的大小。</para>
    </step>
    <step id="bznzcap" performance="required">
     <para>再次將分割區新增至 RAID 陣列。例如，若要新增 <filename>/dev/sda1</filename>，請輸入 </para>

<screen>
mdadm -a /dev/md0 /dev/sda1
</screen>

     <para>請等候直至 RAID 實現同步和一致性，然後再繼續下一分割區。</para>
    </step>
    <step id="bznzcaq" performance="required">
     <para>對陣列中的每個剩餘元件裝置重複執行<xref linkend="b8pp3aw" xrefstyle="StepXRef"/> 到<xref linkend="b8pp3az" xrefstyle="StepXRef"/> 的操作。請確定針對正確的元件分割區修改指令。</para>
    </step>
    <step id="bznzcar" performance="required">
     <para>如果您收到一條訊息，告知核心無法重新讀取 RAID 的分割區表，則您必須在調整所有元件分割區的大小後將電腦重新開機。</para>
    </step>
    <step id="bzo0b0b" performance="required">
     <para>(選擇性) 擴大 RAID 和檔案系統的大小，以使用目前較小元件分割區中最大的空間：</para>
     <substeps performance="required">
      <step id="bznzcas" performance="required">
       <para>擴大 RAID 的大小，以使用大小已減小之元件分割區中目前可用的最大空間：</para>

<screen>
mdadm --grow /dev/md0 -z max
</screen>

      </step>
      <step id="bzo00hx" performance="required">
       <para>擴大檔案系統的大小，以使用剛調整過大小之 RAID 中的所有可用空間：如需更多資訊，請參閱<xref linkend="resizeincrfs" xrefstyle="SectTitleOnPage"/>。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>
 </sect1>
</chapter>

<chapter id="cha-raids-lee" lang="zh-tw" xml:base="05_raid_led.xml">
 <title>適用於 MD 軟體 RAID 的儲存機殼指示燈公用程式</title>
 <para>儲存機殼指示燈監控公用程式 (<command>ledmon(8)</command>) 和指示燈控制 (<command>ledctl(8)</command>) 公用程式都是 Linux 使用者空間應用程式，可以使用多種介面和通訊協定來控制儲存機殼指示燈。主要用途是視覺化顯示透過 mdadm 公用程式建立之 Linux MD 軟體 RAID 裝置的狀態。ledmon 精靈會監控磁碟機陣列的狀態並更新磁碟機指示燈的狀態。ledctl 公用程式可讓您設定所指定裝置的指示燈模式。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="b14fewb2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14fewb3" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5li" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5lj" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg5lk" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14feg6m" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="b14fewb2">
  <title>受支援的指示燈管理通訊協定</title>
  <para>這些指示燈公用程式使用 SGPIO (序列一般用途輸入/輸出) 規格 (小型機機殼 (SFF) 8485) 及 SCSI 機殼服務 (SES) 2 通訊協定來控制指示燈。它們實作 SGPIO 之 SFF-8489 規格的 International Blinking Pattern Interpretation (IBPI) 模式。IBPI 定義如何將 SGPIO 標準解譯為後擋板上磁碟機和插槽的狀態，以及後擋板應該如何透過指示燈視覺化顯示狀態。 </para>
  <para>某些儲存機殼未嚴格遵守 SFF-8489 規格。機殼處理器可能會接受 IBPI 模式，但不會根據 SFF-8489 規格讓指示燈閃爍，或者該處理器可能僅支援數量有限的 IBPI 模式。 </para>
  <para><command>ledmon</command> 和 <command>ledctl</command> 公用程式都不支援指示燈管理 (AHCI) 和 SAF-TE 通訊協定。</para>
 </sect1>
 <sect1 id="b14fewb3">
  <title>受支援的儲存機殼系統</title>
  <para><command>ledmon</command> 和 <command>ledctl</command> 應用程式經驗證可以與 Intel 儲存控制器 (例如 Intel AHCI 控制器和 Intel SAS 控制器) 配合使用。自 SUSE Linux Enterprise Server 11 SP3 開始，它們還支援 PCIe-SSD (固態磁碟) 機殼指示燈，用以控制屬於 MD 軟體 RAID 磁碟區一部分之 PCIe-SSD 裝置的儲存機殼狀態 (正常、失敗、正在重建) 指示燈。這些應用程式還可以與其他廠商推出之符合 IBPI 的儲存控制器 (尤其是 SAS/SCSI 控制器) 配合使用；不過，其他廠商的控制器尚未經過測試。</para>
 </sect1>
 <sect1 id="b13jg5li">
  <title>儲存機殼指示燈監控服務 (ledmon(8))</title>
  <para><command>ledmon</command> 應用程式是一個精靈程序，可以不斷地監控 MD 軟體 RAID 裝置的狀態，或者儲存機殼或磁碟機槽中區塊裝置的狀態。一次只能執行一個該精靈的例項。<command>ledmon</command> 應用程式是 Intel 機殼指示燈公用程式的一部分。 </para>
  <para>狀態會在與儲存陣列機殼或磁碟機槽中的每個插槽相關聯的指示燈上視覺化顯示。該應用程式會監控所有軟體 RAID 裝置並將其狀態視覺化顯示。它無法僅監控所選軟體 RAID 磁碟區。</para>
  <para><command>ledmon</command> 應用程式支援兩種類型的指示燈系統：雙指示燈系統 (活動指示燈和狀態指示燈) 與三指示燈系統 (活動指示燈、尋找指示燈和失敗指示燈)。存取指示燈時，此工具的優先程度最高。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14fbg00" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfkj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfkq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbfku" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14fbg00">
   <title>語法</title>

<screen>
ledmon [options]
</screen>

   <para>以 <systemitem>root</systemitem> 使用者或具有 <systemitem>root</systemitem> 權限的使用者身分發出該指令。</para>
  </sect2>
  <sect2 id="b14fbfkj">
   <title>選項</title>
   <variablelist>
    <varlistentry id="b14fbfkk">
     <term>-c</term>
     <term>--confg=path</term>
     <listitem>
      <para>設定本地組態檔案的路徑。如果指定了此選項，則全域組態檔案與使用者組態檔案都將無效。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkl">
     <term>-l</term>
     <term>--log=path</term>
     <listitem>
      <para>設定本地記錄檔案的路徑。如果指定了此使用者定義的檔案，則不會使用全域記錄檔案 <filename>/var/log/ledmon.log</filename>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkm">
     <term>-t</term>
     <term>--interval=seconds</term>
     <listitem>
      <para>設定掃描 <filename>sysfs</filename> 之間的時間間隔。該值以秒為單位。最短為 5 秒。最大值未指定。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkn">
     <term>&lt;--quiet|--error|--warning|--info|--debug|--all&gt;</term>
     <listitem>
      <para>指定詳細層級。層級選項按從無資訊到最詳細資訊的順序指定。使用 --quiet 選項不會記錄任何內容。使用 --all 選項則可記錄所有內容。如果指定多個詳細選項，將會套用指令中的最後一個選項。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfko">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>將指令資訊列印至主控台，然後結束。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkp">
     <term>-v</term>
     <term>--版本</term>
     <listitem>
      <para>顯示 <command>ledmon</command> 的版本以及授權的相關資訊，然後結束。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fbfkq">
   <title>檔案</title>
   <variablelist>
    <varlistentry id="b14fbfkr">
     <term>/var/log/ledmon.log</term>
     <listitem>
      <para>全域記錄檔案，由 <command>ledmon</command> 應用程式使用。若要強制記錄到使用者定義的檔案，請使用 <literal>-l</literal> 選項。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfks">
     <term>~/.ledctl</term>
     <listitem>
      <para>使用者組態檔案，在 <command>ledmon</command> 與所有 <command>ledctl</command> 應用程式例項之間共享。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbfkt">
     <term>/etc/ledcfg.conf</term>
     <listitem>
      <para>全域組態檔案，在 <command>ledmon</command> 與所有 <command>ledctl</command> 應用程式例項之間共享。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fbfku">
   <title>已知問題</title>
   <para><command>ledmon</command> 精靈無法依照 SFF-8489 規格識別 PFA (故障預警分析) 狀態。因此，無法視覺化顯示 PFA 模式。 </para>
  </sect2>
 </sect1>
 <sect1 id="b13jg5lj">
  <title>儲存機殼指示燈控制應用程式 (ledctl(8))</title>
  <para>機殼指示燈應用程式 (<command>ledctl(8)</command>) 是一個使用者空間應用程式，可以控制與儲存機殼或磁碟機槽相關聯的指示燈。<command>ledctl</command> 應用程式是 Intel 機殼指示燈公用程式的一部分。 </para>
  <para>當您發出該指令時，系統會將指定裝置的指示燈設為指定的模式，並會關閉所有其他指示燈。使用者必須具有 root 權限才能使用此應用程式。由於 <command>ledmon</command> 應用程式在存取指示燈時具有最高優先程度，因此如果 <command>ledmon</command> 正在執行，ledctl 設定的某些模式可能不起作用 (Locate 模式除外)。</para>
  <para><command>ledctl</command> 應用程式支援兩種類型的指示燈系統：雙指示燈系統 (活動指示燈和狀態指示燈) 與三指示燈系統 (活動指示燈、失敗指示燈和尋找指示燈)。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14fbijh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fbj24" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcdo6" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fck4r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fck4s" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcmzl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14fcrjc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14fbijh">
   <title>語法</title>

<screen>
ledctl [options] <replaceable>pattern_name</replaceable>=list_of_devices 
</screen>

   <para>以 <systemitem>root</systemitem> 使用者或具有 <systemitem>root</systemitem> 權限的使用者身分發出該指令。</para>
  </sect2>
  <sect2 id="b14fbj24">
   <title>模式名稱</title>
   <para>根據 SFF-8489 規格，<command>ledctl</command> 應用程式接受下列 <guimenu>pattern_name</guimenu> 引數名稱。</para>
   <variablelist>
    <varlistentry id="b14fbl2q">
     <term>locate</term>
     <listitem>
      <para>開啟與指定裝置或空插槽相關聯的定位指示燈。此狀態用於識別插槽或磁碟機。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fbxbj">
     <term>locate_off</term>
     <listitem>
      <para>關閉與指定裝置或空插槽相關聯的定位指示燈。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc0mu">
     <term>normal</term>
     <listitem>
      <para>關閉與指定裝置相關聯的狀態指示燈、失敗指示燈和定位指示燈。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc0mv">
     <term>off</term>
     <listitem>
      <para>僅關閉與指定裝置相關聯的狀態指示燈和失敗指示燈。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc0mw">
     <term>ica</term>
     <term>degraded</term>
     <listitem>
      <para>視覺化顯示 <literal>In a Critical Array</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc1ii">
     <term>rebuild</term>
     <term>rebuild_p</term>
     <listitem>
      <para>視覺化顯示 <literal>Rebuild</literal> 模式。出於相容性和舊版原因，支援這兩種重建狀態。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc1ij">
     <term>ifa</term>
     <term>failed_array</term>
     <listitem>
      <para>視覺化顯示 <literal>In a Failed Array</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc1ik">
     <term>hotspare</term>
     <listitem>
      <para>視覺化顯示 <literal>Hotspare</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc2n0">
     <term>pfa</term>
     <listitem>
      <para>視覺化顯示 <literal>Predicted Failure Analysis</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fc2n1">
     <term>failure</term>
     <term>disk_failed</term>
     <listitem>
      <para>視覺化顯示 <literal>Failure</literal> 模式。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdno">
     <term>ses_abort</term>
     <listitem>
      <para>SES-2 R/R ABORT</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnp">
     <term>ses_rebuild</term>
     <listitem>
      <para>SES-2 REBUILD/REMAP</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnq">
     <term>ses_ifa</term>
     <listitem>
      <para>SES-2 IN FAILED ARRAY</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnr">
     <term>ses_ica</term>
     <listitem>
      <para>SES-2 IN CRITICAL ARRAY</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdns">
     <term>ses_cons_check</term>
     <listitem>
      <para>SES-2 CONS CHECK</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnt">
     <term>ses_hotspare</term>
     <listitem>
      <para>SES-2 HOTSPARE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnu">
     <term>ses_rsvd_dev</term>
     <listitem>
      <para>SES-2 RSVD DEVICE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnv">
     <term>ses_ok</term>
     <listitem>
      <para>SES-2 OK</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnw">
     <term>ses_ident</term>
     <listitem>
      <para>SES-2 IDENT</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnx">
     <term>ses_rm</term>
     <listitem>
      <para>SES-2 REMOVE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdny">
     <term>ses_insert</term>
     <listitem>
      <para>SES-2 INSERT</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdnz">
     <term>ses_missing</term>
     <listitem>
      <para>SES-2 MISSING</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo0">
     <term>ses_dnr</term>
     <listitem>
      <para>SES-2 DO NOT REMOVE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo1">
     <term>ses_active</term>
     <listitem>
      <para>SES-2 ACTIVE</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo2">
     <term>ses_enable_bb</term>
     <listitem>
      <para>SES-2 ENABLE BYP B</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo3">
     <term>ses_enable_ba</term>
     <listitem>
      <para>SES-2 ENABLE BYP A</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo4">
     <term>ses_devoff</term>
     <listitem>
      <para>SES-2 DEVICE OFF</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcdo5">
     <term>ses_fault</term>
     <listitem>
      <para>SES-2 FAULT</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fcdo6">
   <title>模式轉換</title>
   <para>將非 SES-2 模式傳送至機殼中的裝置時，該模式會自動轉換為<xref linkend="b14fcdo7" xrefstyle="TableXRef"/> 中所示的 SCSI 機殼服務 (SES) 2 模式。</para>
   <table id="b14fcdo7" role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <title>非 SES-2 模式與 SES-2 模式之間的轉換</title>
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14fcdo8">
       <entry>
        <para>非 SES-2 模式</para>
       </entry>
       <entry>
        <para>SES-2 模式</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14fcdo9">
       <entry>
        <para>位於</para>
       </entry>
       <entry>
        <para>ses_ident</para>
       </entry>
      </row>
      <row id="b14fcdoa">
       <entry>
        <para>locate_off</para>
       </entry>
       <entry>
        <para>ses_ident</para>
       </entry>
      </row>
      <row id="b14fcdob">
       <entry>
        <para>normal</para>
       </entry>
       <entry>
        <para>ses_ok</para>
       </entry>
      </row>
      <row id="b14fcdoc">
       <entry>
        <para>off</para>
       </entry>
       <entry>
        <para>ses_ok</para>
       </entry>
      </row>
      <row id="b14fcdod">
       <entry>
        <para>ica</para>
       </entry>
       <entry>
        <para>ses_ica</para>
       </entry>
      </row>
      <row id="b14fcdoe">
       <entry>
        <para>degraded</para>
       </entry>
       <entry>
        <para>ses_ica</para>
       </entry>
      </row>
      <row id="b14fcdof">
       <entry>
        <para>rebuild</para>
       </entry>
       <entry>
        <para>ses_rebuild</para>
       </entry>
      </row>
      <row id="b14fcdog">
       <entry>
        <para>rebuild_p</para>
       </entry>
       <entry>
        <para>ses_rebuild</para>
       </entry>
      </row>
      <row id="b14fcdoh">
       <entry>
        <para>ifa</para>
       </entry>
       <entry>
        <para>ses_ifa</para>
       </entry>
      </row>
      <row id="b14fcdoi">
       <entry>
        <para>failed_array</para>
       </entry>
       <entry>
        <para>ses_ifa</para>
       </entry>
      </row>
      <row id="b14fcdoj">
       <entry>
        <para>hotspare</para>
       </entry>
       <entry>
        <para>ses_hotspare</para>
       </entry>
      </row>
      <row id="b14fcdok">
       <entry>
        <para>pfa</para>
       </entry>
       <entry>
        <para>ses_rsvd_dev</para>
       </entry>
      </row>
      <row id="b14fcdol">
       <entry>
        <para>failure</para>
       </entry>
       <entry>
        <para>ses_fault</para>
       </entry>
      </row>
      <row id="b14fcdom">
       <entry>
        <para>disk_failed</para>
       </entry>
       <entry>
        <para>ses_fault</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>
  <sect2 id="b14fck4r">
   <title>裝置清單</title>
   <para>當您發出 <command>ledctl</command> 指令時，系統會將指定裝置的指示燈設為指定的模式，並會關閉所有其他指示燈。裝置清單可採用下列兩種格式之一來提供：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>以逗號分隔且無空格的裝置清單</para>
    </listitem>
    <listitem>
     <para>以空格分隔並用大括號括住的裝置清單</para>
    </listitem>
   </itemizedlist>
   <para>如果在同一個指令中指定多個模式，則每個模式的裝置清單可以使用相同的格式，也可以使用不同的格式。如需顯示兩種清單格式的範例，請參閱<xref linkend="b14fcrjc" xrefstyle="SectTitleOnPage"/>。</para>
   <para>裝置是指向 <filename>/dev</filename> 目錄或 <filename>/sys/block</filename> 目錄中檔案的路徑。路徑可以識別區塊裝置、MD 軟體 RAID 裝置或容器裝置。對於軟體 RAID 裝置或容器裝置，將會為所有相關聯的區塊裝置設定所報告的指示燈狀態。</para>
   <para>list_of_devices 中列出之裝置的指示燈將設為指定的模式 pattern_name，且所有其他指示燈都將關閉。 </para>
  </sect2>
  <sect2 id="b14fck4s">
   <title>選項</title>
   <variablelist>
    <varlistentry id="b14fck4t">
     <term>-c</term>
     <term>--confg=path</term>
     <listitem>
      <para>設定本地組態檔案的路徑。如果指定了此選項，則全域組態檔案與使用者組態檔案都將無效。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4u">
     <term>-l</term>
     <term>--log=path</term>
     <listitem>
      <para>設定本地記錄檔案的路徑。如果指定了此使用者定義的檔案，則不會使用全域記錄檔案 <filename>/var/log/ledmon.log</filename>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4v">
     <term>--quiet</term>
     <listitem>
      <para>關閉傳送至 <filename>stdout</filename> 或從 <filename>stderr</filename> 傳出的所有訊息。但這些訊息仍會記錄到本地檔案和 <filename>syslog</filename> 工具中。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4w">
     <term>-h</term>
     <term>--help</term>
     <listitem>
      <para>將指令資訊列印至主控台，然後結束。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fck4x">
     <term>-v</term>
     <term>--版本</term>
     <listitem>
      <para>显示 <command>ledctl</command> 的版本以及许可证的相关信息，然后退出。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fcmzl">
   <title>檔案</title>
   <variablelist>
    <varlistentry id="b14fcmzm">
     <term>/var/log/ledctl.log</term>
     <listitem>
      <para>全域記錄檔案，由 <command>ledctl</command> 應用程式的所有例項使用。若要強制記錄到使用者定義的檔案，請使用 <literal>-l</literal> 選項。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcmzn">
     <term>~/.ledctl</term>
     <listitem>
      <para>使用者組態檔案，在 <command>ledmon</command> 與所有 <command>ledctl</command> 應用程式例項之間共享。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="b14fcmzo">
     <term>/etc/ledcfg.conf</term>
     <listitem>
      <para>全域組態檔案，在 <command>ledmon</command> 與所有 <command>ledctl</command> 應用程式例項之間共享。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 id="b14fcrjc">
   <title>範例</title>
   <para>尋找單個區塊裝置：</para>

<screen>
ledctl locate=/dev/sda
</screen>

   <para>關閉單個區塊裝置的「尋找指示燈」：</para>

<screen>
ledctl locate_off=/dev/sda
</screen>

   <para>尋找 MD 軟體 RAID 裝置的磁碟，並同時為其兩個區塊裝置設定重建模式：</para>

<screen>
ledctl locate=/dev/md127 rebuild={ /sys/block/sd[a-b] }
</screen>

   <para>關閉指定裝置的「狀態指示燈」和「失敗指示燈」：</para>

<screen>
ledctl off={ /dev/sda /dev/sdb }
</screen>

   <para>尋找三個區塊裝置：</para>

<screen>
ledctl locate=/dev/sda,/dev/sdb,/dev/sdc

ledctl locate={ /dev/sda /dev/sdb /dev/sdc }
</screen>

  </sect2>
 </sect1>
 <sect1 id="b13jg5lk">
  <title>機殼指示燈公用程式組態檔案 (ledctl.conf(5))</title>
  <para><filename>ledctl.conf</filename> 檔案是 Intel 機殼指示燈公用程式的組態檔案。這些公用程式目前不使用組態檔案。檔案的名稱和位置已保留，供日後功能改良之用。 </para>
 </sect1>
 <sect1 id="b14feg6m">
  <title>其他資訊</title>
  <para>如需指示燈模式和監控工具的詳細資料，請參閱下列資源：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="http://ledmon.sourceforge.net/">Sourceforge.net 上的 LEDMON 開放原始碼專案</ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="ftp://ftp.seagate.com/sff/SFF-8485.PDF">SGPIO 規格 SFF-8485</ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="ftp://ftp.seagate.com/sff/SFF-8489.PDF">IBPI 規格 SFF-8489</ulink></para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>

<chapter id="isns" lang="zh-tw" xml:base="06_isns.xml">
 <title>iSNS for Linux</title>
 <para>儲存區域網路 (SAN) 可包含許多在複雜網路中散佈的磁碟機。這可能會使探查及擁有裝置變得困難。iSCSI 啟動程式必須可識別 SAN 中的儲存資源，並確定這些資源是否已進行存取。 </para>
 <para>網際網路儲存名稱服務 (iSNS) 是一項標準式服務，可便於自動化探查、管理和設定 TCP/IP 網路上的 iSCSI 裝置。iSNS 提供可與光纖通道媲美的智能儲存探查與管理服務。</para>
 <important>
  <para>iSNS 只可用於安全的內部網路中。</para>
 </important>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sec-isns-overview" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-iscsi-setup" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchyh0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi0bdwd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi0cewc" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bgchyhq" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sec-isns-overview">
  <title>iSNS 的工作原理</title>
  <para>若要讓 iSCSI 啟動程式探查 iSCSI 目標，則需要識別網路中屬於儲存資源的裝置及需要存取的 IP 位址。對於 iSNS 伺服器的查詢會傳回應用程式有權存取的 iSCSI 目標與 IP 位址。 </para>
  <para>透過使用 iSNS，您就可以建立 iSNS 探查網域與探查集。然後將 iSCSI 目標與啟動程式分組或組織到探查網域中，並將探查網域分組到探查網域集中。透過將儲存節點劃分為網域，您就可以將每台主機的探查程序限定為使用 iSNS 註冊的目標之最合適的子集，這樣就可透過減少不必要的探查數量並限制每台主機用於建立探查關係所耗費的時間讓儲存網路進行縮放。此操作可讓您控制並簡化必須進行探查的目標與啟動程式的數量。 </para>
  <figure pgwide="0" id="bcna0wb">
   <title>iSNS 探查網域與探查網域集</title>
   <mediaobject>
    <imageobject>
    <imagedata fileref="isns_a.png" width="329pt" format="png"/></imageobject>
   </mediaobject>
  </figure>
  <para>iSCSI 目標與 iSCSI 啟動程式都是使用 iSNS 用戶端透過 iSNS 通訊協定啟動與 iSNS 伺服器的異動。然後在常見探查網域中註冊裝置屬性資訊，下載其他註冊用戶端相關的資訊，並接收發生在探查網域中的事件之非同步通知。 </para>
  <para>iSNS 伺服器會回應 iSNS 用戶端使用 iSNS 通訊協定作出的 iSNS 通訊協定查詢與申請。iSNS 伺服器會啟動 iSNS 通訊協定狀態變更通知，並將註冊申請提交的經適當驗證的資訊儲存到 iSNS 資料庫中。 </para>
  <para>iSNS for Linux 提供的部分利益包括︰ </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>為註冊、探查與管理網路內的儲存資產帶來資訊便利。 </para>
   </listitem>
   <listitem>
    <para>與 DNS 基礎結構相整合。 </para>
   </listitem>
   <listitem>
    <para>合併 iSCSI 儲存的註冊、探查與管理。 </para>
   </listitem>
   <listitem>
    <para>簡化了儲存管理實作。 </para>
   </listitem>
   <listitem>
    <para>與其他探查方法相比，提高了擴充性。 </para>
   </listitem>
  </itemizedlist>
  <para>透過以下的情況可以讓您更了解 iSNS 所能提供的利益。 </para>
  <para>假設您擁有一個包含 100 個 iSCSI 啟動程式與 100 個 iSCSI 目標的公司。根據您的配置，所有 iSCSI 啟動程式可能會嘗試探查並連接到 100 個 iSCSI 目標中的任一一個。這樣可能會造成探查與連接方面的問題。透過將啟動程式與目標分組到探查網域中，您就可以阻止一個部門中的 iSCSI 啟動程式探查另一個部門中的 iSCSI 目標。導致特定部門中的 iSCSI 啟動程式僅會探查屬於該部門探查網域的 iSCSI 目標。 </para>
 </sect1>
 <sect1 id="sec-iscsi-setup">
  <title>安裝 iSNS Server for Linux</title>
  <para>iSNS Server for Linux 隨附於 SLES 10 SP2 及更高版本中，但預設不會對其加以安裝或設定。您必須安裝 iSNS 套件模組 (<filename>isns</filename> 與 <filename>yast2-isns</filename> 模組) 並設定 iSNS 服務。 </para>
  <note>
   <para>可將 iSNS 安裝在 iSCSI 目標或 iSCSI 起始程式軟體所在的伺服器上。不能將 iSCSI 目標軟體與 iSCSI 起始程式軟體安裝在同一部伺服器上。 </para>
  </note>
  <para>安裝 iSNS for Linux︰ </para>
  <procedure id="bgchygw">
   <step id="bgchygx" performance="required">
    <para>啟動 YaST 並選取<guimenu>網路服務</guimenu><guimenu>iSNS 伺服器</guimenu>。</para>
   </step>
   <step id="bi0bpeh" performance="required">
    <para>提示安裝 <filename>isns</filename> 套件時按一下<guimenu>安裝</guimenu>。</para>
   </step>
   <step id="bi0bq1e" performance="required">
    <para>依照安裝指示提供 SUSE Linux Enterprise Server 11 安裝磁碟。</para>
    <para role="intro">安裝完成後，iSNS 服務組態對話方塊會自動開啟至<guimenu>服務</guimenu>索引標籤。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="isns_config_a.png" width="307pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bi0bxbd" performance="required">
    <para>在<guimenu>iSNS 伺服器位址</guimenu>中，指定 iSNS 伺服器的 DNS 名稱或 IP 位址。</para>
   </step>
   <step id="bgchygy" performance="required">
    <para>在<guimenu>服務啟動</guimenu>中選取下列其中一項： </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bi0c15l">
       <title>開機時：</title>
       <para>iSNS 服務在伺服器啟動時自動啟動。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bi0c69a">
       <title>手動 (預設)：</title>
       <para>必須在用於安裝 iSNS 服務之伺服器的主控台中手動輸入 <command>rcisns start</command> 或 <command>/etc/init.d/isns start</command>，從而啟動 iSNS 服務。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step id="bi0c2ei" performance="required">
    <para>指定下列防火牆設定：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bi0c69b">
       <title>在防火牆中開啟埠︰</title>
       <para>選取核取方塊開啟防火牆，並允許從遠端電腦存取服務。預設關閉防火牆連接埠。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bi0c69c">
       <title>防火牆詳細資料︰</title>
       <para>如果開啟防火牆連接埠，則依預設會在所有網路介面上開啟連接埠。按一下<guimenu>防火牆詳細資料</guimenu>選取要在其上開啟連接埠的介面，並選取要使用的網路，然後按一下<guimenu>確定</guimenu>。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step id="bgchygz" performance="required">
    <para>按一下<guimenu>完成</guimenu>可套用組態設定並完成安裝。 </para>
   </step>
   <step id="bi0c7d1" performance="required">
    <para>請繼續執行<xref linkend="bgchyh0" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bgchyh0">
  <title>設定 iSNS 探查網域</title>
  <para>若要讓 iSCSI 啟動器與 iSCSI 目標使用 iSNS 服務，則它們必須屬於探查網域。 </para>
  <important>
   <para>必須已安裝並執行 SNS 服務，才能設定 iSNS 探查網域。如需更多資訊，請參閱<xref linkend="bi0bdwd" xrefstyle="SectTitleOnPage"/>。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="sec-isns-ddcreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-isns-ddscreate" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-isns-ddadd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-isns-ddsadd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="sec-isns-ddcreate">
   <title>建立 iSNS 探查網域</title>
   <para>安裝 iSNS 服務時，會自動建立名稱為 <guimenu>default DD</guimenu> 的預設探查網域。設定使用 iSNS 的現有 iSCSI 目標與啟動程式會自動新增至預設探查網域。 </para>
   <para>建立新的探查網域︰ </para>
   <procedure id="bgchyh5">
    <step id="bgchyh6" performance="required">
     <para>啟動 YaST，然後在<guimenu>網路服務</guimenu>之下選取<guimenu>iSNS 伺服器</guimenu>。 </para>
    </step>
    <step id="bgchyh7" performance="required">
     <para>按一下<guimenu>探查網域</guimenu>索引標籤。 </para>
     <para><guimenu>探查網域</guimenu>區域列出了所有探查網域。您可以建立新的探查網域，也可以刪除現有探查網域。刪除網域會移除其成員，但不會刪除 iSCSI 節點成員。</para>
     <para><guimenu>探查網域成員</guimenu>區域列出了為所選探查網域指定的所有 iSCSI 節點。如果選取其他探查網域，則會重新整理清單，並列出該探查網域的成員。您可以對選取的探查網域新增或刪除 iSCSI 節點。如果刪除 iSCSI 節點，則會將其從網域中移除，但不會刪除該 iSCSI 節點。</para>
     <para>如果建立 iSCSI 節點，即可將尚未註冊的節點新增為探查網域成員。該節點經 iSCSI 啟動器或目標註冊後，就會成為此網域的一部分。 </para>
     <para role="intro">iSCSI 啟動器執行探查申請時，iSNS 服務會傳回屬於同一探查網域的所有 iSCSI 節點目標。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_discdomains_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bi0cku8" performance="required">
     <para>按一下<guimenu>建立探查網域</guimenu>按鈕。 </para>
     <para>您也可以選取現有的探查網域，然後按一下<guimenu>刪除</guimenu>按鈕移除該探查網域。 </para>
    </step>
    <step id="bgchyh8" performance="required">
     <para>指定您正在建立的探查網域之名稱，然後按一下<guimenu>確定</guimenu>。 </para>
    </step>
    <step id="bi71u1v" performance="required">
     <para>請繼續執行<xref linkend="sec-isns-ddscreate" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec-isns-ddscreate">
   <title>建立 iSNS 探查網域集</title>
   <para>探查網域必須屬於探查網域集。您可以建立探查網域並將節點新增至該探查網域，但是不起作用，並且 iSNS 服務也不起作用，除非您將探查網域新增至探查網域集。安裝 iSNS 時會自動建立名稱為 <guimenu>default DDS</guimenu> 的預設探查網域集，並且預設探查網域會自動新增至該網域集。 </para>
   <para>建立探查網域集︰ </para>
   <procedure id="bgchyh9">
    <step id="bgchyha" performance="required">
     <para>啟動 YaST，然後在<guimenu>網路服務</guimenu>之下選取<guimenu>iSNS 伺服器</guimenu>。 </para>
    </step>
    <step id="bi0cs2c" performance="required">
     <para>按一下<guimenu>探查網域集</guimenu>索引標籤。 </para>
     <para><guimenu>探查網域集</guimenu>區域列出了所有探查網域集。探查網域必須是探查網域集的成員，否則無法使用。</para>
     <para>在 iSNS 資料庫中，探查網域集包含多個探查網域，而後者又包含多個 iSCSI 節點成員。 </para>
     <para><guimenu>探查網域集成員</guimenu>區域列出了為所選探查網域集指定的所有探查網域。如果選取其他探查網域集，則會重新整理清單，並列出該探查網域集的成員。您可以對選取的探查網域集新增或刪除探查網域。如果移除探查網域，會將其從網域集中移除，但不會刪除該探查網域。</para>
     <para>如果向網域集新增探查網域，即可將尚未註冊的 iSNS 探查網域新增為探查網域集的成員。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_discdomainsets_a.png" width="422pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bgchyhb" performance="required">
     <para>按一下<guimenu>建立探查網域集</guimenu>按鈕。 </para>
     <para>您也可以選取現有的探查網域集，然後按一下<guimenu>刪除</guimenu>按鈕移除該探查網域集。 </para>
    </step>
    <step id="bgchyhc" performance="required">
     <para>指定您正在建立的探查網域集之名稱，然後按一下<guimenu>確定</guimenu>。</para>
    </step>
    <step id="bi71u8j" performance="required">
     <para>請繼續執行<xref linkend="sec-isns-ddadd" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec-isns-ddadd">
   <title>將 iSCSI 節點新增至探查網域</title>
   <procedure id="bgchyhd">
    <step id="bgchyhe" performance="required">
     <para>啟動 YaST，然後在<guimenu>網路服務</guimenu>之下選取<guimenu>iSNS 伺服器</guimenu>。 </para>
    </step>
    <step id="bi0csq8" performance="required">
     <para>按一下<guimenu>iSCSI 節點</guimenu>索引標籤。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="isns_iscsinodes_a.png" width="422pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bgchyhf" performance="required">
     <para>檢閱節點清單，確定已列出要使用 iSNS 服務的 iSCSI 目標和啟動器。 </para>
     <para>若未列出 iSCSI 目標或啟動程式，您可能需要重新啟動節點上的 iSCSI 服務。您可以透過執行 <command>rcopen-iscsi restart</command> 指令重新啟動啟動程式或 <command>rciscsitarget restart</command> 指令重新啟動目標執行此作業。 </para>
     <para>您可以選取 iSCSI 節點，然後按一下<guimenu>刪除</guimenu>按鈕將該節點從 iSNS 資料庫移除。若您不再使用 iSCSI 節點或已對該節點進行重新命名，這會帶來幫助。 </para>
     <para>除非您移除 iSCSI 組態檔案的 iSNS 部分或將其注解化，否則在重新啟動 SCSI 服務或伺服器時，iSCSI 節點會自動再次新增至清單 (iSNS 資料庫)。 </para>
    </step>
    <step id="bgchyhg" performance="required">
     <para>按一下<guimenu>探查網域</guimenu>索引標籤，選取所需的探查網域，然後再按<guimenu>顯示成員</guimenu>按鈕。 </para>
    </step>
    <step id="bgchyhh" performance="required">
     <para>按一下<guimenu>新增現有的 iSCSI 節點</guimenu>，選取您要新增至網域的節點，然後再按<guimenu>新增節點</guimenu>。 </para>
    </step>
    <step id="bgchyhi" performance="required">
     <para>對要新增至探查網域的所有節點重複<xref linkend="bgchyho" xrefstyle="StepXRef"/>，完成新增後按一下<guimenu>完成</guimenu>。 </para>
     <para>一個 iSCSI 節點可屬於多個探查網域。 </para>
    </step>
    <step id="bi71uie" performance="required">
     <para>請繼續執行<xref linkend="sec-isns-ddsadd" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec-isns-ddsadd">
   <title>將探查網域新增至探查網域集</title>
   <procedure id="bgchyhj">
    <step id="bgchyhk" performance="required">
     <para>啟動 YaST，然後在<guimenu>網路服務</guimenu>之下選取<guimenu>iSNS 伺服器</guimenu>。 </para>
    </step>
    <step id="bgchyhl" performance="required">
     <para>按一下<guimenu>探查網域集</guimenu>索引標籤。 </para>
    </step>
    <step id="bgchyhm" performance="required">
     <para>選取<guimenu>建立探查網域集</guimenu>可將新集新增至探查網域集清單。 </para>
    </step>
    <step id="bgchyhn" performance="required">
     <para>選取要修改的探查網域集。 </para>
    </step>
    <step id="bgchyho" performance="required">
     <para>按一下<guimenu>新增探查網域</guimenu>，選取要新增至探查網域集的探查網域，再按<guimenu>新增探查網域</guimenu>。 </para>
    </step>
    <step id="bgchyhp" performance="required">
     <para>為要新增至探查網域集的探查網域重複最後一步，然後按一下<guimenu>完成</guimenu>。 </para>
     <para>一個探查網域可屬於多個探查網域集。 </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="bi0bdwd">
  <title>啟動 iSNS</title>
  <para>iSNS 必須在所安裝到的伺服器上啟動。以 <systemitem>root</systemitem> 使用者身分在終端機主控台中輸入以下其中一則指令：</para>

<screen>
<command>rcisns start</command> 
</screen>


<screen>
<command>/etc/init.d/isns start</command>
</screen>

  <para>您也可以使用 iSNS 的 <command>stop</command>、<command>status</command> 與 <command>restart</command> 選項。</para>
  <para>iSNS 也可設定為在每次伺服器重新開機時自動啟動： </para>
  <procedure id="bgchyh1">
   <step id="bgchyh2" performance="required">
    <para>啟動 YaST，然後在<guimenu>網路服務</guimenu>之下選取<guimenu>iSNS 伺服器</guimenu>。 </para>
   </step>
   <step id="bgchyh3" performance="required">
    <para>選取了<guimenu>服務</guimenu>索引標籤之後，指定 iSNS 伺服器的 IP 位址，然後按一下<guimenu>儲存位址</guimenu>。 </para>
   </step>
   <step id="bgchyh4" performance="required">
    <para>在螢幕的<guimenu>服務啟動</guimenu>區段中，選取<guimenu>開機時</guimenu>。 </para>
    <para>您也可以選擇手動啟動 iSNS 伺服器。每次伺服器重新啟動時，您必須使用 <command>rcisns start</command> 指令啟動服務 </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bi0cewc">
  <title>停止 iSNS</title>
  <para>iSNS 必須在執行其所在的伺服器上停止。以 <systemitem>root</systemitem> 使用者身分在終端機主控台中輸入以下其中一則指令：</para>

<screen>
<command>rcisns stop</command> 
</screen>


<screen>
<command>/etc/init.d/isns stop</command> 
</screen>

 </sect1>
 <sect1 id="bgchyhq">
  <title>更多資訊</title>
  <para>如需相關資訊，請參閱 <ulink url="http://sourceforge.net/projects/linuxisns/"><citetitle>Linux iSNS for iSCSI project</citetitle></ulink>。這個專案的電子郵件清單為 <ulink url="http://sourceforge.net/mailarchive/forum.php?forum_name=linuxisns-discussion"><citetitle>Linux iSNS - Discussion (Linux iSNS - 討論)</citetitle></ulink>。 </para>
  <para>如需關於 iSNS 的一般資訊，請參閱 <ulink url="http://www.ietf.org/rfc/rfc4171"><citetitle>RFC 4171：網際網路儲存裝置名稱服務</citetitle></ulink>。 </para>
 </sect1>
</chapter>

<chapter id="cha-inst-system-iscsi" lang="zh-tw" xml:base="06_iscsi.xml">
 <title>IP 網路上的大型儲存裝置：iSCSI </title>
 <para>如何為伺服器系統提供硬碟容量，是電腦中心以及操作伺服器時的一項關鍵任務。為此通常使用光纖通道。iSCSI (網際網路 SCSI) 解決方案的實施成本較低，可用來替代光纖通道，並能充分發揮商用伺服器與乙太網路設備的價值。Linux iSCSI 提供 iSCSI 啟動器和目標軟體，用於將 Linux 伺服器連接至中央儲存系統。</para>
 <figure pgwide="0" id="bo1n90f">
  <title>配有 iSNS 伺服器的 iSCSI SAN</title>
  <mediaobject>
   <imageobject role="fo">
   <imagedata fileref="iscsi_san_a.png" width="445pt" format="eps"/></imageobject>
   <imageobject role="html">
   <imagedata fileref="iscsi_san_a.png" width="445pt" format="png"/></imageobject>
  </mediaobject>
 </figure>
 <para>iSCSI 是一種儲存網路通訊協定，可以透過 TCP/IP 網路在區塊儲存裝置與伺服器之間傳輸 SCSI 封包的資料。iSCSI 目標軟體在目標伺服器上執行，並將邏輯單元定義為 iSCSI 目標裝置。iSCSI 啟動器軟體在不同伺服器上執行，然後會連接到目標裝置，以使該伺服器上的儲存裝置可用。 </para>
 <important>
  <para>在線上環境中，不能在同一部伺服器上執行 iSCSI 目標軟體與 iSCSI 啟動器軟體。</para>
 </important>
 <para>iSCSI 目標與啟動器伺服器之間透過在 LAN 的 IP 層級上傳送 SCSI 封包這種方式進行通訊。如果在啟動器伺服器上執行的應用程式發出 iSCSI 目標裝置查詢，作業系統會產生必要的 SCSI 指令。接著，通常稱為 <emphasis>iSCSI 啟動器</emphasis>的軟體會根據需要將 SCSI 指令嵌入 IP 封包並加密。這些封包隨後會透過內部 IP 網路傳輸到對應的 iSCSI 遠端工作站，稱為 <emphasis>iSCSI 目標</emphasis>。 </para>
 <para>許多儲存解決方案提供透過 iSCSI 的存取方式，但還另一種可能就是執行提供 iSCSI 目標的 Linux 伺服器。在這種情況下，針對檔案系統服務設定最佳化的 Linux 伺服器是很重要的。iSCSI 目標會存取 Linux 中的區塊裝置，因此，您可以使用 RAID 解決方案來增加磁碟空間及大量記憶體來提高資料快取效率。如需關於 RAID 的詳細資訊，請參閱<xref linkend="raidyast" xrefstyle="ChapTitleOnPage"/>。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bj4rqa5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-target" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-initiator" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bwkrqdd" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-ts" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sec-inst-system-iscsi-initiator-info" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bj4rqa5">
  <title>安裝 iSCSI 目標與啟動器</title>
  <para>YaST 包含 iSCSI 目標和 iSCSI 啟動器軟體的項目，但預設不會安裝這些套件。 </para>
  <important>
   <para>在線上環境中，不能在同一部伺服器上執行 iSCSI 目標軟體與 iSCSI 啟動器軟體。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bj4rsgl" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bj4rrj9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bj4rsgl">
   <title>安裝 iSCSI 目標軟體</title>
   <para>將 iSCSI 目標軟體安裝到要建立 iSCSI 目標裝置的伺服器上。</para>
   <procedure id="bj4rsgm">
    <step id="bj4rsgn" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
    </step>
    <step id="bj4rsgo" performance="required">
     <para>選取<guimenu>網路服務</guimenu>&gt;<guimenu>iSNS 目標</guimenu>。</para>
    </step>
    <step id="bj4rsma" performance="required">
     <para>當系統提示您安裝 <filename>iscsitarget</filename> 套件時按一下<guimenu>安裝</guimenu>。</para>
    </step>
    <step id="bj4rsz7" performance="required">
     <para>依照畫面上的安裝指示操作，並在需要時提供安裝媒體。</para>
     <para>安裝完成後，YaST 會開啟至「iSCSI 目標綜覽」頁面的<guimenu>服務</guimenu>索引標籤中。</para>
    </step>
    <step id="bj58wf8" performance="required">
     <para>請繼續執行<xref linkend="sec-inst-system-iscsi-target" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="bj4rrj9">
   <title>安裝 iSCSI 啟動器軟體</title>
   <para>將 iSCSI 啟動器軟體安裝到要存取 iSCSI 目標伺服器上設定之目標裝置的每部伺服器。 </para>
   <procedure id="bj4rqhd">
    <step id="bj4rqhe" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
    </step>
    <step id="bj4rqsk" performance="required">
     <para>選取<guimenu>網路服務</guimenu><guimenu>iSCSI 啟動器</guimenu>。</para>
    </step>
    <step id="bj4rsth" performance="required">
     <para>當系統提示您安裝 <filename>open-iscsi</filename> 套件時按一下<guimenu>安裝</guimenu>。</para>
    </step>
    <step id="bj4rt8u" performance="required">
     <para>依照畫面上的安裝指示操作，並在需要時提供安裝媒體。</para>
     <para>安裝完成後，YaST 會開啟至「iSCSI 啟動器綜覽」頁面的<guimenu>服務</guimenu>索引標籤中。</para>
    </step>
    <step id="bj4saer" performance="required">
     <para>請繼續執行<xref linkend="sec-inst-system-iscsi-initiator" xrefstyle="SectTitleOnPage"/>。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sec-inst-system-iscsi-target">
  <title>設定 iSCSI 目標</title>
  <para>SUSE Linux Enterprise Server 隨附一個由 Ardis iSCSI 目標演進而來的開放原始碼 iSCSI 目標解決方案。使用 YaST 即可完成基本設定，但如果要充分利用 iSCSI 的優點，就必須用手動設定。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bj5erpx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-target-yast" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-target-manual" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-target-ietadm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bj5erpx">
   <title>準備儲存空間</title>
   <para>iSCSI 目標組態會將現有區塊裝置輸出到 iSCSI 啟動器中。您必須準備要用於目標裝置的儲存空間，方法是使用 YaST 中的磁碟分割程式來設定未格式化的分割區或裝置，或從指令行對裝置進行磁碟分割。iSCSI LIO 目標能夠以 Linux、Linux LVM 或 Linux RAID 檔案系統 ID 來使用未格式化的分割區。 </para>
   <important>
    <para>將某個裝置或分割區設定為 iSCSI 目標後，您將無法再透過其本地路徑直接存取它。請勿在建立時為其指定掛接點。</para>
   </important>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bj5rdlu" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bj5py87" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bj5rdlu">
    <title>分割裝置</title>
    <procedure id="bj5expw">
     <step id="bj5expx" performance="required">
      <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
     </step>
     <step id="bj5f8l7" performance="required">
      <para>選取<guimenu>系統</guimenu><guimenu>磁碟分割程式</guimenu>。</para>
     </step>
     <step id="bj5f902" performance="required">
      <para>按一下<guimenu>是</guimenu>繼續顯示關於使用磁碟分割程式的警告。</para>
     </step>
     <step id="bj5f9hl" performance="required">
      <para>按一下<guimenu>新增</guimenu>建立分割區，但不對其進行格式化，也不進行掛接。 </para>
      <substeps performance="required">
       <step id="bj5fl5y" performance="required">
        <para>選取<guimenu>主分割區</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
       </step>
       <step id="bj5fld1" performance="required">
        <para>指定要使用的空間大小，然後按<guimenu>下一步</guimenu>。</para>
       </step>
       <step id="bj5flp9" performance="required">
        <para>選取<guimenu>不格式化</guimenu>，然後指定檔案系統 ID 類型。</para>
        <para>iSCSI 目標能夠以 Linux、Linux LVM 或 Linux RAID 檔案系統 ID 來使用未格式化的分割區。</para>
       </step>
       <step id="bj5flz6" performance="required">
        <para>選取<guimenu>不掛接</guimenu>。</para>
       </step>
       <step id="bj5fm1h" performance="required">
        <para>按一下<guimenu>完成</guimenu>。</para>
       </step>
      </substeps>
     </step>
     <step id="bj5fjxr" performance="required">
      <para>對稍後要用做 iSCSI LUN 的所有區域重複<xref linkend="bj5f9hl" xrefstyle="StepXRef"/>。</para>
     </step>
     <step id="bj5fm9v" performance="required">
      <para>按一下<guimenu>接受</guimenu>保留變更，然後關閉 YaST。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bj5py87">
    <title>對虛擬環境中的裝置進行磁碟分割</title>
    <para>您可以使用 Xen 訪客伺服器做為 iSCSI 目標伺服器。您必須為客體虛擬機器指定要用於 iSCSI 儲存裝置的儲存空間，然後在客體環境內以虛擬磁碟的方式存取該空間。每個虛擬磁碟可以是實體區塊裝置，如整個磁碟、分割區或磁碟區，也可以是檔案備份磁碟影像，其中虛擬磁碟是 Xen 主機伺服器中較大實體磁碟上的一個影像檔案。為獲得最佳效能，請從實體磁碟或分割區建立所有虛擬磁碟。為訪客虛擬機器設定虛擬磁碟後，啟動訪客伺服器，然後依照與實體伺服器相同的程序將新的空白虛擬磁碟設定為 iSCSI 目標裝置。 </para>
    <para>檔案備份磁碟影像建立在 Xen 主機伺服器上，然後會指定給 Xen 客體伺服器。依預設，Xen 會將檔案備份磁碟影像儲存到 <filename>/var/lib/xen/images/<replaceable>vm 名稱</replaceable></filename>目錄中，其中 <filename><replaceable>vm 名稱</replaceable></filename>為虛擬機器的名稱。</para>
    <para>例如，若要建立大小為 4GB 的磁碟影像 <filename>/var/lib/xen/images/vm_one/xen-0</filename>，請先確定該目錄已存在，然後再建立影像本身。</para>
    <procedure id="bj5q7wn">
     <step id="bj5q7wo" performance="required">
      <para>以 <systemitem>root</systemitem> 使用者的身分登入主機伺服器。</para>
     </step>
     <step id="bj5q4xg" performance="required">
      <para>在終端機主控台提示符處，輸入下列指令</para>

<screen>
mkdir -p /var/lib/xen/images/vm_one
dd if=/dev/zero of=/var/lib/xen/images/vm_one/xen-0 seek=1M bs=4096 count=1
</screen>

     </step>
     <step id="bj5q56y" performance="required">
      <para>將檔案系統影像指定給 Xen 組態檔案中的訪客虛擬機器。</para>
     </step>
     <step id="bj5q81p" performance="required">
      <para>以 <systemitem>root</systemitem> 使用者身分登入訪客伺服器，然後依照<xref linkend="bj5rdlu" xrefstyle="HeadingOnPage"/> 中的程序使用 YaST 設定虛擬區塊裝置。</para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="sec-inst-system-iscsi-target-yast">
   <title>使用 YaST 建立 iSCSI 目標</title>
   <para>
    若要設定 iSCSI 目標，請在 YaST 中執行 <guimenu>iSCSI 目標</guimenu>模組 (指令 <command>yast2 iscsi-server</command>)。組態分為三個索引標籤：在<guimenu>服務</guimenu>索引標籤中，選取啟動模式和防火牆設定。如果要從遠端機器存取 iSCSI 目標，請選取<guimenu>在防火牆中開啟埠</guimenu>。若 iSNS 伺服器應管理探查與存取控制，請啟用<guimenu>iSNS 存取控制</guimenu>，然後輸入 iSNS 伺服器的 IP 位址。您無法使用主機名稱或 DNS 名稱，而必須使用 IP 位址。如需 iSNS 相關的詳細資訊，請閱讀<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>。
   </para>
   <para>
    <guimenu>全域</guimenu>索引標籤提供 iSCSI 伺服器的設定。此處所設定的驗證將用來探查服務，而不是用於存取目標。如果不想將存取僅限於搜索，請使用<guimenu>無驗證</guimenu>。
   </para>
   <para>
    如果需要驗證，就必須考慮兩種可能性。<guimenu>內送驗證</guimenu>需要啟動器證明它有權在 iSCSI 目標上執行探查。<guimenu>外送驗證</guimenu>需要 iSCSI 目標證明它是預期的目標。因此，iSCSI 目標也可以提供使用者名稱和密碼。<ulink url="http://www.ietf.org/rfc/rfc3720.txt"><citetitle>RFC 3720</citetitle></ulink> 提供了有關驗證的詳細資訊。
   </para>
   <para>
    目標是在<guimenu>目標</guimenu>索引標籤中定義。使用<guimenu>新增</guimenu>可建立新的 iSCSI 目標。第一個對話方塊會詢問要輸出的裝置相關資訊。 </para>
   <variablelist>
    <varlistentry id="bgchy7j">
     <term>目標</term>
     <listitem>
      <para role="intro"><guimenu>目標</guimenu>行有類似下列固定語法： </para>

<screen>
iqn.yyyy-mm.&lt;reversed domain name&gt;:<replaceable>unique_id</replaceable>
</screen>

      <para>開頭一定是 iqn。yyyy-mm 則採用目標啟用時的日期格式。如需更多有關命名慣例的資訊，請參閱 <ulink url="http://www.ietf.org/rfc/rfc3722.txt"><citetitle>RFC 3722</citetitle></ulink>。</para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchy7k">
     <term>Identifier</term>
     <listitem>
      <para><guimenu>識別碼</guimenu>可自由選取。它應該遵循某些機制，使系統結構更為一致。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchy7l">
     <term>LUN</term>
     <listitem>
      <para>數個 LUN 可以指定給一個目標。若要執行此操作，請在<guimenu>目標</guimenu>索引標籤中選取目標，然後按一下<guimenu>編輯</guimenu>。然後，向現有的目標新增新的 LUN。 </para>
     </listitem>
    </varlistentry>
    <varlistentry id="bgchy7m">
     <term>路徑</term>
     <listitem>
      <para>新增要輸出的區塊裝置或檔案系統影像的路徑。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>下一個功能表可設定目標的存取限制。組態非常類似探查驗證的組態。在這裡，您至少必須設定內送驗證。 </para>
   <para><guimenu>下一步</guimenu>會完成新目標的組態，讓您回到<guimenu>目標</guimenu>索引標籤的綜覽頁面。最後按一下<guimenu>完成</guimenu>啟動變更。</para>
   <para>若要建立目標裝置：</para>
   <procedure id="bj5fomq">
    <step id="bj5fomr" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
    </step>
    <step id="bj5foms" performance="required">
     <para>選取<guimenu>網路服務</guimenu>&gt;<guimenu>iSNS 目標</guimenu>。</para>
     <para role="intro">YaST 會開啟至「iSCSI 目標綜覽」頁面的<guimenu>服務</guimenu>索引標籤中。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="iscsi_target_service_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bj5fomv" performance="required">
     <para>在<guimenu>服務啟動</guimenu>區域中選取下列其中一項：</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara id="bj5fomw">
        <title>開機時：</title>
        <para>以後伺服器重新開機時自動啟動啟動器服務。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="bj5fomx">
        <title> 手動 (預設)：</title>
        <para>手動啟動服務。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </step>
    <step id="bj5fomy" performance="required">
     <para>如果您是使用 iSNS 通告目標，請選取<guimenu>iSNS 存取控制</guimenu>核取方塊，然後輸入 IP 位址。</para>
    </step>
    <step id="bj5fydf" performance="required">
     <para>若需要，可開啟防火牆埠以允許從遠端電腦存取伺服器。</para>
     <substeps performance="required">
      <step id="bj5fomz" performance="required">
       <para>選取<guimenu>在防火牆中開啟埠</guimenu>核取方塊。</para>
      </step>
      <step id="bj5fon0" performance="required">
       <para>指定要開啟連接埠的網路介面，方法是按一下<guimenu>防火牆細節</guimenu>，選取該網路介面旁的核取方塊將其啟用，然後按一下<guimenu>確定</guimenu>接受設定。</para>
      </step>
     </substeps>
    </step>
    <step id="bj5fon1" performance="required">
     <para>若需要驗證才能連接到此伺服器上設定的目標裝置，請選取<guimenu>全域</guimenu>索引標籤，取消選取<guimenu>無驗證</guimenu>以啟用驗證，然後指定內送和外送驗證所需的身分證明。</para>
     <para role="intro">系統預設會啟用<guimenu>無驗證</guimenu>選項。如需更安全的組態，您可以指定內送驗證、外送驗證，或針對內送和外送兩個方向的驗證。您也可以將多對使用者名稱與密碼新增至<guimenu>內送驗證</guimenu>下的清單中，為內送驗證指定多組身分證明。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="iscsi_target_global_a.png" width="307pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="bj5fon2" performance="required">
     <para>設定 iSCSI 目標裝置。</para>
     <substeps performance="required">
      <step id="bj5fon3" performance="required">
       <para>選取<guimenu>目標</guimenu>索引標籤。</para>
      </step>
      <step id="bj5fzxo" performance="required">
       <para>若尚未清除 iSCSI 範例目標，請從清單中將其選取並刪除，然後按一下<guimenu>繼續</guimenu>確認刪除。</para>
      </step>
      <step id="bj5fon4" performance="required">
       <para>按一下<guimenu>新增</guimenu>以新增新的 iSCSI 目標。</para>
       <para>iSCSI 目標會自動顯示為未格式化的分割區或區塊裝置，並完成「目標」和「識別碼」字段。 </para>
      </step>
      <step id="bj5g2b7" performance="required">
       <para>您可以接受此設定，也可以瀏覽並選取另一個空間。 </para>
       <para>您也可以分割空間以在裝置上建立 LUN，只需按一下<guimenu>新增</guimenu>並指定分配給該 LUN 的磁區。若需要為這些 LUN 設定其他選項，請選取<guimenu>進階設定</guimenu>。</para>
      </step>
      <step id="bj5g2n0" performance="required">
       <para>按<guimenu>下一步</guimenu></para>
      </step>
      <step id="bj5g45h" performance="required">
       <para>對要建立的每個 iSCSI 目標裝置重複<xref linkend="bj5fon4" xrefstyle="StepXRef"/> 至<xref linkend="bj5g2n0" xrefstyle="StepXRef"/>。</para>
      </step>
      <step id="bojud2n" performance="required">
       <para>(選擇性) 在<guimenu>服務</guimenu>索引標籤中，按一下<guimenu>儲存</guimenu>將設定之 iSCSI 目標的相關資訊輸出到檔案。</para>
       <para>這樣，稍後為資源使用者提供此資訊便會更為方便。</para>
      </step>
      <step id="bj5fon5" performance="required">
       <para>按一下<guimenu>完成</guimenu>建立裝置，然後按一下<guimenu>是</guimenu>重新啟動 iSCSI 軟體堆疊。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec-inst-system-iscsi-target-manual">
   <title>手動設定 iSCSI 目標</title>
   <para>在 <filename>/etc/ietd.conf</filename> 中設定 iSCSI 目標。這個檔案在 <emphasis>Target</emphasis> 宣告之前的所有參數都是供檔案全域使用。這部分的驗證資訊具有特殊意義──它不是全域的，而只用於搜索 iSCSI 目標。 </para>
   <para>如果您可以存取 iSNS 伺服器，則應先設定檔案以告知目標有關此伺服器的資訊。iSNS 伺服器的位址必須始終以 IP 位址提供。您無法指定伺服器的 DNS 名稱。此功能的組態如下︰ </para>

<screen>
iSNSServer 192.168.1.111
iSNSAccessControl no
</screen>

   <para>此組態可確保 iSCSI 目標使用 <literal>iSNS</literal> 伺服器進行註冊，這樣就可為啟動程式提供探查。如需有關 iSNS 的詳細資訊，請參閱<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>。iSNS 探查的存取控制不受支援。只需保持「<literal>無 iSNS 存取控制</literal>」。 </para>
   <para>所有直接的 iSCSI 驗證都可以在兩個方向上完成。iSCSI 目標可要求 iSCSI 啟動程式使用 <option>IncomingUser</option> 進行驗證，這可以新增許多次。iSCSI 啟動器也可以要求 iSCSI 目標進行驗證。這時應使用 <option>OutgoingUser</option>。兩者語法相同： </para>

<screen>
IncomingUser &lt;username&gt; &lt;password&gt;
OutgoingUser &lt;username&gt; &lt;password&gt;
</screen>

   <para>驗證後面接著一或多個目標定義。請為每個目標新增 <literal>Target</literal> 區段。此區段的開頭固定是 <literal>Target</literal> 識別碼，後面接著邏輯單位編號的定義： </para>

<screen>
Target iqn.yyyy-mm.&lt;reversed domain name&gt;[:identifier]
          Lun 0 Path=/dev/mapper/system-v3
          Lun 1 Path=/dev/hda4
          Lun 2 Path=/var/lib/xen/images/xen-1,Type=fileio
</screen>

   <para>在 <literal>Target</literal> 行中，<literal>yyyy-mm</literal> 是目標啟用時的日期，而且 <literal>identifier</literal> 可以自由選取。如需更多有關命名慣例的資訊，請參閱 <ulink url="http://www.ietf.org/rfc/rfc3722.txt"><citetitle>RFC 3722</citetitle></ulink>。本例中輸出三個不同的區塊裝置。第一個區塊裝置是邏輯磁碟區 (請參閱<xref linkend="lvm" xrefstyle="ChapTitleOnPage"/>)，第二個是 IDE 分割區，第三個是本地檔案系統中可用的影像。這些對 iSCSI 啟動程式而言都像是區塊裝置。 </para>
   <para>啟用 iSCSI 目標前，請在 <option>Lun</option> 定義後至少新增一個 <option>IncomingUser</option>。它會執行此目標所用的驗證。 </para>
   <para>若要啟用所有變更，請用 <command>rcopen-iscsi <option> restart</option></command> 重新啟動 iscsitarget 精靈。檢查 <filename>/proc</filename> 檔案系統中的組態： </para>

<screen>
cat /proc/net/iet/volume
tid:1 name:iqn.2006-02.com.example.iserv:systems
        lun:0 state:0 iotype:fileio path:/dev/mapper/system-v3
        lun:1 state:0 iotype:fileio path:/dev/hda4
        lun:2 state:0 iotype:fileio path:/var/lib/xen/images/xen-1
</screen>

   <para>還有許多其他選項可控制 iSCSI 目標的行為。如需詳細資訊，請參閱 <filename>ietd.conf</filename> 線上文件。 </para>
   <para>/proc<filename> 檔案系統中也會顯示作用中工作階段。</filename>針對每個連接的啟動程式，<filename>/proc/net/iet/session</filename> 中會新增一個額外的項目： </para>

<screen>
cat /proc/net/iet/session
tid:1 name:iqn.2006-02.com.example.iserv:system-v3
   sid:562949957419520 initiator:iqn.2005-11.de.suse:cn=rome.example.com,01.9ff842f5645
      cid:0 ip:192.168.178.42 state:active hd:none dd:none
   sid:281474980708864 initiator:iqn.2006-02.de.suse:01.6f7259c88b70
      cid:0 ip:192.168.178.72 state:active hd:none dd:none
</screen>

  </sect2>
  <sect2 id="sec-inst-system-iscsi-target-ietadm">
   <title>使用 ietadm 設定線上目標</title>
   <para>如有必要變更 iSCSI 目標組態，您必須重新啟動目標，才能使在組態檔案中所做的變更生效。可惜的是，在這個過程中，所有作用中工作階段都會被中斷。若要維持不受干擾的操作，除了在主要組態檔案 <filename>/etc/ietd.conf</filename> 中進行變更之外，您還要使用 ietadm 管理公用程式手動變更目前組態。 </para>
   <para>若要建立擁有 LUN 的 iSCSI 目標，請先更新您的組態檔案。增加的項目可為： </para>

<screen>
Target iqn.2006-02.com.example.iserv:system2
          Lun 0 Path=/dev/mapper/system-swap2
          IncomingUser joe secret
</screen>

   <para>若要手動設定這個組態，請執行下列步驟： </para>
   <procedure id="bgchy7n">
    <step id="bgchy7o" performance="required">
     <para>使用 <command>ietadm --op new --tid=2 --params Name=iqn.2006-02.com.example.iserv:system2</command> 指令建立新目標。 </para>
    </step>
    <step id="bgchy7p" performance="required">
     <para>使用 <command>ietadm --op new --tid=2 --lun=0 --params Path=/dev/mapper/system-swap2</command> 建立邏輯單位。 </para>
    </step>
    <step id="bgchy7q" performance="required">
     <para>使用 <command>ietadm --op new --tid=2 --user --params=IncomingUser=joe,Password=secret</command> 設定這個目標上的使用者名稱和密碼組合。 </para>
    </step>
    <step id="bgchy7r" performance="required">
     <para>使用 <command>cat /proc/net/iet/volume</command> 檢查組態。 </para>
    </step>
   </procedure>
   <para>您也可以刪除作用中連接。首先，使用 <command>cat /proc/net/iet/session</command> 指令檢查所有作用中連接。如下所示： </para>

<screen>
cat /proc/net/iet/session
tid:1 name:iqn.2006-03.com.example.iserv:system
        sid:281474980708864 initiator:iqn.1996-04.com.example:01.82725735af5
                cid:0 ip:192.168.178.72 state:active hd:none dd:none
</screen>

   <para>若要刪除工作階段 ID 為 281474980708864 的工作階段，請使用 <command>ietadm --op delete --tid=1 --sid=281474980708864 --cid=0</command> 指令。請注意，這樣會使用戶端系統無法存取裝置，而且存取這個裝置的程序可能會暫停。 </para>
   <para>ietadm 也可用來變更各種組態參數。使用 <command>ietadm --op show --tid=1 --sid=0</command> 可取得全域變數清單。輸出會類似以下資訊： </para>

<screen>
InitialR2T=Yes
ImmediateData=Yes
MaxConnections=1
MaxRecvDataSegmentLength=8192
MaxXmitDataSegmentLength=8192
MaxBurstLength=262144
FirstBurstLength=65536
DefaultTime2Wait=2
DefaultTime2Retain=20
MaxOutstandingR2T=1
DataPDUInOrder=Yes
DataSequenceInOrder=Yes
ErrorRecoveryLevel=0
HeaderDigest=None
DataDigest=None
OFMarker=No
IFMarker=No
OFMarkInt=Reject
IFMarkInt=Reject
</screen>

   <para>所有這些參數均可輕鬆變更。例如，如果要將最大連接數變更為 2，請使用</para>

<screen>
ietadm --op update --tid=1 --params=MaxConnections=2. 
</screen>

   <para>在 <filename>/etc/ietd.conf</filename> 檔案中，關聯行應該類似 <option>MaxConnections 2</option>。 </para>
   <warning>
    <para>透過 <command>ietadm</command> 公用程式所做的變更對系統並非永久有效。這些變更如果不加入 <filename>/etc/ietd.conf</filename> 組態檔案，則會在下次重新開機時丟失。根據您網路的 iSCSI 使用情況，這可能會導致嚴重的問題。 </para>
   </warning>
   <para><command>ietadm</command> 公用程式還有其他許多選項可供使用。使用 <command>ietadm -h</command> 可找到綜覽。該處的縮寫為目標 ID (tid)、工作階段 ID (sid) 和連接 ID (cid)。您也可以在 <filename>/proc/net/iet/session</filename> 找到這些資訊。 </para>
  </sect2>
 </sect1>
 <sect1 id="sec-inst-system-iscsi-initiator">
  <title>設定 iSCSI 啟動程式</title>
  <para>iSCSI 啟動器也稱為 iSCSI 用戶端，可用來連接任何 iSCSI 目標。這不僅限於<xref linkend="sec-inst-system-iscsi-target" xrefstyle="SectTitleOnPage"/> 中說明的 iSCSI 目標解決方案。iSCSI 啟動器的組態涉及兩個主要步驟：探查可用的 iSCSI 目標和設定 iSCSI 工作階段。這兩個步驟都可以使用 YaST 來完成。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-initiator-yast" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-inst-system-iscsi-initiator-manual" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="sec-iscsi-database" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="sec-inst-system-iscsi-initiator-yast">
   <title>使用 YaST 設定 iSCSI 啟動程式的組態</title>
   <para>YaST 中的 iSCSI 啟動器綜覽包含三個索引標籤：</para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <formalpara id="bkob6lr">
      <title>服務:</title>
      <para><guimenu>服務</guimenu>索引標籤可用來在開機時啟用 iSCSI 啟動器。同時會提供設定用於該探查的唯一<guimenu>啟動程式名稱</guimenu>及 iSNS 伺服器。iSNS 的預設連接埠為 3205。 </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara id="bkob6ls">
      <title>連接的目標：</title>
      <para><guimenu>連接的目標</guimenu>索引標籤會提供目前已連接 iSCSI 目標的綜覽。它與<guimenu>探查的目標</guimenu>索引標籤一樣，也提供為系統新增新目標的選項。 </para>
     </formalpara>
     <para>在此頁面中，您可以選取目標裝置，然後切換每個 iSCSI 目標裝置的啟動設定：</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara id="bkob6lt">
        <title>自動：</title>
        <para>此選項用於 iSCSI 服務自身啟動時要連接的 iSCSI 目標。這是一般組態。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="bkob6lu">
        <title>開機時：</title>
        <para>此選項用於開機時要連接的 iSCSI 目標；也就是說，當根目錄 (<filename>/</filename>) 位於 iSCSI 上時。因此，伺服器開機時，iSCSI 目標裝置會從 initrd 進行評估。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </listitem>
    <listitem>
     <formalpara id="bkob6lv">
      <title>探查的目標：</title>
      <para><guimenu>探查的目標</guimenu>提供手動探查網路中 iSCSI 目標的途徑。 </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bkob990" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkobick" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkob8pj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bkob9pj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bkob990">
    <title>設定 iSCSI 啟動器</title>
    <procedure id="bj5fon6">
     <step id="bj5fon7" performance="required">
      <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
     </step>
     <step id="bj5fon8" performance="required">
      <para>選取<guimenu>網路服務</guimenu><guimenu>iSCSI 啟動器</guimenu> (您也可以使用 <command>yast2 iscsi-client</command>。</para>
      <para role="intro">YaST 會開啟至「iSCSI 啟動器綜覽」頁面的<guimenu>服務</guimenu>索引標籤中。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="iscsi_init_service_a.png" width="307pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="bj5fonb" performance="required">
      <para>在<guimenu>服務啟動</guimenu>區域中選取下列其中一項：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="bj5fonc">
         <title>開機時：</title>
         <para>以後伺服器重新開機時自動啟動啟動器服務。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="bj5fond">
         <title> 手動 (預設)：</title>
         <para>手動啟動服務。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step id="bj5fone" performance="required">
      <para>指定或驗證<guimenu>啟動器名稱</guimenu>。</para>
      <para>為此伺服器上的 iSCSI 啟動器指定一個格式正確的 iSCSI 合格名稱 (IQN)。此啟動器名稱在網路上必須是全域唯一的。IQN 的一般格式如下：</para>

<screen>
iqn.yyyy-mm.com.mycompany:n1:n2
</screen>

      <para>其中，n1 與 n2 為英數字元。例如：</para>

<screen>
iqn.1996-04.de.suse:01:9c83a3e15f64
</screen>

      <para><guimenu>啟動器名稱</guimenu>中會自動填上伺服器上 <filename>/etc/iscsi/initiatorname.iscsi</filename> 檔案中的對應值。</para>
      <para>
       如果伺服器支援 iBFT (iSCSI 開機韌體表)，<guimenu>啟動器名稱</guimenu>中會填上 IBFT 中的對應值，並且該名稱無法在此介面上變更，不過您可以使用 BIOS 設定來修改。iBFT 是指包含對 iSCSI 開機程序有用之各種參數的資訊區塊，包括伺服器的 iSCSI 目標與啟動器描述。</para>
     </step>
     <step id="bj5fonf" performance="required">
      <para>使用下列方法之一探查網路上的 iSCSI 目標。</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="bj5fong">
         <title>iSNS：</title>
         <para>若要使用 iSNS (網際網路儲存名稱服務) 來探查 iSCSI 目標，請繼續<xref linkend="bkobick" xrefstyle="HeadingOnPage"/>。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="bj5fonh">
         <title>探查的目標：</title>
         <para>若要手動探查 iSCSI 目標裝置，請繼續<xref linkend="bkob8pj" xrefstyle="HeadingOnPage"/>。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bkobick">
    <title>使用 iSNS 探查 iSCSI 目標</title>
    <para>只有在您的環境中安裝並設定了 iSNS 伺服器後，才可以使用此選項。如需更多資訊，請參閱<xref linkend="isns" xrefstyle="ChapTitleOnPage"/>。</para>
    <procedure id="bkobiky">
     <step id="bkobikz" performance="required">
      <para>在 YaST 中，選取<guimenu>iSCSI 啟動器</guimenu>，然後選取<guimenu>服務</guimenu>索引標籤。 </para>
     </step>
     <step id="bkobjno" performance="required">
      <para>指定 iSNS 伺服器與連接埠的 IP 位址。 </para>
      <para>預設埠為 3205。</para>
     </step>
     <step id="bkobl8n" performance="required">
      <para>在「iSCSI 啟動器綜覽」頁面中，按一下<guimenu>完成</guimenu>以儲存並套用您的變更。</para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="bkob8pj">
    <title>手動探查 iSCSI 目標</title>
    <para>對要從您目前正設定 iSCSI 啟動器的伺服器存取的所有 iSCSI 目標伺服器重複下列程序。</para>
    <procedure id="bgchy7s">
     <step id="bgchy7t" performance="required">
      <para>在 YaST 中，選取<guimenu>iSCSI 啟動器</guimenu>，然後選取<guimenu>探查的目標</guimenu>索引標籤。 </para>
     </step>
     <step id="bkobfda" performance="required">
      <para>按一下<guimenu>探查</guimenu>開啟「iSCSI 啟動器探查」對話方塊。 </para>
     </step>
     <step id="bgchy7u" performance="required">
      <para>輸入 IP 位址，並視需要變更連接埠。系統支援 IPv6 位址。</para>
      <para>預設埠為 3260。</para>
     </step>
     <step id="bgchy7v" performance="required">
      <para>如果需要驗證，請取消選取<guimenu>無驗證</guimenu>，然後指定<guimenu>內送</guimenu>或<guimenu>外送</guimenu>驗證的身分證明。 </para>
     </step>
     <step id="bgchy7w" performance="required">
      <para>按<guimenu>下一步</guimenu>開始探查並連接到 iSCSI 目標伺服器。</para>
     </step>
     <step id="bi728ck" performance="required">
      <para>如果需要身分證明，則在探查成功後使用<guimenu>登入</guimenu>啟動目標。 </para>
      <para>系統會提示您提供驗證身分證明以使用所選的 iSCSI 目標。 </para>
     </step>
     <step id="bi727ln" performance="required">
      <para>按一下<guimenu>下一步</guimenu>完成組態。 </para>
      <para>如果一切順利，現在目標就會出現在<guimenu>連接的目標</guimenu>中。 </para>
      <para>接著，就可以使用虛擬 iSCSI 裝置。 </para>
     </step>
     <step id="bkobeht" performance="required">
      <para>在「iSCSI 啟動器綜覽」頁面中，按一下<guimenu>完成</guimenu>以儲存並套用您的變更。</para>
     </step>
     <step id="bi728cl" performance="required">
      <para>您可以使用 <command>lsscsi</command> 指令尋找 iSCSI 目標裝置的本地裝置路徑︰</para>

<screen>
lsscsi
[1:0:0:0]   disk    IET      VIRTUAL-DISK     0     /dev/sda
</screen>

     </step>
    </procedure>
   </sect3>
   <sect3 id="bkob9pj">
    <title>設定 iSCSI 目標裝置的啟動優先設定</title>
    <procedure id="bkobg1r">
     <step id="bkobg1s" performance="required">
      <para>在 YaST 中，選取<guimenu>iSCSI 啟動器</guimenu>，然後選取<guimenu>已連接目標</guimenu>索引標籤，以檢視目前連接到伺服器的 iSCSI 目標裝置清單。 </para>
     </step>
     <step id="bkobg1t" performance="required">
      <para>選取要管理的 iSCSI 目標裝置。 </para>
     </step>
     <step id="bkobg1u" performance="required">
      <para>按一下<guimenu>切換啟動</guimenu>修改設定：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="bkobg1v">
         <title>自動：</title>
         <para>此選項用於 iSCSI 服務自身啟動時要連接的 iSCSI 目標。這是一般組態。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="bkobg1w">
         <title>開機時：</title>
         <para>此選項用於開機時要連接的 iSCSI 目標；也就是說，當根目錄 (<filename>/</filename>) 位於 iSCSI 上時。因此，伺服器開機時，iSCSI 目標裝置會從 initrd 進行評估。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step id="bkobg1x" performance="required">
      <para>按一下<guimenu>完成</guimenu>以儲存並套用您的變更。 </para>
     </step>
    </procedure>
   </sect3>
  </sect2>
  <sect2 id="sec-inst-system-iscsi-initiator-manual">
   <title>手動設定 iSCSI 啟動程式</title>
   <para>iSCSI 連接的探查和組態都需要執行中的 iscsid。第一次執行搜索時，會在 <filename>/var/lib/open-iscsi</filename> 目錄中建立 iSCSI 啟動程式的內部資料庫。 </para>
   <para>如果您的探查受到密碼保護，請提供驗證資訊給 iscsid。因為執行第一次探查時，內部資料庫還不存在，所以這時無法使用該資料庫，而必須編輯 <filename>/etc/iscsid.conf</filename> 組態檔案來提供資訊。若要新增您的搜索密碼資訊，請將下列幾行加到 <filename>/etc/iscsid.conf</filename> 結束處： </para>

<screen>
discovery.sendtargets.auth.authmethod = CHAP
discovery.sendtargets.auth.username = &lt;username&gt;
discovery.sendtargets.auth.password = &lt;password&gt;
</screen>

   <para>探查會將收到的所有值儲存在永久的內部資料庫中。此外，它會顯示所有偵測到的目標。使用下列指令執行此探查：</para>

<screen>
iscsiadm <option>-m discovery --type=st --portal=&lt;targetip&gt;</option>
</screen>

   <para>輸出應如下所示： </para>

<screen>
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems
</screen>

   <para>若要探查 <literal>iSNS</literal> 伺服器上可使用的目標，請使用下列指令︰</para>

<screen>
iscsiadm --mode discovery --type isns --portal &lt;targetip&gt; 
</screen>

   <para>針對 iSCSI 目標上定義的每個目標，會各出現一行。如需已儲存資料的詳細資訊，請參閱<xref linkend="sec-iscsi-database" xrefstyle="SectTitleOnPage"/>。 </para>
   <para>iscsiadm<command> 特殊的 <option>--login</option> 選項會建立所有需要的裝置：</command> </para>

<screen>
iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems --login
</screen>

   <para>新產生的裝置會顯示在 <command>lsscsi</command> 的輸出中，而且現在可以用 mount 來存取。 </para>
  </sect2>
  <sect2 id="sec-iscsi-database">
   <title>iSCSI 用戶端資料庫</title>
   <para>iSCSI 啟動程式探查到的所有資訊都儲存在位於 <filename>/var/lib/open-iscsi</filename> 的兩個資料庫檔案中。一個資料庫用來探查目標，一個資料庫用於已探查到的節點。存取資料庫時，您必須先選取要從探查資料庫或從節點資料庫中取得資料。使用 <command>iscsiadm</command> 的 <option>-m discovery</option> 和 <option>-m node</option> 參數就可以做到這一點。使用 <command>iscsiadm</command> 而且只搭配其中一個參數，可提供儲存記錄的綜覽： </para>

<screen>
iscsiadm -m discovery
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems
</screen>

   <para>這個範例中的目標名稱為 <literal>iqn.2006-02.com.example.iserv:systems</literal>。與這個特殊資料集相關的所有動作都需要這個名稱。若要檢查 ID <literal>iqn.2006-02.com.example.iserv:systems</literal> 的資料記錄內容，請使用下列指令： </para>

<screen>
iscsiadm -m node --targetname iqn.2006-02.com.example.iserv:systems
node.name = iqn.2006-02.com.example.iserv:systems
node.transport_name = tcp
node.tpgt = 1
node.active_conn = 1
node.startup = manual
node.session.initial_cmdsn = 0
node.session.reopen_max = 32
node.session.auth.authmethod = CHAP
node.session.auth.username = joe
node.session.auth.password = ********
node.session.auth.username_in = &lt;empty&gt;
node.session.auth.password_in = &lt;empty&gt;
node.session.timeo.replacement_timeout = 0
node.session.err_timeo.abort_timeout = 10
node.session.err_timeo.reset_timeout = 30
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
....
</screen>

   <para>若要編輯這其中一個變數的值，請使用 <command>iscsiadm</command> 指令搭配 <option>update</option> 操作。例如，如果希望 iscsid 在初始化時登入 iSCSI 目標，請將 <option>node.startup</option> 變數設定為 <option>automatic</option> 值： </para>

<screen role="compact2">
iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems -p ip:port --op=update --name=node.startup --value=automatic
</screen>

   <para>使用 <literal>delete</literal> 操作移除過時的資料集。如果目標 <literal>iqn.2006-02.com.example.iserv:systems</literal> 不再是有效的記錄，則使用以下指令加以刪除︰</para>

<screen>
<command>iscsiadm <option>-m node -n iqn.2006-02.com.example.iserv:systems -p ip:port --op=delete</option></command>
</screen>

   <important>
    <para>請謹慎地使用此選項，因為該選項會刪除記錄，而不提供其他確認提示。 </para>
   </important>
   <para>若要取得所有探查目標的清單，則執行 <command>iscsiadm -m node</command> 指令。</para>
  </sect2>
 </sect1>
 <sect1 id="bwkrqdd">
  <title>安裝時使用 iSCSI 磁碟</title>
  <para>使用支援 iSCSI 的韌體時，支援從 i386、x86_64 和 ppc64 結構上的 iSCSI 磁碟開機。 </para>
  <para>若要在安裝期間使用 iSCSI 磁碟，必須將下列參數新增至開機選項行： </para>

<screen>
withiscsi=1
</screen>

  <para>安裝期間會顯示一個額外的螢幕，可讓您將 iSCSI 磁碟連接至系統，並在安裝過程中使用它們。</para>
 </sect1>
 <sect1 id="sec-inst-system-iscsi-ts">
  <title>iSCSI 疑難排解</title>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="nofail" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bp5cdib" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bpjp8x0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7p6z" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="nofail">
   <title>Hotplug 對掛接 iSCSI 目標不起作用</title>
   <para>在 SLES 10 中，您可以在 <filename>/etc/fstab</filename> 檔案中將 <literal>hotplug</literal> 選項新增至您的裝置以掛接 iSCSI 目標。例如︰</para>

<screen>
/dev/disk/by-uuid-blah /oracle/db   ext3       hotplug,rw            0 2
</screen>

   <para>在 SLES 11 中，<literal>hotplug</literal> 選項不再起作用。請改用 <literal>nofail</literal> 選項。例如︰</para>

<screen>
/dev/sdb1   /mnt/mountpoint   ext3   acl,user,nofail   0 0
</screen>

   <para>如需相關資訊，請參閱 <ulink url="http://www.novell.com/support/php/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=7004427"><citetitle>TID 7004427：/etc/fstab entry does not mount iSCSI device on boot up (/etc/fstab 項目在啟動時不會掛接 iSCSI 裝置)</citetitle></ulink>。</para>
  </sect2>
  <sect2 id="bp5cdib">
   <title>iSCSI 流量中的資料封包被丟棄</title>
   <para>如果防火牆太忙碌，可能就會丟棄封包。SUSE 防火牆預設設定為在三分鐘之後丟棄封包。如果您發現 iSCSI 流量封包被丟棄，可以考慮將 SUSE 防火牆設定為在過於忙碌時將封包排入佇列，而不是將其丟棄。 </para>
  </sect2>
  <sect2 id="bpjp8x0">
   <title>將 iSCSI 磁碟區與 LVM 搭配使用</title>
   <para>當在 iSCSI 目標上使用 LVM 時，請使用本節中的疑難排解提示。</para>
   <itemizedlist role="subtoc" mark="bullet" spacing="normal">
    <listitem>
     <para><xref linkend="bpkq3ci" xrefstyle="HeadingOnPage"/></para>
    </listitem>
    <listitem>
     <para><xref linkend="bpkpzuj" xrefstyle="HeadingOnPage"/></para>
    </listitem>
   </itemizedlist>
   <sect3 id="bpkq3ci">
    <title>檢查在開機時 iSCSI 啟動器是否執行探查</title>
    <para>如果設定了 iSCSI 啟動器，請務必啟用開機時探查功能，以便 udev 可以在開機時探查 iSCSI 裝置並設定 LVM 要使用的裝置。</para>
   </sect3>
   <sect3 id="bpkpzuj">
    <title>檢查在開機時是否執行 iSCSI 目標探查</title>
    <para>請記住，在 SLES 11 中，<filename>udev</filename> 會提供裝置的預設設定。請確定建立裝置的所有應用程式都具有在開機時執行的執行層級設定，如此，當系統啟動時，<command>udev</command> 才可為這些應用程式識別並指定裝置。如果應用程式或服務直到後來才啟動，<command>udev</command> 便無法在開機時按照設定自動建立裝置。 </para>
    <para>在<guimenu>YaST</guimenu>中，您可以轉至<guimenu>系統</guimenu>&gt;<guimenu>系統服務 (執行層級)</guimenu>&gt;<guimenu>進階模式</guimenu>，來檢查 LVM2 與 iSCSI 的執行層級設定。下列服務應當在開機時啟動 (B)︰</para>
    <simplelist>
     <member>boot.lvm</member> <member>boot.open-iscsi</member> <member>open-iscsi</member>
    </simplelist>
   </sect3>
  </sect2>
  <sect2 id="bwk7p6z">
   <title>組態檔案設定為手動時會掛接 iSCSI 目標</title>
   <para>如果您之前手動修改了 <filename>/etc/iscsi/iscsid.conf</filename> 組態檔案，則即使將 <literal>node.startup</literal> 選項設定為手動，Open-iSCSI 啟動時也會掛接目標。</para>
   <para>檢查 <filename>/etc/iscsi/nodes/&lt;<replaceable>目標名稱</replaceable>&gt;/&lt;<replaceable>IP 位址</replaceable>,<replaceable>連接埠</replaceable>&gt;/default</filename> 檔案。它包含可以覆寫 <filename>/etc/iscsi/iscsid.conf</filename> 檔案的 <literal>node.startup</literal> 設定。使用 YaST 介面將掛接選項設定為手動，還會在 <filename>/etc/iscsi/nodes/&lt;<replaceable>目標名稱</replaceable>&gt;/&lt;<replaceable>IP 位址</replaceable>,<replaceable>連接埠</replaceable>&gt;/default </filename>檔案中設定 <literal>node.startup = manual</literal>。</para>
  </sect2>
 </sect1>
 <sect1 id="sec-inst-system-iscsi-initiator-info">
  <title>其他資訊</title>
  <para>iSCSI 通訊協定已存在多年，所以有許多評鑑報告和其他文件，將 iSCSI 與 SAN 解決方案做比較、測試其效能基準或僅僅說明各種硬體解決方案。以下是 open-iscsi 相關詳細資訊的重要網頁： </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para><ulink url="http://www.open-iscsi.org/"><citetitle>Open-iSCSI Project (開放式 iSCSI 專案)</citetitle></ulink></para>
   </listitem>
   <listitem>
    <para><ulink url="http://www.novell.com/coolsolutions/appnote/15394.html"><citetitle>AppNote: iFolder on Open Enterprise Server Linux Cluster using iSCSI (AppNote：使用 iSCSI 之 Open Enterprise Server Linux Cluster 上的 iFolder)</citetitle></ulink></para>
   </listitem>
  </itemizedlist>
  <para>此外也有一些線上文件。請參閱 <command>iscsiadm</command>、<command>iscsid</command>、<filename>ietd.conf</filename> 和 <command>ietd</command> 的線上文件，以及範例組態檔案 <filename>/etc/iscsid.conf</filename>。 </para>
 </sect1>
</chapter>

<chapter id="cha-iscsi-lio" lang="zh-tw" xml:base="06_iscsi_lio.xml">
 <title>透過 IP 網路的大量儲存裝置：iSCSI 目標伺服器</title>
 <para>LIO (linux-iscsi.org) 是適用於 Linux 的標準開放原始碼多協定 SCSI 目標。LIO 取代了 STGT (SCSI 目標) 架構，成為 Linux 核心版本為 2.6.38 及更新版本之 Linux 中的標準統一儲存目標。在 SUSE Linux Enterprise Server 11 SP3 及更新版本中，YaST 支援 iSCSI LIO 目標伺服器軟體。 </para>
 <para>本章說明如何使用 YaST 設定 iSCSI LIO 目標伺服器以及設定 iSCSI LIO 目標裝置。您可以使用任一 iSCSI 啟動器軟體來存取目標裝置。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="sect-iscsi-lio-install" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-service" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-discovery" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-storage" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-targetgp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-edit" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="sect-iscsi-lio-delete" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13g8i2g" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12iqi8o" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="sect-iscsi-lio-install">
  <title>安裝 iSCSI LIO 目標伺服器軟體</title>
  <para>使用 YaST 軟體管理工具，將 iSCSI LIO 目標伺服器軟體安裝到要建立 iSCSI LIO 目標裝置的 SUSE Linux Enterprise Server 11 SP3 伺服器上。</para>
  <procedure id="b12jepdi">
   <step id="b12jepdj" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="b12jepdk" performance="required">
    <para>選擇<guimenu>軟體</guimenu><guimenu>軟體管理」。</guimenu></para>
   </step>
   <step id="b12jepdl" performance="required">
    <para>選取<guimenu>搜尋</guimenu>索引標籤，輸入 <literal>lio</literal>，然後按一下<guimenu>搜尋</guimenu>。</para>
   </step>
   <step id="b12jepdm" performance="required">
    <para>選取 iSCSI LIO 目標伺服器套件：</para>
    <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="96%">
     <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="4091*"/>
     <colspec colnum="2" colname="2" colwidth="5912*"/>
      <thead>
       <row id="b12gs3f1">
        <entry>
         <para>iSCSI LIO 目標伺服器套件</para>
        </entry>
        <entry>
         <para>描述</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row id="b12gs3f2">
        <entry>
         <para><filename>yast2-iscsi-lio-server</filename></para>
        </entry>
        <entry>
         <para>在 YaST 中提供 GUI 介面，用於設定 iSCSI LIO 目標裝置。</para>
        </entry>
       </row>
       <row id="b12gs3f3">
        <entry>
         <para><filename>lio-utils</filename></para>
        </entry>
        <entry>
         <para>提供 API，用於設定和控制 <filename>yast2-iscsi-lio-server</filename> 所用的 iSCSI LIO 目標裝置。</para>
        </entry>
       </row>
       <row id="b12gs3f4">
        <entry>
         <para><filename>lio-mibs</filename></para>
        </entry>
        <entry>
         <para>提供 SNMP (簡易網路管理協定)，透過使用 Net-SNMP 代理程式的動態載入模組 (<filename>dlmod</filename>) 功能監控 iSCSI LIO 目標裝置。它支援 SNMP v1、v2c 和 v3。組態檔案為 <filename>/etc/snmp/snmpd.conf</filename>。</para>
         <para><filename>lio-mibs</filename> 軟體使用 <filename>perl-SNMP</filename> 和 <filename>net-snmp</filename> 套件。</para>
         <para>如需 Net-SNMP 的相關資訊，請參閱開放原始碼 <ulink url="http://www.net-snmp.org/">Net-SNMP 專案</ulink>。</para>
        </entry>
       </row>
       <row id="b12gs3f5">
        <entry>
         <para><filename>lio</filename>-utils-debuginfo</para>
        </entry>
        <entry>
         <para>提供 <filename>lio-utils</filename> 套件的除錯資訊。開發或除錯 <filename>lio-utils</filename> 的應用程式時，可以使用此套件。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </step>
   <step id="b12r0abb" performance="required">
    <para>在對話方塊的右下角中，按一下<guimenu>接受</guimenu>以安裝所選的套件。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_install_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jepdn" performance="required">
    <para role="intro">當系統提示您核准自動變更時，按一下<guimenu>繼續</guimenu>以接受 <filename>lio-utils</filename>、<filename>perl-SNMP</filename> 和 <filename>net-snmp</filename> 套件的 iSCSI LIO 目標伺服器相依性。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_install_changes_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jepdo" performance="required">
    <para role="intro">關閉並重新啟動 YaST，然後按一下<guimenu>網路服務</guimenu>並驗證功能表中是否提供<guimenu>iSCSI LIO 目標</guimenu>選項。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast_option_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jepdp" performance="required">
    <para>繼續執行<xref linkend="sect-iscsi-lio-service" xrefstyle="SectTitleOnPage"/>。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect-iscsi-lio-service">
  <title>啟動 iSCSI LIO 目標服務</title>
  <para>iSCSI LIO 目標服務預設設為手動啟動。您可以將該服務設定為在系統重新啟動時自動啟動。如果在伺服器上使用防火牆並且希望 iSCSI LIO 目標在其他電腦上可用，則必須為要用於目標存取的每個介面卡開啟防火牆中的連接埠。按照 IANA (Internet Assigned Numbers Authority) 的定義，TCP 連接埠 3260 是 iSCSI 通訊協定的埠號。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jbaln" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jbalo" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12jbbfh">
   <title>設定 iSCSI LIO 啟動偏好設定</title>
   <para>若要設定 iSCSI LIO 目標伺服器服務設定，請執行下列步驟：</para>
   <procedure id="b12jauce">
    <step id="b13n0ujo" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分登入 iSCSI LIO 目標伺服器，然後啟動終端機主控台。</para>
    </step>
    <step id="b13n0ujp" performance="required">
     <para>確定 <filename>/etc/init.d/target</filename> 精靈正在執行。在指令提示符下，輸入</para>

<screen>
/etc/init.d/target start
</screen>

     <para>該指令會傳回一則訊息，確認該精靈已啟動或已在執行中。</para>
    </step>
    <step id="b12jaucf" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
    </step>
    <step id="b12jaucg" performance="required">
     <para>在 YaST 控制中心中，選取<guimenu>網路服務</guimenu>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
     <para>您也可以搜尋 <quote>lio</quote>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jauch" performance="required">
     <para role="intro">在「iSCSI LIO 目標綜覽」對話方塊中，選取<guimenu>服務</guimenu>索引標籤。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_service_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jauci" performance="required">
     <para role="intro">在<guimenu>服務啟動</guimenu>下，指定 iSCSI LIO 目標服務的啟動方式︰ </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <formalpara id="b12jaucj">
        <title>開機時：</title>
        <para>該服務會在伺服器重新啟動時自動啟動。</para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b12jauck">
        <title>自訂：</title>
        <para>(預設) 伺服器重新啟動之後，您必須手動啟動該服務。啟動該服務之後，目標裝置才可用。</para>
       </formalpara>
      </listitem>
     </itemizedlist>
    </step>
    <step id="b12jaucl" performance="required">
     <para>如果在伺服器上使用防火牆並且希望 iSCSI LIO 目標在其他電腦上可用，則為要用於目標存取的每個介面卡介面開啟防火牆中的連接埠。 </para>
     <para>預設會停用防火牆設定。除非您在伺服器上部署了防火牆，否則不需要這些設定。預設連接埠號碼為 3260。如果關閉所有網路介面的連接埠，則 iSCSI LIO 目標將無法供其他電腦使用。</para>
     <substeps performance="required">
      <step id="b12jaucm" performance="required">
       <para>在<guimenu>服務</guimenu>索引標籤上，選取<guimenu>在防火牆中開啟埠</guimenu>核取方塊以啟用防火牆設定。</para>
      </step>
      <step id="b12jaucn" performance="required">
       <para>按一下<guimenu>防火牆詳細資料</guimenu>以檢視或設定要使用的網路介面。</para>
       <para>隨即會列出所有可用的網路介面，並且預設會選取所有介面。</para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="lio_firewall_ports_a.png" width="250pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12jauco" performance="required">
       <para>對於每個介面，指定是為其開啟還是關閉連接埠：</para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <formalpara id="b12jaucp">
          <title>開啟：</title>
          <para>選取介面的核取方塊以開啟連接埠。您也可以按一下<guimenu>全選</guimenu>以開啟所有介面上的連接埠。 </para>
         </formalpara>
        </listitem>
        <listitem>
         <formalpara id="b12jaucq">
          <title>關閉︰</title>
          <para>取消選取介面的核取方塊以關閉連接埠。您也可以按一下<guimenu>全部不選</guimenu>以關閉所有介面上的連接埠。 </para>
         </formalpara>
        </listitem>
       </itemizedlist>
      </step>
      <step id="b12jaucr" performance="required">
       <para>按一下<guimenu>確定</guimenu>以儲存並套用您的變更。 </para>
      </step>
      <step id="b12r0it6" performance="required">
       <para>如果系統提示您確認設定，請按一下<guimenu>是</guimenu>繼續，或按一下<guimenu>否</guimenu>回到對話方塊並進行所需的變更。</para>
      </step>
     </substeps>
    </step>
    <step id="b12jb97x" performance="required">
     <para>按一下<guimenu>完成</guimenu>以儲存並套用 iSCSI LIO 目標服務設定。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b12jbaln">
   <title>在指令行中手動啟動 iSCSI LIO 目標</title>
   <procedure id="b12gboje">
    <step id="b13n0ujq" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分登入，然後啟動終端機主控台。</para>
    </step>
    <step id="b13n0ujr" performance="required">
     <para>在指令提示符下，輸入</para>

<screen>
/etc/init.d/target start
</screen>

     <para>該指令會傳回一則訊息，確認該精靈已啟動或已在執行中。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b12jbalo">
   <title>在 YaST 中手動啟動 iSCSI LIO 目標</title>
   <procedure id="b12gblm7">
    <step id="b12gblm8" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
    </step>
    <step id="b12gblm9" performance="required">
     <para>在 YaST 控制中心中，選取<guimenu>系統</guimenu>，然後選取<guimenu>系統服務 (執行層級)</guimenu>。</para>
    </step>
    <step id="b12gblma" performance="required">
     <para>在「YaST 系統服務」對話方塊中，選取<guimenu>進階模式</guimenu>，然後在服務清單中選取<guimenu>目標</guimenu>(<guimenu>TCM/ConfigFS 和 LIO-Target</guimenu>)。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_runlevel_a.png" width="300pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12gbmn5" performance="required">
     <para>在右下方選取<guimenu>啟動/停止/重新整理</guimenu>&gt;<guimenu>立即啟動</guimenu>。</para>
    </step>
    <step id="b12jbalp" performance="required">
     <para>按一下<guimenu>確定</guimenu>。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sect-iscsi-lio-discovery">
  <title>設定用於探查 iSCSI LIO 目標與用戶端的驗證</title>
  <para>iSCSI LIO 目標伺服器軟體支援 PPP-CHAP (點對點通訊協定-Challenge Handshake 驗證通訊協定)，它是<ulink url="http://www.ietf.org/rfc/rfc1994.txt"><citetitle>網際網路工程任務推動小組 (IETF) RFC 1994</citetitle></ulink> 中定義的一種三向驗證方法。iSCSI LIO 目標伺服器使用此驗證方法來探查 iSCSI LIO 目標與用戶端，而不是用於存取目標上的檔案。如果不想將存取僅限於搜索，請使用<guimenu>無驗證</guimenu>。系統預設會啟用<guimenu>無驗證</guimenu>選項。如果探查驗證已啟用，其設定將會套用至所有 iSCSI LIO 目標群組。</para>
  <important>
   <para>建議在線上環境中使用針對目標與用戶端探查的驗證。</para>
  </important>
  <para>如果為了設定更安全的組態而需要驗證，則可以使用內送驗證、外送驗證或兩者。<guimenu>內送驗證</guimenu>需要 iSCSI 啟動器證明它有權在 iSCSI LIO 目標上執行探查。啟動器必須提供內送使用者名稱和密碼。<guimenu>外送驗證</guimenu>需要 iSCSI LIO 目標向啟動器證明它是預期的目標。iSCSI LIO 目標必須向 iSCSI 啟動器提供外送使用者名稱和密碼。內送和外送探查的使用者名稱和密碼對可以不同。 </para>
  <para>若要設定 iSCSI LIO 目標的驗證偏好設定，請執行下列步驟：</para>
  <procedure id="b12g8sjw">
   <step id="b13n0ujs" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分登入 iSCSI LIO 目標伺服器，然後啟動終端機主控台。</para>
   </step>
   <step id="b13n0ujt" performance="required">
    <para>確定 <filename>/etc/init.d/target</filename> 精靈正在執行。在指令提示符下，輸入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>該指令會傳回一則訊息，確認該精靈已啟動或已在執行中。</para>
   </step>
   <step id="b12g8sjx" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="b12g8sjy" performance="required">
    <para>在 YaST 控制中心中，選取<guimenu>網路服務</guimenu>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <para>您也可以搜尋 <quote>lio</quote>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12g9s76" performance="required">
    <para>在「iSCSI LIO 目標綜覽」對話方塊中，選取<guimenu>全域</guimenu>索引標籤以設定驗證設定。預設會停用這些驗證設定。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_global_noauth_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jco93" performance="required">
    <para>指定是否需要 iSCSI LIO 目標的驗證︰</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b12jcrm7">
       <title>停用驗證：</title>
       <para>(預設) 選取<guimenu>無驗證</guimenu>核取方塊以停用針對此伺服器上之探查的內送和外送驗證。此伺服器上的所有 iSCSI LIO 目標都可由同一網路上的任何 iSCSI 啟動器用戶端探查。此伺服器可以探查同一網路上不需要探查驗證的任何 iSCSI 啟動器用戶端。跳過<xref linkend="b12r1015" xrefstyle="StepXRef"/> 並繼續執行<xref linkend="b12gb2ux" xrefstyle="StepXRef"/>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12jcrm8">
       <title>啟用驗證︰</title>
       <para>取消選取<guimenu>無驗證</guimenu>核取方塊。系統會自動選取<guimenu>內送驗證</guimenu>和<guimenu>外送驗證</guimenu>這兩個核取方塊。繼續執行<xref linkend="b12r1015" xrefstyle="StepXRef"/>。</para>
      </formalpara>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_global_in_out_auth_a.png" width="250pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </itemizedlist>
   </step>
   <step id="b12r1015" performance="required">
    <para role="intro">設定內送探查、外送探查或兩者所需的驗證身分證明。內送和外送探查的使用者名稱和密碼對可以不同。 </para>
    <substeps performance="required">
     <step id="b12jcw2u" performance="required">
      <para>執行下列其中一項操作設定內送驗證：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="b12r0xyn">
         <title>停用內送驗證： </title>
         <para>取消選取<guimenu>內送驗證</guimenu>核取方塊。此伺服器上的所有 iSCSI LIO 目標都可由同一網路上的任何 iSCSI 啟動器用戶端探查。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="b12r0xyo">
         <title>啟用內送驗證： </title>
         <para>選取<guimenu>內送驗證</guimenu>核取方塊，然後指定要用於 iSCSI LIO 目標內送探查的現有使用者名稱和密碼對。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step id="b12jcw2x" performance="required">
      <para>執行下列其中一項操作設定外送驗證： </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="b12r0xyp">
         <title>停用外送驗證： </title>
         <para>取消選取<guimenu>外送驗證</guimenu>核取方塊。此伺服器可以探查同一網路上不需要探查驗證的任何 iSCSI 啟動器用戶端。 </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="b12r0xyq">
         <title>啟用外送驗證： </title>
         <para>選取<guimenu>外送驗證</guimenu>核取方塊，然後指定要用於 iSCSI 啟動器用戶端外送探查的現有使用者名稱和密碼對。</para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
    </substeps>
   </step>
   <step id="b12gb2ux" performance="required">
    <para>按一下<guimenu>完成</guimenu>以儲存並套用設定。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect-iscsi-lio-storage">
  <title>準備儲存空間</title>
  <para>iSCSI LIO 目標組態會將現有區塊裝置輸出到 iSCSI 啟動器中。您必須透過在伺服器上設定未格式化的分割區或裝置，來準備要用於目標裝置的儲存空間。iSCSI LIO 目標能夠以 Linux、Linux LVM 或 Linux RAID 檔案系統 ID 來使用未格式化的分割區。 </para>
  <important>
   <para>將某個裝置或分割區設定為 iSCSI 目標後，您將無法再透過其本地路徑直接存取它。請勿在建立時為其指定掛接點。</para>
  </important>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12jcw6s" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12jcw75" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12jcw6s">
   <title>分割裝置</title>
   <procedure id="b12jcw6t">
    <step id="b12jcw6u" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
    </step>
    <step id="b12jcw6v" performance="required">
     <para>在 YaST 中，選取<guimenu>系統</guimenu>&gt;<guimenu>磁碟分割程式</guimenu>。</para>
    </step>
    <step id="b12jcw6w" performance="required">
     <para>按一下<guimenu>是</guimenu>繼續顯示關於使用磁碟分割程式的警告。</para>
    </step>
    <step id="b12jcw6x" performance="required">
     <para>在「分割區」頁面的底部，按一下<guimenu>新增</guimenu>以建立分割區，但是不要對其進行格式化，也不要進行掛接。 </para>
     <substeps performance="required">
      <step id="b12o0qiv" performance="required">
       <para>在「進階磁碟分割程式」頁面上，選取<guimenu>硬碟</guimenu>，然後選取要設定之磁碟的葉節點名稱 (例如 <filename>sdc</filename>)。</para>
      </step>
      <step id="b12jcw6y" performance="required">
       <para>選取<guimenu>主分割區</guimenu>，然後按<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b12jcw6z" performance="required">
       <para>指定要使用的空間大小，然後按<guimenu>下一步</guimenu>。</para>
      </step>
      <step id="b12jcw70" performance="required">
       <para>在<guimenu>格式化選項</guimenu>下，選取<guimenu>不格式化</guimenu>，然後從下拉式選單中選取檔案系統 ID 類型。</para>
       <para>iSCSI LIO 目標能夠以 Linux (0x83)、Linux LVM (0x8E) 或 Linux RAID (0xFD) 檔案系統 ID 來使用未格式化的分割區。 </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject>
         <imagedata fileref="lio_disk_format_a.png" width="250pt" format="png"/></imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12jcw71" performance="required">
       <para>在<guimenu>掛接選項</guimenu>下，選取<guimenu>不掛接</guimenu>。</para>
      </step>
      <step id="b12jcw72" performance="required">
       <para>按一下<guimenu>完成</guimenu>。</para>
      </step>
     </substeps>
    </step>
    <step id="b12jcw73" performance="required">
     <para>重複<xref linkend="bj5f9hl" xrefstyle="StepXRef"/> 為日後要用做 iSCSI LIO 目標的每個區域建立未格式化的分割區。</para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject>
       <imagedata fileref="lio_disk_format_multi_a.png" width="250pt" format="png"/></imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jcw74" performance="required">
     <para>按<guimenu>下一步</guimenu>&gt;<guimenu>完成</guimenu>保留變更，然後關閉 YaST。</para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="b12jcw75">
   <title>對虛擬環境中的裝置進行磁碟分割</title>
   <para>您可以使用虛擬機器客體伺服器做為 iSCSI LIO 目標伺服器。本節說明如何將分割區指定給 Xen 虛擬機器。此外，您還可以使用 SUSE Linux Enterprise Server 11 SP2 或更新版本支援的其他虛擬環境。</para>
   <para>在 Xen 虛擬環境中，您必須為客體虛擬機器指定要用於 iSCSI LIO 目標裝置的儲存空間，然後在客體環境內以虛擬磁碟的方式存取該空間。每個虛擬磁碟可以是實體區塊裝置，如整個磁碟、分割區或磁碟區，也可以是檔案備份磁碟影像，其中虛擬磁碟是 Xen 主機伺服器中較大實體磁碟上的一個影像檔案。為獲得最佳效能，請從實體磁碟或分割區建立所有虛擬磁碟。為訪客虛擬機器設定虛擬磁碟後，啟動訪客伺服器，然後依照與實體伺服器相同的程序將新的空白虛擬磁碟設定為 iSCSI 目標裝置。 </para>
   <para>檔案備份磁碟影像建立在 Xen 主機伺服器上，然後會指定給 Xen 客體伺服器。依預設，Xen 會將檔案備份磁碟影像儲存到 <filename>/var/lib/xen/images/<replaceable>vm 名稱</replaceable></filename>目錄中，其中 <filename><replaceable>vm 名稱</replaceable></filename>為虛擬機器的名稱。</para>
   <para>例如，若要建立大小為 4GB 的磁碟影像 <filename>/var/lib/xen/images/vm_one/xen-0</filename>，請先確定該目錄已存在，然後再建立影像本身。</para>
   <procedure id="b12jcw76">
    <step id="b12jcw77" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者的身分登入主機伺服器。</para>
    </step>
    <step id="b12jcw78" performance="required">
     <para>在終端機主控台提示符處，輸入下列指令︰</para>

<screen>
mkdir -p /var/lib/xen/images/vm_one
dd if=/dev/zero of=/var/lib/xen/images/vm_one/xen-0 seek=1M bs=4096 count=1
</screen>

    </step>
    <step id="b12jcw79" performance="required">
     <para>將檔案系統影像指定給 Xen 組態檔案中的訪客虛擬機器。</para>
    </step>
    <step id="b12jcw7a" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分登入訪客伺服器，然後依照<xref linkend="b12jcw6s" xrefstyle="HeadingOnPage"/> 中的程序使用 YaST 設定虛擬區塊裝置。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sect-iscsi-lio-targetgp">
  <title>設定 iSCSI LIO 目標群組</title>
  <para>您可以使用 YaST 來設定 iSCSI LIO 目標裝置。YaST 使用 <command>lio-utils</command> 軟體提供的 API。iSCSI LIO 目標能夠以 Linux、Linux LVM 或 Linux RAID 檔案系統 ID 來使用未格式化的分割區。</para>
  <important>
   <para>在開始之前，請先依<xref linkend="sect-iscsi-lio-storage" xrefstyle="SectTitleOnPage"/> 中所示建立要用做 iSCSI LIO 目標的未格式化分割區。</para>
  </important>
  <procedure id="b12jbfdv">
   <step id="b13n0uju" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分登入 iSCSI LIO 目標伺服器，然後啟動終端機主控台。</para>
   </step>
   <step id="b13n0ujv" performance="required">
    <para>確定 <filename>/etc/init.d/target</filename> 精靈正在執行。在指令提示符下，輸入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>該指令會傳回一則訊息，確認該精靈已啟動或已在執行中。</para>
   </step>
   <step id="b12jbfdw" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="b12jbfdx" performance="required">
    <para>在 YaST 控制中心中，選取<guimenu>網路服務</guimenu>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <para>您也可以搜尋 <quote>lio</quote>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jbfdy" performance="required">
    <para>在「iSCSI LIO 目標綜覽」對話方塊中，選取<guimenu>目標</guimenu>索引標籤以設定目標。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_targets_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12jdln1" performance="required">
    <para role="intro">按一下<guimenu>新增</guimenu>，然後定義新的 iSCSI LIO 目標群組和裝置：</para>
    <para role="intro">iSCSI LIO 目標軟體會自動填寫<guimenu>目標</guimenu>、<guimenu>識別碼</guimenu>、<guimenu>入口群組</guimenu>、<guimenu>IP 位址</guimenu>和<guimenu>埠號</guimenu>欄位。<guimenu>使用驗證</guimenu>預設會處於選中狀態。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_add_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <substeps performance="required">
     <step id="b12jdzge" performance="required">
      <para>如果您有多個網路介面，請使用 IP 位址下拉式選單來選取要用於此目標群組的網路介面 IP 位址。</para>
     </step>
     <step id="b12jdzgf" performance="required">
      <para>如果需要對此目標群組進行用戶端驗證，則選取<guimenu>使用驗證</guimenu>。</para>
      <important>
       <para>建議在線上環境中需要進行驗證。</para>
      </important>
     </step>
     <step id="b12je5o1" performance="required">
      <para>按一下<guimenu>新增</guimenu>，瀏覽以選取裝置或分割區，指定名稱，然後按一下<guimenu>確定</guimenu>。</para>
      <para>LUN 編號將會自動產生，從 0 開始。如果將該欄位保留為空白，則會自動產生名稱。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_target_addnew_a.png" width="91pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12jebk1" performance="required">
      <para>(選擇性) 重複<xref linkend="b12jdzge" xrefstyle="StepXRef"/> 到<xref linkend="b12je5o1" xrefstyle="StepXRef"/> 以將更多目標新增到此目標群組。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_target_list_a.png" width="250pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12jeipi" performance="required">
      <para>將所有需要的目標新增到群組之後，按<guimenu>下一步</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="b12jeipj" performance="required">
    <para>在「修改 iSCSI 目標用戶端設定」頁面上，設定允許存取目標群組中 LUN 之用戶端的資訊：</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_client_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <para>為目標群組至少指定一個用戶端後，<guimenu>編輯 LUN</guimenu>、<guimenu>編輯驗證</guimenu>、<guimenu>刪除</guimenu>和<guimenu>複製</guimenu>按鈕都將啟用。您可以使用<guimenu>新增</guimenu>或<guimenu>複製</guimenu>來為目標群組新增更多用戶端。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_client_options_a.png" width="200pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="b12mh6xo">
       <title>新增︰</title>
       <para>為所選 iSCSI LIO 目標群組新增用戶端項目。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggu">
       <title>編輯 LUN：</title>
       <para>設定將 iSCSI LIO 目標群組中的哪些 LUN 對應到所選用戶端。您可以將每個已配置目標對應到偏好的用戶端 LUN。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggv">
       <title>編輯驗證：</title>
       <para>為所選用戶端設定偏好的驗證方法。您可以指定無驗證，也可以設定內送驗證、外送驗證或兩者。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggw">
       <title>刪除︰</title>
       <para>從配置給目標群組的用戶端清單中移除所選用戶端項目。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="b12mgggx">
       <title>複製︰</title>
       <para>新增用戶端項目，其 LUN 對應和驗證設定與所選用戶端項目相同。這樣，您可以依次將相同的共享 LUN 輕鬆地配置給叢集中的每個節點。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <substeps performance="required">
     <step id="b12mdr9g" performance="required">
      <para>按一下<guimenu>新增</guimenu>，指定用戶端名稱，選取或取消選取<guimenu>從 TPG 輸入 LUN</guimenu>核取方塊，然後按一下<guimenu>確定</guimenu>以儲存設定。 </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client1_new_a.png" width="200pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12mdr9h" performance="required">
      <para>選取用戶端項目，按一下<guimenu>編輯 LUN</guimenu>，修改 LUN 對應以指定將 iSCSI LIO 目標群組中的哪些 LUN 配置給所選用戶端，然後按一下<guimenu>確定</guimenu>以儲存變更。 </para>
      <para>如果 iSCSI LIO 目標群組由多個 LUN 組成，則您可以將一或多個 LUN 配置給所選用戶端。依預設，會將群組中每個可用的 LUN 配置給用戶端 LUN。 </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client3_edit_lun_a.png" width="107pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
      <para>若要修改 LUN 配置，請執行下列一或多個動作： </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="b12mhta3">
         <title>新增︰</title>
         <para>按一下<guimenu>新增</guimenu>以建立新的<guimenu>用戶端 LUN</guimenu>項目，然後使用<guimenu>變更</guimenu>下拉式選單將一個目標 LUN 對應至該項目。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun4_add_a.png" width="107pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <formalpara id="b12mhta4" role="intro">
         <title>刪除︰</title>
         <para>選取<guimenu>用戶端 LUN</guimenu>項目，然後按一下<guimenu>刪除</guimenu>以移除目標 LUN 對應。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun3_delete_a.png" width="106pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <formalpara id="b12mhta5">
         <title>將:</title>
         <para>選取<guimenu>用戶端 LUN</guimenu>項目，然後使用<guimenu>變更</guimenu>下拉式選單來選取要將哪個目標 LUN 對應至該項目。</para>
        </formalpara>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client3_edit_lun2_change_a.png" width="108pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
      </itemizedlist>
      <para>一般配置計畫包含下列各項：</para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>單個伺服器列出為用戶端。目標群組中的所有 LUN 都會配置給它。</para>
        <para>您可以使用此分組策略，為指定伺服器邏輯分組 iSCSI SAN 儲存。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <para role="intro">多個獨立伺服器列出為用戶端。一或多個目標 LUN 會配置給每個伺服器。每個 LUN 僅會配置給一個伺服器。 </para>
        <para>您可以使用此分組策略，為資料中心中的指定部門或服務類別邏輯分組 iSCSI SAN 儲存。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list3_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
       <listitem>
        <para>叢集的每個節點列出為用戶端。所有共享的目標 LUN 都會配置給每個節點。所有節點都會連接至裝置，但是對於大部分檔案系統，叢集軟體會鎖定裝置以禁止存取，並且一次只在一個節點上掛接該裝置。共享檔案系統 (例如 OCFS2) 可讓多個節點同時掛接相同的檔案結構，並以讀寫權限開啟相同檔案。</para>
        <para>您可以使用此分組策略，為指定伺服器叢集邏輯分組 iSCSI SAN 儲存。</para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject>
          <imagedata fileref="lio_client5_list2_a.png" width="250pt" format="png"/></imageobject>
         </mediaobject>
        </informalfigure>
       </listitem>
      </itemizedlist>
     </step>
     <step id="b12mdr9i" performance="required">
      <para>選取用戶端項目，按一下<guimenu>編輯驗證</guimenu>，指定用戶端的驗證設定，然後按一下<guimenu>確定</guimenu>以儲存設定。</para>
      <para>您可以要求<guimenu>無驗證</guimenu>，也可以設定<guimenu>內送驗證</guimenu>、<guimenu>外送驗證</guimenu>或兩者。您只能為每個用戶端指定一個使用者名稱和密碼對。對於用戶端的內送和外送驗證，其身分證明可以不同。每個用戶端的身分證明都可以不同。</para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject>
        <imagedata fileref="lio_client4_edit_auth2_inout_a.png" width="200pt" format="png"/></imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12mdr9j" performance="required">
      <para>為每個可以存取此目標群組的 iSCSI 用戶端重複<xref linkend="b12mdr9g" xrefstyle="StepXRef"/> 到<xref linkend="b12mdr9i" xrefstyle="StepXRef"/>。</para>
     </step>
     <step id="b12mdr9k" performance="required">
      <para> 設定用戶端指定之後，按<guimenu>下一步</guimenu>。</para>
     </step>
    </substeps>
   </step>
   <step id="b12jbfdz" performance="required">
    <para>按一下<guimenu>完成</guimenu>以儲存並套用設定。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_targets_group_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect-iscsi-lio-edit">
  <title>修改 iSCSI LIO 目標群組</title>
  <para>您可以按如下方式修改現有的 iSCSI LIO 目標群組：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>在目標群組中新增或移除目標 LUN 裝置</para>
   </listitem>
   <listitem>
    <para>為目標群組新增或移除用戶端</para>
   </listitem>
   <listitem>
    <para>為目標群組之用戶端修改用戶端 LUN 至目標 LUN 對應</para>
   </listitem>
   <listitem>
    <para>修改用戶端驗證 (內送、外送或兩者) 的使用者名稱和密碼身分證明</para>
   </listitem>
  </itemizedlist>
  <para>若要檢視或修改 iSCSI LIO 目標群組的設定，請執行下列步驟：</para>
  <procedure id="b12o1qa2">
   <step id="b13n0ujw" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分登入 iSCSI LIO 目標伺服器，然後啟動終端機主控台。</para>
   </step>
   <step id="b13n0ujx" performance="required">
    <para>確定 <filename>/etc/init.d/target</filename> 精靈正在執行。在指令提示符下，輸入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>該指令會傳回一則訊息，確認該精靈已啟動或已在執行中。</para>
   </step>
   <step id="b12o1qa3" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="b12o1qa4" performance="required">
    <para role="intro">在 YaST 控制中心中，選取<guimenu>網路服務</guimenu>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <para role="intro">您也可以搜尋 <quote>lio</quote>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1qa5" performance="required">
    <para role="intro">在「iSCSI LIO 目標綜覽」對話方塊中，選取<guimenu>目標</guimenu>索引標籤以檢視目標群組清單。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1qa6" performance="required">
    <para role="intro">選取要修改的 iSCSI LIO 目標群組，然後按一下<guimenu>編輯</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_edit_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1qa7" performance="required">
    <para>在「修改 iSCSI 目標 LUN 設定」頁面上，將 LUN 新增至目標群組，編輯 LUN 指定或從該群組中移除目標 LUN。對群組進行所有需要的變更之後，按<guimenu>下一步</guimenu>。</para>
    <para>如需選項資訊，請參閱<xref linkend="sect-iscsi-lio-targetgp" xrefstyle="SectTitleOnPage"/> 中的<xref linkend="b12jdln1" xrefstyle="StepXRef"/>。</para>
   </step>
   <step id="b12o1qad" performance="required">
    <para>在「修改 iSCSI 目標用戶端設定」頁面上，設定允許存取目標群組中 LUN 之用戶端的資訊。對群組進行所有需要的變更之後，按<guimenu>下一步</guimenu>。</para>
    <para>如需選項資訊，請參閱<xref linkend="sect-iscsi-lio-targetgp" xrefstyle="SectTitleOnPage"/> 中的<xref linkend="b12jeipj" xrefstyle="StepXRef"/>。</para>
   </step>
   <step id="b12o1qar" performance="required">
    <para>按一下<guimenu>完成</guimenu>以儲存並套用設定。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sect-iscsi-lio-delete">
  <title>刪除 iSCSI LIO 目標群組</title>
  <para>刪除 iSCSI LIO 目標群組會移除群組的定義以及用戶端的相關設定，包括 LUN 對應和驗證身分證明。此操作不會損毀分割區上的資料。若要再次提供用戶端存取權限，您可以將目標 LUN 配置給其他或新的目標群組，並為它們設定用戶端存取權限。</para>
  <procedure id="b12o1fhc">
   <step id="b13n0ury" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分登入 iSCSI LIO 目標伺服器，然後啟動終端機主控台。</para>
   </step>
   <step id="b13n0urz" performance="required">
    <para>確定 <filename>/etc/init.d/target</filename> 精靈正在執行。在指令提示符下，輸入</para>

<screen>
/etc/init.d/target start
</screen>

    <para>該指令會傳回一則訊息，確認該精靈已啟動或已在執行中。</para>
   </step>
   <step id="b12o1fhd" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分啟動 YaST。</para>
   </step>
   <step id="b12o1fhe" performance="required">
    <para>在 YaST 控制中心中，選取<guimenu>網路服務</guimenu>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <para>您也可以搜尋 <quote>lio</quote>，然後選取<guimenu>iSCSI LIO 目標</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_yast2_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1fhf" performance="required">
    <para>在「iSCSI LIO 目標綜覽」對話方塊中，選取<guimenu>目標</guimenu>索引標籤以檢視已設定的目標群組清單。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1fhg" performance="required">
    <para role="intro">選取要刪除的 iSCSI LIO 目標群組，然後按一下<guimenu>刪除</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="b12o1iuu" performance="required">
    <para>系統提示時，按一下<guimenu>繼續</guimenu>以確認刪除，或按一下<guimenu>取消</guimenu>進行取消。</para>
   </step>
   <step id="b12o1fi0" performance="required">
    <para>按一下<guimenu>完成</guimenu>以儲存並套用設定。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="b13g8i2g">
  <title>iSCSI LIO 目標伺服器疑難排解</title>
  <para>本節說明 iSCSI LIO 目標伺服器的一些已知問題和可能的解決方案。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13g8i2h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g8r6r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b13g8i2h">
   <title>設定目標 LUN 時發生入口錯誤 </title>
   <para>新增或編輯 iSCSI LIO 目標群組時發生錯誤：</para>

<screen>
Problem setting network portal &lt;ip_address&gt;:3260
</screen>

   <para><filename>/var/log/YasT2/y2log</filename> 記錄檔案包含下列錯誤：</para>

<screen>
find: `/sys/kernel/config/target/iscsi': No such file or directory
</screen>

   <para>如果 iSCSI LIO 目標伺服器軟體目前未在執行中，則會發生此問題。若要解決此問題，請結束 YaST，並在指令行中手動啟動 iSCSI LIO，然後再試一次。</para>
   <procedure id="b13g8i2i">
    <step id="b13g8i2j" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分開啟終端機主控台。</para>
    </step>
    <step id="b13g8i2k" performance="required">
     <para>在指令提示符下，輸入</para>

<screen>
/etc/init.d/target start
</screen>

    </step>
   </procedure>
   <para role="intro">您也可以輸入下列指令來檢查 <command>configfs</command>、<command>iscsi_target_mod</command> 和 <command>target_core_mod</command> 是否已載入。隨即會顯示回應範例。</para>

<screen>
<command>lsmod | grep iscsi</command>

  iscsi_target_mod      295015  0
  target_core_mod       346745  4
  iscsi_target_mod,target_core_pscsi,target_core_iblock,target_core_file
  configfs               35817  3 iscsi_target_mod,target_core_mod
  scsi_mod              231620  16
  iscsi_target_mod,target_core_pscsi,target_core_mod,sg,sr_mod,mptctl,sd_mod,
  scsi_dh_rdac,scsi_dh_emc,scsi_dh_alua,scsi_dh_hp_sw,scsi_dh,libata,mptspi,
  mptscsih,scsi_transport_spi
</screen>

  </sect2>
  <sect2 id="b13g8r6r">
   <title>iSCSI LIO 目標在其他電腦中不可見</title>
   <para>如果在目標伺服器上使用防火牆，則必須開啟要用於允許其他電腦看到 iSCSI LIO 目標的 iSCSI 連接埠。如需相關資訊，請參閱<xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/> 中的<xref linkend="b12jaucl" xrefstyle="StepXRef"/>。</para>
  </sect2>
 </sect1>
 <sect1 id="b12iqi8o">
  <title>iSCSI LIO 目標術語</title>
  <variablelist>
   <varlistentry id="b12iqi8p">
    <term>備援儲存庫</term>
    <listitem>
     <para>一個實體儲存物件，可在 iSCSI 端點下提供實際儲存裝置。 </para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir33x">
    <term>CDB (指令描述子區塊)</term>
    <listitem>
     <para>SCSI 指令的標準格式。CDB 的長度通常為 6、10 或 12 個位元組，但也可以達到 16 個位元組或可變長度。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8q">
    <term>CHAP (Challenge Handshake 驗證通訊協定)</term>
    <listitem>
     <para>一種點對點通訊協定 (PPP) 驗證方法，用於向一台電腦確認另一台電腦的身分。連結控制通訊協定 (LCP) 連接兩台電腦並且協商 CHAP 方法之後，驗證程式會將一個隨機處理安全傳送給對等。對等會根據處理安全和私密金鑰發出以雜湊加密的回應。驗證程式會針對它自己計算所得的預期雜湊值驗證雜湊回應，以確認驗證或終止連接。CHAP 的定義可見<ulink url="http://www.ietf.org">網際網路工程任務推動小組 (IETF)</ulink> RFC 1994。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8r">
    <term>CID (連接識別碼)</term>
    <listitem>
     <para>由啟動器產生的 16 位元編號，用於唯一地識別兩個 iSCSI 裝置之間的連接。此編號會在登入階段期間顯示。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8s">
    <term>端點</term>
    <listitem>
     <para> iSCSI 目標名稱與 iSCSI TPG (IQN + 標記) 的組合。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8t">
    <term>EUI (延伸唯一識別碼)</term>
    <listitem>
     <para>在全球範圍內唯一識別每個裝置的 64 位元編號。其格式由指定公司的唯一 24 位元編號以及該公司指定給所建置的每個裝置的 40 位元編號組成。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8u">
    <term>執行者</term>
    <listitem>
     <para>SCSI 工作階段的發出端。一般是控制裝置，例如電腦。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8v">
    <term>IPS (網際網路通訊協定儲存)</term>
    <listitem>
     <para>使用 IP 通訊協定在儲存網路中移動資料的一類通訊協定或裝置。FCIP (網際網路通訊協定光纖通道)、iFCP (網際網路光纖通道通訊協定) 和 iSCSI (網際網路 SCSI) 都屬於 IPS 通訊協定。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8w">
    <term>IQN (iSCSI 合格的名稱)</term>
    <listitem>
     <para>在全球範圍內唯一識別每個裝置的 iSCSI 名稱格式 (例如：<filename>iqn.5886.com.acme.tapedrive.sn‐a12345678</filename>)。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8x">
    <term>ISID (啟動器工作階段識別碼)</term>
    <listitem>
     <para> 由啟動器產生的一個 48 位元編號，用於唯一識別啟動器與目標之間的工作階段。此值在登入過程中建立，然後將與登入 PDU 一起傳送給目標。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8y">
    <term>MCS (每個工作階段多個連接)</term>
    <listitem>
     <para>屬於 iSCSI 規格的一部分，它允許在啟動器與目標之間存在多個 TCP/IP 連接。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqi8z">
    <term>MPIO (多重路徑 I/O)</term>
    <listitem>
     <para>一種可在伺服器與儲存之間建立多個資料備援路徑的方法。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8e">
    <term>網路入口</term>
    <listitem>
     <para>iSCSI 端點與 IP 位址及 TCP (傳輸控制通訊協定) 連接埠的組合。按照 IANA (Internet Assigned Numbers Authority) 的定義，TCP 連接埠 3260 是 iSCSI 通訊協定的埠號。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8f">
    <term>SAM (SCSI 架構模型)</term>
    <listitem>
     <para>使用一般術語說明 SCSI 行為的文件，允許不同類型的裝置透過各種媒體進行通訊。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8g">
    <term>target</term>
    <listitem>
     <para>SCSI 工作階段的接收端，通常是一個裝置，例如磁碟機、磁帶機或掃描器。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12iqu8h">
    <term>目標群組 (TG)</term>
    <listitem>
     <para>在建立檢視窗時視為同等看待的所有 SCSI 目標連接埠的清單。建立檢視窗可便於進行 LUN (邏輯單位編號) 對應。每個檢視項目都會指定一個目標群組、主機群組和一個 LUN。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir33y">
    <term>目標連接埠</term>
    <listitem>
     <para>一個 iSCSI 端點與一或多個 LUN 的組合。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir33z">
    <term>目標連接埠群組 (TPG)</term>
    <listitem>
     <para>IP 位址和 TCP 埠號的清單，用於決定特定 iSCSI 目標將要監聽的介面。</para>
    </listitem>
   </varlistentry>
   <varlistentry id="b12ir340">
    <term>目標工作階段識別碼 (TSID)</term>
    <listitem>
     <para>由目標產生的一個 16 位元編號，用於唯一識別啟動器與目標之間的工作階段。此值在登入過程中建立，然後將與登入回應 PDU (通訊協定資料單位) 一起傳送給啟動器。</para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>

<chapter conformance="sles11,Novell,no,0,80" id="cha-fcoe" lang="zh-tw" revision="02/01/12" xml:base="06_fcoe.xml">
 <title>乙太網路上的光纖通道儲存：FCoE</title>
 <para>許多企業資料中心的 LAN 和資料流量都依賴於乙太網路，而他們的儲存基礎架構則依賴於光纖通道網路。開放式乙太網路光纖通道 (FCoE) 啟動器軟體允許具有乙太網路卡的伺服器透過乙太網路連接至光纖通道儲存子系統。而在以前，此連接性僅可供具有光纖通道配接器的系統透過光纖通道光纖使用。FCoE 技術支援網路會聚，降低了資料中心的複雜程度。這可協助您保護在光纖通道儲存基礎架構中的現有投資，並簡化網路管理。 </para>
 <figure pgwide="0" id="bwkfm8v">
  <title>開放式乙太網路光纖通道 SAN</title>
  <mediaobject>
   <imageobject role="fo">
   <imagedata fileref="fcoe_san_a.png" width="445pt" format="eps"/></imageobject>
   <imageobject role="html">
   <imagedata fileref="fcoe_san_a.png" width="445pt" format="png"/></imageobject>
  </mediaobject>
 </figure>
 <para>開放式 FCoE 可讓您在主機上，而不是在主機匯流排配接器上的專屬硬體上執行光纖通道通訊協定。它專用於 10 Gbps (每秒 GB) 乙太網路卡，但是也可用於支援暫停訊框的任何乙太網路卡。啟動器軟體提供光纖通道通訊協定處理模組以及基於乙太網路的傳輸模組。開放式 FCoE 模組用作 SCSI 的低階驅動程式。開放式 FCoE 傳輸使用 <command>net_device</command> 來傳送和接收封包。資料中心橋接 (DCB) 驅動程式提供 FCoE 的服務品質。 </para>
 <para>FCoE 是一種封裝通訊協定，它可透過乙太網路連接移動光纖通道通訊協定流量，而不需要變更光纖通道訊框。這使得網路安全和流量管理基礎架構可以如同採用光纖通道一樣利用 FCoE。</para>
 <para>如果存在下列情況，則可以選擇在您的企業中部署開放式 FCoE： </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>您的企業已擁有光纖通道儲存子系統，以及具備光纖通道技能和知識的管理員。</para>
  </listitem>
  <listitem>
   <para>您要在網路中部署 10 Gbps 乙太網路。</para>
  </listitem>
 </itemizedlist>
 <para>本節說明如何在網路中設定 FCoE。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bxurl07" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycsjf0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxyqov2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuri58" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuptlv" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycscw6" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bycscw7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bxuqb00" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bxurl07">
  <title>安裝 FCoE 和 YaST FCoE 用戶端</title>
  <para>您可透過在交換器上啟用 FCoE 以連接伺服器的方式，於儲存基礎架構中設定 FCoE 磁碟。如果在安裝 SUSE Linux Enterprise Server 作業系統時 FCoE 磁碟可用，則會在此時自動安裝 FCoE 啟動器軟體。 </para>
  <para>如果 FCoE 啟動器軟體和 YaST FCoE 用戶端軟體均未安裝，請使用下列程序在現有系統上手動安裝它們：</para>
  <procedure id="bxurln0">
   <step id="byd2977" performance="required">
    <para>請以 <systemitem>root</systemitem> 使用者的身分登入伺服器。</para>
   </step>
   <step id="bxurln1" performance="required">
    <para>在 YaST 中，選取<guimenu>軟體</guimenu>&gt;<guimenu>軟體管理</guimenu>。</para>
   </step>
   <step id="bxurlrs" performance="required">
    <para>搜尋並選取下列 FCoE 套件：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>open-fcoe</para>
     </listitem>
     <listitem>
      <para>yast2-fcoe-client</para>
     </listitem>
    </itemizedlist>
    <para role="intro">例如，在<guimenu>搜尋</guimenu>欄位中鍵入 <literal>fcoe</literal>，按一下<guimenu>搜尋</guimenu>以尋找軟體套件，然後選取要安裝之每個套件旁邊的核取方塊。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_install2_a.png" width="241pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bxurni7" performance="required">
    <para>按一下<guimenu>接受</guimenu>，然後按一下<guimenu>繼續</guimenu>以接受自動變更。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bycsjf0">
  <title>在安裝期間設定 FCoE 介面</title>
  <para>如果在交換器上為伺服器與光纖通道儲存基礎架構之間的連接啟用了 FCoE，則可以透過適用於 SUSE Linux Enterprise Server 的 YaST 安裝來在作業系統安裝期間設定 FCoE 磁碟。某些類型的系統 BIOS 能自動偵測到 FCoE 磁碟，並向 YaST 安裝軟體報告這些磁碟。不過，並非所有類型的 BIOS 都支援 FCoE 磁碟的自動偵測。在此情況下，若要啟用自動偵測，則可以在開始安裝時將 <command>withfcoe</command> 選項新增至核心指令行：</para>

<screen>
withfcoe=1
</screen>

  <para role="intro">偵測到 FCoE 磁碟時，YaST 安裝會在此時提供用於設定 FCoE 例項的選項。在「磁碟啟動」頁面上，選取<guimenu>設定 FCoE 介面</guimenu>以存取 FCoE 組態。如需如何設定 FCoE 介面的相關資訊，請參閱<xref linkend="bxyqov2" xrefstyle="SectTitleOnPage"/>。</para>
  <informalfigure pgwide="0">
   <mediaobject>
    <imageobject>
    <imagedata fileref="fcoe_inst_disk_activation_a.png" width="253pt" format="png"/></imageobject>
   </mediaobject>
  </informalfigure>
 </sect1>
 <sect1 id="bxyqov2">
  <title>使用 YaST 管理 FCoE 服務</title>
  <para>您可以使用「YaST FCoE 用戶端組態」選項來為光纖通道儲存基礎架構中的 FCoE 磁碟建立、設定和移除 FCoE 介面。若要使用此選項，必須安裝並執行 FCoE 啟動器服務 (<filename>fcoemon</filename> 精靈) 和「連結層探查協定」代理程式精靈 (<command>lldpad</command>)，並且必須在支援 FCoE 的交換器上啟用 FCoE 連接。</para>
  <procedure id="bxyqpcm">
   <step id="bxyqpcn" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分登入，然後啟動 YaST。</para>
   </step>
   <step id="bxyqpl8" performance="required">
    <para>在 YaST 中，選取<guimenu>網路服務</guimenu>&gt;<guimenu>FCoE 用戶端組態</guimenu>。 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_yast2_a.png" width="191pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <para>「乙太網路光纖通道組態」對話方塊提供了三個索引標籤：</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para><guimenu>服務</guimenu></para>
     </listitem>
     <listitem>
      <para><guimenu>介面</guimenu></para>
     </listitem>
     <listitem>
      <para><guimenu>組態</guimenu></para>
     </listitem>
    </itemizedlist>
   </step>
   <step id="bycsvr4" performance="required">
    <para role="intro">在<guimenu>服務</guimenu>索引標籤上，可以視需要檢視或修改 FCoE 服務和 Lldpad (「連結層探查協定」代理程式精靈) 服務啟動時間。 </para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_services_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bycssp2" role="intro">
       <title>啟動 FCoE 服務：</title>
       <para>指定是在伺服器開機時啟動乙太網路光纖通道服務 <command>fcoemon</command> 精靈還是手動啟動。該精靈用於控制 FCoE 介面並會與 <command>lldpad</command> 精靈建立連接。值為<guimenu>開機時</guimenu>(預設) 或<guimenu>手動</guimenu>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bycsvr5" role="intro">
       <title>啟動 Lldpad 服務：</title>
       <para>指定是在伺服器開機時啟動「連結層探查協定」代理程式 <command>lldpad</command> 精靈還是手動啟動。<command>lldpad</command> 精靈會向 <command>fcoemon</command> 精靈報告「資料中心橋接」功能和 FCoE 介面配置的相關資訊。值為<guimenu>開機時</guimenu>(預設) 或<guimenu>手動</guimenu>。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>如果修改設定，請按一下<guimenu>確定</guimenu>以儲存並套用變更。</para>
   </step>
   <step id="bycsxr4" performance="required">
    <para>在<guimenu>介面</guimenu>索引標籤上，可以檢視伺服器上所有偵測到的網路卡的相關資訊，包括 VLAN 和 FCoE 組態的相關資訊。您還可以建立 FCoE VLAN 介面、變更現有 FCoE 介面的設定或移除 FCoE 介面。</para>
    <formalpara id="byct84b" role="intro">
     <title>檢視 FCoE 資訊</title>
     <para/>
    </formalpara>
    <para role="intro"><guimenu>FCoE 介面</guimenu>表格中顯示下列每個配接器的相關資訊：</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_notconfig_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="byd3h1o" role="intro">
       <title>裝置名稱：</title>
       <para>指定配接器名稱，例如 <filename>eth4</filename>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3hdt">
       <title>模型:</title>
       <para>指定配接器型號資訊。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3l6i" role="intro">
       <title>FCoE VLAN 介面</title>
       <para/>
      </formalpara>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <formalpara id="byd3nbb">
         <title>介面名稱：</title>
         <para>如果將名稱 (例如 <filename>eth4.200</filename>) 指定給介面，則 FCoE 在交換器上可用，並會為配接器啟動 FCoE 介面。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="byd3o01">
         <title>未設定組態:</title>
         <para>如果狀態是<guimenu>未設定</guimenu>，則表示在交換器上啟用 FCoE，但是尚未為配接器啟動 FCoE 介面。選取配接器，然後按一下<guimenu>建立 FCoE VLAN 介面</guimenu>以在配接器上啟動介面。</para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="byd3ohg">
         <title>Not Available:</title>
         <para>如果狀態是<guimenu>不可用</guimenu>，則表示因為沒有在交換器上為該連接啟用 FCoE，所以 FCoE 對於配接器不可用。 </para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </listitem>
     <listitem>
      <formalpara id="byd3mds">
       <title>FCoE 啟用：</title>
       <para>指定是否在交換器上為配接器連接啟用 FCoE。(<guimenu>是</guimenu>或<guimenu>否</guimenu>)</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3pvk">
       <title>需要 DCB：</title>
       <para>指定配接器是否需要資料中心橋接。(<guimenu>是</guimenu>或<guimenu>否</guimenu>)</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3qba">
       <title>自動 VLAN：</title>
       <para>指定是否為配接器啟用自動 VLAN 組態。(<guimenu>是</guimenu>或<guimenu>否</guimenu>)</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byd3r0o">
       <title>支援 DCB：</title>
       <para>指定配接器是否支援資料中心橋接。(<guimenu>是</guimenu>或<guimenu>否</guimenu>)</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <formalpara id="byct8zr" role="intro">
     <title>變更 FCoE 設定</title>
     <para/>
    </formalpara>
    <para role="intro">選取 FCoE VLAN 介面，然後按一下頁面底部的<guimenu>變更設定</guimenu>以開啟「變更 FCoE 設定」對話方塊。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_modify_config_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="byctmy6">
       <title>FCoE 啟用：</title>
       <para>啟用或停用為配接器建立 FCoE 例項。值為<guimenu>是</guimenu>或<guimenu>否</guimenu>。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byctn94">
       <title>需要 DCB：</title>
       <para>指定配接器是否需要資料中心橋接。值為<guimenu>是</guimenu>(預設) 或<guimenu>否</guimenu>。一般情況下都需要 DCB。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="byctn95">
       <title>自動 VLAN：</title>
       <para>指定 <filename>fcoemon</filename> 精靈是否自動建立 VLAN 介面。值為<guimenu>是</guimenu>或<guimenu>否</guimenu>。</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>如果修改設定，請按一下<guimenu>下一步</guimenu>以儲存並套用變更。這些設定會寫入 <filename>/etc/fcoe/eth<replaceable>X</replaceable></filename> 檔案中。<command>fcoemon</command> 精靈會在啟始化時讀取每個 FCoE 介面的組態檔案。每個 FCoE 介面都有一個檔案。 </para>
    <formalpara id="byctarx" role="intro">
     <title>建立 FCoE VLAN 介面</title>
     <para/>
    </formalpara>
    <para role="intro">選取已啟用但未設定 FCoE 的配接器，然後按一下<guimenu>是</guimenu>以設定 FCoE 介面。已指定的介面名稱會出現在清單中，例如 <filename>eth5.200</filename>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_create_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <formalpara id="byct8zs" role="intro">
     <title>移除 FCoE 介面</title>
     <para/>
    </formalpara>
    <para role="intro">選取要移除的 FCoE 介面，然後按一下頁面底部的<guimenu>移除介面</guimenu>，再按一下<guimenu>繼續</guimenu>以確認。FCoE 介面值會變更為<guimenu>未設定</guimenu>。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_remove_interface_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step id="bxyqqb9" performance="required">
    <para role="intro">在<guimenu>組態</guimenu>索引標籤上，可以檢視或修改 FCoE 系統服務的一般設定。</para>
    <informalfigure pgwide="0">
     <mediaobject>
      <imageobject>
      <imagedata fileref="fcoe_configtab_a.png" width="201pt" format="png"/></imageobject>
     </mediaobject>
    </informalfigure>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara id="bycsz4d" role="intro">
       <title>除錯：</title>
       <para>從 FCoE 服務指令碼和 <command>fcoemon</command> 精靈啟用或停用除錯訊息。值為<guimenu>是</guimenu>或<guimenu>否</guimenu>(預設)。</para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara id="bycsz4e" role="intro">
       <title>使用 syslog：</title>
       <para>指定是否將訊息傳送至系統記錄 (<filename>/var/log/syslog</filename>)。值為<guimenu>是</guimenu>(預設) 或<guimenu>否</guimenu>。(資料記錄在 <filename>/var/log/messages</filename> 中。)</para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>如果修改設定，請按一下<guimenu>確定</guimenu>以儲存並套用變更。這些設定會寫入 <filename>/etc/fcoe/config</filename> 檔案中。</para>
   </step>
   <step id="bxyqr8g" performance="required">
    <para>按一下<guimenu>確定</guimenu>以儲存並套用變更。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="bxuri58">
  <title>使用指令設定 FCoE</title>
  <procedure id="bxupm0j">
   <step id="bxupo5v" performance="required">
    <para>以 <systemitem>root</systemitem> 使用者身分登入伺服器，然後開啟終端機主控台。</para>
   </step>
   <step id="bxupmnl" performance="required">
    <para>使用 YaST 設定乙太網路的網路介面卡，例如 <filename>eth2</filename>。</para>
   </step>
   <step id="bxuslhx" performance="required">
    <para>啟動「連結層探查協定」代理程式精靈 (<command>lldpad</command>)。</para>

<screen>
rclldpad start
</screen>

   </step>
   <step id="bxupmpk" performance="required">
    <para role="intro">在乙太網路卡上啟用資料中心橋接<filename/>。</para>

<screen>
dcbtool sc eth2 dcb on
  Version:       2
  Command:       Set Config
  Feature:       DCB State
  Port:          eth2
  Status:        Successful
</screen>

   </step>
   <step id="bynkhpe" performance="required">
    <para>啟用並設定資料中心橋接的優先程度流程控制 (PFC) 設定。</para>

<screen>
dcbtool sc eth&lt;x&gt; pfc e:1 a:1 w:1
</screen>

    <para>引數設定值為：</para>
    <variablelist>
     <varlistentry id="bynkj1s">
      <term>e:&lt;0|1&gt;</term>
      <listitem>
       <para>控制功能啟用。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bynkjej">
      <term>a:&lt;0|1&gt;</term>
      <listitem>
       <para>控制是否透過資料中心橋接交換通訊協定向對等推廣功能。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="bynkjy8">
      <term>w:&lt;0|1&gt;</term>
      <listitem>
       <para> 控制功能是否希望根據從對等接收到的回饋變更其操作組態。 </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step id="bxuppth" performance="required">
    <para>啟用資料中心橋接以接受交換器的 FCoE 優先程度設定。</para>

<screen>
dcbtool sc eth2 app:fcoe e:1
  Version:       2
  Command:       Set Config
  Feature:       Application FCoE
  Port:          eth2
  Status:        Successful
</screen>

   </step>
   <step id="bxupsun" performance="required">
    <para>將預設 FCoE 組態檔案複製到 <filename>/etc/fcoe/cfg-eth2</filename>。</para>

<screen>
cp /etc/fcoe/cfg-ethx /etc/fcoe/cfg-eth2

</screen>

   </step>
   <step id="bxupsnh" performance="required">
    <para>啟動 FCoE 啟動器服務。</para>

<screen>
rcfcoe start
  Starting FCoE initiator service
</screen>

   </step>
   <step id="bxuslzn" performance="required">
    <para>將「連結層探查通訊協定」代理程式精靈 (<command>lldpad</command>) 和 FCoE 啟動器服務設定為開機時啟動。</para>

<screen>
chkconfig boot.lldpad on

chkconfig boot.fcoe on
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bxuptlv">
  <title>使用 FCoE 管理工具管理 FCoE 例項</title>
  <para><command>fcoeadm</command> 公用程式是適用於開放式 FCoE 專案的乙太網路光纖通道 (FCoE) 管理工具。可以在指定網路介面上使用該工具來建立、損毀和重設 FCoE 例項。<command>fcoeadm</command> 公用程式透過通訊端介面將指令傳送給正在執行的 <command>fcoemon</command> 程序。如需 <command>fcoemon</command> 的相關資訊，請參閱 <command>fcoemon(8)</command> man 頁面。</para>
  <para><command>fcoeadm</command> 公用程式可讓您查詢 FCoE 例項的下列相關資訊：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>介面</para>
   </listitem>
   <listitem>
    <para>目標 LUN</para>
   </listitem>
   <listitem>
    <para>連接埠統計資料</para>
   </listitem>
  </itemizedlist>
  <para> <command>fcoeadm</command> 公用程式是 <filename>fcoe-utils</filename> 套件的一部分。它由<ulink url="http://open-fcoe.org/">開放式 FCoE 專案</ulink> 維護。</para>
  <variablelist>
   <varlistentry id="bxuq220">
    <term>語法</term>
    <listitem>
     <para>乙太網路光纖通道管理 1.0.12 版。</para>

<screen>
fcoeadm
  [-c|--create] [&lt;ethX&gt;]
  [-d|--destroy] [&lt;ethX&gt;]
  [-r|--reset] [&lt;ethX&gt;]
  [-S|--Scan] [&lt;ethX&gt;]
  [-i|--interface] [&lt;ethX&gt;]
  [-t|--target] [&lt;ethX&gt;]
  [-l|--lun] [&lt;ethX&gt;]
  [-s|--stats &lt;ethX&gt;] [&lt;interval&gt;]
  [-v|--version]
  [-h|--help]
</screen>

    </listitem>
   </varlistentry>
   <varlistentry id="bxus2zv">
    <term>選項</term>
    <listitem>
     <variablelist>
      <varlistentry id="bxus360">
       <term><literal>-c</literal></term>
       <term><literal>--create &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>根據指定的網路介面建立 FCoE 例項。如果開放式 FCoE 服務精靈介面沒有 <command>fcoemon</command> 組態檔案 (<filename>/etc/fcoe/cfg-ethx</filename>；請參閱 <command>fcoemon(8)</command> man 頁面)，則所建立的 FCoE 例項不需要資料中心橋接。</para>
        <formalpara id="bycrwhb">
         <title>範例：</title>
         <para>在 <filename>eth2.101</filename> 上建立 FCoE 例項：</para>
        </formalpara>

<screen>
fcoeadm -c eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxus6nh">
       <term><literal>-d</literal></term>
       <term><literal>--destroy &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>損毀指定網路介面上的 FCoE 例項。此指令不會損毀 <command>fipvlan</command> 建立的 FCoE 例項。</para>
        <formalpara id="bycrz5k">
         <title>範例：</title>
         <para>損毀 <filename>eth2.101</filename> 上的 FCoE 例項：</para>
        </formalpara>

<screen>
fcoeadm -d eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusdp0">
       <term><literal>-h</literal></term>
       <term><literal>--help</literal></term>
       <listitem>
        <para>顯示 <command>fcoeadm</command> 指令的用途訊息。</para>
       </listitem>
      </varlistentry>
      <varlistentry id="bxusaym">
       <term><literal>-i</literal></term>
       <term><literal>--interface [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>顯示指定網路介面上的 FCoE 例項的相關資訊。如果沒有指定任何網路介面，則會顯示所有 FCoE 例項的資訊。</para>
        <formalpara id="bycrz5l">
         <title>範例</title>
         <para/>
        </formalpara>
        <para>顯示所有配接器及其建立有 FCoE 例項之連接埠的相關資訊：</para>

<screen>
fcoeadm -i
</screen>

        <para>顯示介面 <filename>eth3</filename> 上所有 FCoE 例項的相關資訊：</para>

<screen>
fcoeadm -i eth3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusayp">
       <term><literal>-l</literal></term>
       <term><literal>--lun [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>顯示與指定網路介面上的 FCoE 例項相關聯的已探查到 SCSI LUN 的詳細資訊。如果沒有指定任何網路介面，則會顯示來自所有 FCoE 例項的 SCSI LUN 的相關資訊。</para>
        <formalpara id="bycs78a" role="intro">
         <title>範例</title>
         <para/>
        </formalpara>
        <para role="intro">顯示在所有 FCoE 連接上探查到的所有 LUN 的詳細資訊：</para>

<screen>
fcoeadm -l
</screen>

        <para>顯示在特定連接 (例如 <filename>eth3.101</filename>) 上探查到的所有 LUN 的詳細資訊：</para>

<screen>
fcoeadm -l eth3.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxus75n">
       <term><literal>-r</literal></term>
       <term><literal>--reset &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>重設指定網路介面上的 FCoE 例項。此指令不會重設 <command>fipvlan</command> 建立的 FCoE 例項。</para>
        <formalpara id="bycrz5m">
         <title>範例：</title>
         <para>重設 <filename>eth2.101</filename> 上的 FCoE 例項：</para>
        </formalpara>

<screen>
fcoeadm -r eth2.101
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxuscy5">
       <term><literal>-s</literal></term>
       <term><literal>--stats &lt;eth<replaceable>X</replaceable>&gt; [interval]</literal></term>
       <listitem>
        <para>顯示指定網路介面上之 FCoE 例項的統計資料 (包括 FC4 統計資料)。每隔指定時間間隔會顯示一行。指定大於 0 的整數間隔值。間隔值是間隔的經過時間 (以秒為單位)。如果未指定間隔，則預設間隔為 1 秒。</para>
        <formalpara id="bycs78b">
         <title>範例︰</title>
         <para/>
        </formalpara>
        <para>您可以顯示具有 FCoE 例項之特定 <filename>eth3</filename> 連接埠的統計資訊。每隔一段時間會顯示一行統計資料。如果指令中未指定則預設間隔為 1 秒。</para>

<screen>
fcoeadm -s eth3
</screen>

        <para>以 3 秒的時間間隔顯示具有 FCoE 例項之特定 <filename>eth 3</filename> 連接埠的統計資訊。每隔一段時間會顯示一行統計資料。 </para>

<screen>
fcoeadm -s eth3 3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusayn">
       <term><literal>-S</literal></term>
       <term><literal>--Scan &lt;eth<replaceable>X&gt;</replaceable></literal></term>
       <listitem>
        <para>重新掃描指定網路介面的新目標和 LUN。此指令不會重新掃描相同連接埠上建立的任何 NPIV (N_Port ID 虛擬化) 例項，也不會重新掃描 <command>fipvlan</command> 建立的任何 FCoE 例項。</para>
       </listitem>
      </varlistentry>
      <varlistentry id="bxusayo">
       <term><literal>-t</literal></term>
       <term><literal>--target [&lt;eth<replaceable>X&gt;</replaceable>]</literal></term>
       <listitem>
        <para>顯示與指定網路介面上的 FCoE 例項相關聯的已探查到目標的相關資訊。如果沒有指定任何網路介面，則會顯示來自所有 FCoE 例項的已探查到目標的相關資訊。</para>
        <formalpara id="bycs3pt">
         <title>範例</title>
         <para/>
        </formalpara>
        <para>您可以顯示來自具有 FCoE 例項之所有連接埠的所有已探查到目標的相關資訊。這些目標可能位於不同的介面卡上。每個已探查到的目標後面列出了所有相關聯的 LUN。</para>

<screen>
fcoeadm -t
</screen>

        <para>您可以顯示來自具有 FCoE 例項之指定 <filename>eth3</filename> 連接埠的所有已探查到目標的相關資訊。每個已探查到的目標後面列出了所有相關聯的 LUN。</para>

<screen>
fcoeadm -t eth3
</screen>

       </listitem>
      </varlistentry>
      <varlistentry id="bxusdp1">
       <term><literal>-v</literal></term>
       <term><literal>--版本</literal></term>
       <listitem>
        <para>顯示 <command>fcoeadm</command> 指令的版本。</para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry id="bxupx3p">
    <term>FCoE 回應範例</term>
    <listitem>
     <variablelist>
      <varlistentry id="bxupyie">
       <term>檢視 FCoE 啟動器狀態以取得 FC-ID 節點/埠號</term>
       <listitem>

<screen role="screenshot">
fcoeadm -i eth0.201
  Description:      82599EB 10-Gigabit SFI/SFP+ Network Connection 
  Revision:         01
  Manufacturer:     Intel Corporation 
  Serial Number:    001B219B258C 
  Driver:           ixgbe 3.3.8-k2 
  Number of Ports:  1      

      Symbolic Name:     fcoe v0.1 over eth0.201     
      OS Device Name:    host8     
      Node Name:         0x1000001B219B258E     
      Port Name:         0x2000001B219B258E     
      FabricName:        0x2001000573D38141     
      Speed:             10 Gbit     
      Supported Speed:   10 Gbit     
      MaxFrameSize:      2112     
      FC-ID (Port ID):   0x790003     
      State:             Online
</screen>
</listitem>
      </varlistentry>
      <varlistentry id="bxuq45l">
       <term>檢視 FCoE 目標以取得 FC-ID 節點/埠號</term>
       <listitem>

<screen role="screenshot">
fcoeadm -t eth0.201  
  Interface:        eth0.201 
  Roles:            FCP Target 
  Node Name:        0x200000D0231B5C72 
  Port Name:        0x210000D0231B5C72 
  Target ID:        0 
  MaxFrameSize:     2048 
  OS Device Name:   rport-8:0-7 
  FC-ID (Port ID):  0x79000C 
  State:            Online  

LUN ID  Device Name   Capacity   Block Size  Description 
------  -----------  ----------  ----------  ----------------------------     
    40  /dev/sdqi     792.84 GB      512     IFT DS S24F-R2840-4 (rev 386C)
    72  /dev/sdpk     650.00 GB      512     IFT DS S24F-R2840-4 (rev 386C)
   168  /dev/sdgy       1.30 TB      512     IFT DS S24F-R2840-4 (rev 386C)
</screen>
</listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="bycscw6">
  <title>設定 FCoE 啟動器磁碟的分割區</title>
  <para role="intro">您可以使用 <command>fdisk(8)</command> 指令來設定 FCoE 啟動器磁碟的分割區。</para>

<screen role="screenshot">
fdisk /dev/sdc
  Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel.
  Building a new DOS disklabel with disk identifier 0xfc691889.
  Changes will remain in memory only, until you decide to write them.
  After that, of course, the previous content won’t be recoverable.

  Warning: Invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

  Command (n for help): n
  Command action
     e    extended
     p    primary partition (1-4)

  p
     Partition number (1-4): 4
     First cylinder (1-1017, default 1): 
       Using default value 1
     Last cylinder, *cylinders or *size(K,M,G) (1-1017, default 1017):
       Using default value 1017

  Command (n for help): w
     The partition table has been altered!

     Calling loctl() to re-read partition table.
     Syncing disks.
</screen>

 </sect1>
 <sect1 id="bycscw7">
  <title>在 FCoE 啟動器磁碟上建立檔案系統</title>
  <para>您可以使用 <command>mkfs(8)</command> 指令在 FCoE 啟動器磁碟上建立檔案系統。</para>

<screen role="screenshot">
mkfs /dev/sdc
  mke2fs 1.41.9 (22-Aug-2011)
  /dev/sdc is entire device, not just one partition!
  Proceed anyway? (y, n) y
  Filesystem label=
  OS type: Linux
  Block size=4096 (log-2)
  262144 inodes, 1048576 blocks
  52428 blocks (5.00%) reserved for the super user
  First data block=0
  Maximum filesystem blocks=1073741824
  32 block groups
  32768 blocks per group, 32768 fragments per group
  8192 inodes per group
  Superblock backups stored on blocks:
          32768, 98304, 163840, 229376, 294912, 819200, 804736

  Writing inode tables: done
  Writing superblocks and filesystem accounting information: done

  This filesystem will be automatically checked every 27 mounts or
  180 days, whichever comes first. Use tune2fs -c or -i to override.
</screen>

 </sect1>
 <sect1 id="bxuqb00">
  <title>其他資訊</title>
  <para>如需相關資訊，請參閱以下文件：</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>如需開放式 FCoE 服務精靈的相關資訊，請參閱 <command>fcoemon(8)</command> man 頁面。</para>
   </listitem>
   <listitem>
    <para>如需開放式 FCoE 管理工具的相關資訊，請參閱 <command>fcoeadm(8)</command> man 頁面。</para>
   </listitem>
   <listitem>
    <para>如需資料中心橋接組態工具的相關資訊，請參閱 <command>dcbtool(8)</command> man 頁面。</para>
   </listitem>
   <listitem>
    <para>如需「連結層探查協定」代理程式精靈的相關資訊，請參閱 <filename>lldpad(8)</filename> man 頁面。</para>
   </listitem>
   <listitem>
    <para><ulink url="http://www.open-fcoe.org/open-fcoe/wiki/quickstart"><citetitle>開放式乙太網路光纖通道快速入門</citetitle></ulink>。</para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>

<chapter id="snapshots" lang="zh-tw" xml:base="07_snapshots.xml">
 <title>LVM 磁碟區快照</title>
 <para>邏輯磁碟區管理員 (LVM) 邏輯磁碟區快照是一種寫入時複製技術，它會監控現有磁碟區資料區塊的變更，以便在對其中一個區塊執行寫入操作時，將建立快照時區塊的值複製到快照磁碟區。使用這種方式便會保留一份時間點資料，直到快照磁碟區被刪除。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="bi7xb8b" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="biu259x" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bi7uzm8" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="snapshot-xen-host" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="lvconvert-merge" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="bi7xb8b">
  <title>瞭解磁碟區快照</title>
  <para>檔案系統快照包含在建立快照後已變更之來源邏輯磁碟區的相關中繼資料及資料區塊。透過快照存取資料時，您會看到來源邏輯磁碟區的時間點副本。您無需從備份媒體還原資料，或是覆寫已變更的資料。 </para>
  <important>
   <para>在快照的存留期間，必須先掛接快照，然後才能掛接其來源邏輯磁碟區。</para>
  </important>
  <para>LVM 磁碟區快照可用於從檔案系統的時間點檢視建立備份。您可以實時建立快照，建立後它會一直保留，直到您將它刪除。您可以從快照備份檔案系統，而磁碟區本身仍可繼續供使用者使用。快照最初包含自身相關的一些中繼資料，但不包含來源邏輯磁碟區的實際資料。快照會使用寫入時複製技術偵測原始資料區塊中發生的資料變更。當在快照磁碟區中拍攝某個區塊的快照時，它會複製所包含的值，然後允許在來源區塊中儲存新的資料。隨著來源邏輯磁碟區上有更多區塊變更其原始值，快照大小會不斷增大。 </para>
  <para>調整快照大小時，請考慮來源邏輯磁碟區中將會變更的資料量，以及要保留快照的時間。根據來源邏輯磁碟區大小、您打算保留快照的時間，以及在快照存留期間預期要變更的資料區塊數，您為快照磁碟區配置的空間容量可能會有所不同。快照磁碟區一經建立，就無法調整大小。建議在建立快照磁碟區時，將其大小設定成約為原始邏輯磁碟區的 10%。如果您預測在刪除快照前，來源邏輯磁碟區中的每個區塊都至少會變更一次，則快照磁碟區大小至少應不小於來源邏輯磁碟區的容量加上儲存快照磁碟區相關中繼資料所需的一些額外空間。如果資料變更並不頻繁，或者預計的存留期足夠簡短，所需的空間就會減少。</para>
  <para>在 LVM2 中，快照預設為讀/寫模式。當您直接將資料寫入快照時，該區塊在例外表格中會標記為已使用，因此不會從來源邏輯磁碟區中複製。您可以掛接快照磁碟區，並透過直接將資料寫入快照磁碟區的方式來測試應用程式的變更。您可以透過卸下快照，移除快照，然後重新掛接來源邏輯磁碟區，輕鬆丟棄變更。 </para>
  <para>在虛擬客體環境中，您可以如同在實體伺服器上一般，對在伺服器磁碟上建立的 LVM 邏輯磁碟區使用快照功能。</para>
  <para>在虛擬主機環境中，您可以使用快照功能來備份虛擬機器的儲存後端，或測試對虛擬機器影像進行的變更 (例如針對修補程式或升級進行的變更)，而不必修改來源邏輯磁碟區。虛擬機器必須使用 LVM 邏輯磁碟區做為其儲存後端，而不應使用虛擬磁碟檔案。您可以掛接 LVM 邏輯磁碟區，並將它用做檔案型磁碟來儲存虛擬機器影像，您也可以指定 LVM 邏輯磁碟區做為實體磁碟，將它做為區塊裝置向其中寫入資料。</para>
  <para>從 SLES 11 SP3 開始，可以簡易佈建 LVM 邏輯磁碟區快照。如果您建立沒有指定大小的快照，系統就會使用簡易佈建。建立為簡易磁碟區的快照會視需要使用簡易池中的空間。簡易快照磁碟區的特性與任何其他簡易磁碟區相同。您可以獨立啟動磁碟區、擴充磁碟區、重新命名磁碟區、移除磁碟區，甚至可以建立磁碟區的快照。</para>
  <important>
   <para>若要在叢集中使用簡易佈建的快照，來源邏輯磁碟區及其快照必須在單個叢集資源中管理。如此，該磁碟區及其快照便可永遠獨佔地掛接在同一個節點上。</para>
  </important>
  <para>對快照的操作完成後，請務必將其從系統中移除。隨著來源邏輯磁碟區上資料區塊的不斷變更，快照終將完全填滿。快照填滿時就會處於停用狀態，導致您無法重新裝載來源邏輯磁碟區。</para>
  <para>如果您為一個來源邏輯磁碟區建立了多個快照，在移除這些快照時，請採用最後建立的最先刪除的順序。</para>
 </sect1>
 <sect1 id="bi7uttc">
  <title>使用 LVM 建立 Linux 快照</title>
  <para>邏輯磁碟區管理員 (LVM) 可用於建立檔案系統的快照。 </para>
  <procedure id="bi7wb4p">
   <step id="bi7wb4q" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者身分登入，然後輸入</para>

<screen>
lvcreate -s [-L <replaceable>&lt;size</replaceable>&gt;] -n <replaceable>snap_volume</replaceable> <replaceable>source_volume_path</replaceable>
</screen>

    <para>如果不指定大小，快照會建立為簡易快照。</para>
    <para>例如：</para>

<screen>
lvcreate -s -L 1G -n linux01-snap /dev/lvm/linux01
</screen>

    <para>則快照建立為 <filename>/dev/lvm/linux01-snap</filename> 磁碟區。</para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="biu259x">
  <title>監控快照</title>
  <procedure id="biu25qe">
   <step id="biu25qf" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者身分登入，然後輸入</para>

<screen>
lvdisplay <replaceable>snap_volume</replaceable>
</screen>

    <para>例如：</para>

<screen>
lvdisplay /dev/vg01/linux01-snap

--- Logical volume ---
  LV Name                /dev/lvm/linux01
  VG Name                vg01
  LV UUID                QHVJYh-PR3s-A4SG-s4Aa-MyWN-Ra7a-HL47KL
  LV Write Access        read/write
  LV snapshot status     active destination for /dev/lvm/linux01
  LV Status              available
  # open                 0
  LV Size                80.00 GB
  Current LE             1024
  COW-table size         8.00 GB
  COW-table LE           512
  Allocated to snapshot  30%
  Snapshot chunk size    8.00 KB
  Segments               1
  Allocation             inherit
  Read ahead sectors     0
  Block device           254:5
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="bi7uzm8">
  <title>刪除 Linux 快照</title>
  <procedure id="bi7x85s">
   <step id="bi7x85t" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者身分登入，然後輸入</para>

<screen>
lvremove <replaceable>snap_volume_path</replaceable>
</screen>

    <para>例如：</para>

<screen>
lvremove /dev/lvmvg/linux01-snap
</screen>

   </step>
  </procedure>
 </sect1>
 <sect1 id="snapshot-xen-host">
  <title>在虛擬主機上使用虛擬機器的快照</title>
  <para>使用 LVM 邏輯磁碟區做為虛擬機器的後端儲存，可為基礎裝置管理提供彈性，例如，可讓您更輕鬆地移動儲存物件、建立快照和備份資料。您可以掛接 LVM 邏輯磁碟區，並將它用做檔案型磁碟來儲存虛擬機器影像，您也可以指定 LVM 邏輯磁碟區做為實體磁碟，將它做為區塊裝置向其中寫入資料。您可以在 LVM 邏輯磁碟區上建立虛擬磁碟影像，然後建立 LVM 的快照。 </para>
  <para>您可以利用快照的讀/寫功能為虛擬機器建立多個不同例項，以使變更針對特定虛擬機器例項的快照進行。您可以在 LVM 邏輯磁碟區上建立虛擬磁碟影像、建立來源邏輯磁碟區的快照，以及修改特定虛擬機器例項的快照。您可以建立來源邏輯磁碟區的另一個快照，並為另一個不同的虛擬機器例項修改該快照。各虛擬機器例項的大部分資料與影像一起儲存在來源邏輯磁碟區上。</para>
  <para>在客體環境中，您還可以利用快照的讀/寫功能保留虛擬磁碟影像，同時測試修補程式或升級。您需要為包含影像的 LVM 磁碟區建立一個快照，然後在快照位置執行虛擬機器。來源邏輯磁碟區將保持不變，對機器的所有變更均會寫入快照。為了恢復到虛擬機器影像的來源邏輯磁碟區，您需要關閉虛擬機器，然後從來源邏輯磁碟區中移除快照。為了重新開始，您需要重新建立快照，掛接該快照，然後在快照影像上重新啟動虛擬機器。 </para>
  <important>
   <para>以下程序將使用檔案型虛擬磁碟影像和 Xen 監管程式。對於在 SUSE Linux 平台上執行的其他監管程式 (例如 KVM)，您可以調整本節中的程序。</para>
  </important>
  <para>若要從快照磁碟區中執行檔案型虛擬機器影像︰</para>
  <procedure id="b17cn63v">
   <step id="b17cnkv7" performance="required">
    <para>確保包含檔案型虛擬機器影像的來源邏輯磁碟區已掛接，例如在掛接點 <filename>/var/lib/xen/images/&lt;<replaceable>影像名稱</replaceable>&gt;</filename> 處掛接。 </para>
   </step>
   <step id="b17cn63w" performance="required">
    <para>為具有足夠空間來儲存預期差異的 LVM 邏輯磁碟區建立快照。 </para>

<screen>
lvcreate -s -L 20G -n myvm-snap /dev/lvmvg/myvm
</screen>

    <para>如果不指定大小，快照會建立為簡易快照。</para>
   </step>
   <step id="b17cn8re" performance="required">
    <para>建立一個用來掛接快照磁碟區的掛接點。</para>

<screen>
mkdir -p /mnt/xen/vm/myvm-snap
</screen>

   </step>
   <step id="b17cn8rf" performance="required">
    <para role="intro">在您建立的掛接點掛接快照磁碟區。</para>

<screen>
mount -t auto /dev/lvmvg/myvm-snap /mnt/xen/vm/myvm-snap
</screen>

   </step>
   <step id="b17cnd0k" performance="required">
    <para>在文字編輯器中，複製來源虛擬機器的組態檔案，修改指向所掛接快照磁碟區上的檔案型影像檔案的路徑，然後儲存檔案，例如 <filename>/etc/xen/myvm-snap.cfg</filename>。</para>
   </step>
   <step id="b17cnd0l" performance="required">
    <para>使用虛擬機器的掛接快照磁碟區啟動虛擬機器。</para>

<screen>
xm create -c /etc/xen/myvm-snap.cfg
</screen>

   </step>
   <step id="b17cnd0m" performance="required">
    <para>(選擇性) 移除快照，然後在來源邏輯磁碟區上使用未變更的虛擬機器影像。</para>

<screen>
unmount /mnt/xenvms/myvm-snap
lvremove -f /dev/lvmvg/mylvm-snap
</screen>

   </step>
   <step id="b17cnd0n" performance="required">
    <para>(選擇性) 根據需要重複此程序。 </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="lvconvert-merge">
  <title>將快照與來源邏輯磁碟區合併以回復變更或復原至先前的狀態</title>
  <para>如果您需要將磁碟區上的資料復原或還原至先前的狀態，快照可能非常有用。例如，您可能需要回復由於管理員錯誤或是失敗或不需要的套件安裝或升級所導致的資料變更。 </para>
  <para>您可以使用 <command>lvconvert --merge</command> 指令回復對 LVM 邏輯磁碟區進行的變更。合併程序會按如下所述的方式開始︰</para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>如果來源邏輯磁碟區和快照磁碟區均未開啟，合併將立即開始。 </para>
   </listitem>
   <listitem>
    <para>如果來源邏輯磁碟區或快照磁碟區已開啟，合併會在來源邏輯磁碟區或快照磁碟區已啟動且都關閉的情況第一次發生時開始。 </para>
   </listitem>
   <listitem>
    <para>如果來源邏輯磁碟區不能關閉 (例如<systemitem>根</systemitem>檔案系統)，合併將延遲到下次伺服器重新開機且來源邏輯磁碟區處於啟動狀態時開始。 </para>
   </listitem>
   <listitem>
    <para>如果來源邏輯磁碟區包含虛擬機器影像，您必須關閉虛擬機器，取消啟動來源邏輯磁碟區和快照磁碟區 (透過依該順序將其卸下)，然後再發出合併指令。因為來源邏輯磁碟區會自動重新掛接，並且合併完成時會刪除快照磁碟區，因此，在合併完成之前，您不應重新啟動虛擬機器。在合併完成之後，您便可將產生的邏輯磁碟區用於虛擬機器。</para>
   </listitem>
  </itemizedlist>
  <para>合併開始後，該程序將在伺服器重新啟動之後繼續進行，直到完成為止。當正在進行合併時，您不能為來源邏輯磁碟區建立新快照。 </para>
  <para>當正在進行合併時，針對來源邏輯磁碟區的讀取或寫入操作會透明地重新導向至正在合併的快照。這使得使用者能夠立即檢視和存取資料，就如建立快照時一樣。他們不需要等到合併完成。 </para>
  <para>合併完成時，來源邏輯磁碟區包含的資料為快照建立時的資料加上合併開始後的任何資料變更。產生的邏輯磁碟區具有來源邏輯磁碟區的名稱、次要編號和 UUID。來源邏輯磁碟區會自動重新掛接，並且會移除快照磁碟區。</para>
  <procedure id="b15cjobl">
   <step id="b15cjobm" performance="required">
    <para>開啟終端機主控台，以 <systemitem>root</systemitem> 使用者身分登入，然後輸入</para>

<screen role="compact2">
lvconvert --merge  [-b] [-i &lt;<replaceable>seconds</replaceable>&gt;] [&lt;<replaceable>snap_volume_path</replaceable>&gt;[...&lt;snapN&gt;]|@&lt;<replaceable>volume_tag</replaceable>&gt;]
</screen>

    <para>您可以在指令行上指定一或多個快照。您也可以使用相同磁碟區標記來標記多個來源邏輯磁碟區，然後在指令行上指定 <literal>@&lt;<replaceable>磁碟區標記</replaceable>&gt;</literal>。已標記磁碟區的快照會合併到它們各自的來源邏輯磁碟區中。如需標記邏輯磁碟區的的資訊，請參閱<xref linkend="lvmtagging" xrefstyle="SectTitleOnPage"/>。</para>
    <para>選項包括︰</para>
    <variablelist>
     <varlistentry id="b15ck6lb">
      <term>-b</term>
      <term>--background</term>
      <listitem>
       <para>在背景中執行精靈。這允許以平行方式同時合併多個指定的快照。</para>
      </listitem>
     </varlistentry>
     <varlistentry id="b15ck6lc">
      <term>-i</term>
      <term>--interval &lt;<replaceable>秒</replaceable>&gt;</term>
      <listitem>
       <para>按固定間隔以百分比形式報告進度。請以秒為單位指定間隔。</para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>如需此指令的詳細資訊，請參閱 <command>lvconvert(8)</command> man 頁面。</para>
    <para>例如：</para>

<screen>
lvconvert --merge /dev/lvmvg/linux01-snap
</screen>

    <para>此指令會將 <filename>/dev/lvmvg/linux01-snap</filename> 合併到其來源邏輯磁碟區中。 </para>

<screen>
lvconvert --merge @mytag
</screen>

    <para>如果 <filename>lvol1</filename>，<filename>lvol2</filename> 和 <filename>lvol3</filename> 全都標記了 <literal>mytag</literal>，每個快照磁碟區將按順序與其各自的來源邏輯磁碟區合併；即先合併 <filename>lvol1</filename>，然後是 <filename>lvol2</filename>，最後是 <filename>lvol3</filename>。如果指定了 <literal>--background</literal> 選項，各個已標記邏輯磁碟區的快照將以平行方式同時合併。 </para>
   </step>
   <step id="b15clkwi" performance="required">
    <para>(選擇性) 如果來源邏輯磁碟區和快照磁碟區均已開啟並且兩者都可以關閉，您可以手動取消啟動來源邏輯磁碟區，然後再將其啟動，讓合併立即開始。</para>

<screen>
umount &lt;<replaceable>original_volume</replaceable>&gt;
lvchange -an &lt;<replaceable>original_volume</replaceable>&gt;
lvchange -ay &lt;<replaceable>original_volume</replaceable>&gt;
mount &lt;<replaceable>original_volume</replaceable>&gt; &lt;<replaceable>mount_point</replaceable>&gt;
</screen>

    <para>例如：</para>

<screen>
umount /dev/lvmvg/lvol01
lvchange -an /dev/lvmvg/lvol01
lvchange -ay /dev/lvmvg/lvol01
mount /dev/lvmvg/lvol01 /mnt/lvol01
</screen>

   </step>
   <step id="b15clm73" performance="required">
    <para>(選擇性) 如果來源邏輯磁碟區和快照磁碟區均已開啟，但來源邏輯磁碟區不能關閉 (例如<systemitem>根</systemitem>檔案系統)，您可以重新啟動伺服器並掛接來源邏輯磁碟區，讓合併在重新啟動之後立即開始。</para>
   </step>
  </procedure>
 </sect1>
</chapter>

<chapter id="nfsv4acls" lang="zh-tw" xml:base="08a_nfsv4_acls.xml">
 <title>透過 NFSv4 管理存取控制清單</title>
 <para>在 Linux 中，除了簡單的使用者-群組-其他人的讀取、寫入、執行 (<literal>rwx</literal>) 旗標之外，各存取控制清單 (ACL) 沒有統一的標準。控制能力相對較好的一個選擇是 POSIX 從未正式標準化的<citetitle>《Draft POSIX ACLs》(POSIX ACL 草稿)</citetitle>。另一個選擇是 NFSv4 ACL，它們設計為 NFSv4 網路檔案系統的一部分，目的是為 Linux 上的 POSIX 系統與 Microsoft Windows 上的 WIN32 系統之間提供合理的相容性。</para>
 <para>NFSv4 ACL 不能完全正確實作 Draft POSIX ACL，因此未在 NFSv4 用戶端上映射 ACL 存取權 (例如使用 <command>setfacl</command>)。</para>
 <para>使用 NFSv4 時，無法使用 Draft POSIX ACL (即使是在模擬環境中)，必須直接使用 NFSv4 ACL；換言之，雖然 <command>setfacl</command> 可以在 NFSv3 上運作，但不能在 NFSv4 上運作。為了能夠在 NFSv4 檔案系統上使用 NFSv4 ACL，SUSE Linux Enterprise Server 提供了 <filename>nfs4-acl-tools</filename> 套件，套件中包含下列各項：</para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para><filename>nfs4-getfacl</filename></para>
  </listitem>
  <listitem>
   <para><filename>nfs4-setfacl</filename></para>
  </listitem>
  <listitem>
   <para><filename>nfs4-editacl</filename></para>
  </listitem>
 </itemizedlist>
 <para>這些程式以與 <command>getfacl</command> 及 <command>setfacl</command> 相似的方式運作，來檢查和修改 NFSv4 ACL。僅當 NFS 伺服器上的檔案系統提供 NFSv4 ACL 的完全支援時，這些指令才有效。雖然某些存取控制項目 (ACE) 的特定組合可能在用戶端中不可用，但用戶端上執行的程式都將受到伺服器所實作之任何限制的影響。</para>
 <para>不支援在輸出 NFS 伺服器本地掛接 NFS 磁碟區。</para>
 <bridgehead id="bxut1i2">其他資訊</bridgehead>
 <para>如需相關資訊，請參閱 <ulink url="http://wiki.linux-nfs.org/wiki/index.php/ACLs#Introduction_to_NFSv4_ACLs">Linux-nfs.org 網站上的 <quote>NFSv4 ACL 簡介</quote></ulink>。</para>
</chapter>

<chapter id="trbl" lang="zh-tw" xml:base="08_troubleshooting.xml">
 <title>儲存問題疑難排解</title>
 <para>本章描述如何解決裝置、軟體 RAID、多重路徑 I/O 及磁碟區的已知問題。</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="trblmpioboot" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="trbl-btrfs-volfull" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpklm" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjpgil" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bpjphka" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="ts-iscsi-lio" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="trblmpioboot">
  <title>開機分割區可以使用 DM-MPIO 嗎？</title>
  <para>自 SUSE Linux Enterprise Server 10 SP1 起，即提供了對開機分割區的裝置對應程式多重路徑 I/O (DM-MPIO) 支援。如需更多資訊，請參閱<xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="trbl-btrfs-volfull">
  <title>Btrfs 錯誤︰裝置上已無空間 </title>
  <para>使用 Btrfs 檔案系統的根 (<filename>/</filename>) 分割區停止接受資料。您收到錯誤<quote><literal>裝置上已無空間</literal></quote>。</para>
  <para>請參閱下列各節，瞭解有關此問題的可能原因和預防措施的資訊。 </para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b15tk0m4" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15tk0m7" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b15tk0m4">
   <title>Snapper 快照使用的磁碟空間</title>
   <para>如果 Snapper 是針對 Btrfs 檔案系統執行的，則<quote><literal>裝置上已無空間</literal></quote>問題通常是由於系統上做為快照儲存的資料過多所致。</para>
   <para>您可以從 Snapper 中移除一些快照，不過，快照不會立即刪除，可能不能釋放您需要的空間容量。 </para>
   <para>若要從 Snapper 中刪除檔案︰</para>
   <procedure id="b15q34ft">
    <step id="b15tk0m5" performance="required">
     <para>以 <systemitem>root</systemitem> 使用者身分登入，然後開啟終端機主控台。</para>
    </step>
    <step id="b15tk9ch" performance="required">
     <para>收回足以供系統啟動的空間。</para>
     <substeps performance="required">
      <step id="b15tk0m6" performance="required">
       <para>在指令提示符下，輸入</para>

<screen>
btrfs filesystem show
</screen>


<screen>
Label: none uuid: 40123456-cb2c-4678-8b3d-d014d1c78c78
 Total devices 1 FS bytes used 20.00GB
 devid 1 size 20.00GB used 20.00GB path /dev/sda3
</screen>

      </step>
      <step id="b15q34fu" performance="required">
       <para>輸入</para>

<screen>
btrfs fi balance start &lt;<replaceable>/mountpoint</replaceable>&gt; -dusage=5
</screen>

       <para>此指令會嘗試將資料重新放置在空的或接近空的資料區塊中，從而允許收回空間並將空間重新指定給中繼資料。此操作可能需要一些時間 (1 TB 資料可能需要很多小時)，不過，在此期間系統仍可以使用。 </para>
      </step>
     </substeps>
    </step>
    <step id="b15q34fv" performance="required">
     <para>列出 Snapper 中的快照。輸入</para>

<screen>
snapper -c root list
</screen>

    </step>
    <step id="b15q34fw" performance="required">
     <para role="intro">從 Snapper 中刪除一或多個快照。輸入</para>

<screen>
snapper -c root delete #
</screen>

     <para>務必先刪除最舊的快照。快照越舊，它佔用的磁碟空間就越多。 </para>
    </step>
   </procedure>
   <para>為了防止此問題，您可以在 <filename>/etc/snapper/configs/root</filename> 組態檔案中或針對其他掛接點將 Snapper 清理預設值變更為更積極的值。Snapper 提供了三種用於清理舊快照的演算法。每日 cron 工作中會執行這些演算法。清理頻率在掛接點的 Snapper 組態中定義。請將每日、每月和每年的 TIMELINE_LIMIT 參數值設定得較低，以縮短快照的保留時間並減少其數量。如需相關資訊，請參閱<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/book_sle_admin.html"><citetitle>《SUSE Linux Enterprise Server 11 SP3 管理指南》</citetitle></ulink>中的<ulink url="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_snapper_config.html#sec_snapper_config_modify"><quote>調整組態檔案</quote></ulink>。</para>
   <para>如果在檔案系統磁碟上將 Snapper 與 Btrfs 結合使用，建議您保留兩倍於標準儲存建議的磁碟空間容量。YaST 磁碟分割程式會自動在 Btrfs 儲存建議中為根檔案系統建議標準磁碟空間的兩倍容量。</para>
  </sect2>
  <sect2 id="b15tk0m7">
   <title>記錄、當機和快取檔案使用的磁碟空間 </title>
   <para>如果系統磁碟填滿了資料，您可以嘗試從 <filename>/var/log</filename>、<filename>/var/crash</filename> 和 <filename>/var/cache</filename> 中刪除檔案。</para>
   <para>Btrfs <systemitem>根</systemitem>檔案系統子磁碟區 <filename>/var/log</filename>、<filename>/var/crash</filename> 和 <filename>/var/cache</filename> 可在執行一般操作過程中使用所有可用的磁碟空間，但會導致系統功能出現問題。為避免出現此狀況，SUSE Linux Enterprise 11 SP3 提供了 Btrfs 子磁碟區配額支援。如需詳細資料，請參閱 <filename>btrfs(8)</filename> 手冊頁。</para>
  </sect2>
 </sect1>
 <sect1 id="bpjpklm">
  <title>多重路徑 I/O 的問題</title>
  <para>請參閱<xref linkend="bpjpirk" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="bpjpgil">
  <title>軟體 RAID 的問題</title>
  <para>請參閱<xref linkend="bgchysg" xrefstyle="AppTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="bpjphka">
  <title>iSCSI 的問題</title>
  <para>請參閱<xref linkend="sec-inst-system-iscsi-ts" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
 <sect1 id="ts-iscsi-lio">
  <title>iSCSI LIO 目標的問題</title>
  <para>請參閱<xref linkend="b13g8i2g" xrefstyle="SectTitleOnPage"/>。</para>
 </sect1>
</chapter>

<appendix conformance="sles11,Novell,no,0,80" id="common-legal" revision="01/01/03" xml:base="appendix_common_legal.xml">
 <title>GNU 授權</title>
 <para>本附錄包含 GNU General Public License Version 2 (GNU 通用公共授權第 2 版) 和 GNU Free Documentation License Version 1.2 (GNU 自由文件授權 1.2 版)。 </para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="common-gplv2-i" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="gfdl-i" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="common-gplv2-i" role="legal" xml:base="common_gplv2_i.xml">
  <title>GNU 通用公共授權 (General Public License)</title>
  <para>版本 2，1991 年 6 月 </para>
  <para>Copyright (C) 1989, 1991 Free Software Foundation, Inc. 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA </para>
  <para>每個人皆可複製和散佈本授權文件的完整重製物，但不得變更其內容。 </para>
  <sect2 id="gplv2-preamble">
   <title>前言</title>
   <para>大多數軟體授權的設計是剝奪您分享與修改軟體的自由。相反地，GNU 通用公共授權的目的是保證您可以自由分享和變更自由軟體，以確保所有使用者都可以自由使用自由軟體。本通用公共授權 (General Public License) 適用於大部份自由軟體基金會的軟體以及程式作者承諾使用本授權的任何其他程式(部份其他自由軟體基金會軟體則受 GNU 程式庫通用公共授權 (General Public License) 的規定)。您也可以讓您的程式適用本授權規定。 </para>
   <para>當我們提到自由軟體時，我們指的是自由，不是價格。我們的「通用公共授權」是要確定您可以自由散佈自由軟體的副本 (如果您希望，也可以對本服務收費)，確保您能收到源代碼或者在您需要時便能得到它，確保您能變更軟體或將它的一部分用於新的自由程式；並且確保您知道您可以從事上述的事情。 </para>
   <para>為了保護您的權利，我們必須訂定一些規範，禁止任何人否認您擁有這些權利，或者要求您放棄權利。如果您散佈軟體的副本或者您修改它，這些限制會轉化為您的特定責任。 </para>
   <para>例如，如果您散佈這樣的程式副本，無論免費或收費，必須將您所享有的一切權利交付收受者。您必須確定他們也會收到或者可以取得源代碼。而且您必須讓他們知道以上條款，讓他們知道該有的權利。 </para>
   <para>我們用兩個步驟保護您的權限：(1) 保留軟體的著作權，以及 (2) 為您提供賦予您複製、散佈和/或修改該軟體之合法權利的授權。 </para>
   <para>同時，為了保護作者與我們 (自由軟體基金會)，我們希望確定每個人都明瞭，自由軟體是沒有擔保責任的。如果軟體被他人修改並加以傳遞，我們需要其收受者知道，他們所得到的並非原軟體，因此由他人所引起的任何問題對原作者的聲譽將不會有任何的影響。 </para>
   <para>最後，任何自由軟體經常遭受到軟體專利權的威脅。我們希望能避免自由軟體的再散佈者，以個人名義取得專利授權而使程式專有化的風險。為防止此狀況，我們已經明確表示任何專利權必須授權給每一個人自由使用的權利，不然就不符合本授權規定。 </para>
   <para>複製、散佈和修改的明確條款和條件如下： </para>
  </sect2><?dbfo-need height="20em"?>


  <sect2 id="gplv2-terms">
   <title>GNU 通用公共授權的複製、散佈和修改的條款和條件</title>
   <formalpara id="bw4vaov">
    <title>0.</title>
    <para>凡著作權人在其程式或其他著作中聲明，該程式或著作得以通用公共授權 (General Public License) 條款散佈，本授權對其均適用。下面的<quote>程式</quote>係指任何此類程式或作品，<quote>基於程式的作品</quote>指本程式或受著作權法保護的任何衍生作品：即包含本程式或其中一部分 (原封不動或經過修改和/或翻譯成另一種語言) 的作品。（以下<quote>修改</quote>一詞包括但不限於翻譯行為在內）。被授權人則稱為<quote>您</quote>。 </para>
   </formalpara>
   <para>複製、散佈和修改之外的其他活動，不適用本「授權」；這些活動超出其範圍。而本「程式」的輸出只有在其內容構成基於本「程式」所生的著作（而非只是因為執行本「程式」所造成）時，始受本授權拘束。至於程式的輸出內容是否構成本「程式」的衍生著作，則取決於「程式」的實際用途。 </para>
   <formalpara id="bw4vaow">
    <title>1.</title>
    <para>您可以對所收受的本「程式」原始程式碼，無論以何種媒介，複製與散佈其完整的重製物，然而您必須符合以下要件：以顯著及適當的方式在每一份重製物上發佈適當的著作權標示及無擔保聲明；維持所有有關本授權以及無擔保聲明的原貌；並將本授權的副本連同本「程式」一併交付予其他任一位本「程式」的收受者。 </para>
   </formalpara>
   <para>您可以針對傳送副本的實體行為收取費用，而且您可以自行決定是否提供擔保來交換費用。 </para>
   <formalpara id="bw4vaox">
    <title>2.</title>
    <para>若符合以下條件，您就可以對「程式」的副本或者它的任何一個部分進行修改，從基於本「程式」所生的著作品，並且按照「條款 1」複製和散佈此類修改或著作。 </para>
   </formalpara>
   <formalpara id="bw4vaoy">
    <title>a)</title>
    <para>您必須在所修改的檔案上附加顯著的標示，說明您修改過這些檔案，以及修改日期。 </para>
   </formalpara>
   <formalpara id="bw4vaoz">
    <title>b)</title>
    <para>您必須就您所散佈或發行的著作，無論是包含「本程式」全部或部分的著作，或者是自「本程式」或其任何部份所衍生的著作，整體授權所有第三人依本授權規定使用，且不得因此項授權行為而收取任何費用。 </para>
   </formalpara>
   <formalpara id="bw4vap0">
    <title>c)</title>
    <para>若經過修改的程式在執行時通常以互動方式讀取命令時，您必須在最常被使用的方式下，於開始進入這種互動式使用時，列印或展示以下宣告：適當的著作權標示及無擔保聲明（或者聲明您提供擔保）、使用者可以依這些條件再散佈此程式，以及告知使用者如何瀏覽本授權的複本。(例外：若程式本身是互動式的，但是通常不列印此類聲明，則基於程式的作品不需要列印聲明。) </para>
   </formalpara>
   <para>整體而言，修改過的著作適用於這些要求。如果著作中可識別的一部份並非衍生自「本程式」，並且可以合理地認為是獨立的、個別的著作，則當您將其作為個別著作散佈時，本授權及其條款將不適用於該部分。然而當您將上述部分，作為基於「本程式」所生著作的一部份而散佈時，整個著作的散佈必須符合本授權條款的規定，而本授權對於其他被授權人所為的許可適用於著作整體。 </para>
   <para>因此，本條規定的意圖不在於主張或剝奪您對於完全由您所完成著作的權利；應該說，本條規定意在行使對基於程式所生的之衍生著作或集合著作散佈行為的控制權。 </para>
   <para>此外，非基於本「程式」所生的其他著作與本程式（或基於本程式所生的著作）在同一儲存或散佈的媒介上的單純聚集行為，並不會使該著作因此受本授權條款拘束。 </para>
   <formalpara id="bw4vap1">
    <title>3.</title>
    <para>您可依前述第一、二條規定，複製與散佈本程式（或第二條所述基於「本程式」所產生的著作）的目的碼或可執行形式，但您必須符合以下要件： </para>
   </formalpara>
   <formalpara id="bw4vap2">
    <title>a)</title>
    <para>附上完整、相對應的機器可判讀原始程式碼，而這些原始程式碼必須依前述第一、二條規定，在經常用以做為軟體交換的媒介物上散佈；或 </para>
   </formalpara>
   <formalpara id="bw4vap3">
    <title>b)</title>
    <para>附上至少三年有效的書面報價文件，提供任何第三人在支付不超過實際散佈原始程式碼所需成本的費用下，取得相同原始程式碼的完整機器可讀重製物，並依前述第一、二條規定在經常用以作為軟體交換的媒介物上散佈該重製物；或 </para>
   </formalpara>
   <formalpara id="bw4vap4">
    <title>c)</title>
    <para>附上您所收受有關散佈相同原始程式碼的報價資訊。（本項選擇僅在非營利散佈、且僅在您依前述 b 項方式自該書面報價文件收受程式物件程式碼或執行檔時，才適用。） </para>
   </formalpara>
   <para>著作的原始程式碼，是指對著作進行修改時適用的形式。對於一個可執行的著作而言，完整的原始程式碼是指著作中所包含所有模組的全部原始程式碼，加上相關介面的定義檔，還加上用以控制該著作編繹與安裝的描述。然而，特別的例外情況是，所散佈的原始程式碼並不需包含任何通常會隨著所執行作業系統的主要組成部分（編譯器、核心等等）而散佈的軟體（無論以原始程式碼或二進位格式），除非該部分本身即附加在執行檔。 </para>
   <para>若可執行檔或目標程式碼的散佈方式，是以指定的地點提供存取位置供人複製，則提供可自相同地點複製原始程式碼的使用機會，視同對於原始程式的散佈，然而第三人並不因此而負有將目標程式碼連同原始程式碼一併複製的義務。 </para>
   <formalpara id="bw4vap5">
    <title>4.</title>
    <para>除本「授權」明示的方式外，您不得對本程式加以複製、修改、再授權或散佈。任何試圖以其他方式進行複製、修改、再授權或者散佈本「程式」的行為均為無效，並且將自動終止您基於本授權所得享有的權利。然而，依本授權規定自您手中收受重製物或權利之人，只要遵守本授權規定，他們所獲得的授權並不會因此終止。 </para>
   </formalpara>
   <formalpara id="bw4vap6">
    <title>5.</title>
    <para>因為您並未在本授權上簽名，所以您無需接受本授權。然而，除此之外您別無其他修改或散佈本程式或其衍生著作的授權許可。若您不接受本「授權」，則這些行為在法律上都是被禁止的。因此，藉由對本程式（或任何基於本「程式」所衍生的著作）的修改或散佈行為，表示您接受本授權，以及接受所有關於複製、散佈或修改本「程式」或基於本「程式」所衍生著作的條款與條件。 </para>
   </formalpara>
   <formalpara id="bw4vap7">
    <title>6.</title>
    <para>當您再散佈本「程式」（或任何基於本「程式」所衍生的著作）時，收受者即自動獲得原授權人所授予依本授權條款與條件複製、散佈或修改本「程式」的權利。您不得就本授權所賦予收受者行使的權利附加任何進一步的限制。您對於第三人是否履行本「授權」一事，無須負責。 </para>
   </formalpara>
   <formalpara id="bw4vap8">
    <title>7.</title>
    <para>若法院判決、專利侵權主張或者其他任何理由（不限於專利爭議）的結果，使得加諸於您的條件（無論是由法院命令、協議或其他方式造成）與本授權規定有所衝突，他們不能將您排除在本「授權」的規範之外。若您無法同時符合依本「授權」所生義務及其他相關義務而進行散佈，那麼其結果便是您不得散佈該「程式」。例如，若專利授權不允許直接或間接透過您而取得重製物之人，以免付權利金的方式再散佈該「程式」時，您唯一能同時滿足該義務及本「授權」的方式就是徹底避免進行該「程式」的散佈。 </para>
   </formalpara>
   <para>若本條任一部份在特殊情況下被認定無效或無法執行時，本條其餘部分仍應適用，且本條全部於其他情況下仍應適用。 </para>
   <para>本條的目的並不在誘使您侵害專利或其他財產權的權利主張，或就此類主張的有效性加以爭執；本條的唯一目的，是在保障藉由公共授權慣例所執行自由軟體散佈系統的完整性。許多人信賴該系統一貫使用的應用程式，而對經由此系統散佈的大量軟體有相當多的貢獻；作者/貢獻者有權決定他或她是否希望經由其他的系統散佈軟體，而被授權人則無該種選擇權。 </para>
   <para>本條的用意在於將本「授權」其他不確定的部分徹底解釋清楚。 </para>
   <formalpara id="bw4vap9">
    <title>8.</title>
    <para>若因為專利或享有著作權保護的介面問題，而使得本「程式」的散佈和/或使用侷限於某些國家時，則將本程式置於本「授權」規範之下的原著作權人得增列明確的散佈地區限制條款，將該等國家排除在外，而使散佈的許可只限在未受排除的國家之內或之中。在該等情況下，該限制條款如同以書面方式訂定於本授權內容中，而成為本「授權」的條款。 </para>
   </formalpara>
   <formalpara id="bw4vapa">
    <title>9.</title>
    <para>自由軟體基金會可以隨時公佈修訂和/或新的通用公共授權 (General Public License) 版本。類似的新版本，其精神和目前的版本類似，但解決新問題或事情的細節則不同。 </para>
   </formalpara>
   <para>每一個版本會提供截然不同的版本編號。如果「程式」指定本「授權」套用的版本編號以及<quote>任何新的版本</quote>，您可以使用自由軟體基金會公佈的該版本以及任何新版本的以下條款和條件。如果「程式」未指定本「許可證」的版本編號，您可以選擇自由軟體基金會公佈的任何版本。 </para>
   <formalpara id="bw4vapb">
    <title>10.</title>
    <para>如果您希望將「程式」的某些部份合併至散佈條件不同的其他自由軟體，請洽詢作者，索取許可權。至於受自由軟體基金會版權保護的軟體，請洽詢自由軟體基金會；我們有時候會對此做出例外。我們的決定會由兩個目標引導，便是保留我們自由軟體，所有衍生著作的自由狀態，以及促進軟體的普遍性分享和重複使用。 </para>
   </formalpara>
   <sect3 id="gplv2-nowarranty">
    <title>無擔保聲明</title>
    <formalpara id="bw4vapd">
     <title>11.</title>
     <para>因為程式是免費授權的，因此就可援用法律的允許程度，並不提供程式的擔保。非經書面聲明，著作權人和/或其他提供程式之人，無論明示或默示，均係依現況提供本程式而並無任何形式的擔保責任，其包括但不限於，就適售性以及特定目的的適用性為默示性擔保。有關本程式品質與效能的全部風險悉由您承擔。如本程式被證明有瑕疵，您應承擔所有服務、修復或改正的費用。 </para>
    </formalpara>
    <formalpara id="bw4vape">
     <title>12.</title>
     <para>非經法律要求或書面同意，任何著作權人或任何可能依前述方式修改和/或散佈本程式者，對於您因為使用或不能使用本程式所造成的一般性、特殊性、意外性或間接性損失，不負任何責任（包括但不限於，資料損失，資料執行不精確，或應由您或第三人承擔的損失，或本「程式」無法與其他程式運作等），即便前述的著作權人或其他人已被告知該等損失的可能性時，亦同。 </para>
    </formalpara>
   </sect3>
   <sect3 id="gplv2-endterms">
    <title>條款和條件結束</title>
    <para/>
   </sect3>
  </sect2>
  <sect2 id="gplv2-apply">
   <title>如何將這些條款套用至您的新程式</title>
   <para>如果您開發新程式，而且您想儘可能推向最多數公眾使用，最好的方法是讓它成為自由軟體，讓每個人都可以在這些條款下轉送和變更。 </para>
   <para>要做到這一點，將以下通知加到程式中。將它們加到每一個原始檔的開頭，是最安全的作法，可以最有效的表達不提供擔保；而且每一個檔案至少應該有一個<quote>版權</quote>行以及本份聲明全文位置的提示。 </para>

<screen>
one line to give the program’s name and an idea of what it does. 
Copyright (C) yyyy name of author

</screen>


<screen>
This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

</screen>


<screen>
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

</screen>


<screen>
You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307,
USA.

</screen>

   <para>另外透過電子郵件或一般信件，提供您的連絡資訊。 </para>
   <para>如果程式是互動性的，請在互動式模式開始時，輸出簡短提示如下： </para>

<screen>
Gnomovision version 69, Copyright (C) year name of author
Gnomovision comes with ABSOLUTELY NO WARRANTY; for details
type `show w’. This is free software, and you are welcome
to redistribute it under certain conditions; type `show c’ 
for details.

</screen>

   <para>假設的指令 show w 和 show c 應該會顯示「通用公共授權 (General Public License)」的適當部份。當然，您可以使用 show w and show c 以外的指令名稱；甚至以點選滑鼠按鍵或功能表項目的方式進行─只要適合您的程式。 </para>
   <para>您也應該讓雇主 (如果您是程式設計人員) 或者學校 (如果有的話)，在需要時簽署程式的<quote>著作權放棄承諾書</quote>。這是一個範例；請更改名稱： </para>

<screen>
Yoyodyne, Inc., hereby disclaims all copyright
interest in the program `Gnomovision’
(which makes passes at compilers) written 
by James Hacker.

</screen>


<screen>
signature of Ty Coon, 1 April 1989
Ty Coon, President of Vice

</screen>

   <para>本通用公共授權 (General Public License) 不允許將您的程式合併至專利程式。如果您的程式是常式程式庫，會發現允許將專利應用程式結合程式庫，幫助更大。如果這是您想做的，請使用 GNU Lesser General Public License 取代本「授權」。 </para>
   <para/>
   <para/>
   <para/>
   <para/>
   <para/>
  </sect2>
 </sect1>
 <sect1 id="gfdl-i" role="legal" xml:base="common_gfdl_i.xml">
  <title>GNU 自由文件授權 (Free Documentation License)</title>
  <para>版本 1.2，2002 年 11 月 </para>
  <para>Copyright (C) 2000,2001,2002 Free Software Foundation, Inc. 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA </para>
  <para>每個人皆可複製和散佈本授權文件的完整重製物，但不得變更其內容。 </para>
  <sect2 id="gfdl-preamble">
   <title>前言</title>
   <para>本授權的目的是讓使用者自由使用手冊、文字書籍或其他功能與有用文件，「自由」的含意如下：保證每個人能夠以商業或非商業方式、經過或不經過修改複製及重新散佈手冊或文件。其次，本「授權」讓作者和出版者一方面可以聲明該文件為其著作，一方面卻不必對他人所做的修改負責。 </para>
   <para>本「授權」是一種 <quote>Copyleft</quote>，這意味著文件的衍生著作本身也必須同樣是自由的。它與專為自由軟體而設計的 Copyleft 授權 GNU 通用公共授權 (General Public License) 相輔相成。 </para>
   <para>設計此授權為了將其用於自由軟體的手冊，因為自由軟體需要自由的文件：自由程式應隨附會提供與軟體同等自由度的手冊。但本「授權」並不限於軟體手冊；它可用於任何文字著作，而不論其主題內容為何，也不論是否以印刷形式出版。我們建議本「授權」主要運用於做為使用說明或參考用途的著作。 </para>
  </sect2>
  <sect2 id="gfdl-definitions">
   <title>效力與定義</title>
   <para>凡著作權人在其手冊或採用任何媒體的其他著作中聲明，該手冊或著作得以本「授權」條款散佈，則本「授權」對其均適用。這樣的聲明將授與免付權利金的全球性授權，可在此處規定的條件下無限期使用該著作。下文中的<quote>文件</quote>是指任何此類手冊或著作。一般大眾都是被授權人，文中將稱為<quote>您</quote>。您若以著作權法規定需要許可權的方式複製、修改或散佈著作，即表示您接受本授權的規定。 </para>
   <para>「文件」的<quote>修改版本</quote>係指包含「文件」全部或其部分的著作，不論是完整或經過修改的文件，以及（或）翻譯成其他語言的文件。 </para>
   <para>次要章節<quote>是「文件」中的具名附錄或序言章節，專門用來討論「文件」出版者或作者與「文件」整體主題 (或相關內容) 之間的關係，但不包含完全在該整體主題範圍內的內容</quote>(因此，如果「文件」有一部分為數學教科書，則「次要章節」不能用來解說何謂數學)。所解說的關係可為與主旨或相關內容之間的歷史淵源，或相關的法律、商業、哲學、倫理或政治立場。 </para>
   <para>恆常章節<quote>是指某些指定標題的「次要章節」，在聲明「文件」依本「授權」發行的聲明中將這些章節指定為「恆常章節」。</quote>如果某章節不符合上述「次要章節」的定義，就不得指定為「恆常章節」。「文件」可以不包含「恆常章節」。如果「文件」未指明任何「恆常章節」，即表示沒有「恆常章節」。 </para>
   <para>封面文字<quote>是列為「封面文字」或「封底文字」，以聲明「文件」乃依本「授權」發行的一段短文。</quote>「封面文字」最多 5 個英文字，「封底文字」最多 25 個英文字。 </para>
   <para>「文件」的<quote>透明</quote>副本是指機器可判讀的副本，以可供一般大眾取得的規格格式呈現，適合於直接用一般文字編輯器、一般繪圖程式 (針對像素組成的影像) 或一些廣為使用的繪圖編輯器 (針對圖形) 進行修改，而且適合輸入文字格式化程式，或自動轉換成適合輸入文字格式化程式的各種不同格式。如果以非「透明」檔案格式製作副本，而且其標示 (或無標示) 方式目的在於妨礙或阻撓讀者做進一步的修改，則該副本不是「透明」副本。影像格式如果用於大量文字，則該影像不是「透明」副本。不是<quote>透明</quote>的副本稱為<quote>不透明</quote>副本。 </para>
   <para>「透明」副本的合適格式包括沒有標示的純 ASCII 格式、Texinfo 輸入格式、LaTeX 輸入格式、使用公用 DTD 的 SGML 或 XML 格式以及專為人工修改設計的標準相容簡易 HTML、PostScript 或 PDF。透明影像格式的範例包括 PNG、XCF 和 JPG。「不透明」格式包括只有專屬文書處理程式可讀取和編輯的專屬格式、不是通用的 DTD 和/或處理工具的 SGML 或 XML、以及只供輸出目的而由一些文書處理器以機器產生的 HTML、PostScript 或 PDF。 </para>
   <para>印刷本的<quote>標題頁</quote>是指標題頁本身，加上依需要所附加的伴隨頁面，以清楚容納本「授權」要求列在標題頁的資料。著作所採用的格式如果沒有這樣的標題頁，則<quote>標題頁</quote>是指本文開始之前，接近著作標題最顯著處的文字。 </para>
   <para>標題為 XYZ<quote>章節是指「文件」中具名的小單元，它的標題就是 XYZ 或是將 XYZ 翻譯成其他語言並將 XYZ 括在括弧中</quote>(此處的 XYZ 代表下述特定章節名稱，如<quote>感謝</quote>、<quote>貢獻</quote>、<quote>背書</quote>或<quote>歷史</quote>)。在修改「文件」時<quote>保留標題</quote>，係指根據此定義，它仍保持是<quote>標題為 XYZ</quote>章節。 </para>
   <para>「文件」中可包含「放棄擔保聲明」，放在說明本「授權」適用於「文件」的聲明旁。提及的這些擔保免責聲明視為已包含在本授權中，但僅做為免責聲明擔保：這些擔保免責聲明可能具有的任何其他暗示均無效並對本授權沒有任何法律效力。 </para>
  </sect2>
  <sect2 id="gfdl-verbatim">
   <title>完整複製</title>
   <para>您可以在任何媒體上以營利或非營利方式複製和散佈「文件」，前提是在所有副本上必須重現本「授權」、版權聲明和聲明本「授權」適用於「文件」的授權聲明，而且您對本「授權」不附加其他任何條件。您不得使用技術手段來阻撓或控制讀取或再複製您所製作或散佈的副本。但是您可以收受報酬來交換副本。如果您散佈的副本數量夠多，您還必須遵守第三條的條件。 </para>
   <para>在上述的相同條件下，您也可以出租副本，和公開陳列副本。 </para>
  </sect2>
  <sect2 id="gfdl-quantity">
   <title>大量複製</title>
   <para>如果您出版文件的印刷副本 (或副本所採用的媒體通常具有印刷封面)，數量超過 100 份，並且文件的授權聲明需要有封面文字，則您必須將副本附在封面內，並在封面上以清晰易讀的方式載明所有封面文字：封面文字印在封面，封底文字印在封底。封面和封底也都必須以清晰易讀的方式指明您是這些副本的出版者。封面必須呈現完整標題，而且標題每個字要同樣顯著易讀。除此之外，您可以在封面和封底附加其他資料。如果變更僅限於封面或封底 (但必須保留「文件」的標題，而且滿足這些條件)，則該文件可被視在其他方面為完整複製。 </para>
   <para>如果封面或封底要求的文字太多，無法清楚放在一頁上，您應該在實際的封面上放先列的項目 (在合理的範圍內能放多少放多少)，再將其餘項目放在相鄰的頁面上。 </para>
   <para>如果您出版或散佈超過 100 份「文件」的「不透明」副本，每份「不透明」副本必須隨附機器可判讀的「透明」副本，或者在每份「不透明」副本中註明可取得「文件」完整「透明」副本的電腦網路位置，讓使用網路的一般大眾不需要額外的工具，即可利用公開的標準通訊協定下載該「透明」副本。如果您選用後者，當您開始大量散佈「不透明」副本時，您必須採取合理的審慎步驟，以保證可以在說明的位置取得此「透明」副本，而且從最後一次散佈該版本的「不透明」副本 (直接或透過代理商或零售商) 給大眾起，至少維持一年。 </para>
   <para>在您大量散佈任何副本前，希望 (但不硬性規定) 您儘早聯絡「文件」作者，讓作者有機會為您提供更新版的「文件」。 </para>
  </sect2>
  <sect2 id="gfdl-modify">
   <title>修改</title>
   <para>您可以依據以上第二、三條的條件，複製和散佈「文件」的「修改版本」，前提是您必須完全依據本「授權」發行「修改版本」，以「修改版本」取代「文件」的角色，從而將「修改版本」的散佈和修改權授與擁有文件副本的任何人。此外，您必須在「修改版本」中執行下列各項： </para>
   <formalpara id="bw4vnmy">
    <title>.</title>
    <para>在標題頁 (以及任何封面和封底) 上使用不同於「文件」和舊版本的標題 (如有這類版本，應列在「文件」的「歷史」一節)。您可以使用與舊版本相同的標題，但必須獲得該版本原始出版者的同意。 </para>
   </formalpara>
   <formalpara id="bw4vnmz">
    <title>B.</title>
    <para>在標題頁上，以作者的方式列出「修改版本」中負責寫作修改的一或多個人名或實體，以及至少 5 個「文件」的主要作者 (如果少於 5 人，則列出所有主要作者)，除非作者免除您履行這項要求的責任。 </para>
   </formalpara>
   <formalpara id="bw4vnn0">
    <title>C.</title>
    <para>在標題頁上陳述「修改版本」的出版者名稱，做為出版者。 </para>
   </formalpara>
   <formalpara id="bw4vnn1">
    <title>D.</title>
    <para>保留「文件」的所有版權聲明。 </para>
   </formalpara>
   <formalpara id="bw4vnn2">
    <title>E.</title>
    <para>緊接在其他版權聲明後，根據您的修改增加適當的版權聲明。 </para>
   </formalpara>
   <formalpara id="bw4vnn3">
    <title>F.</title>
    <para>緊接在版權聲明後包含授權聲明，以下述「補遺」的形式，提供根據本「授權」的條款授與大眾使用「修改版本」的許可權。 </para>
   </formalpara>
   <formalpara id="bw4vnn4">
    <title>G.</title>
    <para>在該授權聲明中，保留「文件」授權聲明中指定的「恆常章節」和必要封面文字的完整清單。 </para>
   </formalpara>
   <formalpara id="bw4vnn5">
    <title>H.</title>
    <para>包含本「授權」未經修改的副本。 </para>
   </formalpara>
   <formalpara id="bw4vnn6">
    <title>I.</title>
    <para>保留標題為<quote>歷史</quote>的章節，保留其標題，並在章節中新增一個項目，以至少陳述「修改版本」的標題、年份、新作者和出版者 (如標題頁所列)。如果「文件」沒有標題為<quote>歷史</quote>的章節，請建立一個章節，陳述標題頁上所列的「文件」標題、年份、作者和出版者，然後新增一個項目，依上一句的說明陳述「修改版本」。 </para>
   </formalpara>
   <formalpara id="bw4vnn7">
    <title>J.</title>
    <para>保留「文件」中提供的任何網路位置，讓公眾可以取得「文件」的「透明」副本，以及同樣在「文件」中提供的網路位置，以找到它所根據的舊版本。這些版本可放在<quote>歷史</quote>一節中。如果著作的出版日期至少在「文件」本身的出版日期前四年，或著作所引用之版本的原始出版者同意，您可以省略其網路位置。 </para>
   </formalpara>
   <formalpara id="bw4vnn8">
    <title>K.</title>
    <para>對於標題為<quote>感謝</quote>或<quote>貢獻</quote>的任何章節，請保留該節的標題，並在該節中保留該處提及每項貢獻者感謝和/或貢獻的要旨和語氣。 </para>
   </formalpara>
   <formalpara id="bw4vnn9">
    <title>L.</title>
    <para>保留「文件」的所有「恆常章節」，不論其文字和標題都不予以更動。章節編號或同等物不被視為章節標題的一部分。 </para>
   </formalpara>
   <formalpara id="bw4vnna">
    <title>M.</title>
    <para>刪除標題為<quote>背書</quote>的任何章節。這類章節不能包括於「修改版本」中。 </para>
   </formalpara>
   <formalpara id="bw4vnnb">
    <title>N.</title>
    <para>不要將現有章節的標題改成標題為<quote>背書</quote>，或與任何「恆常章節」相衝突的標題。 </para>
   </formalpara>
   <formalpara id="bw4vnnc">
    <title>O.</title>
    <para>保留任何「放棄擔保聲明」。 </para>
   </formalpara>
   <para>如果「修改版本」包含新的序言章節或合乎「次要章節」資格的附錄，而且不包含從「文件」複製而來的資料，則您可以選擇將這些章節全部或部分指定為「恆常章節」。若要這樣做，請將它們的標題新增到「修改版本」授權聲明中的「恆常章節」清單中。這些標題必須與任何其他章節標題不同。 </para>
   <para>您可以增加標題為<quote>背書</quote>的章節，前提是它只能包含不同當事人對您的「修改版本」所做的背書──舉例來說，同業評鑑的說法，或本文已經被某機構認可為標準的權威定義等。 </para>
   <para>您可以在「修改版本」的封面文字清單後，新增最多 5 個英文字的短文來做為「封面文字」，和最多 25 個英文字的短文來做為「封底文字」。任何實體 (或透過實體的安排) 都只能新增一段「封面文字」和一段「封底文字」。如果「文件」的相同封面上已經有先前您 (或您所代表的同一實體安排) 新增的封面文字，則您不得新增另一段封面文字；但是在新增舊封面文字的前出版者明確允許下，您可以替換掉舊封面文字。 </para>
   <para>「文件」的作者和出版者並不藉由本「授權」允許他人使用其姓名，來宣傳任何「修改版本」，或以明示或暗示的方式為任何「修改版本」背書。 </para>
  </sect2>
  <sect2 id="gfdl-combine">
   <title>合併文件</title>
   <para>您可以根據上述第四條對「修改版本」所定義的條款，將「文件」與其他依本「授權」規定發行的文件合併在一起，前提是您必須在合併作品中包括所有原始文件的所有「恆常章節」，並且不加修改，同時在合併作品的授權聲明中將他們全部列為「恆常章節」，並且保留其所有「放棄擔保聲明」。 </para>
   <para>合併作品只須包含本「授權」的一份副本，而且多個相同的「恆常章節」可以用單一副本取代。如果多個「恆常章節」的名稱相同但內容不同，則在每一個這種章節的標題後加上括弧，在括弧裡註明該章節原作者或出版者的名稱 (如果已知)，或指定獨特的號碼，讓這種章節各有獨特的標題。在合併作品授權聲明的「恆常章節」清單中，對章節標題做相同的調整。 </para>
   <para>在合併作品中，您必須合併不同原始文件中標題為<quote>歷史</quote>的任何章節，形成一個標題為<quote>歷史</quote>的章節；同樣地，您必須合併任何標題為<quote>感謝</quote>的章節，和任何標題為<quote>貢獻</quote>的章節。您必須刪除標題為<quote>背書</quote>的所有章節。 </para>
  </sect2>
  <sect2 id="gfdl-collect">
   <title>文件集合</title>
   <para>您可以彙集「文件」和其他根據本「授權」規定發行的文件，並將不同文件中本「授權」的個別副本以文件集合中隨附的單一副本取代，前提是您在其他每一方面都必須遵循本「授權」中完整複製每份文件的規定。 </para>
   <para>您可以將這樣的文件集合摘錄成一份文件，並且根據本「授權」的規定單獨散佈該文件，前提是您必須在摘錄文件中插入本「授權」的副本，而且在有關完整複製文件的其他每一方面都遵循本「授權」的規定。 </para>
  </sect2>
  <sect2 id="gfdl-aggregate">
   <title>與獨立著作彙集在一起</title>
   <para>若將「文件」或其衍生著作與其他不同的獨立文件或著作編纂在一起，存放在整卷儲存或散佈媒體上，可產生所謂「叢集」，前提是編纂作品所產生的版權限制，不得超過個別著作對編輯品使用者法定權利的允許範圍。當「文件」被收入叢集時，本「授權」不適用於叢集中本身並非「文件」衍生著作的其他著作。 </para>
   <para>如果第三條的封面文字規定適用於「文件」的這些副本，而且「文件」只佔整個叢集的一半以下，則可以將「文件」的封面文字放在叢集內包覆「文件」的封面上，或相當於封面的電子封面上 (如果「文件」採用電子形式)。否則封面文字必須出現在包覆完整叢集的印刷封面上。 </para>
  </sect2>
  <sect2 id="gfdl-translate">
   <title>翻譯</title>
   <para>翻譯被視為是一種修改，因此您可以根據第四條的條款散佈「文件」的翻譯。若要以翻譯取代「恆常章節」，您必須取得著作權人的特別許可，但是您可以在這些「恆常章節」的原始版本之外，隨附部份或所有「恆常章節」的翻譯。您可以包含本「授權」、「文件」中的所有授權聲明和任何「放棄擔保聲明」的翻譯，前提是您也必須包括本「授權」的原始英文版本，以及這些聲明與放棄聲明的原始版本。如果翻譯與本「授權」、聲明或放棄聲明的原始版本之間有任何不一致處，將以原始版本為準。 </para>
   <para>如果「文件」中的章節標題為<quote>感謝</quote>、<quote>貢獻</quote>或<quote>歷史</quote>，則因為第四條規定必須保留其標題 (第一條)，所以照例表示必須變更實際的標題。 </para>
  </sect2>
  <sect2 id="gfdl-termination">
   <title>終止</title>
   <para>除本「授權」明示的方式外，您不得複製、修改、再授權或散佈「文件」。任何試圖以其他方式進行複製、修改、再授權或者散佈「文件」的行為均為無效，並且將自動終止您基於本「授權」所得享有的權利。然而，依本授權規定自您手中收受重製物或權利之人，只要遵守本授權規定，他們所獲得的授權並不會因此終止。 </para>
  </sect2>
  <sect2 id="gfdl-revisions">
   <title>本授權的未來修訂版本</title>
   <para>自由軟體基金會可以隨時公佈新修訂的 GNU 自由文件授權 (Free Documentation License) 版本。類似的新版本，其精神和目前的版本類似，但解決新問題或事情的細節則不同。請參閱 http://www.gnu.org/copyleft/。 </para>
   <para>本授權的每個版本各有不同的指定版本編號。如果「文件」指定該文件適用本「授權」的特定版本編號<quote>或任何新版本</quote>，您可以選擇遵循該指定版本的條款和條件，或是自由軟體基金會已公佈的任何新版本 (非草稿) 的條款和條件。如果「文件」未指定本「授權」的版本編號，您可以選擇自由軟體基金會公佈過的任何版本 (非草稿)。 </para>
  </sect2>
  <sect2 id="gfdl-apply">
   <title>增補合約：如何將本授權用於您的文件</title>
   <para>若要在您所著的文件中使用本「授權」，請在文件中包含本「授權」的副本，並緊接在標題頁之後註明下列版權和授權聲明： </para>

<screen>
Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.

</screen>

   <para>如果您有「恆常章節」、「封面文字」和「封底文字」，請將「with...Texts」這一行更換成： </para>

<screen>
with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.

</screen>

   <para>如果您有「恆常章節」但沒有封面文字，或是這三者的一些其他組合，請合併兩種替代方式以符合您的狀況。 </para>
   <para>如果您的文件中包含重要的程式碼範例，我們建議您根據您選擇的自由軟體授權 (如 GNU 通用公共授權) 同步發行這些範例，以允許在自由軟體中使用這些範例。 </para>
  </sect2>
 </sect1>
</appendix>

<appendix id="b653gv6" xml:base="ax_docupdates.xml">
 <title>文件更新</title>
 <para>自 SUSE Linux Enterprise Server 11 最初發行之後，此<citetitle>《SUSE Linux Enterprise Server 儲存管理指南》</citetitle>中的內容做了一些變更，本章將介紹這些變更的相關資訊。</para>
 <para>本文件在以下日期進行了更新：</para>
 <itemizedlist role="subtoc" mark="bullet" spacing="normal">
  <listitem>
   <para><xref linkend="b18f6m4l" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b17tlcs5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b17ir4gy" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b176hzef" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13jg9cw" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14jt4a4" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b14dmrrl" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13z9xd2" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b13g65gi" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12irb56" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12mdifb" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b12doybp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="b10v707p" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bzit5x5" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bw4b1n8" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bvqj59s" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bvc15n0" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="burkc4m" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bt5x8xp" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="brgqw2y" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bq2fgom" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bndh000" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="boj6043" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bmy23qz" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bm18yt7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bleqdg7" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bkkotcf" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
  <listitem>
   <para><xref linkend="bfmmkat" xrefstyle="SectTitleOnPage"/></para>
  </listitem>
 </itemizedlist>
 <sect1 id="b18f6m4l">
  <title>2013 年 12 月 16 日</title>
  <para/>
  <sect2 id="b18f6m4m">
   <title>管理裝置的多重路徑 I/O</title>
   <para>¹ï以下小節進行了更新。變更說明如下。</para>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b18f6m4n">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b18f6m4o">
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>已更正 cciss 的範例︰</para>

<screen>
devnode "^cciss.c[0-9]d[0-9].*"

devnode "^cciss.c[0-9]d[0-9]*[p[0-9]*]"
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b17tlcs5">
  <title>2013 年 11 月 4 日</title>
  <para/>
  <sect2 id="b17tlcs6">
   <title>管理裝置的多重路徑 I/O</title>
   <para>¹ï以下小節進行了更新。變更說明如下。</para>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17tlcs7">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17tlcs8">
       <entry>
        <para><xref linkend="mpiosysconfpart" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>新增了與分割多重路徑裝置相關的問題。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b17ir4gy">
  <title>2013 年 10 月 14 日</title>
  <para>¹ï以下小節進行了更新。變更說明如下。</para>
  <sect2 id="b17ir4gz">
   <title>iSNS for Linux</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17ir4h0">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17ir4h1">
       <entry>
        <para><xref linkend="sec-isns-ddadd" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>將 -p ip:port 選項新增至下列指令︰</para>

<screen>
iscsiadm -m node -t iqn.2006-02.com.example.iserv:systems -p ip:port --op=update --name=node.startup --value=automatic

iscsiadm -m node -t iqn.2006-02.com.example.iserv:systems -p ip:port --op=delete
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b176hzef">
  <title>2013 年 10 月 4 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b17cmfjk" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b17cmlvf" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b176hzeg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b17cmfjk">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17cmfjl">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17cmfjm">
       <entry>
        <para><xref linkend="b12doufy" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>新增了指向<xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/> 中 <literal>blacklist_exceptions</literal> 範例的連結。</para>
       </entry>
      </row>
      <row id="b17cmfjn">
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>新增了幾個範例，展示如何使用 <literal>blacklist_exceptions</literal> 區段對透過 <literal>blacklist</literal> 區段中所用規則運算式列入黑名單的裝置啟用多重路徑。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b17cmlvf">
   <title>磁碟區快照</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b17cmlvg">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b17cmlvh">
       <entry>
        <para><xref linkend="snapshots" xrefstyle="ChapTitleOnPage"/></para>
       </entry>
       <entry>
        <para>為清楚起見，已將「原始磁碟區」變更為「來源邏輯磁碟區」。</para>
       </entry>
      </row>
      <row id="b17cnp7r">
       <entry>
        <para><xref linkend="bi7xb8b" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 Xen 主機環境中，您可以使用快照功能來備份虛擬機器的儲存後端，或測試對虛擬機器影像進行的變更 (例如針對修補程式或升級進行的變更)。 </para>
       </entry>
      </row>
      <row id="b17cnp7s">
       <entry>
        <para><xref linkend="snapshot-xen-host" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="b17cnp7t">
       <entry>
        <para><xref linkend="lvconvert-merge" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>如果來源邏輯磁碟區包含虛擬機器影像，您必須關閉虛擬機器，取消啟動來源邏輯磁碟區和快照磁碟區 (透過依該順序將其卸下)，發出合併指令，然後啟動快照磁碟區和來源邏輯磁碟區 (透過依該順序掛接它們)。因為來源邏輯磁碟區會自動重新掛接，並且合併完成時會刪除快照磁碟區，因此，在合併完成之前，您不應重新啟動虛擬機器。在合併完成之後，您便可將產生的邏輯磁碟區用於虛擬機器。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b176hzeg">
   <title>SLES 11 中關於儲存的新功能</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b176hzeh">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b176hzei">
       <entry>
        <para><xref linkend="bndgyoe" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>新增了有關如何完成從 SLES 10 SP4 升級到 SLES 11 前的準備工作 (如果系統裝置由 EVMS 管理) 的資訊。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b13jg9cw">
  <title>2013 年 6 月 (SLES 11 SP3)</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14ffk97" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g63v9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15coqxp" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14dug5l" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b155zz9h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13jg9cx" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15coqxs" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b15q3ht8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14ffkub" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14ffk97">
   <title>LVM 組態</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14ffk98">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14ffk99">
       <entry>
        <para><xref linkend="bgchx8c" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>新增了 LVM 邏輯磁碟區的簡易佈建的相關資訊。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b13g63v9">
   <title>透過 IP 網路的大量儲存裝置：iSCSI 目標伺服器</title>
   <para><xref linkend="cha-iscsi-lio" xrefstyle="ChapTitleOnPage"/> 為新增內容。</para>
  </sect2>
  <sect2 id="b15coqxp">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b15coqxq">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15coqxr">
       <entry>
        <para><xref linkend="b14ff9rs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="b15gv138">
       <entry>
        <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>更新了在 <filename>/usr/share/doc/packages/multipath-tools/multipath.conf.defaults</filename> 檔案中具有預設定義之儲存陣列的清單。</para>
       </entry>
      </row>
      <row id="b15gv4eu">
       <entry>
        <para><xref linkend="beep4ms" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><literal>-r</literal> 選項是新選項。</para>
       </entry>
      </row>
      <row id="b15jxit2">
       <entry>
        <para><xref linkend="b15jw320" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="b15dsfgw">
       <entry>
        <para><xref linkend="mpiosysconfsvr" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>新增了 <literal>alua</literal>、<literal>rdac</literal>、<literal>hp-sw</literal> 和 <literal>emc</literal> 的 SCSI 硬體處理程式的相關資訊。</para>
       </entry>
      </row>
      <row id="b15gv4ev">
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>更新了預設值清單，以注釋已廢棄的屬性 <literal>udev_dir</literal> 和 <literal>getuid_callout</literal>，新屬性 <literal>uid_attribute</literal>，以及 <literal>path_selector</literal> 和 <literal>max_fds</literal> 的已變更預設值。</para>
       </entry>
      </row>
      <row id="b15gvcrm">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para><literal>path_selector</literal> 的預設值已從 <literal>round-robin</literal> 變更為 <literal>service-time</literal>。</para>
        <para><literal>getuid_callout</literal> 屬性已廢棄，取而代之的是 <literal>uid_attribute</literal> 參數。</para>
        <para>新增了 <literal>uid_attribute</literal>。</para>
       </entry>
      </row>
      <row id="b15cq0jh">
       <entry>
        <para><xref linkend="scandev" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <warning>
         <para>在 EMC PowerPath 環境中，請勿使用作業系統隨附的 <filename>rescan-scsi-bus.sh</filename> 公用程式或 HBA 廠商程序檔來掃描 SCSI 匯流排。為了避免潛在的檔案系統損毀，EMC 要求您遵循 EMC PowerPath for Linux 的廠商文件中提供的程序來操作。</para>
        </warning>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b14dug5l">
   <title>使用 mdadm 管理軟體 RAID 6 和 10</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14dug5m">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14dug5n">
       <entry>
        <para><xref linkend="b14drcbo" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b155zz9h">
   <title>Linux 中檔案系統的綜覽</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b155zz9i">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15tkrrw">
       <entry>
        <para><xref linkend="b15tkr5k" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>清理頻率在掛接點的 Snapper 組態中定義。請將每日、每月和每年的 TIMELINE_LIMIT 參數值設定得較低，以縮短快照的保留時間並減少其數量。</para>
       </entry>
      </row>
      <row id="b155zz9j">
       <entry>
        <para><xref linkend="b15tkr5p" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b13jg9cx">
   <title>適用於軟體 RAID 的儲存機殼指示燈公用程式</title>
   <para><xref linkend="cha-raids-lee" xrefstyle="ChapTitleOnPage"/> 為新增內容。</para>
  </sect2>
  <sect2 id="b15coqxs">
   <title>磁碟區快照</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b15coqxt">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15coqxu">
       <entry>
        <para><xref linkend="bi7uttc" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>新增了 LVM 邏輯磁碟區快照的簡易佈建的相關資訊。</para>
       </entry>
      </row>
      <row id="b15coqxv">
       <entry>
        <para><xref linkend="lvconvert-merge" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b15q3ht8">
   <title>儲存問題疑難排解</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b15q3ht9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b15q3hta">
       <entry>
        <para><xref linkend="trbl-btrfs-volfull" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b14ffkub">
   <title>SLES 11 中關於儲存的新功能</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14ffkuc">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14ffkud">
       <entry>
        <para><xref linkend="new-sles11sp3" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b14jt4a4">
  <title>2013 年 3 月 19 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14jt4a5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14jt4a5">
   <title>Linux 中檔案系統的綜覽</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14jt4a6">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14jt4a7">
       <entry>
        <para><xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節已更新，討論了 SLES 11 中 Inode 大小和每 Inode 的位元組數比率之預設設定的變更。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b14dmrrl">
  <title>2013 年 3 月 11 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b14doxle" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b14dmrrm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b14doxle">
   <title>LVM 組態</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14doxlf">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14doxlg">
       <entry>
        <para><xref linkend="lvm-activate-vgs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b14dmrrm">
   <title>Linux 中檔案系統的綜覽</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b14dmrrn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b14dmrro">
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>多重裝置支援，可讓您增大或縮小檔案系統。該功能計劃在 YaST 磁碟分割程式的後續版本中提供。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b13z9xd2">
  <title>2013 年 2 月 8 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13z9xd3" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b13z9xd3">
   <title>設定根分割區的軟體 RAID1</title>
   <para>本節經過修改，著重介紹軟體 RAID1 類型。不支援軟體 RAID0 與 RAID5。以前曾錯誤地將它們包含在支援範圍內。下面說明其他重要變更。</para>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b13z9xd4">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b13z9xd5">
       <entry>
        <para><xref linkend="bi9d2lj" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>您需要第三個裝置用於 <filename>/boot</filename> 分割區。裝置應該是一個本地裝置。</para>
       </entry>
      </row>
      <row id="b13za2s6">
       <entry>
        <para><xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/> 中的<xref linkend="b13za1ue" xrefstyle="StepXRef"/></para>
       </entry>
       <entry>
        <para>建立 <filename>/boot</filename> 分割區。裝置應該是一個本地裝置。</para>
       </entry>
      </row>
      <row id="b13za83a">
       <entry>
        <para><xref linkend="bi9d19d" xrefstyle="SectTitleOnPage"/> 中的<xref linkend="bi9dzpu" xrefstyle="StepXRef"/></para>
       </entry>
       <entry>
        <para>在<guimenu>RAID 類型</guimenu>下，選取<guimenu>RAID 1 (鏡像)</guimenu>。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b13g65gi">
  <title>2013 年 1 月 8 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b13jh2o0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b13g65z1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b13jh2o0">
   <title>LVM 組態</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b13jh2o1">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b13jh2o2">
       <entry>
        <para><xref linkend="sec-yast2-system-lvm-explanation" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <important>
         <para>如果在設定 LVM 之後新增多重路徑支援，您必須修改 <filename>/etc/lvm/lvm.conf</filename> 檔案，以便僅掃描 <filename>/dev/disk/by-id</filename> 目錄中的多重路徑裝置名稱 (如<xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/> 中所述)，然後將伺服器重新開機。</para>
        </important>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b13g65z1">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b13g65z2">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b13jbspx">
       <entry>
        <para><xref linkend="beg2pi0" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>請確保每個節點上之 <filename>/etc/multipath.conf</filename> 檔案中的組態設定在整個叢集中保持一致。 </para>
       </entry>
      </row>
      <row id="b13g65z3">
       <entry>
        <para><xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>當使用指向 <filename>/dev/disk/by-id</filename> 目錄中的多重路徑對應裝置的連結時，請務必指定 <filename>dm-uuid*</filename> 名稱或別名，而不是裝置的固定路徑例項。</para>
       </entry>
      </row>
      <row id="b13gbii2">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>若要接受裝置對應程式名稱的原始磁碟區和分割區，請按如下所示指定路徑，<filename>mpath</filename> 前面不需要連字號 (-)︰</para>

<screen>
filter = [ "a|/dev/disk/by-id/dm-uuid-.*mpath-.*|", "r|.*|" ]
</screen>

       </entry>
      </row>
      <row id="b13gbxz9">
       <entry>
        <para><xref linkend="mpiousingpart" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>請確保 <filename>lvm.conf</filename> 與 <filename>md.conf</filename> 的組態檔案指向多重路徑裝置名稱。如果 <filename>boot.multipath</filename> 已啟用並在 <filename>boot.lvm</filename> 與 <filename>boot.md</filename> 之前載入，則應自動完成此操作。否則，LVM 與 MD 組態檔案可能包含多重路徑裝置的固定路徑，並且您必須修正那些路徑才能使用多重路徑裝置名稱。 </para>
       </entry>
      </row>
      <row id="b13g705m">
       <entry>
        <para><xref linkend="mpionames" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>開始之前，請參閱<xref linkend="mpiousingdev" xrefstyle="SectTitleOnPage"/> 中的要求。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b12irb56">
  <title>2012 年 11 月 14 日</title>
  <para>¹ï以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12o29bv" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12o29bv">
   <title>Linux 中檔案系統的綜覽</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b12o29bw">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b12r1r9k">
       <entry>
        <para><xref linkend="sec-filesystems-lfs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節經過更新，為了與 <ulink url="http://www.suse.com/products/server/technical-information/">SUSE Linux Enterprise Server 技術資訊網站</ulink>上的<ulink url="http://www.suse.com/products/server/technical-information/#FileSystem">檔案系統支援與大小</ulink>中的內容保持一致。</para>
       </entry>
      </row>
      <row id="b12o29bx">
       <entry>
        <para><xref linkend="sect-stor-limits" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b12mdifb">
  <title>2012 年 10 月 29 日</title>
  <para>前頁和印刷錯誤更正。 </para>
 </sect1>
 <sect1 id="b12doybp">
  <title>2012 年 10 月 19 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b12doybq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b12doybu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b12doybq">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b12doybr">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b12doybs">
       <entry>
        <para><xref linkend="bbillhs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>設定裝置的特定範例移至上一層組織層次。</para>
       </entry>
      </row>
      <row id="b12doybt">
       <entry>
        <para><xref linkend="mpiohwsupconf" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>假設在您修改 <filename>/etc/multipath.conf</filename> 檔案並進行試執行時，<filename>multipathd</filename> 精靈已使用舊 (或預設) 的多重路徑設定執行。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b12doybu">
   <title>Linux 中檔案系統的綜覽</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b12doybv">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b12doybw">
       <entry>
        <para><xref linkend="sec-fileystems-major-ext3inodesize" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>為了給 Ext3 檔案系統上檔案的延伸屬性和 ACL 留出空間，Ext3 的預設 Inode 大小已從 SLES 10 上的 128 位元組增大到 SLES11 上的 256 位元組。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="b10v707p">
  <title>2012 年 9 月 28 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="b10v71m2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="b10v71m1" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="b10v71m2">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b11v3x0i">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b122v4qy">
       <entry>
        <para><xref linkend="b122uvel" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 SLES 11 SP2 中，<literal>prio</literal> 關鍵字用於指定優先程度排序器，<literal>prio_args</literal> 關鍵字則用於為需要引數的優先程度排序器指定引數。</para>
        <para>多重路徑工具 0.4.9 及更新版本會使用 <filename>/etc/multipath.conf</filename> 檔案之 <literal>defaults{}</literal> 或 <literal>devices{}</literal> 區段中的 <literal>prio</literal> 設定。當關鍵字 <literal>prio</literal> 是為 <literal>multipaths{)</literal> 區段中的個別 <literal>multipath</literal> 定義而指定時，它會無訊息式地忽略該關鍵字。</para>
       </entry>
      </row>
      <row id="b122xhwg">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>新增了關於使用 <literal>prio</literal> 與 <literal>prio_args</literal> 關鍵字的資訊。</para>
       </entry>
      </row>
      <row id="b122u3zy">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 SLES 11 SP2 中，rr_min_io 多重路徑屬性已過時，被 rr_min_io_rq 屬性取代。</para>
       </entry>
      </row>
      <row id="b11v3x0j">
       <entry>
        <para><xref linkend="b11qkzgw" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="b122v4qz">
       <entry>
        <para><xref linkend="b122uxzr" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="b122v4r0">
       <entry>
        <para><xref linkend="b11qkzgx" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>修正了損壞的連結。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="b10v71m1">
   <title>Linux 中檔案系統的綜覽</title>
   <informaltable role="1" frame="topbot" colsep="0" rowsep="1" pgwide="1" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="5001*"/>
    <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row id="b10v72jy">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="b10v72jz">
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>Btrfs 工具套件是 <filename>btrfsprogs</filename>。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bzit5x5">
  <title>2012 年 4 月 12 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bznyukh" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bznyugr" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bznyukh">
   <title>管理裝置的多重路徑 I/O</title>
   <para>本節已更新為在所有範例中都使用 <filename>/dev/disk/by-id</filename> 目錄做為裝置路徑。</para>
  </sect2>
  <sect2 id="bznyugr">
   <title>使用 mdadm 調整軟體 RAID 陣列的大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bznyyes">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bznyyet">
       <entry>
        <para><xref linkend="resizedecr" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>修訂了程序的順序，以便在減小個別元件分割區大小之前，先減小 RAID 的大小。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bw4b1n8">
  <title>2012 年 2 月 27 日 (SLES 11 SP2)</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bw4b52h" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7nlj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkbgyt" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkgdv2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bw4b1n9" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="byz8ra8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk7y6n" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwk9zeq" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bxuakwj" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bwkf9o0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bw4b52h">
   <title>乙太網路上的光纖通道儲存：FCoE</title>
   <para>本節為新增內容。從 SLES 11 版本開始支援乙太網路上的開放光纖通道 (OpenFCoE)。</para>
  </sect2>
  <sect2 id="bwk7nlj">
   <title>GNU 授權</title>
   <para>本節為新增內容。</para>
  </sect2>
  <sect2 id="bwkbgyt">
   <title>LVM 組態 </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwkbgyu">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwkbgyv">
       <entry>
        <para><xref linkend="lvmtagging" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwkgdv2">
   <title>透過 NFSv4 管理存取控制清單</title>
   <para>本節為新增內容。</para>
  </sect2>
  <sect2 id="bw4b1n9">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bw4b1na">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bw4b1nb">
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>SLES 11 的預設 <literal>getuid</literal> 路徑是 /lib/udev/scsi_id。</para>
       </entry>
      </row>
      <row id="bwk7js1">
       <entry>
        <para><xref linkend="mpioerrormgmt" xrefstyle="HeadingOnPage"/></para>
        <para><xref linkend="mpiostall" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 <command>dmsetup message</command> 指令中，0 值代表磁區，當不需要磁區資訊時使用。 </para>
       </entry>
      </row>
      <row id="bxu9zlh">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>新增了在叢集環境中使用多重路徑 I/O 時，針對 no_path_retry 和錯誤回復設定的建議。</para>
       </entry>
      </row>
      <row id="bxu9zli">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>修正了 path-selector 選項名稱和設定：</para>
        <simplelist>
         <member>round-robin 0</member> <member>least-pending 0</member> <member>service-time 0</member> <member>queue-length 0</member>
        </simplelist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="byz8ra8">
   <title>使用 mdadm 管理軟體 RAID 6 和 10</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="byz8ra9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="byz8raa">
       <entry>
        <para><xref linkend="byz81ho" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwk7y6n">
   <title>IP 網路上的大型儲存裝置：iSCSI </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwk7ylk">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwkrs5c">
       <entry>
        <para><xref linkend="bwkrqdd" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="bwk7yll">
       <entry>
        <para><xref linkend="bwk7p6z" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwk9zeq">
   <title>Linux 上檔案系統的綜覽</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwk9zer">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwk9zes">
       <entry>
        <para><xref linkend="bwk8gda" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。 </para>
        <para>使用 SUSE Linux Enterprise 11 SP2 時，Btrfs 檔案系統將做為 SUSE Linux Enterprise 11 SP2 所有架構中的根檔案系統 (亦即作業系統的檔案系統) 受到支援。 </para>
       </entry>
      </row>
      <row id="bwkbczk">
       <entry>
        <para><xref linkend="sec-filesystems-major-reiser" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <important>
         <para>SUSE Linux Enterprise Server 11 的生命期間完全支援 ReiserFS 檔案系統，尤其是用於移轉目的。SUSE 計劃從 SUSE Linux Enterprise Server 12 起，不再支援建立新的 ReiserFS 檔案系統。</para>
        </important>
       </entry>
      </row>
      <row id="bwks4dw">
       <entry>
        <para><xref linkend="bwkryet" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="bwkbc4f">
       <entry>
        <para><xref linkend="sec-filesystems-lfs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節中的值已更新為目前的標準。</para>
       </entry>
      </row>
      <row id="bwkbkhq">
       <entry>
        <para><xref linkend="bwkbhpd" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bxuakwj">
   <title>調整檔案系統大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="100%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bxuakwk">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bxuakwl">
       <entry>
        <para><xref linkend="biuynjy" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="biuzt6a" xrefstyle="SectTitleOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para>resize2fs 指令僅允許調整已掛接 Ext3 檔案系統的大小。Ext3 磁碟區可以在掛接或卸載時增大或減小其大小。Ext2/4 檔案系統必須在卸載後方可增大或減小其磁碟區大小。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bwkf9o0">
   <title>使用 mdadm 調整軟體 RAID 陣列的大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bwkfa7i">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bwkfa7j">
       <entry>
        <para><xref linkend="resizeincrraid" xrefstyle="HeadingOnPage"/></para>
        <para/>
       </entry>
       <entry>
        <para><command>--assume-clean</command> 選項是新選項。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bvqj59s">
  <title>2011 年 7 月 12 日</title>
  <para>¹ï以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bvqj7sc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bvqj7sc">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bvqj7sd">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bvqj7se">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>僅當根 (/) 裝置或其任何部分 (例如 <filename>/var</filename>、<filename>/etc</filename>、<filename>/log</filename>) 位於 SAN 上且需要多重路徑以便開機時，才需要執行 <command>mkinitrd</command>。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bvc15n0">
  <title>2011 年 6 月 14 日</title>
  <para>¹ï以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bvc17t5" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bvc17t8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bvc17t5">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bvc17t6">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bvc17t7">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>在 SLES 11 中，path_grouping_policy 的預設設定已從 multibus 變更為 failover。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bvc17t8">
   <title>SLES 11 中關於儲存的新功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bvc17t9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bvc17ta">
       <entry>
        <para><xref linkend="bvc111p" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="burkc4m">
  <title>2011 年 5 月 5 日</title>
  <para>此版本修正了失效的連結並移除了過時的參考。</para>
 </sect1>
 <sect1 id="bt5x8xp">
  <title>2011 年 1 月</title>
  <para>¹ï以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bt5yoiu" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bt5wm3n" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bt5ylzd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bt5yoiu">
   <title>LVM 組態</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bt5yoiv">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bt5yoiw">
       <entry>
        <para><xref linkend="bgchx8a" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>LVM2 不限至實體範圍的數量。範圍數量龐大不會影響邏輯磁碟區的 I/O 效能，但會降低 LVM 工具的速度。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bt5wm3n">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bt5wpqq">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bt5wpqr">
       <entry>
        <para>為特定主機匯流排配接器微調容錯移轉</para>
       </entry>
       <entry>
        <para>已移除本節。如需 HBA 容錯移轉指南，請參閱廠商的相關文件。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bt5ylzd">
   <title>調整檔案系統大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bt5ylze">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bt5ylzf">
       <entry>
        <para><xref linkend="resizedecrfs" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>支援在檔案系統卸載後減少檔案系統的大小。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="brgqw2y">
  <title>2010 年 9 月 16 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="brgqysi" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="brgqysi">
   <title>LVM 組態</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="brgqysj">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="brgqysk">
       <entry>
        <para><xref linkend="bi706ct" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>擴增了該討論與程序內容，介紹如何設定使用整個磁碟的分割區。</para>
        <para>修改了該程序，以使用 YaST 磁碟分割程式中的硬碟分割功能。</para>
       </entry>
      </row>
      <row id="brgqysl">
       <entry>
        <para> 所有 LVM 管理章節</para>
       </entry>
       <entry>
        <para>修改了整章程序，以使用 YaST 磁碟分割程式中的磁碟區管理功能。</para>
       </entry>
      </row>
      <row id="brgqysm">
       <entry>
        <para><xref linkend="brgpqe2" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="brgqysn">
       <entry>
        <para><xref linkend="brgqpfy" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="brgqyso">
       <entry>
        <para><xref linkend="brgpmw3" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="brgqysp">
       <entry>
        <para><xref linkend="brgob84" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bq2fgom">
  <title>2010 年 6 月 21 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bq2fjfm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq7udwm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq2fh2u" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bq2gisd" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bq2fjfm">
   <title>LVM 組態</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq2fjfn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq2fjfo">
       <entry>
        <para><xref linkend="bi706ct" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>程序中新增了詳細資料。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bq7udwm">
   <title>管理多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq7udwn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq7udwo">
       <entry>
        <para><xref linkend="mpionames" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>針對根裝置使用易記名稱可能會導致資料遺失。根據文章 <ulink url="http://www.novell.com/support/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=7001133"><citetitle>TID 7001133：Recommendations for the usage of user_friendly_names in multipath configurations (在多重路徑組態中使用 user_friendly_names 的建議)</citetitle></ulink> 新增了替代方案。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bq2fh2u">
   <title>使用 mdadm 管理軟體 RAID 6 和 10</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq2fi7n">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq2fi7o">
       <entry>
        <para><xref linkend="b7cynnk" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>更正了範例中的錯誤。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bq2gisd">
   <title>IP 網路上的大型儲存裝置：iSCSI</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bq2gise">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bq2gisf">
       <entry>
        <para><xref linkend="nofail" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bndh000">
  <title>2010 年 5 月 (SLES 11 SP1)</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bo1piss" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bok8zbg" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bpjchpc" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bndh0qn" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bo1piss">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bo1pist">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bo1pisu">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>修正了<xref linkend="bg89rst" xrefstyle="StepOnPage"/> 中的範例。</para>
       </entry>
      </row>
      <row id="bombwdc">
       <entry>
        <para><xref linkend="bok8cn1" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="bothcg7">
       <entry>
        <para><xref linkend="mpiotoolsmpt" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>對於不同的伺服器架構，套件的檔案清單可能會有所不同。有關 multipath-tools 套件中包含的檔案清單，請造訪<ulink url="http://www.novell.com/products/server/techspecs.html?tab=1"><guimenu>SUSE Linux Enterprise Server Technical Specifications</guimenu>&gt;<guimenu>Package Descriptions</guimenu>網頁</ulink>，找到您的架構並選取<guimenu>Packages Sorted by Name</guimenu>，然後搜尋「multipath-tools」以找到該架構的套件清單。</para>
       </entry>
      </row>
      <row id="bomc4i7">
       <entry>
        <para><xref linkend="mpiosysconfsandevs" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>如果 SAN 裝置將做為伺服器上的根裝置使用，請依<xref linkend="bok8cn1" xrefstyle="SectTitleOnPage"/> 中所述修改該裝置的逾時設定。</para>
       </entry>
      </row>
      <row id="bpjp7nk">
       <entry>
        <para><xref linkend="mpiohwsupconf" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>新增了 -v3 詳細層級的範例輸出。</para>
       </entry>
      </row>
      <row id="bomcuqx">
       <entry>
        <para><xref linkend="bomcrff" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="bomcuqy">
       <entry>
        <para><xref linkend="bomc64e" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bok8zbg">
   <title>IP 網路上的大型儲存裝置：iSCSI</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bok8zbh">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bok8zbi">
       <entry>
        <para><xref linkend="sec-inst-system-iscsi-target-yast" xrefstyle="SectTitleOnPage"/> 中的<xref linkend="bojud2n" xrefstyle="StepXRef"/></para>
       </entry>
       <entry>
        <para>在<guimenu>YaST</guimenu><guimenu>網路服務</guimenu><guimenu>iSCSI 目標</guimenu>功能中，<guimenu>儲存</guimenu>選項可讓您輸出 iSCSI 目標資訊，更方便地向資源使用者提供此資訊。</para>
       </entry>
      </row>
      <row id="bp5cfck">
       <entry>
        <para><xref linkend="sec-inst-system-iscsi-ts" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bpjchpc">
   <title>軟體 RAID 組態</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bpjchpd">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bpjchpe">
       <entry>
        <para><xref linkend="bgchysh" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>已捨棄軟體 RAID HOW-TO。改為使用 <ulink url="https://raid.wiki.kernel.org/index.php/Linux_Raid"><citetitle>Linux RAID </citetitle>wiki</ulink>。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bndh0qn">
   <title>新增功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bndh0qo">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bndh0qp">
       <entry>
        <para><xref linkend="bndgyod" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="boj6043">
  <title>2010 年 2 月 23 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="boj6044" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="boja57r" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="boj6044">
   <title>設定根分割區的軟體 RAID</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="boj6045">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="boj62jo">
       <entry>
        <para><xref linkend="bi9d2lj" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>修正了 RAID 0 定義中的一個錯誤。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="boja57r">
   <title>管理多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="boja57s">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="boja57t">
       <entry>
        <para><xref linkend="scandev" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>新增了關於使用 <filename>rescan-scsi-bus.sh</filename> 程序檔在不重新開機的情況下掃描裝置的資訊。</para>
       </entry>
      </row>
      <row id="boja57u">
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>新增了關於使用 <filename>rescan-scsi-bus.sh</filename> 程序檔在不重新開機的情況下掃描裝置的資訊。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bmy23qz">
  <title>2009 年 12 月 1 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bmy26at" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy2h0k" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmy26aw" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bmy26at">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmy26au">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bn4z2ku">
       <entry>
        <para><xref linkend="mpiousinglvm" xrefstyle="SectTitleOnPage"/></para>
        <para><xref linkend="mpioraid" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>-f mpath 選項已變更為 -f multipath：</para>
        <para>mkinitrd -f multipath</para>
       </entry>
      </row>
      <row id="bmy26av">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/> 中的 <link linkend="b122sbgy">prio_callout</link></para>
       </entry>
       <entry>
        <para>多重路徑 prio_callout 程式位於 <filename>/lib/libmultipath/lib*</filename> 中的共享程式庫中。透過使用共享程式庫，callout 程式會在精靈啟動時載入到記憶體中。 </para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bmy2h0k">
   <title>調整檔案系統大小</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmy2h0l">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bmy2h0m">
       <entry>
        <para><xref linkend="biuytzx" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>resize2fs 公用程式支援線上或離線調整 ext3 檔案系統的大小。 </para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bmy26aw">
   <title>新增功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmy26ax">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bmy26ay">
       <entry>
        <para><xref linkend="bmy1edt" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bn4z2kv">
       <entry>
        <para><xref linkend="bn4yxd1" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bm18yt7">
  <title>2009 年 10 月 20 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bm18yt8" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bm1n6qa" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bmqj45v" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bm18yt8">
   <title>LVM 組態</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bm18yt9">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bm18yta">
       <entry>
        <para><xref linkend="sec-yast2-system-lvm-explanation" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>在 YaST 控制中心選取<menuchoice><guimenu>系統</guimenu><guimenu>磁碟分割程式</guimenu></menuchoice>。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bm1n6qa">
   <title>管理裝置的多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bm1n6qb">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bm1n6qc">
       <entry>
        <para><xref linkend="bbj5x7z" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>關鍵字 devnode_blacklist 已廢棄，被關鍵字黑名單取代。</para>
       </entry>
      </row>
      <row id="bmqiea8">
       <entry>
        <para><xref linkend="bbj68de" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>getuid_callout 已變更為 getuid。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bmqicwf">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>getuid_callout 已變更為 getuid。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bmqj3nw">
       <entry>
        <para><xref linkend="beg263n" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>新增了對 least-pending、length-load-balancing 與 service-time 選項之 path_selector 的說明。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bmqj45v">
   <title>新增功能</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bmqj45w">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bmqj45x">
       <entry>
        <para><xref linkend="bmqiv07" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bleqdg7">
  <title>2009 年 8 月 3 日</title>
  <para>¹ï以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bleqegm" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bleqegm">
   <title>管理多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bleqegn">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bleqego">
       <entry>
        <para><xref linkend="bleqcv0" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>

<screen>

</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bkkotcf">
  <title>2009 年 6 月 22 日</title>
  <para>對以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bkobnh2" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bky5or6" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
   <listitem>
    <para><xref linkend="bkkout0" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bkobnh2">
   <title>管理多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bkobnh3">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bky5lwj">
       <entry>
        <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>針對 System Z 新增了<xref linkend="bky5jc7" xrefstyle="StepOnPage"/> 與<xref linkend="bky5j1x" xrefstyle="StepOnPage"/>。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bkobnh4">
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>修正了步驟 2 中指令行的語法。</para>

<screen>

</screen>

       </entry>
      </row>
      <row id="bky51ut">
       <entry>
        <para><xref linkend="be48i9g" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para><xref linkend="befqjhp" xrefstyle="StepOnPage"/> 取代了原來的步驟 7 和步驟 8。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bky5or6">
   <title>使用 mdadm 管理軟體 RAID 6 和 10</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bky5or7">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bky5or8">
       <entry>
        <para><xref linkend="raidmdadmdegraded" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>若要查看每秒重新整理一次的重建進度，請輸入</para>

<screen>
watch -n 1 cat /proc/mdstat 
</screen>

       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
  <sect2 id="bkkout0">
   <title>IP 網路上的大型儲存裝置：iSCSI </title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bkkout1">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bkkout2">
       <entry>
        <para><xref linkend="sec-inst-system-iscsi-initiator-yast" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>為求清楚，資料已經過重新編排。</para>
        <para>新增了關於如何使用 iSCSI 目標裝置啟動選項之設定的資訊：</para>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <formalpara id="bkobopt">
           <title>自動：</title>
           <para>此選項用於 iSCSI 服務自身啟動時要連接的 iSCSI 目標。這是一般組態。</para>
          </formalpara>
         </listitem>
         <listitem>
          <formalpara id="bkobopu">
           <title>開機時：</title>
           <para>此選項用於開機時要連接的 iSCSI 目標；也就是說，當根目錄 (<filename>/</filename>) 位於 iSCSI 上時。因此，伺服器開機時，iSCSI 目標裝置會從 initrd 進行評估。</para>
          </formalpara>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="bfmmkat">
  <title>2009 年 5 月 21 日</title>
  <para>¹ï以下小節進行了更新。變更說明如下。</para>
  <itemizedlist role="subtoc" mark="bullet" spacing="normal">
   <listitem>
    <para><xref linkend="bfmml01" xrefstyle="SectTitleOnPage"/></para>
   </listitem>
  </itemizedlist>
  <sect2 id="bfmml01">
   <title>管理多重路徑 I/O</title>
   <informaltable frame="topbot" rowsep="1" pgwide="0" width="95%">
    <tgroup cols="2">
    <colspec colnum="1" colname="1" colwidth="4048*"/>
    <colspec colnum="2" colname="2" colwidth="5953*"/>
     <thead>
      <row id="bfmml02">
       <entry>
        <para>位置</para>
       </entry>
       <entry>
        <para>改變</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row id="bkk3nxd">
       <entry>
        <para><xref linkend="be5s8ae" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>對支援多重路徑的 IBM zSeries 裝置進行的測試表明，應將 dev_loss_tmo 參數設定為 90 秒，將 fast_io_fail_tmo 參數設定為 5 秒。若您使用的是 zSeries 裝置，則必須手動建立並設定 <filename>/etc/multipath.conf</filename> 檔案來指定這些值。如需更多資訊，請參閱<xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/>。</para>
       </entry>
      </row>
      <row id="bfmml04">
       <entry>
        <para><xref linkend="mpiotoolsdm" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>SUSE Linux Enterprise Server 11 及更高版本提供了對 <filename>/boot</filename> 裝置的多重路徑支援。 </para>
       </entry>
      </row>
      <row id="bkj949q">
       <entry>
        <para><xref linkend="bkj8n9w" xrefstyle="HeadingOnPage"/></para>
       </entry>
       <entry>
        <para>本節為新增內容。</para>
       </entry>
      </row>
      <row id="bfmml03">
       <entry>
        <para><xref linkend="mpioroot" xrefstyle="SectTitleOnPage"/></para>
       </entry>
       <entry>
        <para>現在，SUSE Linux Enterprise Server 11 中提供了 DM-MP 及其對 <filename>/boot</filename> 和 <filename>/root</filename> 的支援。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
</appendix>

</book>
