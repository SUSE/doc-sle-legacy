<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="zseries_rescue_initrd.xml" id="sec.zseries.rescue">
 <title>IBM System z：使用 initrd 做為救援系統</title>

 <para>
  如果升級或修改 SUSE® Linux Enterprise Server for IBM System z 的核心，可能會意外以不一致的狀態將系統重新開機，使得對所安裝的系統執行 IPL 的標準程序失敗。在已經安裝新的或更新的 SUSE Linux Enterprise Server 核心，但尚未執行 zipl 程式來更新 IPL 記錄時，最容易發生這種意外。在此狀況下，請使用標準安裝套件做為救援系統，可在其中執行 zipl 程式以更新 IPL 記錄。
 </para><indexterm> <primary>救援系統</primary> </indexterm>

 <sect2 id="sec.zseries.rescue.ipling">
  <title>IPL 救援系統</title>
  <important>
   <title>提供使用安裝資料</title>
   <para>
    為了讓此方法奏效，SUSE Linux Enterprise Server for IBM System z 安裝資料必須可用。如需詳細資訊，請參閱<xref linkend="sec.prep.makeavail"/>。除此之外，您還需要裝置的通道號碼，以及包含 SUSE Linux Enterprise Server 安裝根檔案系統的裝置內的分割區數量。
   </para>
  </important>
  <para>
   首先，依<xref linkend="sec.zseries.prep"/>中所述，對 SUSE Linux Enterprise Server for IBM System z 執行 IPL。然後會出現使用的網路介面卡選項清單。
  </para>
  <para>
   選取<guimenu>啟動安裝或系統</guimenu>，然後選取<guimenu>啟動救援系統</guimenu>以啟動救援系統。視安裝環境而定，您現在必須指定網路介面卡的參數和安裝來源。救援系統便會載入，且結尾會顯示下列登入提示：
  </para>
  <screen>Skipped services in runlevel 3:  nfs nfsboot

Rescue login:</screen>
  <para>
   您現在可以用 <systemitem class="username">root</systemitem> 身分登入而無需提供密碼。
  </para>
 </sect2>

 <sect2 id="sec.zseries.rescue.configure_disks">
  <title>設定磁碟</title>
  <para>
   在此狀態下，尚未設定任何磁碟。您必須先設定磁碟，才能繼續。
  </para>
  <procedure>
   <title>設定 DASD</title>
   <step performance="required">
    <para>
     使用下列指令來設定 DASD：
    </para>
    <screen>dasd_configure 0.0.0150 1 0</screen>
    <para>
     0.0.0150 是連接 DASD 的通道。<literal>1</literal> 表示啟用磁碟 (此處的 <literal>0</literal> 會停用磁碟)。<literal>0</literal> 表示磁碟的<quote>無 DIAG 模式</quote> (此處的 <literal>1</literal> 會啟用磁碟的 DAIG 存取)。
    </para>
   </step>
   <step performance="required">
    <para>
     現在 DASD 已經上線 (請使用 <command>cat /proc/partitions</command> 來檢查)，而且可以用於後續指令。
    </para>
   </step>
  </procedure>
  <procedure>
   <title>設定 zFCP 磁碟</title>
   <step performance="required">
    <para>
     若要設定 zFCP 磁碟，您必須先設定 zFCP 介面卡。使用下列指令來執行此動作：
    </para>
    <screen>zfcp_host_configure 0.0.4000 1</screen>
    <para>
     <literal>0.0.4000</literal> 是連接介面卡的通道，而 <literal>1</literal> 表示啟動 (此處的 <literal>0</literal> 會停用介面卡)。
    </para>
   </step>
   <step performance="required">
    <para>
     啟用介面卡之後，便可以設定磁碟。使用下列指令來執行此動作：
    </para>
    <screen>zfcp_disk_configure 0.0.4000 1234567887654321 8765432100000000  1</screen>
    <para>
     <literal>0.0.4000</literal> 是之前使用的通道 ID，<literal>1234567887654321</literal> 是 WWPN (全球連接埠號碼)，而 <literal>8765432100000000</literal> 則是 LUN (邏輯單元編號)。<literal>1</literal> 表示啟用磁碟 (此處的 <literal>0</literal> 會停用磁碟)。
    </para>
   </step>
   <step performance="required">
    <para>
     現在 zFCP 磁碟已經上線 (請使用 <command>cat /proc/partitions</command> 來檢查)，而且可以用於後續指令。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 id="sec.zseries.rescue.mount">
  <title>裝載根裝置</title>
  <para>
   如果所有所需磁碟均已上線，您現在就應該能夠裝載根裝置。假設根裝置位於 DASD 裝置的第二分割區 (<literal>/dev/dasda2</literal>)，對應的指令為 <command>mount /dev/dasda2 /mnt</command>。
  </para>
  <important>
   <title>檔案系統一致性</title>
   <para>
    如果安裝的系統未正確關閉，建議在裝載之前檢查檔案系統一致性。如此可避免意外遺失資料。使用此範例，發出指令 <command>fsck</command> <option>/dev/dasda2</option> 以確定檔案系統處於一致的狀態。
   </para>
  </important>
  <para>
   僅需發出指令 <command>mount</command>，便可以檢查檔案系統是否已正確裝載。
  </para>
  <example id="ex.zseries.rescue.mount.mount_output">
   <title>裝載指令的輸出</title>
   <screen>SuSE Instsys suse:/ # mount
shmfs on /newroot type shm (rw,nr_inodes=10240)
devpts on /dev/pts type devpts (rw)
virtual-proc-filesystem on /proc type proc (rw)
/dev/dasda2 on /mnt type reiserfs (rw)</screen>
  </example>
 </sect2>

 <sect2 id="sec.zseries.rescue.chroot">
  <title>變更至已裝載的檔案系統</title>
  <para>
   <literal>zipl</literal> 指令可從安裝的系統之根裝置讀取組態檔，而非從救援裝置，可使用 <command>chroot</command> 指令來變更安裝系統的根裝置：
  </para>
  <example id="ex.zseries.rescue.chroot">
   <title>chroot 至已裝載的檔案系統</title>
   <screen>SuSE Instsys suse:/ # cd /mnt 
SuSE Instsys suse:/mnt # chroot /mnt</screen>
  </example>
 </sect2>

 <sect2 id="sec.zseries.rescue.zipl">
  <title>執行 zipl</title>
  <para>
   現在執行 <command>zipl</command> 將正確值重新寫入 IPL 記錄：
  </para>
  <example id="ex.zseries.rescue.zipl">
   <title>使用 zipl 安裝 IPL 記錄</title>
   <screen>sh-2.05b# zipl 
building bootmap : /boot/zipl/bootmap 
adding Kernel Image : /boot/kernel/image located at 0x00010000 
adding Ramdisk : /boot/initrd located at 0x00800000 
adding Parmline : /boot/zipl/parmfile located at 0x00001000 
Bootloader for ECKD type devices with z/OS compatible layout installed. 
Syncing disks.... 
...done</screen>
  </example>
 </sect2>

 <sect2 id="sec.zseries.rescue.exit">
  <title>結束救援系統</title>
  <para>
   若要結束救援系統，首先以 <command>chroot</command> 指令和 <command>exit</command> 讓外圍程序保持開啟。若要防止資料遺失，請將所有未寫入的緩衝區以 <command>sync</command> 指令沖洗至磁碟。現在切換至救援系統的根目錄，並卸載 SUSE Linux Enterprise Server for IBM System z 安裝的根裝置。
  </para>
  <example id="ex.zseries.rescue.exit.umount">
   <title>解除裝載檔案系統</title>
   <screen>SuSE Instsys suse:/mnt # cd / 
SuSE Instsys suse:/ # umount /mnt</screen>
  </example>
  <para>
   最後，以 <command>halt</command> 指令停止救援系統。現在，可以依照章節<xref linkend="sec.s390.inst.reipl"/> 所述對 SUSE Linux Enterprise Server 系統執行 IPL。
  </para>
 </sect2>
</sect1>
