<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="depl_smt.xml" id="cha.smt">
 <title>訂閱管理</title>

 <para>
  任何執行 SUSE Linux Enterprise Server 11 或 SUSE Linux Enterprise Desktop 11 的機器都可以做以下設定︰向本地 Subscription Management Tool 伺服器註冊以下載軟體更新，而不是直接與 Novell Customer Center 及 NU 伺服器進行通訊。若要將 SMT 伺服器用於用戶端註冊並做為本地更新來源，必須先在網路中對 SMT 伺服器進行設定。SMT 伺服器軟體以 SUSE Linux Enterprise Server 附加產品的形式配送，《<emphasis>Subscription Management Tool Guide</emphasis>》(Subscription Management Tool 指南) 中對它的組態做了說明。不需要在要設定為註冊到 SMT 伺服器的用戶端上安裝任何附加產品。
 </para>
 <para>
  若要將用戶端註冊到 SMT 伺服器，您需要為用戶端設定伺服器的 URL。由於在註冊期間用戶端與伺服器是透過 HTTPS 通訊協定進行通訊的，因此您還需要確定用戶端信任伺服器的憑證。如果您的 SMT 伺服器設定為使用預設的伺服器證書，則可透過 HTTP 通訊協定存取 SMT 伺服器上的 CA 證書，網址為︰<literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>。在此情況下，您無需考慮是否有證書︰除非另有設定，否則註冊程序將自動從該處下載 CA 證書。如果證書由外部證書管理中心簽發，那麼您需要輸入伺服器 CA 證書的路徑。
 </para>
 <note>
  <title>註冊到 <literal>*.novell.com</literal> 子網域</title>
  <para>
   如果您嘗試註冊到任何 <literal>*.novell.com</literal> 子網域，基於安全性考量，系統將不會在註冊期間下載證書，也就無法完成證書處理。在這種情況下，請使用另一個網域名稱或純 IP 位址。
  </para>
 </note>
 <para>
  您可以使用多種方法提供此資訊，以及將用戶端機器設定為使用 SMT。第一種方法是在開機時透過核心參數提供所需的資訊。第二種方法是使用 AutoYaST 設定檔設定用戶端。此外還有一個隨 Subscription Management Tool 配送的程序檔 <command>clientSetup4SMT.sh</command>，您可在用戶端上執行該程序檔，將用戶端註冊於指定的 SMT 伺服器上。以下幾節將對這些方法進行說明︰
 </para>
 <sect1 id="smt.client.parameters">
  <title>使用核心參數存取 SMT 伺服器</title>

  <para>
   任何用戶端都可以設定為使用 SMT，只需在開機時提供核心參數 <literal>regurl</literal> 與 <literal>regcert</literal>。第一個是必要參數，而後面一個是選擇性參數。
  </para>

  <variablelist>
   <varlistentry>
    <term>regurl</term>
    <listitem>
     <para>
      SMT 伺服器的 URL。該 URL 的格式必須為︰<literal>https://<replaceable>FQDN</replaceable>/center/regsvc/</literal>，其中的 <replaceable>FQDN</replaceable> 是 SMT 伺服器完全合格的主機名稱。它必須與 SMT 伺服器上所用之伺服器證書的 FQDN 相同。範例：
     </para>
<screen>regurl=https://smt.example.com/center/regsvc/</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>regcert</term>
    <listitem>
     <para>
      SMT 伺服器 CA 證書的位置。指定下列其中一個位置：
     </para>
     <variablelist>
      <varlistentry>
       <term>URL</term>
       <listitem>
        <para>
         可從中下載證書的遠端位置 (http、https 或 ftp)。範例：
        </para>
<screen>regcert=http://smt.example.com/smt.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>磁片</term>
       <listitem>
        <para>
         指定磁片中的某個位置。開機時必須插入磁片，如果找不到磁片，系統不會提示您插入。該值必須以字串 <literal>floppy </literal> 開頭，後面是證書的路徑。範例：
        </para>
<screen>regcert=floppy/smt/smt-ca.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>本地路徑</term>
       <listitem>
        <para>
         本地機器上證書的絕對路徑。範例：
        </para>
<screen>regcert=/data/inst/smt/smt-ca.cert</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>互動</term>
       <listitem>
        <para>
         在安裝期間可以使用 <literal>ask</literal> 開啓一個快顯功能表，在其中指定憑證的路徑。對於 AutoYaST 請勿使用此選項。範例：
        </para>
<screen>regcert=ask</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>停用憑證安裝</term>
       <listitem>
        <para>
         如果證書將由附加產品安裝，或者您使用的是官方證書管理中心發佈的證書，請使用 <literal>done</literal>。範例：
        </para>
<screen>regcert=done</screen>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>請小心避免輸入錯誤</title>
   <para>
    確保輸入值正確。如果未正確指定 <literal>regurl</literal>，則更新來源的註冊作業將會失敗。
   </para>
   <para>
    如果為 <literal>regcert</literal> 輸入的值不正確，則系統會提示您提供憑證的本地路徑。如果未指定 <literal>regcert</literal>，則它的值將預設為 <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>，其中的 <literal>FQDN</literal> 是 SMT 伺服器的名稱。
   </para>
  </warning>

  <warning>
   <title>變更 SMT 伺服器證書</title>
   <para>
    如果 SMT 伺服器從不受信任的新 CA 處獲取了新證書，則用戶端需要擷取這個新 CA 證書檔案。註冊程序會自動完成此操作，但只有在安裝時使用了 URL 擷取證書，或者在省略了 <literal>regcert</literal> 參數因而使用預設 URL 的情況下才會如此。如果載入證書時使用的是其他的方法，例如使用磁片或本地路徑，則 CA 證書將不會更新。
   </para>
  </warning>
 </sect1>
 <sect1 id="smt.client.autoyast">
  <title>使用 AutoYaST 設定檔設定用戶端</title>

  <para>
   用戶端可以設定為透過 AutoYaST 設定檔註冊到 SMT 伺服器。如需建立 AutoYaST 設定檔及準備自動安裝的一般資訊，請參閱<xref linkend="cha.deployment.autoinst"/>。本節僅介紹特定於 SMT 的組態。
  </para>

  <para>
   若要使用 AutoYaST 設定特定於 SMT 的資料，請執行以下步驟︰
  </para>

  <procedure>
   <step performance="required">
    <para>
     以 <systemitem class="username">root</systemitem> 身分啟動 YaST，然後選取<menuchoice><guimenu>其他</guimenu> <guimenu>自動安裝</guimenu></menuchoice>，啟動 AutoYaST 的圖形前端。
    </para>
    <para>
     若要透過指令行啟動 AutoYaST 的圖形前端，可以使用 <command>yast2 autoyast</command> 指令來完成。

    </para>
   </step>
   <step performance="required">
    <para>
     使用<menuchoice><guimenu>檔案</guimenu> <guimenu>開啟</guimenu></menuchoice>開啟現有的設定檔，使用<menuchoice><guimenu>工具</guimenu> <guimenu>建立參考設定檔</guimenu></menuchoice>以目前系統的組態為基礎建立設定檔，或建立一個空的設定檔。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<menuchoice><guimenu>支援</guimenu> <guimenu>Novell Customer Center 組態</guimenu></menuchoice>。目前組態的綜覽即會顯示。
    </para>
   </step>
   <step performance="required">
    <para>
     按一下<guimenu>編輯</guimenu>。
    </para>
   </step>
   <step performance="required">

    <para>
     若要在自動安裝時註冊，請選取<guimenu>執行產品註冊</guimenu>。可以使用<guimenu>硬體設定檔</guimenu>與<guimenu>選擇性資訊</guimenu>包含系統資訊。
    </para>
   </step>
   <step performance="required">
    <para>
     設定<guimenu>SMT 伺服器</guimenu>的 URL，並選擇性地設定<guimenu>SMT 證書</guimenu>的位置。可能的值與核心參數 <literal>regurl</literal> 和 <literal>regcert</literal> 的值相同 (請參閱<xref linkend="smt.client.parameters"/>)。唯一的例外是，<literal>regcert</literal> 的 <literal>ask</literal> 值在 AutoYaST 中不起作用，因為設定為該值將需要使用者的互動。如果使用該值，將會跳過該註冊程序。
    </para>
   </step>
   <step performance="required">
    <para>
     執行要部署之系統所需的所有其他組態。
    </para>
   </step>
   <step performance="required">
    <para>
     選取<menuchoice><guimenu>檔案</guimenu> <guimenu>另存新檔</guimenu></menuchoice>，然後輸入設定檔的檔案名稱，例如 <filename>autoinst.xml</filename>。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="smt.client.clientsetupscript">
  <title>使用 clientSetup4SMT.sh 程序檔設定用戶端</title>

  <para>
   <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command> 程序檔隨 SMT 一起提供。此程序檔可將用戶端機器設定為使用 SMT 伺服器，或重新設定為使用其他 SMT 伺服器。
  </para>

  <para>
   若要透過 <command>clientSetup4SMT.sh</command> 程序檔將用戶端機器設定為使用 SMT，請執行以下步驟︰
  </para>

  <procedure>
   <step performance="required">
    <para>
     將 <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename> 程序檔從您的 SMT 伺服器複製到用戶端機器。
    </para>
   </step>
   <step performance="required">
    <para>
     以 <systemitem class="username">root</systemitem> 身分在用戶端機器上執行該程序檔。可採用以下兩種方法執行程序檔︰在第一種方法中，程序檔名稱後接註冊 URL︰<command>./clientSetup4SMT.sh <replaceable>註冊 URL</replaceable></command>，例如，<command>./clientSetup4SMT.sh https://smt.example.com/center/regsvc</command>。在第二種方法中，程序檔名稱後接 <option>--host</option> 選項，後面再跟著 SMT 伺服器的主機名稱︰<command>./clientSetup4SMT.sh --host <replaceable>伺服器主機名稱</replaceable></command>，例如，<command>./clientSetup4SMT.sh --host smt.example.com</command>。
    </para>
    
    <important>
     <title><option>--host</option> 參數</title>
     <para>
      主機名稱如果需要透過<option>--host</option> 參數提供，則必須與證書所頒發到的主機名稱相同。此外，如果證書中的名稱是完全合格的主機名稱 (例如 smt.example.com)，則此處也要這樣輸入 — 輸入<quote>簡稱</quote>(smt) 會導致 <command>clientSetup4SMT.sh</command> 程序檔失敗。 
     </para>
    </important>
    
   </step>
   <step performance="required">
    <para>
     程序檔會下載伺服器的 CA 憑證。按 <keycap>y</keycap> 接受憑證。
    </para>
   </step>
   <step performance="required">
    <para>
     程序檔會在用戶端上執行所有必要的修改。但是，註冊這個程序本身並不是由程序檔執行。
    </para>
   </step>
   <step performance="required">
    <para>
     透過執行用戶端上的 <command>suse_register</command> 或 <command>yast2 inst_suse_register</command> 模組執行註冊。
    </para>
   </step>
  </procedure>




 </sect1>
 <sect1>
  <title>在 SMT 測試環境下註冊用戶端</title>

  <para>
   要將用戶端設定為在測試環境而非生產環境下註冊，請透過下列設定修改用戶端機器上的 <filename>/etc/suseRegister.conf</filename>︰
   
   
  </para>

<screen>register = command=register&amp;testenv=1</screen>

  <para>
   如需關於在測試環境下使用 SMT 的詳細資訊，請參閱《<emphasis>Management Tool Guide</emphasis>》(Subscription Management Tool 指南)。
  </para>
 </sect1>
</chapter>
