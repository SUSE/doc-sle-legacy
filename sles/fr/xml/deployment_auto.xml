<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="deployment_auto.xml" id="cha.deployment.autoinst" os="sled;sles">
 <title>Installation automatisée</title>
 <para>
  AutoYaST permet d'installer SUSE® Linux Enterprise sur un grand nombre de machines en parallèle. La technologie AutoYaST offre une grande souplesse pour adapter les déploiements aux matériels hétérogènes. Ce chapitre vous indique comment préparer une installation automatisée simple et concevoir un scénario avancé impliquant différents types de matériels et d'objectifs d'installation.
 </para>
 <sect1 id="sec.deployment.autoinst.simple">
  <title>Installation de masse simple</title>

  <important>
   <title>Matériel identique</title>
   <para>
    Ce scénario suppose le déploiement de SUSE Linux Enterprise sur un ensemble de machines ayant exactement la même configuration matérielle.
   </para>
  </important>

  <para>
   Pour préparer une installation AutoYaST en masse, procédez de la façon suivante :
  </para>

  <procedure>
   <step performance="required">
    <para>
     Créez un profil AutoYaST contenant les détails d'installation nécessaires à votre déploiement comme décrit dans <xref linkend="sec.deployment.autoinst.simple.profile"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Déterminez la source du profil AutoYaST et les paramètres à transférer aux routines installation comme décrit dans <xref linkend="sec.deployment.autoinst.simple.dist"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Déterminez la source des données d'installation de SUSE Linux Enterprise, comme décrit dans la <xref linkend="sec.deployment.autoinst.simple.source"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Déterminez et configurez le scénario de démarrage pour l'installation automatique comme indiqué dans <xref linkend="sec.deployment.autoinst.simple.boot"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Transférez la ligne de commande aux routines d'installation en ajoutant les paramètres manuellement ou en créant un fichier <filename>info</filename> comme indiqué dans <xref linkend="sec.deployment.autoinst.simple.info"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Démarrez le processus d'installation automatique comme décrit dans <xref linkend="sec.deployment.autoinst.simple.install"/>.
    </para>
   </step>
  </procedure>

  <sect2 id="sec.deployment.autoinst.simple.profile">
   <title>Création d'un profil AutoYaST</title>
   <para>
    Un profil AutoYaST indique à AutoYaST ce qui doit être installé et comment configurer le système installé pour obtenir finalement un système complètement prêt à l'emploi. Il peut être créé de différentes manières :
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      En clonant une nouvelle installation à partir d'une machine de référence vers un ensemble de machines identiques.
     </para>
    </listitem>
    <listitem>
     <para>
      En utilisant l'interface graphique d'AutoYaST pour créer et modifier un profil correspondant à vos besoins.
     </para>
    </listitem>
    <listitem>
     <para>
      En utilisant un éditeur XML et en créant entièrement un profil.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Pour cloner une nouvelle installation de référence, procédez de la façon suivante :
   </para>
   <procedure>
    <step performance="required">
     <para>
      Effectuez une installation normale.
     </para>
    </step>
    <step performance="required">
     <para>
      Après avoir configuré le matériel et lu les notes de version, sélectionnez l'option <guimenu>Cloner ce système pour AutoYaST</guimenu> si elle n'est pas activée par défaut. Cela crée un profil prêt à l'emploi tel que <filename>/root/autoyast.xml</filename> pouvant être utilisé pour créer des clones de cette installation particulière.
     </para>
    </step>
   </procedure>
   <para>
    Pour utiliser l'interface graphique d'AutoYaST en vue de créer un profil à partir d'une configuration système existante et la modifier selon vos besoins, procédez de la façon suivante :
   </para>
   <procedure>
    <step performance="required">
     <para>
      En tant que <systemitem class="username">root</systemitem>, démarrez YaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Sélectionnez <menuchoice><guimenu>Divers</guimenu> <guimenu>Installation automatique</guimenu></menuchoice> pour démarrer l'interface graphique d'AutoYaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Sélectionnez <menuchoice><guimenu>Outils</guimenu> <guimenu>Créer un profil de référence</guimenu></menuchoice> pour préparer AutoYaST à mettre en miroir la configuration actuelle du système dans un profil AutoYaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Tout comme les ressources par défaut (telles que le chargeur de démarrage, le partitionnement et la sélection des logiciels), vous pouvez ajouter d'autres aspects de votre système au profil en sélectionnant les éléments de la liste dans <guimenu>Créer un fichier de contrôle de référence</guimenu>.
     </para>
    </step>
    <step performance="required">
     <para>
      Cliquez sur <guimenu>Créer</guimenu> pour que YaST regroupe toutes les informations du système et les écrive dans un nouveau profil.
     </para>
    </step>
    <step performance="required">
     <para>
      Pour continuer, effectuez l'une des actions suivantes :
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        Si le profil est terminé et correspond à vos besoins, sélectionnez <menuchoice><guimenu>Fichier</guimenu><guimenu>Enregistrer sous</guimenu></menuchoice> et entrez le nom de fichier du profil (par exemple, <filename>autoyast.xml</filename>).
       </para>
      </listitem>
      <listitem>
       <para>
        Modifiez le profil de référence en sélectionnant les aspects de configuration appropriés (tels que <quote>Matériel/Imprimante</quote>) dans la vue d'arborescence de gauche et en cliquant sur <guimenu>Configurer</guimenu>. Le module YaST correspondant démarre mais vos paramètres sont écrits dans le profil AutoYaST au lieu d'être appliqués à votre système. L'opération terminée, sélectionnez <menuchoice><guimenu>Fichier</guimenu><guimenu>Enregistrer sous</guimenu></menuchoice> et saisissez le nom du profil.
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step performance="required">
     <para>
      Quittez le module AutoYaST en sélectionnant <menuchoice><guimenu>Fichier</guimenu> <guimenu>Quitter</guimenu></menuchoice>.
     </para>
    </step>
   </procedure>
   <figure>
    <title>Modification d'un profil AutoYaST avec l'interface d'AutoYaST</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.dist">
   <title>Distribution du profil et détermination du paramètre AutoYaST</title>
   <para>
    Le profil AutoYaST peut être distribué de différentes manières. Selon le protocole utilisé pour distribuer les données du profil, différents paramètres d'AutoYaST sont utilisés pour faire connaître l'emplacement du profil aux routines d'installation sur le client. L'emplacement du profil est transmis aux routines d'installation au moyen de l'invite de démarrage ou d'un fichier <filename>info</filename> chargé au démarrage. Les options suivantes sont disponibles :
   </para>
   <informaltable>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         Emplacement du profil
        </para>
       </entry>
       <entry>
        <para>
         Paramètre
        </para>
       </entry>
       <entry>
        <para>
         Description
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         Fichier
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=file://<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Les routines d'installation recherchent le fichier de contrôle dans le chemin spécifié (relatif au répertoire racine source <filename>file:///autoyast.xml</filename> s'il se trouve dans le répertoire de niveau supérieur d'un CD-ROM).
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Périphérique
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=device://<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Lance la recherche par les routines d'installation du fichier de contrôle dans un périphérique de stockage. Seul le nom du périphérique est nécessaire—<filename>/dev/sda1</filename> est erroné, utilisez plutôt <filename>sda1</filename>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Disquette
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=floppy://<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Lance la recherche par les routines d'installation du fichier de contrôle dans une disquette du lecteur correspondant. Cette option se révèle particulièrement utile si vous voulez démarrer à partir du CD-ROM.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=nfs://<replaceable>serveur</replaceable>/<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Lance la recherche par les routines d'installation du fichier de contrôle sur un serveur NFS.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=http://<replaceable>serveur</replaceable>/<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Lance la recherche par les routines d'installation du fichier de contrôle sur un serveur HTTP.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTPS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=https://<replaceable>serveur</replaceable>/<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Les routines d'installation recherchent le fichier de contrôle sur un serveur HTTPS.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         TFTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=tftp://<replaceable>serveur</replaceable>/<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Lance la recherche par les routines d'installation du fichier de contrôle sur un serveur TFTP.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         FTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=ftp://<replaceable>serveur</replaceable>/<replaceable>chemin</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Les routines d'installation recherchent le fichier de contrôle sur un serveur FTP.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    Remplacez les espaces réservés <replaceable>serveur</replaceable> et <replaceable>chemin</replaceable> par des valeurs adaptées à votre configuration.
   </para>
   <para>
    AutoYaST inclut une fonction qui permet de lier certains profils à l'adresse MAC du client. Sans avoir à modifier le paramètre <option>autoyast=</option>, vous pouvez faire installer par la même configuration plusieurs instances différentes en utilisant des profils différents.
   </para>
   <para>
    Pour ce faire, procédez de la façon suivante :
   </para>
   <procedure>
    <step performance="required">
     <para>
      Créez des profils avec l'adresse MAC du client sous forme du nom de fichier et placez-les sur le serveur HTTP qui contient vos profils AutoYaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Omettez le chemin exact incluant le nom de fichier lors de la création du paramètre <option>autoyast=</option>, par exemple :
     </para>
<screen>autoyast=tftp://192.168.1.115/</screen>
    </step>
    <step performance="required">
     <para>
      Démarrez l'installation automatique.
     </para>
    </step>
   </procedure>
   <para>
    YaST tente de déterminer l'emplacement du profil de la façon suivante :
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      YaST recherche le profil en utilisant sa propre adresse IP en majuscules hexadécimales, par exemple, <literal>192.0.2.91</literal> donne <literal>C000025B</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      Si le fichier n'est pas trouvé, YaST supprime un chiffre hex et effectue une nouvelle tentative. Cette action se répète huit fois jusqu'à ce que le fichier portant le nom correct soit trouvé.
     </para>
    </listitem>
    <listitem>
     <para>
      Si cette tentative échoue de nouveau, YaST recherche un fichier ayant l'adresse MAC des clients comme nom de fichier. L'adresse MAC de l'exemple de client est <literal>0080C8F6484C</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      Si le nom de fichier portant l'adresse MAC est introuvable, YaST recherche un fichier nommé <filename>default</filename> (en minuscules). Un exemple de séquence d'adresses dans lequel YaST recherche le profil AutoYaST ressemble à cela :
     </para>
<screen>
C000025B 
C000025 
C00002 
C0000 
C000 
C00 
C0 
C 
0080C8F6484C 
default
     </screen>
    </listitem>
   </orderedlist>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.source">
   <title>Fourniture des données d'installation</title>
   <para>
    Les données d'installation peuvent être fournies au moyen des CD ou des DVD du produit ou en utilisant une source d'installation réseau. Si les CD du produit sont utilisés comme source d'installation, l'accès physique au client à installer est nécessaire, car le processus de démarrage doit être lancé manuellement et les CD doivent être changés.
   </para>
   <para>
    Pour fournir les sources d'installation sur le réseau, configurez un serveur d'installation réseau (HTTP, NFS, FTP) comme décrit dans <xref linkend="sec.deployment.remoteinst.instserver.sles9"/>. Utilisez un fichier <filename>info</filename> pour transmettre l'emplacement du serveur aux routines d'installation.
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.boot">
   <title>Configuration du scénario de démarrage</title>
   <para>
    Le client peut être démarré de différentes manières :
   </para>
   <variablelist>
    <varlistentry>
     <term>Démarrage réseau</term>
     <listitem>
      <para>
       Comme pour une installation distante normale, l'installation automatique peut être initiée avec Wake on LAN et PXE, l'image de démarrage et le fichier de contrôle peuvent être récupérés via TFTP, et les sources d'installation à partir d'un serveur d'installation réseau quelconque.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>CD-ROM amorçable</term>
     <listitem>
      <para>
       Vous pouvez utiliser le support SUSE Linux Enterprise d'origine pour démarrer le système pour l'installation automatique et récupérer le fichier de contrôle à partir d'un emplacement réseau ou d'une disquette. Vous pouvez également créer votre propre CD-ROM personnalisé contenant les sources d'installation et le profil AutoYaST.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Les sections qui suivent décrivent brièvement les procédures de démarrage réseau ou de démarrage à partir du CD-ROM.
   </para>
   <sect3 id="sec.deployment.autoinst.simple.boot.pxe">
    <title>Préparation du démarrage réseau</title>
    <para>
     Le démarrage réseau avec Wake on LAN, PXE et TFTP est abordé dans <xref linkend="sec.deployment.remoteinst.scenario.vncpxe"/>. Pour que la configuration présentée à cet endroit fonctionne en installation automatique, modifiez le fichier de configuration PXE Linux proposé (<filename>/srv/tftp/pxelinux.cfg/default</filename>) pour que le paramètre <literal>autoyast</literal> pointe vers l'emplacement du profil AutoYaST. Un exemple d'entrée d'une installation standard ressemble à cela :
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ 
	  
	</screen>
    <para>
     Le même exemple d'installation automatique se présente de la façon suivante :
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ \
           autoyast=nfs://192.168.1.110/profiles/autoyast.xml
	</screen>
    <para>
     Remplacez les exemples d'adresses IP et de chemins par les données utilisées dans votre configuration.
    </para>
   </sect3>
   <sect3 id="sec.deployment.autoinst.simple.boot.cd">
    <title>Préparation au démarrage à partir du CD-ROM</title>
    <para>
     Il existe plusieurs méthodes dans lesquelles le démarrage à partir du CD-ROM peut jouer un rôle dans les installations d'AutoYaST. Sélectionnez l'un des scénarios suivants :
    </para>
    <variablelist>
     <varlistentry>
      <term>Démarrage à partir du support de SUSE Linux Enterprise, récupération du profil sur le réseau</term>
      <listitem>
       <para>
        Utilisez cette approche si un scénario totalement basé sur le réseau n'est pas possible (par exemple, si votre matériel ne prend pas en charge PXE) et si vous avez l'accès physique au système à installer au cours de la plus grande partie du processus.
       </para>
       <para>
        Vous aurez besoin :
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          Du support de SUSE Linux Enterprise
         </para>
        </listitem>
        <listitem>
         <para>
          D'un serveur réseau fournissant les données du profil (reportez-vous à la <xref linkend="sec.deployment.autoinst.simple.dist"/> pour plus de détails)
         </para>
        </listitem>
        <listitem>
         <para>
          D'une disquette contenant le fichier <filename>info</filename> qui indique aux routines d'installation où trouver le profil
         </para>
         <para>
          <emphasis>ou</emphasis>
         </para>
         <para>
          De l'accès à l'invite de démarrage du système à installer où vous entrez manuellement le paramètre <literal>autoyast=</literal>
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term> Démarrage et installation à partir du support de SUSE Linux Enterprise, récupération du profil sur une disquette </term>
      <listitem>
       <para>
        Utilisez cette approche si un scénario d'installation totalement basé sur le réseau risque de ne pas fonctionner. Vous devez accéder physiquement au système à installer pour activer la machine cible ou, dans le deuxième cas, pour entrer l'emplacement du profil à l'invite de démarrage. Dans les deux cas, il se peut que vous deviez changer de support selon l'étendue de l'installation.
       </para>
       <para>
        Vous aurez besoin :
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          Du support de SUSE Linux Enterprise
         </para>
        </listitem>
        <listitem>
         <para>
          D'une disquette contenant le profile et le fichier <filename>info</filename>
         </para>
         <para>
          <emphasis>ou</emphasis>
         </para>
         <para>
          De l'accès à l'invite de démarrage de la cible pour entrer le paramètre <option>autoyast=</option>
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Démarrage et installation à partir d'un support personnalisé, récupération du profil à partir du support</term>
      <listitem>
       <para>
        Si vous avez seulement besoin d'installer un nombre limité de paquetages logiciels et si le nombre de cibles est relativement faible, il peut être judicieux de créer votre propre CD personnalisé contenant les données d'installation et le profil lui-même, en particulier si aucun réseau n'est disponible dans votre configuration.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.info">
   <title>Création du fichier <filename>info</filename></title>
   <para>
    Les routines d'installation sur la cible doivent connaître l'ensemble des composants différents de la structure d'AutoYaST. Cela s'effectue en créant une ligne de commande contenant tous les paramètres nécessaires pour rechercher les composants d'AutoYaST, les sources d'installation et les paramètres nécessaires pour contrôler le processus d'installation.
   </para>
   <para>
    Vous pouvez le faire manuellement en transmettant ces paramètres à l'invite de démarrage de l'installation ou en fournissant un fichier nommé <filename>info</filename> lu par les routines d'installation (linuxrc). La première méthode nécessite l'accès physique à un client quelconque à installer, ce qui rend cette approche inadaptée aux déploiements de grande taille. La seconde permet de fournir le fichier <filename>info</filename> sur un support préparé et inséré dans les lecteurs du client avant l'installation automatique. Vous pouvez également utiliser le démarrage PXE et inclure les paramètres linuxrc au fichier <filename>pxelinux.cfg/default</filename> comme illustré dans <xref linkend="sec.deployment.autoinst.simple.boot.pxe"/>.
   </para>
   <para>
    Les paramètres suivants sont généralement utilisés pour linuxrc. Pour plus d'information, reportez-vous à la documentation du paquetage AutoYaST sous <filename>/usr/share/doc/packages/autoyast</filename>.
   </para>
   <important>
    <title>Séparation des paramètres et des valeurs</title>
    <para>
     Lorsque vous transmettez des paramètres à linuxrc à l'invite de démarrage, utilisez <literal>=</literal> pour séparer les paramètres et les valeurs. Lorsque vous utilisez un fichier <filename>info</filename>, séparez le paramètre de la valeur avec <literal>:</literal>.
    </para>
   </important>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         Mot clé
        </para>
       </entry>
       <entry>
        <para>
         Valeur
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <literal>netdevice</literal>
        </para>
       </entry>
       <entry>
        <para>
         Le périphérique réseau à utiliser pour la configuration réseau (pour les requêtes BOOTP/DHCP). Nécessaire uniquement si plusieurs périphériques réseau sont disponibles.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>hostip</literal>
        </para>
       </entry>
       <entry>
        <para>
         Lorsque la valeur est vide, le client envoie une requête BOOTP. Sinon, le client est configuré en utilisant les données spécifiées.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netmask</literal>
        </para>
       </entry>
       <entry>
        <para>
         Masque de réseau du réseau sélectionné.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>gateway</literal>
        </para>
       </entry>
       <entry>
        <para>
         Passerelle par défaut.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>nameserver</literal>
        </para>
       </entry>
       <entry>
        <para>
         Serveur de noms.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>autoyast</literal>
        </para>
       </entry>
       <entry>
        <para>
         Emplacement du fichier de contrôle à utiliser pour l'installation automatique, par exemple <literal>autoyast=nfs//192.168.1.110/profiles/</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>install</literal>
        </para>
       </entry>
       <entry>
        <para>
         Emplacement de la source d'installation, par exemple <literal>install=nfs://192.168.1.110/CDs/</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vnc</literal>
        </para>
       </entry>
       <entry>
        <para>
         Si la valeur est définie sur <literal>1</literal>, permet l'installation VNC contrôlée à distance.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vncpassword</literal>
        </para>
       </entry>
       <entry>
        <para>
         Mot de passe pour VNC.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>usessh</literal>
        </para>
       </entry>
       <entry>
        <para>
         Si la valeur est définie sur <literal>1</literal>, permet l'installation SSH contrôlée à distance.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netsetup</literal>
        </para>
       </entry>
       <entry>
        <para>
         Si cette option est définie sur <literal>1</literal>, elle configure le réseau. En principe, cette opération est automatique. Cependant, vous devez définir <literal>netsetup=1</literal> si le dépôt d'installation est fourni en local (via DVD ou une image ISO locale, par exemple) et si le fichier <filename>info</filename> est chargé à partir du réseau.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    Si votre scénario d'installation automatique implique la configuration du client via DHCP et une source d'installation réseau et si vous souhaitez surveiller le processus d'installation par le biais de VNC, votre fichier <filename>info</filename> ressemblera à l'exemple suivant :
   </para>
<screen>autoyast:<replaceable>profile_source</replaceable> install:<replaceable>install_source</replaceable> vnc:1 vncpassword:<replaceable>some_password</replaceable></screen>
   <para>
    Si vous préférez une configuration réseau statique lors de l'installation, votre fichier <filename>info</filename> ressemblera à cela :
   </para>
<screen>
autoyast:<replaceable>profile_source</replaceable> \
install:<replaceable>install_source</replaceable> \ 
hostip:<replaceable>some_ip</replaceable> \ 
netmask:<replaceable>some_netmask</replaceable> \ 
gateway:<replaceable>some_gateway</replaceable></screen>
   <para>
    Le caractère <literal>\</literal> indique que les sauts de ligne n'ont été ajoutés qu'afin d'améliorer la lisibilité. Toutes les options doivent être entrées sous forme de chaîne continue.
   </para>
   <para>
    Les données <filename>info</filename> peuvent être mises à disposition de linuxrc de plusieurs manières :
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Sous la forme d'un fichier enregistré sur une disquette ou un CD-ROM qui se trouve sur l'unité du client au moment de l'installation. Ajoutez le paramètre info, par exemple <systemitem>info=floppy:/info</systemitem> ou <systemitem>info=cd:/info</systemitem>.
     </para>
    </listitem>
    <listitem>
     <para>
      Sous forme de fichier dans le répertoire racine du disque RAM initial utilisé pour démarrer le système fourni à partir du support d'installation personnalisé ou via le démarrage PXE.
     </para>
    </listitem>
    <listitem>
     <para>
      Dans le cadre du profil AutoYaST. Dans ce cas, le fichier AutoYaST doit être nommé <filename>info</filename> pour permettre à linuxrc de l'analyser. Un exemple de cette approche est donné ci-dessous.
     </para>
    </listitem>
    <listitem>
     <para>
      Par le biais d'une URL qui pointe vers l'emplacement du fichier info. Dans ce cas, la syntaxe ressemble à <systemitem>info=http://www.exemple.com/info</systemitem>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    linuxrc recherche une chaîne (<option>start_linuxrc_conf</option>) dans le profil qui représente le début du fichier. Si elle est trouvée, il analyse le contenu en commençant par cette chaîne et en finissant lorsque la chaîne <option>end_linuxrc_conf</option> a été trouvée. Les options sont stockées dans le profil de la façon suivante :|
   </para>
<screen>....
  &lt;install&gt;
....
    &lt;init&gt;
      &lt;info_file&gt;
&lt;![CDATA[
#
# Don't remove the following line:
# start_linuxrc_conf
#
install: nfs:<replaceable>server</replaceable>/<replaceable>path</replaceable>
vnc: 1
vncpassword: test
autoyast: file:///info

# end_linuxrc_conf
# Do not remove the above comment
#
]]&gt;

      &lt;/info_file&gt;
    &lt;/init&gt;
......
  &lt;/install&gt;
....
</screen>
   <para>
    linuxrc charge le profil contenant les paramètres de démarrage au lieu du fichier <filename>info</filename> classique. Le paramètre <option>install:</option> pointe vers l'emplacement des sources d'installation. Les paramètres <option>vnc</option> et <option>vncpassword</option> indiquent si VNC est utilisé pour la surveillance de l'installation. Le paramètre <option>autoyast</option> indique à linuxrc de traiter <filename>info</filename> comme un profil AutoYaST.
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.install">
   <title>Initialisation et surveillance de l'installation automatique</title>
   <para>
    Après avoir fourni toute l'infrastructure mentionnée ci-dessus (profil, source d'installation et fichier <filename>info</filename>), vous pouvez poursuivre et démarrer l'installation automatique. Selon le scénario choisi pour le démarrage et la surveillance du processus, l'interaction physique avec le client peut être nécessaire :
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Si le système du client démarre à partir d'un support physique quelconque, qu'il s'agisse du support du produit ou de CD personnalisés, vous devez les insérer dans les lecteurs du client.
     </para>
    </listitem>
    <listitem>
     <para>
      Si le client n'est pas activé via Wake on LAN, vous devez au moins activer la machine cliente.
     </para>
    </listitem>
    <listitem>
     <para>
      Si vous n'avez pas choisi l'installation automatique contrôlée à distance, les commentaires graphiques d'AutoYaST sont envoyés au moniteur connecté au client ou, si vous utilisez un client sans moniteur, à une console série.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Pour activer l'installation automatique contrôlée à distance, utilisez les paramètres VNC ou SSH décrits dans <xref linkend="sec.deployment.autoinst.simple.info"/> et connectez-vous au client à partir d'une autre machine comme indiqué dans <xref linkend="sec.deployment.remoteinst.monitor"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.advanced">
  <title>Installation automatique basée sur des règles</title>

  <para>
   Les sections suivantes présentent le concept de base d'installation basée sur des règles en utilisant AutoYaST et fournissent un exemple de scénario permettant de créer votre propre configuration d'installation automatique.
  </para>

  <sect2 id="sec.deployment.autoinst.advanced.expl">
   <title>Présentation de l'installation automatique basée sur des règles</title>
   <para>
    L'installation AutoYaST basée sur des règles permet de gérer des environnements matériels hétérogènes :
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Votre site contient-il des matériels de fournisseurs différents ?
     </para>
    </listitem>
    <listitem>
     <para>
      Les machines de votre site ont-elles des configurations matérielles différentes (par exemple, avec des périphériques différents ou des tailles de mémoire et de disque différentes) ?
     </para>
    </listitem>
    <listitem>
     <para>
      Avez-vous l'intention d'effectuer l'installation des différents domaines et souhaitez-vous pouvoir les distinguer ?
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Globalement, l'installation automatique basée sur des règles génère un profil personnalisé pour correspondre à un scénario hétérogène en fusionnant plusieurs profils en un seul. Chaque règle décrit une fonction distincte particulière de votre configuration (par exemple la taille du disque) et indique à AutoYaST quel profil utiliser lorsque la règle correspond. Plusieurs règles décrivant des fonctions différentes de votre configuration sont combinées dans un fichier <filename>rules.xml</filename> d'AutoYaST. La pile de règles est ensuite traitée et AutoYaST génère le profil final en fusionnant en un seul les différents profils correspondant aux règles AutoYaST. Pour illustrer cette procédure, reportez-vous au <xref linkend="sec.deployment.autoinst.advanced.example"/>.
   </para>
   <para>
    L'installation AutoYaST basée sur des règles vous offre une grande souplesse au niveau de la planification et de l'exécution de votre déploiement SUSE Linux Enterprise. Vous pouvez :
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Créer des règles pour correspondre à n'importe quel attribut prédéfini du système dans AutoYaST
     </para>
    </listitem>
    <listitem>
     <para>
      Combiner plusieurs attributs du système (par exemple la taille de disque et architecture du kernel) dans une même règle en utilisant des opérateurs logiques
     </para>
    </listitem>
    <listitem>
     <para>
      Créer des règles personnalisées en exécutant des scripts de shell et en transmettant leur résultat à la structure d'AutoYaST. Le nombre de règles personnalisées et limité à cinq.
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <para>
     Pour plus d'informations sur la création et l'utilisation de règles avec AutoYaST, reportez-vous à la documentation du paquetage sous <filename>/usr/share/doc/packages/autoyast2/html/index.html</filename>, chapitre <guimenu>Règles et classes</guimenu>.
    </para>
   </note>
   <para>
    Pour préparer une installation AutoYaST en masse basée sur des règles, procédez de la façon suivante :
   </para>
   <procedure>
    <step performance="required">
     <para>
      Créez plusieurs profils AutoYaST contenant les détails d'installation nécessaires à votre configuration hétérogène comme décrit dans <xref linkend="sec.deployment.autoinst.simple.profile"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Définissez les règles de correspondance aux attributs du système de votre configuration matérielle comme indiqué dans <xref linkend="sec.deployment.autoinst.advanced.example"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Déterminez la source du profil AutoYaST et les paramètres à transférer aux routines installation comme décrit dans <xref linkend="sec.deployment.autoinst.simple.dist"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Déterminez la source des données d'installation de SUSE Linux Enterprise, comme décrit dans la <xref linkend="sec.deployment.autoinst.simple.source"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Transférez la ligne de commande aux routines d'installation en ajoutant les paramètres manuellement ou en créant un fichier <filename>info</filename> comme indiqué dans <xref linkend="sec.deployment.autoinst.simple.info"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Déterminez et configurez le scénario de démarrage pour l'installation automatique, comme décrit à la <xref linkend="sec.deployment.autoinst.simple.boot"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Démarrez le processus d'installation automatique, comme décrit à la <xref linkend="sec.deployment.autoinst.simple.install"/>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.advanced.example">
   <title>Exemple de scénario d'installation automatique basée sur des règles</title>
   <para>
    Pour avoir une connaissance de base de la création des règles, réfléchissez à l'exemple suivant, décrit dans <xref linkend="fig.autoyast.rules"/>. Une exécution d'AutoYaST installe la configuration suivante :
   </para>
   <variablelist>
    <varlistentry>
     <term>Un serveur d'impression</term>
     <listitem>
      <para>
       Cette machine n'a besoin que d'une installation minimale sans environnement de bureau et un nombre limité de paquetages logiciels.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Postes de travail du service Ingénierie</term>
     <listitem>
      <para>
       Ces machines ont besoin d'un environnement de bureau et d'un ensemble étendu de logiciels de développement.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Ordinateurs portables du service des Ventes</term>
     <listitem>
      <para>
       Ces machines ont besoin d'un environnement de bureau et d'un ensemble limité d'applications spécialisées (bureautique et agenda, par exemple).
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure id="fig.autoyast.rules">
    <title>Règles AutoYaST</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_rules.svg" width="90%" format="SVG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_rules.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Dans une première étape, utilisez l'une des méthodes décrites dans <xref linkend="sec.deployment.autoinst.simple.profile"/> pour créer des profils pour chaque cas d'utilisation. Dans cet exemple, vous allez créer <filename>print.xml</filename>, <filename>engineering.xml</filename> et <filename>sales.xml</filename>.
   </para>
   <para>
    Dans la seconde étape, créez des règles pour distinguer les trois types de matériel les uns des autres et pour indiquer à AutoYaST quel profil utiliser. Utilisez un algorithme similaire à ce qui suit pour configurer les règles :
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      La machine a-t-elle l'adresse IP <guimenu>192.168.2.253</guimenu> ? Faites-en le serveur d'impression.
     </para>
    </listitem>
    <listitem>
     <para>
      La machine possède-t-elle du matériel PCMCIA et un jeu de puces Intel ? Considérez-la comme un ordinateur portable Intel et installez la sélection de logiciels du service des ventes.
     </para>
    </listitem>
    <listitem>
     <para>
      Si rien de ce qui précède n'est vrai, considérez la machine comme un poste de travail de développeur et effectuez l'installation en conséquence.
     </para>
    </listitem>
   </orderedlist>
   <para>
    Dans les grandes lignes, cela se traduit par un fichier <filename>rules.xml</filename> dont le contenu est le suivant :
   </para>
<screen>
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE autoinstall SYSTEM "/usr/share/autoinstall/dtd/rules.dtd"&gt; 
&lt;autoinstall xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns"&gt;
  &lt;rules config:type="list"&gt;
    &lt;rule&gt;
       &lt;hostaddress&gt;
	    &lt;match&gt;192.168.2.253&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/hostaddress&gt;
       &lt;result&gt;
            &lt;profile&gt;print.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
       &lt;haspcmcia&gt;
            &lt;match&gt;1&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/haspcmcia&gt;
       &lt;custom1&gt;
           &lt;script&gt;
if grep -i intel /proc/cpuinfo &gt; /dev/null; then
echo -n "intel"
else
echo -n "non_intel"
fi;
           &lt;/script&gt;
           &lt;match&gt;*&lt;/match&gt;
           &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/custom1&gt;
       &lt;result&gt;
            &lt;profile&gt;sales.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
        &lt;operator&gt;and&lt;/operator&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
        &lt;haspcmcia&gt;
            &lt;match&gt;0&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
        &lt;/haspcmcia&gt;
 	&lt;result&gt;
            &lt;profile&gt;engineering.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
  &lt;/rules&gt;
&lt;/autoinstall&gt;
</screen>
   <para>
    Lorsque vous distribuez le fichier de règles, assurez-vous que le répertoire <filename>rules</filename> se trouve sous le répertoire <filename>profiles</filename> spécifié dans l'URL <filename>autoyast=<replaceable>protocole</replaceable>:<replaceable>ipserveur</replaceable>/profiles/</filename>. AutoYaST recherche d'abord un sous-répertoire <filename>rules</filename> contenant un fichier nommé <filename>rules.xml</filename>, puis charge et fusionne les profils spécifiés dans le fichier de règles.
   </para>
   <para>
    Le reste de la procédure d'installation automatique s'effectue comme d'habitude.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.moreinfo">
  <title>Pour plus d'informations</title>

  <para>

   Pour obtenir des informations détaillées sur la technologie AutoYaST, reportez-vous au manuel <phrase os="sles"><xref linkend="book.autoyast"/> ou </phrase> à la documentation installée avec le logiciel (<filename>/usr/share/doc/packages/autoyast2</filename>).
  </para>
 </sect1>
</chapter>
