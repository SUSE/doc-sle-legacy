<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="depl_smt.xml" id="cha.smt">
 <title>Gestión de suscripciones</title>

 <para>
  Es posible configurar cualquier máquina en la que se ejecute SUSE Linux Enterprise Server 11 o SUSE Linux Enterprise Desktop 11 para que se registre en el servidor de Subscription Management Tool (SMT, herramienta de gestión de suscripciones) local a fin de descargar actualizaciones de software, en lugar de comunicarse directamente con el Centro de servicios al cliente de Novell o con los servidores de NU. Para usar un servidor de SMT para el registro del cliente y como origen de actualización local, primero hay que configurar el servidor de SMT en la red. El software del servidor de SMT se distribuye como producto adicional para SUSE Linux Enterprise Server y su configuración se describe en la <emphasis>Guía de Subscription Management Tool</emphasis>. No es necesario instalar productos adicionales en los clientes que se van a configurar para registrarse en servidores de SMT.
 </para>
 <para>
  Para registrar un cliente en un servidor de SMT, hay que proporcionarle la URL del servidor. El cliente y el servidor se comunican mediante el protocolo HTTPS durante el registro, por lo que también deberá asegurarse de que el cliente confía en el certificado del servidor. Si el servidor de SMT está configurado para usar el certificado de servidor por defecto, el certificado CA estará disponible en el servidor de SMT mediante el protocolo HTTP en <literal>http://<replaceable>nombre_completo</replaceable>/smt.crt</literal>. En este caso, no hay que preocuparse del certificado, ya que el proceso de registro descarga automáticamente el certificado de CA de esa dirección, a no ser que se haya configurado de otra forma. Si el certificado lo ha emitido una autoridad certificadora externa, debe indicar una vía al certificado de CA del servidor.
 </para>
 <note>
  <title>registro en el subdominio <literal>*.novell.com</literal></title>
  <para>
   Si intenta registrarse en un subdominio <literal>*.novell.com</literal>, el certificado no se descargará durante el registro (por razones de seguridad) ni se gestionará. En estos casos, utilice un nombre de dominio distinto o una dirección IP.
  </para>
 </note>
 <para>
  Existen varias formas de proporcionar esta información y de configurar el equipo cliente para usar la SMT. La primera consiste en proporcionar la información necesaria mediante parámetros del núcleo durante el arranque. La segunda es configurar los clientes mediante un perfil de AutoYaST. También hay un guion distribuido con Subscription Management Tool, <command>clientSetup4SMT.sh</command>, que se puede ejecutar en un cliente para registrarlo en un servidor de SMT concreto. Estos métodos se describen en las siguientes secciones:
 </para>
 <sect1 id="smt.client.parameters">
  <title>Uso de parámetros del núcleo para acceder a un servidor de SMT</title>

  <para>
   Es posible configurar cualquier cliente para que use SMT proporcionando los siguientes parámetros del núcleo durante el arranque del equipo: <literal>regurl</literal> y <literal>regcert</literal>. El primer parámetro es obligatorio y el segundo, opcional.
  </para>

  <variablelist>
   <varlistentry>
    <term>regurl</term>
    <listitem>
     <para>
      URL del servidor de SMT. La URL debe tener el siguiente formato: <literal>https://<replaceable>NC</replaceable>/center/regsvc/</literal>, <replaceable>NC</replaceable> es el nombre de host completo del servidor SMT. Debe ser idéntico al nombre completo del certificado de servidor usado en el servidor de SMT. Ejemplo:
     </para>
<screen>regurl=https://smt.example.com/center/regsvc/</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>regcert</term>
    <listitem>
     <para>
      Ubicación del certificado de CA del servidor de SMT. Especifique una de las siguientes ubicaciones:
     </para>
     <variablelist>
      <varlistentry>
       <term>URL</term>
       <listitem>
        <para>
         Ubicación remota (http, https o ftp) desde la que se puede descargar el certificado. Ejemplo:
        </para>
<screen>regcert=http://smt.example.com/smt.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Disquete</term>
       <listitem>
        <para>
         Especifica una ubicación de un disquete. El disquete se debe insertar en el momento del arranque (no se le pedirá que lo inserte si no se detecta). El valor debe comenzar con la cadena <literal>floppy</literal>, seguida de la vía al certificado. Ejemplo:
        </para>
<screen>regcert=floppy/smt/smt-ca.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Vía local</term>
       <listitem>
        <para>
         Vía absoluta al certificado en el equipo local. Ejemplo:
        </para>
<screen>regcert=/data/inst/smt/smt-ca.cert</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Interactivo</term>
       <listitem>
        <para>
         Utilice el valor <literal>ask</literal> para acceder a un menú desplegable durante la instalación, donde podrá especificar la vía al certificado. No use esta opción con AutoYaST. Ejemplo:
        </para>
<screen>regcert=ask</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Desactivar instalación del certificado</term>
       <listitem>
        <para>
         Utilice <literal>done</literal> si el certificado se va a instalar desde un producto adicional o si va a usar un certificado emitido por una autoridad certificadora oficial. Ejemplo:
        </para>
<screen>regcert=done</screen>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>tenga cuidado de no cometer errores tipográficos</title>
   <para>
    Asegúrese de que los valores introducidos sean correctos. Si el parámetro <literal>regurl</literal> no se especifica correctamente, el registro de la actualización fallará.
   </para>
   <para>
    Si se introduce un valor incorrecto para <literal>regcert</literal>, se le solicitará que introduzca una vía local para el certificado. En caso de que no se especifique el parámetro <literal>regcert</literal>, se utilizará por defecto <literal>http://<replaceable>nombre_completo</replaceable>/smt.crt</literal>, donde <literal>nombre_completo</literal> corresponde al nombre del servidor de SMT.
   </para>
  </warning>

  <warning>
   <title>cambio del certificado de servidor de SMT</title>
   <para>
    Si el servidor de SMT obtiene un certificado nuevo de una CA nueva y no confiable, los clientes deben recoger el nuevo archivo de certificado de CA. Esto se hace automáticamente durante el proceso de registro, pero solo si se ha usado una URL en la instalación para recuperar el certificado, o si el parámetro <literal>regcert</literal> se ha omitido y, por lo tanto, se ha usado la URL por defecto. Si el certificado se ha cargado mediante otro método (con un disquete o una vía local, por ejemplo), el certificado de CA no se actualizará.
   </para>
  </warning>
 </sect1>
 <sect1 id="smt.client.autoyast">
  <title>Configuración de clientes mediante un perfil de AutoYaST</title>

  <para>
   El posible configurar los clientes para que se registren en el servidor de SMT mediante un perfil de AutoYaST. Para obtener información general sobre cómo crear perfiles de AutoYaST y preparar la instalación automática, consulte el <xref linkend="cha.deployment.autoinst"/>. En esta sección solo se describe la configuración específica de SMT.
  </para>

  <para>
   Para configurar los datos específicos de SMT mediante AutoYaST, siga estas instrucciones:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Inicie YaST como usuario <systemitem class="username">Root</systemitem> y seleccione <menuchoice> <guimenu>Miscelánea</guimenu> <guimenu>Autoinstalación</guimenu> </menuchoice> para iniciar la interfaz gráfica de AutoYaST.
    </para>
    <para>
     En la línea de comandos inicie la interfaz gráfica de AutoYaST mediante el comando <command>yast2 autoyast</command>.

    </para>
   </step>
   <step performance="required">
    <para>
     Abra un perfil existente con <menuchoice><guimenu>Archivo</guimenu><guimenu>Abrir,</guimenu></menuchoice> cree un perfil basado en la configuración actual del sistema mediante <menuchoice><guimenu>Herramientas</guimenu><guimenu>Crear perfil de referencia</guimenu></menuchoice> o trabaje directamente con un perfil vacío.
    </para>
   </step>
   <step performance="required">
    <para>
     Seleccione <menuchoice><guimenu>Asistencia técnica</guimenu><guimenu>Configuración del Centro de servicios al cliente de Novell.</guimenu></menuchoice> Se muestra una descripción general de la configuración actual.
    </para>
   </step>
   <step performance="required">
    <para>
     Haga clic en <guimenu>Editar.</guimenu>
    </para>
   </step>
   <step performance="required">

    <para>
     Para registrarse automáticamente durante la instalación, seleccione <guimenu>Ejecutar registro del producto.</guimenu> Puede incluir información del sistema con <guimenu>Perfil de hardware</guimenu> e <guimenu>Información opcional.</guimenu>
    </para>
   </step>
   <step performance="required">
    <para>
     Defina la URL de <guimenu>Servidor SMT</guimenu> y, si lo desea, la ubicación del <guimenu>Certificado de SMT.</guimenu> Los valores posibles son los mismos que para los parámetros del núcleo <literal>regurl</literal> y <literal>regcert</literal> (consulte la <xref linkend="smt.client.parameters"/>). La única excepción es que el valor <literal>ask</literal> para <literal>regcert</literal> no funciona en AutoYaST, ya que requiere la intervención del usuario. Si lo usa, el proceso de registro se omitirá.
    </para>
   </step>
   <step performance="required">
    <para>
     Lleve a cabo toda la configuración necesaria para distribuir los sistemas.
    </para>
   </step>
   <step performance="required">
    <para>
     Seleccione <menuchoice> <guimenu>Archivo</guimenu> <guimenu>Guardar como</guimenu> </menuchoice> e introduzca un nombre de archivo para el perfil, por ejemplo, <filename>autoinst.xml</filename>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="smt.client.clientsetupscript">
  <title>Configuración de clientes mediante el guion clientSetup4SMT.sh</title>

  <para>
   El guion <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command> se incluye con SMT. Permite configurar un equipo cliente para que use un servidor de SMT o reconfigurarlo para que use un servidor de SMT distinto.
  </para>

  <para>
   Si desea configurar un equipo cliente con el guion <command>clientSetup4SMT.sh</command> para que use SMT, siga estas instrucciones:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Copie el guion <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename> del servidor de SMT al equipo cliente.
    </para>
   </step>
   <step performance="required">
    <para>
     Ejecute el guion como usuario <systemitem class="username">Root</systemitem> en el equipo cliente. El guion se puede ejecutar de dos formas distintas: La primera consiste en añadir al nombre del guion la URL de registro: <command>/clientSetup4SMT.sh <replaceable>URL_de_registro</replaceable></command>, por ejemplo, <command>./clientSetup4SMT.sh https://smt.example.com/center/regsvc</command>. La segunda forma es añadir al nombre del guión la opción <option>--host</option> seguida del nombre de host del servidor SMT: <command>/clientSetup4SMT.sh --host <replaceable>nombre_de_host_de_servidor</replaceable></command>, por ejemplo, <command>./clientSetup4SMT.sh --host smt.example.com</command>.
    </para>
    
    <important>
     <title>parámetro <option>--host</option></title>
     <para>
      El nombre de host que se debe proporcionar con el parámetro <option>--host</option> tiene que ser el nombre para el que se ha emitido el certificado. Además, si el nombre que aparece en el certificado es el nombre completo del host (por ejemplo, smt.example.com), debe introducirse de forma exacta, ya que si se introduce el nombre <quote>corto</quote> (smt), el guion <command>clientSetup4SMT.sh</command> fallará. 
     </para>
    </important>
    
   </step>
   <step performance="required">
    <para>
     El guion descarga el certificado de CA del servidor. Acéptelo presionando <keycap>y</keycap>.
    </para>
   </step>
   <step performance="required">
    <para>
     El guion efectúa todas las modificaciones necesarias en el cliente. Sin embargo, no lleva a cabo el registro en sí.
    </para>
   </step>
   <step performance="required">
    <para>
     Realice el registro ejecutando <command>suse_register</command> o el módulo <command>yast2 inst_suse_register</command> en el cliente.
    </para>
   </step>
  </procedure>




 </sect1>
 <sect1>
  <title>Registro de clientes en un entorno de pruebas SMT</title>

  <para>
   Para configurar un cliente de modo que se registre en un entorno de pruebas, en lugar de en un entorno de producción, modifique en el archivo <filename>/etc/suseRegister.conf</filename> del equipo cliente el ajuste:
   
   
  </para>

<screen>register = command=register&amp;testenv=1</screen>

  <para>
   Para obtener más información sobre el uso de SMT en un entorno de pruebas, consulte la <emphasis>Guía de Subscription Management Tool</emphasis>.
  </para>
 </sect1>
</chapter>
