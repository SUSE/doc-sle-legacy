<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect1
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="update_split_brain.xml" xml:id="sec-update-split-brain">
 <title>Actualización Atomic</title>

 <para>
  La actualización Atomic se basa en herramientas que gestionan dos copias del sistema y permite recuperarlo fácilmente tras un fallo de actualización. Las herramientas proporcionadas requieren una configuración especial de partición del disco. Cada copia del sistema reside en su propia partición primaria. Si una actualización falla, siempre es posible volver al estado anterior del sistema, que está disponible en la otra partición.
 </para>



 <section xml:id="cha-update-split-brain-setup">
  <title>Configuración</title>
  <warning>
   <title>requisitos estrictos de particionamiento</title>
   <para>
    La implementación se rige por unos estrictos requisitos de particionamiento del disco: la primera partición raíz es <filename>/dev/sda1</filename> y no debe ocupar más de la mitad de todo el tamaño del disco. La herramienta crea entonces <filename>/dev/sda2</filename> para la segunda partición raíz del sistema. Las demás particiones, si las hay, se reparten entre ambas particiones raíces: tienen en cuenta su tamaño y reducen el tamaño de la primera partición en consecuencia. Este es un cálculo aproximado:
   </para>
   <para>
    El tamaño del disco completo menos el tamaño de <systemitem>sda1</systemitem> menos <systemitem>sda2</systemitem> es el espacio libre de las particiones adicionales.
   </para>
  </warning>
  <procedure>
   <step>
    <para>
     Instale el sistema con <filename>/dev/sda1</filename> como única partición raíz y con menos de la mitad del tamaño total del disco.
    </para>
   </step>
   <step>
    <para>
     Personalice el sistema instalado según precise. Asegúrese de que el paquete <systemitem>multi-update-tools</systemitem> está instalado.
    </para>
   </step>
   <step>
    <para>
     Ejecute <command>multi-update-setup --partition</command>, que crea una segunda partición raíz del sistema (<filename>/dev/sda2</filename>) de un tamaño similar.
    </para>
   </step>
   <step>
    <para>
     Particione el resto del disco según precise y continúe con las personalizaciones(*).
    </para>
   </step>
   <step>
    <para>
     Ejecute <command>multi-update-setup --clone</command> para copiar el sistema a la otra partición. Con este comando, también se cambia la entrada <filename>/</filename> (raíz) de <filename>/etc/fstab</filename> del sistema de destino.
    </para>
   </step>
   <step>
    <para>
     Si es necesario, realice las personalizaciones(*) oportunas.
    </para>
   </step>
   <step>
    <para>
     Ejecute <command>multi-update-setup --bootloader</command> para iniciar la configuración del gestor de arranque. El menú del gestor de arranque incluirá una entrada para arrancar el otro sistema.
    </para>
    <warning>
     <title>gestor de arranque GRUB obligatorio</title>
     <para>
      La instalación del gestor de arranque GRUB es obligatoria. Las herramientas no son compatibles con otros gestores.
     </para>
    </warning>
   </step>
   <step>
    <para>
     Si no hay que hacer más personalizaciones (las marcadas con asterisco anteriormente), ejecute <command>multi-update-setup --complete</command> para realizar los tres pasos.
    </para>
   </step>
  </procedure>
 </section>



 <section xml:id="cha-update-split-brain-updating">
  <title>Actualización del otro sistema</title>
  <para>
   Ejecute <command>multi-update</command>. Este comando ejecuta <command>zypper</command> en un entorno <systemitem>chroot</systemitem> y actualiza el otro sistema sin importar cuál de los dos es el activo. Su menú de arranque será el que aparezca al arrancar.
  </para>
 </section>



 <section xml:id="cha-update-split-brain-touble">
  <title>Resolución de problemas</title>
  <para>
   Si el sistema actualizado tiene un gestor de arranque dañado después de la actualización, debe cambiar el indicador <quote>Activo</quote> y definirlo en la partición raíz del otro sistema para poder arrancarlo.
  </para>
  <para>
   Si el sistema actualizado no se arranca de ninguna forma, debe acceder al menú del gestor de arranque para seleccionar el otro sistema.
  </para>
  <para>
   Para obtener más información sobre GRUB, consulte el <xref linkend="cha-grub"/>.
  </para>
 </section>

 <section xml:id="cha-update-split-brain-limitation">
  <title>Limitación</title>
  <para>
   La partición raíz debe montarse según el nombre de partición, el ID o cualquier otro modo. No es posible montarla según el UUID o la etiqueta de la partición.
  </para>
 </section>



 <section xml:id="cha-update-split-brain-info">
  <title>Información adicional</title>
  <para>
   Para obtener más información, consulte <filename>/usr/share/doc/packages/multi-update-tools/README</filename>, que se incluye en el paquete <systemitem>multi-update-tools</systemitem>.
  </para>
 </section>
</section>
