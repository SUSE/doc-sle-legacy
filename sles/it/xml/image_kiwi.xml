<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="image_kiwi.xml" id="cha-kiwi">
 <title>KIWI</title>
 <abstract>
  <para>
   KIWI è un sistema per la creazione di immagini del sistema operativo. Un'immagine è una directory nella quale vi è un file contenente sistema operativo, relative applicazioni e configurazioni, struttura del file system del sistema operativo, eventuali metadati aggiuntivi e, a seconda del tipo di immagine, anche i dati relativi alla geometria del disco e alla tabella delle partizioni. Grazie a KIWI, è possibile creare LiveCD, LiveDVD, pendrive USB, dischi virtuali da riprodurre in sistemi virtuali completi, quali VMware, immagini XEN per paravirtualizzazione in un hypervisor e un ambiente PXE da avviare dalla rete.
  </para>

 </abstract>


 <sect1 id="sec-kiwi-prereq">
  <title>Prerequisiti per KIWI</title>

  <para>
   Per creare immagini con KIWI è necessario soddisfare le seguenti condizioni preliminari:
  </para>

  <orderedlist spacing="normal">
   <listitem>
    <para>
     Spazio libero su disco sufficiente per eseguire l'operazione.
    </para>
   </listitem>
   <listitem>
    <para>
     KIWI è suddiviso in più pacchetti, orientati a differenti tipi di immagine. In ogni caso, sarà necessario il pacchetto <systemitem class="resource">kiwi</systemitem> di base. A seconda dell'immagine di destinazione, saranno necessari i pacchetti seguenti:
    </para>
    <informaltable>
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          Tipo di immagine
         </para>
        </entry>
        <entry>
         <para>
          Nome pacchetto
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          Installazione
         </para>
        </entry>
        <entry>
         <para>
          <systemitem>kiwi-desc-oemboot</systemitem>
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          Virtualizzazione
         </para>
        </entry>
        <entry>
         <para>
          <systemitem>kiwi-desc-xenboot</systemitem>
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          Pendrive USB
         </para>
        </entry>
        <entry>
         <para>
          <systemitem>kiwi-desc-usbboot</systemitem>
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          Client di rete
         </para>
        </entry>
        <entry>
         <para>
          <systemitem>kiwi-desc-netboot</systemitem>
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </listitem>
   <listitem>
    <para>
     Installare il pacchetto <systemitem class="resource">kiwi-doc</systemitem>. Per esempi di struttura e relativi contenuti, sono disponibili configurazioni di esempio.
    </para>
   </listitem>
   <listitem>
    <para>
     Conoscere il file di configurazione di KIWI e la relativa struttura. È basato su uno schema RELAX NG ed è documentato nel pacchetto <systemitem class="resource">kiwi</systemitem> in <filename>/usr/share/doc/packages/kiwi/kiwi.html</filename>. Se si desidera creare da zero il file di configurazione o se si desidera inserire elementi o attributi, sarà necessario questo documento.
    </para>
   </listitem>
  </orderedlist>
 </sect1>
 <sect1 id="sec-kiwi-process">
  <title>Informazioni sul processo di creazione di KIWI</title>

  <para>
   Il processo di creazione di KIWI è diviso in tre passaggi:
  </para>

  <orderedlist spacing="normal">
   <listitem>
    <formalpara>
     <title>Estensione fisica (preparazione)</title>
     <para>
      Questa fase prepara il contenuto del nuovo file system. Durante questo passaggio, viene creata la directory root, si determina quali pacchetti saranno installati nell'immagine e quali file di configurazione dell'utente verranno inclusi.
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>Estensione logica (creazione)</title>
     <para>
      Questa fase richiede la corretta preparazione di un passaggio. Il passaggio di estensione logica crea l'immagine del sistema operativo basata sul primo passaggio.
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>Distribuzione</title>
     <para>
      Il tipo di immagine risultante può essere distribuito con sistemi differenti, quali installazione su disco rigido o riproduzione da parte di un sistema di virtualizzazione (VMware, Qemu, VirtualBox).
     </para>
    </formalpara>
   </listitem>
  </orderedlist>
 </sect1>
 <sect1 id="sec-kiwi-imagedesc">
  <title>Descrizione immagine</title>

  <para>
   Per creare un tipo di immagine, KIWI necessita della descrizione immagine. La descrizione immagine è una directory contenente almeno un file <filename>config.xml</filename> o, in alternativa, un file con estensione <filename>*.kiwi</filename>.
  </para>

  <sect2 id="sec-kiwi-imagedescr-contents">
   <title>Contenuti della descrizione immagine</title>
   <para>
    La tabella seguente contiene informazioni facoltative aggiuntive. Tuttavia, la maggior parte delle informazioni è obbligatoria per la funzionalità del sistema operativo successivo:
   </para>
   <table id="tab-kiwi-imagedesc">
    <title>File e directory aggiuntivi per descrizione immagine</title>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         File/Directory
        </para>
       </entry>
       <entry>
        <para>
         Descrizione
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <filename>config/</filename>
        </para>
       </entry>
       <entry>
        <para>
         sottodirectory facoltativa. Contiene gli script Bash che vengono eseguiti dopo l'installazione di tutti i pacchetti immagine.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>config.sh</filename>
        </para>
       </entry>
       <entry>
        <para>
         script facoltativo di configurazione durante la creazione dell'estensione fisica
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>config.xml</filename>
        </para>
       </entry>
       <entry>
        <para>
         file di configurazione per ciascuna descrizione immagine, spiegato nella <xref linkend="sec-kiwi-config-xml" xrefstyle="select:label"/>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>config-cdroot.tgz</filename>
        </para>
       </entry>
       <entry>
        <para>
         archivio, utilizzato solo per le immagini ISO
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>config-cdroot.sh</filename>
        </para>
       </entry>
       <entry>
        <para>
         manipolazione dati estratti da <filename>config-cdroot.tgz</filename>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>config-yast-autoyast.xml</filename>
        </para>
       </entry>
       <entry>
        <para>
         file di configurazione creato da AutoYaST
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>config-yast-firstboot.xml</filename>
        </para>
       </entry>
       <entry>
        <para>
         file di configurazione per controllare il servizio firstboot di YaST
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>images.sh</filename>
        </para>
       </entry>
       <entry>
        <para>
         script facoltativo di configurazione durante la creazione dei passaggi di preparazione
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <filename>root/</filename>
        </para>
       </entry>
       <entry>
        <para>
         contiene altre directory, file speciali e script che vengono modificati <emphasis>dopo</emphasis> l'installazione di tutti i pacchetti immagine
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 id="sec-kiwi-config-xml">
   <title>Il file <filename>config.xml</filename></title>
   <para>
    Tutte le informazioni relative ad una descrizione immagine sono memorizzate nel file XML centrale di configurazione <filename>config.xml</filename>. Ogni volta che si esegue KIWI, <filename>config.xml</filename> viene convalidato sulla base dello schema RELAX NG. Per ulteriori informazioni sulla lingua di tale schema, vedere <ulink url="http://www.relaxng.org"/>. Pertanto è consigliabile utilizzare un editor XML di buona qualità con supporto RELAX NG o la documentazione relativa allo schema, contenuta nel file HTML <filename>/usr/share/doc/packages/kiwi/schema/kiwi.xsd.html</filename>.
   </para>
   <para>
    Il file di configurazione consiste di più parti:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>

     <para>
      alcune descrizioni relative ad autore, informazioni di contatto e una breve spiegazione.
     </para>
    </listitem>
    <listitem>

     <para>
      opzione di preferenze per la fase di estensione logica.
     </para>
    </listitem>
    <listitem>

     <para>
      informazioni sugli utenti quali nomi, home directory e password.
     </para>
    </listitem>
    <listitem>

     <para>
      collegamenti agli archivi.
     </para>
    </listitem>
    <listitem>

     <para>
      un elenco di pacchetti utilizzati per il tipo di immagine definito.
     </para>
    </listitem>
    <listitem>
     <para>
      altre informazioni di minore importanza, visualizzabili nel file HTML della documentazione dello schema RELAX NG precedente.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Lo skeleton del file è mostrato nell'esempio seguente:
   </para>
   <example id="ex-kiwi-config">
    <title>File di configurazione KIWI</title>
<screen>&lt;image schemeversion="2.0" name="..."&gt; <co id="co-kiwi-config-image"/>
  &lt;description type="system"&gt; <co id="co-kiwi-config-description"/>
    &lt;author&gt;...&lt;/author&gt;
    &lt;contact&gt;...&lt;/contact&gt;
    &lt;specification&gt;...&lt;/specification&gt;
  &lt;/description&gt;
  &lt;preferences&gt; <co id="co-kiwi-config-preferences"/>
    &lt;type primary="true" boot="..." flags="..."&gt;iso&lt;/type&gt;
    &lt;type boot="..." filesystem="ext3" format="vmdk"&gt;vmx&lt;/type&gt;
    &lt;type boot="..." filesystem="ext3"&gt;xen&lt;/type&gt;
    &lt;type boot="..." filesystem="squashfs" flags="unified"&gt;oem&lt;/type&gt;
    &lt;version&gt;2.7.0&lt;/version&gt;
    &lt;size unit="M"&gt;780&lt;/size&gt;
    &lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
    &lt;rpm-check-signatures&gt;False&lt;/rpm-check-signatures&gt;
    &lt;rpm-force&gt;False&lt;/rpm-force&gt;
    &lt;locale&gt;en_US.UTF-8&lt;/locale&gt;
    &lt;oem-swap&gt;no&lt;/oem-swap&gt;
    &lt;oem-boot-title&gt;USB&lt;/oem-boot-title&gt;
  &lt;/preferences&gt;
  &lt;users group="users"&gt; <co id="co-kiwi-config-users"/>
    &lt;user name="root" pwd="" home="/root"/&gt;
  &lt;/users&gt;
  &lt;repository type="rpm-md"&gt; <co id="co-kiwi-config-repository"/>
    &lt;source path="/home/rpmdir"/&gt;
  &lt;/repository&gt;
  &lt;packages type="image" patternPackageType="onlyRequired"&gt; <co id="co-kiwi-config-packages"/>
    &lt;package name="yast2-live-installer"/&gt;
    &lt;package name="pam"/&gt;
    &lt;!-- List of packages reduced --&gt;
  &lt;/packages&gt;</screen>
   </example>
   <calloutlist>
    <callout arearefs="co-kiwi-config-image">
     <para>
      L'elemento radice di ogni file di configurazione KIWI. Ciascun file richiede il numero di versione. Per specificare una revisione SVN di KIWI è possibile utilizzare l'attributo facoltativo <literal>kiwirevision</literal>.
     </para>
    </callout>
    <callout arearefs="co-kiwi-config-description">
     <para>
      Contiene una descrizione obbligatoria con informazioni relative al creatore delle descrizioni di questa immagine, l'indirizzo di contatto e una breve spiegazione.
     </para>
    </callout>

    <callout arearefs="co-kiwi-config-preferences">
     <para>
      Contiene preferenze obbligatorie con informazioni sulla versione di questa immagine, la gestione pacchetto utilizzata, i tipi di immagine supportati e altre impostazioni.
     </para>
    </callout>
    <callout arearefs="co-kiwi-config-users">
     <para>
      L'elemento opzionale <literal>users</literal> contiene un elenco di tutti gli utenti aggiunti all'immagine. L'elemento <literal>user</literal> contiene nome, percorso della home directory, password e shell.
     </para>
    </callout>
    <callout arearefs="co-kiwi-config-repository">
     <para>
      Contiene un elenco obbligatorio di archivi utilizzati dalla gestione pacchetto.
     </para>
    </callout>
    <callout arearefs="co-kiwi-config-packages">
     <para>
      Contiene un elenco obbligatorio di pacchetti inclusi nell'immagine.
     </para>
    </callout>
   </calloutlist>
   <para>
    Ulteriori dettagli sul file di configurazione sono mostrati nella pagina HTML precedente.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec-kiwi-creating">
  <title>Creazione di applicazioni con KIWI</title>

  <para>
   In questa sezione viene descritto come creare applicazioni con KIWI. Un'applicazione è un sistema operativo progettato appositamente per un task specifico. Ad esempio, è possibile creare un'applicazione specializzata in programmi per ufficio.
  </para>

  <sect2 id="sec-kiwi-img-createrepo">
   <title>Creazione di un'origine per l'installazione locale</title>
   <para>
    Tutti gli esempi forniti nei pacchetti <systemitem class="resource">kiwi-doc</systemitem> necessitano di un'origine di installazione valida per creare un'immagine. In genere, gli esempi sono connessi a una risorsa di rete. Maggiore è la larghezza di banda della rete, più rapida sarà la creazione dell'immagine. Se non si dispone di una rete rapida o se non si desidera utilizzarla, creare una risorsa di installazione locale. Procedere come segue:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Raggruppare i DVD di installazione.
     </para>
    </step>
    <step performance="required">
     <para>
      Aprire una shell e diventare <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step performance="required">
     <para>
      Creare la directory di installazione locale. Gli esempi utilizzano in genere il percorso <filename>/image/CDs/full-<replaceable>VERSION</replaceable>-<replaceable>ARCH</replaceable></filename>. Sostituire i segnaposto <replaceable>VERSION</replaceable> e <replaceable>ARCH</replaceable> con i rispettivi valori.
     </para>
    </step>
    <step performance="required">
     <para>
      Montare il supporto. Sostituire il segnaposto <replaceable>DRIVE</replaceable> con il dispositivo corrispondente (in genere, <filename>dvd</filename>, <filename>cdrom</filename> e così via):
     </para>
<screen>mount -o loop /dev/<replaceable>DRIVE</replaceable> /mnt</screen>
    </step>
    <step performance="required">
     <para>
      Copiare l'intero contenuto del supporto nella directory di installazione.
     </para>
<screen>cp -a /mnt/* /images/CDs/full-<replaceable>VERSION</replaceable>-<replaceable>ARCH</replaceable></screen>
    </step>
   </procedure>
   <para>
    Per utilizzare l'origine di installazione locale, è sufficiente abilitarla nell'elemento <literal>repository</literal>:
   </para>
<?dbfo-need height="6em"?>


<screen>&lt;repository type="..."&gt;
  &lt;!-- Remove the comment markers in the next line --&gt;
  &lt;!-- &lt;source path="/image/CDs/full-<replaceable>VERSION</replaceable>-<replaceable>ARCH</replaceable>" --&gt;
  &lt;source path="opensuse://openSUSE:11.0/standard"/&gt; 
&lt;/repository&gt;</screen>
  </sect2>

  <sect2 id="sec-kiwi-img">
   <title>Creazione di un'immagine</title>
   <para>
    Un'immagine è un'immagine di un disco virtuale contenente tutte le partizioni, informazioni su boot loader e pacchetti come se si trovassero su un disco fisico. Per creare un'immagine ISO, procedere come segue:
   </para>
   <procedure id="pr-kiwi-img">

    <step performance="required">
     <para>
      Installare i pacchetti <systemitem class="resource">kiwi</systemitem> e <systemitem class="resource">kiwi-doc</systemitem> e risolvere eventuali dipendenze.
     </para>
    </step>
    <step performance="required">
     <para>
      Aprire una shell e diventare <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step performance="required">
     <para>
      Copiare la directory <filename>/usr/share/doc/packages/kiwi/examples/suse-11.0/suse-oem-preload</filename> nella directory attuale.
     </para>
    </step>
    <step performance="required">
     <para>
      Aprire il file <filename>config.xml</filename> e identificare l'elemento <literal>repository</literal>. Se si desidera utilizzare un'origine locale di installazione, consultare <xref xrefstyle="select: label" linkend="sec-kiwi-img-createrepo"/> per ulteriori informazioni.
     </para>
    </step>
    <step id="st-kiwi-prep" performance="required">
     <para>
      Eseguire KIWI con il comando seguente per preparare la prima fase (<quote>estensione fisica</quote>):
     </para>
<screen>kiwi --prepare suse-oem-preload --root oem</screen>
    </step>
    <step performance="required">
     <para>
      Creare l'immagine ISO:
     </para>
<screen>kiwi --create oem --type iso --destdir /tmp/myoem</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec-kiwi-img-nfs">
   <title>Creazione dell'immagine di precaricamento con NFS</title>
   <para>
    Per creare un'immagine con funzionalità NFS, procedere come segue:
   </para>
   <procedure id="pr-kiwi-img-nfs">
    <step performance="required">
     <para>
      Aprire una shell e diventare <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step performance="required">
     <para>
      Copiare la directory <filename>/usr/share/doc/packages/kiwi/examples/suse-11.1/suse-oem-preload</filename> nella directory attuale.
     </para>
    </step>
    <step performance="required">
     <para>
      Aprire il file <filename>suse-oem-preload/config.xml</filename> e identificare l'elemento <literal>packages</literal> con l'attributo <literal>type="image"</literal>.
     </para>
    </step>
    <step performance="required">
     <para>
      Inserire la riga seguente fra <literal>&lt;packages type="image"&gt;</literal> e <literal>&lt;/packages&gt;</literal> e salvare il file:
     </para>
<screen>&lt;package name="nfs-client"/&gt;</screen>
    </step>
    <step performance="required">
     <para>
      Ricompilare l'immagine come descritto in <xref linkend="st-kiwi-prep"/>.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sec-kiwi-moreinfo">
  <title>Ulteriori informazioni</title>
  <para>
   Ulteriori informazioni sono disponibili nei documenti seguenti sul portale KIWI all'indirizzo <ulink url="http://en.opensuse.org/Portal:KIWI"/>.
  </para>
 </sect1>
</chapter>
