<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="depl_smt.xml" id="cha-smt">
 <title>Gestione delle sottoscrizioni</title>

 <para>
  È possibile configurare qualsiasi computer che esegua SUSE Linux Enterprise Server 11 o SUSE Linux Enterprise Desktop 11 per la registrazione sul server Subscription Management Tool locale in modo da scaricare gli aggiornamenti del software, anziché comunicare direttamente con Novell Customer Center e i server NU. Per utilizzare un server SMT per la registrazione del client e come origine locale per gli aggiornamenti, è necessario prima configurare il server SMT nella rete. Il software del server SMT viene distribuito come componente aggiuntivo per SUSE Linux Enterprise Server e la rispettiva configurazione è descritta nel manuale <emphasis>Subscription Management Tool Guide</emphasis> (Guida relativa a Subscription Management Tool). Non è necessario configurare alcun componente aggiuntivo sui client che devono essere configurati per la registrazione su un server SMT.
 </para>
 <para>
  Per registrare un client su un server SMT, è necessario fornire al client l'URL del server. Dato che client e server comunicano tramite protocollo HTTPS durante la registrazione, è anche necessario accertarsi che il client consideri affidabile il certificato del server. Nel caso in cui il server SMT sia impostato per utilizzare il certificato server di default, il certificato CA sarà disponibile sul server SMT tramite protocollo HTTP in <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>. In questo caso non è necessario preoccuparsi del certificato, perché il processo di registrazione provvede automaticamente ad effettuare il download del certificato CA da tale ubicazione, se non diversamente configurato. È necessario immettere il percorso del certificato CA se il certificato è stato emesso da un'autorità di certificazione.
 </para>
 <note>
  <title>registrazione sul sottodominio <literal>*.novell.com</literal></title>
  <para>
   Se si tenta di eseguire la registrazione sul sottodominio <literal>*.novell.com</literal>, il download del certificato non verrà effettuato durante la registrazione e non verrà effettuata, di conseguenza, la gestione del certificato. In questi casi, è necessario utilizzare un nome di dominio o un indirizzo IP semplice.
  </para>
 </note>
 <para>
  Vi sono vari modi di fornire queste informazioni e di configurare il computer client per l'utilizzo di SMT. Il primo modo consiste nel fornire le informazioni per mezzo dei parametri del kernel all'avvio. Il secondo modo consiste nel configurare i client utilizzando un profilo AutoYaST. È inoltre disponibile lo script <command>clientSetup4SMT.sh</command>, distribuito con Subscription Management Tool, che può essere eseguito su un client per registrarlo su un server SMT specificato. Questi metodi sono descritti nelle sezioni seguenti:
 </para>
 <sect1 id="smt-client-parameters">
  <title>Utilizzo dei parametri kernel per accedere a un server SMT</title>

  <para>
   È possibile configurare qualsiasi client per l'utilizzo di SMT fornendo i parametri kernel <literal>regurl</literal><literal>regcert</literal> durante l'avvio del computer. Il primo parametro è obbligatorio, mentre il secondo è facoltativo.
  </para>

  <variablelist>
   <varlistentry>
    <term>regurl</term>
    <listitem>
     <para>
      URL del server SMT. Il formato dell'URL deve essere il seguente: <literal>https://<replaceable>FQDN</replaceable>/center/regsvc/</literal>, dove <replaceable>FQDN</replaceable> è il nome host completo del server SMT. Questo deve corrispondere al FQDN del certificato server utilizzato dal server SMT. Esempio:
     </para>
<screen>regurl=https://smt.example.com/center/regsvc/</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>regcert</term>
    <listitem>
     <para>
      Ubicazione del certificato CA del server SMT. Specificare una delle ubicazioni seguenti:
     </para>
     <variablelist>
      <varlistentry>
       <term>URL</term>
       <listitem>
        <para>
         Ubicazione remota (http, https o ftp) dalla quale è possibile effettuare il download del certificato. Esempio:
        </para>
<screen>regcert=http://smt.example.com/smt.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Disco floppy</term>
       <listitem>
        <para>
         Specifica un'ubicazione su un disco floppy. Il disco floppy deve essere inserito al momento dell'avvio (se il disco floppy non è presente, non verrà richiesto di inserirlo). Il valore deve iniziare con la stringa <literal>floppy</literal>, seguita dal percorso del certificato. Esempio:
        </para>
<screen>regcert=floppy/smt/smt-ca.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Percorso locale</term>
       <listitem>
        <para>
         Percorso assoluto per il certificato sul computer locale. Esempio:
        </para>
<screen>regcert=/data/inst/smt/smt-ca.cert</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Interattivo</term>
       <listitem>
        <para>
         Utilizzare <literal>ask</literal> per aprire un menu popup durante l'installazione dove specificare il percorso del certificato. Non utilizzare questa opzione con AutoYaST. Esempio:
        </para>
<screen>regcert=ask</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Installazione del certificato di disattivazione</term>
       <listitem>
        <para>
         Utilizzare <literal>done</literal> se il certificato sarà installato da un prodotto aggiuntivo o se si utilizza un certificato fornito da un ente ufficiale di certificazione. Esempio:
        </para>
<screen>regcert=done</screen>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>prestare attenzione agli errori di ortografia</title>
   <para>
    Accertarsi che i valori immessi siano corretti. Se <literal>regurl</literal> non è stato specificato correttamente, la registrazione dell'origine di aggiornamento non riuscirà.
   </para>
   <para>
    Se è stato immesso un valore errato per <literal>regcert</literal>, verrà richiesto un percorso locale per il certificato. Nel caso in cui <literal>regcert</literal> non sia specificato, l'impostazione di default sarà <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>, dove <literal>FQDN</literal> è il nome del server SMT.
   </para>
  </warning>

  <warning>
   <title>modifica del certificato del server SMT</title>
   <para>
    Se il server SMT riceve un nuovo certificato da un CA nuovo e non attendibile, i client devono recuperare il file del certificato del nuovo CA. Questa operazione viene effettuata automaticamente durante il processo di registrazione, ma solo nel caso in cui al momento dell'installazione sia stato usato un URL per recuperare il certificato oppure se il parametro <literal>regcert</literal> è stato omesso ed è quindi stato utilizzato l'URL di default. Se il certificato è stato caricato utilizzando un altro metodo (ad esempio, utilizzando il disco floppy o il percorso locale), il certificato CA non verrà aggiornato.
   </para>
  </warning>
 </sect1>
 <sect1 id="smt-client-autoyast">
  <title>Configurazione dei client con il profilo AutoYaST</title>

  <para>
   I client possono essere configurati in modo da registrarsi con il server SMT tramite profilo AutoYaST. Per informazioni generali sulla creazione di profili AutoYaST e sulla preparazione dell'installazione automatica, fare riferimento al <xref linkend="cha-deployment-autoinst"/>. In questa sezione verrà descritta solo la configurazione specifica SMT.
  </para>

  <para>
   Per configurare i dati specifici per SMT utilizzando AutoYaST, attenersi alla procedura seguente:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Avviare YaST come <systemitem class="username">root</systemitem> e selezionare <menuchoice> <guimenu>Varie</guimenu> <guimenu>Installazione automatica</guimenu> </menuchoice> per avviare il front-end grafico di AutoYaST.
    </para>
    <para>
     Da una riga di comando, è possibile avviare il front-end grafico di AutoYaST utilizzando il comando <command>yast2 autoyast</command>.

    </para>
   </step>
   <step performance="required">
    <para>
     Aprire un profilo esistente utilizzando <menuchoice><guimenu>File</guimenu><guimenu>Apri</guimenu></menuchoice>, creare un profilo basato sulla configurazione corrente del sistema utilizzando <menuchoice><guimenu>Strumenti</guimenu><guimenu>Modifica/crea profilo</guimenu></menuchoice>, o semplicemente lavorare con un profilo vuoto.
    </para>
   </step>
   <step performance="required">
    <para>
     Selezionare <menuchoice><guimenu>Supporto</guimenu><guimenu>Configurazione di Novell Customer Center</guimenu></menuchoice>. Viene visualizzata una panoramica della configurazione corrente.
    </para>
   </step>
   <step performance="required">
    <para>
     Fare clic su <guimenu>Modifica</guimenu>.
    </para>
   </step>
   <step performance="required">

    <para>
     Per eseguire la registrazione durante l'installazione automatica, selezionare <guimenu>Esegui registrazione prodotto</guimenu>. Utilizzando <guimenu>Profilo hardware</guimenu> e <guimenu>Informazioni opzionali</guimenu>, sarà possibile includere informazioni sul sistema.
    </para>
   </step>
   <step performance="required">
    <para>
     Impostare l'URL del <guimenu>server SMT</guimenu> e, facoltativamente, l'ubicazione del <guimenu>certificato SMT</guimenu>. I valori possibili sono gli stessi di quelli per i parametri del kernel, vale a dire <literal>regurl</literal> e <literal>regcert</literal> (vedere <xref linkend="smt-client-parameters"/>). L'unica eccezione è che il valore <literal>ask</literal> per <literal>regcert</literal> non funziona in AutoYaST, perché richiede l'interazione da parte dell'utente. Nel caso venisse utilizzato, il processo di registrazione verrà saltato.
    </para>
   </step>
   <step performance="required">
    <para>
     Eseguire tutte le altre configurazioni necessarie per la distribuzione dei sistemi.
    </para>
   </step>
   <step performance="required">
    <para>
     Selezionare <menuchoice> <guimenu>File</guimenu> <guimenu>Salva con nome</guimenu> </menuchoice> e specificare un nome file per il profilo, ad esempio, <filename>autoinst.xml</filename>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="smt-client-clientsetupscript">
  <title>Configurazione dei client utilizzando lo script clientSetup4SMT.sh</title>

  <para>
   Con SMT viene fornito lo script <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command>. Questo script consente di configurare un computer client in modo da utilizzare un server SMT o di riconfigurarlo per l'utilizzo di un server SMT differente.
  </para>

  <para>
   Per configurare un computer client in modo che utilizzi SMT con lo script <command>clientSetup4SMT.sh</command>, attenersi alla procedura seguente:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Copiare lo script <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename> dal server SMT al computer client.
    </para>
   </step>
   <step performance="required">
    <para>
     Eseguire lo script sul computer client come <systemitem class="username">root</systemitem>. Lo script può essere eseguito in due modi. Nel primo caso, il nome dello script è seguito dall'URL di registrazione <command>./clientSetup4SMT.sh <replaceable>registration_URL</replaceable></command>, ad esempio, <command>./clientSetup4SMT.sh https://smt.example.com/center/regsvc</command>. Nel secondo caso, il nome dello script è seguito dall'opzione <option>--host</option>, seguita a sua volta dal nome host del server SMT: <command>./clientSetup4SMT.sh --host <replaceable>server_hostname</replaceable></command>, ad esempio, <command>./clientSetup4SMT.sh --host smt.example.com</command>.
    </para>
    
    <important>
     <title>il parametro <option>--host</option></title>
     <para>
      Il nome host da fornire con il parametro <option>--host</option> deve essere quello dell'host per cui è stato generato il certificato. Inoltre, se il nome del certificato è il nome host completo (ad esempio smt.example.com), deve essere immesso così com'è. Se si immette il nome <quote>breve</quote> (smt), lo script <command>clientSetup4SMT.sh</command> non riesce. 
     </para>
    </important>
    
   </step>
   <step performance="required">
    <para>
     Lo script effettua il download del certificato CA del server. Accettarlo premendo <keycap>s</keycap>.
    </para>
   </step>
   <step performance="required">
    <para>
     Lo script esegue tutte le modifiche necessarie sul client. Tuttavia la registrazione vera e propria non viene eseguita dallo script.
    </para>
   </step>
   <step performance="required">
    <para>
     Eseguire una registrazione utilizzando <command>suse_register</command> o eseguendo il modulo <command>yast2 inst_suse_register</command> sul client.
    </para>
   </step>
  </procedure>




 </sect1>
 <sect1>
  <title>Registrazione dei client su un ambiente di prova SMT</title>

  <para>
   Per configurare un client da registrare su un ambiente di prova anziché un ambiente di produzione, modificare <filename>/etc/suseRegister.conf</filename> sul computer client impostando:
   
   
  </para>

<screen>register = command=register&amp;testenv=1</screen>

  <para>
   Per ulteriori informazioni sull'utilizzo di SMT con un ambiente di test, fare riferimento alla <emphasis>Subscription Management Tool Guide</emphasis> (Guida relativa a Subscription Management Tool).
  </para>
 </sect1>
</chapter>
