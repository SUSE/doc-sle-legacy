<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="automated_upgrade.xml" id="cha.update.auto" os="sles">
 <title>Upgrade automatico da SUSE Linux Enterprise 11 SP2 a 11 SP3</title>
 <para>
  La procedura seguente è un metodo per eseguire un upgrade di massa automatico da SUSE Linux Enterprise 11 SP2 a SUSE Linux Enterprise 11 SP3. Per creare un profilo AutoYaST appropriato, è necessario effettuare diversi passaggi preparatori, al termine dei quali verrà eseguito il processo di upgrade.
 </para>
 <sect1 id="sec.update.auto.prep_autoyast">
  <title>Preparazione del profilo AutoYaST</title>

  <para>
   Il formato di file utilizzato dal profilo AutoYaST per l'upgrade automatico è lo stesso utilizzato per l'installazione di AutoYaST. <phrase os="sled;sles">Per ulteriori informazioni su AutoYaST, vedere <xref linkend="cha.deployment.autoinst"/> e <xref linkend="book.autoyast"/>.</phrase>
  </para>

  <para>
   Per ovvi motivi, non ha senso configurare alcune parti del sistema (ad esempio le partizioni) durante l'upgrade. Risulta invece utile impostare opzioni specifiche dell'upgrade mediante il profilo AutoYaST.
  </para>

  <sect2>
   <title>Upgrade</title>
   <para>
    Le opzioni dell'upgrade, indicate di seguito, consentono di definire il comportamento del risolutore di dipendenze durante l'upgrade.
   </para>
<screen>&lt;upgrade&gt;
  &lt;only_installed_packages
    config:type="boolean"&gt;false&lt;/only_installed_packages&gt;
  &lt;stop_on_solver_conflict
    config:type="boolean"&gt;true&lt;/stop_on_solver_conflict&gt;
&lt;/upgrade&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>only_installed_packages</literal>
     </term>
     <listitem>
      <para>
       Impostare questa opzione su <literal>true</literal> per gli upgrade basati su pacchetto. Questa impostazione è consigliata per l'upgrade al service pack successivo dello stesso prodotto. Impostare invece l'opzione su <literal>false</literal> per gli upgrade basati su modello. Questa impostazione è consigliata per l'upgrade tra le versioni di un prodotto, ad esempio da SLES10 a SLES11.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>stop_on_solver_conflict</literal>
     </term>
     <listitem>
      <para>
       Consente di definire se deve essere visualizzata la proposta in caso di errore per consentire la risoluzione interattiva delle dipendenze tra pacchetti. È consigliabile impostare questa opzione su <literal>true</literal>, anche se questo valore potrebbe determinare un processo interattivo durante il quale l'utente è costretto a risolvere i conflitti manualmente.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Selezione del software</title>
   <para>
    Le opzioni di selezione del software consentono di definire, oltre ai risultati del Resolver, i componenti da selezionare o deselezionare.
   </para>
<screen>&lt;software&gt;
  &lt;packages config:type="list"&gt;
    &lt;package&gt;autoyast2-installation&lt;/package&gt;
    &lt;package&gt;apparmor-profile-editor&lt;/package&gt;
  &lt;/packages&gt;
  &lt;patterns config:type="list"&gt;
    &lt;pattern&gt;base&lt;/pattern&gt;
  &lt;/patterns&gt;
  &lt;remove-packages config:type="list"/&gt;
  &lt;remove-patterns config:type="list"/&gt;
&lt;/software&gt;</screen>
   <para>
    È molto importante specificare i pacchetti o i modelli da selezionare o deselezionare per risolvere i conflitti relativi ai pacchetti ed evitare l'intervento dell'utente. Al completamento dell'upgrade, il file <filename>autoupg_updated.xml</filename> appena creato include i pacchetti e i modelli specificati, oltre a quelli che sono stati selezionati o deselezionati per altri motivi.
   </para>
  </sect2>

  <sect2>
   <title>Backup prima dell'upgrade</title>
   <para>
    Le opzioni di backup prima dell'upgrade corrispondono alle funzionalità della proposta di upgrade indicate di seguito.
   </para>
<screen>&lt;backup&gt;
  &lt;sysconfig config:type="boolean"&gt;true&lt;/sysconfig&gt;
  &lt;modified config:type="boolean"&gt;true&lt;/modified&gt;
  &lt;remove_old config:type="boolean"&gt;false&lt;/remove_old&gt;
&lt;/backup&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>sysconfig</literal>
     </term>
     <listitem>
      <para>
       consente di definire se deve essere eseguito il backup di sysconfig prima dell'upgrade.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>modified</literal>
     </term>
     <listitem>
      <para>
       consente di definire se deve essere eseguito il backup dei file di configurazione modificati prima dell'upgrade.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>remove_old</literal>
     </term>
     <listitem>
      <para>
       consente di definire se devono essere rimossi i backup obsoleti dagli upgrade precedenti.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 id="sec.update.auto.run">
  <title>Esecuzione dell'upgrade automatico</title>

  <para>
   Per avviare l'upgrade automatico, avviare il supporto di installazione e passare il profilo AutoYaST a tale supporto. È possibile passare il profilo al sistema seguendo una delle due procedure indicate di seguito.
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Passare il profilo alla riga di comando del kernel con la stessa procedura seguita per l'installazione di AutoYaST, ovvero utilizzando il parametro <literal>autoupgrade=1</literal> <filename>autoyast=http://host/path/profile.xml</filename>. Per System z, questa è l'unica possibilità.
    </para>
   </listitem>
   <listitem>
    <para>
     Passare il parametro <literal>autoupgrade=1</literal> alla riga di comando del kernel. Prima di avviare l'upgrade, copiare il profilo in <filename>/root/autoupg.xml</filename>. In questo modo, non sarà necessario aggiungere alcun parametro del kernel.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   La seconda procedura consente di utilizzare un'unica riga di comando del kernel dell'installazione anche in computer diversi. È sufficiente copiare il profilo appropriato nel rispettivo file system.
  </para>

  <para>
   Se nel computer è installato un solo sistema SUSE Linux Enterprise, non si verificano conflitti di pacchetti e il profilo non è stato impostato in modo che venga arrestato alla proposta di upgrade, l'intero processo è non interattivo. Se si immette la proposta di upgrade, è possibile modificare le rispettive impostazioni.
  </para>

  <para>
   Al termine dell'upgrade, viene scritto il file <filename>/root/autoupg-updated.xml</filename>, che include il profilo con le modifiche della selezione applicate dal software effettuate nella proposta. Questa funzionalità risulta particolarmente utile in caso di upgrade di massa di computer in cui sono selezionati gli stessi pacchetti. In questo modo, le risoluzioni dei conflitti di un computer potranno essere facilmente applicate anche ad altri computer, rendendo automatica la risoluzione dei conflitti e non interattivo l'upgrade.
  </para>

  <para>
   Se invece nel computer sono installati più sistemi SUSE Linux Enterprise, verrà sempre richiesto quale sottoporre ad upgrade. Non è necessario selezionare i sistemi in anticipo.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.grub">
  <title>Sezione dei menu di GRUB per l'avvio dell'upgrade</title>

  <para>
   Una procedura alternativa per avviare il sistema consiste nel creare una sezione aggiuntiva nel menu di GRUB (analogamente a quanto accade per altri boot loader e altre architetture), che avvia l'installazione. Nell'esempio che segue si presuppone che esista una partizione <filename>/boot</filename> separata cui si fa riferimento in GRUB con <literal>(hd0,0)</literal>:
  </para>

<screen>title Upgrade
    root (hd0,0)
    kernel /upgrade/linux
    install=<replaceable>inst_source_url</replaceable> autoupgrade=1
    autoyast=<replaceable>autoyast_profile_url</replaceable> vga=0x314
    initrd /upgrade/initrd
  </screen>

  <para>
   Presupposto dell'esempio sopra riportato è che il kernel per l'installazione e l'<systemitem>initrd</systemitem> di installazione si trovino nella directory <filename>/boot/upgrade</filename>.
  </para>

  <para>
   In System z, è necessario aggiungere i parametri al file PARM seguendo la stessa procedura utilizzata per l'esecuzione di un'installazione guidata da AutoYaST.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.2nd-stage">
  <title>Seconda fase dell'upgrade</title>

  <para>
   Per default, durante la seconda fase dell'upgrade automatico non vengono eseguite modifiche della configurazione. L'unica eccezione è costituita dalla configurazione di rete che, per poter essere salvata nel profilo AutoYaST per l'upgrade, deve essere impostata.
  </para>

  <para>
   Se dopo l'upgrade si ha necessità di modificare la configurazione di alcune aree del sistema (ad esempio è necessario configurare un nuovo servizio), aggiungere le sezioni rilevanti al profilo AutoYaST per l'upgrade. In questo modo, durante l'upgrade verrà salvata la configurazione delle aree di sistema selezionate.
  </para>

  <warning>
   <title>La configurazione di AutoYaST specificata sostituisce quella esistente</title>
   <para>
    Si tenga presente che la configurazione esistente dell'area di sistema specifica verrà sostituita e, pertanto, eliminata dalla configurazione di AutoYaST.
   </para>
  </warning>

  <para>
   In genere, l'unica modifica della configurazione che deve essere presente nel profilo AutoYaST è la registrazione del sistema con Subscription Management Tool (SMT) oppure Novell Customer Center (NCC). Se tale modifica non è presente, l'archivio degli aggiornamenti non sarà disponibile e non sarà possibile eseguire gli aggiornamenti, a meno che non venga eseguita nuovamente la configurazione in un momento successivo.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.limitations">
  <title>Limitazioni e suggerimenti</title>

  <para/>

  <sect2>
   <title>NetworkManager e registrazione</title>
   <para>
    Se si utilizza NetworkManager per la gestione dei dispositivi e delle connessioni di rete, la connessione di rete non è disponibile durante la seconda fase dell'upgrade. Questa condizione impedisce la registrazione del sistema.
   </para>
  </sect2>

  <sect2>
   <title>Pulizia delle impostazioni di upgrade</title>
   <para>
    Le modifiche apportate al sistema allo scopo di attivare il processo di upgrade (ad esempio l'aggiunta di una nuova sezione al menu di boot loader) possono essere rimosse al termine dell'upgrade.
   </para>
   <para>
    Questa operazione può essere eseguita automaticamente mediante uno script di post-installazione. Alcuni esempi sono disponibili in <xref linkend="createprofile.scripts"/>. Uno script di esempio che consente la pulizia del file <filename>menu.lst</filename> del GRUB è incluso nel file <filename>autoupg.xml</filename> di esempio. Verificare che lo script corrisponda alla configurazione specifica e che vengano rimosse solo le modifiche che si desidera rimuovere.
   </para>
  </sect2>

  <sect2>
   <title>Ulteriori informazioni</title>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Documentazione relativa a Linuxrc: <ulink url="http://en.opensuse.org/SDB:Linuxrc"/> (in lingua inglese)
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
</chapter>
