<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="automated_upgrade.xml" id="cha.update.auto" os="sles">
 <title>Automatisches Upgrade von SUSE Linux Enterprise 11 SP2 auf 11 SP3</title>
 <para>
  Das nachfolgende Verfahren zeigt, wie ein unbeaufsichtigtes Massenupgrade von SUSE Linux Enterprise 11 SP2 auf SUSE Linux Enterprise 11 SP3 ausgeführt wird. Hierzu sind einige Vorbereitungen erforderlich, um ein geeignetes AutoYaST-Profil zu erstellen. Der Upgradeprozess wird dann von AutoYaST durchgeführt.
 </para>
 <sect1 id="sec.update.auto.prep_autoyast">
  <title>Vorbereiten des AutoYaST-Profils</title>

  <para>
   Das AutoYaST-Profil für das automatische Upgrade verwendet dasselbe Dateiformat wie die AutoYaST-Installation. <phrase os="sled;sles">Weitere Informationen zu AutoYaST erhalten Sie unter <xref linkend="cha.deployment.autoinst"/> und <xref linkend="book.autoyast"/>.</phrase>
  </para>

  <para>
   Aus naheliegenden Gründen ist es jedoch für einige Teile des Systems (z. B. die Partitionierung) nicht sinnvoll, diese während des Upgrades zu konfigurieren. Andererseits ist es nützlich, Upgrade-spezifische Optionen mithilfe des AutoYaST-Profils festzulegen.
  </para>

  <sect2>
   <title>Upgrade</title>
   <para>
    Die Upgradeoptionen definieren das Verhalten bei der Auflösung von Abhängigkeiten:
   </para>
<screen>&lt;upgrade&gt;
  &lt;only_installed_packages
    config:type="boolean"&gt;false&lt;/only_installed_packages&gt;
  &lt;stop_on_solver_conflict
    config:type="boolean"&gt;true&lt;/stop_on_solver_conflict&gt;
&lt;/upgrade&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>only_installed_packages</literal>
     </term>
     <listitem>
      <para>
       Legen Sie für paketbasierte Upgrades <literal>true</literal> fest, (für ein Upgrade auf das nächste Service Pack desselben Produkts empfohlen) oder <literal>false</literal> für schemabasierte Upgrades (für ein Upgrade zwischen Versionen eines Produkts empfohlen, z. B. von SLES10 auf SLES11).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>stop_on_solver_conflict</literal>
     </term>
     <listitem>
      <para>
       Legt fest, ob bei einem Fehler ein Vorschlag angezeigt wird, um Paketabhängigkeiten interaktiv aufzulösen. (Es empfiehlt sich, diese Einstellung auf <literal>true</literal> zu setzen. Dies kann jedoch einen interaktiven Prozess einleiten, bei dem der Benutzer die Konflikte manuell auflösen muss.)
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Software-Auswahl</title>
   <para>
    Die Softwareauswahloptionen definieren, welche Komponenten zusätzlich zu den Ergebnissen des Resolvers ausgewählt werden oder deren Auswahl aufgehoben wird:
   </para>
<screen>&lt;software&gt;
  &lt;packages config:type="list"&gt;
    &lt;package&gt;autoyast2-installation&lt;/package&gt;
    &lt;package&gt;apparmor-profile-editor&lt;/package&gt;
  &lt;/packages&gt;
  &lt;patterns config:type="list"&gt;
    &lt;pattern&gt;base&lt;/pattern&gt;
  &lt;/patterns&gt;
  &lt;remove-packages config:type="list"/&gt;
  &lt;remove-patterns config:type="list"/&gt;
&lt;/software&gt;</screen>
   <para>
    Es ist sehr wichtig, Pakete oder Schemata festzulegen, die ausgewählt werden oder deren Auswahl aufgehoben wird, damit Paketkonflikte aufgelöst und keine interaktiven Aktionen erforderlich werden. Sobald das Upgrade abgeschlossen ist, enthält die neu erstellte Datei <filename>autoupg_updated.xml</filename> diese Pakete und Schemata zusammen mit denen, die ausgewählt oder deren Auswahl aufgehoben wurde.
   </para>
  </sect2>

  <sect2>
   <title>Sicherung vor dem Upgrade</title>
   <para>
    Die Optionen für die Sicherung vor dem Upgrade entsprechen den Funktionen im Upgradevorschlag.
   </para>
<screen>&lt;backup&gt;
  &lt;sysconfig config:type="boolean"&gt;true&lt;/sysconfig&gt;
  &lt;modified config:type="boolean"&gt;true&lt;/modified&gt;
  &lt;remove_old config:type="boolean"&gt;false&lt;/remove_old&gt;
&lt;/backup&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>sysconfig</literal>
     </term>
     <listitem>
      <para>
       definiert, ob sysconfig vor dem Upgrade gesichert wird.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>modified</literal>
     </term>
     <listitem>
      <para>
       definiert, ob die geänderten Konfigurationsdateien vor dem Upgrade gesichert werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>remove_old</literal>
     </term>
     <listitem>
      <para>
       definiert, ob alte Sicherungen vorheriger Upgrades entfernt werden.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 id="sec.update.auto.run">
  <title>Ausführen des automatischen Upgrades</title>

  <para>
   Booten Sie zum Starten des automatischen Upgrades vom Installationsmedium und übergeben Sie ihm das AutoYaST-Profil. Das Profil kann auf zwei Weisen an das System übergeben werden:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Übergeben Sie das Profil in der Kernel-Kommandozeile wie bei der AutoYaST-Installation (verwenden Sie den Parameter <literal>autoupgrade=1</literal> <filename>autoyast=http://host/path/profile.xml</filename>. Für System z ist dies die einzig mögliche Option.
    </para>
   </listitem>
   <listitem>
    <para>
     Übergeben Sie den Parameter <literal>autoupgrade=1</literal> in der Kernel-Kommandozeile. Kopieren Sie, bevor Sie das Upgrade starten, das Profil in <filename>/root/autoupg.xml</filename>. Es sind keine weiteren Kernel-Parameter erforderlich.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Beim letzten Ansatz können Sie eine einzelne Kernel-Kommandozeile für die Installation auf unterschiedlichen Computern verwenden – kopieren Sie einfach das entsprechende Profil in das Dateisystem.
  </para>

  <para>
   Solange Sie nur ein SUSE Linux Enterprise-System auf Ihrem Computer installiert haben, gibt es keine Paketkonflikte. Sofern Sie im Profil nicht festgelegt haben, beim Upgradevorschlag anzuhalten, verläuft der komplette Prozess ohne Interaktion. Sofern Sie den Upgrade-Vorschlag öffnen, können Sie die Einstellungen für das Upgrade ändern.
  </para>

  <para>
   Nach Abschluss des Upgrades schreibt YaST die Datei <filename>/root/autoupg-updated.xml</filename>, die das Profil und die im Vorschlag vorgenommenen Änderungen der Softwareauswahl enthält. Dies ist insbesondere bei Massen-Upgrades von Computern mit derselben Paketauswahl sehr nützlich. Auf diese Weise kann eine Konfliktauflösung auf einem Computer problemlos auf andere Computer angewendet werden, wodurch diese Konflikte automatisch aufgelöst werden und das Upgrade ohne Interaktion verläuft.
  </para>

  <para>
   Wenn auf dem Computer mehrere SUSE Linux Enterprise-Systeme installiert sind, werden Sie immer gefragt, für welches das Upgrade durchgeführt werden soll – es gibt keine Möglichkeit dies im Vorfeld festzulegen.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.grub">
  <title>GRUB- Menübereich für das Booten in das Upgrade</title>

  <para>
   Ein alternatives Verfahren für das Booten des Systems besteht darin, im GRUB-Menü einen zusätzlichen Abschnitt zu erstellen, der die Installation startet. (Dies gilt auch für andere Bootloader und andere Architekturen.) Im folgenden Beispiel existiert eine separate <filename>/boot</filename>-Partition, die in GRUB als <literal>(hd0,0)</literal> referenziert wird:
  </para>

<screen>title Upgrade
    root (hd0,0)
    kernel /upgrade/linux
    install=<replaceable>inst_source_url</replaceable> autoupgrade=1
    autoyast=<replaceable>autoyast_profile_url</replaceable> vga=0x314
    initrd /upgrade/initrd
  </screen>

  <para>
   Der Installationskernel und die Installation <systemitem>initrd</systemitem> befinden sich im Verzeichnis <filename>/boot/upgrade</filename>.
  </para>

  <para>
   Unter System z müssen Sie die Parameter – wie bei einer von AutoYaST gesteuerten Installation – zur PARM-Datei hinzufügen.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.2nd-stage">
  <title>Zweite Phase des Upgrades</title>

  <para>
   Das automatische Upgrade führt während der zweiten Upgradephase standardmäßig keine Konfigurationsänderungen durch. Die einzige Ausnahme bildet die Netzwerkkonfiguration, für die im AutoYaST-Upgradeprofil festgelegt werden muss, dass sie beibehalten werden soll.
  </para>

  <para>
   Sofern für einige Systembereiche nach dem Upgrade Anpassungen der Konfiguration erforderlich sind (z. B. die Konfiguration eines neuen Dienstes), fügen Sie die entsprechenden Abschnitte zum AutoYaST-Profil für das Upgrade hinzu, damit die Konfiguration der ausgewählten Systembereiche während des Upgrades gespeichert wird.
  </para>

  <warning>
   <title>Die mit AutoYaST übergebene Konfiguration ersetzt die vorhandene Konfiguration</title>
   <para>
    Beachten Sie, dass die vorhandene Konfiguration des betroffenen Systembereichs durch die AutoYaST-Konfiguration ersetzt und somit gelöscht wird.
   </para>
  </warning>

  <para>
   Normalerweise ist die einzige Konfigurationsänderung, die sich im AutoYaST-Profil befinden sollte, die Registrierung des Systems im Subscription Management Tool (SMT) oder Novell Customer Center (NCC). Wenn diese nicht vorhanden ist, kann das System nicht auf das Update-Repository zugreifen und es sind keine Aktualisierungen möglich – diese sind dann nur nach einer erneuten Konfiguration möglich.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.limitations">
  <title>Einschränkungen und Tipps</title>

  <para/>

  <sect2>
   <title>NetworkManager und Registrierung</title>
   <para>
    Wenn Sie NetworkManager für die Verwaltung von Netzwerkgeräten und Netzwerkverbindungen nutzen, ist während der zweiten Upgradephase keine Netzwerkverbindung verfügbar. Das System kann daher keine Registrierung durchführen.
   </para>
  </sect2>

  <sect2>
   <title>Bereinigung der Upgrade-Einstellung</title>
   <para>
    Sofern Sie Änderungen an Ihrem System durchführen, um den Upgradevorgang zu starten (z. B. indem Sie einen neuen Abschnitt zum Bootloader-Menü hinzufügen), möchten Sie diese nach dem Upgrade wahrscheinlich wieder entfernen.
   </para>
   <para>
    Dies können Sie mit einem Post-Installationsskript automatisch durchführen. Beispiele finden Sie unter <xref linkend="createprofile.scripts"/>. Ein Beispielskript für die Bereinigung der <filename>menu.lst</filename> für GRUB finden Sie in der Beispieldatei <filename>autoupg.xml</filename>. Stellen Sie sicher, dass das Skript zu Ihren Einstellungen passt und nicht mehr entfernt, als Sie tatsächlich entfernen möchten!
   </para>
  </sect2>

  <sect2>
   <title>Weiterführende Informationen</title>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Linuxrc-Dokumentation: <ulink url="http://en.opensuse.org/SDB:Linuxrc"/>
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
</chapter>
