<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="lvm.xml" id="sec.yast2.system.lvm">
 <title>LVM-Konfiguration</title><indexterm> <primary>YaST</primary> <secondary>LVM</secondary></indexterm><indexterm> <primary>LVM</primary> <secondary>YaST</secondary></indexterm><indexterm> <primary>Logical Volume Manager</primary> <see>LVM</see></indexterm>

 <para>
  Dieser Abschnitt beschreibt kurz die Prinzipien hinter dem Logical Volume Manager (LVM) sowie dessen Mehrzweckfunktionen. In <xref linkend="sec.yast2.system.lvm.yast"/> erfahren Sie, wie LVM mit YaST eingerichtet wird.
 </para>

 <warning>
  <para>
   Der Einsatz von LVM ist manchmal mit einem höheren Risiko (etwa des Datenverlusts) verbunden. Risiken umfassen auch Anwendungsausfälle, Stromausfälle und fehlerhafte Befehle. Speichern Sie Ihre Daten, bevor Sie LVM implementieren oder Volumes neu konfigurieren. Arbeiten Sie nie ohne Backup.
  </para>
 </warning>

 <sect2 id="sec.yast2.system.lvm.explained">
  <title>Der Logical Volume Manager</title>
  <para>
   Der LVM ermöglicht eine flexible Verteilung von Festplattenspeicher über mehrere Dateisysteme. Er wurde entwickelt, da gelegentlich die Segmentierung des Festplattenspeichers geändert werden muss, nachdem die erste Partitionierung abgeschlossen wurde. Da es schwierig ist, Partitionen in einem laufenden System zu ändern, bietet LVM einen virtuellen Pool (Volume-Gruppe, kurz: VG) an Speicherplatz, aus dem bei Bedarf logische Volumes (LVs) erzeugt werden können. Das Betriebssystem greift dann auf diese logischen Volumes statt auf physische Partitionen zu. Volume-Gruppen können sich über mehr als eine Festplatte erstrecken, wobei mehrere Festplatten oder Teile davon eine einzige VG bilden können. Auf diese Weise bietet LVM eine Art Abstraktion vom physischen Festplattenplatz, der eine viel einfachere und sicherere Möglichkeit zur Änderung der Aufteilung ermöglicht als die physische Umpartitionierung. Hintergrundinformationen zum physischen Partitionieren erhalten Sie in <xref linkend="sec.IB.part.typen"/> und <xref linkend="sec.yast2.i_y2_part_expert"/>.
  </para>
  <figure id="fig.lvm.explained.schematic">
   <title>Physische Partitionierung versus LVM</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="lvm.svg" width="75%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="lvm.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   <xref linkend="fig.lvm.explained.schematic"/> stellt die physische Partitionierung (links) der LVM-Segmentierung (rechts) gegenüber. Auf der linken Seite wurde eine einzelne Festplatte in drei physische Partitionen (PART) aufgeteilt, von denen jede einen Einhängepunkt (MP) hat, auf den das Betriebssystem zugreifen kann. Auf der rechten Seite wurden zwei Festplatten in zwei bzw. drei physische Partitionen aufgeteilt. Es wurden zwei LVM-Volume-Gruppen (VG 1 und VG 2) angelegt. VG 1 enthält zwei Partitionen von DISK 1 und eine von DISK 2. VG 2 enthält die restlichen zwei Partitionen von DISK 2. In LVM werden die in einer Volume-Gruppe zusammengefassten physischen Festplattenpartitionen als physische Volumes (PVs) bezeichnet. Innerhalb der Volume-Gruppen sind vier LVs (LV 1 bis LV 4) definiert. Sie können vom Betriebssystem über die verknüpften Einhängepunkte verwendet werden. Die Grenzen zwischen verschiedenen LVs müssen sich nicht mit den Partitionsgrenzen decken. Dies wird in diesem Beispiel durch die Grenze zwischen LV 1 und LV 2 veranschaulicht.
  </para>
  <para>
   LVM-Funktionen:
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Mehrere Festplatten/Partitionen können zu einem großen logischen Volume zusammengefügt werden.
    </para>
   </listitem>
   <listitem>
    <para>
     Neigt sich bei einem LV (z. B. <filename>/usr </filename>) der freie Platz dem Ende zu, können Sie dieses bei geeigneter Konfiguration vergrößern.
    </para>
   </listitem>
   <listitem>
    <para>
     Mit dem LVM können Sie im laufenden System Festplatten oder LVs hinzufügen. Jedoch erfordert dies Hot-Swap-fähige Hardware.
    </para>
   </listitem>
   <listitem>
    <para>
     Es ist möglich, einen „Striping-Modus“ zu aktivieren, der den Datenstrom eines LVs über mehrere PVs verteilt. Wenn sich diese PVs auf unterschiedlichen Platten befinden, wird die Schreib- und Leseleistung verbessert, wie mit RAID 0.
    </para>
   </listitem>
   <listitem>
    <para>
     Die Snapshot-Funktion ermöglicht vor allem bei Servern konsistente Backups des laufenden Systems.
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Mit diesen Funktionen ist LVM jederzeit bereit für stark ausgelastete Heim-PCs oder kleine Server. LVM eignet sich gut für Benutzer mit wachsendem Datenbestand (wie im Fall von Datenbanken, Musikarchiven oder Benutzerverzeichnissen). Dann ist es möglich, Dateisysteme zu haben, die größer sind als eine physische Festplatte. Ein weiterer Vorteil des LVM ist die Möglichkeit, bis zu 256 LVs anlegen zu können. Jedoch unterscheidet sich die Arbeit mit LVM von der Arbeit mit konventionellen Partitionen. Anleitungen und weiterführende Informationen zur Konfiguration des LVM finden Sie im offiziellen LVM-Howto unter <ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"/>.
  </para>
  <para>
   Ab Kernel Version 2.6 steht Ihnen LVM in der Version 2 zur Verfügung. Er ist rückwärtskompatibel zum bisherigen LVM und kann alte Volume-Gruppen weiter verwalten. Wenn Sie neue Volume-Gruppen anlegen, müssen Sie entscheiden, ob Sie das neue Format oder die rückwärtskompatible Version verwenden möchten. LVM 2 benötigt keine Kernel-Patches mehr. Er verwendet die in Kernel 2.6 integrierte Gerätezuordnung. Dieser Kernel unterstützt nur LVM, Version 2. In diesem Abschnitt wird LVM gleichbedeutend mit LVM, Version 2 verwendet.
  </para>
  <sect3>
   <title>Thin Provisioning</title>
   <para>
    Ab Kernel-Version 3.4 unterstützt LVM das Thin Provisioning. Ein Thin-Provisioning-Volume besitzt eine virtuelle Kapazität und eine reelle Kapazität. Die <emphasis>virtuelle</emphasis> Kapazität bezeichnet die Volume-Speicherkapazität, die einem Host zur Verfügung steht. Die <emphasis>reelle</emphasis> Kapazität entspricht der Speicherkapazität, die einer Volume-Kopie aus einem Speicherpool zugewiesen wird. In einem vollständig zugewiesenen Volume sind die virtuelle Kapazität und die reelle Kapazität identisch. Bei einem Thin-Provisioning-Volume kann die virtuelle Kapazität jedoch erheblich größer sein als die reelle Kapazität. Wenn der Speicherplatz auf einem Thin-Provisioning-Volume für einen Schreibvorgang nicht ausreicht, wird das Volume offline geschaltet und ein Fehler wird protokolliert.
   </para>
   <para>
    Allgemeine Informationen finden Sie unter <ulink url="http://wikibon.org/wiki/v/Thin_provisioning"/>.
   </para>
  </sect3>
 </sect2>

 <sect2 id="sec.yast2.system.lvm.yast">
  <title>LVM-Konfiguration mit YaST</title>
  <para>
   Die YaST-LVM-Konfiguration kann vom YaST Expert Partitioner (siehe <xref linkend="sec.yast2.i_y2_part_expert"/>) unter <guimenu>Volume-Verwaltung</guimenu> im Bereich <guimenu>Systemansicht</guimenu> aus erreicht werden. Mit dem Expertenmodus des Partitionierungsmoduls können Sie vorhandene Partitionen bearbeiten und löschen sowie neue Partitionen erstellen, die mit LVM verwendet werden sollen. Als erste Aufgabe müssen PVs erstellt werden, die Platz für eine Volume-Gruppe bieten:
  </para>
  <procedure>
   <step performance="required">
    <para>
     Wählen Sie unter <guimenu>Festplatten</guimenu> eine Festplatte aus.
    </para>
   </step>
   <step performance="required">
    <para>
     Wechseln Sie in den Karteireiter <guimenu>Partitionen</guimenu>.
    </para>
   </step>
   <step performance="required">
    <para>
     Klicken Sie auf <guimenu>Hinzufügen</guimenu> und geben Sie die gewünschte Größe des PV auf dieser Platte ein.
    </para>
   </step>
   <step performance="required">
    <para>
     Verwenden Sie <guimenu>Do not Format Partition</guimenu> (Partition nicht formatieren) und ändern Sie die <guimenu>Dateisystem-ID</guimenu> in <guimenu>0x8E Linux LVM</guimenu>. Hängen Sie diese Partition nicht ein.
    </para>
   </step>
   <step performance="required">
    <para>
     Wiederholen Sie diesen Vorgang, bis alle gewünschten physischen Volumes auf den verfügbaren Platten definiert sind.
    </para>
   </step>
  </procedure>
  <sect3>
   <title>Erstellen von Volume-Gruppen</title>
   <para>
    Wenn auf Ihrem System keine Volume-Gruppe existiert, müssen Sie eine hinzufügen (siehe <xref linkend="fig.lvm.yast.volgrp"/>). Sie können zusätzliche Gruppen erstellen, indem Sie auf <guimenu>Volume-Verwaltung</guimenu> im Bereich <guimenu>Systemansicht</guimenu> und anschließend auf <guimenu>Volume-Gruppe hinzufügen</guimenu> klicken. Eine einzige Volume-Gruppe genügt in der Regel.
   </para>
   <procedure>
    <step performance="required">
     <para>
      Geben Sie einen Namen für die VG ein, z. B. <literal>System</literal>.
     </para>
    </step>
    <step performance="required">
     <para>
      Wählen Sie die gewünschte <guimenu>Größe (Physical Extent Size)</guimenu>. Dieser Wert definiert die Größe eines physischen Blocks in der Volume-Gruppe. Der gesamte Plattenplatz in einer Volume-Gruppe wird in Blöcken dieser Größe verwaltet.
     </para>
    </step>
    <step performance="required">
     <para>
      Fügen Sie der VG die vorbereiteten PVs hinzu, indem Sie das Gerät auswählen und auf <guimenu>Hinzufügen</guimenu> klicken. Die Auswahl mehrerer Geräte ist möglich, wenn Sie die <keycap>Strg</keycap>-Taste gedrückt halten, während Sie auf die gewünschten Geräte klicken.
     </para>
    </step>
    <step performance="required">
     <para>
      Wählen Sie <guimenu>Beenden</guimenu>, um die VG für weitere Konfigurationsschritte bereitzustellen.
     </para>
    </step>
   </procedure>
   <figure id="fig.lvm.yast.volgrp">
    <title>Anlegen einer Volume-Gruppe</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Wenn mehrere Volume-Gruppen definiert sind und PVs hinzugefügt oder entfernt werden sollen, wählen Sie die Volume-Gruppe in der Liste <guimenu>Volume-Verwaltung</guimenu> aus und klicken Sie auf <guimenu>Größe ändern</guimenu>. Im folgenden Fenster können Sie der ausgewählten Volume-Gruppe PVs hinzufügen oder sie daraus entfernen.
   </para>
  </sect3>
  <sect3>
   <title>Konfigurieren von logischen Volumes</title>
   <para>
    Nachdem die Volume-Gruppe mit PVs gefüllt ist, definieren Sie im nächsten Dialogfeld die LVs, die das Betriebssystem verwenden soll. Wählen Sie die aktuelle Volume-Gruppe aus und wechseln Sie zum Karteireiter <guimenu>Logische Volumes</guimenu>. Sie können nach Bedarf LVs mithilfe der entsprechenden Schaltflächen <guimenu>Hinzufügen</guimenu>, <guimenu>Bearbeiten</guimenu>, ihre <guimenu>Größe ändern</guimenu> und sie <guimenu>Löschen</guimenu>, bis der Platz in der Volume-Gruppe verbraucht ist. Weisen Sie jeder Volume-Gruppe mindestens ein LV zu.
   </para>
   <figure id="fig.lvm.yast.mgmt">
    <title>Verwaltung der logischen Volumes</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Klicken Sie auf <guimenu>Hinzufügen</guimenu> und führen Sie die Anweisungen im Assistenten-ähnlichen Pop-up-Fenster aus, das geöffnet wird:
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      Geben Sie den Namen des LV ein. Für eine Partition, die auf <filename>/home</filename> eingehängt werden soll, kann ein selbsterklärender Name wie <literal>HOME</literal> verwendet werden.
     </para>
    </listitem>
    <listitem>
     <para>
      Wählen Sie den Typ des LV aus. Zur Wahl stehen <guimenu>Normal Volume</guimenu>, <guimenu>Thin Pool</guimenu> und <guimenu>Thin Volume</guimenu>. Sie müssen zunächst einen Thin Pool erstellen, in dem dann die einzelnen Thin Volumes gespeichert werden können.
     </para>
    </listitem>
    <listitem>
     <para>
      Wählen Sie die Größe und Anzahl der Stripes für das LV. Wenn Sie nur ein PV haben, ist es nicht sinnvoll, mehrere Stripes auszuwählen.
     </para>
     <tip>
      <para>
       Das Thin Provisioning bietet den großen Vorteil, dass die Summe aller in einem Thin-Pool gespeicherten Thin-Volumes die Größe des Pools selbst übersteigen kann.
      </para>
     </tip>
    </listitem>
    <listitem>
     <para>
      Wählen Sie das Dateisystem, das auf dem LV und auf dem Einhängepunkt verwendet werden soll.
     </para>
    </listitem>
   </orderedlist>
   <para>
    Durch die Verwendung von Stripes ist es möglich, den Datenstrom im LV auf mehrere PVs aufzuteilen (Striping). Das Striping eines Volumes kann nur über unterschiedliche PVs erfolgen, von denen jedes mindestens den Speicherplatz des Volumes besitzt. Die maximale Anzahl der Stripes entspricht der Anzahl der PVs, wobei Stripe „1“ für „no striping“ (kein Striping) steht. Das Striping ist nur mit PVs sinnvoll, die sich auf unterschiedlichen Festplatten befinden. Andernfalls verschlechtert sich die Leistung.
   </para>
   <warning>
    <title>Striping</title>
    <para>
     YaST kann in Bezug auf Striping die Richtigkeit Ihrer Einträge nicht überprüfen. Fehler an dieser Stelle können erst festgestellt werden, wenn LVM auf der Festplatte in Betrieb genommen wird.
    </para>
   </warning>
   <para>
    Falls Sie auf Ihrem System LVM bereits konfiguriert haben, können Sie auch die vorhandenen logischen Volumes verwenden. Bevor Sie fortfahren, weisen Sie diesen LVs passende Einhängepunkte zu. Klicken Sie auf <guimenu>Fertig stellen</guimenu>, um in den YaST Expert Partitioner zurückzukehren und Ihre Arbeit dort abzuschließen.
   </para>
  </sect3>
 </sect2>


</sect1>
