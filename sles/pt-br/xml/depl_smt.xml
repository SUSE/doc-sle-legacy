<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="depl_smt.xml" id="cha.smt">
 <title>Gerenciamento de assinaturas</title>

 <para>
  Qualquer máquina com o SUSE Linux Enterprise Server 11 ou o SUSE Linux Enterprise Desktop 11 pode ser configurada para registro no servidor SMT (Subscription Management Tool) local para fazer download de atualizações de software, em vez de se comunicar diretamente com os servidores Novell Customer Center e NU. Para usar um servidor SMT para registro do cliente e como fonte de atualização local, configure o servidor SMT em sua rede primeiro. O software do servidor SMT é distribuído como um complemento ao SUSE Linux Enterprise Server e sua configuração está descrita no <emphasis>Guia do SMT (Subscription Management Tool)</emphasis>. Não há necessidade de instalar nenhum complemento nos clientes a serem configurados para registro no servidor SMT.
 </para>
 <para>
  Para registrar um cliente em um servidor SMT, você precisa equipá-lo com o URL do servidor. Como o cliente e o servidor se comunicam via protocolo HTTPS durante o registro, você também precisará verificar se o cliente confia no certificado do servidor. Caso seu servidor SMT esteja configurado para usar a certificação do servidor padrão, o certificado de CA estará disponível no servidor SMT pelo protocolo HTTP em <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>. Nesse caso, você não precisa se preocupar com o certificado: o processo de registro fará download automaticamente do certificado de CA do local mencionado, exceto se configurado de outra forma. Digite um caminho para o certificado de CA do servidor, caso o certificado tenha sido emitido por uma autoridade de certificação externa.
 </para>
 <note>
  <title>Registrando no subdomínio <literal>*.novell.com</literal></title>
  <para>
   Se você tentar se registrar em qualquer subdomínio <literal>*.novell.com</literal>, o certificado não será descarregado durante o registro (por motivos de segurança), e o processo de certificado não será feito. Nesses casos, use um nome de domínio diferente ou um endereço IP simples.
  </para>
 </note>
 <para>
  Há várias maneiras de fornecer essa informação e de configurar a máquina cliente para usar SMT. A primeira maneira consiste em fornecer as informações necessárias através de parâmetros de kernel no momento do boot. A segunda maneira consiste em configurar clientes usando um perfil do AutoYaST. Há também um script distribuído com o SMT (Subscription Management Tool), <command>clientSetup4SMT.sh</command>, que pode ser executado em um cliente para que ele se registre no servidor SMT especificado. Esses métodos são descritos nas seções seguintes:
 </para>
 <sect1 id="smt.client.parameters">
  <title>Usando parâmetros de kernel para acessar um servidor SMT</title>

  <para>
   Qualquer cliente pode ser configurado para usar SMT, desde que os seguintes parâmetros de kernel sejam fornecidos durante a inicialização da máquina: <literal>regurl</literal> e <literal>regcert</literal>. O primeiro parâmetro é obrigatório, e o último é opcional.
  </para>

  <variablelist>
   <varlistentry>
    <term>regurl</term>
    <listitem>
     <para>
      URL do servidor SMT. O URL precisa estar no seguinte formato: <literal>https://<replaceable>FQDN</replaceable>/center/regsvc/</literal>, em que <replaceable>FQDN</replaceable> é o nome completo do host do servidor SMT. Ele deve ser idêntico ao FQDN da certificação do servidor usada no servidor SMT. Exemplo:
     </para>
<screen>regurl=https://smt.example.com/center/regsvc/</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>regcert</term>
    <listitem>
     <para>
      Local do certificado de CA do servidor SMT. Especifique um dos seguintes locais:
     </para>
     <variablelist>
      <varlistentry>
       <term>URL</term>
       <listitem>
        <para>
         Local remoto (http, https ou ftp) a partir do qual pode ser feito download do certificado. Exemplo:
        </para>
<screen>regcert=http://smt.example.com/smt.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Disquete</term>
       <listitem>
        <para>
         Especifica um local em um disquete. O disquete deve ser inserido na hora do boot (não será solicitado que você o insira se ele estiver ausente). O valor deve começar com a string <literal>floppy</literal>, seguida do caminho para o certificado. Exemplo:
        </para>
<screen>regcert=floppy/smt/smt-ca.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Caminho Local</term>
       <listitem>
        <para>
         Caminho absoluto do certificado na máquina local. Exemplo:
        </para>
<screen>regcert=/data/inst/smt/smt-ca.cert</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Interativo</term>
       <listitem>
        <para>
         Use <literal>ask</literal> para abrir um menu popup durante a instalação no qual você poderá especificar o caminho do certificado. Não use esta opção com AutoYaST. Exemplo:
        </para>
<screen>regcert=ask</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Desativar a instalação do certificado</term>
       <listitem>
        <para>
         Use <literal>done</literal> se o certificado for instalado por um produto complementar ou se você estiver usando um certificado emitido por uma autoridade de certificação oficial. Exemplo:
        </para>
<screen>regcert=done</screen>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>Tome cuidado com erros de digitação</title>
   <para>
    Verifique se os valores digitados estão corretos. Se <literal>regurl</literal> não tiver sido especificado corretamente, o registro da fonte de atualização falhará.
   </para>
   <para>
    Se um valor incorreto tiver sido digitado para <literal>regcert</literal>, você será solicitado a fornecer um caminho local para o certificado. Caso <literal>regcert</literal> não seja especificado, ele assumirá como padrão <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>, sendo <literal>FQDN</literal> o nome do servidor SMT.
   </para>
  </warning>

  <warning>
   <title>Mudança de certificação do servidor SMT</title>
   <para>
    Se o servidor SMT obtiver um novo certificado de um novo CA não confiável, o cliente precisará buscar o novo arquivo de certificado de CA. Isso é feito automaticamente com o processo de registro, mas apenas se um URL foi usado na hora da instalação para recuperar o certificado, ou se o parâmetro <literal>regcert</literal> foi omitido e, portanto, o URL padrão foi usado. Se o certificado foi carregado usando qualquer outro método (como disquete ou caminho local), o certificado de CA não será atualizado.
   </para>
  </warning>
 </sect1>
 <sect1 id="smt.client.autoyast">
  <title>Configurando clientes com o perfil do AutoYaST</title>

  <para>
   É possível configurar os clientes para se registrarem no servidor SMT pelo perfil do AutoYaST. Para obter informações gerais sobre como criar perfis do AutoYaST e preparar a instalação automática, consulte o <xref linkend="cha.deployment.autoinst"/>. Nesta seção, apenas a configuração específica do SMT está descrita.
  </para>

  <para>
   Para configurar dados específicos do SMT usando o AutoYaST, siga estas etapas:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Como <systemitem class="username">root</systemitem>, inicie o YaST e selecione <menuchoice> <guimenu>Diversos</guimenu> <guimenu>Instalação automática</guimenu> </menuchoice> para iniciar o front end gráfico do AutoYaST.
    </para>
    <para>
     Em uma linha de comando, você pode iniciar o front end gráfico do AutoYaST com o comando <command>yast2 autoyast</command>.

    </para>
   </step>
   <step performance="required">
    <para>
     Abra um perfil existente usando <menuchoice><guimenu>Arquivo</guimenu><guimenu>Abrir</guimenu></menuchoice>, crie um perfil com base na configuração do sistema atual usando <menuchoice><guimenu>Ferramentas</guimenu><guimenu>Criar Perfil de Referência</guimenu></menuchoice> ou trabalhe simplesmente com um perfil vazio.
    </para>
   </step>
   <step performance="required">
    <para>
     Selecione <menuchoice><guimenu>Suporte</guimenu><guimenu>Configuração do Novell Customer Center</guimenu></menuchoice>. Uma visão geral da configuração atual é mostrada.
    </para>
   </step>
   <step performance="required">
    <para>
     Clique em <guimenu>Editar</guimenu>.
    </para>
   </step>
   <step performance="required">

    <para>
     Para se registrar durante a instalação automática, selecione <guimenu>Executar Registro do Produto</guimenu>. Você poderá incluir informações do seu sistema com <guimenu>Perfil de Hardware</guimenu> e <guimenu>Informações Opcionais</guimenu>.
    </para>
   </step>
   <step performance="required">
    <para>
     Defina o URL do <guimenu>Servidor SMT</guimenu> e, opcionalmente, o local do <guimenu>Certificado SMT</guimenu>. Os valores possíveis são os mesmos dos parâmetros de kernel <literal>regurl</literal> e <literal>regcert</literal> (consulte a <xref linkend="smt.client.parameters"/>). A única exceção é que o valor <literal>ask</literal> de <literal>regcert</literal> não funciona no AutoYaST, pois ele requer interação do usuário. Se você for usá-lo, o processo de registro será ignorado.
    </para>
   </step>
   <step performance="required">
    <para>
     Execute todas as outras configurações necessárias para os sistemas a serem implantados.
    </para>
   </step>
   <step performance="required">
    <para>
     Selecione <menuchoice> <guimenu>Arquivo</guimenu> <guimenu>Gravar Como</guimenu> </menuchoice> e digite um nome de arquivo para o perfil, por exemplo, <filename>autoinst.xml</filename>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="smt.client.clientsetupscript">
  <title>Configurando clientes com o script clientSetup4SMT.sh</title>

  <para>
   O script <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command> está incluído no SMT. Esse script também permite configurar uma máquina cliente para usar um servidor SMT ou reconfigurá-la para usar um servidor SMT diferente.
  </para>

  <para>
   Para configurar uma máquina cliente para usar SMT com o script <command>clientSetup4SMT.sh</command>, siga estas etapas:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Copie o script <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename> do servidor SMT para a máquina cliente.
    </para>
   </step>
   <step performance="required">
    <para>
     Como <systemitem class="username">root</systemitem>, execute o script na máquina cliente. O script pode ser executado de duas maneiras. No primeiro caso, o nome do script é seguido do URL do registro: <command>./clientSetup4SMT.sh <replaceable>URL_do_registro</replaceable></command>, por exemplo, <command>./clientSetup4SMT.sh https://smt.example.com/center/regsvc</command>. No segundo caso, o nome do script é seguido da opção <option>--host</option> e do nome de host do servidor SMT: <command>./clientSetup4SMT.sh --host <replaceable>nome_de_host_do_servidor</replaceable></command>, por exemplo, <command>./clientSetup4SMT.sh --host smt.example.com</command>.
    </para>
    
    <important>
     <title>O parâmetro <option>--host</option></title>
     <para>
      O nome de host que precisa ser informado com o parâmetro <option>--host</option> deve ser o mesmo nome para o qual o certificado foi emitido. Além disso, se o nome no certificado for o nome completo do host (por exemplo, smt.example.com), ele deverá ser informado apropriadamente. Informar o nome <quote>abreviado</quote> (smt) provoca falha no script <command>clientSetup4SMT.sh</command>. 
     </para>
    </important>
    
   </step>
   <step performance="required">
    <para>
     O script faz download do certificado de CA do servidor. Aceite-o pressionando <keycap>y</keycap>.
    </para>
   </step>
   <step performance="required">
    <para>
     O script executa todas as modificações necessárias no cliente. Entretanto, o próprio registro não é executado pelo script.
    </para>
   </step>
   <step performance="required">
    <para>
     Faça um registro executando <command>suse_register</command> ou o módulo <command>yast2 inst_suse_register</command> no cliente.
    </para>
   </step>
  </procedure>




 </sect1>
 <sect1>
  <title>Registrando clientes em um ambiente de teste do SMT</title>

  <para>
   Para configurar um cliente para se registrar no ambiente de teste, e não no ambiente de produção, modifique <filename>/etc/suseRegister.conf</filename> na máquina cliente, definindo:
   
   
  </para>

<screen>register = command=register&amp;testenv=1</screen>

  <para>
   Para obter mais informações sobre como usar o SMT com um ambiente de teste, consulte o <emphasis>Guia do SMT (Subscription Management Tool)</emphasis>.
  </para>
 </sect1>
</chapter>
