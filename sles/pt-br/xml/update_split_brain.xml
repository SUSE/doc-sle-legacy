<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect1
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="update_split_brain.xml" xml:id="sec-update-split-brain">
 <title>Atualização Atomic</title>

 <para>
  A Atualização Atomic é baseada em ferramentas que gerenciam duas cópias do sistema e permitem recuperação fácil após uma falha na atualização. As ferramentas fornecidas exigem configuração especial da partição de disco. Cada cópia do sistema reside em uma partição principal que lhe pertence. Se uma atualização falhar, sempre é possível retornar ao estado anterior do sistema, que está disponível na outra partição.
 </para>



 <section xml:id="cha-update-split-brain-setup">
  <title>Configuração</title>
  <warning>
   <title>Requisitos de particionamento estritos</title>
   <para>
    A implementação tem requisitos estritos para particionamento de disco: a primeira partição root é <filename>/dev/sda1</filename> e não deve ocupar mais da metade do tamanho total do disco. As ferramentas criam <filename>/dev/sda2</filename> para a segunda partição root do sistema. Mais partições, se disponíveis, são compartilhadas em ambas as partições raiz, leve seu tamanho em consideração e reduza o tamanho da primeira partição de acordo. Veja este cálculo simples:
   </para>
   <para>
    O tamanho de todo o disco menos o tamanho de <systemitem>sda1</systemitem> menos <systemitem>sda2</systemitem> resulta no espaço livre das partições adicionais.
   </para>
  </warning>
  <procedure>
   <step>
    <para>
     Instale o sistema com <filename>/dev/sda1</filename> como a partição root única e com menos da metade do tamanho total do disco.
    </para>
   </step>
   <step>
    <para>
     Personalize o sistema instalado conforme necessário. Verifique se o pacote <systemitem>multi-update-tools</systemitem> está instalado.
    </para>
   </step>
   <step>
    <para>
     Execute <command>multi-update-setup --partition</command>, que cria a segunda partição root do sistema (<filename>/dev/sda2</filename>) de tamanho semelhante.
    </para>
   </step>
   <step>
    <para>
     Particione o restante do disco conforme necessário e continue com as personalizações (*).
    </para>
   </step>
   <step>
    <para>
     Execute <command>multi-update-setup --clone</command> para copiar o sistema para a outra partição. Com esse comando, é possível mudar a entrada <filename>/</filename> (root) em <filename>/etc/fstab</filename> do sistema de destino.
    </para>
   </step>
   <step>
    <para>
     Se necessário, faça mais personalizações (*).
    </para>
   </step>
   <step>
    <para>
     Execute <command>multi-update-setup --bootloader</command> para inicializar a configuração do carregador de boot. O menu do carregador de boot inclui uma entrada para inicializar o outro sistema.
    </para>
    <warning>
     <title>Carregador de boot GRUB obrigatório</title>
     <para>
      A instalação do carregador de boot GRUB é obrigatória. As ferramentas não são compatíveis com outros carregadores de boot.
     </para>
    </warning>
   </step>
   <step>
    <para>
     Se não há personalizações a serem feitas marcadas com (*), execute <command>multi-update-setup --complete</command>, que realiza todas as três etapas.
    </para>
   </step>
  </procedure>
 </section>



 <section xml:id="cha-update-split-brain-updating">
  <title>Atualizando o outro sistema</title>
  <para>
   Execute <command>multi-update</command>. Esse comando executa o <command>zypper</command> em um ambiente <systemitem>chroot</systemitem> e atualiza o outro sistema, não importa qual é o ativo. Seu menu de boot será oferecido como o padrão na hora do boot.
  </para>
 </section>



 <section xml:id="cha-update-split-brain-touble">
  <title>Troubleshooting Guides (inglês somente)</title>
  <para>
   Se o sistema atualizado tiver o carregador de boot danificado após a atualização, mude o flag <quote>Ativo</quote> e defina-o como a partição raiz do outro sistema para inicializá-lo.
  </para>
  <para>
   Se o sistema atualizado não for inicializado de forma alguma, você precisará de acesso ao menu do carregador de boot para selecionar o outro sistema.
  </para>
  <para>
   Para obter mais informações sobre GRUB, consulte o <xref linkend="cha-grub"/>.
  </para>
 </section>

 <section xml:id="cha-update-split-brain-limitation">
  <title>Limitação</title>
  <para>
   A partição raiz deve ser montada pelo nome ou ID da partição, ou de alguma outra forma. Não é suportado montar por UUID ou por rótulo da partição.
  </para>
 </section>



 <section xml:id="cha-update-split-brain-info">
  <title>Para obter mais informações</title>
  <para>
   Para obter mais informações, consulte o <filename>/usr/share/doc/packages/multi-update-tools/README</filename> que acompanha o pacote <systemitem>multi-update-tools</systemitem>.
  </para>
 </section>
</section>
