<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="update_split_brain.xml" id="sec.update.split-brain">
 <title>Atualização Atomic</title>

 <para>
  A Atualização Atomic é baseada em ferramentas que gerenciam duas cópias do sistema e permitem recuperação fácil após uma falha na atualização. As ferramentas fornecidas exigem configuração especial da partição de disco. Cada cópia do sistema reside em uma partição principal que lhe pertence. Se uma atualização falhar, sempre é possível retornar ao estado anterior do sistema, que está disponível na outra partição.
 </para>



 <sect2 id="cha.update.split-brain.setup">
  <title>Configuração</title>
  <warning>
   <title>Requisitos de particionamento estritos</title>
   <para>
    A implementação tem requisitos estritos para particionamento de disco: a primeira partição root é <filename>/dev/sda1</filename> e não deve ocupar mais da metade do tamanho total do disco. As ferramentas criam <filename>/dev/sda2</filename> para a segunda partição root do sistema. Mais partições, se disponíveis, são compartilhadas em ambas as partições raiz, leve seu tamanho em consideração e reduza o tamanho da primeira partição de acordo. Veja este cálculo simples:
   </para>
   <para>
    O tamanho de todo o disco menos o tamanho de <systemitem>sda1</systemitem> menos <systemitem>sda2</systemitem> resulta no espaço livre das partições adicionais.
   </para>
  </warning>
  <procedure>
   <step performance="required">
    <para>
     Instale o sistema com <filename>/dev/sda1</filename> como a partição root única e com menos da metade do tamanho total do disco.
    </para>
   </step>
   <step performance="required">
    <para>
     Personalize o sistema instalado conforme necessário. Verifique se o pacote <systemitem>multi-update-tools</systemitem> está instalado.
    </para>
   </step>
   <step performance="required">
    <para>
     Execute <command>multi-update-setup --partition</command>, que cria a segunda partição root do sistema (<filename>/dev/sda2</filename>) de tamanho semelhante.
    </para>
   </step>
   <step performance="required">
    <para>
     Particione o restante do disco conforme necessário e continue com as personalizações (*).
    </para>
   </step>
   <step performance="required">
    <para>
     Execute <command>multi-update-setup --clone</command> para copiar o sistema para a outra partição. Com esse comando, é possível mudar a entrada <filename>/</filename> (root) em <filename>/etc/fstab</filename> do sistema de destino.
    </para>
   </step>
   <step performance="required">
    <para>
     Se necessário, faça mais personalizações (*).
    </para>
   </step>
   <step performance="required">
    <para>
     Execute <command>multi-update-setup --bootloader</command> para inicializar a configuração do carregador de boot. O menu do carregador de boot inclui uma entrada para inicializar o outro sistema.
    </para>
    <warning>
     <title>Carregador de boot GRUB obrigatório</title>
     <para>
      A instalação do carregador de boot GRUB é obrigatória. As ferramentas não são compatíveis com outros carregadores de boot.
     </para>
    </warning>
   </step>
   <step performance="required">
    <para>
     Se não há personalizações a serem feitas marcadas com (*), execute <command>multi-update-setup --complete</command>, que realiza todas as três etapas.
    </para>
   </step>
  </procedure>
 </sect2>



 <sect2 id="cha.update.split-brain.updating">
  <title>Atualizando o outro sistema</title>
  <para>
   Execute <command>multi-update</command>. Esse comando executa o <command>zypper</command> em um ambiente <systemitem>chroot</systemitem> e atualiza o outro sistema, não importa qual é o ativo. Seu menu de boot será oferecido como o padrão na hora do boot.
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.touble">
  <title>Troubleshooting Guides (inglês somente)</title>
  <para>
   Se o sistema atualizado tiver o carregador de boot danificado após a atualização, mude o flag <quote>Ativo</quote> e defina-o como a partição raiz do outro sistema para inicializá-lo.
  </para>
  <para>
   Se o sistema atualizado não for inicializado de forma alguma, você precisará de acesso ao menu do carregador de boot para selecionar o outro sistema.
  </para>
  <para>
   Para obter mais informações sobre GRUB, consulte o <xref linkend="cha.grub"/>.
  </para>
 </sect2>

 <sect2 id="cha.update.split-brain.limitation">
  <title>Limitação</title>
  <para>
   A partição raiz deve ser montada pelo nome ou ID da partição, ou de alguma outra forma. Não é suportado montar por UUID ou por rótulo da partição.
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.info">
  <title>Para obter mais informações</title>
  <para>
   Para obter mais informações, consulte o <filename>/usr/share/doc/packages/multi-update-tools/README</filename> que acompanha o pacote <systemitem>multi-update-tools</systemitem>.
  </para>
 </sect2>
</sect1>
