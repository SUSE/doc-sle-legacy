<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="deployment_auto.xml" id="cha-deployment-autoinst" os="sled;sles">
 <title>Instalação automatizada</title>
 <para>
  O AutoYaST permite instalar o SUSE® Linux Enterprise em um grande número de máquinas paralelamente. A tecnologia AutoYaST oferece grande flexibilidade para ajustar as implantações em tipos de hardware heterogêneos. Este capítulo descreve como preparar uma instalação automatizada simples e configurar um cenário avançado que envolva diferentes tipos de hardware e finalidades de instalação.
 </para>
 <sect1 id="sec-deployment-autoinst-simple">
  <title>Instalação em massa simples</title>

  <important>
   <title>Tipos de hardware idênticos</title>
   <para>
    Este cenário pressupõe que você esteja implementando o SUSE Linux Enterprise em um conjunto de máquinas exatamente com a mesma configuração de hardware.
   </para>
  </important>

  <para>
   Para se preparar uma instalação em massa do AutoYaST, proceda da seguinte maneira:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Crie um perfil do AutoYaST que contenha os detalhes de instalação necessários para a implantação, conforme descrito em <xref linkend="sec-deployment-autoinst-simple-profile"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Determine a fonte do perfil do AutoYaST e o parâmetro a ser informado às rotinas de instalação, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-dist"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Determine a fonte dos dados de instalação do SUSE Linux Enterprise, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-source"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Determine e configure o cenário de inicialização para a autoinstalação, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-boot"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Passe a linha de comando para as rotinas de instalação adicionando os parâmetros manualmente ou criando um arquivo <filename>info</filename>, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-info"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Inicie o processo de autoinstalação, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-install"/>.
    </para>
   </step>
  </procedure>

  <sect2 id="sec-deployment-autoinst-simple-profile">
   <title>Criando um perfil do AutoYaST</title>
   <para>
    Um perfil do AutoYaST informa ao AutoYaST o que deve ser instalado e como configurar o sistema instalado para que o resultado final seja um sistema totalmente pronto para ser usado. Ele pode ser criado de várias maneiras:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Clone uma instalação recente de uma máquina de referência em um conjunto de máquinas idênticas;
     </para>
    </listitem>
    <listitem>
     <para>
      Use a GUI do AutoYaST para criar e modificar um perfil que atenda aos seus requisitos;
     </para>
    </listitem>
    <listitem>
     <para>
      Use um editor XML para criar um perfil do zero.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Para clonar uma instalação de referência recente, proceda da seguinte maneira:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Execute uma instalação normal.
     </para>
    </step>
    <step performance="required">
     <para>
      Após concluir a configuração do hardware e ler as notas de versão, marque <guimenu>Clonar Sistema para o Autoyast</guimenu>, caso ainda não esteja marcada por padrão. Isso criará um perfil pronto para uso, como <filename>/root/autoyast.xml</filename>, que pode ser usado para criar clones dessa instalação específica.
     </para>
    </step>
   </procedure>
   <para>
    Para usar a GUI do AutoYaST a fim de criar um perfil com base em uma configuração de sistema existente e modificá-lo de acordo com as suas necessidades, proceda da seguinte maneira:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Como <systemitem class="username">root</systemitem>, inicie o YaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Selecione <menuchoice><guimenu>Diversos</guimenu><guimenu>Autoinstalação</guimenu></menuchoice> para iniciar o front end gráfico do AutoYaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Selecione <menuchoice> <guimenu>Ferramentas</guimenu> <guimenu>Criar Perfil de Referência</guimenu> </menuchoice> para preparar o AutoYaST para espelhar a configuração do sistema atual em um perfil do AutoYaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Assim como os recursos padrão (como carregador de boot, particionamento e seleção de software), você pode adicionar vários outros aspectos do seu sistema ao perfil, marcando os itens na lista em <guimenu>Criar um Arquivo de Controle de Referência</guimenu>.
     </para>
    </step>
    <step performance="required">
     <para>
      Clique em <guimenu>Criar</guimenu> para que o YaST colete todas as informações do sistema e grave-as em um novo perfil.
     </para>
    </step>
    <step performance="required">
     <para>
      Para continuar, escolha uma das seguintes opções:
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        Se o perfil estiver completo e corresponder aos seus requisitos, selecione <menuchoice> <guimenu>Arquivo</guimenu> <guimenu>Gravar como</guimenu> </menuchoice> e digite um nome de arquivo para o perfil, por exemplo, <filename>autoyast.xml</filename>.
       </para>
      </listitem>
      <listitem>
       <para>
        Modifique o perfil de referência selecionando os aspectos de configuração apropriados (por exemplo, <quote>Hardware/Impressora</quote>) na tela em árvore à esquerda e clicando em <guimenu>Configurar</guimenu>. O módulo do YaST correspondente é iniciado, mas as suas configurações são gravadas no perfil do AutoYaST, em vez de serem aplicadas ao sistema. Quando terminar, selecione <menuchoice> <guimenu>Arquivo</guimenu> <guimenu>Gravar como</guimenu> </menuchoice> e digite um nome adequado para o perfil.
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step performance="required">
     <para>
      Saia do módulo do AutoYaST com <menuchoice><guimenu>Arquivo</guimenu><guimenu>Sair</guimenu> </menuchoice>.
     </para>
    </step>
   </procedure>
   <figure>
    <title>Editando um perfil do AutoYaST com o front end do AutoYaST</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec-deployment-autoinst-simple-dist">
   <title>Distribuindo o perfil e determinando o parâmetro autoyast</title>
   <para>
    O perfil do AutoYaST pode ser distribuído de diversas maneiras. Dependendo do protocolo usado para distribuir os dados do perfil, diferentes parâmetros do AutoYaST serão usados para tornar a localização do perfil conhecida pelas rotinas de instalação no cliente. A localização do perfil é passada para as rotinas de instalação por meio do prompt de boot ou de um arquivo <filename>info</filename> que é carregado durante a inicialização. As seguintes opções estão disponíveis:
   </para>
   <informaltable>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         Localização do perfil
        </para>
       </entry>
       <entry>
        <para>
         Parâmetro
        </para>
       </entry>
       <entry>
        <para>
         Descrição
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         Arquivo
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=file://<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Faz as rotinas de instalação procurarem o arquivo de controle no caminho especificado (relativo ao diretório raiz de origem <filename>file:///autoyast.xml</filename>, se estiver no diretório superior de um CD-ROM).
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Dispositivo
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=device://<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Força as rotinas de instalação a procurarem o arquivo de controle em um dispositivo de armazenamento. Somente o nome do dispositivo é necessário — <filename>/dev/sda1</filename> está incorreto; em vez disso, use <filename>sda1</filename>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Disquete
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=floppy://<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Força as rotinas de instalação a procurarem o arquivo de controle na unidade de disquete. Essa opção é bastante útil para inicializar a partir de um CD-ROM.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=nfs://<replaceable>servidor</replaceable>/<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Força as rotinas de instalação a recuperarem o arquivo de controle de um servidor NFS.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=http://<replaceable>servidor</replaceable>/<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Força as rotinas de instalação a recuperarem o arquivo de controle de um servidor HTTP.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTPS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=https://<replaceable>servidor</replaceable>/<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Força as rotinas de instalação a recuperarem o arquivo de controle de um servidor HTTPS.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         TFTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=tftp://<replaceable>servidor</replaceable>/<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Força as rotinas de instalação a recuperarem o arquivo de controle de um servidor TFTP.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         FTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=ftp://<replaceable>servidor</replaceable>/<replaceable>caminho</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Força as rotinas de instalação a recuperarem o arquivo de controle de um servidor FTP.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    Substitua os marcadores <replaceable>servidor</replaceable> e <replaceable>caminho</replaceable> pelos valores que correspondem à configuração real.
   </para>
   <para>
    O AutoYaST inclui um recurso que permite a vinculação de determinados perfis ao endereço MAC do cliente. Sem que seja preciso alterar o parâmetro <option>autoyast=</option>, você pode fazer com que a mesma configuração instale várias instâncias diferentes usando perfis distintos.
   </para>
   <para>
    Para usar isso, proceda da seguinte maneira:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Crie perfis separados com o endereço MAC do cliente como o nome do arquivo e coloque-os no servidor HTTP que contém os perfis do AutoYaST.
     </para>
    </step>
    <step performance="required">
     <para>
      Omita o caminho exato, incluindo o nome do arquivo, quando criar o parâmetro <option>autoyast=</option>, por exemplo:
     </para>
<screen>autoyast=tftp://192.168.1.115/</screen>
    </step>
    <step performance="required">
     <para>
      Inicie a autoinstalação.
     </para>
    </step>
   </procedure>
   <para>
    O YaST tenta determinar a localização do perfil da seguinte maneira:
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      O YaST procura o perfil usando seu próprio endereço IP em maiúsculas hexadecimais, por exemplo, <literal>192.0.2.91</literal> equivale a <literal>C000025B</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      Se esse arquivo não for encontrado, o YaST removerá um dígito hexadecimal e repetirá a operação. Essa ação é repetida oito vezes até que seja encontrado o arquivo com o nome correto.
     </para>
    </listitem>
    <listitem>
     <para>
      Se ainda falhar, ele tentará localizar um arquivo com o endereço MAC dos clientes como o nome de arquivo. O endereço MAC do cliente no exemplo é <literal>0080C8F6484C</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      Se o arquivo nomeado com o endereço MAC não for encontrado, o YaST irá procurar um arquivo chamado <filename>default</filename> (em minúsculas). Veja a seguir um exemplo de sequência de endereços nos quais o YaST procura o perfil do AutoYaST:
     </para>
<screen>
C000025B 
C000025 
C00002 
C0000 
C000 
C00 
C0 
C 
0080C8F6484C 
default
     </screen>
    </listitem>
   </orderedlist>
  </sect2>

  <sect2 id="sec-deployment-autoinst-simple-source">
   <title>Fornecendo os dados da instalação</title>
   <para>
    Os dados da instalação podem ser fornecidos por meio de CDs ou DVDs do produto ou através de uma fonte de instalação de rede. Se os CDs do produto forem usados como fonte de instalação, o acesso físico ao cliente a ser instalado será necessário, pois o processo de boot deverá ser iniciado manualmente e os CDs terão que ser mudados.
   </para>
   <para>
    Para fornecer as fontes de instalação pela rede, configure um servidor de instalação de rede (HTTP, NFS, FTP), conforme descrito na <xref linkend="sec-deployment-remoteinst-instserver-sles9"/>. Use um arquivo <filename>info</filename> para passar a localização do servidor para as rotinas de instalação.
   </para>
  </sect2>

  <sect2 id="sec-deployment-autoinst-simple-boot">
   <title>Configurando o cenário de inicialização</title>
   <para>
    O cliente pode ser inicializado de diversas maneiras:
   </para>
   <variablelist>
    <varlistentry>
     <term>Inicialização pela rede</term>
     <listitem>
      <para>
       Da mesma forma que a instalação remota normal, a instalação automática pode ser iniciada com Wake on LAN e PXE, a imagem de boot e o arquivo de controle podem ser transferidos por TFTP, e as fontes de instalação de qualquer servidor de instalação de rede.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>CD-ROM inicializável</term>
     <listitem>
      <para>
       Você pode usar a mídia original do SUSE Linux Enterprise para inicializar o sistema para instalação automática e obter o arquivo de controle de um local de rede ou de um disquete. Você também pode criar seu próprio CD-ROM personalizado contendo as fontes de instalação e o perfil do AutoYaST.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    As seções a seguir fornecem uma descrição básica dos procedimentos para inicialização pela rede ou por um CD-ROM.
   </para>
   <sect3 id="sec-deployment-autoinst-simple-boot-pxe">
    <title>Preparando para inicialização pela rede</title>
    <para>
     A inicialização pela rede com o Wake on LAN, o PXE e o TFTP é discutida na <xref linkend="sec-deployment-remoteinst-scenario-vncpxe"/>. Para que a configuração apresentada neste tópico funcione para a autoinstalação, modifique o arquivo de configuração do PXE para Linux destacado (<filename>/srv/tftp/pxelinux.cfg/default</filename>), de modo que o parâmetro <literal>autoyast</literal> aponte para a localização do perfil do AutoYaST. Veja a seguir um exemplo de entrada para uma instalação padrão:
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ 
	  
	</screen>
    <para>
     O mesmo exemplo para a autoinstalação seria:
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ \
           autoyast=nfs://192.168.1.110/profiles/autoyast.xml
	</screen>
    <para>
     Substitua os caminhos e os endereços IP dos exemplos pelos dados usados na sua configuração.
    </para>
   </sect3>
   <sect3 id="sec-deployment-autoinst-simple-boot-cd">
    <title>Preparando para inicializar de um CD-ROM</title>
    <para>
     Há várias maneiras de inicialização de um CD-ROM que pode ser executada em instalações do AutoYaST. Escolha um destes cenários:
    </para>
    <variablelist>
     <varlistentry>
      <term>Inicializar da mídia do SUSE Linux Enterprise, obter o perfil pela rede</term>
      <listitem>
       <para>
        Use essa abordagem se não for possível um cenário totalmente baseado em rede (por exemplo, se o hardware não oferecer suporte a PXE) e você tiver acesso físico ao sistema para fazer a instalação durante a maior parte do processo.
       </para>
       <para>
        Itens necessários:
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          A mídia do SUSE Linux Enterprise
         </para>
        </listitem>
        <listitem>
         <para>
          Um servidor de rede para fornecer os dados do perfil (consulte a <xref linkend="sec-deployment-autoinst-simple-dist"/> para obter os detalhes)
         </para>
        </listitem>
        <listitem>
         <para>
          Um disquete contendo o arquivo <filename>info</filename> que informa às rotinas de instalação onde encontrar o perfil
         </para>
         <para>
          <emphasis>ou</emphasis>
         </para>
         <para>
          Acesso ao prompt de boot do sistema para fazer a instalação no qual você deve digitar manualmente o parâmetro <literal>autoyast=</literal>
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term> Inicializar e instalar da mídia do SUSE Linux Enterprise, obter o perfil de um disquete </term>
      <listitem>
       <para>
        Use essa abordagem se um cenário de instalação totalmente baseado na rede não funcionar. Requer acesso físico ao sistema a ser instalado para ativação da máquina de destino ou, em segundo caso, a especificação do local do perfil no prompt de boot. Em ambos os casos, talvez também seja necessário trocar a mídia dependendo do escopo da instalação.
       </para>
       <para>
        Itens necessários:
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          A mídia do SUSE Linux Enterprise
         </para>
        </listitem>
        <listitem>
         <para>
          Um disquete contendo o perfil e o arquivo <filename>info</filename>
         </para>
         <para>
          <emphasis>ou</emphasis>
         </para>
         <para>
          Acesso ao prompt de boot do destino para digitar o parâmetro <option>autoyast=</option>
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Inicializar e instalar de mídia personalizada, obter o perfil na mídia</term>
      <listitem>
       <para>
        Se você só precisar instalar um número limitado de pacotes de software e o número de destinos for relativamente pequeno, talvez seja mais conveniente criar um CD personalizado contendo os dados da instalação e o perfil, principalmente se a sua configuração não tiver uma rede disponível.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
  </sect2>

  <sect2 id="sec-deployment-autoinst-simple-info">
   <title>Criando o arquivo <filename>info</filename></title>
   <para>
    As rotinas de instalação no destino precisam reconhecer todos os componentes diferentes do framework do AutoYaST. Isso é feito com a criação de uma linha de comando contendo todos os parâmetros necessários para localizar os componentes do AutoYaST, as fontes de instalação e os parâmetros necessários para controlar o processo de instalação.
   </para>
   <para>
    Para isso, transmita esses parâmetros manualmente no prompt de boot da instalação ou forneça um arquivo chamado <filename>info</filename> que será lido pelas rotinas de instalação (linuxrc). A primeira opção requer acesso físico a qualquer cliente para fazer a instalação, o que torna essa abordagem inadequada para implantações de grande porte. A segunda opção permite fornecer o arquivo <filename>info</filename> em alguma mídia preparada e inserida nas unidades dos clientes antes da autoinstalação. Você também pode usar a inicialização PXE e incluir os parâmetros linuxrc no arquivo <filename>pxelinux.cfg/default</filename>, conforme mostrado na <xref linkend="sec-deployment-autoinst-simple-boot-pxe"/>.
   </para>
   <para>
    Os seguintes parâmetros são usados com frequência para linuxrc. Para obter mais informações, consulte a documentação do pacote do AutoYaST, em <filename>/usr/share/doc/packages/autoyast</filename>.
   </para>
   <important>
    <title>Separando parâmetros e valores</title>
    <para>
     Ao passar parâmetros para o linuxrc no prompt de boot, use <literal>=</literal> para separar o parâmetro do valor. Ao usar um arquivo <filename>info</filename>, separa o parâmetro e o valor com <literal>:</literal>.
    </para>
   </important>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         Palavra-chave
        </para>
       </entry>
       <entry>
        <para>
         Valor
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <literal>netdevice</literal>
        </para>
       </entry>
       <entry>
        <para>
         O dispositivo de rede a ser usado para configurar a rede (para solicitações BOOTP/DHCP). Só será necessário se vários dispositivos de rede estiverem disponíveis.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>hostip</literal>
        </para>
       </entry>
       <entry>
        <para>
         Quando vazio, o cliente envia uma solicitação BOOTP. Caso contrário, o cliente será configurado com os dados especificados.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netmask</literal>
        </para>
       </entry>
       <entry>
        <para>
         Máscara de rede para a rede selecionada.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>gateway</literal>
        </para>
       </entry>
       <entry>
        <para>
         Gateway Padrão.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>nameserver</literal>
        </para>
       </entry>
       <entry>
        <para>
         Servidor de nomes.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>autoyast</literal>
        </para>
       </entry>
       <entry>
        <para>
         Localização do arquivo de controle a ser usado na instalação automática, por exemplo <literal>autoyast=nfs//192.168.1.110/profiles/</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>silenciosa</literal>
        </para>
       </entry>
       <entry>
        <para>
         Localização da fonte de instalação, por exemplo, <literal>install=nfs://192.168.1.110/CDs/</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vnc</literal>
        </para>
       </entry>
       <entry>
        <para>
         Se definido como <literal>1</literal>, habilita a instalação remota controlada via VNC.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vncpassword</literal>
        </para>
       </entry>
       <entry>
        <para>
         A senha do VNC.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>usessh</literal>
        </para>
       </entry>
       <entry>
        <para>
         Se definido como <literal>1</literal>, habilita a instalação remota controlada via SSH.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netsetup</literal>
        </para>
       </entry>
       <entry>
        <para>
         Se definido como <literal>1</literal>, configura a rede. Normalmente, isso é feito de forma automática, mas você precisará definir <literal>netsetup=1</literal> caso o repositório de instalação seja fornecido localmente (ex. por DVD ou imagem ISO local) e o arquivo <filename>info</filename> seja carregado da rede.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    Se o cenário de instalação automática envolver a configuração do cliente por DHCP e uma fonte de instalação de rede, e você quiser monitorar o processo de instalação usando o VNC, sua <filename>info</filename> teria a seguinte aparência:
   </para>
<screen>autoyast:<replaceable>profile_source</replaceable> install:<replaceable>install_source</replaceable> vnc:1 vncpassword:<replaceable>some_password</replaceable></screen>
   <para>
    Se você preferir uma configuração de rede estática durante a instalação, o arquivo <filename>info</filename> deverá ser como este:
   </para>
<screen>
autoyast:<replaceable>profile_source</replaceable> \
install:<replaceable>install_source</replaceable> \ 
hostip:<replaceable>some_ip</replaceable> \ 
netmask:<replaceable>some_netmask</replaceable> \ 
gateway:<replaceable>some_gateway</replaceable></screen>
   <para>
    A <literal>\</literal> indica que as quebras de linha só foram adicionadas para facilitar a leitura. Todas as opções devem ser digitadas como uma string contínua.
   </para>
   <para>
    Os dados do arquivo <filename>info</filename> podem ser disponibilizados para o linuxrc de diversas maneiras:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Como um arquivo em um disquete ou CD Rom localizado na unidade do cliente no momento da instalação. Adicione o parâmetro info semelhante a <systemitem>info=floppy:/info</systemitem> ou a <systemitem>info=cd:/info</systemitem>.
     </para>
    </listitem>
    <listitem>
     <para>
      Como um arquivo no diretório raiz do disco RAM inicial usado para inicializar o sistema e fornecido na mídia de instalação personalizada ou através da inicialização PXE.
     </para>
    </listitem>
    <listitem>
     <para>
      Como parte do perfil do AutoYaST. Nesse caso, o arquivo do AutoYaST deverá se chamar <filename>info</filename> para que o linuxrc possa analisá-lo. Veja a seguir um exemplo dessa abordagem.
     </para>
    </listitem>
    <listitem>
     <para>
      Por meio de um URL que aponte para a localização do arquivo info. A sintaxe é semelhante a <systemitem>info=http://www.example.com/info</systemitem>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    O linuxrc procura uma string (<option>start_linuxrc_conf</option>) no perfil que representa o início do arquivo. Se encontrá-la, ele analisará o conteúdo começando por essa string e terminando quando a string <option>end_linuxrc_conf</option> for localizada. As opções são armazenadas no perfil da seguinte maneira:
   </para>
<screen>....
  &lt;install&gt;
....
    &lt;init&gt;
      &lt;info_file&gt;
&lt;![CDATA[
#
# Don't remove the following line:
# start_linuxrc_conf
#
install: nfs:<replaceable>server</replaceable>/<replaceable>path</replaceable>
vnc: 1
vncpassword: test
autoyast: file:///info

# end_linuxrc_conf
# Do not remove the above comment
#
]]&gt;

      &lt;/info_file&gt;
    &lt;/init&gt;
......
  &lt;/install&gt;
....
</screen>
   <para>
    O linuxrc carrega o perfil que contém os parâmetros de inicialização em vez do arquivo <filename>info</filename> tradicional. O parâmetro <option>install:</option> aponta para a localização das fontes de instalação. <option>vnc</option> e <option>vncpassword</option> indicam o uso do VNC para monitoramento da instalação. O parâmetro <option>autoyast</option> informa ao linuxrc para tratar o arquivo <filename>info</filename> como um perfil do AutoYaST.
   </para>
  </sect2>

  <sect2 id="sec-deployment-autoinst-simple-install">
   <title>Iniciando e monitorando a autoinstalação</title>
   <para>
    Depois de fornecer toda a infraestrutura mencionada anteriormente (perfil, fonte de instalação e arquivo <filename>info</filename>), você poderá iniciar a auto-instalação. Dependendo do cenário escolhido para inicializar e monitorar o processo, poderá ser necessária a interação física com o cliente:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Se o sistema do cliente for inicializado de qualquer mídia física, a mídia do produto ou CDs personalizados, você deverá inseri-la nas unidades do cliente.
     </para>
    </listitem>
    <listitem>
     <para>
      Se o cliente não for ativado via Wake on LAN, será preciso, no mínimo, ativar a máquina cliente.
     </para>
    </listitem>
    <listitem>
     <para>
      Se a autoinstalação remota controlada não tiver sido selecionada, o feedback gráfico do AutoYaST será enviado para o monitor conectado ao cliente ou, se você usar um cliente sem monitor, para um console serial.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Para habilitar a autoinstalação remota controlada, use os parâmetros VNC ou SSH descritos na <xref linkend="sec-deployment-autoinst-simple-info"/> e conecte-se ao cliente usando outra máquina, conforme descrito na <xref linkend="sec-deployment-remoteinst-monitor"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec-deployment-autoinst-advanced">
  <title>Autoinstalação baseada em regras</title>

  <para>
   As seções a seguir apresentam o conceito básico de instalação baseada em regras usando o AutoYaST e fornecem um cenário de exemplo que permite que você crie sua própria configuração de autoinstalação personalizada.
  </para>

  <sect2 id="sec-deployment-autoinst-advanced-expl">
   <title>Compreendendo a autoinstalação baseada em regras</title>
   <para>
    A instalação do AutoYaST baseada em regras permite lidar com ambientes de hardware heterogêneos:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      O site contém tipos de hardware de fornecedores diferentes?
     </para>
    </listitem>
    <listitem>
     <para>
      As máquinas do site têm configurações de hardware diferentes (por exemplo, usam dispositivos distintos ou memória e discos de vários tamanhos)?
     </para>
    </listitem>
    <listitem>
     <para>
      Você planeja instalar em domínios diferentes e precisa distingui-los?
     </para>
    </listitem>
   </itemizedlist>
   <para>
    O que a autoinstalação baseada em regras faz é, basicamente, gerar um perfil personalizado para corresponder a um cenário heterogêneo fundindo vários perfis em um. Cada regra descreve um recurso distinto específico da configuração (por exemplo, tamanho de disco) e informa ao AutoYaST qual o perfil a ser usado quando coincidir com a regra. Várias regras que descrevem recursos diferentes da configuração são combinadas em um arquivo <filename>rules.xml</filename> do AutoYaST. Em seguida, a pilha de regras é processada e o AutoYaST gera o perfil final fundindo em um todos os diferentes perfis que correspondem às regras do AutoYaST. Para ilustrar esse procedimento, consulte a <xref linkend="sec-deployment-autoinst-advanced-example"/>.
   </para>
   <para>
    O AutoYaST baseado em regras oferece excelente flexibilidade para planejar e executar a implantação do SUSE Linux Enterprise. Você pode:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Criar regras para corresponder a quaisquer atributos de sistema predefinidos no AutoYaST;
     </para>
    </listitem>
    <listitem>
     <para>
      Combinar vários atributos de sistema (por exemplo, tamanho de disco e arquitetura de kernel) com uma regra usando operadores lógicos;
     </para>
    </listitem>
    <listitem>
     <para>
      Criar regras personalizadas executando scripts de shell e passar a saída para o framework do AutoYaST. O número de regras personalizadas está limitado a cinco.
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <para>
     Para obter mais informações sobre a criação e o uso de regras com o AutoYaST, consulte a documentação do pacote em <filename>/usr/share/doc/packages/autoyast2/html/index.html</filename>, capítulo <guimenu>Rules and Classes</guimenu> (Regras e classes).
    </para>
   </note>
   <para>
    Para preparar para uma instalação em massa do AutoYaST baseada em regras, proceda da seguinte maneira:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Crie vários perfis do AutoYaST que contenham os detalhes da instalação necessários para a configuração heterogênea, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-profile"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Defina as regras para corresponderem aos atributos de sistema da sua configuração de hardware, conforme mostrado na <xref linkend="sec-deployment-autoinst-advanced-example"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Determine a fonte do perfil do AutoYaST e o parâmetro a ser informado às rotinas de instalação, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-dist"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Determine a fonte dos dados de instalação do SUSE Linux Enterprise, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-source"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Passe a linha de comando para as rotinas de instalação adicionando os parâmetros manualmente ou criando um arquivo <filename>info</filename>, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-info"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Determine e configure o cenário de inicialização para a autoinstalação, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-boot"/>.
     </para>
    </step>
    <step performance="required">
     <para>
      Inicie o processo de autoinstalação, conforme descrito na <xref linkend="sec-deployment-autoinst-simple-install"/>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec-deployment-autoinst-advanced-example">
   <title>Exemplo de cenário para uma autoinstalação baseada em regras</title>
   <para>
    Para obter uma compreensão básica sobre como as regras são criadas, analise o exemplo a seguir, ilustrado na <xref linkend="fig-autoyast-rules"/>. Uma execução do AutoYaST instala a seguinte configuração:
   </para>
   <variablelist>
    <varlistentry>
     <term>Um servidor de impressão</term>
     <listitem>
      <para>
       Esta máquina só precisa de uma instalação mínima sem ambiente de área de trabalho e um conjunto limitado de pacotes de software.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Estações de trabalho no departamento de engenharia</term>
     <listitem>
      <para>
       Estas máquinas precisam de um ambiente de área de trabalho e um amplo conjunto de softwares de desenvolvimento.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Laptops no departamento de vendas</term>
     <listitem>
      <para>
       Estas máquinas precisam de um ambiente de área de trabalho e um conjunto limitado de aplicativos especializados, por exemplo, software para escritório e calendários.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure id="fig-autoyast-rules">
    <title>Regras do AutoYaST</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_rules.svg" width="90%" format="SVG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_rules.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Na primeira etapa, use um dos métodos descritos na <xref linkend="sec-deployment-autoinst-simple-profile"/> a fim de criar perfis para cada caso de uso. Nesse exemplo, você deve criar <filename>print.xml</filename>, <filename>engineering.xml</filename> e <filename>sales.xml</filename>.
   </para>
   <para>
    Na segunda etapa, crie regras para distinguir os três tipos de hardware e informar ao AutoYaST qual perfil deve ser usado. Use um algoritmo semelhante ao seguinte para configurar as regras:
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      A máquina tem o IP <guimenu>192.168.2.253</guimenu>? Nesse caso, torne-o o servidor de impressão.
     </para>
    </listitem>
    <listitem>
     <para>
      A máquina tem um hardware PCMCIA e um chipset Intel? Nesse caso, considere-o como um laptop Intel e instale a seleção de softwares do departamento de vendas.
     </para>
    </listitem>
    <listitem>
     <para>
      Se nenhuma das regras acima for verdadeira, considere a máquina como uma estação de trabalho de desenvolvedor e faça a instalação apropriada.
     </para>
    </listitem>
   </orderedlist>
   <para>
    De modo geral, isso se traduz em um arquivo <filename>rules.xml</filename> com o seguinte conteúdo:
   </para>
<screen>
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE autoinstall SYSTEM "/usr/share/autoinstall/dtd/rules.dtd"&gt; 
&lt;autoinstall xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns"&gt;
  &lt;rules config:type="list"&gt;
    &lt;rule&gt;
       &lt;hostaddress&gt;
	    &lt;match&gt;192.168.2.253&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/hostaddress&gt;
       &lt;result&gt;
            &lt;profile&gt;print.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
       &lt;haspcmcia&gt;
            &lt;match&gt;1&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/haspcmcia&gt;
       &lt;custom1&gt;
           &lt;script&gt;
if grep -i intel /proc/cpuinfo &gt; /dev/null; then
echo -n "intel"
else
echo -n "non_intel"
fi;
           &lt;/script&gt;
           &lt;match&gt;*&lt;/match&gt;
           &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/custom1&gt;
       &lt;result&gt;
            &lt;profile&gt;sales.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
        &lt;operator&gt;and&lt;/operator&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
        &lt;haspcmcia&gt;
            &lt;match&gt;0&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
        &lt;/haspcmcia&gt;
 	&lt;result&gt;
            &lt;profile&gt;engineering.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
  &lt;/rules&gt;
&lt;/autoinstall&gt;
</screen>
   <para>
    Ao distribuir o arquivo de regras, verifique se o diretório <filename>rules</filename> está abaixo de <filename>profiles</filename>, especificado no URL <filename>autoyast=<replaceable>protocolo</replaceable>:<replaceable>ipservidor</replaceable>/profiles/</filename>. Primeiro, o AutoYaST procura um subdiretório <filename>rules</filename> contendo um arquivo chamado <filename>rules.xml</filename> e, em seguida, ele carrega e funde os perfis especificados no arquivo de regras.
   </para>
   <para>
    O resto do procedimento de autoinstalação é executado normalmente.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec-deployment-autoinst-moreinfo">
  <title>Para obter mais informações</title>

  <para>

   Para informações mais detalhadas sobre a tecnologia do AutoYaST, consulte o <phrase os="sles"><xref linkend="book-autoyast"/> ou </phrase> a documentação instalada com o software (<filename>/usr/share/doc/packages/autoyast2</filename>).
  </para>
 </sect1>
</chapter>
