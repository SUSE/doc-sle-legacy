<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect1
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="raid.xml" xml:id="sec-yast2-system-raid">
 <title>Configuração de RAID de software</title><indexterm> <primary>YaST</primary> <secondary>RAID</secondary></indexterm><indexterm> <primary>RAID</primary> <secondary>YaST</secondary></indexterm><indexterm> <primary>soft RAID</primary> <see>RAID</see></indexterm>



 <para>
  A finalidade do RAID (redundant array of independent disks) é combinar várias partições de disco rígido em um disco rígido grande <emphasis>virtual</emphasis> para otimizar o desempenho e/ou a segurança dos dados. Grande parte dos controladores RAID usa o protocolo SCSI, pois ele pode trabalhar com um grande número de discos rígidos de maneira mais eficiente que o protocolo IDE. É também mais adequado para o processamento de comandos paralelos. Algumas controladoras RAID suportam discos rígidos IDE ou SATA. O RAID de software fornece as vantagens de sistemas RAID sem o custo adicional de controladoras RAID de hardware. Entretanto, exige algum tempo da CPU e possui mais requisitos de memória que o tornam inadequado para computadores de alto desempenho.
 </para>

 <para>
  Com o <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>, é possível combinar vários discos rígidos em um sistema soft RAID. O RAID envolve várias estratégias de combinação de diversos discos rígidos em um sistema RAID, cada uma com diferentes metas, vantagens e características. Essas variações geralmente são conhecidas como <emphasis>níveis de RAID</emphasis>.
 </para>

 <para>
  Os níveis de RAID comuns são:
 </para>

 <variablelist>
  <varlistentry>
   <term>RAID 0</term>
   <listitem>
    <para>
     Esse nível melhora o desempenho do acesso aos dados dividindo blocos de cada arquivo entre várias unidades de disco. Na verdade, não é realmente um RAID, pois ele não dispõe de backup de dados, mas o nome <emphasis>RAID 0</emphasis> para esse tipo de sistema normalmente é usado. Com o RAID 0, dois ou mais discos rígidos são unidos em um pool. O desempenho é aprimorado, mas o sistema RAID é destruído e seus dados são perdidos quando há falha mesmo em um único disco rígido.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>RAID 1</term>
   <listitem>
    <para>
     Esse nível fornece a segurança adequada para seus dados, porque eles são copiados para outro disco rígido 1:1. Isso é conhecido como <emphasis>espelhamento de disco rígido</emphasis>. Se um disco é destruído, a cópia de seu conteúdo fica disponível em outro disco. Todos os discos, exceto um, podem ser danificados sem colocar os dados em risco. No entanto, se o dano não for detectado, os dados danificados poderão ser espelhados no disco íntegro. O resultado também pode ser a perda de dados. O desempenho de gravação é afetado no processo de cópia comparado ao uso do acesso a disco único (10 a 20% mais lento), mas o acesso de leitura fica significativamente mais rápido comparado a qualquer um dos discos rígidos físicos normais. O motivo é que os dados duplicados podem ser verificados em paralelo. Em termos gerais, é possível dizer que o Nível 1 proporciona quase o dobro de taxa de transferência de leitura dos discos únicos e quase a mesma taxa de transferência de gravação dos discos únicos.
    </para>
   </listitem>
  </varlistentry>

  <varlistentry>
   <term>RAID 5</term>
   <listitem>
    <para>
     RAID 5 é uma conciliação otimizada entre o Nível 0 e o Nível 1, em termos de desempenho e redundância. O espaço em disco rígido é igual ao número de discos usados menos um. Os dados são distribuídos pelos discos rígidos da mesmo forma que no RAID 0. Os <emphasis>Blocos de paridade</emphasis>, criados em uma das partições, existem por motivos de segurança. Eles são vinculados uns aos outros com XOR, o que permite que o conteúdo seja reconstruído pelo bloco de paridade correspondente no caso de uma falha do sistema. Com o RAID 5, apenas um disco rígido pode falhar por vez. Se um disco rígido falhar, ele deverá ser substituído assim que possível, para evitar o risco da perda de dados.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>RAID 6</term>
   <listitem>
    <para>
     Para aumentar ainda mais a confiabilidade do sistema RAID, é possível usar RAID 6. Nesse nível, mesmo que haja falha em dois discos, a matriz ainda poderá ser reconstruída. Com RAID 6, no mínimo 4 discos rígidos são necessários para executar a matriz. Observe que, na execução como software raid, essa configuração precisa de uma quantidade considerável de tempo e memória da CPU.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>RAID 10 (RAID 1+0)</term>
   <listitem>
    <para>
     Esta implementação de RAID combina recursos do RAID 0 e do RAID 1: os dados são primeiramente espelhados em matrizes de disco separadas, que são inseridas em uma nova matriz do tipo RAID 0;. Em cada submatriz RAID 1, um disco pode falhar sem danificar os dados. Um mínimo de quatro discos e um número par de discos são necessários para executar o RAID 10. Este tipo de RAID é usado para aplicativo de banco de dados em que se espera uma enorme carga.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Outros níveis de RAID</term>
   <listitem>
    <para>
     Vários outros níveis de RAID foram desenvolvidos (RAID 2, RAID 3, RAID 4, RAIDn, RAID 10, RAID 0+1, RAID 30, RAID 50, etc.), sendo alguns deles implementações proprietárias criadas por fornecedores de hardware. Esses níveis não são muito comuns e, portanto, não são explicados aqui.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <section xml:id="sec-yast2-system-raid-conf">
  <title>Configuração de RAID de software com o YaST</title>
  <para>
   A configuração de <guimenu>RAID</guimenu> do YaST pode ser obtida por meio do Particionador Técnico do YaST, descrito na <xref linkend="sec-yast2-i-y2-part-expert"/>. Esta ferramenta de particionamento permite editar e apagar partições existentes e criar partições novas a serem usadas com o RAID por software:
  </para>
  <procedure>
   <step>
    <para>
     Selecione um disco rígido em <guimenu>Discos Rígidos</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Mude para a guia <guimenu>Partições</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Clique em <guimenu>Adicionar</guimenu> e digite o tamanho desejado da partição RAID neste disco.
    </para>
   </step>
   <step>
    <para>
     Use <guimenu>Não Formatar a Partição</guimenu> e mude o <guimenu>ID do Sistema de Arquivos</guimenu> para <guimenu>RAID Linux 0xFD</guimenu>. Não monte essa partição.
    </para>
   </step>
   <step>
    <para>
     Repita esse procedimento até definir todos os volumes físicos desejados nos discos disponíveis.
    </para>
   </step>
  </procedure>
  <para>
   Para o RAID 0 e o RAID 1, pelo menos duas partições são necessárias; para o RAID 1, geralmente apenas duas. Se for usado o RAID 5, pelo menos três partições serão necessárias; o RAID 6 e o RAID 10 exigem no mínimo quatro partições. É recomendável usar apenas partições do mesmo tamanho. As partições RAID devem estar localizadas em discos rígidos diferentes para diminuir o risco de perda de dados se um deles apresentar defeito (RAID 1 e 5) e para otimizar o desempenho do RAID 0. Após criar todas as partições a serem usadas com o RAID, clique em <menuchoice><guimenu>RAID</guimenu><guimenu>Adicionar RAID</guimenu></menuchoice> para iniciar a configuração do RAID.
  </para>
  <para>
   Na próxima caixa de diálogo, escolha dentre os níveis de RAID 0, 1, 5, 6 e 10. Em seguida, selecione todas as partições com o tipo <quote>RAID Linux</quote> ou <quote>Linux nativo</quote> que deve ser usado pelo sistema RAID. Não são exibidas partições do DOS ou de troca.
  </para>
  <tip>
   <para>
    Para os tipos de RAID que levam em consideração a ordem dos discos adicionados, é possível marcar cada disco com uma das letras de A a E. Clique no botão <guimenu>Classificar</guimenu>, selecione o disco e clique em um dos botões <guimenu>Classe X</guimenu>, em que X é a letra a ser atribuída ao disco. Atribua todos os discos RAID disponíveis dessa forma e clique em <guimenu>OK</guimenu> para confirmar. É possível ordenar facilmente os discos classificados com os botões <guimenu>Ordenado</guimenu> ou <guimenu>Intercalado</guimenu>, ou adicionar um padrão de classificação de um arquivo de texto com <guimenu>Arquivo Padrão</guimenu>.
   </para>
  </tip>
  <figure xml:id="fig-yast2-system-raid-conf">
   <title>Partições RAID</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_raid4.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_raid4.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   Para adicionar uma partição anteriormente não atribuída ao volume RAID selecionado, primeiro clique na partição e, em seguida, em <guimenu>Adicionar</guimenu>. Atribua todas as partições reservadas para o RAID. Caso contrário, o espaço na partição permanecerá sem uso. Após atribuir todas as partições, clique em <guimenu>Avançar</guimenu> para selecionar as <guimenu>Opções RAID</guimenu> disponíveis.
  </para>
  <para>
   Nesta última etapa, defina o sistema de arquivos a ser usado, a criptografia e o ponto de montagem para o volume RAID. Após concluir a configuração com <guimenu>Concluir</guimenu>, verifique o dispositivo <filename>/dev/md0</filename> e outros dispositivos indicados com <emphasis>RAID</emphasis> no particionador expert.
  </para>
 </section>

 <section>
  <title>Solução de Problemas</title>
  <para>
   Verifique o arquivo <filename>/proc/mdstat</filename> para saber se uma partição RAID foi danificada. No caso de uma falha do sistema, encerre o sistema Linux e substitua o disco rígido danificado por um novo, particionado da mesma maneira. Depois, reinicie o sistema e digite o comando <command>mdadm /dev/mdX --add /dev/sdX</command>. Substitua 'X' por seus próprios identificadores de dispositivo. Isso integra o disco rígido automaticamente ao sistema RAID e o reconstrói totalmente.
  </para>
  <para>
   Observe que, embora você possa acessar todos os dados durante a reconstrução, talvez ocorram alguns problemas de desempenho até a reconstrução completa do RAID.
  </para>
 </section>

<?dbfo-need height="10em"?>



 <section>
  <title>Para obter mais informações</title>
  <para>
   Instruções de configuração e mais detalhes sobre o RAID de software podem ser encontrados nos HOWTOs, em:
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <filename>/usr/share/doc/packages/mdadm/Software-RAID.HOWTO.html</filename>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="http://raid.wiki.kernel.org"/>
    </para>
   </listitem>
  </itemizedlist>
  <para>
   As listas de correio do RAID do Linux estão disponíveis, como <link xlink:href="http://marc.info/?l=linux-raid"/>.
  </para>
 </section>
</section>
