<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="net_samba.xml" id="cha-samba">
 <title>Samba</title><indexterm id="idx-Samba" class="startofrange"> <primary>Samba</primary> </indexterm> <indexterm> <primary>SMB</primary> <see>Samba</see> </indexterm> <indexterm> <primary>Mac OS X</primary> <secondary>ファイル共有</secondary> </indexterm> <indexterm> <primary>Windows</primary> <secondary>ファイル共有</secondary> </indexterm> <indexterm> <primary>OS/2</primary> <secondary>ファイル共有</secondary> </indexterm> <indexterm> <primary>Linux</primary> <secondary>別のOSとのファイル共有</secondary> </indexterm>
 <abstract>
  <para>
   Sambaを使用すると、Mac OS X、Windows、OS/2マシンに対するファイルサーバおよびプリントサーバをUnixマシン上に構築できます。Sambaは、今や成熟の域に達したかなり複雑な製品です。Sambaは、YaSTまたはSWAT (Webインタフェース)を使用するか、設定ファイルを手動で編集して設定します。
  </para>
 </abstract>
 <sect1 id="sec-samba-term">
  <title>用語集</title>

  <para>
   ここでは、SambaのマニュアルやYaSTモジュールで使用される用語について説明します。
  </para>

  <variablelist>
   <varlistentry>
    <term>SMBプロトコル</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>SMB</secondary></indexterm><indexterm><primary>プロトコル</primary><secondary>SMB</secondary></indexterm><indexterm><primary>smbd</primary></indexterm>SambaはSMB(サーバメッセージブロック)プロトコルを使用します。SMBは<phrase role="productname">NetBIOS</phrase>サービスを基にしています。Microsoftがこのプロトコルをリリースしたので、他のソフトウェアメーカはMicrosoftドメインネットワークに接続できるようになりました。Sambaでは、SMBプロトコルがTCP/IPプロトコルの上で動作するので、すべてのクライアントにTCP/IPプロトコルをインストールする必要があります。<indexterm> <primary>Samba</primary> <secondary>TCP/IP</secondary> </indexterm>
     </para>
     
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CIFSプロトコル</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>CIFS</secondary></indexterm><indexterm><primary>プロトコル</primary><secondary>CIFS </secondary></indexterm>CIFS (common Internet file system)プロトコルは、Sambaがサポートしているプロトコルです。CIFSは、ネットワーク上で使用する標準のリモートファイルシステムで、ユーザグループによる共同作業およびネットワーク間でのドキュメントの共有ができるようにします。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS<indexterm> <primary>Samba</primary> <secondary>名前</secondary> </indexterm></term>
    <listitem>
     <para>
      <indexterm><primary>NetBIOS</primary></indexterm>NetBIOSは、マシン間通信用に設計された、ネームサービスを提供するソフトウェアインタフェース(API)です。これにより、ネットワークに接続されたマシンが、それ自体の名前を維持できます。予約を行えば、これらのマシンを名前によって指定できます。名前を確認する一元的なプロセスはありません。ネットワーク上のマシンでは、すでに使用済みの名前でない限り、名前をいくつでも予約できます。NetBIOSインタフェースは、異なるネットワークアーキテクチャに実装できるようになっています。ネットワークハードウェアと比較的密接に機能する実装は<phrase role="productname">NetBEUI</phrase>と呼ばれますが、これはよく<phrase role="productname">NetBIOS</phrase>とも呼ばれます。NetBIOSとともに実装されるネットワークプロトコルは、Novell IPX (TCP/IP経由の NetBIOS)とTCP/IPです。
     </para>
     <para>
      TCP/IP経由で送信されたNetBIOS名は、<filename>/etc/hosts</filename>で使用されている名前、またはDNSで定義された名前とまったく共通点がありません。NetBIOSは独自の、完全に独立した名前付け規則を使用しています。しかし、管理を容易にするために、DNSホスト名に対応する名前を使用するか、DNSをネイティブで使用することをお勧めします。これはSambaが使用するデフォルトでもあります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Sambaサーバ<indexterm> <primary>Samba</primary> <secondary>サーバ</secondary> </indexterm></term>
    <listitem>
     <para>
      Sambaサーバは、SMB/CIFSサービスおよびNetBIOS over IPネーミングサービスをクライアントに提供します。Linuxの場合、3種類のSambaサーバデーモン(SMB/CIFSサービス用smnd、ネーミングサービス用nmbd、認証用winbind)が用意されています。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Sambaクライアント<indexterm id="idx-Samba-clients" class="startofrange"> <primary>Samba</primary> <secondary>クライアント</secondary> </indexterm></term>
    <listitem>
     <para>
      Sambaクライアントは、SMBプロトコルを介してSambaサーバからSambaサービスを使用するシステムです。Mac OS X、Windows、OS/2などの一般的なオペレーティングシステムは、すべてSMBプロトコルをサポートしています。TCP/IPプロトコルは、すべてのコンピュータにインストールする必要があります。Sambaは、異なるUNIXフレーバーに対してクライアントを提供します。Linuxでは、SMB用のカーネルモジュールがあり、LinuxシステムレベルでのSMBリソースの統合が可能です。Sambaクライアントに対していずれのデーモンも実行する必要はありません。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>共有</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>共有</secondary></indexterm>SMBサーバは、そのクライアントに対し、共有によってリソースを提供します。共有は、サーバ上のサブディレクトリのあるディレクトリおよびプリンタです。これは名前によってエクスポートされ、名前によってアクセスされます。共有名にはどのような名前も設定できます。エクスポートディレクトリの名前である必要はありません。プリンタにも名前が割り当てられます。クライアントはプリンタに名前でアクセスできます。<indexterm><primary>印刷</primary><secondary>Samba</secondary></indexterm><indexterm><primary>Samba</primary><secondary>プリンタ</secondary></indexterm><indexterm class="endofrange" startref="idx-Samba-clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>DC</secondary></indexterm>ドメインコントローラ(DC)はドメインのアカウントを処理するサーバです。データレプリケーションには、1つのドメインの中で追加のドメインコントローラが使用できます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 
 
 <sect1 id="sec-samba-serv-inst">
  <title>Sambaサーバの設定</title><indexterm> <primary>Samba</primary> <secondary>インストール</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>サーバ</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>設定</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>Samba</secondary> </indexterm>

  

  <para os="sled">
   Sambaサーバの設定については、SUSE Linux Enterprise Serverのドキュメントを参照してください。
  </para>

  

  

  
 </sect1>
 <sect1 id="sec-samba-client-inst">
  <title>クライアントの設定</title><indexterm> <primary>Samba</primary> <secondary>クライアント</secondary> </indexterm>

  <para>
   クライアントは、TCP/IP経由でのみSambaサーバにアクセスできます。IPX経由のNetBEUIおよびNetBIOSは、Sambaで使用できません。
  </para>

  <sect2 id="sec-samba-client-inst-yast">
   <title>YaSTによるSambaクライアントの設定</title><indexterm> <primary>YaST</primary> <secondary>Samba</secondary> <tertiary>クライアント</tertiary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>クライアント</secondary> </indexterm> <indexterm> <primary>設定</primary> <secondary>Samba</secondary> <tertiary>クライアント</tertiary> </indexterm>
   <para>
    SambaクライアントをSambaサーバまたはWindowsサーバ上のリソース(ファイルまたはプリンタ)にアクセスするように設定します。NTまたはActive Directoryのドメインまたはワークグループを、<menuchoice> <guimenu>ネットワークサービス</guimenu><guimenu>Windowsドメインメンバーシップ</guimenu></menuchoice>の順に選択して表示したダイアログに入力します。<guimenu>Linuxの認証にもSMBの情報を使用する</guimenu>を有効にした場合、ユーザ認証は、Samba、NT、またはKerberosのサーバ上で実行されます。
   </para>

   <para>
    <guimenu>エキスパート設定</guimenu>をクリックして、高度な設定オプションを設定します。たとえば、認証による自動的なサーバホームディレクトリのマウントを有効化するには、<guimenu>サーバディレクトリのマウント</guimenu>のテーブルを使用します。これにより、CIFS上でホストされると、ホームディレクトリにアクセスできるようになります。詳細については、 <systemitem>pam_mount</systemitem>のマニュアルページを参照してください。
   </para>
   <para>
    すべての設定を完了したら、ダイアログを確認して設定を終了します。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec-samba-anmeld-serv">
  <title>ログインサーバとしてのSamba</title><indexterm> <primary>Samba</primary> <secondary>ログイン</secondary> </indexterm>

  <para>
   Windowsクライアントが大部分を占めるネットワークでは、ユーザが有効なアカウントとパスワードを持つ場合のみ登録できることが求められるのが普通です。Windowsベースのネットワークでは、このタスクはPDC (プライマリドメインコントローラ)によって処理されます。Windows NTサーバをPDCとして使用することもできますが、Sambaサーバを使用しても処理できます。<xref linkend="dat-samba-smb-conf-dom"/>に示すように、<filename>smb.conf</filename>の<literal>[global]</literal>セクションにエントリを追加する必要があります。
  </para>

  <example id="dat-samba-smb-conf-dom">
   <title>smb.confファイルのグローバルセクション</title>
<screen>[global]
    workgroup = TUX-NET
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   暗号化されたパスワードが検証目的で使用される場合、Sambaサーバはこれを処理できるはずです。これには、<literal>[global]</literal>セクションでエントリ<literal>encrypt passwords = yes</literal>を指定します(Sambaバージョン 3ではデフォルト)。また、ユーザアカウントとパスワードをWindowsに準拠した暗号化形式で作成する必要があります。そのためにはコマンド<command>smbpasswd <option>-a name</option></command>を実行します。さらに次のコマンドを使用して、Windows ドメイン概念で必要になるコンピュータのドメインアカウントを作成します。
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm> <primary>コマンド</primary><secondary>smbpasswd</secondary> </indexterm>

  <para>
   <command>useradd</command>コマンドを使用すると、ドル記号が追加されます。コマンド<command>smbpasswd</command>を指定すると、パラメータ<option>-m</option>を使用したときにドル記号が自動的に挿入されます。コメント付きの設定例(<filename>/usr/share/doc/packages/Samba/examples/smb.conf.SuSE</filename>)には、この作業を自動化するための設定が含まれています。
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   Sambaがこのスクリプトを正常に実行できるようにするため、必要な管理者権限を持つSambaユーザを選択して、<systemitem class="groupname">ntadmin</systemitem>グループに追加します。これにより、このLinuxグループに属するすべてのユーザに対し、次のコマンドによって<literal>Domain Admin</literal>ステータスを割り当てることができます。
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>

  <para>
   このトピックの詳細については、<filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>にある『Samba 3 HOWTO』の第12章を参照してください。
  </para>
 </sect1>
 
 <sect1 id="sec-samba-info">
  <title>詳細情報</title>

  <para>
   Sambaについての詳細な情報は、デジタルドキュメントの形で入手できます。コマンドラインから「<command>apropos</command><option>samba</option>」と入力するとマニュアルページを参照できます。または、Sambaマニュアルがインストールされている場合は、<filename>/usr/share/doc/packages/samba</filename>ディレクトリに格納されているオンラインマニュアルと例を参照できます。また、コメント付きの設定例(<filename>smb.conf.SUSE</filename>)が<filename>examples</filename>サブディレクトリに用意されています。<indexterm> <primary>環境設定ファイル</primary> <secondary>smb.conf</secondary> </indexterm>
  </para>

  <para>
   Sambaチームが作成した『Samba-3 HOWTO』にはトラブルシューティングについても説明されています。またマニュアルのPart Vでは、手順を追って設定を確認するためのガイドが用意されています。<systemitem>samba-doc</systemitem>パッケージのインストール後、<filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>で、『Samba-3 HOWTO』を参照できます。
  </para>

  <indexterm class="endofrange" startref="idx-Samba"/>
 </sect1>
</chapter>
