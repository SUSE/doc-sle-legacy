<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE chapter
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="snapper.xml" xml:id="cha-snapper"><title>Instantâneos/Rollback com o Snapper</title><info><abstract>
  <para>
   Criar instantâneos do sistema de arquivos com a funcionalidade de fazer rollbacks no Linux era um recurso bastante solicitado no passado. O Snapper, em conjunto com o sistema de arquivos <literal>Btrfs</literal> ou os volumes LVM com aprovisionamento dinâmico, agora cumpre esse papel.
  </para>

  <para>
   O <literal>Btrfs</literal>, um novo sistema de arquivos de gravação de cópia do Linux, suporta instantâneos de sistema de arquivos (uma cópia do estado de um subvolume em determinado ponto no tempo) de subvolumes (um ou mais sistemas de arquivos que podem ser montados separadamente em cada partição física). O Snapper permite gerenciar esses instantâneos. O Snapper vem com uma linha de comando e uma interface do YaST.
  </para>

  <para>
   Por padrão, o Snapper e o <literal>Btrfs</literal> no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> são configurados para atuar como uma <quote>ferramenta de desfazer</quote> mudanças no sistema feitas com o YaST e o zypper. Antes e após a execução de um módulo do YaST ou do zypper, um instantâneo é criado. O Snapper permite comparar os dois instantâneos e dispõe de meios para reverter as diferenças entre ambos. As ferramentas também oferecem backups do sistema criando instantâneos a cada hora dos subvolumes do sistema.
  </para>
 </abstract></info>
 
 
 <section xml:id="sec-snapper-requirements">
  <title>Requisitos</title>

  <para>
   Como o <literal>Btrfs</literal> é o único sistema de arquivos no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> que suporta instantâneos, ele é necessário em todas as partições ou subvolumes dos quais você deseja criar <quote>instantâneos</quote>.
  </para>

  <section xml:id="sec-snapper-requires-diskspace">
   <title>Instantâneos e espaço em disco</title>
   <para>
    Quando um instantâneo é criado, tanto o instantâneo quanto o original apontam para os mesmos blocos no sistema de arquivos. Por isso, o instantâneo inicialmente não ocupa espaço adicional no disco. Se os dados do sistema de arquivos original forem modificados, os blocos dos dados modificados serão copiados, enquanto os blocos dos dados antigos serão mantidos no instantâneo. Portanto, o instantâneo ocupa a mesma quantidade de espaço que os dados modificados. Ao longo do tempo, a quantidade de espaço alocada por um instantâneo cresce constantemente. Como consequência, a exclusão de arquivos do sistema de arquivos <literal>Btrfs</literal> que contém instantâneos pode <emphasis>não</emphasis> liberar espaço em disco!
   </para>
   <note>
    <title>Local do instantâneo</title>
    <para>
     Os instantâneos residem sempre na mesma partição ou subvolume do qual foi <quote>criado o instantâneo</quote>. Não é possível armazenar os instantâneos em uma partição ou um subvolume diferente.
    </para>
   </note>
   <para>
    Como resultado, as partições com os instantâneos precisam ser maiores que as partições <quote>normais</quote>. A quantidade exata depende bastante do número de instantâneos mantidos e da quantidade de modificações de dados. De acordo com a prática, convém usar o dobro do tamanho que seria usado normalmente.
   </para>
   <tip>
    <title>Liberando espaço/utilização do disco</title>
    <para>
     Para liberar espaço em uma partição do <literal>Btrfs</literal> com instantâneos, é preciso apagar instantâneos desnecessários, e não arquivos. Os instantâneos antigos ocupam mais espaço do que os novos.
    </para>
    <para>
     Como o <command>df</command> não mostra a utilização do disco correta nos sistemas de arquivos <literal>Btrfs</literal>, você precisa usar o comando <command>btrfs filesystem df</command> <replaceable>PONTO_DE_MONTAGEM</replaceable>. A exibição da quantidade de espaço em disco alocada por um instantâneo não é suportada pelas ferramentas do <literal>Btrfs</literal>.
    </para>
    <para>
     O upgrade de um service pack para outro resulta em instantâneos que ocupam muito espaço em disco nos subvolumes do sistema, porque muitos dados são modificados (atualizações de pacotes). É recomendada a exclusão manual desses instantâneos quando eles não são mais necessários.
    </para>
   </tip>
   <para>
    O Snapper também pode ser usado para criar e gerenciar instantâneos em volumes LVM com aprovisionamento dinâmico formatados com ext3 ou XFS (consulte a <xref linkend="sec-snapper-lvm"/>).
   </para>
  </section>
 </section>
 <section xml:id="sec-snapper-auto">
  <title>Usando o Snapper para desfazer mudanças no sistema</title>

  <para>
   O Snapper no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> é pré-configurado para atuar como uma ferramenta capaz de desfazer as mudanças feitas pelo <command>zypper</command> e pelo YaST. Para esta finalidade, o Snapper é configurado para criar um par de instantâneos antes e depois de cada execução do <command>zypper</command> e do YaST. O Snapper permite também restaurar arquivos do sistema que foram acidentalmente apagados ou modificados. Backups são criados de hora em hora para essa finalidade.
  </para>

  <para>
   Por padrão, os instantâneos automáticos, conforme descrito anteriormente, são configurados para a partição raiz e seus subvolumes. Para disponibilizar os instantâneos para outras partições, como <filename>/home</filename>, é possível criar configurações personalizadas.
  </para>

  <section xml:id="sec-snapper-yast">
   <title>Desfazendo mudanças do YaST e Zypper</title>
   <para>
    Se você configurar a partição raiz com o <literal>Btrfs</literal> durante a instalação, o Snapper, pré-configurado para fazer rollbacks das mudanças do YaST ou do Zypper, será instalado automaticamente. Sempre que você iniciar um módulo do YaST ou uma transação do Zypper, serão criados dois instantâneos: um <quote>pré-instantâneo</quote>, que captura o estado do sistema de arquivos antes do início do módulo, e um <quote>pós-instantâneo</quote> após o término do módulo.
   </para>
   <para>
    Usando o módulo Snapper do YaST ou a ferramenta de linha de comando <command>snapper</command>, é possível desfazer as mudanças feitas pelo YaST/zypper restaurando os arquivos do <quote>pré-instantâneo</quote>. Pela comparação dos dois instantâneos, as ferramentas permitem ver quais arquivos foram modificados. É possível também exibir as diferenças entre as duas versões de um arquivo (diff).
   </para>
   <para>
    Como o Linux é um sistema multitarefa, processos diferentes do YaST ou do Zypper podem modificar os dados no período entre o pré e o pós-instantâneo. Se esse for o caso, a reversão completa para o pré-instantâneo vai desfazer também as mudanças realizadas por outros processos. Na maioria dos casos, isso seria indesejado; no entanto, é altamente recomendável para revisar detalhadamente as mudanças entre os dois instantâneos antes de iniciar o rollback. Se houver mudanças de outros processos para manter, selecione os arquivos para voltar.
   </para>
   <important>
    <title>Limitações</title>
    <para>
     Você deve conhecer as limitações do Snapper antes de tentar usar seu mecanismo de rollback. Consulte a <xref linkend="sec-snapper-limits"/> para obter os detalhes.
    </para>
   </important>
   <note>
    <title>Tempo de armazenamento de instantâneos</title>
    <para>
     Por padrão, os últimos 100 instantâneos do YaST e do Zypper são mantidos. Se esse número for excedido, o(s) instantâneo(s) mais antigo(s) será(ão) apagado(s).
    </para>
   </note>
   <procedure xml:id="proc-snapper-yast-yast">
    <title>Desfazendo mudanças usando o módulo <guimenu>Snapper</guimenu> do YaST</title>
    <step>
     <para>
      Inicie o módulo <guimenu>Snapper</guimenu> pela seção <guimenu>Diversos</guimenu> no YaST ou digitando <command>yast2 snapper</command>.
     </para>
    </step>
    <step>
     <para>
      Confirme se a <guimenu>Configuração Atual</guimenu> está definida como <guimenu>root</guimenu>. Esse é sempre o caso, a não ser que você tenha adicionado manualmente configurações personalizadas do Snapper.
     </para>
    </step>
    <step>
     <para>
      Escolha o par de pré e pós-instantâneos na lista. Ambos os pares de instantâneos do YaST e do Zypper são do tipo <guimenu>Pré e Pós</guimenu>. Os instantâneos do YaST são denominados <literal>yast <replaceable>nome_do_módulo</replaceable></literal> na <guimenu>coluna Descrição</guimenu>; os instantâneos do Zypper são denominados <literal>zypp(zypper)</literal>.
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="snapper_yast2_list.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="snapper_yast2_list.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      Clique em <guimenu>Mostrar Mudanças</guimenu> para abrir a lista de arquivos que são diferentes entre os dois instantâneos. A imagem a seguir mostra uma lista dos arquivos que foram modificados após adicionarem o <systemitem class="username">testador</systemitem> do usuário.
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="snapper_yast2_changes.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="snapper_yast2_changes.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      Revise a lista de arquivos. Para exibir a diferença (<quote>diff</quote>) entre a versão pré e pós de um arquivo, selecione-o na lista. As imagens a seguir mostram as mudanças em <filename>/etc/passwd</filename> após a adição do <systemitem class="username">testador</systemitem> do usuário.
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="snapper_yast2_diff.png" width="65%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="snapper_yast2_diff.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      Para restaurar um conjunto de arquivos, selecione os arquivos ou diretórios relevantes marcando a respectiva caixa de seleção. Clique em <guimenu>Restaurar Selecionados</guimenu> e clique em <guimenu>Sim</guimenu> para confirmar a ação.
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="snapper_yast2_restore.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="snapper_yast2_restore.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <para>
      Para restaurar um único arquivo, ative sua tela de diff clicando em seu nome. Clique em <guimenu>Restaurar a partir do Primeiro</guimenu> e clique em <guimenu>Sim</guimenu> para confirmar sua seleção.
     </para>
    </step>
   </procedure>
   <procedure xml:id="proc-snapper-yast-cmdline">
    <title>Desfazendo mudanças usando o comando <command>snapper</command></title>
    <step>
     <para>
      Obtenha uma lista dos instantâneos do YaST e do Zypper executando o comando <command>snapper list</command> <option>-t pre-post</option>. Os instantâneos do YaST são denominados <literal>yast <replaceable>nome_do_módulo</replaceable></literal> na <guimenu>coluna Descrição</guimenu>; os instantâneos do Zypper são denominados <literal>zypp(zypper)</literal>.
     </para>
<screen><?dbsuse-fo font-size="0.60em"?>

~ # snapper list -t pre-post
     Pre # | Post # | Pre Date                 | Post Date                | Description
     ------+--------+--------------------------+--------------------------+----------------------+
     4     | 5      | Tue Jan 10 14:39:14 2012 | Tue Jan 10 14:39:33 2012 | yast system_settings
     65    | 66     | Thu Jan 12 17:18:10 2012 | Thu Jan 12 17:18:23 2012 | zypp(zypper)
     68    | 69     | Thu Jan 12 17:25:46 2012 | Thu Jan 12 17:27:09 2012 | zypp(zypper)
     73    | 74     | Thu Jan 12 17:32:55 2012 | Thu Jan 12 17:33:13 2012 | yast system_settings
     75    | 76     | Thu Jan 12 17:33:56 2012 | Thu Jan 12 17:34:42 2012 | yast users
     77    | 92     | Thu Jan 12 17:38:36 2012 | Thu Jan 12 23:13:13 2012 | yast snapper
     83    | 84     | Thu Jan 12 22:10:33 2012 | Thu Jan 12 22:10:39 2012 | zypp(zypper)
     85    | 86     | Thu Jan 12 22:16:58 2012 | Thu Jan 12 22:17:09 2012 | zypp(zypper)
     88    | 89     | Thu Jan 12 23:10:42 2012 | Thu Jan 12 23:10:46 2012 | zypp(zypper)
     90    | 91     | Thu Jan 12 23:11:40 2012 | Thu Jan 12 23:11:42 2012 | zypp(zypper)
     108   | 109    | Fri Jan 13 13:01:06 2012 | Fri Jan 13 13:01:10 2012 | zypp(zypper)
     </screen>
    </step>
    <step>
     <para>
      Obtenha uma lista dos arquivos modificados de um par de instantâneos com <command>snapper status</command> <replaceable>PRÉ</replaceable>..<replaceable>PÓS</replaceable>. Os arquivos com mudanças de conteúdo são marcados com <guimenu>c</guimenu>, os arquivos que foram adicionados são marcados com <guimenu>+</guimenu> e os arquivos apagados são marcados com <guimenu>-</guimenu>. O exemplo a seguir mostra o par de instantâneos da instalação do pacote <systemitem class="resource">ncftp</systemitem>.
     </para>
<screen>~ # snapper status 108..109
     +... /usr/bin/ncftp
     +... /usr/bin/ncftpbatch
     +... /usr/bin/ncftpget
     +... /usr/bin/ncftpls
     [...]
     +... /usr/share/man/man1/ncftpspooler.1.gz
     c... /var/cache/zypp/solv/@System/cookie
     c... /var/cache/zypp/solv/@System/solv
     c... /var/lib/rpm/Basenames
     c... /var/lib/rpm/Dirnames
     c... /var/lib/rpm/Filemd5s
     c... /var/lib/rpm/Group
     c... /var/lib/rpm/Installtid
     c... /var/lib/rpm/Name
     c... /var/lib/rpm/Packages
     c... /var/lib/rpm/Providename
     c... /var/lib/rpm/Provideversion
     c... /var/lib/rpm/Requirename
     c... /var/lib/rpm/Requireversion
     c... /var/lib/rpm/Sha1header
     c... /var/lib/rpm/Sigmd5
     c... /var/lib/zypp/SoftLocks</screen>
    </step>
    <step>
     <para>
      Para exibir a diff de determinado arquivo, execute <command>snapper diff</command> <replaceable>PRÉ</replaceable>..<replaceable>PÓS</replaceable> <replaceable>NOMEDOARQUIVO</replaceable>. Se você não especificar <replaceable>NOMEDOARQUIVO</replaceable>, será exibida a diff de todos os arquivos.
     </para>
<screen>~ # snapper diff 108..109 /var/lib/zypp/SoftLocks
     --- /.snapshots/108/snapshot/var/lib/zypp/SoftLocks	2012-01-12 23:15:22.408009164 +0100
     +++ /.snapshots/109/snapshot/var/lib/zypp/SoftLocks	2012-01-13 13:01:08.724009131 +0100
     @@ -1,4 +1,2 @@
     -# zypp::SoftLocksFile generated Thu Jan 12 23:10:46 2012
     -#
     -ncftp
     -#
     +# zypp::SoftLocksFile generated Fri Jan 13 13:01:08 2012
     +##</screen>
    </step>
    <step>
     <para>
      Para restaurar um ou mais arquivos, execute <command>snapper -v undochange</command> <replaceable>PRÉ</replaceable>..<replaceable>PÓS</replaceable> <replaceable>NOMESDOSARQUIVOS</replaceable>. Se você não especificar os <replaceable>NOMESDOSARQUIVOS</replaceable>, todos os arquivos serão restaurados.
     </para>
<screen>~ # snapper -v undochange 108..109
     create:0 modify:16 delete:21
     undoing change...
     deleting /usr/share/man/man1/ncftpspooler.1.gz
     deleting /usr/share/man/man1/ncftpput.1.gz
     [...]
     deleting /usr/bin/ncftpls
     deleting /usr/bin/ncftpget
     deleting /usr/bin/ncftpbatch
     deleting /usr/bin/ncftp
     modifying /var/cache/zypp/solv/@System/cookie
     modifying /var/cache/zypp/solv/@System/solv
     modifying /var/lib/rpm/Basenames
     modifying /var/lib/rpm/Dirnames
     modifying /var/lib/rpm/Filemd5s
     modifying /var/lib/rpm/Group
     modifying /var/lib/rpm/Installtid
     modifying /var/lib/rpm/Name
     modifying /var/lib/rpm/Packages
     modifying /var/lib/rpm/Providename
     modifying /var/lib/rpm/Provideversion
     modifying /var/lib/rpm/Requirename
     modifying /var/lib/rpm/Requireversion
     modifying /var/lib/rpm/Sha1header
     modifying /var/lib/rpm/Sigmd5
     modifying /var/lib/zypp/SoftLocks
     undoing change done</screen>
    </step>
   </procedure>
  </section>

  <section xml:id="sec-snapper-backup">
   <title>Usando o Snapper para restaurar arquivos dos backups por hora</title>
   <para>
    Além dos instantâneos do YaST e do Zypper, o Snapper cria instantâneos a cada hora da partição do sistema (<filename>/</filename>). É possível usar os instantâneos do backup para restaurar arquivos apagados ou modificados por engano sem meios de recuperação. Usando o recurso diff do Snapper, é possível também descobrir quais modificações foram feitas em determinado momento.
   </para>
   <para>
    Os instantâneos do backup por hora são do tipo <literal>Single</literal> e estão marcados com a descrição <literal>timeline</literal>. Para restaurar os arquivos desses instantâneos conforme descrito em <xref linkend="proc-snapper-yast-yast"/> ou <xref linkend="proc-snapper-yast-cmdline"/>.
   </para>
   <note>
    <title>Tempo de armazenamento de instantâneos</title>
    <para>
     Por padrão, o primeiro instantâneo dos últimos dez dias, meses e anos são mantidos. Para saber os detalhes, consulte <xref linkend="ex-snapper-config-timeline"/>.
    </para>
   </note>
  </section>

  <section xml:id="sec-snapper-config">
   <title>Criando e modificando as configurações do Snapper</title>
   <para>
    O comportamento do Snapper é definido em um arquivo de configuração específico de cada partição ou subvolume <literal>Btrfs</literal>. Esses arquivos de configuração residem em <filename>/etc/snapper/configs/</filename>. A configuração padrão instalada com o Snapper do diretório <filename>/</filename> é chamada <filename>root</filename>. Ela cria e gerencia os instantâneos do YaST e do Zypper, além do instantâneo de backup por hora do <filename>/</filename>.
   </para>
   <para>
    É possível criar suas próprias configurações para outras partições formatadas com <literal>Btrfs</literal> ou subvolumes existentes em uma partição <literal>Btrfs</literal>. No exemplo a seguir, nós definimos uma configuração do Snapper para backup dos dados do servidor Web que residem em uma partição separada formatada por <literal>Btrfs</literal> montada em <filename>/srv/www</filename>.
   </para>
   <para>
    É possível usar o próprio <command>snapper</command> ou o módulo <guimenu>Snapper</guimenu> do YaST para restaurar arquivos desses instantâneos. No YaST, você precisa selecionar a sua <guimenu>Configuração Atual</guimenu> ao especificar sua configuração para o <command>snapper</command> com o switch global <option>-c</option> (ex. <command>snapper</command> <option>-c myconfig</option> list).
   </para>
   <para>
    Para criar uma nova configuração do Snapper, execute <command>snapper create-config</command>:
   </para>
<screen>snapper -c www-data<co xml:id="snapper-create-name"/> create-config
   /srv/www<co xml:id="snapper-create-volume"/></screen>
   <calloutlist>
    <callout arearefs="snapper-create-name">
     <para>
      Nome do arquivo de configuração.
     </para>
    </callout>
    <callout arearefs="snapper-create-volume">
     <para>
      Ponto de montagem da partição ou do subvolume <literal>Btrfs</literal> para o instantâneo.
     </para>
    </callout>
   </calloutlist>
   <para>
    Esse comando cria um novo arquivo de configuração <filename>/etc/snapper/config-templates/www-data</filename> com valores padrão razoáveis (obtidos de <filename>/etc/snapper/config-templates/default</filename>).
   </para>

   <tip>
    <title>Padrões de configuração</title>
    <para>
     Os valores padrão de uma nova configuração são obtidos de <filename>/etc/snapper/config-templates/default</filename>. Para usar seu próprio conjunto de padrões, crie uma cópia desse arquivo no mesmo diretório e ajuste-o de acordo com as suas necessidades. Para usá-lo, especifique a opção <option>-t</option> com o comando create-config:
    </para>
<screen>snapper -c www-data create-config -t my_defaults /srv/www</screen>
   </tip>
   <section xml:id="sec-snapper-config-modify">
    <title>Ajustando o arquivo de configuração</title>
    <para>
     Para ajustar o arquivo de configuração, modifique-o com um editor. Ele inclui os pares de chave/valor no formato de <literal><replaceable>chave</replaceable>=<replaceable>valor</replaceable></literal>. Só é possível mudar o <replaceable>valor</replaceable>.
    </para>
    <variablelist>
     <varlistentry>
      <term><literal>SUBVOLUME</literal>
      </term>
      <listitem>
       <para>
        Ponto de montagem da partição ou do subvolume para o instantâneo. Não alterar.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>FSTYPE</literal>
      </term>
      <listitem>
       <para>
        Tipo de sistema de arquivos da partição. Não alterar.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>NUMBER_CLEANUP</literal>
      </term>
      <listitem>
       <para>
        Define se é para apagar automaticamente os instantâneos antigos quando a quantidade total exceder o número especificado com <literal>NUMBER_LIMIT</literal> <emphasis>e</emphasis> a duração especificada com <literal>NUMBER_MIN_AGE</literal>. Valores válidos: <literal>yes</literal>, <literal>no</literal>
       </para>
       <note>
        <title>Limite e duração</title>
        <para>
         <literal>NUMBER_LIMIT</literal> e <literal>NUMBER_MIN_AGE</literal> são sempre avaliados juntos. Os instantâneos são apagados apenas quando ocorrem as <emphasis>duas</emphasis> condições. Para sempre manter determinado número de instantâneos independentemente de sua duração, defina <literal>NUMBER_MIN_AGE</literal> como <literal>0</literal>. Por outro lado, para não manter os instantâneos após certa duração, defina <literal>NUMBER_LIMIT</literal> como <literal>0</literal>.
        </para>
       </note>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>NUMBER_LIMIT</literal>
      </term>
      <listitem>
       <para>
        Define quantos instantâneos manter quando <literal>NUMBER_CLEANUP</literal> está definido como <literal>yes</literal>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>NUMBER_MIN_AGE</literal>
      </term>
      <listitem>
       <para>
        Define a duração mínima em segundos do instantâneo antes de ser automaticamente apagado.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>TIMELINE_CREATE</literal>
      </term>
      <listitem>
       <para>
        Se definido como <literal>yes</literal>, serão criados instantâneos de hora em hora. Essa é a única forma de criar automaticamente os instantâneos, embora seja altamente recomendável defini-lo como <literal>yes</literal>. Valores válidos: <literal>yes</literal>, <literal>no</literal>
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>TIMELINE_CLEANUP</literal>
      </term>
      <listitem>
       <para>
        Define se é para apagar automaticamente os instantâneos antigos quando a quantidade exceder o número especificado com as opções <literal><replaceable>TIMELINE_LIMIT_*</replaceable></literal> <emphasis>e</emphasis> a duração especificada com <literal>TIMELINE_MIN_AGE</literal>. Valores válidos: <literal>yes</literal>, <literal>no</literal>
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>TIMELINE_MIN_AGE</literal>
      </term>
      <listitem>
       <para>
        Define a duração mínima em segundos do instantâneo antes de ser automaticamente apagado.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>TIMELINE_LIMIT_HOURLY</literal>, <literal>TIMELINE_LIMIT_DAILY</literal>, <literal>TIMELINE_LIMIT_MONTHLY</literal>, <literal>TIMELINE_LIMIT_YEARLY</literal>
      </term>
      <listitem>
       <para>
        Número de instantâneos para manter por hora, dia, mês, ano.
       </para>
       <example xml:id="ex-snapper-config-timeline">
        <title>Exemplo de configuração de linha do tempo</title>
<screen>TIMELINE_CREATE="yes"
        TIMELINE_CLEANUP="yes"
        TIMELINE_MIN_AGE="1800"
        TIMELINE_LIMIT_HOURLY="10"
        TIMELINE_LIMIT_DAILY="10"
        TIMELINE_LIMIT_MONTHLY="10"
        TIMELINE_LIMIT_YEARLY="10"
        </screen>
       </example>
       <para>
        Este exemplo de configuração habilita os instantâneos por hora, que são limpos automaticamente. <literal>TIMELINE_MIN_AGE</literal> e <literal>TIMELINE_LIMIT_*</literal> são sempre avaliados juntos. Neste exemplo, a duração mínima de um instantâneo, antes de ser apagado, está definida como 30 minutos (1800 segundos). Como nós criamos instantâneos por hora, isso garante que apenas os instantâneos mais recentes sejam mantidos. Se <literal>TIMELINE_LIMIT_DAILY</literal> não estiver definido como zero, significa que o primeiro instantâneo do dia também será mantido.
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <title>Instantâneos para manter</title>
        <listitem>
         <para>
          De hora em hora: Os últimos dez instantâneos que foram criados.
         </para>
        </listitem>
        <listitem>
         <para>
          Diariamente: O primeiro instantâneo diário criado é mantido para os últimos dez dias.
         </para>
        </listitem>
        <listitem>
         <para>
          Mensalmente: O primeiro instantâneo criado no último dia do mês é mantido para os últimos dez meses.
         </para>
        </listitem>
        <listitem>
         <para>
          Anualmente: O primeiro instantâneo criado no último dia do ano é mantido para os últimos dez anos.
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="sec-snapper-config-user">
    <title>Usando o Snapper como usuário comum</title>
    <para>
     Por padrão, o Snapper só pode ser usado pelo <systemitem class="username">root</systemitem>. No entanto, há casos em que determinados grupos ou usuários precisam criar instantâneos ou desfazer mudanças revertendo um instantâneo:
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       um administrador de site na Web deseja criar um instantâneo de <filename>/srv/www</filename>.
      </para>
     </listitem>
     <listitem>
      <para>
       um administrador de banco de dados deseja criar um instantâneo dos bancos de dados.
      </para>
     </listitem>
     <listitem>
      <para>
       um usuário deseja criar um instantâneo de seu diretório pessoal.
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Para essas finalidades, é possível criar configurações do Snapper que concedam permissões a usuários ou grupos. Além da mudança nessa configuração, os usuários especificados devem conseguir ler e acessar o diretório <filename>.snapshots</filename> correspondente.
    </para>
    <procedure>
     <title>Habilitando usuários comuns a usar o Snapper</title>
     <para>
      Observe que todas as etapas deste procedimento devem ser executadas pelo <systemitem class="username">root</systemitem>.
     </para>
     <step>
      <para>
       Se não houver um, crie uma configuração do Snapper para a partição ou o subvolume em que o usuário consiga utilizar o Snapper. Consulte a <xref linkend="sec-snapper-config"/> para obter instruções. Exemplo:
      </para>
<screen>snapper --config web_data create /srv/www</screen>
     </step>
     <step>
      <para>
       O arquivo de configuração é criado em <filename>/etc/snapper/configs/<replaceable>NOME</replaceable></filename>, em que NOME é o valor que você especificou com <option>-c/--config</option> na etapa anterior (por exemplo, <filename>/etc/snapper/configs/web_data</filename>). Ajuste-o de acordo com as suas necessidades. Consulte a <xref linkend="sec-snapper-config-modify"/> para obter os detalhes.
      </para>
     </step>
     <step>
      <para>
       Defina os valores de <envar>ALLOW_USERS</envar> e <envar>ALLOW_GROUPS</envar> para conceder permissões a usuários e grupos, respectivamente. Separe várias entradas com <keycap function="space"/>. Para conceder permissões ao usuário <systemitem class="username">www_admin</systemitem>; por exemplo, digite:
      </para>
<screen>ALLOW_USERS="www_admin"</screen>
     </step>
     <step>
      <para>
       Conceda permissões de leitura e acesso ao diretório de instantâneos <replaceable>CAMINHO</replaceable>/.snapshots. <replaceable>CAMINHO</replaceable> deve ser substituído pelo subvolume especificado na primeira etapa deste procedimento. Exemplo:
      </para>
<screen>chmod a+rx /srv/www/.snapshots</screen>
      <para>
       Agora o(s) usuário(s) e grupo(s) pode(m) utilizar a configuração especificada do Snapper. É possível testá-la com o comando <literal>list</literal>, por exemplo:
      </para>
<screen>www_admin:~ &gt; snapper -c web_data list</screen>
     </step>
    </procedure>
   </section>
  </section>

  <section xml:id="sec-snapper-disable">
   <title>Desabilitando instantâneos automáticos</title>
   <para>
    Se você configurou a partição raiz com <literal>Btrfs</literal> durante a instalação, o Snapper criará automaticamente instantâneos do sistema a cada hora, além de pré e pós-instantâneos das transações do YaST e do zypper. Cada uma dessas tarefas pode ser desabilitada da seguinte forma:
   </para>
   <variablelist>
    <varlistentry>
     <term>Desabilitando instantâneos por hora</term>
     <listitem>
      <para>
       Edite <filename>/etc/snapper/configs/root</filename> e defina <envar>TIMELINE_CREATE</envar> como <literal>no</literal>:
      </para>
<screen>TIMELINE_CREATE="no"</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Desabilitando instantâneos do Zypper</term>
     <listitem>
      <para>
       Desinstale o pacote <systemitem class="resource">snapper-zypp-plugin</systemitem>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Desabilitando instantâneos do YaST</term>
     <listitem>
      <para>
       Edite <filename>/etc/sysconfig/yast2</filename> e defina <envar>USE_SNAPPER</envar> como <literal>no</literal>:
      </para>
<screen>USE_SNAPPER="no"</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
 </section>
 <section xml:id="sec-snapper-manage">
  <title>Criando e gerenciando instantâneos manualmente</title>

  <para>
   Não é possível apenas criar e gerenciar os instantâneos automaticamente pela configuração do Snapper, você também pode criar pares de instantâneos (<quote>antes e após</quote>) ou instantâneos únicos manualmente usando a ferramenta de linha de comando ou o módulo do YaST.
  </para>

  <para>
   Todas as operações do Snapper são executadas de acordo com uma configuração existente (consulte a <xref linkend="sec-snapper-config"/> para obter os detalhes). Você só pode criar instantâneo de partições ou volumes em que exista uma configuração. Por padrão, a configuração do sistema (<literal>root</literal>) é usada. Para criar ou gerenciar instantâneos com sua própria configuração, selecione-a de maneira clara. Use o menu suspenso <guimenu>Configuração Atual</guimenu> no YaST ou especifique <option>-c</option> na linha de comando (<command>snapper</command> <option>-c</option> <replaceable>MINHACONFIG</replaceable> <replaceable>COMANDO</replaceable>).
  </para>

  <section xml:id="sec-snapper-manage-metadata">
   <title>Metadados de instantâneos</title>
   <para>
    Cada instantâneo consiste no próprio instantâneo e em alguns metadados. Ao criar um instantâneo, você também precisa especificar os metadados. A modificação de um instantâneo também altera seus metadados; não é possível modificar seu conteúdo. Os seguintes metadados estão disponíveis para cada instantâneo:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <emphasis role="bold">Tipo</emphasis>: Tipo do instantâneo, consulte a <xref linkend="sec-snapper-manage-metadata-type"/> para obter os detalhes. Esses dados não podem ser mudados.
     </para>
    </listitem>
    <listitem>
     <para>
      <emphasis role="bold">Número</emphasis>: Número exclusivo do instantâneo. Esses dados não podem ser mudados.
     </para>
    </listitem>
    <listitem>
     <para>
      <emphasis role="bold">Número do Pré</emphasis>: Especifica o número do pré-instantâneo correspondente. Apenas para instantâneos do tipo pós. Esses dados não podem ser mudados.
     </para>
    </listitem>
    <listitem>
     <para>
      <emphasis role="bold">Descrição</emphasis>: A descrição do instantâneo.
     </para>
    </listitem>
    <listitem>
     <para>
      <emphasis role="bold">Dados de usuário</emphasis>: Uma descrição estendida que especifica os dados personalizados no formato de uma lista de chave=valor separada por vírgula: <literal>reason=testing_stuff, user=tux</literal>
     </para>
    </listitem>
    <listitem>
     <para>
      <emphasis role="bold">Algoritmo de Limpeza</emphasis>: Algoritmo de limpeza do instantâneo. Consulte a <xref linkend="sec-snapper-manage-metadata-cleanup"/> para obter os detalhes.
     </para>
    </listitem>
   </itemizedlist>
   <section xml:id="sec-snapper-manage-metadata-type">
    <title>Tipos de instantâneos</title>
    <para>
     O Snapper reconhece três tipos diferentes de instantâneos: pre (pré), post (pós) e single (único). Eles são iguais fisicamente, mas o Snapper trabalha com eles de forma diferente.
    </para>
    <variablelist>
     <varlistentry>
      <term><literal>pre</literal>
      </term>
      <listitem>
       <para>
        Instantâneo de um sistema de arquivos <emphasis>antes</emphasis> da modificação. Cada instantâneo <literal>pre</literal> tem o seu <literal>post</literal> correspondente. Por exemplo, usado para instantâneos automáticos do YaST/zypper.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>post</literal>
      </term>
      <listitem>
       <para>
        Instantâneo de um sistema de arquivos <emphasis>após</emphasis> a modificação. Cada instantâneo <literal>post</literal> tem o seu <literal>pre</literal> correspondente. Por exemplo, usado para instantâneos automáticos do YaST/zypper.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>single</literal></term>
      <listitem>
       <para>
        Instantâneo independente. Usado, por exemplo, para instantâneos automáticos por hora. Esse é o tipo padrão quando se cria instantâneos.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
   <section xml:id="sec-snapper-manage-metadata-cleanup">
    <title>Algoritmos de limpeza</title>
    <para>
     O Snapper oferece três algoritmos para limpeza de instantâneos antigos. Os algoritmos são executados em uma tarefa cron diária. A frequência de limpeza é definida na configuração do Snapper para a partição ou o subvolume (consulte a <xref linkend="sec-snapper-config-modify"/> para obter os detalhes).
    </para>
    <variablelist>
     <varlistentry>
      <term>number</term>
      <listitem>
       <para>
        Apaga instantâneos antigos quando determinado número de instantâneos é atingido.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>time line</term>
      <listitem>
       <para>
        Apaga instantâneos antigos que passaram de certa duração, mas mantém um número de instantâneos por hora, dia, mês e ano.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>empty-pre-post</term>
      <listitem>
       <para>
        Apaga os pares de pré/pós-instantâneos com diffs vazias.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </section>
  </section>

  <section xml:id="sec-snapper-manage-create">
   <title>Criando instantâneos</title>
   <para>
    A criação do instantâneo é feita executando o comando <command>snapper create</command> ou clicando em <guimenu>Criar</guimenu> no módulo <guimenu>Snapper</guimenu> do YaST. Os exemplos a seguir explicam como criar instantâneos da linha de comando. Eles são fáceis de adotar ao usar a interface do YaST.
   </para>
   <tip>
    <title>Descrição do instantâneo</title>
    <para>
     Especifique sempre uma descrição significativa para no futuro conseguir identificar sua finalidade. É possível especificar ainda mais informações na opção de dados do usuário.
    </para>
   </tip>
   <para/>
   <variablelist>
    <varlistentry>
     <term><command>snapper create</command> <option>--description "Snapshot for week 2 2013"</option>
     </term>
     <listitem>
      <para>
       Cria um instantâneo independente (tipo único) na configuração padrão (<literal>root</literal>) com uma descrição. Como nenhum algoritmo de limpeza foi especificado, o instantâneo nunca será apagado automaticamente.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>snapper</command> <option>--config home</option> create <option>--description "Cleanup in ~tux"</option>
     </term>
     <listitem>
      <para>
       Cria um instantâneo independente (tipo único) em uma configuração personalizada chamada <literal>home</literal> com uma descrição. Como nenhum algoritmo de limpeza foi especificado, o instantâneo nunca será apagado automaticamente.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>snapper</command> <option>--config home</option> create <option>--description "Daily data backup" --cleanup-algorithm timeline</option>
     </term>
     <listitem>
      <para>
       Cria um instantâneo independente (tipo único) em uma configuração personalizada chamada <literal>home</literal> com uma descrição. O arquivo é apagado automaticamente quando atende aos critérios especificados no algoritmo de limpeza de linha do tempo da configuração.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>snapper create</command> <option>--type pre</option><option>--print-number</option><option>--description "Before the Apache config cleanup"</option>
     </term>
     <listitem>
      <para>
       Cria um instantâneo do tipo <literal>pre</literal> e imprime o número do instantâneo. Primeiro comando necessário para criar um par de instantâneos usado para gravar o estado <quote>antes</quote> e <quote>após</quote>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>snapper create</command> <option>--type post</option><option>--pre-number 30</option><option>--description "After the Apache config cleanup"</option>
     </term>
     <listitem>
      <para>
       Cria um instantâneo do tipo <literal>post</literal> ligado a seu par <literal>pre</literal> de número <literal>30</literal>. Segundo comando necessário para criar um par de instantâneos usado para gravar o estado <quote>antes</quote> e <quote>após</quote>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>snapper create</command> <option>--command <replaceable>COMANDO</replaceable></option><option>--description "Before and after COMANDO"</option>
     </term>
     <listitem>
      <para>
       Cria automaticamente um par de instantâneos antes e após a execução do <replaceable>COMANDO</replaceable>. Essa opção só está disponível ao usar o snapper na linha de comando.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>

  <section xml:id="sec-snapper-manage-modify">
   <title>Modificando os metadados do instantâneo</title>
   <para>
    O Snapper permite modificar a descrição, o algoritmo de limpeza e os dados de usuário de um instantâneo. Todos os outros metadados não podem ser mudados. Os exemplos a seguir explicam como modificar instantâneos da linha de comando. Eles são fáceis de adotar ao usar a interface do YaST.
   </para>
   <para>
    Para modificar um instantâneo na linha de comando, você precisa saber o número dele. Use <command>snapper</command> <option>list</option> para exibir todos os instantâneos e seus números.
   </para>
   <para>
    O módulo <guimenu>Snapper</guimenu> do YaST já lista todos os instantâneos. Escolha um na lista e clique em <guimenu>Modificar</guimenu>.
   </para>
   <variablelist>
    <varlistentry>
     <term><command>snapper modify</command> <option>--cleanup-algorithm "timeline"</option> 10
     </term>
     <listitem>
      <para>
       Modifica os metadados do instantâneo 10 na configuração padrão (<literal>root</literal>). O algoritmo de limpeza é definido como <literal>timeline</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>snapper</command> <option>--config home</option> modify <option>--description "daily backup" -cleanup-algorithm "timeline"</option>120
     </term>
     <listitem>
      <para>
       Modifica os metadados do instantâneo 120 na configuração personalizada chamada <literal>home</literal>. Uma nova descrição é definida e o algoritmo de limpeza fica indefinido.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>

  <section xml:id="sec-snapper-manage-delete">
   <title>Apagando instantâneos</title>
   <para>
    Para apagar um instantâneo com o módulo <guimenu>Snapper</guimenu> do YaST, escolha-o na lista e clique em <guimenu>Apagar</guimenu>.
   </para>
   <para>
    Para apagar um instantâneo com a ferramenta de linha de comando, você precisa saber o número dele. Para saber, execute <command>snapper list</command>. Para apagar um instantâneo, execute <command>snapper delete</command> <replaceable>NÚMERO</replaceable>.
   </para>
   <tip>
    <title>Apagando pares de instantâneos</title>
    <para>
     Ao apagar um instantâneo <literal>pre</literal>, sempre apague seu <literal>post</literal> correspondente (e vice-versa).
    </para>
   </tip>
   <variablelist>
    <varlistentry>
     <term><command>snapper delete 65</command>
     </term>
     <listitem>
      <para>
       Apaga o instantâneo 65 na configuração padrão (<literal>root</literal>).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>snapper</command> <option>-c home</option> delete 89 90
     </term>
     <listitem>
      <para>
       Apaga os instantâneos 89 e 90 na configuração personalizada chamada <literal>home</literal>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <tip>
    <title>Instantâneos antigos ocupam mais espaço em disco</title>
    <para>
     Se você apagar instantâneos para liberar espaço no disco rígido (consulte a <xref linkend="sec-snapper-requires-diskspace"/> para obter os detalhes), apague primeiro os instantâneos antigos. Quanto mais antigo for o instantâneo, mais espaço em disco ele ocupa.
    </para>
   </tip>
   <para>
    Os instantâneos também são automaticamente apagados por uma tarefa cron diária. Consulte a <xref linkend="sec-snapper-manage-metadata-cleanup"/> para obter os detalhes.
   </para>
  </section>
 </section>
 <section xml:id="sec-snapper-limits">
  <title>Limitações</title>

  <para>
   Apesar de estarem prontos para produção, o <literal>Btrfs</literal> e o Snapper estão em constante desenvolvimento. As seguintes limitações existem no momento. Há planos de se resolver estes problemas em versões futuras.
  </para>

  <section xml:id="sec-snapper-limits-consistency">
   <title>Consistência de dados</title>
   <para>
    Não existe um mecanismo que garanta a consistência dos dados na hora de criar um instantâneo. Sempre que um arquivo é gravado (ex. um banco de dados) ao mesmo tempo que um instantâneo é criado, o resultado é um arquivo danificado ou gravado parcialmente. A restauração desse arquivo causa problemas. Portanto, é altamente recomendável <emphasis>sempre</emphasis> revisar com cuidado a lista de arquivos modificados e suas diffs. Apenas restaure arquivos que realmente tenham que fazer parte da ação que deseja voltar.
   </para>
  </section>

  <section xml:id="sec-snapper-limits-user">
   <title>Revertendo adições de usuário</title>
   <para>
    Normalmente, <filename>/home</filename> reside em uma partição separada. Essa partição separada não faz parte da configuração padrão de rollbacks do YaST. Portanto, a partição pessoal do usuário não será apagada durante a reversão de uma adição de usuário com o Snapper. É altamente recomendável usar a ferramenta do YaST <guimenu>Gerenciamento de Usuários e Grupos</guimenu> para remover usuários.
   </para>
  </section>

  <section xml:id="sec-snapper-limits-kernel">
   <title>Nenhuma mudança no rollback em <filename>/boot</filename> e no carregador de boot</title>
   <para>
    O <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> não pode ser inicializado de partições <literal>Btrfs</literal>. Portanto, uma partição separada para <filename>/boot</filename> é criada durante a instalação ao usar o <literal>Btrfs</literal> para a partição do sistema. Como <filename>/boot</filename> não suporta instantâneos, as seguintes restrições se aplicam aos rollbacks do YaST/zypper:
   </para>
   <variablelist>
    <varlistentry>
     <term>sem rollback de qualquer mudança de configuração no carregador de boot</term>
     <listitem>
      <para>
       O único arquivo que pode ser voltado é o arquivo de configuração do carregador de boot em <filename>/etc</filename>. Os arquivos principais de configuração residem em <filename>/boot</filename> e não podem ser voltados.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>sem rollback completo para instalações do Kernel</term>
     <listitem>
      <para>
       O Kernel e seu initrd são instalados na partição <filename>/boot</filename>, enquanto os módulos ou as fontes do Kernel são instalados em <filename>/var/lib</filename> e <filename>/usr/src</filename>, respectivamente. Além disso, cada instalação do Kernel também muda os arquivos de configuração do carregador de boot em /boot. Portanto, sempre que fizer um rollback que envolva desfazer uma instalação do Kernel, você precisará remover manualmente o Kernel e seu initrd de /boot e ajustar a configuração do carregador de boot removendo a entrada de boot do Kernel.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
 </section>
 <section xml:id="sec-snapper-faqs">
  <title>Perguntas mais frequentes</title>

  <variablelist>
   <varlistentry>
    <term>
     Por que o Snapper nunca mostra as mudanças em <filename>/var/log</filename>, <filename>/tmp</filename> e em outros diretórios?
    </term>
    <listitem>
     <para>
      Para alguns diretórios, nós decidimos desabilitar a <quote>criação de instantâneo</quote>; por exemplo, <filename>/var/log</filename>, já que a reversão de registros dificulta a pesquisa por problemas. Para excluir um caminho de <quote>criação de instantâneo</quote>, nós criamos um subvolume para esse caminho. Os seguintes pontos de montagem não estão incluídos na <quote>criação de instantâneo</quote> no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>:
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <filename>/opt</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/srv</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/tmp</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/var/crash</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/var/log</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/var/run</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/var/spool</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/var/tmp</filename>
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Posso inicializar um instantâneo do carregador de boot?</term>
    <listitem>
     <para>
      Isso não é possível no momento. O carregador de boot no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> não suporta inicialização de uma partição <literal>Btrfs</literal>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 <section xml:id="sec-snapper-lvm">
  <title>Usando o Snapper em volumes LVM com aprovisionamento dinâmico</title>

  <para>
   Além dos instantâneos em sistemas de arquivos <literal>Btrfs</literal>, o snapper também suporta a <quote>criação de instantâneo</quote> em volumes LVM com aprovisionamento dinâmico (instantâneos em volumes LVM comuns <emphasis>não</emphasis> são suportados) formatados com ext3 ou XFS. Para obter mais informações e instruções de configuração, consulte a <xref linkend="sec-yast2-system-lvm"/>.
  </para>

  <para>
   Para usar o Snapper em um volume LVM com aprovisionamento dinâmico, crie para ele uma configuração do Snapper. No LVM, é necessário especificar o sistema de arquivos com <option>--fstype=lvm(<replaceable>SISTEMADEARQUIVOS</replaceable>)</option>. Os dados ext3 e XFS são suportados, portanto <literal>ext3</literal> ou <literal>xfs</literal> são valores válidos para <replaceable>SISTEMADEARQUIVOS</replaceable>. Exemplo:
  </para>

<screen>snapper -c lvm create-config --fstype="lvm(xfs)" /thin_lvm</screen>

  <para>
   É possível ajustar essa configuração de acordo com as suas necessidades conforme descrito na <xref linkend="sec-snapper-config-modify"/>. Agora, é possível usar o Snapper para criar e gerenciar instantâneos, restaurar arquivos e desfazer mudanças, conforme descrito anteriormente.
  </para>
 </section>
</chapter>
