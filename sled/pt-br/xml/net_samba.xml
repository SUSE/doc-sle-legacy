<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="net_samba.xml" id="cha.samba">
 <title>Samba</title><indexterm id="idx.Samba" class="startofrange"> <primary>Samba</primary> </indexterm> <indexterm> <primary>SMB</primary> <see>Samba</see> </indexterm> <indexterm> <primary>Mac OS X</primary> <secondary>compartilhando arquivos</secondary> </indexterm> <indexterm> <primary>Windows</primary> <secondary>compartilhando arquivos</secondary> </indexterm> <indexterm> <primary>OS/2</primary> <secondary>compartilhando arquivos</secondary> </indexterm> <indexterm> <primary>Linux</primary> <secondary>compartilhando arquivos com outro OS</secondary> </indexterm>
 <abstract>
  <para>
   Com o Samba, uma máquina Unix pode ser configurada como um servidor de arquivos e de impressão para máquinas Mac OS X, Windows e OS/2. O Samba se tornou um produto completo e bastante complexo. Configure o Samba com o YaST, o SWAT (uma interface da Web) ou editando o arquivo de configuração manualmente.
  </para>
 </abstract>
 <sect1 id="sec.samba.term">
  <title>Terminologia</title>

  <para>
   A seguir são apresentados alguns termos usados na documentação do Samba e no módulo YaST.
  </para>

  <variablelist>
   <varlistentry>
    <term>Protocolo SMB</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>SMB</secondary> </indexterm> <indexterm> <primary>protocolos</primary> <secondary>SMB</secondary> </indexterm> <indexterm> <primary>smbd</primary> </indexterm> O Samba usa o protocolo SMB (bloco de mensagens do servidor), que é baseado nos serviços <phrase role="productname">NetBIOS</phrase>. A Microsoft lançou o protocolo para que outros fabricantes de software pudessem estabelecer conexões com uma rede de domínio Microsoft. Com o Samba, o protocolo SMB opera acima do protocolo TCP/IP, de modo que este último precisa estar instalado em todos os clientes. <indexterm> <primary>Samba</primary> <secondary>TCP/IP e</secondary> </indexterm>
     </para>
     
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Protocolo CIFS</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>CIFS</secondary> </indexterm> <indexterm> <primary>protocolos</primary> <secondary>CIFS</secondary> </indexterm> O protocolo CIFS (sistema de arquivos da Internet comuns) é outro protocolo que possui suporte no Samba. O CIFS é um protocolo de acesso padrão a sistemas de arquivos remotos para utilização pela rede, permitindo que grupos de usuários trabalhem juntos e compartilhem documentos pela rede.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS<indexterm> <primary>Samba</primary> <secondary>nomes</secondary> </indexterm></term>
    <listitem>
     <para>
      <indexterm> <primary>NetBIOS</primary> </indexterm> NetBIOS é uma interface de software (API) projetada para a comunicação entre máquinas que fornecem serviço de nomes. Ele permite que máquinas conectadas à rede reservem nomes para si. Após a reserva, essas máquinas podem ser tratadas pelo nome. Não há um processo central para a verificação de nomes. Qualquer máquina da rede pode reservar quantos nomes quiser, contanto que os nomes não estejam em uso ainda. A interface NetBIOS pode ser implementada para diferentes arquiteturas de rede. Uma implementação que funciona com relativa proximidade com o hardware da rede é chamada de <phrase role="productname">NetBEUI</phrase>, mas ela muitas vezes é chamada de <phrase role="productname">NetBIOS</phrase>. Os protocolos de rede implementados com o NetBIOS são o IPX da Novell (NetBIOS via TCP/IP) e TCP/IP.
     </para>
     <para>
      Os nomes de NetBIOS enviados por TCP/IP não possuem nada em comum com os nomes usados em <filename>/etc/hosts</filename> ou com os nomes definidos pelo DNS. O NetBIOS usa sua própria convenção de nomes independente. Contudo, é recomendável usar nomes que correspondam aos nomes de hosts DNS para facilitar a administração ou usar o DNS nativamente. Esse é o padrão usado pelo Samba.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Servidor Samba<indexterm> <primary>Samba</primary> <secondary>servidor</secondary> </indexterm></term>
    <listitem>
     <para>
      O servidor Samba fornece serviços SMB/CIFS e serviços de nomeação NetBIOS por IP aos clientes. Para o Linux, existem três daemons para servidor Samba: smbd para serviços SMB/CIFS, nmbd para serviços de nomeação e winbind para autenticação.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Cliente Samba<indexterm id="idx.Samba_clients" class="startofrange"> <primary>Samba</primary> <secondary>clientes</secondary> </indexterm></term>
    <listitem>
     <para>
      O cliente Samba é um sistema que usa serviços Samba de um servidor Samba pelo protocolo SMB. Todos os sistemas operacionais comuns, como Mac OS X, Windows e OS/2, prestam suporte ao protocolo SMB. O protocolo TCP/IP precisa estar instalado em todos os computadores. O Samba fornece um cliente para as diferentes versões do UNIX. No caso do Linux, há um módulo de kernel para SMB que permite a integração de recursos SMB no nível de sistema Linux. Não é necessário executar nenhum daemon para o cliente Samba.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Compartilhamentos</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>compartilhamentos</secondary> </indexterm> Os servidores SMB oferecem recursos aos clientes por meio de compartilhamentos. Compartilhamentos são impressoras e diretórios com seus subdiretórios no servidor. Ele é exportado por meio de um nome e pode ser acessado pelo nome. O nome do compartilhamento pode ser definido por qualquer nome; não precisa ser o nome do diretório de exportação. Uma impressora também recebe um nome. Os clientes podem acessar a impressora pelo nome. <indexterm> <primary>imprimindo</primary> <secondary>Samba</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>impressoras</secondary> </indexterm> <indexterm class="endofrange" startref="idx.Samba_clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>DC</secondary> </indexterm> Um controlador de domínio (DC) é um servidor que gerencia contas em domínios. Para a replicação de dados, os controladores de domínio adicionais estão disponíveis em um domínio.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 
 
 <sect1 id="sec.samba.serv.inst">
  <title>Configurando um servidor Samba</title><indexterm> <primary>Samba</primary> <secondary>instalando</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>servidores</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>configurando</secondary> </indexterm> <indexterm> <primary>configurando</primary> <secondary>Samba</secondary> </indexterm>

  

  <para os="sled">
   Para configurar um servidor Samba, consulte a documentação do SUSE Linux Enterprise Server.
  </para>

  

  

  
 </sect1>
 <sect1 id="sec.samba.client.inst">
  <title>Configurando clientes</title><indexterm> <primary>Samba</primary> <secondary>clientes</secondary> </indexterm>

  <para>
   Os clientes somente podem acessar o servidor Samba via TCP/IP. O NetBEUI e o NetBIOS via IPX não podem ser usados com o Samba.
  </para>

  <sect2 id="sec.samba.client.inst.yast">
   <title>Configurando um cliente Samba com o YaST</title><indexterm> <primary>YaST</primary> <secondary>Samba</secondary> <tertiary>clientes</tertiary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>clientes</secondary> </indexterm> <indexterm> <primary>configurando</primary> <secondary>Samba</secondary> <tertiary>clientes</tertiary> </indexterm>
   <para>
    Configure um cliente Samba para acessar recursos (arquivos ou impressoras) no servidor Samba ou Windows. Digite o domínio NT ou Active Directory ou o grupo de trabalho na caixa de diálogo <menuchoice> <guimenu>Serviços de Rede</guimenu> <guimenu>Participação no Domínio do Windows</guimenu></menuchoice>. Se você ativar <guimenu>Também Usar Informação SMB para Autenticação Linux</guimenu>, a autenticação do usuário será executada no servidor Samba, NT ou Kerberos.
   </para>

   <para>
    Clique em <guimenu>Configurações de Especialista</guimenu> para ver as opções de configuração avançadas. Por exemplo, use a tabela <guimenu>Montar Diretórios do Servidor</guimenu> para habilitar a montagem de diretório pessoal do servidor automaticamente com autenticação. Assim os usuários poderão acessar seus diretórios pessoais quando estiverem hospedados no CIFS. Para ver os detalhes, consulte a página de manual de <systemitem>pam_mount</systemitem>.
   </para>
   <para>
    Após concluir todas as configurações, confirme a caixa de diálogo para terminar a configuração.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.samba.anmeld.serv">
  <title>Samba como servidor de login</title><indexterm> <primary>Samba</primary> <secondary>login</secondary> </indexterm>

  <para>
   Em redes onde se encontram predominantemente clientes Windows, muitas vezes é preferível que os usuários somente possam se registrar com uma conta e senha válidos. Em uma rede baseada no Windows, essa tarefa é gerenciada por um PDC (primary domain controller — controlador de domínio primário). Você pode usar um servidor Windows NT configurado como PDC, mas essa tarefa também pode ser executada com um servidor Samba. As entradas a serem feitas na seção <literal>[global]</literal> de <filename>smb.conf</filename> aparecem em <xref linkend="dat.samba.smb.conf.dom"/>.
  </para>

  <example id="dat.samba.smb.conf.dom">
   <title>Seção global em smb.conf</title>
<screen>[global]
    workgroup = TUX-NET
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   Se forem usadas senhas criptografadas para fins de verificação, os servidores Samba devem ser capazes de gerenciá-las. A entrada <literal>encrypt passwords = yes</literal> na seção <literal>[global]</literal> permite isso (com a versão 3 do Samba, esse passa a ser o padrão). Além disso, é necessário preparar contas e senhas de usuários em formato de criptografia compatível com o Windows. Para isso, use o comando <command>smbpasswd<option> -a name</option></command>. Crie a conta de domínio dos computadores, exigida pelo conceito de domínio do Windows , com os seguintes comandos:
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm> <primary>comandos</primary> <secondary>smbpasswd</secondary> </indexterm>

  <para>
   Com o comando <command>useradd</command>, um símbolo de cifrão é adicionado. O comando <command>smbpasswd</command> insere esse símbolo automaticamente quando o parâmetro <option>-m</option> é usado. O exemplo de configuração comentado (<filename>/usr/share/doc/packages/samba/examples/smb.conf.SUSE</filename>) contém configurações que automatizam essa tarefa.
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   Para certificar-se de que o Samba possa executar esse script corretamente, escolha um usuário do Samba com as permissões de administrador necessárias e adicione-o ao grupo <systemitem class="groupname">ntadmin</systemitem>. Em seguida, será possível atribuir a todos os usuários pertencentes a esse grupo Linux o status de <literal>Domain Admin</literal> com o comando:
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>

  <para>
   Para obter mais informações sobre este tópico, consulte o Capítulo 12 do HOWTO do Samba 3, encontrado em <filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>.
  </para>
 </sect1>
 
 <sect1 id="sec.samba.info">
  <title>Para obter mais informações</title>

  <para>
   Informações detalhadas sobre o Samba estão disponíveis na documentação digital. Para obter mais documentação e exemplos online, digite <command>apropos</command> <option>samba</option> na linha de comando para exibir algumas páginas de manual ou simplesmente pesquise no diretório <filename>/usr/share/doc/packages/samba</filename>, se a documentação do Samba estiver instalada. Um exemplo de configuração comentado (<filename>smb.conf.SUSE</filename>) encontra-se no subdiretório <filename>examples</filename>. <indexterm> <primary>arquivos de configuração</primary> <secondary>smb.conf</secondary> </indexterm>
  </para>

  <para>
   O HOWTO do Samba 3, fornecido pela equipe Samba, inclui uma seção sobre a solução de problemas. Além disso, a Parte V do documento oferece um guia passo a passo para a verificação da configuração. O HOWTO do Samba 3 poderá ser encontrado em <filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename> após a instalação do pacote <systemitem>samba-doc</systemitem>.
  </para>

  <indexterm class="endofrange" startref="idx.Samba"/>
 </sect1>
</chapter>
