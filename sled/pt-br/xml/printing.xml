<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="printing.xml" id="cha.p">
 <title>Operação da impressora</title><indexterm> <primary>imprimindo</primary> </indexterm>
 <para>
  O <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase> suporta a impressão com muitos tipos de impressoras, incluindo impressoras de rede remotas. É possível configurar as impressoras manualmente ou com o YaST. Para obter instruções de configuração, consulte a <xref linkend="sec.y2.hw.print"/>. Os utilitários gráficos e de linha de comando estão disponíveis para iniciar e gerenciar serviços de impressão. Se a sua impressora não funcionar como se esperava, consulte a <xref linkend="sec.drucken.prob"/>.
 </para>
 <para>
  CUPS (Common Unix Printing System) é o sistema de impressão padrão no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>.
 </para>
 <para>
  As impressoras podem ser distinguidas pela interface, como USB ou rede, e pela linguagem de impressão. Ao comprar uma impressora, verifique se há no seu hardware uma interface (como porta USB ou paralela) disponível para ela e uma linguagem de impressora adequada. As impressoras podem ser categorizadas com base em três classes de linguagem:
 </para>
 <variablelist>
  <varlistentry>
   <term>Impressoras PostScript</term>
   <listitem>
    <para>
     PostScript é a linguagem de impressora na qual a maior parte dos serviços de impressão em Linux e Unix são gerados e processados pelo sistema de impressão interno. Se documentos PostScript puderem ser diretamente processados pela impressora e não precisarem ser convertidos em estágios adicionais do sistema de impressão, o número de origens de erro potenciais será reduzido. 
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Impressora padrão (linguagens como PCL e ESC/P)</term>
   <listitem>
    <para>
     Embora essas linguagens de impressora tenham surgido há bastante tempo, ainda são usadas e sofrem constantes desenvolvimentos para se adaptarem aos novos recursos de impressoras. No caso de linguagens conhecidas, o sistema pode converter tarefas de impressão PostScript na respectiva linguagem de impressão com a ajuda do Ghostscript. Esse estágio de processamento é chamado de interpretação. As linguagens mais conhecidas são PCL (mais usada pelas impressoras HP e seus clones) e ESC/P (utilizada nas impressoras Epson). Geralmente, essas linguagens são suportadas no Linux e produzem um resultado de impressão adequado. O Linux pode não conseguir realizar algumas funções especiais da impressora. A não ser pelo projeto HP developing HPLIP (HP Linux Imaging and Printing), não há fabricantes de impressora que desenvolvem e disponibilizam drivers de Linux aos distribuidores Linux sob uma licença de código-fonte aberto.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry id="sec.p.prep.gdi">
   <term>Impressoras proprietárias (também denominadas impressoras GDI)</term>
   <listitem>
    <para>
     Essas impressoras não suportam nenhuma das linguagens de impressora comuns. Elas usam suas próprias linguagens de impressora não documentadas, que ficam sujeitas a mudanças quando é lançada uma edição nova de um modelo. Geralmente, apenas os drivers do Windows estão disponíveis para essas impressoras. Consulte a <xref linkend="sec.drucken.gdi"/> para obter mais informações.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <para>
  Antes de comprar uma nova impressora, consulte as seguintes fontes para verificar a abrangência do suporte ao equipamento pretendido:
 </para>
 <variablelist>
  <varlistentry>
   <term><ulink url="http://www.linuxfoundation.org/OpenPrinting/"/>
   </term>
   <listitem>
    <para>
     A home page OpenPrinting com o banco de dados de impressão. O banco de dados mostra o status mais recente de suporte do Linux. No entanto, a distribuição do Linux só pode integrar os drivers disponíveis no momento da produção. Da mesma forma, uma impressora atualmente classificada como <quote>perfeitamente suportada</quote> talvez não apresentasse esse status quando a versão mais recente do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> foi lançada. Assim, os bancos de dados não indicarão necessariamente o status correto, mas apenas uma informação aproximada.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><ulink url="http://pages.cs.wisc.edu/~ghost/"/>
   </term>
   <listitem>
    <para>
     Página do Ghostscript na Web.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><filename>/usr/share/doc/packages/ghostscript-library/catalog.devices</filename>
   </term>
   <listitem>
    <para>
     Listas de drivers incluídos.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <sect1 id="sec.p.workflow">
  <title>Fluxo de trabalho do sistema de impressão</title>

  <para>
   O usuário cria um serviço de impressão. O serviço de impressão consiste nos dados a serem impressos e nas informações para o spooler, como nome da impressora ou nome da fila de impressão e, opcionalmente, nas informações para o filtro, como opções específicas da impressora.
  </para>

  <para>
   Existe pelo menos uma fila de impressão dedicada para cada impressora. O spooler mantém o serviço de impressão em fila até que a impressora desejada esteja pronta para receber dados. Uma vez pronta, o spooler envia os dados pelo filtro, tendo a impressora como back end.
  </para>

  <para>
   O filtro converte os dados gerados pelo aplicativo que está imprimindo (geralmente PostScript ou PDF, mas também ASCII, JPEG e outros) em dados específicos da impressora (PostScript, PCL, ESC/P etc.). Os recursos da impressora são descritos nos arquivos PPD. O arquivo PPD contém opções da impressora com os parâmetros necessários para habilitá-los. O sistema de filtros verifica se as opções selecionadas pelo usuário foram habilitadas.
  </para>

  <para>
   Se você usa uma impressora PostScript, o sistema de filtros converte os dados em PostScript específico da impressora. Isso não exige um driver de impressora. Se você usa uma impressora não PostScript, o sistema de filtros converte os dados em dados específicos da impressora. Isso exige um driver adequado à sua impressora. O back end recebe do filtro os dados específicos da impressora e os repassa a ela.
  </para>
 </sect1>
 <sect1 id="sec.p.method">
  <title>Métodos e protocolos de conexão de impressoras</title>

  <para>
   Existem várias possibilidades para conectar uma impressora ao sistema. A configuração do sistema de impressão CUPS não faz distinção entre uma impressora local e uma impressora conectada ao sistema pela rede. 
   
  </para>

  

  <warning>
   <title>mudando as conexões de cabo em um sistema em execução</title>
   <para>
    Ao conectar a impressora à máquina, não esqueça de que apenas dispositivos USB podem ser conectados ou desconectados durante a operação. Para evitar danos ao sistema ou à impressora, encerre o sistema antes de mudar qualquer conexão que não seja USB.
   </para>
  </warning>
 </sect1>
 <sect1 id="sec.p.software">
  <title>Instalando o software</title>

  <para>
   PPD (descrição de impressora PostScript) é a linguagem de computador que descreve as propriedades, como resolução, e as opções, como disponibilidade de uma unidade duplex. Essas descrições são necessárias para o uso de várias opções de impressora no CUPS. Sem um arquivo PPD, os dados de impressão seriam encaminhados à impressora em estado <quote>bruto</quote>, o que normalmente não é desejado. Durante a instalação do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>, muitos arquivos PPD são pré-instalados.
  </para>

  <para>
   Para configurar uma impressora PostScript, a melhor opção é obter um arquivo PPD adequado. Há vários arquivos PPD disponíveis no pacote de <systemitem>PPDs do fabricante</systemitem>, que são automaticamente instalados no escopo da instalação padrão. Consulte a <xref linkend="sec.p.special.ppd"/> e a <xref linkend="sec.drucken.prob.ppd"/>.
  </para>



  <para>
   É possível armazenar novos arquivos PPD no diretório <filename>/usr/share/cups/model/</filename> ou adicioná-los ao sistema de impressão com o YaST, conforme descrito na <xref linkend="sec.y2.hw.print.local.get_ppd"/>. Na sequência, é possível selecionar o arquivo PPD durante a configuração da impressora.
  </para>

  <para>
   Observe se o fabricante da impressora requer que você instale pacotes inteiros de software. Primeiro, esse tipo de instalação pode resultar na perda do suporte oferecido pelo <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> e, segundo, os comandos de impressão podem funcionar de forma diferente e o sistema pode não conseguir mais trabalhar com dispositivos de outros fabricantes. Por isso, não recomendamos instalar o software do fabricante.
  </para>
 </sect1>
 <sect1 id="sec.p.net">
  <title>Impressoras de rede</title>

  <para>
   Uma impressora de rede pode suportar vários protocolos, alguns deles simultaneamente. Embora a maioria dos protocolos suportados seja padronizada, alguns fabricantes modificam o padrão. Os fabricantes então fornecem drivers apenas para alguns sistemas operacionais. Infelizmente, raros são os drivers para Linux. Na situação atual, não é possível agir como se todos os protocolos funcionassem perfeitamente no Linux. Portanto, talvez seja necessário testar várias opções para obter uma configuração funcional.
  </para>



  <para>
   O CUPS suporta os protocolos <systemitem>socket</systemitem>, <systemitem>LPD</systemitem>, <systemitem>IPP</systemitem> e <systemitem>smb</systemitem>.
  </para>

  <variablelist>
   <varlistentry>
    <term>socket</term>
    <listitem>
     <para>
      <emphasis>Socket</emphasis> refere-se a uma conexão em que os dados de impressão simples são enviados diretamente a um soquete TCP. Alguns dos números de portas de soquete normalmente usados são <option>9100</option> ou <option>35</option>. A sintaxe do URI (uniform resource identifier) do dispositivo é: socket://<replaceable>IP.da.impressora</replaceable>:<replaceable>porta</replaceable>, por exemplo: <systemitem>socket://192.168.2.202:9100/</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>LPD (Line Printer Daemon)</term>
    <listitem>
     <para>
      O protocolo LPD está descrito no RFC 1179. Nesse protocolo, alguns dados relacionados ao serviço, como o ID da fila de impressão, são enviados antes dos dados da impressão propriamente ditos. Portanto, a fila de impressão deve ser especificada no momento da configuração do protocolo LPD. As implementações de fabricantes de impressoras diferentes são flexíveis o suficiente para aceitar qualquer nome como a fila de impressão. Se necessário, o manual da impressora indicará o nome a ser usado. Geralmente se usa LPT, LPT1, LP1 ou nomes semelhantes. O número de porta para o serviço LPD é <option>515</option>. Um exemplo de URI de dispositivo é <systemitem>lpd://192.168.2.202/LPT1</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>IPP (Internet Printing Protocol)</term>
    <listitem>
     <para>
      IPP é um protocolo relativamente novo (1999) baseado no protocolo HTTP. Com o IPP, mais dados referentes à tarefa são transmitidos. O CUPS usa o IPP em transmissões internas de dados. É necessário indicar o nome da fila de impressão para que o IPP seja configurado corretamente. A porta padrão do IPP é <literal>631</literal>. Exemplos de URIs de dispositivo: <systemitem>ipp://192.168.2.202/ps</systemitem> e <systemitem>ipp://192.168.2.202/impressoras/ps</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SMB (compartilhamento Windows)</term>
    <listitem>
     <para>
      O CUPS também suporta a impressão em impressoras conectadas a compartilhamentos Windows. O protocolo usado para essa finalidade é o SMB. O SMB usa os números de porta <option>137</option>, <option>138</option> e <option>139</option>. Exemplos de URIs de dispositivo: <systemitem>smb://usuário:senha@grupo_de_trabalho/smb.exemplo.com/printer</systemitem>, <systemitem>smb://usuário:senha@smb.exemplo.com/impressora</systemitem> e <systemitem>smb://smb.exemplo.com/impressora</systemitem>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   O protocolo suportado pela impressora deve ser determinado antes da configuração. Se o fabricante não fornecer as informações necessárias, o comando <command>nmap</command> (que vem com o pacote <systemitem>nmap</systemitem>) pode ser usado para verificar o protocolo. O <command>nmap</command> verifica se há portas abertas em um host. Por exemplo:
  </para>

<screen>nmap -p 35,137-139,515,631,9100-10000 <replaceable>printerIP</replaceable></screen>

  <sect2 id="sec.p.net.config_cmdl">
   <title>Configurando o CUPS com ferramentas da linha de comando</title>
   <para>
    É possível configurar o CUPS com ferramentas de linha de comando, como <command>lpinfo</command>, <command>lpadmin</command> e <command>lpoptions</command>. Você precisa de um URI de dispositivo composto por um back end, como uma porta paralela, e parâmetros. Para determinar os URIs de dispositivo válidos no sistema, use o comando <command>lpinfo -v | grep ":/"</command>:
   </para>
<screen># lpinfo -v | grep ":/"
direct usb://ACME/FunPrinter%20XL
direct parallel:/dev/lp0
</screen>
   <para>
    Com o <command>lpadmin</command>, o administrador do servidor CUPS pode adicionar, remover ou gerenciar filas de impressão. Para adicionar uma fila de impressão, use a seguinte sintaxe:
   </para>
<screen>lpadmin -p <replaceable>queue</replaceable> -v <replaceable>device-URI</replaceable> -P <replaceable>PPD-file</replaceable> -E</screen>
   <para>
    Em seguida, o dispositivo (<option>-v</option>) fica disponível como <replaceable>fila</replaceable> (<option>-p</option>), usando o arquivo PPD especificado (<option>-P</option>). Isso significa que você precisa saber qual é o arquivo PPD e o URI de dispositivo para configurar a impressora manualmente.
   </para>
   <para>
    Não use <option>-E</option> como primeira opção. Em todos os comandos CUPS, <option>-E</option> como primeiro argumento define o uso de uma conexão criptografada. Para habilitar a impressora, <option>-E</option> deve ser usado como mostrado no seguinte exemplo:
   </para>
<screen>lpadmin -p ps -v parallel:/dev/lp0 -P \
/usr/share/cups/model/Postscript.ppd.gz -E</screen>
   <para>
    O seguinte exemplo configura uma impressora de rede:
   </para>
<screen>lpadmin -p ps -v socket://192.168.2.202:9100/ -P \
/usr/share/cups/model/Postscript-level1.ppd.gz -E</screen>
   <para>
    Para conhecer mais opções de <command>lpadmin</command>, consulte a página de manual de <systemitem>lpadmin(8)</systemitem>.
   </para>
   <para>
    Durante a configuração da impressora, algumas opções são definidas como padrão. Essas opções podem ser modificadas para cada serviço de impressão (dependendo da ferramenta de impressão utilizada). Também é possível modificar essas opções padrão com o YaST. Usando ferramentas de linha de comando, defina opções padrão da seguinte forma:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Primeiro, liste todas as opções:
     </para>
<screen>lpoptions -p <replaceable>queue</replaceable> -l</screen>
     <para>
      Exemplo:
     </para>
<screen>Resolution/Output Resolution: 150dpi *300dpi 600dpi</screen>
     <para>
      A opção padrão ativada é identificada por um asterisco na frente (<literal>*</literal>).
     </para>
    </step>
    <step performance="required">
     <para>
      Mude a opção com <command>lpadmin</command>:
     </para>
<screen>lpadmin -p <replaceable>queue</replaceable> -o Resolution=600dpi</screen>
    </step>
    <step performance="required">
     <para>
      Verifique a nova configuração:
     </para>
<screen>lpoptions -p <replaceable>queue</replaceable> -l

Resolution/Output Resolution: 150dpi 300dpi *600dpi</screen>
    </step>
   </procedure>
   <para>
    Quando um usuário comum executa <command>lpoptions</command>, as configurações são gravadas em <filename>~/.cups/lpoptions</filename>. Porém, as configurações de <systemitem class="username">root</systemitem> são gravadas em <filename>/etc/cups/lpoptions</filename>.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.p.appl.commandline">
  <title>Imprimindo pela linha de comando</title><indexterm> <primary>imprimindo</primary> <secondary>linha de comando</secondary> </indexterm> <indexterm> <primary>comandos</primary> <secondary>lp</secondary> </indexterm>

  <para>
   Para imprimir pela linha de comando, digite <command>lp-d <replaceable>nome da fila</replaceable> <replaceable>nome do arquivo</replaceable></command>, substituindo <replaceable>nome da fila</replaceable> e <replaceable>nome do arquivo</replaceable> pelos nomes correspondentes.
  </para>

  <para>
   Alguns aplicativos dependem do comando <command>lp</command> para imprimir. Nesse caso, digite o comando correto na caixa de diálogo do aplicativo, geralmente sem especificar <replaceable>nome do arquivo</replaceable>, por exemplo <command>lp -d<replaceable>nome da fila</replaceable></command>.
  </para>
 </sect1>
 <sect1 id="sec.p.special">
  <title>Recursos especiais no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase></title>

  <para>
   Vários recursos do CUPS foram adaptados para o <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>. Algumas das mudanças mais importantes são abordadas aqui.
  </para>

  <sect2 id="sec.p.special.cupsfire">
   <title>CUPS e firewall</title>
   <para>
    Após realizar a instalação padrão do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>, o SuSEFirewall2 será ativado e as interfaces de rede serão configuradas para ficarem na <literal>Zona Externa</literal>, que bloqueia o tráfego de entrada. Há mais informações sobre a configuração do SuSEFirewall2 disponíveis na <xref linkend="sec.fire.SuSE"/> e em <ulink url="http://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings"/>.
   </para>
   <sect3 id="sec.p.special.cupsfire.client">
    <title>Cliente CUPS</title>
    <para>
     Normalmente, um cliente CUPS é executado em uma estação de trabalho comum, localizada em um ambiente de rede confiável protegido por firewall. Neste caso, é recomendável configurar a interface de rede para ficar na <literal>Zona Interna</literal>, de modo que a estação de trabalho possa ser alcançada de dentro da rede.
    </para>
   </sect3>
   <sect3 id="sec.p.special.cupsfire.server">
    <title>Servidor CUPS</title>
    <para>
     Se o servidor CUPS fizer parte de um ambiente de rede confiável, protegido por um firewall, a interface de rede deverá ser configurada para ficar na <literal>Zona Interna</literal> do firewall. Não é recomendado configurar um servidor CUPS em um ambiente de rede não confiável, a menos que você tenha o cuidado de mantê-lo protegido por regras especiais de firewall e opções seguras na configuração do CUPS.
    </para>
   </sect3>
  </sect2>

  <sect2 id="sec.p.special.ppd">
   <title>Arquivos PPD em pacotes diferentes</title>
   <para>
    A configuração de impressora do YaST define as filas do CUPS usando os arquivos PPD instalados em <filename>/usr/share/cups/model</filename>. Para localizar os arquivos PPD adequados ao modelo da impressora, o YaST compara o fornecedor e o modelo determinados durante a detecção de hardware com os fornecedores e modelos em todos os arquivos PPD. Para isso, a configuração de impressora do YaST gera um banco de dados com as informações de fabricante e modelo extraídas dos arquivos PPD.
   </para>
   <para>
    A configuração com apenas arquivos PPD e nenhuma outra fonte de informação tem a vantagem de permitir a livre modificação de arquivos PPD em <filename>/usr/share/cups/model/</filename>. Por exemplo, se você tem apenas impressoras PostScript, normalmente não precisa dos arquivos PPD Foomatic do pacote <systemitem>cups-drivers</systemitem> ou os arquivos PPD Gutenprint do pacote <systemitem>gutenprint</systemitem>. Em vez disso, os arquivos PPD das suas impressoras PostScript podem ser copiados diretamente para <filename>/usr/share/cups/model</filename> (se já não existirem no pacote <systemitem>manufacturer-PPDs</systemitem>) para proporcionarem uma configuração ideal às impressoras.
   </para>
   <sect3 id="sec.p.special.ppd.cups">
    <title>Arquivos PPD do CUPS do pacote <systemitem>cups</systemitem></title>
    <para>
     Os arquivos PPD genéricos do pacote <systemitem>cups</systemitem> foram complementados com arquivos PPD Foomatic adaptados para impressoras PostScript nível 1 e 2:
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       <filename>/usr/share/cups/model/Postscript-level1.ppd.gz</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       <filename>/usr/share/cups/model/Postscript-level2.ppd.gz</filename>
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 id="sec.p.special.ppd.foomatic">
    <title>Arquivos PPD do pacote <systemitem>cups-drivers</systemitem></title>
    <para>
     Normalmente, o filtro de impressora Foomatic <systemitem>foomatic-rip</systemitem> é usado junto com Ghostscript para impressoras não PostScript. Os arquivos PPD Foomatic adequados possuem as entradas <systemitem>*NickName: ... Foomatic/Ghostscript driver</systemitem> e <systemitem>*cupsFilter: ... foomatic-rip</systemitem>. Esses arquivos PPD estão localizados no pacote <systemitem>cups-drivers</systemitem>.
    </para>
    <para>
     O YaST geralmente prefere um arquivo <systemitem>manufacturer-PPD</systemitem>. Entretanto, quando não existe nenhum arquivo <systemitem>manufacturer-PPD</systemitem> adequado, um arquivo PPD Foomatic com entrada <systemitem>*NickName: ... Foomatic ... (recommended)</systemitem> é selecionado.
    </para>
   </sect3>
   <sect3 id="sec.p.special.ppd.gimp">
    <title>Arquivos PPD Gutenprint do pacote <systemitem>gutenprint</systemitem></title>
    <para>
     Em vez de <systemitem>foomatic-rip</systemitem>, o filtro CUPS <systemitem>rastertogutenprint</systemitem> do Gutenprint (antes conhecido como GIMP-Print) pode ser usado em várias impressoras não PostScript. Esse filtro e os arquivos PPD Gutenprint adequados estão disponíveis no pacote <systemitem>gutenprint</systemitem>. Os arquivos PPD Gutenprint estão localizados em <filename>/usr/share/cups/model/gutenprint/</filename> e possuem as entradas <systemitem>*NickName: ... CUPS+Gutenprint</systemitem> e <systemitem>*cupsFilter: ... rastertogutenprint</systemitem>.
    </para>
   </sect3>
   <sect3 id="sec.p.special.ppd.manu">
    <title>Arquivos PPD de fabricantes de impressoras no pacote <systemitem>manufacturer-PPDs</systemitem></title>
    <para>
     O pacote <systemitem>manufacturer-PPDs</systemitem> contém arquivos PPD de fabricantes de impressoras que são liberados mediante uma licença suficientemente permissiva. Impressoras PostScript devem ser configuradas com o arquivo PPD adequado do fabricante da impressora, já que esse arquivo permite o uso de todas as funções da impressora PostScript. O YaST prefere um arquivo PPD dos <systemitem>manufacturer-PPDs</systemitem>. O YaST não poderá usar um arquivo PPD do pacote <systemitem>manufacturer-PPDs</systemitem> se o nome do modelo não for correspondente. Isso poderá ocorrer se o pacote <systemitem>manufacturer-PPDs</systemitem> contiver apenas um arquivo PPD para modelos semelhantes, como a série Funprinter 12xx. Nesse caso, selecione manualmente o arquivo PPD correspondente no YaST.
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.drucken.prob">
  <title>Solução de problemas</title>

  <para>
   As seções a seguir abordam alguns dos problemas mais encontrados em relação a hardware e software de impressora, bem como formas de solucionar ou superar esses problemas. Os tópicos abordados incluem impressoras GDI, arquivos PPD e configuração de porta. Problemas comuns de impressoras de rede, impressões com defeito e gerenciamento de filas também são tratados.
  </para>

  <sect2 id="sec.drucken.gdi">
   <title>Impressoras sem suporte de linguagem de impressora padrão</title><indexterm> <primary>imprimindo</primary> <secondary>GDI impressoras</secondary> </indexterm>
   <para>
    Essas impressoras não suportam nenhuma linguagem de impressora comum, podendo apenas ser tratadas com sequências especiais de controle proprietário. Portanto, elas só funcionam com as versões de sistema operacional para as quais o fabricante fornece driver. GDI é uma interface de programação desenvolvida pela Microsoft* para dispositivos gráficos. Geralmente o fabricante fornece drivers apenas para Windows e, com o driver do Windows usa a interface GDI, essas impressoras também são chamadas de <emphasis>impressoras GDI</emphasis>. O verdadeiro problema não é a interface de programação, mas o fato de que tais impressoras só podem ser tratadas com a linguagem de impressora proprietária do respectivo modelo de impressora.
   </para>
   <para>
    Algumas impressoras GDI podem ser ajustadas para funcionar no modo GDI ou em uma das linguagens de impressora padrão. Consulte o manual da impressora para saber se isso é possível. Alguns modelos exigem software especial do Windows para fazer o ajuste (observe que o driver de impressora do Windows pode sempre retornar a impressora para o modo GDI quando se imprime do Windows). Para outras impressoras GDI, existem módulos de extensão disponíveis para uma linguagem de impressora padrão.
   </para>
   <para>
    Alguns fabricantes oferecem drivers proprietários para suas impressoras A desvantagem dos drivers de impressora proprietários é que não há garantia de que vão funcionar com o sistema de impressão instalado ou de que sejam adequados para as diferentes plataformas de hardware. Em contraste, impressoras que suportam uma linguagem de impressora padrão não dependem de uma versão do sistema de impressão especial ou de plataforma de hardware especial.
   </para>
   <para>
    Em vez de perder tempo tentando fazer funcionar um driver de Linux proprietário, a compra de uma impressora que suporte a linguagem padrão de impressora (preferencialmente PostScript) pode ter melhor custo-benefício. Isso solucionaria o problema do driver de uma vez por todas, eliminando a necessidade de instalar e configurar software de driver especial e obter atualizações do driver eventualmente necessárias devido a novos avanços no sistema de impressão.
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.ppd">
   <title>Nenhum arquivo PPD adequado disponível para impressora PostScript</title>
   <para>
    Se o pacote <systemitem>manufacturer-PPDs</systemitem> não incluir o arquivo PPD adequado para uma impressora PostScript, será possível utilizar o arquivo PPD do CD do driver do fabricante da impressora ou fazer download de um arquivo PPD adequado da página do fabricante da impressora na Web.
   </para>
   <para>
    Se o arquivo PPD for fornecido como arquivo compactado (.zip) ou arquivo compactado de autoextração (<filename>.exe</filename>), faça a descompactação com <command>unzip</command>. Primeiro, reveja os termos de licença do arquivo PPD. Em seguida, use o utilitário <command>cupstestppd</command> para verificar se o arquivo PPD atende à <quote>Especificação de Formato de Arquivo PPD (PostScript Printer Description — Descrição de Impressora PostScript) da Adobe, versão 4.3</quote>. Se o utilitário retornar <quote>FAIL</quote>, significa que os erros nos arquivos PPD são graves e provavelmente causam os principais problemas. Os problemas reportados pelo <command>cupstestppd</command> devem ser eliminados. Se necessário, peça o arquivo PPD adequado ao fabricante da impressora.
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.parport">
   <title>Portas paralelas</title>
   <para>
    A abordagem mais segura é conectar a impressora diretamente à primeira porta paralela e selecionar as configurações de porta paralela no BIOS:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Endereço de E/S: <literal>378</literal> (hexadecimal)
     </para>
    </listitem>
    <listitem>
     <para>
      Interrupção: irrelevante
     </para>
    </listitem>
    <listitem>
     <para>
      Modo: <literal>Normal</literal>, <literal>SPP</literal> ou <literal>Output Only</literal>
     </para>
    </listitem>
    <listitem>
     <para>
      DMA: desabilitado
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Se a impressora não puder ser endereçada na porta paralela apesar dessas configurações, digite o endereço de E/S explicitamente de acordo com a configuração no BIOS no formato <literal>0x378</literal> em <filename>/etc/modprobe.conf</filename>. Se houver duas portas paralelas definidas para os endereços de E/S <literal>378</literal> e <literal>278</literal> (hexadecimal), digite-os no formato <literal>0x378,0x278</literal>.
   </para>
   <para>
    Se a interrupção <literal>7</literal> estiver livre, poderá ser ativada com a entrada mostrada no <xref linkend="dat.d.interface.parport0.interrupt"/>. Antes de ativar o modo de interrupção, verifique o arquivo <filename>/proc/interrupts</filename> para ver quais interrupções já estão sendo usadas. Somente as interrupções usadas atualmente são exibidas. Isso pode mudar dependendo dos componentes de hardware ativos. A interrupção da porta paralela não deve ser usada por outro dispositivo. Se não tiver certeza, use o modo de polling com <literal>irq=none</literal>.
   </para>
   <example id="dat.d.interface.parport0.interrupt">
    <title><filename>/etc/modprobe.conf</filename>: Modo de interrupção para a primeira porta paralela</title>
<screen>alias parport_lowlevel parport_pc
options parport_pc io=0x378 irq=7</screen>
   </example>
  </sect2>

  <sect2 id="sec.drucken.prob.netconnect">
   <title>Conexões da impressora de rede</title><indexterm> <primary>imprimindo</primary> <secondary>rede</secondary> </indexterm> <indexterm> <primary>imprimindo</primary> <secondary>solução de problemas</secondary> <tertiary>rede</tertiary> </indexterm>
   <variablelist>
    <varlistentry>
     <term>Identificação de problemas de rede</term>
     <listitem>
      <para>
       Conecte a impressora diretamente ao computador. Para fins de teste, configure-a como impressora local. Se isso funcionar, o problema está na rede.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Verificando a rede TCP/IP</term>
     <listitem>
      <para>
       A rede TCP/IP e a resolução de nomes devem ser funcionais.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term>Verificando um <command>lpd</command> remoto
     </term>
     <listitem>
      <para>
       Use o comando a seguir para testar o estabelecimento de uma conexão TCP com <command>lpd</command> (porta <literal>515</literal>) no <replaceable>host</replaceable>.
      </para>
<screen>netcat -z <replaceable>host</replaceable> 515 &amp;&amp; echo ok || echo failed</screen>
      <para>
       Se a conexão com <command>lpd</command> não for estabelecida, o <command>lpd</command> pode não estar ativo ou pode haver problemas básicos de rede.
      </para>
      <para>
       Como usuário <systemitem class="username">root</systemitem>, use o seguinte comando para consultar um relatório de status (possivelmente muito longo) sobre a <replaceable>fila</replaceable> no <replaceable>host</replaceable> remoto, considerando que o respectivo <command>lpd</command> esteja ativo e o host aceite consultas:
      </para>
<screen>echo -e "\004queue" \
| netcat -w 2 -p 722 <replaceable>host</replaceable> 515</screen>
      <para>
       Se o <command>lpd</command> não responder, ele pode não estar ativo ou pode haver problemas básicos de rede. Se o <command>lpd</command> responder, a resposta deverá mostrar por que não é possível imprimir na <literal>fila</literal> do <literal>host</literal>. Se você receber uma resposta como esta, mostrada no <xref linkend="aus.d.lpd"/>, significa que o problema está sendo causado pelo <command>lpd</command> remoto.
      </para>
      <example id="aus.d.lpd">
       <title>Mensagem de erro do <command>lpd</command></title>
<screen>lpd: your host does not have line printer access
lpd: queue does not exist
printer: spooling disabled
printer: printing disabled</screen>
      </example>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Verificando um <command>cupsd</command> remoto
     </term>
     <listitem>
      <para>
       Um servidor de rede CUPS pode transmitir suas filas por padrão a cada 30 segundos na porta UDP <literal>631</literal>. Conforme apresentado, os seguintes comandos podem ser usados para testar se existe um servidor de rede CUPS de broadcasting na rede. Não deixe de parar seu daemon CUPS local antes de executar o comando.
      </para>
<screen>netcat -u -l -p 631 &amp; PID=$! ; sleep 40 ; kill $PID</screen>
      <para>
       Se existir um servidor de rede CUPS de transmissão, a saída aparecerá conforme mostrado no <xref linkend="aus.d.bcast"/>.
      </para>
      <example id="aus.d.bcast">
       <title>Transmissão do servidor de rede CUPS</title>
<screen>ipp://192.168.2.202:631/printers/queue</screen>
      </example>
      
      <para>
       Use o comando a seguir para testar o estabelecimento de uma conexão TCP com <command>cupsd</command> (porta <literal>631</literal>) no <replaceable>host</replaceable>.
      </para>
<screen>netcat -z <replaceable>host</replaceable> 631 &amp;&amp; echo ok || echo failed</screen>
      <para>
       Se não for possível estabelecer a conexão com <command>cupsd</command>, pode ser que o <command>cupsd</command> não esteja ativo ou existam problemas básicos de rede. <command>lpstat -h <replaceable>host</replaceable> -l -t</command> retorna um relatório de status (possivelmente muito longo) de todas as filas do <replaceable>host</replaceable>, contanto que o respectivo <command>cupsd</command> esteja ativo e o host aceite consultas.
      </para>
      <para>
       O próximo comando pode ser usado para testar se a <replaceable>fila</replaceable> do <replaceable>host</replaceable> aceita um serviço de impressão que consiste em um único caractere de retorno de carro. Nada será impresso. Possivelmente, será ejetada uma página em branco.
      </para>
<screen>echo -en "\r" \
| lp -d queue -h <replaceable>host</replaceable></screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>
      Solução de problemas da impressora de rede ou da caixa do servidor de impressão
     </term>
     <listitem>
      <para>
       Algumas vezes, spoolers executados na caixa do servidor de impressão causam problemas quando precisam lidar com vários serviços de impressão. Como isso é causado pelo spooler na caixa do servidor de impressão, não há como resolver essa questão. Como solução alternativa, desvie o spooler na caixa do servidor de impressão endereçando a impressora conectada à caixa diretamente com o soquete TCP. Consulte a <xref linkend="sec.p.net"/>.
      </para>
      <para>
       Dessa forma, a caixa do servidor de impressão é reduzida a um conversor entre as várias formas de transferência de dados (conexão de rede TCP/IP e impressora local). Para usar esse método, você precisa conhecer a porta TCP da caixa do servidor de impressão. Se a impressora estiver conectada à caixa do servidor de impressão e ligada, a porta TCP poderá ser determinada normalmente com o utilitário <command>nmap</command> do pacote <systemitem>nmap</systemitem>, algum tempo depois que a caixa for ativada. Por exemplo, <command>nmap<replaceable>endereço_IP</replaceable> pode resultar na seguinte saída para uma caixa do servidor de impressão:</command>
      </para>
<screen>Port       State       Service
23/tcp     open        telnet
80/tcp     open        http
515/tcp    open        printer
631/tcp    open        cups
9100/tcp   open        jetdirect</screen>
      <para>
       Essa saída indica que a impressora conectada à caixa do servidor de impressão pode ser endereçada via soquete TCP na porta <literal>9100</literal>. Por padrão, <command>nmap</command> verifica somente algumas portas mais conhecidas listadas em <filename>/usr/share/nmap/nmap-services</filename>. Para verificar todas as portas possíveis, use o comando <command>nmap-p <replaceable>porta_de_origem</replaceable>-<replaceable>porta_de_destino</replaceable> <replaceable>endereço_IP</replaceable></command>. O processo pode levar algum tempo. Para obter mais informações, consulte a página de manual de <command>nmap</command>.
      </para>
      <para>
       Digite um comando como
      </para>
<screen>echo -en "\rHello\r\f" | netcat -w 1 IP-address port
cat file | netcat -w 1 IP-address port</screen>
      <para>
       para enviar strings de caracteres ou arquivos diretamente à respectiva porta para testar se a impressora pode ser endereçada dessa porta.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 id="sec.drucken.prob.defective_printouts">
   <title>Defeitos na impressão sem mensagem de erro</title>
   <para>
    Para o sistema de impressão, o serviço de impressão é concluído quando o back end do CUPS conclui a transferência de dados ao destinatário (impressora). Se houver falha no processamento posterior no destinatário (por exemplo, se a impressora não imprimir seus próprios dados específicos), o sistema de impressão não notará. Se a impressora não imprimir seus próprios dados específicos, selecione um arquivo PPD mais adequado à impressora.
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.disabled_queues">
   <title>Filas desabilitadas</title>
   <para>
    Se a transferência de dados para o destinatário falhar completamente após várias tentativas, o back end do CUPS, como <literal>USB</literal> ou <literal>socket</literal>, reportará um erro ao sistema de impressão (ao <command>cupsd</command>). O back end determina quantas tentativas malsucedidas são necessárias para que a transferência de dados seja considerada impossível. Visto que as tentativas posteriores serão inúteis, o <command>cupsd</command> desabilita a impressão da fila correspondente. Após resolver a causa do problema, o administrador do sistema deve reabilitar a impressão com o comando <command>cupsenable</command>.
   </para>
  </sect2>

  <sect2 id="sec.drucken.prob.deleting_jobs">
   <title>Navegação do CUPS: apagando serviços de impressão</title>
   <para>
    Se um servidor de rede CUPS transmitir suas filas aos hosts de clientes via navegação e um <command>cupsd</command> local adequado estiver ativo nos hosts de clientes, o <command>cupsd</command> de cliente aceitará serviços de impressão de aplicativos e os encaminhará ao <command>cupsd</command> no servidor. Quando <command>cupsd</command> no servidor aceitar um serviço de impressão, ele receberá um novo número de serviço. Portanto, o número da tarefa no host cliente é diferente do número da tarefa no servidor. Como geralmente um serviço de impressão é encaminhado de imediato, não é possível apagá-lo com o número de serviço do host cliente, porque o <command>cupsd</command> do cliente considera o serviço como concluído assim que ele é encaminhado ao <command>cupsd</command> do servidor.
   </para>
   <para>
    Para apagar o serviço de impressão do servidor, use um comando como <command>lpstat -h cups.example.com -o</command> para determinar o número do serviço no servidor, contanto que o servidor ainda não tenha concluído o serviço de impressão (isto é, não o tenha enviado inteiramente para a impressora). Com esse número, o serviço de impressão pode ser apagado no servidor:
   </para>
<screen>cancel -h cups.example.com <replaceable>queue-jobnumber</replaceable></screen>
  </sect2>

  <sect2 id="sec.drucken.prob.brokenjobs">
   <title>Serviços de impressão com defeito e erros de transferência de dados</title>
   <para>
    Se você desligar a impressora ou encerrar o computador durante o processo de impressão, o serviço de impressão permanecerá na fila. A impressão continua quando o computador (ou a impressora) é ligado novamente. Os serviços de impressão com defeito devem ser removidos da fila com <command>cancel</command>.
   </para>
   <para>
    Se o serviço de impressão apresentar defeito ou se ocorrer um erro na comunicação entre o host e a impressora, a impressora imprimirá várias folhas de papel com caracteres ininteligíveis, pois não consegue processar os dados corretamente. Para corrigir essa situação, siga as etapas a seguir:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Para interromper a impressão, remova todo o papel das bandejas da impressora jato de tinta ou laser. Impressoras de alta qualidade têm um botão de cancelamento da impressão.
     </para>
    </step>
    <step performance="required">
     <para>
      O serviço de impressão pode ainda estar na fila, já que os serviços apenas são removidos depois de inteiramente enviados à impressora. Use <command>lpstat -o</command> ou <command>lpstat -h cups.example.com -o</command> para verificar a fila que está sendo impressa. Apague o serviço de impressão com <command>cancel <replaceable>fila</replaceable>-<replaceable>númerodoserviço</replaceable> </command> ou <command>cancel -h cups.exemplo.com <replaceable>fila</replaceable>-<replaceable>númerodoserviço</replaceable></command>.
     </para>
    </step>
    <step performance="required">
     <para>
      Alguns dados podem ainda ser transferidos à impressora mesmo que o serviço tenha sido apagado da fila. Verifique se há um processo back end do CUPS em execução para a fila respectiva e termine-o. Por exemplo, para uma impressora conectada à porta paralela, o comando <command>fuser -k /dev/lp0</command> pode ser usado para terminar todos os processos que ainda estão acessando a impressora (mais precisamente, a porta paralela).
     </para>
    </step>
    <step performance="required">
     <para>
      Reinicialize a impressora completamente deixando-a desligada por um tempo. Em seguida, insira o papel e ligue a impressora.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.drucken.prob.debugging">
   <title>Depuração do sistema de impressão do CUPS</title>
   <para>
    Use o seguinte procedimento genérico para localizar problemas no sistema de impressão do CUPS:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Defina <command>LogLevel debug</command> em <filename>/etc/cups/cupsd.conf</filename>.
     </para>
    </step>
    <step performance="required">
     <para>
      Pare o <command>cupsd</command>.
     </para>
    </step>
    <step performance="required">
     <para>
      Remova <filename>/var/log/cups/error_log*</filename> para não precisar procurar em arquivos de registro muito grandes.
     </para>
    </step>
    <step performance="required">
     <para>
      Inicie o <command>cupsd</command>.
     </para>
    </step>
    <step performance="required">
     <para>
      Repita a ação que causou o problema.
     </para>
    </step>
    <step performance="required">
     <para>
      Verifique as mensagens em <filename>/var/log/cups/error_log*</filename> para identificar a causa do problema.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.drucken.prob.more_information">
   <title>Para obter mais informações</title>
   
   <para os="sles;sled;">
    Há soluções para vários problemas específicos no SUSE Knowledgebase (<ulink url="http://www.suse.com/support/"/>). Localize os artigos relevantes com uma pesquisa pelo texto <literal>CUPS</literal>.
   </para>
  </sect2>
 </sect1>
</chapter>
