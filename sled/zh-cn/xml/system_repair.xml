<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE sect2
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="system_repair.xml" xml:id="sec-trouble-data-recover">
 <title>恢复受损的系统</title><indexterm> <primary>恢复系统</primary></indexterm>
 <para>
  有多种原因会造成系统无法正常启动和运行。系统崩溃后造成文件系统损坏、配置文件损坏或引导加载程序配置损坏是最常见的原因。
 </para>

 <para os="sles;sled">
  <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 提供了两种不同的方法来解决这些问题。您可以使用 YaST 系统修复功能，也可以引导救援系统。以下部分介绍这两种系统修复方法。
 </para>

 <section xml:id="sec-trouble-data-recover-yast" os="sles;sled">
  <title>使用 YaST 系统修复</title><indexterm> <primary>YaST</primary> <secondary>修复系统</secondary> </indexterm> <indexterm> <primary>修复系统</primary> </indexterm>
  <note>
   <title>键盘和语言设置</title>
   <para>
    如果引导后更改了语言设置，您的键盘也随之调整。
   </para>
  </note>
  <para>
   在启动 YaST 系统修复模块之前，确定要运行该模块的方式以最佳满足您的需要。依据系统故障的严重性和原因（以及您的专业知识），在三个不同的方式中进行选择：
  </para>
  <variablelist>
   <varlistentry>
    <term>自动修复</term>
    <listitem>
     <para>
      如果由于未知原因系统发生故障并且您基本上不知道系统的哪个部分导致此故障，则使用<guimenu>自动修复</guimenu>。将会对您安装的系统上的所有组件执行全面的自动化检查。有关此过程的详细描述，请参见<xref linkend="sec-trouble-data-recover-yast-auto"/>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>自定义修改</term>
    <listitem>
     <para>
      如果您的系统发生故障并且您已经知道哪个组件导致此故障，则您可以通过将系统分析的范围限制于那些组件来缩短使用<guimenu>自动修复</guimenu>进行系统检查所需的长时间。例如，如果发生故障之前的系统消息指示包数据库出错，则您可以将分析和修复过程只限于检查和恢复系统的此部分。有关此过程的详细描述，请参见<xref linkend="sec-trouble-data-recover-yast-custom"/>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>专家工具</term>
    <listitem>
     <para>
      如果您已经清楚地知道哪个组件发生故障和修复此故障的方法，则您可以跳过分析运行并直接应用修复相关组件所需的工具。有关详细信息，请参见<xref linkend="sec-trouble-data-recover-yast-expert"/>。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   选择以上描述的一个修复方式并按以下部分所述继续执行系统修复。
  </para>
  <section xml:id="sec-trouble-data-recover-yast-auto">
   <title>自动修复</title>
   <procedure>
    <para>
     要启动 YaST 系统修复的自动修复方式，请如下执行操作：
    </para>
    <step>
     <para>
      将 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 的安装媒体插入 DVD 驱动器中。
     </para>
    </step>
    <step>
     <para>
      重引导系统。
     </para>
    </step>
    <step>
     <para>
      在引导屏幕上选择<guimenu>修复已安装系统</guimenu>。
     </para>
    </step>
    <step>
     <para>
      确认许可协议并单击<guimenu>下一步</guimenu>。
     </para>
    </step>
    <step>
     <para>
      选择<guimenu>自动修复</guimenu>。
     </para>
     <para>
      YaST 现在对已安装系统启动全面分析。屏幕的底部使用两个进度条显示此过程的进度。上面的进度条显示当前正在运行的测试的进度。下面的进度条显示分析进程的总体进度。上面的日志窗口用于跟踪当前运行的测试及其结果。请参见<xref linkend="fig-trouble-data-recover-yast-auto"/>。
     </para>
     <figure xml:id="fig-trouble-data-recover-yast-auto">
      <title>自动修复方式</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="i_y2_repair_auto.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="i_y2_repair_auto.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      每次运行都会执行以下主要测试。这些测试又包含许多单独的子测试：
     </para>
     <variablelist>
      <varlistentry>
       <term>检查分区表</term>
       <listitem>
        <para>
         检查所有检测到的硬盘的分区表的有效性和一致性。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>检查交换区</term>
       <listitem>
        <para>
         检测并测试已安装系统的交换分区，并在合适的情况下建议激活交换分区。应该接受这一建议以实现更高的系统修复速度。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>检查文件系统</term>
       <listitem>
        <para>
         所有检测到的文件系统都需要进行特定于文件系统的检查。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>检查 fstab 项</term>
       <listitem>
        <para>
         检查文件中项的完整性和一致性。将装入所有有效的分区。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>检查包数据库</term>
       <listitem>
        <para>
         这将检查执行最小安装的操作所需的所有包是否存在。虽然还可以分析基本包，但因为基本包数量太大，将花费很长时间。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>检查引导加载程序配置</term>
       <listitem>
        <para>
         检查已安装系统（GRUB 或 LILO）的引导加载程序配置的完整性和一致性。将检查引导和 root 设备，并将检查 initrd 模块的可用性。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </step>
    <step>
     <para>
      当出现错误时，过程将停止并打开一个对话框，其中描述了详细信息和可能的解决方案。
     </para>
     <para>
      在接受建议修复之前仔细阅读屏幕消息。如果您确定拒绝建议的解决方案，您的系统将保持不变。
     </para>
    </step>
    <step>
     <para>
      在修复过程成功终止之后，单击<guimenu>确定</guimenu>和<guimenu>完成</guimenu>，除去安装媒体。系统将自动重引导。
     </para>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-trouble-data-recover-yast-custom">
   <title>自定义修改</title>
   <procedure>
    <para>
     要启动<guimenu>自定义修复</guimenu>方式并选择性地检查所安装系统的某些组件，请如下执行操作：
    </para>
    <step>
     <para>
      将 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 的安装媒体插入 DVD 驱动器中。
     </para>
    </step>
    <step>
     <para>
      重引导系统。
     </para>
    </step>
    <step>
     <para>
      在引导屏幕上选择<guimenu>修复已安装系统</guimenu>。
     </para>
    </step>
    <step>
     <para>
      确认许可协议并单击<guimenu>下一步</guimenu>。
     </para>
    </step>
    <step>
     <para>
      选择<guimenu>自定义修复</guimenu>。
     </para>
     <para>
      选择<guimenu>自定义修复</guimenu>将显示一组测试，这些测试最初都被标记为准备执行。这些测试的总范围和自动修复的测试范围一致。如果您清楚哪些方面没有损坏，则取消对应测试的标记。单击<guimenu>下一步</guimenu>将启动一个范围相对较小的测试过程，可能将显著缩短运行时间。
     </para>
     <para>
      并不是所有的测试组都单独适用。fstab 项的分析会始终与文件系统（包括现有的交换分区）检查一起进行。YaST 会通过选择必需运行的最少测试数量来自动解决此类依赖性。YaST 不支持加密的分区。如果您有加密分区，YaST 会通知您。
     </para>
    </step>
    <step>
     <para>
      当出现错误时，过程将停止并打开一个对话框，其中描述了详细信息和可能的解决方案。
     </para>
     <para>
      在接受建议修复之前仔细阅读屏幕消息。如果您确定拒绝建议的解决方案，您的系统将保持不变。
     </para>
    </step>
    <step>
     <para>
      在修复过程成功终止之后，单击<guimenu>确定</guimenu>和<guimenu>完成</guimenu>，除去安装媒体。系统将自动重引导。
     </para>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-trouble-data-recover-yast-expert">
   <title>专家工具</title>
   <para>
    如果您熟悉 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 并且已非常清楚系统中所需的修复，请跳过系统分析来直接应用工具。
   </para>
   <para>
    要使用 YaST 系统修复模块的<guimenu>专家工具</guimenu>功能，请如下进行操作：
   </para>
   <procedure>
    <step>
     <para>
      将 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 的安装媒体插入 DVD 驱动器中。
     </para>
    </step>
    <step>
     <para>
      重引导系统。
     </para>
    </step>
    <step>
     <para>
      在引导屏幕上选择<guimenu>修复已安装系统</guimenu>。
     </para>
    </step>
    <step>
     <para>
      确认许可协议并单击<guimenu>下一步</guimenu>。
     </para>
    </step>
    <step>
     <para>
      选择<guimenu>导出工具</guimenu>，再选择修复选项。
     </para>
    </step>
    <step>
     <para>
      在修复过程成功终止之后，单击<guimenu>确定</guimenu>和<guimenu>完成</guimenu>，除去安装媒体。系统将自动重引导。
     </para>
    </step>
   </procedure>
   <para>
    <guimenu>专家工具</guimenu>提供下列选项修复您的错误系统：
   </para>
   <variablelist>
    <varlistentry>
     <term><guimenu>安装新的引导加载程序</guimenu>
     </term>
     <listitem>
      <para>
       这将启动 YaST 引导加载程序配置模块。详细信息请参见<xref linkend="sec-boot-yast2-config"/>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>引导已安装系统</guimenu>
     </term>
     <listitem>
      <para>
       尝试引导已安装的 Linux 系统。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>启动分区工具</guimenu>
     </term>
     <listitem>
      <para>
       这将启动 YaST 中的专家分区工具。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>修复文件系统</guimenu>
     </term>
     <listitem>
      <para>
       这将检查已安装系统的文件系统。首先将向您提供所有检测到的分区的选择，您可以在其中选择要检查的分区。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>恢复丢失的分区</guimenu><indexterm><primary>恢复分区</primary></indexterm>
     </term>
     <listitem>
      <para>
       可以尝试重构建损坏的分区表。首先将显示检测到的硬盘的列表以供选择。单击<guimenu>确定</guimenu>开始检查。根据您的计算机速度和硬盘大小及速度，这可能要花一点时间。
      </para>
      <important>
       <title><guimenu>重构建分区表</guimenu></title>
       <para>
        重构建分区表非常麻烦。YaST 会尝试通过分析硬盘的数据扇区来识别丢失的分区。在识别出丢失的分区之后，会添加它们以重构建分区表。但是，此操作不能保证在所有可能的情况下都成功。
       </para>
      </important>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>将系统设置保存到软盘</guimenu>
     </term>
     <listitem>
      <para>
       此选项将重要的系统文件保存到软盘上。如果这些文件中的某个文件被损坏，可以从磁盘恢复该文件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>校验安装的软件</guimenu>
     </term>
     <listitem>
      <para>
       这将检查包数据库的一致性和最重要包的可用性。使用此工具可以重安装任何损坏的已安装包。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>
 </section>
 <section xml:id="sec-trouble-data-recover-rescue">
  <title>使用救援系统</title><indexterm> <primary>救援系统</primary></indexterm><indexterm><primary>系统</primary><secondary>救援</secondary></indexterm>
  <para>
   <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 包含一个救援系统。该救援系统是一个小型 Linux 系统，可以装载到一个 RAM 磁盘并以 root 文件系统的形式装入，使您可以从外部访问 Linux 分区。使用该救援系统，可以恢复或修改系统中任何一个重要的方面：
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     操作任意类型的配置文件。
    </para>
   </listitem>
   <listitem>
    <para>
     检查文件系统中的缺陷和启动自动修复进程。
    </para>
   </listitem>
   <listitem>
    <para>
     访问<quote>更改 root</quote>环境下的已安装系统。
    </para>
   </listitem>
   <listitem>
    <para>
     检查、修改和重安装引导加载程序配置.
    </para>
   </listitem>
   <listitem>
    <para>
     从安装有误的设备驱动程序或不可用内核恢复。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 parted 命令调整分区大小。在 GNU Parted 网站 <link xlink:href="http://www.gnu.org/software/parted/parted.html"/> 上可以找到有关该工具的更多信息。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   该救援系统可以从各种来源和位置进行装载。最简单的选择是从原始安装媒体上引导该救援系统：
  </para>
  <procedure><indexterm><primary>救援系统</primary><secondary>从媒体启动</secondary></indexterm>
   <step>
    <para>
     将安装媒体插入 DVD 驱动器中。
    </para>
   </step>
   <step>
    <para>
     重引导系统。
    </para>
   </step>
   <step>
    <para>
     在引导屏幕上按 <keycap>F4</keycap> 并选择 <guimenu>DVD-ROM</guimenu>。然后从主屏幕选择<guimenu>救援系统</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在 <literal>Rescue: </literal>提示符处输入 <literal>root</literal>。无需口令。
    </para>
   </step>
  </procedure>
  <procedure xml:id="proc-trouble-data-recover-rescue-network"><indexterm> <primary>救援系统</primary> <secondary>从网络源启动</secondary> </indexterm>
   <para>
    如果硬件设置不包含 DVD 驱动器，可以从网络源引导该救援系统。以下示例适用于远程引导的情形，如果使用另一引导媒体（例如 DVD），则要相应地修改 <filename>info</filename> 文件，并像正常安装一样进行引导。
   </para>
   <step>
    <para>
     输入 PXE 引导设置的配置，添加以下行：<literal>install=<replaceable>protocol</replaceable>://<replaceable>instsource</replaceable></literal> 和<literal>rescue=1</literal>。但如果需要启动修复系统，请使用 <literal>repair=1</literal>。如同正常安装的情况一样，<replaceable>protocol</replaceable> 代表任何一种所支持的网络协议（NFS、HTTP、FTP 等）；<replaceable>instsource</replaceable> 代表网络安装源的路径。
    </para>
   </step>
   <step>
    <para>
     如<xref linkend="sec-deployment-remoteinst-boot-wol"/>中所述，使用<quote>网络唤醒</quote>引导系统。
    </para>
   </step>
   <step>
    <para>
     在 <literal>Rescue: </literal>提示符处输入 <literal>root</literal>。无需口令。
    </para>
   </step>
  </procedure>
  <para>
   一旦进入该救援系统，便可通过 <keycombo><keycap function="alt"/><keycap>F1  </keycap></keycombo>到<keycombo><keycap function="alt"/><keycap>F6</keycap></keycombo> 键来使用虚拟控制台。
  </para>
  <para>
   可以在 <filename>/bin</filename> 目录下找到外壳和许多其他有用的实用程序，如 mount 程序。<filename>sbin</filename> 目录包含重要的用于查看和修复文件系统的文件和网络实用程序。此目录还包含用于系统维护的最重要的二进制文件，如 fdisk、mkfs、mkswap、mount、mount、init 和 shutdown，以及用于维护网络的 ifconfig、ip、route 和 netstat。目录 <filename>/usr/bin</filename> 包含 vi 编辑器、find、less 和 telnet。
  </para>
  <para>
   要查看系统消息，请使用命令 <command>dmesg</command> 或查看文件 <filename>/var/log/messages</filename>。
  </para>
  <section xml:id="sec-trouble-data-recover-rescue-file">
   <title>检查和操作配置文件</title>
   <para>
    举一个可以通过该救援系统修复配置的例子，假设有一个被损坏的配置文件，使该系统无法正常引导。您可以通过救援系统修复该配置文件。
   </para>
   <procedure>
    <para>
     要操作配置文件，请执行以下步骤：
    </para>
    <step>
     <para>
      用上述方法之一启动救援系统。
     </para>
    </step>
    <step>
     <para>
      要在救援系统中装入位于 <filename>/dev/sda6</filename> 下的 root 文件系统，请使用如下命令：
     </para>
<screen>mount /dev/sda6 /mnt</screen>
     <para>
      系统所有目录现在均位于 <filename>/mnt</filename> 之下
     </para>
    </step>
    <step>
     <para>
      将目录切换为所装入的 root 文件系统：
     </para>
<screen>cd /mnt</screen>
    </step>
    <step>
     <para>
      在 vi 编辑器中打开有问题的配置文件。调整并保存配置。
     </para>
    </step>
    <step>
     <para>
      从救援系统中卸载 root 文件系统：
     </para>
<screen>umount /mnt</screen>
    </step>
    <step>
     <para>
      重引导计算机。
     </para>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-trouble-data-recover-rescue-filesystem">
   <title>修复和检查文件系统</title><indexterm><primary>文件系统</primary><secondary>修复</secondary></indexterm>
   <para>
    通常，不能在正在运行的系统上修复文件系统。如果遇到严重问题，您甚至都无法装入 root 文件系统，系统引导可能以显示 <quote>kernel panic</quote> 结束。在这种情况下，唯一的方法是从外部修复系统。<phrase os="sles;sled">强烈建议使用 YaST 系统修复功能执行此任务（请参见<xref linkend="sec-trouble-data-recover-yast"/>以了解详细信息）。 但是，如果需要执行手动文件系统检查或修复，请引导救援系统。</phrase>它包含检查并修复 <literal>btrfs</literal>、<literal>ext2</literal>、<literal>ext3</literal>、<literal>ext4</literal>、<literal>reiserfs</literal>、<literal>xfs</literal>、<literal>dosfs</literal> 和 <literal>vfat</literal> 文件系统的实用程序。
   </para>
  </section>
  <section xml:id="sec-trouble-data-recover-rescue-access">
   <title>访问已安装系统</title>
   <para>
    如果需要从救援系统访问已安装系统，需要在<emphasis>更改 root</emphasis> 环境中执行此操作。例如，修改引导加载程序配置或执行硬件配置实用程序。
   </para>
   <para>
    要设置基于已安装系统的更改 root 环境，请执行以下步骤：
   </para>
   <procedure>
    <step>
     <para>
      先从已安装系统和设备文件系统装入根分区（将设备名改为您当前的设置）：
     </para>
<screen>mount /dev/sda6 /mnt
mount --bind /dev /mnt/dev</screen>
    </step>
    <step>
     <para>
      现在可以<quote>更改 root</quote>为新的环境：
     </para>
<screen>chroot /mnt</screen>
    </step>
    <step>
     <para>
      然后装入 <filename>/proc</filename> 和 <filename>/sys</filename>：
     </para>
<screen>mount /proc
mount /sys</screen>
    </step>
    <step>
     <para>
      最后，装入已安装系统的剩余分区：
     </para>
<screen>mount -a</screen>
    </step>
    <step>
     <para>
      现在可以访问已安装系统了。在重引导系统之前，请用 <command>umount</command> <option>-a</option> 卸载分区并用 <command>exit</command> 退出<quote>更改 root</quote>环境。
     </para>
    </step>
   </procedure>
   <warning>
    <title>限制</title>
    <para>
     尽管对已安装系统的文件和应用程序有完全访问权，但仍有一些限制。运行的内核是用救援系统引导的那个，不是用更改 root 环境引导的那个。它仅支持关键硬件，内核版本如果不完全一致，则无法从已安装系统中添加内核模块。始终用 <command>uname -r</command> 检查当前正在运行的（救援）内核版本，然后查明更改 root 环境中 <filename>/lib/modules</filename> 目录下是否有匹配的子目录。如果是，可以使用已安装模块；否则，需要提供其他媒体上的正确版本，比如 USB 记忆棒。很多时候，救援内核版本与已安装模块不同，这样您完全无法访问声卡等。也不可能启动图形用户界面。
    </para>
    <para>
     还应注意，在使用 <keycombo><keycap function="alt"/><keycap>F1</keycap></keycombo> 到 <keycombo><keycap function="alt"/><keycap>F6</keycap></keycombo> 键切换控制台时，要退出<quote>更改 root</quote>环境。
    </para>
   </warning>
  </section>
  <section xml:id="sec-trouble-data-recover-rescue-grub">
   <title>修改和重安装引导加载程序</title>
   <para>
    有时，系统无法引导是因为引导加载程序配置已损坏。例如，如果没有正常工作的引导加载程序，启动例程将无法将物理驱动器转化为 Linux 文件系统中的实际位置。
   </para>
   <para>
    要检查引导加载程序配置并重安装引导加载程序，请执行以下操作：
   </para>
   <procedure>
    <step>
     <para>
      如<xref linkend="sec-trouble-data-recover-rescue-access"/> 中所述执行必要的步骤以访问已安装系统。
     </para>
    </step>
    <step>
     <para>
      依据<xref linkend="cha-grub"/> 中所述的 GRUB 配置原则，检查下列文件是否正确配置，如果需要进行修复。
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <filename>/etc/grub.conf</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/boot/grub/device.map</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/boot/grub/menu.lst</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/etc/sysconfig/bootloader</filename>
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      使用以下命令序列重安装引导加载程序：
     </para>
<screen>grub --batch &lt; /etc/grub.conf</screen>
    </step>
    <step>
     <para>
      卸载分区，从<quote>更改 root</quote>环境中注销并重引导该系统：
     </para>
<screen>umount -a
exit
reboot</screen>
    </step>
   </procedure>
  </section>
  <section xml:id="sec-trouble-data-recover-rescue-dud">
   <title>修复内核安装</title>
   <para>
    内核更新会产生新的 bug，这样会影响系统运行。例如，系统某个硬件的驱动程序有故障，您就无法访问和使用该硬件。在这种情况下，需还原到上一个工作内核（如果在系统上可用），或从安装媒体安装原始内核。
   </para>
   <tip>
    <title>如何在更新后保留最后几个内核</title>
    <para>
     为了防止内核更新出现故障后无法进行引导，请使用内核多版本功能，并告知 <systemitem>libzypp</systemitem> 在更新后保留哪些内核。
    </para>
    <para>
     例如，要始终保留最后两个内核和当前正在运行的内核，请将
    </para>
<screen>multiversion.kernels = latest,latest-1,running</screen>
    <para>
     添加到 <filename>/etc/zypp/zypp.conf</filename> 文件。
    </para>
   </tip>
   <para>
    类似的情况是，当您需要重新安装或更新不受 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 支持的设备的已损坏驱动程序时。例如，当硬件供应商使用特定设备时，比如硬件 RAID 控制器，它需要一个二进制驱动程序才能被操作系统识别。供应商通常会发布含有固定版本或更新版本的必需驱动程序的驱动程序更新磁盘。
   </para>
   <para>
    这两种情况下，您都需要以救援模式访问已安装系统，并修复内核相关问题，否则系统可能无法正确引导：
   </para>
   <procedure>
    <step>
     <para>
      从 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 安装媒体引导。
     </para>
    </step>
    <step>
     <para>
      如果您正在从内核更新故障中恢复，请跳过此步骤。如果需要使用驱动程序更新磁盘 (DUD)，请在出现引导菜单后按 <keycap>F6</keycap> 装载驱动程序更新，并选择驱动程序更新的路径或 URL，然后确认<guimenu>是</guimenu>。
     </para>
    </step>
    <step>
     <para>
      从引导菜单中选择<guimenu>救援系统</guimenu>，并按 <keycap>Enter</keycap>。如果选择使用 DUD，将要求您指定储存驱动程序更新的位置。
     </para>
    </step>
    <step>
     <para>
      在 <literal>Rescue: </literal>提示符处输入 <literal>root</literal>。无需口令。
     </para>
    </step>
    <step>
     <para>
      手动将目标系统和<quote>更改 root</quote>装入新环境。有关详细信息，请参见<xref linkend="sec-trouble-data-recover-rescue-access"/>。
     </para>
    </step>
    <step>
     <para>
      如果使用的是 DUD，请安装/重安装/更新有故障的设备驱动程序包。始终确保已安装的内核版本与您正在安装的驱动程序版本完全相同。
     </para>
     <para>
      如果要修复有故障的内核更新安装，可以从安装媒体使用以下过程安装原始内核。
     </para>
     <substeps performance="required">
      <step>
       <para>
        使用 <command>hwinfo --cdrom</command> 命令确定您的 DVD 设备信息，使用 <command>mount /dev/sr0 /mnt</command> 命令装入设备。
       </para>
      </step>
      <step>
       <para>
        导航到 DVD 上储存内核文件的目录，例如，<command>cd /mnt/suse/x86_64/</command>。
       </para>
      </step>
      <step>
       <para>
        使用 <command>rpm -i</command> 命令安装具有您风格的必需 <systemitem>kernel-*</systemitem>、<systemitem>kernel-*-base</systemitem> 和 <systemitem>kernel-*-extra</systemitem> 包。
       </para>
      </step>
      <step>
       <para>
        安装完成后，检查与新安装内核相关的新菜单项是否已添加到引导加载程序配置文件（<systemitem>grub</systemitem> 的引导加载程序配置文件是 <filename>/boot/grub/menu.lst</filename>）。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      更新配置文件，必要时可重初始化引导加载程序。有关详细信息，请参见<xref linkend="sec-trouble-data-recover-rescue-grub"/>。
     </para>
    </step>
    <step>
     <para>
      从系统驱动器中删除所有可引导的媒体，然后重引导。
     </para>
    </step>
   </procedure>
  </section>
 </section>
</section>
