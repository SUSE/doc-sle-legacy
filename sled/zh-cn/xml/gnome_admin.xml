<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN"
"novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="gnome_admin.xml" id="cha-gnome-gconf">
 <title>GNOME 配置（供管理员使用）</title>
 <para>
  本章介绍管理员可用来调整系统范围设置的 GNOME 配置选项，如自定义菜单、安装主题、配置字体、更改首选应用程序以及锁定功能。
 </para>
 <para>
  这些配置选项储存在 GConf 系统中。用 <command>gconftool-2</command> 命令行界面或 <command>gconf-editor</command> GUI 之类的工具访问 GConf 系统。
 </para>
 <sect1 id="sec-gnome-gconf">
  <title>GConf 系统</title>

  <para>
   GNOME 桌面使用 GConf 管理其配置。它是一个有层次结构的数据库或注册表，用户可在其中更改自己的设置，系统管理员可在其中为所有用户设置默认值或强制值。通过指定如下访问路径来访问 GConf 设置：<systemitem>/desktop/gnome/background/picture_filename</systemitem>—这个就好比是保存桌面背景图片文件名的键。
  </para>

  <para>
   如果想方便地浏览所有选项，请使用图形界面的 <systemitem>gconf-editor</systemitem>。gconf-editor 的简短使用描述请参见<xref linkend="sec-gnome-gconf-editor"/>。如果您需要书面解决方案，请参见<xref linkend="sec-gnome-gconftool2"/>。
  </para>

  <warning>
   <title>GNOME 控制中心对话框</title>
   <para>
    直接访问 Gconf 系统可能会导致系统不可用（如果操作有误）。
   </para>
   <para>
    缺乏经验的用户如果只是想调整一些常用的桌面功能，建议使用 GNOME 控制中心配置对话框。要启动 GNOME 控制中心，请单击<menuchoice><guimenu>计算机</guimenu><guimenu>控制中心</guimenu></menuchoice>。有关详细信息，参见<xref linkend="sec-gnome-settings-cc"/>。
   </para>
  </warning>

  <sect2 id="sec-gnome-gconf-editor">
   <title>图形界面的 gconf-editor</title>
   <para>
    gconf-editor 可用于浏览 GConf 设置，并以交互方式更改它们。要在默认的<guimenu>设置窗口</guimenu>视图中启动 gconf-editor，请单击<menuchoice><guimenu>计算机</guimenu> <guimenu>更多应用程序</guimenu></menuchoice>，然后在<guimenu>系统</guimenu>组中单击 <guimenu>GNOME 配置编辑器</guimenu>。
   </para>
   <para>
    默认情况下，用户可以更改自己桌面的设置，而管理员可以定义用于指定默认值或强制值的设置。例如，如果希望启用<emphasis>键入中断</emphasis>功能作为所有用户的强制功能，请如下操作：
   </para>
   <procedure>
    <step performance="required">
     <para>
      在命令行中以 <systemitem>root</systemitem> 用户身份启动 <command>gconf-editor</command>。
     </para>
    </step>
    <step performance="required">
     <para>
      在左侧树窗格中，展开 <systemitem>/desktop/gnome/typing_break</systemitem>。
     </para>
    </step>
    <step performance="required">
     <para>
      右键单击<guimenu>已启用</guimenu>，选择<guimenu>设置为强制</guimenu>。执行此操作后，即可管理此功能。
     </para>
    </step>
    <step performance="required">
     <para>
      单击<menuchoice><guimenu>文件</guimenu><guimenu>新强制窗口</guimenu></menuchoice>，打开<guimenu>强制设置</guimenu>窗口。
     </para>
    </step>
    <step performance="required">
     <para>
      在<guimenu>强制设置</guimenu>窗口的树窗格中，展开 <systemitem>/desktop/gnome/typing_break</systemitem>，单击<guimenu>已启用</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      单击<menuchoice><guimenu>文件</guimenu><guimenu>关闭窗口</guimenu></menuchoice>可关闭窗口并保存设置。
     </para>
    </step>
   </procedure>
   <para>
    关于 gconf-editor 的更多信息，请参见位于以下地址的配置编辑器手册：<ulink url="http://library.gnome.org/users/gconf-editor/stable/"/>。
   </para>
  </sect2>

  <sect2 id="sec-gnome-gconftool2">
   <title>gconftool-2 命令行界面</title>
   <para>
    要从命令行或脚本更改设置，请使用 <command>gconftool-2</command>。一些示例如下所示：
   </para>
   <para>
    作为 <systemitem>root</systemitem> 用户使用以下命令列出所有键的值：
   </para>
<screen>gconftool-2 --recursive-list /
</screen>
   <para>
    如果您只对某子集感兴趣，请指定如下访问路径：<systemitem>/desktop/gnome/typing_break</systemitem>：
   </para>
<screen>gconftool-2 --recursive-list /desktop/gnome/typing_break
</screen>
   <para>
    列出强制设置：
   </para>
<screen>gconftool-2 --recursive-list \
  --config-source xml:readwrite:/etc/gconf/gconf.xml.mandatory /
</screen>
   <para>
    设置 <systemitem>typing_break</systemitem> 之类强制设置：
   </para>
<screen>gconftool-2 \
  --config-source xml:readwrite:/etc/gconf/gconf.xml.mandatory \
  --type bool \
  --set /desktop/gnome/typing_break/enabled true
</screen>
   <para>
    取消强制设置：
   </para>
<screen>gconftool-2 \
  --config-source xml:readwrite:/etc/gconf/gconf.xml.mandatory \
  --unset /desktop/gnome/typing_break/enabled
</screen>
   <para>
    对默认设置，请使用 <systemitem>/etc/gconf/gconf.xml.default</systemitem>。
   </para>
   <para>
    有关 <command>gconftool-2</command> 的详细信息，请参见《GNOME 桌面系统管理指南》的“GConf 命令行工具”部分 (<ulink url="http://help.gnome.org/admin/system-admin-guide/2.32/gconf-6.html.en"/>) 和 <command>gconftool-2</command> 手册页 (<command>man gconftool-2</command>)。
   </para>
  </sect2>
 </sect1>
 <sect1>
  <title>自定义主菜单、面板和应用程序浏览器</title>



  <para>
   通过自定义以下文件，控制主菜单（<guimenu>计算机</guimenu>）的不同部分显示的默认项：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <formalpara>
     <title>/usr/share/gnome-main-menu/applications.xbel：</title>
     <para>
      默认首选应用程序列表。
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>/usr/share/gnome-main-menu/documents.xbel：</title>
     <para>
      默认首选文档列表。
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>/usr/share/gnome-main-menu/system-items.xbel：</title>
     <para>
      系统部分显示的项目。
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>

  <para>
   使用 <command>gconf-editor</command> 可以自定义显示项的数目：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <formalpara>
     <title>/desktop/gnome/applications/main-menu/file-area/min_recent_items：</title>
     <para>
      最近项目的最小数。
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>/desktop/gnome/applications/main-menu/file-area/max_total_items：</title>
     <para>
      最大总项目数。
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>

  <para>
   您可以通过不同方式自定义应用程序浏览器，例如，用户起动项目时它的行为，或者<guimenu>新应用程序</guimenu>类别中显示的项目数。用 <command>gconf-editor</command> 查找键 <systemitem>/desktop/gnome/applications/main-menu/ab_*</systemitem>。
  </para>

  <para>
   详细信息请参见位于以下地址的《GNOME 桌面系统管理指南》的“自定义菜单”部分：<ulink url="https://help.gnome.org/admin/system-admin-guide/2.32/menustructure-0.html.en"/>。
  </para>
 </sect1>
 <sect1 id="sec-gnome-gconf-autostart">
  <title>自动启动应用程序</title>

  <para>
   要在 GNOME 中自动启动应用程序，请使用以下方式之一：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <formalpara>
     <title>对每个用户运行应用程序：</title>
     <para>
      将 <filename>.desktop</filename> 文件放在 <filename>/usr/share/gnome/autostart</filename> 中。
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>对单个用户运行应用程序：</title>
     <para>
      将 <filename>.desktop</filename> 文件放在 <filename> ~/.config/autostart</filename> 中。
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>

  <para>
   要禁用自动启动的应用程序，请将 <literal>X-Autostart-enabled=false</literal> 添加到 <filename>.desktop</filename> 文件。
  </para>
 </sect1>
 <sect1 id="sec-gnome-gconf-automount">
  <title>自动装入和管理媒体设备</title>

  <para>
   Nautilus (<command>nautilus</command>) 监视卷相关事件，并以用户指定策略响应。可以使用 Nautilus 自动装入热插拔驱动器和插入式可卸媒体、自动运行程序以及播放音频 CD 或视频 DVD。Nautilus 还可以从数码相机自动导入照片。
  </para>

  <para>
   系统管理员可以设置系统范围的默认设置。有关详细信息，参见<xref linkend="sec-gnome-gconf-pref-app"/>。
  </para>
 </sect1>
 <sect1 id="sec-gnome-gconf-pref-app">
  <title>更改首选应用程序</title>

  <para>
   要更改用户的首选应用程序，请编辑 <filename>/etc/gnome_defaults.conf</filename>。在该文件内查找更多提示。
  </para>

  <para>
   编辑该文件后，请运行 <command>SuSEconfig --module glib2</command>。
  </para>

  <para>
   关于 MIME 类型的更多信息，请参见 <ulink url="http://www.freedesktop.org/Standards/shared-mime-info-spec"/>。
  </para>
 </sect1>

 <sect1 id="sec-gnome-gconf-sabayon">
  <title>用 Sabayon 管理配置文件</title>

  <para>
   Sabayon 是用于创建和应用桌面环境配置文件的系统管理工具。桌面配置文件是默认设置和限制的集合，可应用于单个用户或用户组。Sabayon 允许您用图形工具编辑 GConf 默认设置和强制密钥。
  </para>

  <para>
   配置文件定义是通过和用户要运行的会话类似的图形会话实现的，只不过是在桌面窗口中。您可以用通常方式更改属性（例如桌面背景、工具栏和可用的小程序）。Sabayon 还会检测对多数桌面应用程序中默认设置的更改。
  </para>

  <para>
   留在模拟用户主目录或桌面的文件或文档会包含在完成的配置文件中。这包括许多特定于应用程序的数据库，例如 Tomboy notes。使用该机制，可以方便地以新用户容易访问的方式提供介绍性说明或模板。
  </para>

  <para>
   用户配置文件可从父级配置文件继承其设置，覆盖或添加特定值。这会启用分级设置。例如，您可以定义 Employee 配置文件，并从中导出 Artist 和 Quality Assurance 配置文件。
  </para>

  <para>
   除了提供默认设置外，Sabayon 也可以锁定设置。这可以使设置免于被用户更改。例如，您可以指定桌面背景不能更改为您提供的默认设置以外的背景。它可以防止随意更改设置，减少了潜在的咨询台呼叫次数，并能使用和 kiosk 相似的环境。但是，它并不能提供绝对的安全性，不应如此依赖它。
  </para>

  <para>
   Sabayon 还提供了内置锁定支持的应用程序和常规用户界面元素的设置列表，包括 OpenOffice.org 和 GNOME 面板。例如，可设置面板，只允许向它添加特定小程序，禁止更改它在屏幕上的位置或大小。类似地，可在所有使用它的应用程序间禁用“保存”菜单项，禁止用户保存文档。
  </para>

  <para>
   配置文件可转移到其他计算机上。它们位于 <filename>/etc/desktop-profiles/</filename> 中，每个配置文件都保存在单独的 ZIP 文件中。
  </para>

  <sect2 id="sec-gnome-gconf-sabayon-create">
   <title>创建配置文件</title>
   <para>
    配置文件保存在位于 <filename>/etc/desktop-profiles</filename> 中的 ZIP 文件中。您保存的每个配置文件都储存在 <filename><replaceable>name-of-the-profile</replaceable>.zip</filename> 形式的单独的 ZIP 文件中。您可以将配置文件复制或移动到其他计算机。
   </para>
   <procedure>
    <step performance="required">
     <para>
      单击<menuchoice><guimenu>计算机</guimenu><guimenu>更多应用程序</guimenu><guimenu>系统</guimenu><guimenu>用户配置文件编辑器</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      如果您不是以 <systemitem>root</systemitem> 用户身份登录的，请输入 <systemitem>root</systemitem> 密码，然后单击<guimenu>继续</guimenu>。
     </para>
     <figure id="fig-gnome-gconf-sabayon1">
      <title>Sabayon：用户配置文件编辑器</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="sabayon1.png" width="70%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="sabayon1.png" width="70%" format="png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step performance="required">
     <para>
      单击“添加”<guimenu>。</guimenu>
     </para>
    </step>
    <step performance="required">
     <para>
      指定配置文件名称，然后单击<guimenu>添加</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      选择配置文件，然后单击<guimenu>编辑</guimenu>。
     </para>
     <para>
      会在 Xnest 窗口中打开新的桌面会话。
     </para>
     <figure id="fig-gnome-gconf-sabayon-xnest">
      <title>Sabayon：新的 Xnest 窗口</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="sabayon_xnest.png" width="80%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="sabayon_xnest.png" width="80%" format="png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step performance="required">
     <para>
      在 Xnest 窗口中，根据需要更改设置。
     </para>
     <para>
      您更改的每一设置都会显示在 Xnest 窗口中。
     </para>
     <para>
      您可以选择让每个设置都变为强制的（单击<menuchoice><guimenu>编辑</guimenu><guimenu>实施强制</guimenu></menuchoice>）、忽略设置（单击<menuchoice><guimenu>编辑</guimenu><guimenu>更改</guimenu><guimenu>忽略</guimenu></menuchoice>）或使某设置成为默认设置（既不选择<guimenu>忽略</guimenu>，也不选择<guimenu>强制</guimenu>）。
     </para>
    </step>
    <step performance="required">
     <para>
      要锁定用户设置，请在 Xnest 窗口中单击<menuchoice><guimenu>编辑</guimenu><guimenu>锁定</guimenu></menuchoice>。
     </para>
     <para>
      可以从下列选项中选择：
     </para>
     <formalpara>
      <title>常规：</title>
      <para>
       允许您禁用命令行、打印、打印设置以及保存到磁盘功能。
      </para>
     </formalpara>
     <formalpara>
      <title>面板：</title>
      <para>
       允许您锁定面板，禁用强制退出，禁用锁定屏幕，禁用注销，以及在<guimenu>已禁用小程序</guimenu>列表中禁用任何小程序。
      </para>
     </formalpara>
     <formalpara>
      <title>OpenOffice.org：</title>
      <para>
       允许您为 OpenOffice.org 文档定义宏安全性级别，载入和保存选项及用户界面选项。
      </para>
     </formalpara>


    </step>
    <step performance="required">
     <para>
      要保存该配置文件，请单击<menuchoice><guimenu>配置文件</guimenu><guimenu>保存</guimenu></menuchoice>。
     </para>
     <para>
      该配置文件保存在 <filename>/etc/desktop-profiles</filename> 中。
     </para>
    </step>
    <step performance="required">
     <para>
      单击<menuchoice><guimenu>配置文件</guimenu><guimenu>退出</guimenu></menuchoice>关闭 Xnest 窗口，然后单击<guimenu>关闭</guimenu>退出 Sabayon。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec-gnome-gconf-sabayon-apply">
   <title>应用配置文件</title>
   <para>
    您可以将配置文件应用到工作站上的单个用户或所有用户。
   </para>
   <procedure>
    <step performance="required">
     <para>
      单击<menuchoice><guimenu>计算机</guimenu><guimenu>更多应用程序</guimenu><guimenu>系统</guimenu><guimenu>用户配置文件编辑器</guimenu></menuchoice>。
     </para>
    </step>
    <step performance="required">
     <para>
      如果您不是以 <systemitem>root</systemitem> 用户身份登录的，请输入 <systemitem>root</systemitem> 密码，然后单击<guimenu>继续</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      选择要应用的配置文件，然后单击<guimenu>用户</guimenu>。
     </para>
     <figure id="fig-gnome-gconf-sabayon-apply-users">
      <title>Sabayon：选择用户</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="sabayon_users.png" width="54%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="sabayon_users.png" width="54%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step performance="required">
     <para>
      请选择要使用这个配置文件的用户。
     </para>
     <para>
      要对这个工作站上的所有用户应用这个配置文件，请单击<guimenu>对所有用户使用此配置文件</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      单击<guimenu>关闭</guimenu>。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sec-gnome-gconf-templates">
  <title>添加文档模板</title>

  <para>
   要为用户添加文档模板，请在用户的用户主目录中填充 <filename>Templates</filename> 目录。您可以通过将文件复制到 <filename>~/Templates</filename> 为每个用户手动执行该操作，或者在创建用户前通过将包含文档的 <filename>Templates</filename> 目录添加到 <filename>/etc/skel</filename> 在系统范围内执行该操作。
  </para>

  <para>
   用户通过右键单击桌面然后选择<guimenu>创建文档</guimenu>，从模板中创建一个新的文档。
  </para>
 </sect1>
 <sect1 id="sec-gnome-gconf-lockdown">
  <title>桌面锁定功能</title>

  <para>
   有时需要删除或禁用桌面功能或者禁止用户访问底层操作系统。GNOME 提供所谓的锁定功能，以相应地更改桌面。技术上，您可以设置 GConf 键来实现此类更改。
  </para>

  <para>
   例如，如果您打开 gconf-editor，就可以在 <systemitem>/desktop/gnome/applications/main-menu/lock-down/application_browser_link_visible</systemitem> 中看到主菜单的锁定键。其中还有所有键的描述。其他锁定键有：
  </para>

  <variablelist>
   <varlistentry>
    <term>/desktop/gnome/lockdown/disable_command_line</term>
    <listitem>
     <para>
      如果设置，则主菜单和 AppBrowser 中不会显示终端。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>/apps/panel/global/disable_log_out</term>
    <listitem>
     <para/>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>/apps/panel/global/disable_lock_screen</term>
    <listitem>
     <para>
      如果设置，则主菜单不会显示这些项目。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>



  <para>
   在 <systemitem>/apps/firefox/lockdown</systemitem> 中可找到 Firefox 锁定键。
  </para>

  <para>
   有关更多信息，请参见 Sayamindu Dasgupta 编写的<quote>GNOME 锁定和预配置管理员指南</quote>：<ulink url="http://library.gnome.org/admin/deployment-guide/"/>。
  </para>
 </sect1>
 <sect1 id="sec-gnome-gconf-info">
  <title>更多信息</title>

  <para>
   有关详细信息，参见 <ulink url="http://library.gnome.org/admin/"/>。
  </para>
 </sect1>
</chapter>
