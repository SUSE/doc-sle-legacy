<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE chapter
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="net_samba.xml" xml:id="cha-samba"><title>Samba</title><info><abstract>
  <para>
   使用 Samba，可以将 Unix 计算机配置为 Mac OS X、Windows 和 OS/2 计算机的文件和打印服务器。Samba 已经发展成为一个功能完备且相当复杂的产品。使用 YaST、SWAT（一种 Web 界面）或通过手动编辑配置文件的方式来配置 Samba。
  </para>
 </abstract></info>
 <indexterm xml:id="idx-Samba" class="startofrange"> <primary>Samba</primary> </indexterm> <indexterm> <primary>SMB</primary> <see>Samba</see> </indexterm> <indexterm> <primary>Mac OS X</primary> <secondary>共享文件</secondary> </indexterm> <indexterm> <primary>Windows</primary> <secondary>共享文件</secondary> </indexterm> <indexterm> <primary>OS/2</primary> <secondary>共享文件</secondary> </indexterm> <indexterm> <primary>Linux</primary> <secondary>与另一种操作系统共享文件</secondary> </indexterm>
 
 <section xml:id="sec-samba-term">
  <title>术语</title>

  <para>
   以下是 Samba 文档和 YaST 模块中使用的一些术语。
  </para>

  <variablelist>
   <varlistentry>
    <term>SMB 协议</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>SMB</secondary></indexterm><indexterm><primary>协议</primary><secondary>SMB</secondary></indexterm><indexterm><primary>smbd</primary></indexterm>Samba 使用基于 <phrase role="productname">NetBIOS</phrase> 服务的 SMB（服务器消息块）协议。Microsoft 发布该协议以便其他软件制造商能够与 Microsoft 域网络建立连接。使用 Samba 时，SMB 协议在 TCP/IP 协议之上工作，所以必须在所有客户端上安装 TCP/IP 协议。<indexterm> <primary>Samba</primary> <secondary>TCP/IP</secondary> </indexterm>
     </para>
     
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CIFS 协议</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>CIFS</secondary></indexterm><indexterm><primary>协议</primary><secondary>CIFS</secondary></indexterm>（常用因特网文件系统）协议是 Samba 支持的另一种协议。CIFS 定义网络中使用的标准远程文件系统访问协议，使用户组能够一起工作并在网络中共享文档。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS<indexterm> <primary>Samba</primary> <secondary>名称</secondary> </indexterm></term>
    <listitem>
     <para>
      <indexterm><primary>NetBIOS</primary></indexterm> NetBIOS 是为用于提供名称服务的计算机之间进行通讯而设计的软件接口 (API)。它使连接到网络的计算机能够为自己保留名称。之后便可以根据名称对这些计算机进行寻址。没有任何中心进程来检查这些名称。网络上的任何计算机均可以保留所需数量的名称，前提是这些名称均未使用。可以为不同的网络体系结构实施 NetBIOS 接口。<phrase role="productname">NetBEUI</phrase> 是与网络硬件结合相对密切的一种实施，但它常被称为 <phrase role="productname">NetBIOS</phrase>。使用 NetBIOS 实施的网络协议包括 Novell 的 IPX（通过 TCP/IP 的 NetBIOS）和 TCP/IP。
     </para>
     <para>
      通过 TCP/IP 发送的 NetBIOS 名称与 <filename>/etc/hosts</filename> 中使用的名称或 DNS 定义的名称没有相同之处。NetBIOS 使用它自己的、完全独立的命名约定。但为了方便管理，仍建议您使用与 DNS 主机名对应的名称，或本机使用 DNS。Samba 默认采用这种方式。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba 服务器<indexterm> <primary>Samba</primary> <secondary>服务器</secondary> </indexterm></term>
    <listitem>
     <para>
      Samba 服务器向客户端提供 SMB/CIFS 服务和 NetBIOS over IP 命名服务。对于 Linux，Samba 服务器有三个守护程序：smbd 用于 SMB/CIFS 服务，nmbd 用于命名服务，winbind 用于身份验证。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba 客户端<indexterm xml:id="idx-Samba-clients" class="startofrange"> <primary>Samba</primary> <secondary>客户端</secondary> </indexterm></term>
    <listitem>
     <para>
      Samba 客户端是一种能够通过 SMB 协议从 Samba 服务器使用 Samba 服务的系统。所有常见操作系统（Mac OS X、Windows 和 OS/2 等）都支持 SMB 协议。必须在所有计算机上安装 TCP/IP 协议。Samba 为多种不同的 UNIX 系统提供客户端。对于 Linux，有一个用于 SMB 的内核模块，它允许在 Linux 系统级别上集成 SMB 资源。不需要对 Samba 客户端运行任何守护程序。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>共享</term>
    <listitem>
     <para>
      <indexterm><primary>Samba</primary><secondary>共享</secondary></indexterm>SMB 服务器通过共享为其客户端提供资源。共享就是服务器上的打印机和目录及其子目录。可以通过名称来导出并访问共享。可以将共享名称设置为任何名称 － 不一定是导出目录的名称。也可以为打印机指派一个名称。客户端可以根据打印机的名称来访问打印机。<indexterm><primary>打印</primary><secondary>Samba</secondary></indexterm><indexterm><primary>Samba</primary><secondary>打印机  </secondary></indexterm><indexterm class="endofrange" startref="idx-Samba-clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>DC</secondary> </indexterm> 域控制器 (DC) 是处理域中的帐户的服务器。为了复制数据，一个域中可有更多域控制器可用。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 
 
 <section xml:id="sec-samba-serv-inst">
  <title>配置 Samba 服务器</title><indexterm> <primary>Samba</primary> <secondary>安装</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>服务器</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>配置</secondary> </indexterm> <indexterm> <primary>配置</primary> <secondary>Samba</secondary> </indexterm>

  

  <para os="sled">
   要配置 Samba 服务器，请参见相应的 SUSE Linux Enterprise Server 文档。
  </para>

  

  

  
 </section>
 <section xml:id="sec-samba-client-inst">
  <title>配置客户端</title><indexterm> <primary>Samba</primary> <secondary>客户端</secondary> </indexterm>

  <para>
   客户端只能通过 TCP/IP 访问 Samba 服务器。NetBEUI 和通过 IPX 的 NetBIOS 不能与 Samba 共用。
  </para>

  <section xml:id="sec-samba-client-inst-yast">
   <title>使用 YaST 配置 Samba 客户端</title><indexterm> <primary>YaST</primary> <secondary>Samba</secondary> <tertiary>客户端</tertiary> </indexterm> <indexterm> <primary>Samba</primary><secondary>客户端</secondary> </indexterm> <indexterm> <primary>配置</primary> <secondary>Samba</secondary> <tertiary>客户端</tertiary> </indexterm>
   <para>
    配置 Samba 客户端来访问 Samba 或 Windows 服务器上的资源（文件或打印机）。在<menuchoice> <guimenu>网络服务</guimenu> <guimenu>Windows 域成员资格</guimenu></menuchoice>对话框中输入 NT 或 Active Directory 域或工作组。如果激活<guimenu>将 SMB 信息也用于 Linux 身份验证</guimenu>，则用户身份验证将在 Samba、NT 或 Kerberos 服务器上运行。
   </para>

   <para>
    单击<guimenu>专家设置</guimenu>获取高级配置选项。例如，使用<guimenu>装入服务器目录</guimenu>表启用自动装入服务器用户主目录和身份验证。这样用户就能访问位于 CIFS 上的用户主目录。有关细节，请参见 <systemitem>pam_mount</systemitem> 手册页。
   </para>
   <para>
    完成所有设置后，请确认对话框以完成配置。
   </para>
  </section>
 </section>
 <section xml:id="sec-samba-anmeld-serv">
  <title>将 Samba 用作登录服务器</title><indexterm> <primary>Samba</primary> <secondary>登录</secondary> </indexterm>

  <para>
   在主要由 Windows 客户端组成的网络中，使用户只能使用有效帐户和口令进行注册通常是最好的选择。在基于 Windows 的网络中，此任务由主域控制器 (PDC) 来处理。您可以使用配置为 PDC 的 Windows NT 服务器，但是此任务也可以借助 Samba 服务器来完成。中显示了必须在 <filename>smb.conf</filename> 的 <literal>[global]</literal> 部分设置的项。<xref linkend="dat-samba-smb-conf-dom"/>
  </para>

  <example xml:id="dat-samba-smb-conf-dom">
   <title>smb.conf 中的 global 部分</title>
<screen>[global]
    workgroup = TUX-NET
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   如果使用加密口令进行校验，则 Samba 服务器必须能够处理加密口令。<literal>[global]</literal> 部分中的 <literal>encrypt passwords = yes</literal> 项启用了此功能（对于 Samba 版本 3，这是默认设置）。此外，还需要以适合 Windows 的加密格式来准备用户帐户和口令。使用命令 <command>smbpasswd</command> <option>-a name</option> 可完成此任务。使用以下命令为计算机创建 Windows 域概念要求的域帐户：
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm> <primary>命令</primary> <secondary>smbpasswd</secondary> </indexterm>

  <para>
   使用 <command>useradd</command> 命令可添加一个美元符号。命令 <command>smbpasswd</command> 在使用参数 <option>-m</option> 时自动插入此符号。带注释的配置示例 (<filename>/usr/share/doc/packages/samba/examples/smb.conf.SUSE</filename>) 包含自动执行此任务的设置。
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   要确保 Samba 能够正确执行此脚本，请选择具有必需的管理员权限的 Samba 用户，并将其添加到 <systemitem class="groupname">ntadmin</systemitem> 组中。然后可以使用以下命令为属于此 Linux 组的所有用户指派 <literal>Domain Admin</literal> 状态：
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>

  <para>
   有关此主题的更多信息，请参见《Samba 3 操作指南》第 12 章，此指南可以在 <filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename> 中找到。
  </para>
 </section>
 
 <section xml:id="sec-samba-info">
  <title>更多信息</title>

  <para>
   关于 Samba 的详细信息，请参见数字文档。在命令行输入 <command>apropos</command><option>samba</option> 可显示一些手册页；如果安装了 Samba 文档，也可以浏览 <filename>/usr/share/doc/packages/samba</filename> 目录获得更多的联机文档和示例。<filename>examples</filename> 子目录中提供了一个带注释的示例配置 (<filename>smb.conf.SUSE</filename>)。<indexterm> <primary>配置文件</primary> <secondary>smb.conf</secondary> </indexterm>
  </para>

  <para>
   Samba 小组提供的《Samba 3 操作指南》中有一节专门介绍查错。此外，文档的第 V 部分提供了检查配置的逐步指南。安装包 <systemitem>samba-doc</systemitem> 后，可以在 <filename>/usr/share/doc/packages/samba/Samba 3-HOWTO.pdf</filename> 中找到《Samba 3 操作指南》。
  </para>

  <indexterm class="endofrange" startref="idx-Samba"/>
 </section>
</chapter>
