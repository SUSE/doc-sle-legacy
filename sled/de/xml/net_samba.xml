<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE chapter
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="net_samba.xml" xml:id="cha-samba"><title>Samba</title><info><abstract>
  <para>
   Mit Samba kann ein Unix-Computer als Datei- und Druckserver für Mac OS X-, Windows- und OS/2-Computer konfiguriert werden. Samba ist mittlerweile ein sehr umfassendes und komplexes Produkt. Konfigurieren Sie Samba mit YaST, SWAT (eine Web-Schnittstelle) oder indem Sie die Konfigurationsdatei manuell bearbeiten.
  </para>
 </abstract></info>
 <indexterm xml:id="idx-Samba" class="startofrange"> <primary>Samba</primary> </indexterm> <indexterm> <primary>SMB</primary> <see>Samba</see> </indexterm> <indexterm> <primary>Mac OS X</primary> <secondary>Dateien freigeben</secondary> </indexterm> <indexterm> <primary>Windows</primary> <secondary>Dateien freigeben</secondary> </indexterm> <indexterm> <primary>OS/2</primary> <secondary>Dateien freigeben</secondary> </indexterm> <indexterm> <primary>Linux</primary> <secondary>Dateien freigeben mit einem anderen Betriebssystem</secondary> </indexterm>

 <section xml:id="sec-samba-term">
  <title>Terminologie</title>

  <para>
   Im Folgenden werden einige Begriffe erläutert, die in der Samba-Dokumentation und im YaST-Modul verwendet werden.
  </para>

  <variablelist>
   <varlistentry>
    <term>SMB-Protokoll</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>SMB</secondary> </indexterm> <indexterm> <primary>protocols</primary> <secondary>SMB</secondary> </indexterm> <indexterm> <primary>smbd</primary> </indexterm> Samba verwendet das SMB-Protokoll (Server Message Block), das auf den <phrase role="productname">NetBIOS</phrase>-Diensten basiert. Microsoft veröffentlichte das Protokoll, damit auch andere Softwarehersteller Anbindungen an ein Microsoft-Domänennetzwerk einrichten konnten. Samba setzt das SMB- auf das TCP/IP-Protokoll auf. Entsprechend muss auf allen Clients das TCP/IP-Protokoll installiert sein. <indexterm> <primary>Samba</primary> <secondary>TCP/IP und</secondary> </indexterm>
     </para>
     
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CIFS-Protokoll</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>CIFS</secondary> </indexterm> <indexterm> <primary>Protokolle</primary> <secondary>CIFS</secondary> </indexterm> Das CIFS-Protokoll (Common Internet File System) ist ein weiteres von Samba unterstütztes Protokoll. CIFS definiert ein Standardprotokoll für den Fernzugriff auf Dateisysteme über das Netzwerk, das Benutzergruppen die netzwerkweite Zusammenarbeit und gemeinsame Dokumentbenutzung ermöglicht.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS<indexterm> <primary>Samba</primary> <secondary>Namen</secondary> </indexterm></term>
    <listitem>
     <para>
      <indexterm> <primary>NetBIOS</primary> </indexterm> NetBIOS ist eine Softwareschnittstelle (API) für die Kommunikation zwischen Computern, die einen Name Service bereitstellen. Mit diesem Dienst können die an das Netzwerk angeschlossenen Computer Namen für sich reservieren. Nach dieser Reservierung können die Computer anhand ihrer Namen adressiert werden. Für die Überprüfung der Namen gibt es keine zentrale Instanz. Jeder Computer im Netzwerk kann beliebig viele Namen reservieren, solange die Namen noch nicht Gebrauch sind. Die NetBIOS-Schnittstelle kann in unterschiedlichen Netzwerkarchitekturen implementiert werden. Eine Implementierung, die relativ eng mit der Netzwerkhardware arbeitet, ist <phrase role="productname">NetBEUI</phrase> (häufig auch als <phrase role="productname">NetBIOS</phrase> bezeichnet). Mit NetBIOS implementierte Netzwerkprotokolle sind IPX (NetBIOS über TCP/IP) von Novell und TCP/IP.
     </para>
     <para>
      Die per TCP/IP übermittelten NetBIOS-Namen haben nichts mit den in der Datei <filename>/etc/hosts</filename> oder per DNS vergebenen Namen zu tun. NetBIOS ist ein eigener, vollständig unabhängiger Namensraum. Es empfiehlt sich jedoch, für eine einfachere Administration NetBIOS-Namen zu vergeben, die den jeweiligen DNS-Hostnamen entsprechen, oder DNS nativ zu verwenden. Für einen Samba-Server ist dies die Voreinstellung.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba-Server<indexterm> <primary>Samba</primary> <secondary>Server</secondary> </indexterm></term>
    <listitem>
     <para>
      Samba-Server stellt SMB/CIFS-Dienste sowie NetBIOS over IP-Namensdienste für Clients zur Verfügung. Für Linux gibt es drei Dämonen für Samba-Server: smbd für SMB/CIFS-Dienste, nmbd für Naming Services und winbind für Authentifizierung.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba-Client<indexterm xml:id="idx-Samba-clients" class="startofrange"> <primary>Samba</primary> <secondary>Clients</secondary> </indexterm></term>
    <listitem>
     <para>
      Der Samba-Client ist ein System, das Samba-Dienste von einem Samba-Server über das SMB-Protokoll nutzt. Das Samba-Protokoll wird von allen gängigen Betriebssystemen wie Mac OS X, Windows und OS/2 unterstützt. Auf den Computern muss das TCP/IP-Protokoll installiert sein. Für die verschiedenen UNIX-Versionen stellt Samba einen Client zur Verfügung. Für Linux gibt es zudem ein Dateisystem-Kernel-Modul für SMB, das die Integration von SMB-Ressourcen auf Linux-Systemebene ermöglicht. Sie brauchen für den Samba-Client keinen Dämon auszuführen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Freigaben</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>Freigaben</secondary> </indexterm>SMB-Server stellen den Clients Ressourcen in Form von Freigaben (Shares) zur Verfügung. Freigaben sind Drucker und Verzeichnisse mit ihren Unterverzeichnissen auf dem Server. Eine Freigabe wird unter einem eigenen Namen exportiert und kann von Clients unter diesem Namen angesprochen werden. Der Freigabename kann frei vergeben werden. Er muss nicht dem Namen des exportierten Verzeichnisses entsprechen. Ebenso wird einem Drucker ein Name zugeordnet. Clients können mit diesem Namen auf den Drucker zugreifen. <indexterm> <primary>Drucken</primary> <secondary>Samba</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>Drucker</secondary> </indexterm> <indexterm class="endofrange" startref="idx-Samba-clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm> <primary>Samba</primary> <secondary>DC</secondary> </indexterm> Ein Domain Controller (DC) ist ein Server, der Konten in der Domäne verwaltet. Zur Datenreplikation stehen zusätzliche Domain Controller in einer Domäne zur Verfügung.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 
 
 <section xml:id="sec-samba-serv-inst">
  <title>Konfigurieren eines Samba-Servers</title><indexterm> <primary>Samba</primary> <secondary>Installieren</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>Server</secondary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>Konfigurieren</secondary> </indexterm> <indexterm> <primary>Konfigurieren</primary> <secondary>Samba</secondary> </indexterm>

  

  <para os="sled">
   Informationen zum Konfigurieren eines Samba-Servers finden Sie in der Dokumentationen für SUSE Linux Enterprise Server.
  </para>

  

  

  
 </section>
 <section xml:id="sec-samba-client-inst">
  <title>Konfigurieren der Clients</title><indexterm> <primary>Samba</primary> <secondary>Clients</secondary> </indexterm>

  <para>
   Clients können auf den Samba-Server nur über TCP/IP zugreifen. NetBEUI oder NetBIOS über IPX können mit Samba nicht verwendet werden.
  </para>

  <section xml:id="sec-samba-client-inst-yast">
   <title>Konfigurieren eines Samba-Clients mit YaST</title><indexterm> <primary>YaST</primary> <secondary>Samba</secondary> <tertiary>Clients</tertiary> </indexterm> <indexterm> <primary>Samba</primary> <secondary>Clients</secondary> </indexterm> <indexterm> <primary>Konfigurieren</primary> <secondary>Samba</secondary> <tertiary>Clients</tertiary> </indexterm>
   <para>
    Konfigurieren Sie einen Samba-Client, um auf Ressourcen (Dateien oder Drucker) auf dem Samba- oder Windows-Server zuzugreifen. Geben Sie im Dialogfeld <menuchoice> <guimenu>Netzwerkdienste</guimenu> <guimenu>Windows-Domänenmitgliedschaft</guimenu></menuchoice> die NT- oder Active Directory-Domäne oder -Arbeitsgruppe an. Wenn Sie <guimenu>Zusätzlich SMB-Informationen für Linux-Authentifizierung verwenden </guimenu> aktivieren, erfolgt die Benutzerauthentifizierung über den Samba&amp;#x2011;, NT- oder Kerberos-Server.
   </para>

   <para>
    Klicken Sie für erweiterte Konfigurationsoptionen auf <guimenu>Einstellungen für Experten</guimenu>. Sie können z. B. über die Tabelle <guimenu>Serververzeichnisse einhängen</guimenu> das automatische Einhängen des Server-Basisverzeichnisses bei der Authentifizierung aktivieren. Auf diese Weise können Benutzer auf ihre Home-Verzeichnisse zugreifen, wenn diese in CIFS gehostet sind. Einzelheiten finden Sie auf der man-Seite <systemitem>pam_mount</systemitem>.
   </para>
   <para>
    Bestätigen Sie zum Abschluss alle Einstellungen, um die Konfiguration zu beenden.
   </para>
  </section>
 </section>
 <section xml:id="sec-samba-anmeld-serv">
  <title>Samba als Anmeldeserver</title><indexterm> <primary>Samba</primary> <secondary>Anmelden</secondary> </indexterm>

  <para>
   In Netzwerken, in denen sich überwiegend Windows-Clients befinden, ist es oft wünschenswert, dass sich Benutzer nur mit einem gültigen Konto und zugehörigem Passwort anmelden dürfen. In einem Windows-basierten Netzwerk wird diese Aufgabe von einem Primary Domain Controller (PDC) übernommen. Sie können einen Windows NT-Server verwenden, der als PDC konfiguriert ist; diese Aufgabe kann aber auch mithilfe eines Samba-Servers ausgeführt werden. Es müssen Einträge im Abschnitt <literal>[global]</literal> von <filename>smb.conf</filename> vorgenommen werden. Diese werden in <xref linkend="dat-samba-smb-conf-dom"/> beschrieben.
  </para>

  <example xml:id="dat-samba-smb-conf-dom">
   <title>Abschnitt „global“ in smb.conf</title>
<screen>[global]
    workgroup = TUX-NET
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   Wenn verschlüsselte Passwörter zur Verifizierung verwendet werden, muss der Samba-Server in der Lage sein, diese zu verwalten. Dies wird durch den Eintrag <literal>encrypt passwords = yes</literal> im Abschnitt <literal>[global]</literal> aktiviert (ab Samba Version 3 ist dies Standard). Außerdem müssen die Benutzerkonten bzw. die Passwörter in eine Windows-konforme Verschlüsselungsform gebracht werden. Dies erfolgt mit dem Befehl <command>smbpasswd</command> <option>-a name</option>. Da nach dem Windows-Domänenkonzept auch die Computer selbst ein Domänenkonto benötigen, wird dieses mit den folgenden Kommandos angelegt:
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm> <primary>commands</primary> <secondary>smbpasswd</secondary> </indexterm>

  <para>
   Mit dem Befehl <command>useradd</command> wird ein Dollarzeichen hinzugefügt. Der Befehl <command>smbpasswd</command> fügt dieses bei der Verwendung des Parameters <option>-m</option> automatisch hinzu. In der kommentierten Beispielkonfiguration (<filename>/usr/share/doc/packages/Samba/examples/smb.conf.SuSE</filename>) sind Einstellungen enthalten, die diese Aufgabe automatisieren.
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   Um sicherzustellen, dass Samba dieses Skript korrekt ausführen kann, wählen Sie einen Samba-Benutzer mit den erforderlichen Administratorberechtigungen und fügen Sie ihn zur Gruppe <systemitem class="groupname">ntadmin</systemitem> hinzu. Anschließend können Sie allen Mitgliedern der Linux-Gruppe den Status <literal>Domain Admin</literal> zuweisen, indem Sie folgendes Kommando eingeben:
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>

  <para>
   Weitere Informationen zu diesem Thema finden Sie in Kapitel 12 in Samba 3 HOWTO (<filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>).
  </para>
 </section>
 
 <section xml:id="sec-samba-info">
  <title>Weiterführende Informationen</title>

  <para>
   Ausführliche Informationen zu Samba finden Sie in der digitalen Dokumentation. Wenn Samba installiert ist, können Sie in der Kommandozeile <command>apropos</command> <option>samba</option> eingeben, um einige man-Seiten aufzurufen. Alternativ dazu finden Sie im Verzeichnis <filename>/usr/share/doc/packages/samba</filename> weitere Online-Dokumentationen und Beispiele. Eine kommentierte Beispielkonfiguration (<filename>smb.conf.SuSE</filename>) finden Sie im Unterverzeichnis <filename>examples</filename>. <indexterm><primary>Konfigurationsdateien</primary> <secondary>smb.conf</secondary> </indexterm>
  </para>

  <para>
   Das Samba-Team liefert in Samba 3 HOWTO einen Abschnitt zur Fehlerbehebung. In Teil V ist außerdem eine ausführliche Anleitung zum Überprüfen der Konfiguration enthalten. Nach der Installation des Pakets <filename>samba-doc </filename> finden Sie das Samba 3 HOWTO-Dokument im Verzeichnis <systemitem>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</systemitem>.
  </para>

  <indexterm class="endofrange" startref="idx-Samba"/>
 </section>
</chapter>
