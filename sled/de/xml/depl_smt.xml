<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
    type="text/xml"
    title="Profiling step"
?>
<!DOCTYPE chapter
[
   <!ENTITY % entities SYSTEM "entity-decl.ent">
   %entities;
]>


<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1" xml:base="depl_smt.xml" xml:id="cha-smt"><title>Abonnementverwaltung</title><info/>


 <para>
  Sie können einen beliebigen Rechner, auf dem SUSE Linux Enterprise Server 11 oder SUSE Linux Enterprise Desktop 11 ausgeführt wird, für die Registrierung bei einem lokalen SMT-Server (Subscription Management Tool) konfigurieren und dort Software-Aktualisierungen herunterladen, anstatt direkt mit dem Novell Customer Center und den NU-Servern zu kommunizieren. Für den Einsatz eines SMT-Servers zur Clientregistrierung und als lokale Aktualisierungsquelle müssen Sie zunächst den SMT-Server in Ihrem Netzwerk konfigurieren. Die SMT-Server-Software ist als Add-on for SUSE Linux Enterprise Server erhältlich. Die Konfiguration dieser Software wird im <emphasis>Subscription Management Tool Guide</emphasis> (SMT-Handbuch) beschrieben. Es müssen keinerlei Add-ons auf den Clients installiert werden, die zur Registrierung auf einem SMT-Server konfiguriert werden.
 </para>
 <para>
  Zur Registrierung eines Clients auf einem SMT-Server müssen Sie den Client mit der URL des Servers ausstatten. Da Client und Server während der Registrierung über das HTTPS-Protokoll kommunizieren, müssen Sie auch sicherstellen, dass das Zertifikat des Servers für den Client verbürgt ist. Falls Ihr SMT-Server auf die Verwendung des Standardserverzertifikats eingestellt ist, steht das CA-Zertifikat auf dem SMT-Server über das HTTP-Protokoll unter <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal> zur Verfügung. In diesem Fall müssen Sie sich nicht um das Zertifikat kümmern: Der Registrierungsvorgang lädt das CA-Zertifikat automatisch von dort herunter, sofern keine andere Konfiguration festgelegt wurde. Sie müssen einen Pfad zum CA-Zertifikat des Servers eingeben, wenn das Zertifikat von einer externen Zertifizierungsstelle ausgestellt wurde.
 </para>
 <note>
  <title>Registrierung in der Subdomäne <literal>*.novell.com</literal></title>
  <para>
   Wenn Sie versuchen, sich bei einer <literal>*.novell.com</literal>-Subdomäne zu registrieren, wird das Zertifikat (aus Sicherheitsgründen) nicht während der Registrierung heruntergeladen und es erfolgt keine Verarbeitung mit Zertifikaten. Verwenden Sie in solchen Fällen einen anderen Domänennamen oder eine normale IP-Adresse.
  </para>
 </note>
 <para>
  Es bestehen mehrere Möglichkeiten, diese Information bereitzustellen und den Clientcomputer für die Verwendung von SMT zu konfigurieren. Die erste Möglichkeit ist die Bereitstellung der erforderlichen Information über Kernel-Parameter beim Booten. Die zweite Möglichkeit ist die Konfigurierung von Clients mithilfe eines AutoYaST-Profils. Mit Subscription Management Tool wird auch das Skript <command>clientSetup4SMT.sh</command> verteilt, das auf einem Client ausgeführt werden kann, damit er sich bei einem angegebenen SMT-Server registriert. Diese Möglichkeiten werden in den folgenden Abschnitten beschrieben:
 </para>
 <section xml:id="smt-client-parameters">
  <title>Verwenden von Kernel-Parametern zum Zugriff auf einen SMT-Server</title>

  <para>
   Jeder Client kann zur Verwendung von SMT konfiguriert werden, indem beim Computerstart die folgenden Kernel-Parameter bereitgestellt werden: <literal>regurl</literal> und <literal>regcert</literal>. Der erste Parameter ist obligatorisch, der zweite optional.
  </para>

  <variablelist>
   <varlistentry>
    <term>regurl</term>
    <listitem>
     <para>
      URL des SMT-Servers. Die URL muss folgendes Format aufweisen: <literal>https://<replaceable>FQDN</replaceable>/center/regsvc/</literal>, wobei <replaceable>FQDN</replaceable> der vollständig qualifizierte Hostname des SMT-Server ist. Er muss identisch mit dem FQDN des Serverzertifikats auf dem SMT-Server sein. Beispiel:
     </para>
<screen>regurl=https://smt.example.com/center/regsvc/</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>regcert</term>
    <listitem>
     <para>
      Standort des SMT-Serverzertifikats. Geben Sie eine der folgenden Optionen an:
     </para>
     <variablelist>
      <varlistentry>
       <term>URL</term>
       <listitem>
        <para>
         Remotestandort (http, https oder ftp), von dem das Zertifikat heruntergeladen werden kann. Beispiel:
        </para>
<screen>regcert=http://smt.example.com/smt.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Diskette</term>
       <listitem>
        <para>
         Legt einen Standort auf einer Diskette fest. Die Diskette muss zum Zeitpunkt des Bootens eingelegt sein. (Sie werden nicht zum Einlegen aufgefordert, wenn sie fehlt.) Der Wert muss mit der Zeichenfolge <literal>floppy</literal> beginnen, gefolgt vom Pfad zum Zertifikat. Beispiel:
        </para>
<screen>regcert=floppy/smt/smt-ca.crt</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Lokaler Pfad</term>
       <listitem>
        <para>
         Absoluter Pfad zum Zertifikat auf dem lokalen Rechner. Beispiel:
        </para>
<screen>regcert=/data/inst/smt/smt-ca.cert</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Interaktiv</term>
       <listitem>
        <para>
         Verwenden Sie <literal>ask</literal> während der Installation zum Öffnen eines Pop-up-Menüs, in dem Sie den Pfad zum Zertifikat angeben können. Verwenden Sie diese Option nicht bei AutoYaST. Beispiel:
        </para>
<screen>regcert=ask</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Zertifikatsinstallation deaktivieren</term>
       <listitem>
        <para>
         Verwenden Sie <literal>fertig</literal>, wenn das Zertifikat durch ein Add-On-Produkt installiert wird, oder wenn Sie ein Zertifikat verwenden, das durch eine offizielle Zertifizierungsstelle ausgestellt wurde. Beispiel:
        </para>
<screen>regcert=done</screen>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>Achten Sie auf Eingabefehler</title>
   <para>
    Achten Sie darauf, dass Sie richtige Werte eingeben. Wenn <literal>regurl</literal> nicht richtig angegeben wurde, schlägt die Registrierung der Aktualisierungsquelle fehl.
   </para>
   <para>
    Wenn ein falscher Wert für <literal>regcert</literal> eingegeben wurde, werden Sie zum Eingeben eines lokalen Pfads zum Zertifikat aufgefordert. Wenn <literal>regcert</literal> nicht festgelegt ist, wird standardmäßig <literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal> mit <literal>FQDN</literal> als Name des SMT-Servers verwendet.
   </para>
  </warning>

  <warning>
   <title>Ändern des SMT-Serverzertifikats</title>
   <para>
    Wenn der SMT-Server ein neues Zertifikat von einer neuen und nicht verbürgten Zertifizierungsstelle erhält, müssen die Clients die neue CA-Zertifikatdatei abrufen. Dies erfolgt automatisch beim Registrierungsvorgang, aber nur, wenn bei der Installation eine URL zum Abrufen des Zertifikats verwendet wurde oder wenn der Parameter <literal>regcert</literal> weggelassen wurde und daher die Standard-URL benutzt wird. Wenn das Zertifikat unter Verwendung einer anderen Methode geladen wurde (z. B. Diskette oder lokaler Pfad), wird das CA-Zertifikat nicht aktualisiert.
   </para>
  </warning>
 </section>
 <section xml:id="smt-client-autoyast">
  <title>Konfigurieren von Clients mit dem AutoYaST-Profil</title>

  <para>
   Clients können zur Registrierung bei SMT-Server über das AutoYaST-Profil konfiguriert werden. Allgemeine Informationen zum Erstellen von AutoYaST-Profilen und Vorbereiten der automatischen Installation finden Sie unter <xref linkend="cha-deployment-autoinst"/>. In diesem Abschnitt wird nur die SMT-spezifische Konfiguration beschrieben.
  </para>

  <para>
   So konfigurieren Sie SMT-spezifische Daten mithilfe von AutoYaST:
  </para>

  <procedure>
   <step>
    <para>
     Starten Sie YaST als <systemitem class="username">root</systemitem>, und wählen Sie <menuchoice><guimenu>Verschiedenes</guimenu> <guimenu>Automatische Installation</guimenu></menuchoice>, um das grafische AutoYaST-Frontend zu starten.
    </para>
    <para>
     Sie können das grafische AutoYaST-Frontend mit <command>yast2 autoyast</command> von einer Kommandozeile aus starten.

    </para>
   </step>
   <step>
    <para>
     Öffnen Sie ein bestehendes Profil über <menuchoice><guimenu>Datei</guimenu><guimenu>Öffnen</guimenu></menuchoice>, erstellen Sie ein Profil auf der Basis der Konfiguration des aktuellen Systems über <menuchoice><guimenu>Werkzeuge</guimenu><guimenu>Referenzprofil erstellen</guimenu></menuchoice> oder beginnen Sie einfach mit einem leeren Profil.
    </para>
   </step>
   <step>
    <para>
     Wählen Sie <menuchoice><guimenu>Support</guimenu><guimenu>Novell Customer Center-Konfiguration</guimenu></menuchoice>. Eine Übersicht der aktuellen Konfiguration wird angezeigt.
    </para>
   </step>
   <step>
    <para>
     Klicken Sie auf <guimenu>Bearbeiten</guimenu>.
    </para>
   </step>
   <step>

    <para>
     Wählen Sie zur automatischen Registrierung während der Installation <guimenu>Produktregistrierung ausführen</guimenu>. Mit <guimenu>Hardware-Profil</guimenu> und <guimenu>Optionale Informationen</guimenu> können Sie Informationen von Ihrem System einschließen.
    </para>
   </step>
   <step>
    <para>
     Legen Sie die URL des <guimenu>SMT-Servers</guimenu> und optional den Speicherort des <guimenu>SMT-Zertifikats</guimenu> fest. Die möglichen Werte sind dieselben wie für die Kernel-Parameter <literal>regurl</literal> und <literal>regcert</literal> (siehe <xref linkend="smt-client-parameters"/>). Einzige Ausnahme dabei: Der Wert <literal>ask</literal> für <literal>regcert</literal> funktioniert nicht in AutoYaST, da er eine Benutzerinteraktion verlangt. Wenn Sie ihn verwenden, wird der Registrierungsvorgang übersprungen.
    </para>
   </step>
   <step>
    <para>
     Führen Sie jegliche weitere Konfiguration durch, die für die bereitzustellenden Systeme erforderlich ist.
    </para>
   </step>
   <step>
    <para>
     Wählen Sie <menuchoice> <guimenu>Datei</guimenu> <guimenu>Speichern unter</guimenu> </menuchoice> und geben Sie einen Dateinamen für das Profil ein, z. B. <filename>autoinst.xml</filename>.
    </para>
   </step>
  </procedure>
 </section>
 <section xml:id="smt-client-clientsetupscript">
  <title>Konfigurieren von Clients mit dem Skript clientSetup4SMT.sh</title>

  <para>
   Das Skript <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command> wird mit SMT zur Verfügung gestellt. Mithilfe dieses Skripts können Sie einen Clientcomputer für die Verwendung eines SMT-Servers konfigurieren oder seine Konfiguration so ändern, dass er einen anderen SMT-Server verwendet.
  </para>

  <para>
   So konfigurieren Sie einen Clientcomputer mithilfe des Skripts <command>clientSetup4SMT.sh</command> für die Verwendung von SMT:
  </para>

  <procedure>
   <step>
    <para>
     Kopieren Sie das Skript <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename> von Ihrem SMT-Server auf den Clientcomputer.
    </para>
   </step>
   <step>
    <para>
     Führen Sie das Skript als <systemitem class="username">root</systemitem> auf dem Clientcomputer aus. Das Skript kann auf zwei Arten ausgeführt werden: Bei der ersten Möglichkeit folgt die Registrierungs-URL auf den Skriptnamen: <command>./clientSetup4SMT.sh</command> <replaceable>registrierungs_URL</replaceable>, z. B. <command>./clientSetup4SMT.sh https://smt.example.com/center/regsvc</command>. Bei der zweiten Möglichkeit folgt die Option <option>--host</option> und anschließend der Hostname des SMT-Servers auf den Skriptnamen: <command>./clientSetup4SMT.sh --host</command> <replaceable>server_hostname</replaceable>, z. B. <command>./clientSetup4SMT.sh --host smt.example.com</command>.
    </para>
    
    <important>
     <title>Der Parameter <option>--host</option></title>
     <para>
      Der Hostname, der mit dem Parameter <option>--host</option> übergeben werden soll, muss mit dem Namen übereinstimmen, für den das Zertifikat ausgestellt wurde. Wenn im Zertifikat der vollständig qualifizierte Hostname angegeben ist (z. B. smt.example.com), muss dieser zudem in derselben Form eingegeben werden. Bei Eingabe des <quote>kurzen</quote> Namens (smt) tritt ein Fehler beim Skript <command>clientSetup4SMT.sh</command> auf. 
     </para>
    </important>
    
   </step>
   <step>
    <para>
     Das Skript lädt das CA-Zertifikat des Servers herunter. Akzeptieren Sie es, indem Sie <keycap>y</keycap> drücken.
    </para>
   </step>
   <step>
    <para>
     Das Skript führt alle erforderlichen Änderungen am Client durch. Jedoch erfolgt die eigentliche Registrierung nicht durch das Skript.
    </para>
   </step>
   <step>
    <para>
     Führen Sie die Registrierung mithilfe von <command>suse_register</command> oder des Moduls <command>yast2 inst_suse_register</command> auf dem Client durch.
    </para>
   </step>
  </procedure>




 </section>
 <section>
  <title>Registrieren von Clients in der SMT-Testumgebung</title>

  <para>
   Um einen Client so zu konfigurieren, dass er sich bei der Testumgebung anstelle der Produktionsumgebung registriert, ändern Sie <filename>/etc/suseRegister.conf</filename> auf dem Clientcomputer, indem Sie Folgendes festlegen:
   
   
  </para>

<screen>register = command=register&amp;testenv=1</screen>

  <para>
   Weitere Informationen über den Einsatz von SMT in einer Testumgebung finden Sie im <emphasis>Subscription Management Tool Guide</emphasis> (SMT-Handbuch).
  </para>
 </section>
</chapter>
